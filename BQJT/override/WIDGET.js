DNA.widget.CssStyleFinder = {
    updateCss: function(a) {
        var b = DNA.widget.CssStyleFinder.getBackgroundImage(a);
        if (b != null ) {
            a._setBackimage(b)
        } else {
            a._setBackimage(null )
        }
        if (b == null ) {
            a._setBackground(DNA.widget.CssStyleFinder.getBackground(a))
        }
        a._setFont(DNA.widget.CssStyleFinder.getFont(a));
        a._setForeground(DNA.widget.CssStyleFinder.getForeground(a));
        a._setCursor(DNA.widget.CssStyleFinder.getCursor(a));
        if (a._setBorder) {
            a._setBorder(DNA.widget.CssStyleFinder.getBorder(a))
        }
    },
    getBackground: function(a) {
        return this._findStyle(a, "background", false)
    },
    getForeground: function(a) {
        return this._findStyle(a, "foreground", true)
    },
    getFont: function(a) {
        return this._findStyle(a, "font", true)
    },
    getBackgroundImage: function(a) {
        return this._findStyle(a, "backimage", false)
    },
    getBorder: function(a) {
        return this._findStyle(a, "border", false)
    },
    getCursor: function(a) {
        return this._findStyle(a, "cursor", true)
    },
    _findStyle: function(g, c, a) {
        var b = g.getModeState();
        var h = "";
        if (b == 0) {
            h = this._getBehaviorStateSuffix(g)
        } else {
            h = this._getModeStateSuffix(b)
        }
        var d = this._doFindStyle(g, this._getCssStyleName(c, h), a);
        if (d == null  && h.length > 0) {
            d = this._doFindStyle(g, c, a)
        }
        return d
    },
    _doFindStyle: function(g, b, d) {
        var h = g.getCssStyles();
        if (h) {
            var n = h[b];
            if (n) {
                return n
            }
        }
        var a = g.getCssClassNames();
        for (var c = a.length - 1; c >= 0; c--) {
            var l = a[c];
            if (l) {
                n = this._findStyleFromCssSheet(l, b);
                if (n) {
                    return n
                }
            }
        }
        if (n) {
            return n
        }
        if (d) {
            var m = g.getParent();
            if (m) {
                n = this._doFindStyle(m, b, true)
            }
        }
        return n
    },
    _findStyleFromCssSheet: function(n, a) {
        var m = null ;
        var c = DNA.engine.application.getCssSheet();
        if (c) {
            var l = c[n];
            if (l) {
                m = l[a];
                if (!m) {
                    var b = l.ext;
                    if (b) {
                        var d = b.split(" ");
                        for (var g = 0, h = d.length; g < h; g++) {
                            m = this._findStyleFromCssSheet(d[g], a);
                            if (m) {
                                return m
                            }
                        }
                    }
                }
            }
        }
        return m
    },
    _getCssStyleName: function(a, b) {
        if (b) {
            return a + "_" + b
        } else {
            return a
        }
    },
    _getBehaviorStateSuffix: function(a) {
        var b = "";
        if (a._isActivedState()) {
            b = DNA.JWT.STATE_SUFFIX_ACTIVE
        } else {
            if (a._isHoveredState()) {
                b = DNA.JWT.STATE_SUFFIX_HOVER
            }
        }
        return b
    },
    _getModeStateSuffix: function(b) {
        var a = 0;
        while ((b = b >> 1) > 0) {
            a++
        }
        return DNA.JWTProperty.MODE_NAMES[a]
    }
};
(function() {
    var a = function(g, l, d) {
        var h = g.children;
        if (!h) {
            h = g.children = []
        }
        if (d) {
            var b = h.indexOf(DNA.widget.WidgetRegistry.getNode(d));
            h.insert(l, b + 1)
        } else {
            if (d === "") {
                h.insert(l, 0)
            } else {
                h[h.length] = l
            }
        }
    }
    ;
    DNA.widget.WidgetNode = {
        create: function(c, b, g, d, l) {
            var h = {
                state: 0,
                eid: c,
                parent: g,
                widget: b
            };
            if (l) {
                h.data = l;
                if (l.init && l.init[DNA.JWTProperty.PROPERTY_MODE]) {
                    h.state = l.init[DNA.JWTProperty.PROPERTY_MODE]
                }
            }
            if (g) {
                a(g, h, d);
                if (!DNA.widget.WidgetRegistry.isEnabled(g)) {
                    DNA.widget.WidgetRegistry._maskState(h, DNA.JWT.STATE_POST_DISABLED)
                }
            }
            return h
        },
        dispose: function(h) {
            DNA.widget.WidgetRegistry.removeNode(h.eid);
            var l = h.parent;
            if (l) {
                delete h.parent
            }
            var b = h.widget;
            if (b) {
                b.doDispose();
                delete h.widget
            }
            var m = h.children;
            if (m) {
                var g = m.length;
                for (var d = 0; d < g; d++) {
                    this.dispose(m[d])
                }
                delete h.children
            }
        },
        remove: function(g, h) {
            var d = g.children;
            if (d) {
                var c = d.length;
                for (var b = 0; b < c; b++) {
                    if (d[b] == h) {
                        d.splice(b, 1);
                        break
                    }
                }
            }
        }
    }
})();
DNA.widget.WidgetRegistry = {
    _nodes: {},
    putRawWidget: function(c) {
        var a = c.eid;
        var b = DNA.widget.WidgetNode.create(a, null , this._nodes[c.pid], c["prev-eid"], c);
        this._nodes[a] = b
    },
    putWidget: function(h, d) {
        var c = null ;
        if (d) {
            var b = d.getEid();
            c = this._nodes[b];
            if (!c) {
                c = DNA.widget.WidgetNode.create(b, d, null )
            }
        }
        var a = h.getEid();
        var g = this._nodes[a];
        if (!g) {
            g = DNA.widget.WidgetNode.create(a, h, c);
            this._nodes[a] = g
        }
    },
    getNode: function(a) {
        return this._nodes[a]
    },
    get: function(b) {
        var c = this._nodes[b];
        if (c) {
            var a = c.widget;
            if (!a) {
                var d = c.data;
                a = c.widget = this._wcreator.newWidget(d)
            }
            return a
        }
    },
    getRawData: function(a) {
        var b = this._nodes[a];
        return b.data
    },
    getInitData: function(a) {
        var b = this._nodes[a];
        return b.data.init
    },
    setWidgetCreator: function(a) {
        this._wcreator = a
    },
    removeNode: function(a) {
        delete this._nodes[a]
    },
    getParent: function(a) {
        var b = this._nodes[a.getEid()];
        if (b) {
            var c = b.parent;
            if (c) {
                return this.get(c.eid)
            }
        }
    },
    getChildren: function(n, d) {
        var b = this._nodes[n.getEid()];
        if (b) {
            var a = b.children;
            if (a) {
                var o = a.length;
                if (d === undefined || d === true || d === false) {
                    var l;
                    if (o > 0) {
                        l = []
                    }
                    for (var g = 0; g < o; g++) {
                        var m = a[g];
                        var h = m.widget;
                        if (d !== false && !h) {
                            h = this.get(m.eid)
                        }
                        if (h) {
                            l[l.length] = h
                        }
                    }
                    return l
                } else {
                    if (d >= 0 && d < o) {
                        var m = a[d];
                        var h = m.widget;
                        if (!h) {
                            h = this.get(m.eid)
                        }
                        return h
                    }
                }
            }
        }
    },
    getChildrenCount: function(a) {
        var c = this._nodes[a.getEid()];
        if (c) {
            var b = c.children;
            if (b) {
                return b.length
            }
        }
        return 0
    },
    indexOf: function(b, h) {
        var d = this._nodes[b.getEid()];
        if (h instanceof DNA.widget.Widget) {
            h = h.getEid()
        }
        var g = this._nodes[h];
        if (d && g) {
            var a = d.children;
            if (a) {
                return a.indexOf(g)
            }
        }
        return -1
    },
    _getRecycle: function() {
        if (!this._recycle) {
            this._recycle = []
        }
        return this._recycle
    },
    dispose: function(a) {
        var b = this._nodes[a];
        this._dispose(b);
        var c = this._getRecycle();
        c[c.length] = b;
        var d = b.parent;
        if (d) {
            DNA.widget.WidgetNode.remove(d, b)
        }
        delete this._nodes[a]
    },
    _dispose: function(d) {
        if (this._checkState(d, DNA.JWT.STATE_DISPOSED)) {
            return
        }
        this._maskState(d, DNA.JWT.STATE_DISPOSED);
        var c = d.children;
        if (c) {
            for (var b = 0, a = c.length; b < a; b++) {
                this._dispose(c[b])
            }
        }
    },
    isDisposed: function(a) {
        var b = this._nodes[a];
        if (b) {
            return this._checkState(b, DNA.JWT.STATE_DISPOSED)
        } else {
            return true
        }
    },
    setEnabled: function(a, b) {
        var c = this._nodes[a];
        if (b) {
            this._unmaskState(c, DNA.JWT.STATE_MODE_DISABLED);
            if (this.isEnabled(c.parent)) {
                this._unmaskState(c, DNA.JWT.STATE_POST_DISABLED)
            }
            this._enableChildren(c, true)
        } else {
            this._maskState(c, DNA.JWT.STATE_MODE_DISABLED);
            this._disableChildren(c, true)
        }
    },
    isEnabled: function(a) {
        return !(this._checkState(a, DNA.JWT.STATE_MODE_DISABLED) || this._checkState(a, DNA.JWT.STATE_POST_DISABLED))
    },
    _enableChildren: function(g, b) {
        if (!b) {
            if (this._checkState(g, DNA.JWT.STATE_MODE_DISABLED)) {
                return
            }
            this._unmaskState(g, DNA.JWT.STATE_POST_DISABLED)
        }
        var d = g.children;
        if (d) {
            for (var c = 0, a = d.length; c < a; c++) {
                this._enableChildren(d[c])
            }
        }
    },
    _disableChildren: function(g, b) {
        if (!b) {
            if (this._checkState(g, DNA.JWT.STATE_MODE_DISABLED)) {
                return
            }
            this._maskState(g, DNA.JWT.STATE_POST_DISABLED)
        }
        var d = g.children;
        if (d) {
            for (var c = 0, a = d.length; c < a; c++) {
                this._disableChildren(d[c])
            }
        }
    },
    _checkState: function(b, a) {
        return (b.state & a) != 0
    },
    _maskState: function(b, a) {
        b.state |= a
    },
    _unmaskState: function(b, a) {
        b.state &= ~a
    },
    doGC: function() {
        if (true) {
            var d = this._getRecycle();
            var b = d.length;
            for (var a = 0; a < b; a++) {
                var c = d[a];
                DNA.widget.WidgetNode.dispose(c, true)
            }
            d.splice(0, b)
        }
    },
    addWidgetCountMonitor: function(a) {
        a.addListener(DNA.JWTEvent.KEYDOWN, this._showCountAction, this)
    },
    _showCountAction: new DNA.engine.Action({
        handle: function(l) {
            if ((l.getKeyCode() == 81) && l.isCtrl() && l.isAlt()) {
                var d = 0
                  , c = 0;
                var a = this._nodes;
                var o = {};
                var t = {};
                var r;
                var h;
                var s;
                var n = function(u, m) {
                    if (u[m]) {
                        u[m]++
                    } else {
                        u[m] = 1
                    }
                }
                ;
                var p = function(v) {
                    var m;
                    for (var u in v) {
                        if (!m) {
                            m = "(" + v[u] + ")" + u + "\n"
                        } else {
                            m += "(" + v[u] + ")" + u + "\n"
                        }
                    }
                    return m
                }
                ;
                for (var g in a) {
                    var b = a[g];
                    if (b.data) {
                        d++;
                        var q = b.widget;
                        if (q) {
                            c++;
                            n(t, b.data.etype)
                        } else {
                            n(o, b.data.etype)
                        }
                    }
                }
                r = p(o);
                h = p(t);
                document.title = "total : inited --> " + (d + " : " + c);
                alert("δ��ʼ���Ŀؼ����ͼ���Ӧ������\n" + r + "�ѳ�ʼ���Ŀؼ����ͼ���Ӧ����: \n" + h)
            }
        }
    })
};
DNA.widget.MenuMgr = function(a) {
    this._menus = [];
    this._menubars = [];
    this._toolbars = [];
    this._selectedMenuItem = [];
    a.addListener(DNA.JWTEvent.MOUSEDOWN, this._mousedownAction, this);
    a.addListener(DNA.JWTEvent.CLICK, this._clickAction, this);
    a.addListener(DNA.JWTEvent.MOUSEUP, this._contextmenuAction, this)
}
;
DNA.widget.MenuMgr.prototype = {
    _zseed: 99999,
    getNewZseed: function() {
        return ++this._zseed
    },
    getMenuByHandle: function(g) {
        var c = DNA.engine.application.getBrowserBody().childNodes;
        for (var b = 0, a = c.length; b < a; b++) {
            var d = c[b];
            if (d.getAttribute && d.getAttribute(DNA.JWTProperty.PROPERTY_HANDLE) === g) {
                return DNA.widget.WidgetRegistry.get(d.id)
            }
        }
    },
    setToolBarHoverOpen: function(a) {
        this.toolbarHoverOpen = a
    },
    _doSysMenuAction: new DNA.engine.Action({
        handle: function(a) {
            this.doSysMenuAction(a, a.getSrcWidget().getEid().substring(16))
        }
    }),
    getSystemMenu: function(p, d) {
        var c = DNA.widget.WidgetRegistry.get("system_menu");
        if (!c) {
            var h = {
                eid: "system_menu",
                etype: "Menu",
                pid: "_e_0",
                init: {
                    eid: "system_menu"
                }
            };
            DNA.widget.WidgetRegistry.putRawWidget(h);
            c = DNA.widget.WidgetRegistry.get("system_menu");
            var m = '<div id=system_menu class="Menu Menu_style1" style="position: absolute; z-index: 99999; left: 648px; top: 139px;" >' + c._getInnerHtml() + "</div>";
            DNA.engine.application.getRoot().appendChildHtml(m)
        } else {
            c.clear();
            DNA.widget.WidgetRegistry.getNode(c.getEid()).children = []
        }
        if (p._owner instanceof DNA.widget.ToolBar) {
            DNA.engine.DomUtil.removeClass(c.getEl(), "Menu_style1");
            DNA.engine.DomUtil.addClass(c.getEl(), "Menu_style3")
        } else {
            DNA.engine.DomUtil.removeClass(c.getEl(), "Menu_style3");
            DNA.engine.DomUtil.addClass(c.getEl(), "Menu_style1")
        }
        if ((p._owner instanceof DNA.widget.TabFolder) && (p._owner.getStyle() & DNA.JWT.CLOSE)) {
            this._appendCloseAllItem(c, p)
        }
        for (var l = 0, n = d.length; l < n; l++) {
            var r = d[l];
            if (r) {
                var b = "system_menuitem_" + r.getEid();
                var h = {
                    eid: b,
                    etype: "MenuItem",
                    pid: "system_menu",
                    init: {
                        eid: b,
                        style: DNA.JWT.PUSH
                    }
                };
                DNA.widget.WidgetRegistry.putRawWidget(h);
                var a = "MenuItem";
                var q = '<div style="width: 22px; height: 16px; padding-left: 3px;"></div>';
                var g = '<div style="width: 16px; height: 16px;"></div>';
                var o = '<td style="width: 16px;" class=menuitem-c></td>';
                if (r instanceof DNA.widget.TabItem) {
                    a += " TabMenuItem";
                    q = '<div class="bg-image" style="width: 26px; height: 16px;padding-left: 0px;"></div>';
                    o = '<td style="width: 0px;" class=menuitem-c></td>'
                } else {
                    if (r instanceof DNA.widget.ToolItem) {
                        a += " ToolMenuItem";
                        q = '<div style="width: 22px; height: 16px; padding-left: 3px;display:none;"></div>';
                        g = '<div style="width: 16px; height: 16px; display:none;"></div>';
                        o = '<td style="width: 20px;" class=menuitem-c><img src="' + r._getImage().getUrl() + '" /></td>'
                    }
                }
                var m = '<tr class= "' + a + '" id=' + b + '><td class="menuitem-l imgbox"></td><td class="menuitem-c imgbox">' + q + "</td>" + o + "<td class=menuitem-c><div class=txt>" + r.getText() + "</div></td><td class=menuitem-c>" + g + '</td><td class="menuitem-r"></td></tr>';
                DNA.engine.DomUtil.append(c.getBody(), m);
                DNA.widget.WidgetRegistry.get(b).addListener(DNA.JWTEvent.ACTION, this._doSysMenuAction, p);
                if (r instanceof DNA.widget.ToolItem && !r.isEnabled()) {
                    DNA.widget.WidgetRegistry.getNode(b);
                    c.findItem(l).setEnabled(false)
                }
            } else {
                var a = "MenuItem";
                if (p._owner instanceof DNA.widget.ToolBar) {
                    a = a + " SeparatorMenuItem";
                    var b = "system_menuitem_separator" + d[l - 1].getEid();
                    var h = {
                        eid: b,
                        etype: "MenuItem",
                        pid: "system_menu",
                        init: {
                            eid: b,
                            style: DNA.JWT.PUSH
                        }
                    };
                    DNA.widget.WidgetRegistry.putRawWidget(h)
                }
                var m = '<tr style="" class="' + a + '"><td class="separator-l imgbox"></td><td class="imgbox"></td><td class="menuitem-separator-l"></td><td class="menuitem-separator-c"></td><td class="menuitem-separator-r"></td><td class="separator-r"></td></tr>';
                DNA.engine.DomUtil.append(c.getBody(), m)
            }
        }
        var m = '<IFRAME  frameborder=0 scrolling=no class="flowproxy-iframe" src ></IFRAME>';
        DNA.engine.DomUtil.append(c.getEl(), m);
        return c
    },
    _appendCloseAllItem: function(m, b) {
        var c = "system_menuitem_close_all_tabitem";
        var h = {
            eid: c,
            etype: "MenuItem",
            pid: "system_menu",
            init: {
                eid: c,
                style: DNA.JWT.PUSH
            }
        };
        DNA.widget.WidgetRegistry.putRawWidget(h);
        var l = "MenuItem TabCloseMenuItem";
        var a = '<div class="bg-image" style="width: 26px;height: 16px;padding-left: 0px;"></div>';
        var g = '<div style="width: 16px; height: 16px;"></div>';
        var d = '<tr class= "' + l + '" id=' + c + '><td class="menuitem-l imgbox" style="border-bottom:1px solid #F8F8F8;"></td><td class="menuitem-c imgbox" style="border-bottom:1px solid #EFEFEF;">' + a + '</td><td style="width: 0px;" class=menuitem-c style="border-bottom:1px solid #EFEFEF;"></td><td class=menuitem-c style="border-bottom:1px solid #EFEFEF;"><div class=txt >�ر�ȫ��</div></td><td class=menuitem-c style="border-bottom:1px solid #F8F8F8;">' + g + '</td><td class="menuitem-r" style="border-bottom:1px solid #F8F8F8;"></td></tr>';
        DNA.engine.DomUtil.append(m.getBody(), d);
        DNA.widget.WidgetRegistry.get(c).addListener(DNA.JWTEvent.ACTION, this._doSysMenuAction, b)
    },
    _register: function(a) {
        if (a instanceof DNA.widget.Menu) {
            this._menus.push(a);
            a.addListener(DNA.JWTEvent.MOUSEMOVE, this._menuMousemoveAction, this);
            a.addListener(DNA.JWTEvent.MOUSEOUT, this._menuMouseoutAction, this)
        } else {
            if (a instanceof DNA.widget.MenuBar) {
                this._menubars.push(a);
                a.addListener(DNA.JWTEvent.MOUSEMOVE, this._menubarMousemoveAction, this)
            } else {
                if (a instanceof DNA.widget.ToolBar) {
                    this._toolbars.push(a);
                    a.addListener(DNA.JWTEvent.MOUSEMOVE, this._toolbarMousemoveAction, this)
                }
            }
        }
    },
    _menuMouseoutAction: new DNA.engine.Action({
        handle: function(a) {
            this._lowLightHoveredItem(a)
        }
    }),
    _unregister: function(a) {
        if (a instanceof DNA.widget.Menu) {
            this._menus.remove(a);
            a.removeListener(this, DNA.JWTEvent.MOUSEMOVE);
            a.removeListener(this, DNA.JWTEvent.MOUSEOUT)
        } else {
            if (a instanceof DNA.widget.MenuBar) {
                this._menubars.remove(a);
                a.removeListener(this, DNA.JWTEvent.MOUSEMOVE)
            } else {
                if (a instanceof DNA.widget.ToolBar) {
                    this._toolbars.remove(a);
                    a.removeListener(this, DNA.JWTEvent.MOUSEMOVE)
                }
            }
        }
    },
    _mousedownAction: new DNA.engine.Action({
        handle: function(m) {
            var d = m.getSrcElement();
            var q = m.getSrcWidget();
            var o = m.getSrcControl();
            for (var h = 0, l = this._menus.length; h < l; h++) {
                var b = this._menus[h];
                var g = b.getChildren();
                if (g && g[0] instanceof DNA.widget.Composite && g[0].isAncestorOf(o)) {
                    return
                }
            }
            if ((q instanceof DNA.widget.MenuItem) && (q.getParent() instanceof DNA.widget.MenuBar) && q.isEnabled()) {
                if (q.getStyle() & DNA.JWT.CASCADE) {
                    if (this._expandedMenuBar == o) {
                        var n = o._activedDropMenuItem;
                        if (n) {
                            o._hoveredMenuItem = q;
                            n._highLight();
                            delete o._activedDropMenuItem
                        }
                        delete this._expandedMenuBar
                    } else {
                        o._clearHoveredCache();
                        q._grayLight();
                        this._setExpandMenuBar(o, q)
                    }
                    q._setMenuExpanded()
                } else {
                    this._clearExpandMenuBar();
                    q._grayLight()
                }
                for (var h = this._menus.length - 1; h > -1; h--) {
                    var b = this._menus[h];
                    var a = b.getParent();
                    if (((!a) || (a && a != q)) && b.getVisible()) {
                        b.setVisible(false)
                    }
                }
                this._clearSelectedMenuItem()
            } else {
                if (!((q.getParent() instanceof DNA.widget.Menu))) {
                    this._hideAllMenus();
                    if ((q instanceof DNA.widget.ToolItem) && d == q._getArrowEl() && q.isEnabled()) {
                        this.setExpandToolItem(o, q)
                    }
                    this._clearExpandMenuBar();
                    if (o instanceof DNA.widget.ToolBar && o._getActivedDropItem() == q && d == q._getArrowEl()) {} else {
                        this._clearExpandToolBar()
                    }
                    this._clearSelectedMenuItem()
                }
            }
        }
    }),
    setExpandToolItem: function(b, a) {
        this._setExpandToolBar(b);
        b._cacheActivedDropItem(a)
    },
    isMenuOnCurrentModalWindow: function(b) {
        var a = DNA.engine.application.getWindowMgr().getCurrentModalWindow();
        if (!a) {
            return true
        }
        return parseInt(a.getEl().style.zIndex) < parseInt(b.getEl().style.zIndex)
    },
    _hideAllMenus: function(a) {
        for (var b = this._menus.length - 1; b > -1; b--) {
            var c = this._menus[b];
            if (c.getVisible()) {
                c.hideMenuCascade()
            }
        }
    },
    _clickAction: new DNA.engine.Action({
        handle: function(c) {
            var b = c.getSrcElement();
            var a = c.getSrcWidget();
            if ((a instanceof DNA.widget.MenuItem) && a.isEnabled()) {
                if (a.getParent() instanceof DNA.widget.MenuBar) {
                    if (a.getStyle() & DNA.JWT.PUSH) {
                        a.fireEvent("action", [c]);
                        a._highLight()
                    }
                } else {
                    if (a.getStyle() & DNA.JWT.CASCADE || a.getStyle() & DNA.JWT.SEPARATOR) {
                        return
                    } else {
                        if (a.getStyle() & DNA.JWT.PUSH) {
                            a.fireEvent("action", [c])
                        } else {
                            if ((a.getStyle() & DNA.JWT.CHECK) ) {
                                a.setSelection(!a.getSelection());
                                a.fireEvent("action", [c])
                            } else {
                                if (a.getStyle() & DNA.JWT.RADIO) {
                                    if (!a.getSelection()) {
                                        a.setSelection(true)
                                    }
                                    a.fireEvent("action", [c])
                                }
                            }
                        }
                    }
                    if (a.getEid() == "system_menuitem_copy" || a.getEid() == "system_menuitem_paste") {
                        a.getParent().setVisible(false)
                    } else {
                        this._clearExpandMenuBar();
                        this._clearExpandToolBar();
                        this._hideAllMenus()
                    }
                }
            }
        }
    }),
    _contextmenuAction: new DNA.engine.Action({
        handle: function(a) {
            if (a.getButton() == DNA.JWTEvent.BUTTON_RIGHT) {
                var d = a.getSrcControl();
                if (d.isEnabled()) {
                    d.fireEvent(DNA.JWTEvent.UI_CONTEXTMENU, [a]);
                    var b = d.getMenu();
                    if (b && (!b.isDisposed()) && (!a.isPrevented())) {
                        b.showMenu(a.getXY().x + 1, a.getXY().y + 1)
                    }
                }
            }
        }
    }),
    _getCurrentMixedMenu: function() {
        var g = DNA.engine.application.getBrowserBody().childNodes;
        var b = null ;
        for (var d = 0, a = g.length; d < a; d++) {
            var l = g[d];
            if (l.className == "Menu" && l.style.display != "none") {
                var m = DNA.widget.WidgetRegistry.get(l.id);
                var h = m.getChildren();
                if (h) {
                    var n = h[0];
                    if (n instanceof DNA.widget.Composite) {
                        return m
                    }
                }
            }
        }
    },
    canCloseMixedMenu: function() {
        return this._canCloseMixedMenu
    },
    _clearBarCache: function(d) {
        if (d) {
            this._canCloseMixedMenu = false
        }
        this._clearExpandMenuBar();
        this._clearExpandToolBar();
        if (d) {
            this._canCloseMixedMenu = true
        }
        for (var b = 0, a = this._menubars.length; b < a; b++) {
            var c = this._menubars[b];
            c._clearHoveredCache()
        }
        for (var b = 0, a = this._toolbars.length; b < a; b++) {
            var c = this._toolbars[b];
            c._clearHoveredCache()
        }
    },
    _setExpandMenuBar: function(b, a) {
        this._expandedMenuBar = b;
        this._expandedMenuBar._activedDropMenuItem = a
    },
    _clearExpandMenuBar: function() {
        if (this._expandedMenuBar) {
            var a = this._expandedMenuBar._activedDropMenuItem;
            if (a) {
                a._lowLight();
                delete this._expandedMenuBar._activedDropMenuItem
            }
            delete this._expandedMenuBar
        }
    },
    _setExpandToolBar: function(a) {
        this._expandedToolBar = a
    },
    _clearExpandToolBar: function() {
        if (this._expandedToolBar) {
            if (this._expandedToolBar._clearActivedDropItem()) {
                delete this._expandedToolBar
            }
        }
    },
    _toolbarMousemoveAction: new DNA.engine.Action({
        handle: function(b) {
            var d = b.getSrcControl();
            if (d.checkRendered(true)) {
                var a = b.getSrcWidget();
                if (a instanceof DNA.widget.ToolItem && !(a.getStyle() & DNA.JWT.SEPARATOR)) {
                    if (a != d._getHovered()) {
                        if (a.getSelection() === false) {
                            d._clearHoveredCache();
                            if (a.isEnabled()) {
                                if (this.toolbarHoverOpen) {
                                    this._setExpandToolBar(d)
                                }
                                if ((a.getStyle() & DNA.JWT.DROP_DOWN) && (this._expandedToolBar == d)) {
                                    if (d._getActivedDropItem() != a) {
                                        d._clearActivedDropItem();
                                        this._clearSelectedMenuItem();
                                        d._cacheActivedDropItem(a)
                                    }
                                } else {
                                    d._clearActivedDropItem();
                                    d._cacheHoveredItem(a)
                                }
                            }
                        } else {
                            d._clearHoveredCache();
                            d._clearActivedDropItem()
                        }
                    }
                } else {
                    d._clearHoveredCache()
                }
            }
        }
    }),
    _menubarMousemoveAction: new DNA.engine.Action({
        handle: function(g) {
            var h = g.getSrcControl();
            if (h.checkRendered(true)) {
                var b = g.getSrcWidget();
                if (h != b) {
                    if (this._expandedMenuBar == h) {
                        var a = h._activedDropMenuItem;
                        if (a != b) {
                            if (a) {
                                a._setMenuExpanded(false);
                                delete h._activedDropMenuItem;
                                a._lowLight()
                            }
                            if (b.isEnabled() && (b.getStyle() & DNA.JWT.CASCADE)) {
                                b._setMenuExpanded(true);
                                h._activedDropMenuItem = b;
                                b._grayLight()
                            }
                            this._clearSelectedMenuItem()
                        }
                    }
                    var d = h._hoveredMenuItem;
                    if (d != b) {
                        if (d) {
                            d._lowLight();
                            h._hoveredMenuItem = null 
                        }
                        if (b.isEnabled() && (b != h._activedDropMenuItem)) {
                            b._highLight();
                            h._hoveredMenuItem = b
                        }
                    }
                } else {
                    if (h._hoveredMenuItem) {
                        h._hoveredMenuItem._lowLight();
                        h._hoveredMenuItem = null 
                    }
                }
            }
        }
    }),
    _menuMousemoveAction: new DNA.engine.Action({
        handle: function(d) {
            var a = d.getSrcControl();
            var b = d.getSrcWidget();
            if (b instanceof DNA.widget.MenuItem) {
                var g = b._getMenu();
                if (g) {
                    this._lowLightHoveredItem();
                    if (this._selectedMenuItem.indexOf(b) == -1) {
                        var c = this._getSelectedofMenu(b.getParent());
                        if (c) {
                            this._clearSelectedMenuItem(c)
                        }
                        b._highLight();
                        this._selectedMenuItem.push(b);
                        b._setMenuExpanded(true)
                    }
                } else {
                    if (b != this._hoveredMenuItem) {
                        this._lowLightHoveredItem();
                        if (!(b.getStyle() & DNA.JWT.SEPARATOR)) {
                            b._highLight();
                            this._hoveredMenuItem = b
                        } else {
                            this._hoveredMenuItem = null 
                        }
                        var c = this._getSelectedofMenu(b.getParent());
                        if (c) {
                            this._clearSelectedMenuItem(c)
                        }
                    }
                }
            } else {
                this._lowLightHoveredItem()
            }
        }
    }),
    _lowLightHoveredItem: function(a) {
        if (this._hoveredMenuItem) {
            if (!this._hoveredMenuItem.isDisposed()) {
                this._hoveredMenuItem._lowLight();
                this._hoveredMenuItem = null 
            } else {
                this._hoveredMenuItem = null 
            }
        }
    },
    _getSelectedofMenu: function(g) {
        var b = this._selectedMenuItem;
        for (var d = 0, a = b.length; d < a; d++) {
            var c = b[d];
            if (c.getParent() == g) {
                return c
            }
        }
    },
    _clearSelectedMenuItem: function(g) {
        var b = this._selectedMenuItem;
        if (g) {
            for (var d = 0, a = b.length; d < a; d++) {
                var c = b[d];
                if (g.isAncestorOf(c)) {
                    if (!c.isDisposed()) {
                        if (c._setMenuExpanded(false)) {
                            c._lowLight()
                        }
                    }
                    b.remove(c)
                }
            }
        } else {
            for (var d = 0, a = b.length; d < a; d++) {
                var c = b[d];
                if (!c.isDisposed()) {
                    if (c._setMenuExpanded(false)) {
                        c._lowLight()
                    }
                }
            }
            this._selectedMenuItem = []
        }
    }
};
DNA.widget.WidgetGlobalPropertites = function() {}
;
DNA.widget.WidgetGlobalPropertites.prototype = {
    _map: new DNA.engine.Map(),
    getGlobalProperty: function(c, a) {
        var d = this._map.get(c);
        if (d) {
            for (var b in d) {
                if (b === a) {
                    return d[b]
                }
            }
        }
        return null 
    },
    putWidgetGlobalInfo: function(a, b) {
        this._map.set(a, b)
    }
};
DNA.widget.WindowMgr = function(a) {
    a.addListener(DNA.JWTEvent.KEYDOWN, this._winEscAction, this);
    a.addFilter(DNA.JWTEvent.MOUSEDOWN, this._bring2FrontAction, this)
}
;
DNA.widget.WindowMgr.extend(DNA.engine.JWTObject, {
    _zseed: 9000,
    _zinterval: 2,
    _handles: {},
    _roots: {},
    _modalWindows: [],
    register: function(a) {
        if (a._handle) {
            this._handles[a._handle] = a
        }
        if (a._parentHandle) {
            a._setParentWin(this._handles[a._parentHandle])
        }
        if (a._parentWin) {
            a._groupID = a._parentWin._groupID;
            a._parentWin._childWins.push(a)
        } else {
            a._groupID = a.serialNumber;
            this._roots[a.serialNumber] = a
        }
        if ((a.getStyle() & DNA.JWT.MODAL) ) {
            this._modalWindows.push(a)
        }
    },
    getTopWindowZIndexPlusInterval: function() {
        return DNA.engine.application.getTopWindowZIndex() + this._zinterval
    },
    unregister: function(a) {
        delete this._handles[a._handle];
        delete this._roots[a.serialNumber];
        if (a === this._activeWin) {
            this.setActiveWin(null )
        }
        if ((a.getStyle() & DNA.JWT.MODAL) ) {
            this._modalWindows.pop(a)
        }
    },
    bring2Front: function(g) {
        this.setActiveWin(g);
        var b = this._roots[g._groupID];
        var a = this._getBrothersMaxIndex(b);
        if (a > this._zseed) {
            a += this._zinterval;
            var d = a - b._zIndex;
            if (d != 0) {
                b._setZIndex(a);
                this._resetChildZIndex(b, d)
            }
        }
        if (b != g) {
            var c = this._getBrothersMaxIndex(g);
            if (c > this._zseed) {
                c += this._zinterval;
                d = c - g._zIndex;
                if (d != 0) {
                    g._setZIndex(c);
                    this._resetChildZIndex(g, d)
                }
            }
        }
    },
    _resetChildZIndex: function(g, d) {
        var c = g._childWins;
        for (var b = 0, a = c.length; b < a; b++) {
            var h = c[b];
            h._setZIndex(h._zIndex + d);
            this._resetChildZIndex(h, d)
        }
    },
    _getMaxIndexinGroup: function(c) {
        var g = c._childWins;
        var b = c._zIndex;
        for (var d = 0, a = g.length; d < a; d++) {
            var l = g[d];
            var h = this._getMaxIndexinGroup(l);
            b = Math.max(b, h)
        }
        return b
    },
    _getBrothersMaxIndex: function(h) {
        var b = this._zseed;
        if (!h._parentWin) {
            var g = this._roots;
            for (c in g) {
                var l = this._getMaxIndexinGroup(g[c]);
                b = Math.max(b, l)
            }
        } else {
            var d = h._parentWin._childWins;
            for (var c = 0, a = d.length; c < a; c++) {
                var l = this._getMaxIndexinGroup(d[c]);
                b = Math.max(b, l)
            }
        }
        return b
    },
    _getCurrentWindow: function() {
        var d = DNA.engine.application.getBrowserBody().childNodes;
        var b = null ;
        for (var c = 0, a = d.length; c < a; c++) {
            var l = d[c];
            var g = l.className;
            if (g && (g.indexOf("Window") != -1)) {
                var h = DNA.widget.WidgetRegistry.get(l.id);
                if (h && h.isVisible()) {
                    if (b) {
                        if (b._zIndex < h._zIndex) {
                            b = h
                        }
                    } else {
                        b = h
                    }
                }
            }
        }
        return b
    },
    _hasWindow: function() {
        for (var a in this._roots) {
            return true
        }
        return false
    },
    _bring2FrontAction: new DNA.engine.Action({
        handle: function(d) {
            if (this._hasWindow()) {
                var b = this._activeWin;
                var g = d.getSrcControl();
                var a = null ;
                while (g && !(g instanceof DNA.widget.Root)) {
                    a = g;
                    g = g.getParentControl()
                }
                if (a == b) {
                    return
                }
                if (a instanceof DNA.widget.Window && !(a.getStyle() & DNA.JWT.MODAL)) {
                    this.bring2Front(a)
                } else {
                    if (b && !(b.getStyle() & DNA.JWT.MODAL)) {
                        this.setActiveWin(null )
                    }
                }
            }
        }
    }),
    setActiveWin: function(a) {
        this._activeWin = a
    },
    _getVisibleCombo: function() {
        var c = DNA.engine.application.getBrowserBody().childNodes;
        for (var b = 0, a = c.length; b < a; b++) {
            var d = c[b];
            if (d.id) {
                var g = DNA.widget.WidgetRegistry.get(d.id);
                if (g instanceof DNA.widget.ComboPanel && g.isPanelVisible()) {
                    return g
                }
            }
        }
        return null 
    },
    _winEscAction: new DNA.engine.Action({
        handle: function(c) {
            var a = this._activeWin;
            if (a && c.getKeyCode() == DNA.JWTEvent.ESC) {
                var b = this._getVisibleCombo();
                if (!b || !a.isAncestorOf(b)) {
                    a.fireEvent(DNA.JWTEvent.CLOSE, [c, a]);
                    this.setActiveWin(null )
                }
            }
        }
    }),
    getFrontWindow: function(b) {
        var a = DNA.widget.WidgetRegistry.get("system_front_window");
        if (!a) {
            var d = "<div class='Window' id='system_front_window'><div style='cursor: nw-resize;' class='frontwindow-top-left' resize='nw-resize'></div><div style='cursor: n-resize;' class='frontwindow-top' resize='n-resize'></div><div style='cursor: ne-resize;' class='frontwindow-top-right' resize='ne-resize'></div><div><table cellspacing='0' cellpadding='0' class='frontwindow-title'><tbody><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table></div><div style='cursor: w-resize;' class='frontwindow-left' resize='w-resize'></div><div style='background-color: rgb(255, 255, 255);' class='frontwindow-center'></div><div style='cursor: e-resize;' class='frontwindow-right' resize='e-resize'></div><div style='cursor: sw-resize;' class='frontwindow-bottom-left' resize='sw-resize'></div><div style='cursor: s-resize;' class='frontwindow-bottom' resize='s-resize'></div><div style='cursor: se-resize;' class='frontwindow-bottom-right' resize='se-resize'></div></div>";
            DNA.engine.application.getRoot().appendChildHtml(d);
            var h = {
                eid: "system_front_window",
                etype: "Window",
                init: {
                    eid: "system_front_window",
                    style: DNA.JWT.MODAL | DNA.JWT.MAXIMUM
                }
            };
            DNA.widget.WidgetRegistry.putRawWidget(h);
            a = DNA.widget.WidgetRegistry.get("system_front_window");
            a.addListener("close", this._closeAction, this);
            a.addListener("resize", this._resizeAction, this);
            this._frontwindow = a
        }
        var g = DNA.engine.application.getShell().getBounds();
        var c = b.computeSize(DNA.JWT.DEFAULT, DNA.JWT.DEFAULT);
        a.setBounds((g.width - c.x) / 2, (g.height - c.y) / 2, c.x, c.y);
        DNA.engine.application.getJWTEventMgr().addListener(DNA.JWTEvent.PREDISPOSE, this._doPreDispose, this);
        return a
    },
    _doPreDispose: new DNA.engine.Action({
        handle: function(b) {
            var a = DNA.engine.application.getFrontCompositeInfo();
            if (a) {
                if (b.isAncestorOf(DNA.widget.WidgetRegistry.get(a.eid))) {
                    DNA.engine.application.restore()
                }
            }
        }
    }),
    _closeAction: new DNA.engine.Action({
        handle: function(c, b) {
            if (b && (b.getEid() == "system_alert_window" || b.getEid() == "system_confirm_window")) {
                b.setVisible(false)
            } else {
                if (b && b.getEid() == "system_front_window") {
                    DNA.engine.application.restore()
                } else {
                    if (c.getEid() == "alert_ok") {
                        var a = DNA.widget.WidgetRegistry.get("system_alert_window");
                        a.fireEvent("close", [c, a])
                    } else {
                        if (c.getEid() == "confirm_cancel") {
                            var a = DNA.widget.WidgetRegistry.get("system_confirm_window");
                            a.fireEvent("close", [c, a])
                        } else {
                            if (c.getEid() == "confirm_ok") {
                                var a = DNA.widget.WidgetRegistry.get("system_confirm_window");
                                a.fireEvent("confirm_ok", [c, a])
                            }
                        }
                    }
                }
            }
        }
    }),
    _resizeAction: new DNA.engine.Action({
        handle: function(b) {
            var c = b.getClientArea();
            var a = DNA.engine.application.getFrontCompositeInfo();
            if (a) {
                DNA.widget.WidgetRegistry.get(a.eid).setBounds(0, 0, c.width, c.height)
            }
        }
    }),
    alert: function(n) {
        var d = DNA.widget.WidgetRegistry.get("system_alert_window");
        if (!d) {
            var h = {
                eid: "system_alert_window",
                etype: "Window",
                init: {
                    eid: "system_alert_window",
                    style: DNA.JWT.MODAL | DNA.JWT.CLOSE
                }
            };
            var c = {
                eid: "alert_ok",
                pid: "system_alert_window",
                etype: "Button",
                init: {
                    eid: "alert_ok"
                }
            };
            var m = {
                eid: "alert_content",
                pid: "system_alert_window",
                etype: "Composite",
                init: {
                    eid: "alert_content"
                }
            };
            DNA.widget.WidgetRegistry.putRawWidget(h);
            DNA.widget.WidgetRegistry.putRawWidget(c);
            DNA.widget.WidgetRegistry.putRawWidget(m);
            d = DNA.widget.WidgetRegistry.get("system_alert_window");
            d.addListener("close", this._closeAction, this);
            var a = DNA.widget.WidgetRegistry.get("alert_ok");
            a.addListener("action", this._closeAction, this)
        }
        var g = DNA.widget.WidgetRegistry.get("alert_content");
        g.getBody().innerHTML = "<table><tr><td><div class='alert-info'>&nbsp;</div></td><td><p>" + n + "</p></td></tr></table>";
        g.setCssStyles({
            background: "#ffffff"
        });
        d.setCssStyles({
            background: "#ffffff"
        });
        d.open();
        var l = DNA.engine.application.getShell().getBounds();
        d.setBounds((l.width - 355) / 2, (l.height - 80) / 2, 355, 80);
        var a = DNA.widget.WidgetRegistry.get("alert_ok");
        a.focus();
        return d
    },
    _initAlertResource: function() {
        var d = "��ʾ";
        var b = "ȷ��";
        if (DNA.engine.application.getShell().getLocale() != "zh_CN") {
            d = "Information";
            b = "Ok"
        }
        var c = "#";
        if (DNA.engine.Client.isChrome() || DNA.engine.Client.isSafari()) {
            c = ""
        }
        var a = '<div style="width: 361px; height: 113px;left:-1024px;top:-800px;" class="Window Window_style1" id="system_alert_window"><div class="window-top-left"></div><div style="width: 355px;" class="window-top"></div><div class="window-top-right"></div><div><table cellspacing="0" cellpadding="0" style="width: 361px; height: 25px;" class="window-title"><tbody><tr><td style="width: 3px;" class="window-left-td"></td><td style="width: 0px;" class="draggable"> </td><td valign="middle" style="width: 0px;" class="draggable icon"></td><td valign="middle" style="vertical-align: middle; text-indent: 3px;" class="draggable wtitle">' + d + '</td><td class="j-tool j-tool-close" el="close"></td><td style="width: 3px;" class="window-right-td"></td></tr></tbody></table></div><div style="height: 82px;" class="window-left"></div><div style="height: 82px; width: 355px; background-color: rgb(255, 255, 255);" class="window-center"><div style="left: 281px; top: 52px;width: 60px; height: 24px; cursor: default;" onclick class="Button Button_style1" id="alert_ok"><table cellspacing="0" cellpadding="0" class="fill"><tbody><tr><td height="3px" width="3px" class="btn-push-f-lt"></td><td class="btn-push-f-t"></td><td class="btn-push-f-rt"></td></tr><tr><td class="btn-push-f-l"></td><td valign="middle" class="btn-push-n-center"><table cellspacing="0" cellpadding="0" style="margin-left: auto; margin-right: auto; margin-top: 0px;"><tbody><tr style=""><td class="icon"></td><td class="btn-text">' + b + '</td></tr></tbody></table></td><td class="btn-push-f-r"></td></tr><tr><td class="btn-push-f-lb"></td><td class="btn-push-f-b"></td><td height="3px" width="3px" class="btn-push-f-rb"></td></tr></tbody></table></div><div style="left: 8px; top: 0px; width: 339px; height: 48px; background-color: rgb(255, 255, 255); cursor: default;" class="Composite" id="alert_content"><table><tr><td><div class=\'alert-info\'>&nbsp;</div></td><td><p></p></td></tr></table></div></div><div style="height: 82px;" class="window-right"></div><div class="window-bottom-left"></div><div style="width: 355px;" class="window-bottom"></div><div class="window-bottom-right"></div><iframe frameborder=0 scrolling=no class="flowproxy-iframe" style="filter: alpha(opacity=0);" src=\'' + c + "'></iframe></div>";
        DNA.engine.DomUtil.append(document.body, a)
    },
    confirm: function(o) {
        var n = DNA.widget.WidgetRegistry.get("system_confirm_window");
        if (!n) {
            var a = {
                eid: "system_confirm_window",
                etype: "Window",
                init: {
                    eid: "system_confirm_window",
                    style: DNA.JWT.MODAL | DNA.JWT.CLOSE
                }
            };
            var d = {
                eid: "confirm_ok",
                pid: "system_confirm_window",
                etype: "Button",
                init: {
                    eid: "confirm_ok"
                }
            };
            var c = {
                eid: "confirm_cancel",
                pid: "system_confirm_window",
                etype: "Button",
                init: {
                    eid: "confirm_cancel"
                }
            };
            var m = {
                eid: "confirm_content",
                pid: "system_confirm_window",
                etype: "Composite",
                init: {
                    eid: "confirm_content"
                }
            };
            DNA.widget.WidgetRegistry.putRawWidget(a);
            DNA.widget.WidgetRegistry.putRawWidget(d);
            DNA.widget.WidgetRegistry.putRawWidget(c);
            DNA.widget.WidgetRegistry.putRawWidget(m);
            n = DNA.widget.WidgetRegistry.get("system_confirm_window");
            n.addListener("close", this._closeAction, this);
            var l = DNA.widget.WidgetRegistry.get("confirm_cancel");
            l.addListener("action", this._closeAction, this);
            l = DNA.widget.WidgetRegistry.get("confirm_ok");
            l.addListener("action", this._closeAction, this)
        }
        var g = DNA.widget.WidgetRegistry.get("confirm_content");
        g.getBody().innerHTML = "<table><tr><td><div class='alert-info'>&nbsp;</div></td><td><p>" + o + "</p></td></tr></table>";
        g.setCssStyles({
            background: "#ffffff"
        });
        n.setCssStyles({
            background: "#ffffff"
        });
        n.open();
        var h = DNA.engine.application.getShell().getBounds();
        n.setBounds((h.width - 355) / 2, (h.height - 80) / 2, 355, 80);
        var l = DNA.widget.WidgetRegistry.get("confirm_ok");
        l.focus();
        return n
    },
    _initConfirmResource: function() {
        var g = "��Ϣȷ��";
        var b = "ȷ��";
        var c = "ȡ��";
        if (DNA.engine.application.getShell().getLocale() != "zh_CN") {
            g = "Confirm";
            b = "Ok";
            c = "Canel"
        }
        var d = "#";
        if (DNA.engine.Client.isChrome() || DNA.engine.Client.isSafari()) {
            d = ""
        }
        var a = '<div style="width: 361px; height: 113px;left:-1024px;top:-800px;" class="Window Window_style1" id="system_confirm_window"><div class="window-top-left"></div><div style="width: 355px;" class="window-top"></div><div class="window-top-right"></div><div><table cellspacing="0" cellpadding="0" style="width: 361px; height: 25px;" class="window-title"><tbody><tr><td style="width: 3px;" class="window-left-td"></td><td style="width: 0px;" class="draggable"> </td><td valign="middle" style="width: 0px;" class="draggable icon"></td><td valign="middle" style="vertical-align: middle; text-indent: 3px;" class="draggable wtitle">' + g + '</td><td class="j-tool j-tool-close" el="close"></td><td style="width: 3px;" class="window-right-td"></td></tr></tbody></table></div><div style="height: 82px;" class="window-left"></div><div style="height: 82px; width: 355px; background-color: rgb(255, 255, 255);" class="window-center"><div style="left: 211px; top: 52px;width: 60px; height: 24px; cursor: default;" onclick class="Button Button_style1" id="confirm_ok"><table cellspacing="0" cellpadding="0" class="fill"><tbody><tr><td height="3px" width="3px" class="btn-push-f-lt"></td><td class="btn-push-f-t"></td><td class="btn-push-f-rt"></td></tr><tr><td class="btn-push-f-l"></td><td valign="middle" class="btn-push-n-center"><table cellspacing="0" cellpadding="0" style="margin-left: auto; margin-right: auto; margin-top: 0px;"><tbody><tr style=""><td class="icon"></td><td class="btn-text">' + b + '</td></tr></tbody></table></td><td class="btn-push-f-r"></td></tr><tr><td class="btn-push-f-lb"></td><td class="btn-push-f-b"></td><td height="3px" width="3px" class="btn-push-f-rb"></td></tr></tbody></table></div><div style="left: 281px; top: 52px;width: 60px; height: 24px; cursor: default;" onclick class="Button Button_style1" id="confirm_cancel"><table cellspacing="0" cellpadding="0" class="fill"><tbody><tr><td height="3px" width="3px" class="btn-push-n-lt"></td><td class="btn-push-n-t"></td><td class="btn-push-n-rt"></td></tr><tr><td class="btn-push-n-l"></td><td valign="middle" class="btn-push-n-center"><table cellspacing="0" cellpadding="0" style="margin-left: auto; margin-right: auto; margin-top: 0px;"><tbody><tr style=""><td class="icon"></td><td class="btn-text">' + c + '</td></tr></tbody></table></td><td class="btn-push-n-r"></td></tr><tr><td class="btn-push-n-lb"></td><td class="btn-push-n-b"></td><td height="3px" width="3px" class="btn-push-n-rb"></td></tr></tbody></table></div><div style="left: 8px; top: 0px; width: 339px; height: 48px; background-color: rgb(255, 255, 255); cursor: default;" class="Composite" id="confirm_content"><table><tr><td><div class=\'alert-info\'>&nbsp;</div></td><td><p></p></td></tr></table></div></div><div style="height: 82px;" class="window-right"></div><div class="window-bottom-left"></div><div style="width: 355px;" class="window-bottom"></div><div class="window-bottom-right"></div><iframe frameborder=0 scrolling=no class="flowproxy-iframe" style="filter: alpha(opacity=0);" src=\'' + d + "'></iframe></div>";
        DNA.engine.DomUtil.append(document.body, a)
    },
    _getWidgetRootComposite: function(b) {
        var a;
        while (b && !(b instanceof DNA.widget.Root)) {
            a = b;
            b = b.getParentControl()
        }
        return a
    },
    isWidgetOnCurrentModalWindow: function(d) {
        var b = false;
        var a = this.getCurrentModalWindow();
        if (!a) {
            return true
        }
        var c = this._getWidgetRootComposite(d);
        if (parseInt(a.getEl().style.zIndex) <= parseInt(c.getEl().style.zIndex)) {
            b = true
        }
        return b
    },
    getCurrentModalWindow: function() {
        return this._modalWindows[this._modalWindows.length - 1]
    },
    getEffectProxy: function(d) {
        var a = (d) ? d : "#cfe6cc";
        var c = this._effectProxy;
        if (!c) {
            c = this._effectProxy = DNA.engine.DomUtil.append(document.body, "<div class='win-effect-proxy' style='border:1px solid #cfe6cc;position:absolute;overflow:hidden;z-index:999999;background-color:" + a + ";display:none'></div>")
        }
        c.style.backgroundColor = a;
        return c
    },
    shake: function(n) {
        var c = this.getEffectProxy("#ffffff");
        c.style.left = n.getEl().style.left;
        c.style.top = n.getEl().style.top;
        c.style.width = n.getEl().style.width;
        c.style.height = n.getEl().style.height;
        c.style.display = "";
        var h = new DNA.engine.Sprite(c);
        h.setOpacity(10);
        var l = new DNA.engine.Frame([h]);
        var d = new DNA.engine.Sprite(c);
        d.setOpacity(80);
        var g = new DNA.engine.Frame([d]);
        var a = new DNA.engine.LinearMotion(l,g,30,100);
        function m() {
            c.style.display = "none"
        }
        var b = new DNA.engine.Animation(a,a);
        b.setEndCallBack(m);
        b.play()
    },
    appear: function(m) {
        if (this._appearAnimation) {
            this._appearAnimation.stop()
        }
        var l = this.getEffectProxy();
        l.style.display = "";
        var d = new DNA.engine.Sprite(l);
        d.setBounds({
            x: 0,
            y: DNA.engine.DomUtil.getViewSize().height,
            width: 0,
            height: 0
        });
        d.setOpacity(30);
        var g = new DNA.engine.Frame([d]);
        var b = new DNA.engine.Sprite(l);
        b.setBounds(m.getBounds());
        b.setOpacity(60);
        var c = new DNA.engine.Frame([b]);
        var n = new DNA.engine.LinearMotion(g,c,20,150);
        function h(o) {
            l.style.display = "none";
            delete this._appearAnimation;
            if (o.isDisposed()) {
                return
            }
            o._initZIndex()
        }
        var a = this._appearAnimation = new DNA.engine.Animation(n);
        a.setEndCallBack(h, this, [m]);
        a.playInOrder()
    },
    disappear: function(n) {
        if (this._appearAnimation || this._disappearAnimation) {
            return
        }
        var m = this.getEffectProxy();
        m.style.display = "";
        var g = new DNA.engine.Sprite(m);
        g.setBounds({
            x: 0,
            y: DNA.engine.DomUtil.getViewSize().height,
            width: 0,
            height: 0
        });
        g.setOpacity(10);
        var h = new DNA.engine.Frame([g]);
        var c = new DNA.engine.Sprite(m);
        c.setBounds(n.getBounds());
        c.setOpacity(60);
        var d = new DNA.engine.Frame([c]);
        var a = new DNA.engine.LinearMotion(d,h,20,300);
        function l() {
            m.style.display = "none";
            delete this._disappearAnimation
        }
        var b = this._disappearAnimation = new DNA.engine.Animation(a);
        b.setEndCallBack(l, this);
        b.play()
    }
});
DNA.widget.FocusListener = function() {}
;
DNA.widget.FocusListener.prototype = {
    start: function(a) {
        a.addListener(DNA.JWTEvent.KEYDOWN, this._keyDownAction, this);
        if (DNA.engine.application.isAnimated()) {
            a.addListener(DNA.JWTEvent.KEYUP, this._keyUpAction, this)
        }
        a.addListener(DNA.JWTEvent.MOUSEDOWN, this._mouseDownAction, this);
        a.addListener("mouseout-widget", this._recordCursorWidgetAction, this);
        a.addListener("bounds_change", this._doLocateFocus, this);
        a.addListener(DNA.JWTEvent.SCROLL, this._doLocateFocus, this)
    },
    _recordCursorWidgetAction: new DNA.engine.Action({
        handle: function(a) {
            Display._setCursorWidget(a.getSrcWidget())
        }
    }),
    _keyDownAction: new DNA.engine.PreventableAction({
        handle: function(b) {
            var g = b.getSrcControl();
            var a = g.getFocusTraversalKey();
            if (b.getKeyCode() == DNA.JWTEvent.TAB || (a && a.keyCode == b.getKeyCode() && a.isAlt == b.isAlt() && a.isShift == b.isShift() && a.isCtrl == b.isCtrl())) {
                var d = this._getCurrentWindow().getFocused();
                if (d && d.getTabIndex() != -1) {
                    var c = null ;
                    if (b.isShift()) {
                        c = this._findPrevious(d)
                    } else {
                        c = this._findNext(d)
                    }
                    if (c) {
                        DNA.engine.application.setFocused(c);
                        this._changeFocus(d, c, b)
                    }
                }
                b._preventDefault()
            }
        }
    }),
    _keyUpAction: new DNA.engine.PreventableAction({
        handle: function(a) {
            if (a.getKeyCode() == DNA.JWTEvent.TAB) {
                if (this._downFocus != DNA.engine.application.getFocused()) {
                    this._resetFocusEffect();
                    this._animatedChangeFocus(this._downFocus, DNA.engine.application.getFocused())
                }
                delete this._downFocus
            }
        }
    }),
    _mouseDownAction: new DNA.engine.Action({
        handle: function(b) {
            var c = b.getSrcControl();
            var a = b.getSrcWidget();
            if (c == a || a.isEnabled()) {
                var d = DNA.engine.application.getFocused();
                if (c.canFocus()) {
                    if (d != c) {
                        DNA.engine.application.setFocused(c);
                        this._changeFocus(d, c, b)
                    } else {
                        d._focusDom(b)
                    }
                } else {
                    if (d) {
                        if (DNA.engine.Client.isStrict() && d.getInputEl) {
                            b._preventDefault()
                        }
                    } else {
                        DNA.engine.application.getBrowserBody().focus()
                    }
                }
            }
        }
    }),
    _focus: function(a) {
        if (this._getCurrentWindow() == this._getTopWindow(a)) {
            var b = DNA.engine.application.getFocused();
            if (b != a && a.canFocus()) {
                DNA.engine.application.setFocused(a);
                this._changeFocus(b, a, new DNA.JWTEvent())
            }
        }
    },
    _blurFocusedControl: function() {
        var a = DNA.engine.application.getFocused();
        if (a) {
            this.doBlurAndDispatchEvent(a);
            DNA.engine.application.setFocused(null )
        }
    },
    doBlurAndDispatchEvent: function(c, b) {
        if (c && DNA.engine.application.isAnimated() && !(b && b.getType() == DNA.JWTEvent.KEYDOWN && b.getKeyCode() == DNA.JWTEvent.TAB)) {
            this._resetFocusEffect()
        }
        var a = DNA.engine.application.getJWTEventMgr();
        if (c && !c.isDisposed() && c.isEnabled()) {
            var d = b ? Object.clone(b) : new DNA.JWTEvent();
            d.setType(DNA.JWTEvent.BLUR);
            d.setOriginalType(d.getType());
            d.setSrcControl(c);
            d.setSrcWidget(c);
            c._blur(d);
            a.dispatchControlEvent(c, DNA.JWTEvent.BLUR, d)
        }
    },
    _changeFocus: function(h, d, c) {
        var g = Object.clone(c);
        g.setType(DNA.JWTEvent.FOCUS);
        g.setOriginalType(c.getType());
        g.setSrcControl(d);
        g.setSrcWidget(d);
        d._focus(g);
        this.doBlurAndDispatchEvent(h, c);
        var a = DNA.engine.application.getJWTEventMgr();
        a.dispatchControlEvent(d, DNA.JWTEvent.FOCUS, g);
        var b = this._getTopWindow(d);
        b._setFocused(d);
        if (c.getType() == DNA.JWTEvent.KEYDOWN && c.getKeyCode() == DNA.JWTEvent.TAB) {
            if (!this._downFocus) {
                this._downFocus = h
            }
        } else {
            this._animatedChangeFocus(h, d)
        }
    },
    _animatedChangeFocus: function(d, c) {
        if (DNA.engine.application.isAnimated()) {
            if (c instanceof DNA.widget.AbstractButton || c instanceof DNA.widget.AbstractText || c instanceof DNA.widget.Abstract2ButtonControl) {
                var a;
                if (parseInt(c.getEl().style.width) <= 0 || parseInt(c.getEl().style.height) <= 0) {
                    this._resetFocusEffect();
                    return
                } else {
                    if (d && (parseInt(d.getEl().style.width) > 0 && parseInt(d.getEl().style.height) > 0)) {
                        a = d.getFocusEffectBounds()
                    } else {
                        a = {
                            x: 0,
                            y: screen.height,
                            width: 200,
                            height: 25
                        }
                    }
                }
                this.animatedFocus(a, c.getFocusEffectBounds(), c.getEl().ownerDocument, c.getFocusEffectBounds(true), c)
            } else {
                this._resetFocusEffect()
            }
        }
    },
    _getTopWindow: function(a) {
        var b = a;
        while (b) {
            if (b instanceof DNA.widget.Menu || b instanceof DNA.widget.Window || b instanceof DNA.widget.Shell) {
                break
            }
            b = b.getParentControl()
        }
        return b
    },
    _getCurrentWindow: function() {
        var b = DNA.engine.application.getBrowserBody().childNodes;
        var m = null ;
        for (var d = 0, g = b.length; d < g; d++) {
            var c = b[d];
            var l = c.className;
            if (l && (l.indexOf("Window") != -1 || l.indexOf("Menu") != -1)) {
                var h = DNA.widget.WidgetRegistry.get(c.id);
                if (h && h.isVisible()) {
                    if (m) {
                        var n = parseInt(DNA.engine.DomUtil.getStyle(m.getEl(), "innerorder"));
                        var a = parseInt(DNA.engine.DomUtil.getStyle(h.getEl(), "innerorder"));
                        if (n < a) {
                            m = h
                        }
                    } else {
                        m = h
                    }
                }
            }
        }
        return m || DNA.engine.application.getShell()
    },
    _storeTabEntry: function(a, b) {
        this._tabEntryParent = a;
        this._tabEntryChild = b
    },
    _removeTabEntry: function() {
        this._tabEntryParent = null ;
        this._tabEntryChild = null 
    },
    _isNoFocusedInTheTopLevelComposite: function(b, d) {
        var a, c;
        if (this._tabEntryParent == b) {
            c = this._tabEntryChild;
            if (c) {
                a = c == d
            } else {
                a = !d || b.indexOf(d) == 0
            }
        }
        return a
    },
    _findNext: function(d) {
        var a = null ;
        var b;
        if (d) {
            b = DNA.widget.WidgetRegistry.getParent(d)
        } else {
            b = this._getCurrentWindow()
        }
        this._storeTabEntry(b, d);
        a = b._findNextTabAnchor(d, false, false, true);
        this._removeTabEntry();
        return a
    },
    _findPrevious: function(d) {
        var a = null ;
        var b;
        if (d) {
            b = DNA.widget.WidgetRegistry.getParent(d)
        } else {
            b = this._getCurrentWindow()
        }
        this._storeTabEntry(b, d);
        a = b._findNextTabAnchor(d, true, false, true);
        this._removeTabEntry();
        return a
    },
    insertProxys: function(d, a) {
        var l = DNA.engine.DomUtil;
        var b = [];
        var g = d.childNodes;
        var o = g.length;
        for (var h = 0; h < o; h++) {
            var m = g[h];
            var n = m.className;
            if (n && n.indexOf("focus-proxy-") == 0) {
                b.push(m)
            }
        }
        if (b.length == 0) {
            b.push(l.append(d, "<div class='focus-proxy-lt' style='display:none'></div>"));
            b.push(l.append(d, "<div class='focus-proxy-rt' style='display:none'></div>"));
            b.push(l.append(d, "<div class='focus-proxy-rb' style='display:none'></div>"));
            b.push(l.append(d, "<div class='focus-proxy-lb' style='display:none'></div>"))
        } else {
            b[0].style.display = "none";
            b[1].style.display = "none";
            b[2].style.display = "none";
            b[3].style.display = "none"
        }
        if (a) {
            l.setLeftTop(b[0], a.x - 5, a.y - 5);
            l.setLeftTop(b[1], a.x + a.width, a.y - 5);
            l.setLeftTop(b[2], a.x + a.width, a.y + a.height);
            l.setLeftTop(b[3], a.x - 5, a.y + a.height)
        }
        return b
    },
    animatedFocus: function(o, n, A, c, p) {
        this._endBounds = n;
        var l = this._focusEffectProxys;
        if (!l) {
            l = this._focusEffectProxys = this.insertProxys(document.body)
        }
        this._focusEffect = this.insertProxys(A.body, c);
        this._focusEffect[4] = p;
        var v = new DNA.engine.Sprite(l[0]);
        v.setPoint({
            x: o.x - 5,
            y: o.y - 5
        });
        var t = new DNA.engine.Sprite(l[0]);
        t.setPoint({
            x: n.x - 5,
            y: n.y - 5
        });
        var b = new DNA.engine.Sprite(l[1]);
        b.setPoint({
            x: o.x + o.width,
            y: o.y - 5
        });
        var a = new DNA.engine.Sprite(l[1]);
        a.setPoint({
            x: n.x + n.width,
            y: n.y - 5
        });
        var g = new DNA.engine.Sprite(l[2]);
        g.setPoint({
            x: o.x + o.width,
            y: o.y + o.height
        });
        var d = new DNA.engine.Sprite(l[2]);
        d.setPoint({
            x: n.x + n.width,
            y: n.y + n.height
        });
        var z = new DNA.engine.Sprite(l[3]);
        z.setPoint({
            x: o.x - 5,
            y: o.y + o.height
        });
        var w = new DNA.engine.Sprite(l[3]);
        w.setPoint({
            x: n.x - 5,
            y: n.y + n.height
        });
        var u = new DNA.engine.Frame([v, b, g, z]);
        var r = new DNA.engine.Frame([t, a, d, w]);
        var q = new DNA.engine.LinearMotion(u,r,25,200);
        var h = new DNA.engine.Animation(q);
        function m() {
            l[0].style.display = "";
            l[1].style.display = "";
            l[2].style.display = "";
            l[3].style.display = ""
        }
        function s(B) {
            l[0].style.display = "none";
            l[1].style.display = "none";
            l[2].style.display = "none";
            l[3].style.display = "none";
            if (DNA.engine.application.getFocused() == B) {
                this._focusEffect[0].style.display = "";
                this._focusEffect[1].style.display = "";
                this._focusEffect[2].style.display = "";
                this._focusEffect[3].style.display = ""
            }
        }
        q.setStartCallBack(m);
        q.setEndCallBack(s, this, [p]);
        h.playInOrder()
    },
    _resetFocusEffect: function() {
        var a = this._focusEffect;
        if (a && (!a[4].isDisposed())) {
            a[0].style.display = "none";
            a[1].style.display = "none";
            a[2].style.display = "none";
            a[3].style.display = "none";
            delete this._focusEffect
        }
    },
    _doLocateFocus: new DNA.engine.Action({
        handle: function(g) {
            var c = g instanceof DNA.JWTEvent ? g.getSrcControl() : g;
            var d = DNA.engine.application.getFocused();
            if (d && c.isAncestorOf(d) && DNA.engine.application.isAnimated() && (d instanceof DNA.widget.AbstractButton || d instanceof DNA.widget.AbstractText || d instanceof DNA.widget.Abstract2ButtonControl)) {
                if (parseInt(d.getEl().style.width) <= 0 || parseInt(d.getEl().style.height) <= 0 || d.getEl().offsetWidth <= 0 || d.getEl().offsetHeight <= 0) {
                    this._resetFocusEffect()
                } else {
                    if (this._focusEffect && this._focusEffect[0].style.display == "") {
                        this._resetFocusEffect();
                        var a = d.getFocusEffectBounds(true);
                        this._focusEffect = this.insertProxys(d.getEl().ownerDocument.body, a);
                        this._focusEffect[4] = d;
                        this._focusEffect[0].style.display = "";
                        this._focusEffect[1].style.display = "";
                        this._focusEffect[2].style.display = "";
                        this._focusEffect[3].style.display = ""
                    }
                }
            }
        }
    })
};
DNA.widget.InitDataParser = {
    start: function() {
        DNA.widget.InitDataParser[DNA.JWTProperty.PROPERTY_LAYOUT] = function(a) {
            return DNA.widget.ParserTools.parserLayout(a)
        }
        ;
        DNA.widget.InitDataParser[DNA.JWTProperty.PROPERTY_LAYOUT_DATA] = function(a) {
            return DNA.widget.ParserTools.parserLayoutData(a)
        }
        ;
        DNA.widget.InitDataParser[DNA.JWTProperty.PROPERTY_RECTANGLE] = function(a) {
            return DNA.widget.ParserTools.parserRectangle(a)
        }
        ;
        DNA.widget.InitDataParser[DNA.JWTProperty.PROPERTY_CSSSTYLES] = function(a) {
            return DNA.widget.ParserTools.parserCssStyle(a)
        }
        ;
        DNA.widget.InitDataParser[DNA.JWTProperty.PROPERTY_IMAGE] = function(a) {
            return DNA.widget.ParserTools.parseImg(a)
        }
    }
};
DNA.widget.ParserTools = {
    parserLayout: function(a) {
        switch (a[DNA.JWTProperty.SYN_LAYOUT_TYPE]) {
        case 0:
            return DNA.widget.ParserTools.parserFillLayout(a);
        case 1:
            return DNA.widget.ParserTools.parserRowLayout(a);
        case 2:
            return DNA.widget.ParserTools.parserGridLayout(a);
        case 3:
            return DNA.widget.ParserTools.parserBorderLayout(a);
        case 4:
            return DNA.widget.ParserTools.parserTableLayout(a);
        case 5:
            return DNA.widget.ParserTools.parserTableLayout(a, true);
        default:
            return null 
        }
    },
    parserLayoutData: function(a) {
        switch (a[DNA.JWTProperty.SYN_LAYOUT_TYPE]) {
        case 1:
            return DNA.widget.ParserTools.parserRowData(a);
        case 2:
            return DNA.widget.ParserTools.parserGridData(a);
        case 3:
            return DNA.widget.ParserTools.parserBorderData(a);
        case 4:
            return DNA.widget.ParserTools.parserTableData(a);
        default:
            return null 
        }
    },
    parserFillLayout: function(b) {
        var a = new DNA.widget.FillLayout();
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_MARGIN_WIDTH)) {
            a.marginWidth = b[DNA.JWTProperty.SYN_LAYOUT_MARGIN_WIDTH]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_MARGIN_HEIGHT)) {
            a.marginHeight = b[DNA.JWTProperty.SYN_LAYOUT_MARGIN_HEIGHT]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_SPACING)) {
            a.spacing = b[DNA.JWTProperty.SYN_LAYOUT_SPACING]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_TYPE)) {
            a.type = b[DNA.JWTProperty.SYN_TYPE]
        }
        return a
    },
    parserRowLayout: function(b) {
        var a = new DNA.widget.RowLayout();
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_TYPE)) {
            a.type = b[DNA.JWTProperty.SYN_TYPE]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_ROW_WRAP)) {
            a.wrap = b[DNA.JWTProperty.SYN_LAYOUT_ROW_WRAP]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_ROW_PACK)) {
            a.pack = b[DNA.JWTProperty.SYN_LAYOUT_ROW_PACK]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_ROW_JUSTIFY)) {
            a.justify = b[DNA.JWTProperty.SYN_LAYOUT_ROW_JUSTIFY]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_ROW_FILL)) {
            a.fill = b[DNA.JWTProperty.SYN_LAYOUT_ROW_FILL]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_MARGIN_LEFT)) {
            a.marginLeft = b[DNA.JWTProperty.SYN_LAYOUT_MARGIN_LEFT]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_MARGIN_TOP)) {
            a.marginTop = b[DNA.JWTProperty.SYN_LAYOUT_MARGIN_TOP]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_MARGIN_RIGHT)) {
            a.marginRight = b[DNA.JWTProperty.SYN_LAYOUT_MARGIN_RIGHT]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_MARGIN_BOTTOM)) {
            a.marginBottom = b[DNA.JWTProperty.SYN_LAYOUT_MARGIN_BOTTOM]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_SPACING)) {
            a.spacing = b[DNA.JWTProperty.SYN_LAYOUT_SPACING]
        }
        return a
    },
    parserGridLayout: function(b) {
        var a = new DNA.widget.GridLayout();
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_GRID_NUM_COLUMNS)) {
            a.numColumns = b[DNA.JWTProperty.SYN_LAYOUT_GRID_NUM_COLUMNS]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_GRID_MAKE_COLUMNS_EQUAL_WIDTH)) {
            a.makeColumnsEqualWidth = b[DNA.JWTProperty.SYN_LAYOUT_GRID_MAKE_COLUMNS_EQUAL_WIDTH]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_MARGIN_LEFT)) {
            a.marginLeft = b[DNA.JWTProperty.SYN_LAYOUT_MARGIN_LEFT]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_MARGIN_TOP)) {
            a.marginTop = b[DNA.JWTProperty.SYN_LAYOUT_MARGIN_TOP]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_MARGIN_RIGHT)) {
            a.marginRight = b[DNA.JWTProperty.SYN_LAYOUT_MARGIN_RIGHT]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_MARGIN_BOTTOM)) {
            a.marginBottom = b[DNA.JWTProperty.SYN_LAYOUT_MARGIN_BOTTOM]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_GRID_HORIZONTAL_SPACING)) {
            a.horizontalSpacing = b[DNA.JWTProperty.SYN_LAYOUT_GRID_HORIZONTAL_SPACING]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_GRID_VERTICAL_SPACING)) {
            a.verticalSpacing = b[DNA.JWTProperty.SYN_LAYOUT_GRID_VERTICAL_SPACING]
        }
        return a
    },
    parserBorderLayout: function(a) {
        var b = new DNA.widget.BorderLayout();
        if (a.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_MARGIN_HEIGHT)) {
            b.marginHeight = a[DNA.JWTProperty.SYN_LAYOUT_MARGIN_HEIGHT]
        }
        if (a.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_MARGIN_WIDTH)) {
            b.marginWidth = a[DNA.JWTProperty.SYN_LAYOUT_MARGIN_WIDTH]
        }
        if (a.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_BORDER_VGAP)) {
            b.vgap = a[DNA.JWTProperty.SYN_LAYOUT_BORDER_VGAP]
        }
        if (a.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_BORDER_HGAP)) {
            b.hgap = a[DNA.JWTProperty.SYN_LAYOUT_BORDER_HGAP]
        }
        return b
    },
    parserTableLayout: function(r, d) {
        var c = 0;
        var u = 0;
        var b = [];
        var p = [];
        var n = 0;
        var q = 0;
        var a;
        if (r.hasOwnProperty(DNA.JWTProperty.SYN_WIDTH)) {
            c = r[DNA.JWTProperty.SYN_WIDTH]
        }
        if (r.hasOwnProperty(DNA.JWTProperty.SYN_HEIGHT)) {
            u = r[DNA.JWTProperty.SYN_HEIGHT]
        }
        if (r.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_TABLE_COLUMN_COUNT)) {
            n = r[DNA.JWTProperty.SYN_LAYOUT_TABLE_COLUMN_COUNT]
        }
        if (r.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_TABLE_ROW_COUNT)) {
            q = r[DNA.JWTProperty.SYN_LAYOUT_TABLE_ROW_COUNT]
        }
        if (r.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_TABLE_COLUMN_WIDTHS)) {
            var m = r[DNA.JWTProperty.SYN_LAYOUT_TABLE_COLUMN_WIDTHS];
            for (var l = 0; l < n; l++) {
                b[l] = m[l]
            }
        }
        if (r.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_TABLE_ROW_HEIGHTS)) {
            var m = r[DNA.JWTProperty.SYN_LAYOUT_TABLE_ROW_HEIGHTS];
            for (var l = 0; l < q; l++) {
                p[l] = m[l]
            }
        }
        if (!d) {
            a = new DNA.widget.TableLayout(c,u,b,p)
        } else {
            a = new DNA.widget.TableLayoutExt(c,u,b,p)
        }
        if (r.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_TABLE_PIXEL_FIRST)) {
            a.pixelFirst = r[DNA.JWTProperty.SYN_LAYOUT_TABLE_PIXEL_FIRST]
        }
        if (r.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_TABLE_CELL_INFOS)) {
            var o = r[DNA.JWTProperty.SYN_LAYOUT_TABLE_CELL_INFOS];
            for (var l = 0; l < o.length; l++) {
                var t = o[l];
                for (var h = 0; h < t.length; h++) {
                    var s = t[h];
                    var g = new DNA.widget.TableCellInfo();
                    if (s.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_TABLE_CELL_COLUMN_SPAN)) {
                        g.columnSpan = s[DNA.JWTProperty.SYN_LAYOUT_TABLE_CELL_COLUMN_SPAN]
                    }
                    if (s.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_TABLE_CELL_ROW_SPAN)) {
                        g.rowSpan = s[DNA.JWTProperty.SYN_LAYOUT_TABLE_CELL_ROW_SPAN]
                    }
                    if (s.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_TABLE_CELL_IGNORE)) {
                        g.ignore = s[DNA.JWTProperty.SYN_LAYOUT_TABLE_CELL_IGNORE]
                    }
                    if (s.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_TABLE_CELL_IS_SPAN)) {
                        g.isSpan = s[DNA.JWTProperty.SYN_LAYOUT_TABLE_CELL_IS_SPAN]
                    }
                    a.cellInfos[l][h] = g
                }
            }
        }
        if (r.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_MARGIN_LEFT)) {
            a.marginLeft = r[DNA.JWTProperty.SYN_LAYOUT_MARGIN_LEFT]
        }
        if (r.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_MARGIN_TOP)) {
            a.marginTop = r[DNA.JWTProperty.SYN_LAYOUT_MARGIN_TOP]
        }
        if (r.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_MARGIN_RIGHT)) {
            a.marginRight = r[DNA.JWTProperty.SYN_LAYOUT_MARGIN_RIGHT]
        }
        if (r.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_MARGIN_BOTTOM)) {
            a.marginBottom = r[DNA.JWTProperty.SYN_LAYOUT_MARGIN_BOTTOM]
        }
        return a
    },
    parserRowData: function(b) {
        var a = new DNA.widget.RowData();
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_WIDTH)) {
            a.width = b[DNA.JWTProperty.SYN_WIDTH]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_HEIGHT)) {
            a.height = b[DNA.JWTProperty.SYN_HEIGHT]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_ALIGNMENT)) {
            a.alignment = b[DNA.JWTProperty.SYN_ALIGNMENT]
        }
        return a
    },
    parserGridData: function(b) {
        var a = new DNA.widget.GridData();
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_GRID_DATA_HORIZONTAL_ALIGNMENT)) {
            a.horizontalAlignment = b[DNA.JWTProperty.SYN_LAYOUT_GRID_DATA_HORIZONTAL_ALIGNMENT]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_GRID_DATA_VERTICAL_ALIGNMENT)) {
            a.verticalAlignment = b[DNA.JWTProperty.SYN_LAYOUT_GRID_DATA_VERTICAL_ALIGNMENT]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_GRID_DATA_HORIZONTAL_INDENT)) {
            a.horizontalIndent = b[DNA.JWTProperty.SYN_LAYOUT_GRID_DATA_HORIZONTAL_INDENT]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_GRID_DATA_HORIZONTAL_SPAN)) {
            a.horizontalSpan = b[DNA.JWTProperty.SYN_LAYOUT_GRID_DATA_HORIZONTAL_SPAN]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_GRID_DATA_VERTICAL_INDENT)) {
            a.verticalIndent = b[DNA.JWTProperty.SYN_LAYOUT_GRID_DATA_VERTICAL_INDENT]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_GRID_DATA_VERTICAL_SPAN)) {
            a.verticalSpan = b[DNA.JWTProperty.SYN_LAYOUT_GRID_DATA_VERTICAL_SPAN]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_WIDTH)) {
            a.widthHint = b[DNA.JWTProperty.SYN_WIDTH]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_HEIGHT)) {
            a.heightHint = b[DNA.JWTProperty.SYN_HEIGHT]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_GRID_DATA_GRAD_EXCESS_HORIZONTAL_SPACE)) {
            a.grabExcessHorizontalSpace = b[DNA.JWTProperty.SYN_LAYOUT_GRID_DATA_GRAD_EXCESS_HORIZONTAL_SPACE]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_GRID_DATA_GRAD_EXCESS_VERTICAL_SPACE)) {
            a.grabExcessVerticalSpace = b[DNA.JWTProperty.SYN_LAYOUT_GRID_DATA_GRAD_EXCESS_VERTICAL_SPACE]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_GRID_DATA_MINIMUM_WIDTH)) {
            a.minimumWidth = b[DNA.JWTProperty.SYN_LAYOUT_GRID_DATA_MINIMUM_WIDTH]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_GRID_DATA_MINIMUM_HEIGHT)) {
            a.minimumHeight = b[DNA.JWTProperty.SYN_LAYOUT_GRID_DATA_MINIMUM_HEIGHT]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_EXCLUDE)) {
            a.exclude = b[DNA.JWTProperty.SYN_LAYOUT_EXCLUDE]
        }
        return a
    },
    parserBorderData: function(b) {
        var a = new DNA.widget.BorderData();
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_BORDER_DATA_POSITION)) {
            a.position = b[DNA.JWTProperty.SYN_LAYOUT_BORDER_DATA_POSITION]
        }
        return a
    },
    parserTableData: function(b) {
        var a = new DNA.widget.TableData();
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_WIDTH)) {
            a.width = b[DNA.JWTProperty.SYN_WIDTH]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_HEIGHT)) {
            a.height = b[DNA.JWTProperty.SYN_HEIGHT]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_TABLE_DATA_HORIZONTAL_ALIGNMENT)) {
            a.horizontalAlignment = b[DNA.JWTProperty.SYN_LAYOUT_TABLE_DATA_HORIZONTAL_ALIGNMENT]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_TABLE_DATA_HORIZONTAL_INDENT)) {
            a.horizontalIndent = b[DNA.JWTProperty.SYN_LAYOUT_TABLE_DATA_HORIZONTAL_INDENT]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_TABLE_DATA_VERTICAL_ALIGNMENT)) {
            a.verticalAlignment = b[DNA.JWTProperty.SYN_LAYOUT_TABLE_DATA_VERTICAL_ALIGNMENT]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_TABLE_DATA_VERTICAL_INDENT)) {
            a.verticalIndent = b[DNA.JWTProperty.SYN_LAYOUT_TABLE_DATA_VERTICAL_INDENT]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_LAYOUT_EXCLUDE)) {
            a.exclude = b[DNA.JWTProperty.SYN_LAYOUT_EXCLUDE]
        }
        return a
    },
    parserRectangle: function(b) {
        var a = new DNA.widget.Rectangle();
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_X)) {
            a.x = b[DNA.JWTProperty.SYN_X]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_Y)) {
            a.y = b[DNA.JWTProperty.SYN_Y]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_WIDTH)) {
            a.width = b[DNA.JWTProperty.SYN_WIDTH]
        }
        if (b.hasOwnProperty(DNA.JWTProperty.SYN_HEIGHT)) {
            a.height = b[DNA.JWTProperty.SYN_HEIGHT]
        }
        return a
    },
    parseImg: function(a) {
        var b = null ;
        if (a !== "") {
            b = new DNA.widget.ImageDescriptor(a[DNA.JWTProperty.SYN_WIDTH],a[DNA.JWTProperty.SYN_HEIGHT],a[DNA.JWTProperty.SYN_ID])
        }
        return b
    },
    parseBorder: function(b) {
        var a = null ;
        if (b !== "") {
            a = new DNA.widget.Border();
            if (b.hasOwnProperty(DNA.JWTProperty.SYN_BORDER_THICK)) {
                a.size = b[DNA.JWTProperty.SYN_BORDER_THICK]
            }
            if (b.hasOwnProperty(DNA.JWTProperty.SYN_COLOR)) {
                a.color = this._parseColor(b[DNA.JWTProperty.SYN_COLOR])
            }
            if (b.hasOwnProperty(DNA.JWTProperty.SYN_STYLE)) {
                a.lineStyle = DNA.JWT.BORDER_STYLE_ARRAY[b[DNA.JWTProperty.SYN_STYLE]]
            }
        }
        return a
    },
    parseImgBorder: function(b) {
        var a = null ;
        if (b != "") {
            a = new DNA.widget.ImageBorder(b)
        }
        return a
    },
    _parseColor: function(b) {
        if (b === "") {
            return null 
        }
        var c = b.toString(16);
        var a = c.length;
        while (a < 6) {
            c = "0" + c;
            a++
        }
        return "#" + c
    },
    parserCssStyle: function(h) {
        var g = {};
        for (var c = 0, a = h.length; c < a; c++) {
            var m = h[c];
            var l = m[DNA.JWTProperty.SYN_ID];
            var d = m[DNA.JWTProperty.SYN_TYPE];
            var b = m[DNA.JWTProperty.SYN_VALUE];
            if (!b && b !== 0) {
                continue
            }
            switch (d) {
            case 0:
                g[l] = this._parseColor(b);
                break;
            case 1:
                g[l] = new DNA.widget.Font(b[DNA.JWTProperty.SYN_NAME],b[DNA.JWTProperty.SYN_SIZE],b[DNA.JWTProperty.SYN_STYLE]);
                break;
            case 2:
                g[l] = new DNA.widget.Border();
                if (b.hasOwnProperty(DNA.JWTProperty.SYN_BORDER_THICK)) {
                    g[l].size = b[DNA.JWTProperty.SYN_BORDER_THICK]
                }
                if (b.hasOwnProperty(DNA.JWTProperty.SYN_COLOR)) {
                    g[l].color = this._parseColor(b[DNA.JWTProperty.SYN_COLOR])
                }
                if (b.hasOwnProperty(DNA.JWTProperty.SYN_STYLE)) {
                    g[l].lineStyle = DNA.JWT.BORDER_STYLE_ARRAY[b[DNA.JWTProperty.SYN_STYLE]]
                }
                break;
            case 3:
                b = new DNA.widget.ImageDescriptor(b[DNA.JWTProperty.SYN_WIDTH],b[DNA.JWTProperty.SYN_HEIGHT],b[DNA.JWTProperty.SYN_ID]);
                g[l] = b;
                break;
            case 4:
                g[l] = DNA.JWT.CURSOR_ARRAY[b];
                break;
            case 5:
                break
            }
        }
        return g
    }
};
DNA.widget.ConfirmTools = {
    confirmBorder: function(a) {
        if ((typeof (a.tk) === "number") && (typeof (a.color) === "number") && (typeof (a.st) === "number")) {
            return true
        }
        return false
    },
    confirmImage: function(d) {
        var c = d.hasOwnProperty("id") && typeof (d.id) === "string";
        var b = d.hasOwnProperty("width") && typeof (d.width) === "number";
        var a = d.hasOwnProperty("height") && typeof (d.height) === "number";
        if (c && b && a) {
            return true
        }
        return false
    },
    confirmFont: function(a) {
        var c = a.hasOwnProperty("family") && typeof (a.family) === "string";
        var b = a.hasOwnProperty("size") && typeof (a.size) === "number";
        var d = a.style && typeof (a.style) === "string";
        if (c && b && d) {
            return true
        }
        return false
    }
};
DNA.widget.BehaviourListener = {
    _focusAction: new DNA.engine.Action({
        handle: function(b) {
            var a = b.getSrcControl();
            if (a.isNormalMode()) {
                this._setActived(a)
            }
        }
    }),
    _blurAction: new DNA.engine.Action({
        handle: function(b) {
            var a = b.getSrcControl();
            if (a.isNormalMode()) {
                this._setDeActived(a)
            }
        }
    }),
    _hoverAction: new DNA.engine.Action({
        handle: function(b) {
            var a = b.getSrcControl();
            if (a.isNormalMode()) {
                this._setHovered(a)
            }
        }
    }),
    _unhoverAction: new DNA.engine.Action({
        handle: function(b) {
            var a = b.getSrcControl();
            if (a.isNormalMode()) {
                this._setUnHovered(a)
            }
        }
    }),
    _setHovered: function(a) {
        if (a == null  || a.isDisposed()) {
            return
        }
        a._setHoveredState(true);
        if (a.isNormalMode() && !a._isActivedState()) {
            DNA.widget.CssStyleFinder.updateCss(a)
        }
    },
    _setUnHovered: function(a) {
        if (a == null  || a.isDisposed()) {
            return
        }
        a._setHoveredState(false);
        if (a.isNormalMode() && !a._isActivedState()) {
            DNA.widget.CssStyleFinder.updateCss(a)
        }
    },
    _setActived: function(a) {
        if (a == null  || a.isDisposed()) {
            return
        }
        a._setActivedState(true);
        if (a.isNormalMode()) {
            DNA.widget.CssStyleFinder.updateCss(a)
        }
    },
    _setDeActived: function(a) {
        if (a == null  || a.isDisposed()) {
            return
        }
        a._setActivedState(false);
        if (a.isNormalMode()) {
            DNA.widget.CssStyleFinder.updateCss(a)
        }
    },
    start: function(a) {
        a.addListener(DNA.JWTEvent.FOCUS, this._focusAction, this);
        a.addListener(DNA.JWTEvent.BLUR, this._blurAction, this);
        a.addListener(DNA.JWTEvent.MOUSEOVER, this._hoverAction, this);
        a.addListener(DNA.JWTEvent.MOUSEOUT, this._unhoverAction, this)
    }
};
DNA.widget.CloseNotifyProcessor = {
    _markMap: {},
    _isUnloadFunActive: true,
    start: function(a) {
        a.handleSelfEvent(this, "beforeunload", window);
        a.addListener("beforeunload", this._onbeforeunloadFun, this);
        a.handleSelfEvent(this, "unload", window)
    },
    activateUnloadFun: function() {
        this._isUnloadFunActive = true
    },
    forbiddenUnloadFun: function() {
        this._isUnloadFunActive = false
    },
    _haveMarkInfo: function() {
        for (var a in this._markMap) {
            return true
        }
        return false
    },
    handleMarkInfo: function(g) {
        var c = g.split(";/");
        for (var b = 0, a = c.length; b < a; b++) {
            var d = c[b].split(",/");
            this._markMap[d[0]] = d[1]
        }
    },
    handleRemoveInfo: function(d) {
        var c = d.split(",/");
        for (var b = 0, a = c.length; b < a; b++) {
            delete this._markMap[c[b]]
        }
    },
    _onbeforeunloadFun: new DNA.engine.Action({
        handle: function(g) {
            if (this._haveMarkInfo() && this._isUnloadFunActive) {
                var d = [];
                for (var b in this._markMap) {
                    if (b) {
                        var h = DNA.widget.WidgetRegistry.get(b);
                        if (!h || h.isDisposed()) {
                            delete this._markMap[b]
                        } else {
                            d.push(this._markMap[b])
                        }
                    }
                }
                if (d.length != 0) {
                    var a = d.join("\n    ��");
                    g.getOriginalEvent().returnValue = "    ��" + a
                }
            }
        }
    })
};
DNA.widget.ShellResizeHandler = {
    start: function(a) {
        this._doInFinalTask = false;
        this._registEvents(a)
    },
    _registEvents: function(a) {
        a.addListener("resize", this.resizeAction, this)
    },
    resizeAction: new DNA.engine.AppSuspendedAction({
        handle: function() {
            this.doResize();
            if (DNA.engine.application.isSuspend()) {
                if (!this._doInFinalTask) {
                    this._doInFinalTask = true;
                    DNA.adapter.browserPage.addFinalTask([this.doResizeAndRecord, this])
                }
            }
        }
    }),
    doResizeAndRecord: function() {
        DNA.engine.application.setForceLayoutAll(true);
        this.doResize();
        DNA.engine.application.setForceLayoutAll(false);
        this._doInFinalTask = false
    },
    doResize: function() {
        var b = DNA.engine.DomUtil.getViewSize();
        var a = DNA.engine.application.getShell();
        if (!a) {
            return
        }
        var c = a.getBounds();
        if (!DNA.engine.application.isForceLayoutAll() && (b.width == c.width && b.height == c.height)) {
            return
        }
        a.setSize(b.width, b.height)
    }
};
DNA.widget.DragListener = {
    start: function(a) {
        a.addListener(DNA.JWTEvent.MOUSEDOWN, this._dragMouseDownAction, this);
        a.addListener(DNA.JWTEvent.MOUSEMOVE, this._dragMouseMoveAction, this);
        a.addListener(DNA.JWTEvent.MOUSEUP, this._dragMouseUpAction, this)
    },
    getSnapshotEl: function() {
        if (!this._dragEl) {
            if (DNA.engine.Client.isIE()) {
                this._dragEl = DNA.engine.DomUtil.append(DNA.engine.application.getBrowserBody(), "<div class='drag-snapshot' style='position:absolute;overflow:hidden;z-index:999999;display:none'><div style='overflow:hidden;LEFT: 0px; WIDTH: 100%; 	POSITION: absolute; 	TOP: 0px;HEIGHT: 100%'></div><IFRAME frameborder=0 src='#' style='Z-INDEX: -1;LEFT: 0px;	WIDTH: 100%;POSITION: absolute;filter: alpha(opacity = 0);TOP: 0px;HEIGHT: 100%'></IFRAME></div>")
            } else {
                this._dragEl = DNA.engine.DomUtil.append(DNA.engine.application.getBrowserBody(), "<div class='drag-snapshot' style='position:absolute;overflow:hidden;z-index:999999;display:none'></div>")
            }
        }
        return this._dragEl
    },
    _dragMouseDownAction: new DNA.engine.Action({
        handle: function(b) {
            if (b.getButton() == DNA.JWT.BUTTON_RIGHT) {
                return
            }
            var a = this._dragger;
            var h = b.getSrcControl();
            if (h && h.getDragger) {
                var g = this._dragger = h.getDragger(b);
                if (g) {
                    g.dragStart(b)
                }
            }
            if (this._dragEl && this._dragEl.style.display != "none" && this._dragger == null  && a) {
                a.dragEnd(b)
            }
        }
    }),
    _dragMouseMoveAction: new DNA.engine.Action({
        handle: function(a) {
            if (this._dragger) {
                a.preventDefault();
                if (DNA.engine.Client.isIE() && a.getButton() === -1) {
                    this._dragger.dragFail(a);
                    this._dragger = null ;
                    delete this._dragger
                } else {
                    if (this._dragger.acceptMove(a)) {
                        this._dragger.dragMove(a)
                    }
                }
            }
        }
    }),
    _dragMouseUpAction: new DNA.engine.Action({
        handle: function(d) {
            if (this._dragger) {
                if (DNA.engine.Client.isIE()) {
                    this._dragger.dragEnd(d)
                } else {
                    var b = DNA.engine.DomUtil.getViewSize();
                    var c = d.getXY();
                    var a = c.x
                      , g = c.y;
                    if (a < 0 || g < 0 || a > b.width || g > b.height) {
                        this._dragger.dragFail(d)
                    } else {
                        this._dragger.dragEnd(d)
                    }
                }
                delete this._dragger
            }
        }
    }),
    reset: function() {
        delete this._dragger
    }
};
DNA.widget.Dragger = function() {}
;
DNA.widget.Dragger.extend(DNA.engine.JWTObject, {
    acceptMove: function(a) {
        return this._acceptmove ? true : this._acceptmove = (a.getXY().x != this.getStartXY().x || a.getXY().y != this.getStartXY().y)
    },
    dragStart: function(a) {
        this._startXY = a.getXY();
        var b = a.getSrcControl();
        this._dragControl = b
    },
    getStartXY: function() {
        return this._startXY
    },
    dragMove: function(a) {
        this.initDragMove(a)
    },
    initDragMove: function(a) {
        if (!this._startBox) {
            this._startBox = this._dragControl._getPageBounds()
        }
        this._showSnapshot(this._startBox)
    },
    getDragSrcControl: function() {
        return this._dragControl
    },
    setStartBox: function(a) {
        this._startBox = a
    },
    getStartBox: function() {
        return this._startBox
    },
    dragEnd: function(a) {
        this._resetSnapshot();
        this.disposeFileds()
    },
    dragFail: function(a) {
        this._resetSnapshot();
        this.disposeFileds()
    },
    disposeFileds: function() {
        delete this._startXY;
        delete this._startBox;
        delete this._dragControl;
        delete this._snapshot;
        delete this._acceptmove
    },
    _showSnapshot: function(b) {
        var a = this._snapshot = DNA.widget.DragListener.getSnapshotEl();
        if (DNA.engine.Client.isIE() && !DNA.engine.Client.isStrict()) {
            DNA.engine.DomUtil.setStyle(a.firstChild, "border-style", "dotted");
            DNA.engine.DomUtil.setStyle(a.firstChild, "border-color", "#000000");
            DNA.engine.DomUtil.setStyle(a.firstChild, "border-width", "1px")
        } else {
            DNA.engine.DomUtil.setStyle(a, "border-style", "dotted");
            DNA.engine.DomUtil.setStyle(a, "border-color", "#000000");
            DNA.engine.DomUtil.setStyle(a, "border-width", "1px")
        }
        DNA.engine.DomUtil.setVisible(a, true);
        DNA.engine.DomUtil.setSize(a, {
            width: b.width,
            height: b.height
        });
        DNA.engine.DomUtil.setLeftTop(a, b.x, b.y);
        DNA.engine.DomUtil.setStyle(a, "z-index", b.ZIndex || 9999999)
    },
    _resetSnapshot: function() {
        var a = this._snapshot;
        if (a) {
            if (DNA.engine.Client.isIE() && !DNA.engine.Client.isStrict()) {
                DNA.engine.DomUtil.setStyle(a.firstChild, "border-style", "");
                DNA.engine.DomUtil.setStyle(a.firstChild, "border-color", "");
                DNA.engine.DomUtil.setStyle(a.firstChild, "border-width", "")
            } else {
                DNA.engine.DomUtil.setStyle(a, "border-style", "");
                DNA.engine.DomUtil.setStyle(a, "border-color", "");
                DNA.engine.DomUtil.setStyle(a, "border-width", "")
            }
            DNA.engine.DomUtil.setLeftTop(a, 0, 0);
            DNA.engine.DomUtil.setSize(a, {
                width: 0,
                height: 0
            });
            DNA.engine.DomUtil.setVisible(a, false)
        }
    }
});
DNA.widget.DragMove = function(a) {}
;
DNA.widget.DragMove.extend(DNA.widget.Dragger, {
    dragMove: function(d) {
        if (!this._snapshot) {
            DNA.widget.DragMove.superclass.dragMove.call(this, d)
        } else {
            var h = this.getStartBox();
            var b = d.getXY();
            if (b.x >= 0 && b.x <= document.body.offsetWidth && b.y >= 0 && b.y <= document.body.offsetHeight) {
                var c = this.getStartXY();
                var a = b.x - c.x + h.x;
                var g = b.y - c.y + h.y;
                g = g >= 0 ? g : 0;
                DNA.engine.DomUtil.setLeftTop(this._snapshot, a, g)
            }
        }
    },
    getMoveDeltaX: function(c) {
        var a = c.getXY();
        var b = this.getStartXY();
        return a.x - b.x
    },
    getMoveDeltaY: function(c) {
        var a = c.getXY();
        var b = this.getStartXY();
        return a.y - b.y
    },
    dragEnd: function(b) {
        if (this._snapshot) {
            var a = DNA.engine.DomUtil.getPageXY(this._snapshot);
            this.getDragSrcControl()._setPageXY(a)
        }
        DNA.widget.DragMove.superclass.dragEnd.call(this, b)
    }
});
DNA.widget.DragDrop = function(a) {
    this.doit = true
}
;
DNA.widget.DragDrop.extend(DNA.widget.DragMove, {
    _getTargets: function(b) {
        var a = DNA.widget.DragDrop.getTargets(b);
        return a
    },
    _findTarget: function(n, l) {
        var h = this._targets;
        if (h) {
            var d = null ;
            for (var g = 0, c = h.length; g < c; g++) {
                var a = h[g];
                if (a.isDropTargetEnabled && !a.isDropTargetEnabled()) {
                    continue
                }
                if ((!a.isDisposed || (a.isDisposed && !a.isDisposed())) && a.checkRendered(true) && DNA.engine.DomUtil.contains(a._getPageBounds(), n) && a.isEnabled() === true && a.isVisible() === true || l.id == a.getEid()) {
                    if (!d) {
                        d = a
                    } else {
                        if (d && a.serialNumber >= d.serialNumber) {
                            d = a
                        }
                    }
                }
            }
            return d
        }
        return null 
    },
    dragStart: function(c) {
        DNA.widget.DragDrop.superclass.dragStart.call(this, c);
        var b = c.getXY();
        var a = DNA.engine.DomUtil.getPageXY(this._dragControl.getEl());
        a = {
            x: b.x - a.x,
            y: b.y - a.y
        };
        this._dragSourcePos = a.x + "," + a.y;
        if (DNA.engine.Client.isChrome()) {
            c._preventDefault()
        }
    },
    dragMove: function(g) {
        if (!this._snapshot) {
            g.doit = true;
            this._dragControl.fireEvent("dragstart", [g]);
            this.doit = g.doit;
            if (!this.doit) {
                return
            }
            var d = g.getXY();
            this.setStartBox({
                x: d.x + 10,
                y: d.y + 20,
                width: 16,
                height: 16
            });
            DNA.widget.DragMove.superclass.dragMove.call(this, g);
            this._dragControl.dragSourcePos = this._dragSourcePos;
            this._targets = this._getTargets(this._dragControl.getDragHandler())
        } else {
            g.doit = this.doit;
            var c = g.getXY();
            this._moveSnapshot(c);
            var a = this._findTarget(c, g.getSrcElement());
            var b = "dropno";
            if (a) {
                if (this._readyTarget && a !== this._readyTarget) {
                    this._fireDragOutEvent(g)
                }
                a.fireEvent(DNA.JWTEvent.DRAGOVER, [g]);
                this._readyTarget = a;
                if (g.doit === true) {
                    b = "dropyes"
                } else {
                    this._fireDragOutEvent(g)
                }
            } else {
                if (this._readyTarget) {
                    this._fireDragOutEvent(g)
                } else {
                    this._dragControl.fireEvent(DNA.JWTEvent.DRAGMOVE, [g])
                }
            }
            this._changeActionCss(b)
        }
    },
    _fireDragOutEvent: function(a) {
        this._readyTarget.fireEvent(DNA.JWTEvent.DRAGOUT, [a]);
        this._readyTarget.posInfo = null ;
        this._readyTarget = null 
    },
    dragEnd: function(c) {
        if (this._readyTarget) {
            var b = c.getXY();
            var a = DNA.engine.DomUtil.getPageXY(this._readyTarget.getEl());
            a = {
                x: b.x - a.x,
                y: b.y - a.y
            };
            this._readyTarget.fireEvent(DNA.JWTEvent.DRAGDROP, [this._dragControl, this._readyTarget, (a.x + "," + a.y)])
        }
        delete this._dragSourcePos;
        if (this._readyTarget) {
            delete this._readyTarget
        }
        if (this._targets) {
            delete this._targets
        }
        if (this._dragControl) {
            this._dragControl.fireEvent("dragend", [c])
        }
        DNA.widget.DragMove.superclass.dragEnd.call(this, c)
    },
    dragFail: function(a) {
        delete this._dragSourcePos;
        if (this._readyTarget) {
            delete this._readyTarget
        }
        if (this._targets) {
            delete this._targets
        }
        DNA.widget.DragMove.superclass.dragEnd.call(this, a)
    },
    _moveSnapshot: function(b) {
        var a = Object.clone(b);
        a.x += 10;
        a.y += 20;
        DNA.engine.DomUtil.setLeftTop(this._snapshot, a.x, a.y)
    },
    _showSnapshot: function(a) {
        this._snapshot = DNA.widget.DragListener.getSnapshotEl();
        DNA.engine.DomUtil.setVisible(this._snapshot, true);
        DNA.engine.DomUtil.setSize(this._snapshot, {
            width: a.width,
            height: a.height
        });
        DNA.engine.DomUtil.setLeftTop(this._snapshot, a.x, a.y)
    },
    _resetSnapshot: function() {
        var a = this._snapshot;
        if (a) {
            DNA.engine.DomUtil.setLeftTop(this._snapshot, 0, 0);
            DNA.engine.DomUtil.setSize(this._snapshot, {
                width: 0,
                height: 0
            });
            DNA.engine.DomUtil.setVisible(this._snapshot, false);
            DNA.engine.DomUtil.removeClass(this._snapshot)
        }
    },
    _changeActionCss: function(a) {
        DNA.engine.DomUtil.removeClass(this._snapshot);
        DNA.engine.DomUtil.addClass(this._snapshot, a);
        DNA.engine.DomUtil.setStyle(this._snapshot, "z-index", DNA.engine.application.getTopWindowZIndexAnd1())
    }
});
Object.override(DNA.widget.DragDrop, {
    dragTargets: new DNA.engine.Map(),
    registerTarget: function(c) {
        var b = c.getDropHandler();
        var a = this.dragTargets.get(b);
        if (!a) {
            a = new Array();
            this.dragTargets.set(b, a)
        }
        a.push(c)
    },
    getTargets: function(g) {
        var l = new Array();
        var o = this.dragTargets.getKeys();
        var m = o.length;
        for (var d = 0; d < m; ++d) {
            var n = o[d];
            if (n.indexOf(g) != -1) {
                var b = this.dragTargets.get(n);
                if (b) {
                    var a = b.length;
                    for (var c = 0; c < a; ++c) {
                        l.push(b[c])
                    }
                }
            }
        }
        return l
    },
    removeTarget: function(c) {
        var b = c.getDropHandler();
        if (b) {
            var a = this.dragTargets.get(b);
            if (a) {
                a.remove(c);
                if (a.length == 0) {
                    this.dragTargets.remove(b)
                }
            }
        }
    }
});
DNA.widget.DragResize = function(a, b) {
    this._direction = a;
    this._startBox = b
}
;
DNA.widget.DragResize.extend(DNA.widget.Dragger, {
    _minWidth: 10,
    _minHeight: 10,
    dragMove: function(b) {
        var g = this.getDragSrcControl();
        if (this._direction && (!this._snapshot)) {
            DNA.widget.DragResize.superclass.dragMove.call(this, b);
            this._startBox.ZIndex = g._zIndex ? g._zIndex + 1 : 999999;
            this._srcMinWidth = g._getMinWidth ? g._getMinWidth() : this._minWidth;
            this._srcMinHeight = g._getMinHeight ? g._getMinHeight() : this._minHeight;
            DNA.engine.DomUtil.setStyle(this._snapshot, "cursor", this._direction)
        } else {
            if (this._direction) {
                var a = b.getXY();
                if (this._direction == DNA.JWT.DIRECTION.EAST) {
                    var l = this._startXY.x - a.x;
                    var d = this._startBox.width - l;
                    if (d >= (this._srcMinWidth)) {
                        DNA.engine.DomUtil.setWidth(this._snapshot, d)
                    }
                } else {
                    if (this._direction == DNA.JWT.DIRECTION.SOUTH) {
                        var o = this._startXY.y - a.y;
                        var m = this._startBox.height - o;
                        if (m >= (this._srcMinHeight)) {
                            DNA.engine.DomUtil.setHeight(this._snapshot, m)
                        }
                    } else {
                        if (this._direction == DNA.JWT.DIRECTION.EASTSOUTH) {
                            var l = this._startXY.x - a.x;
                            var d = this._startBox.width - l;
                            if (d >= (this._srcMinWidth)) {
                                DNA.engine.DomUtil.setWidth(this._snapshot, d)
                            }
                            var o = this._startXY.y - a.y;
                            var m = this._startBox.height - o;
                            if (m >= (this._srcMinHeight)) {
                                DNA.engine.DomUtil.setHeight(this._snapshot, m)
                            }
                        } else {
                            if (this._direction == DNA.JWT.DIRECTION.WESTSOUTH) {
                                var l = this._startXY.x - a.x;
                                var d = this._startBox.width + l;
                                if (d >= (this._srcMinWidth)) {
                                    DNA.engine.DomUtil.setWidth(this._snapshot, d);
                                    DNA.engine.DomUtil.setLeftTop(this._snapshot, this._startBox.x - l, this._startBox.y)
                                }
                                var o = this._startXY.y - a.y;
                                var m = this._startBox.height - o;
                                if (m >= (this._srcMinHeight)) {
                                    DNA.engine.DomUtil.setHeight(this._snapshot, m)
                                }
                            } else {
                                if (this._direction == DNA.JWT.DIRECTION.WEST) {
                                    var l = this._startXY.x - a.x;
                                    var d = this._startBox.width + l;
                                    if (d >= (this._srcMinWidth)) {
                                        DNA.engine.DomUtil.setWidth(this._snapshot, d);
                                        DNA.engine.DomUtil.setLeftTop(this._snapshot, this._startBox.x - l, this._startBox.y)
                                    }
                                } else {
                                    if (this._direction == DNA.JWT.DIRECTION.NORTH) {
                                        var o = this._startXY.y - a.y;
                                        var m = this._startBox.height + o;
                                        if (m >= (this._srcMinHeight)) {
                                            DNA.engine.DomUtil.setHeight(this._snapshot, m);
                                            DNA.engine.DomUtil.setLeftTop(this._snapshot, this._startBox.x, a.y)
                                        }
                                    } else {
                                        if (this._direction == DNA.JWT.DIRECTION.WESTNORTH) {
                                            var l = this._startXY.x - a.x;
                                            var d = this._startBox.width + l;
                                            var n = this._startBox.x - l;
                                            if (d >= (this._srcMinWidth)) {
                                                DNA.engine.DomUtil.setWidth(this._snapshot, d)
                                            } else {
                                                n = parseInt(DNA.engine.DomUtil.getStyle(this._snapshot, "left"))
                                            }
                                            var o = this._startXY.y - a.y;
                                            var m = this._startBox.height + o;
                                            var h = this._startBox.y - o;
                                            if (m >= (this._srcMinHeight)) {
                                                DNA.engine.DomUtil.setHeight(this._snapshot, m)
                                            } else {
                                                h = parseInt(DNA.engine.DomUtil.getStyle(this._snapshot, "top"))
                                            }
                                            DNA.engine.DomUtil.setLeftTop(this._snapshot, n, h)
                                        } else {
                                            if (this._direction == DNA.JWT.DIRECTION.EASTNORTH) {
                                                var l = this._startXY.x - a.x;
                                                var d = this._startBox.width - l;
                                                if (d >= (this._srcMinWidth)) {
                                                    DNA.engine.DomUtil.setWidth(this._snapshot, d)
                                                }
                                                var o = this._startXY.y - a.y;
                                                var m = this._startBox.height + o;
                                                if (m >= (this._srcMinHeight)) {
                                                    DNA.engine.DomUtil.setHeight(this._snapshot, m);
                                                    DNA.engine.DomUtil.setLeftTop(this._snapshot, this._startBox.x, this._startBox.y - o)
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    },
    dragEnd: function(b) {
        if (this._snapshot) {
            var c = DNA.engine.DomUtil.getPageXY(this._snapshot);
            var a = DNA.engine.DomUtil.getSize(this._snapshot);
            c.width = a.width;
            c.height = a.height;
            this._dragControl.fireEvent(DNA.JWTEvent.DRAGRESIZEEND, [c]);
            DNA.engine.DomUtil.setStyle(this._snapshot, "cursor", "default")
        }
        DNA.widget.DragResize.superclass.dragEnd.call(this, b)
    },
    disposeFileds: function() {
        DNA.widget.DragResize.superclass.disposeFileds.call(this);
        delete this._direction;
        delete this._srcMinWidth;
        delete this._srcMinHeight
    }
});
DNA.widget.DragSplit = function(c, b, a, d) {
    this.dragDir = c;
    this.startFirstSize = b;
    this.startLastSize = a;
    this.setStartBox(d)
}
;
DNA.widget.DragSplit._dir_h = 1;
DNA.widget.DragSplit._dir_v = 2;
DNA.widget.DragSplit.extend(DNA.widget.DragMove, {
    _minSize: 10,
    dragStart: function(a) {
        DNA.widget.DragSplit.superclass.dragStart(a);
        this.setShimVisible(true)
    },
    dragMove: function(l) {
        if (!this._snapshot) {
            this._lastPoint = this.getStartXY();
            DNA.widget.DragMove.superclass.dragMove.call(this, l)
        } else {
            var g = l.getXY();
            var m = this.getStartBox();
            if (this.dragDir == DNA.widget.DragSplit._dir_h) {
                var h = this.getMoveDeltaX(l);
                var b = this.startFirstSize;
                b += h;
                var a = this.startLastSize;
                a -= h;
                if ((h < 0 && b <= this._minSize) || (h > 0 && a <= this._minSize)) {
                    this._stopDrag(this._lastPoint, l)
                } else {
                    DNA.engine.DomUtil.setLeftTop(this._snapshot, m.x + h, m.y);
                    this._lastPoint = g
                }
            } else {
                var h = this.getMoveDeltaY(l);
                var d = this.startFirstSize;
                d += h;
                var c = this.startLastSize;
                c -= h;
                if ((h < 0 && d <= this._minSize) || (h > 0 && c <= this._minSize)) {
                    this._stopDrag(this._lastPoint, l)
                } else {
                    DNA.engine.DomUtil.setLeftTop(this._snapshot, m.x, m.y + h);
                    this._lastPoint = g
                }
            }
        }
    },
    _stopDrag: function(b, m) {
        var l = this.getStartXY();
        if (this.dragDir == DNA.widget.DragSplit._dir_h) {
            var h = b.x - l.x;
            var c = this.startFirstSize;
            c += h;
            var a = this.startLastSize;
            a -= h;
            this.getDragSrcControl()._split(m, c, a)
        } else {
            var h = b.y - l.y;
            var g = this.startFirstSize;
            g += h;
            var d = this.startLastSize;
            d -= h;
            this.getDragSrcControl()._split(m, g, d)
        }
        this.setShimVisible(false);
        DNA.widget.DragMove.superclass.dragEnd.call(this, m)
    },
    disposeFileds: function() {
        DNA.widget.DragListener.reset();
        delete this.dragDir;
        delete this.startFirstSize;
        delete this.startLastSize;
        delete this._lastPoint;
        DNA.widget.DragMove.superclass.disposeFileds.call(this)
    },
    setShimVisible: function(a) {
        var c = this.getDragSrcControl().getShim();
        var b;
        if (c) {
            b = a ? "" : "none";
            DNA.engine.DomUtil.setStyle(c, "display", b)
        }
    },
    dragEnd: function(a) {
        if (this.dragDir) {
            this._stopDrag(a.getXY(), a)
        }
    },
    dragFail: function(a) {
        this.setShimVisible(false);
        DNA.widget.DragMove.superclass.dragFail.call(this)
    }
});
DNA.widget.Point = function(a, b) {
    DNA.widget.Point.superclass.constructor.call(this);
    if (a) {
        this.x = a
    }
    if (b) {
        this.y = b
    }
}
;
DNA.widget.Point.extend(DNA.engine.JWTObject, {
    x: 0,
    y: 0
});
DNA.widget.Font = function(a, b, c) {
    if (a) {
        this.setFamily(a)
    }
    if (b) {
        this.setSize(b)
    }
    if (c) {
        this.setStyle(c)
    }
}
;
Object.override(DNA.widget.Font.prototype, {
    decoration: "none",
    family: "����",
    style: "normal",
    weight: "normal",
    size: 9,
    setDecoration: function(a) {
        this.decoration = a
    },
    getDecoration: function() {
        return this.decoration
    },
    setFamily: function(a) {
        this.family = a
    },
    getFamily: function() {
        return this.family
    },
    setStyle: function(a) {
        if ((a & DNA.JWT.FONT_STYLE_PLAIN) != 0) {
            this.style = "normal"
        }
        if ((a & DNA.JWT.FONT_STYLE_BOLD) != 0) {
            this.setWeight("bold")
        }
        if ((a & DNA.JWT.FONT_STYLE_ITALIC) != 0) {
            this.style = "italic"
        }
        if (((a & DNA.JWT.FONT_STYLE_UNDERLINE) != 0) && ((a & DNA.JWT.FONT_STYLE_INLINE) != 0)) {
            this.setDecoration("underline line-through")
        } else {
            if ((a & DNA.JWT.FONT_STYLE_INLINE) != 0) {
                this.setDecoration("line-through")
            } else {
                if ((a & DNA.JWT.FONT_STYLE_UNDERLINE) != 0) {
                    this.setDecoration("underline")
                }
            }
        }
    },
    getStyle: function(a) {
        return this.style
    },
    setWeight: function(a) {
        this.weight = a
    },
    getWeight: function() {
        return this.weight
    },
    setSize: function(a) {
        this.size = a
    },
    getSize: function() {
        return this.size
    },
    equals: function(a) {
        return this.getDecoration() == a.getDecoration() && this.getFamily() == a.getFamily() && this.getStyle() == a.getStyle() && this.getWeight() == a.getWeight() && this.getSize() == a.getSize()
    }
});
DNA.widget.Font.defaultFont = new DNA.widget.Font();
DNA.widget.Border = function(c, b, a) {
    if (c || c == 0) {
        this.size = c
    }
    if (b) {
        this.color = b
    }
    if (a) {
        this.lineStyle = a
    }
}
;
Object.override(DNA.widget.Border.prototype, {
    color: "#000000",
    lineStyle: "solid",
    size: 1,
    getColor: function() {
        return this.color
    },
    getLineStyle: function() {
        return this.lineStyle
    },
    getSize: function() {
        return this.size
    }
});
DNA.widget.Rectangle = function(a, d, b, c) {
    if (arguments.length == 1) {
        this.x = a.x;
        this.y = a.y;
        this.width = a.width;
        this.height = a.height
    } else {
        this.x = a || this.x;
        this.y = d || this.y;
        this.width = b || this.width;
        this.height = c || this.height
    }
}
;
Object.override(DNA.widget.Rectangle.prototype, {
    x: 0,
    y: 0,
    width: 0,
    height: 0,
    getX: function() {
        return this.x
    },
    getY: function() {
        return this.y
    },
    getWidth: function() {
        return this.width
    },
    getHeight: function() {
        return this.height
    }
});
DNA.widget.ImageDescriptor = function(c, a, b) {
    this.width = c;
    this.height = a;
    this.url = b
}
;
DNA.widget.ImageDescriptor.urlReg = /^(http|ftp|https):\/\//i;
DNA.widget.ImageDescriptor.getUrl = function(a) {
    if (a) {
        if (a.match(this.urlReg)) {
            return a
        } else {
            return DNA.engine.application.getServerBaseUrl() + "serviceId=image&imageId=" + a
        }
    }
}
;
Object.override(DNA.widget.ImageDescriptor.prototype, {
    url: null ,
    width: DNA.JWT.DEFAULT,
    height: DNA.JWT.DEFAULT,
    setUrl: function(a) {
        this.url = a
    },
    getUrl: function() {
        return this.url
    },
    setWidth: function(a) {
        this.width = a
    },
    getWidth: function() {
        return this.width
    },
    setHeight: function(a) {
        this.height = a
    },
    getHeight: function() {
        return this.height
    },
    getHTML: function(a) {
        if (a == DNA.JWT.FILL) {
            return '<img border=0 src="' + this.url + '" style="position:absolute;">'
        } else {
            return '<img width="' + this.width + '" border=0 height="' + this.height + '" src="' + this.url + '">'
        }
    }
});
DNA.widget.RGB = function(d, c, a) {
    this.r = 0;
    this.g = 0;
    this.b = 0;
    this.setR = function(b) {
        if (b || b == 0) {
            this.r = Math.floor(b)
        }
    }
    ;
    this.setG = function(b) {
        if (b || b == 0) {
            this.g = Math.floor(b)
        }
    }
    ;
    this.setB = function(b) {
        if (b || b == 0) {
            this.b = Math.floor(b)
        }
    }
    ;
    this.setR(d);
    this.setG(c);
    this.setB(a);
    this.getR = function() {
        return this.r
    }
    ;
    this.getG = function() {
        return this.g
    }
    ;
    this.getB = function() {
        return this.b
    }
    ;
    this.getRed = function() {
        return this._adapter(this.r)
    }
    ;
    this.getGreen = function() {
        return this._adapter(this.g)
    }
    ;
    this.getBlue = function() {
        return this._adapter(this.b)
    }
    ;
    this.getColor = function() {
        return "#" + this.getRed() + this.getGreen() + this.getBlue()
    }
    ;
    this.setColor = function(b) {
        b = b.replace("#", "");
        this.setR(parseInt(b.substring(0, 2), 16));
        this.setG(parseInt(b.substring(2, 4), 16));
        this.setB(parseInt(b.substring(4, 6), 16))
    }
    ;
    this.toHSL = function() {
        var p = 0
          , g = 0
          , m = 0
          , l = 0
          , q = 0
          , n = 0
          , o = 0
          , b = 0
          , h = 0;
        l = Math.min(this.getR(), Math.min(this.getB(), this.getG()));
        q = Math.max(this.getR(), Math.max(this.getB(), this.getG()));
        n = q - l;
        m = (q + l) / 2;
        if (n == 0) {
            p = 0;
            g = 0
        } else {
            if (m < 128) {
                g = 256 * n / (q + l)
            } else {
                g = 256 * n / (512 - q - l)
            }
            o = ((360 * (q - this.getR()) / 6) + (360 * n / 2)) / n;
            b = ((360 * (q - this.getG()) / 6) + (360 * n / 2)) / n;
            h = ((360 * (q - this.getB()) / 6) + (360 * n / 2)) / n;
            if (this.getR() == q) {
                p = h - b
            } else {
                if (this.getG() == q) {
                    p = 120 + o - h
                } else {
                    if (this.getB() == q) {
                        p = 240 + b - o
                    }
                }
            }
            if (p < 0) {
                p += 360
            }
            if (p >= 360) {
                p -= 360
            }
            if (m >= 256) {
                m = 255
            }
            if (g >= 256) {
                g = 255
            }
        }
        return new DNA.widget.HSL(p,g,m)
    }
    ;
    this._adapter = function(b) {
        var g = b.toString(16);
        if (g.length < 2) {
            return "0" + g
        } else {
            return g
        }
    }
}
;
DNA.widget.HSL = function(c, b, a) {
    this.h = 0;
    this.s = 0;
    this.l = 0;
    this.getH = function() {
        return this.h
    }
    ;
    this.getS = function() {
        return this.s
    }
    ;
    this.getL = function() {
        return this.l
    }
    ;
    this.setH = function(d) {
        if (d || d == 0) {
            this.h = d
        }
    }
    ;
    this.setS = function(d) {
        if (d || d == 0) {
            this.s = d
        }
    }
    ;
    this.setL = function(d) {
        if (d || d == 0) {
            this.l = d
        }
    }
    ;
    this.setH(c);
    this.setS(b);
    this.setL(a);
    this.toRGB = function() {
        var m = this.getH();
        var l = this.getS();
        var d = this.getL();
        var o = 0
          , n = 0
          , p = 0
          , h = 0
          , g = 0;
        if (l == 0) {
            o = d;
            n = d;
            p = d
        } else {
            if (d < 128) {
                g = (d * (256 + l)) / 256
            } else {
                g = (d + l) - (l * d) / 256
            }
            if (g > 255) {
                g = Math.round(g)
            }
            if (g > 254) {
                g = 255
            }
            h = 2 * d - g;
            o = this._RGBFromHue(h, g, m + 120);
            n = this._RGBFromHue(h, g, m);
            p = this._RGBFromHue(h, g, m - 120)
        }
        o = o < 0 ? 0 : o;
        o = o > 255 ? 255 : o;
        n = n < 0 ? 0 : n;
        n = n > 255 ? 255 : n;
        p = p < 0 ? 0 : p;
        p = p > 255 ? 255 : p;
        return new DNA.widget.RGB(Math.round(o),Math.round(n),Math.round(p))
    }
    ;
    this._RGBFromHue = function(g, d, l) {
        if (l < 0) {
            l += 360
        }
        if (l >= 360) {
            l -= 360
        }
        if (l < 60) {
            return g + ((d - g) * l) / 60
        }
        if (l < 180) {
            return d
        }
        if (l < 240) {
            return g + ((d - g) * (240 - l)) / 60
        }
        return g
    }
}
;
DNA.widget.ImageBorder = function(a) {
    if (a) {
        this.setImg_lt(a[0]);
        this.setImg_t(a[1]);
        this.setImg_rt(a[2]);
        this.setImg_r(a[3]);
        this.setImg_rb(a[4]);
        this.setImg_b(a[5]);
        this.setImg_lb(a[6]);
        this.setImg_l(a[7])
    }
}
;
Object.override(DNA.widget.ImageBorder.prototype, {
    img_t: null ,
    img_r: null ,
    img_b: null ,
    img_l: null ,
    img_lt: null ,
    img_rt: null ,
    img_rb: null ,
    img_lb: null ,
    setImg_t: function(a) {
        this.img_t = a
    },
    getImg_t: function() {
        return this.img_t
    },
    setImg_r: function(a) {
        this.img_r = a
    },
    getImg_r: function() {
        return this.img_r
    },
    setImg_b: function(a) {
        this.img_b = a
    },
    getImg_b: function() {
        return this.img_b
    },
    setImg_l: function(a) {
        this.img_l = a
    },
    getImg_l: function() {
        return this.img_l
    },
    setImg_lt: function(a) {
        this.img_lt = a
    },
    getImg_lt: function() {
        return this.img_lt
    },
    setImg_rt: function(a) {
        this.img_rt = a
    },
    getImg_rt: function() {
        return this.img_rt
    },
    setImg_rb: function(a) {
        this.img_rb = a
    },
    getImg_rb: function() {
        return this.img_rb
    },
    setImg_lb: function(a) {
        this.img_lb = a
    },
    getImg_lb: function() {
        return this.img_lb
    }
});
Object.override(Date, {
    MILLI: "ms",
    SECOND: "s",
    MINUTE: "mi",
    HOUR: "h",
    DAY: "d",
    MONTH: "mo",
    YEAR: "y",
    patterns: {
        ISO8601Long: "Y-m-d H:i:s",
        ISO8601Short: "Y-m-d",
        ShortDate: "n/j/Y",
        LongDate: "l, F d, Y",
        FullDateTime: "l, F d, Y g:i:s A",
        MonthDay: "F d",
        ShortTime: "g:i A",
        LongTime: "g:i:s A",
        SortableDateTime: "Y-m-d\\TH:i:s",
        UniversalSortableDateTime: "Y-m-d H:i:sO",
        YearMonth: "F, Y"
    },
    parse: function(a, c) {
        if (Date._parseFunctions[c] == null ) {
            Date._createParser(c)
        }
        var b = Date._parseFunctions[c];
        return Date[b](a)
    },
    escape: function(a) {
        return a.replace(/('|\\)/g, "\\$1")
    },
    apm: DNA.engine.Client.isChinese() ? {
        am: "����",
        pm: "����",
        AM: "����",
        PM: "����"
    } : {
        am: "am",
        pm: "pm",
        AM: "AM",
        PM: "PM"
    },
    monthNames: DNA.engine.Client.isChinese() ? ["һ��", "����", "����", "����", "����", "����", "����", "����", "����", "ʮ��", "ʮһ��", "ʮ����"] : ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
    getShortMonthName: function(a) {
        return Date.monthNames[a].substring(0, 3).replace(/��/, "")
    },
    dayNames: DNA.engine.Client.isChinese() ? ["������", "����һ", "���ڶ�", "������", "������", "������", "������"] : ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
    getShortDayName: function(a) {
        return DNA.engine.Client.isChinese() ? Date.dayNames[a].substring(2, 3) : Date.dayNames[a].substring(0, 3)
    },
    _y2kYear: 50,
    _monthNumbers: DNA.engine.Client.isChinese() ? {
        һ: 0,
        ��: 1,
        ��: 2,
        ��: 3,
        ��: 4,
        ��: 5,
        ��: 6,
        ��: 7,
        ��: 8,
        ʮ: 9,
        ʮһ: 10,
        ʮ��: 11
    } : {
        Jan: 0,
        Feb: 1,
        Mar: 2,
        Apr: 3,
        May: 4,
        Jun: 5,
        Jul: 6,
        Aug: 7,
        Sep: 8,
        Oct: 9,
        Nov: 10,
        Dec: 11
    },
    getMonthNumber: function(a) {
        return Date._monthNumbers[a.substring(0, 1).toUpperCase() + a.substring(1, 3).toLowerCase()]
    },
    _parseFunctions: {
        count: 0
    },
    _parseRegexes: new Array(),
    _formatFunctions: {
        count: 0
    },
    _daysInMonth: [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31],
    _createNewFormat: function(format) {
        var funcName = "format" + Date._formatFunctions.count++;
        Date._formatFunctions[format] = funcName;
        var code = "Date.prototype." + funcName + " = function(){return ";
        var special = false;
        var ch = "";
        for (var i = 0; i < format.length; ++i) {
            ch = format.charAt(i);
            if (!special && ch == "\\") {
                special = true
            } else {
                if (special) {
                    special = false;
                    code += "'" + Date.escape(ch) + "' + "
                } else {
                    code += Date._getFormatCode(ch)
                }
            }
        }
        eval(code.substring(0, code.length - 3) + ";}")
    },
    _getFormatCode: function(g) {
        switch (g) {
        case "d":
            return "String.leftPad(this.getDate(), 2, '0') + ";
        case "D":
            return "Date.getShortDayName(this.getDay()) + ";
        case "j":
            return "this.getDate() + ";
        case "l":
            return "Date.dayNames[this.getDay()] + ";
        case "N":
            return "(this.getDay() ? this.getDay() : 7) + ";
        case "S":
            return "this._getSuffix() + ";
        case "w":
            return "this.getDay() + ";
        case "z":
            return "this.getDayOfYear() + ";
        case "W":
            return "String.leftPad(this.getWeekOfYear(), 2, '0') + ";
        case "F":
            return "Date.monthNames[this.getMonth()] + ";
        case "m":
            return "String.leftPad(this.getMonth() + 1, 2, '0') + ";
        case "M":
            return "Date.getShortMonthName(this.getMonth()) + ";
        case "n":
            return "(this.getMonth() + 1) + ";
        case "t":
            return "this.getDaysInMonth() + ";
        case "L":
            return "(this.isLeapYear() ? 1 : 0) + ";
        case "o":
            return "(this.getFullYear() + (this.getWeekOfYear() == 1 && this.getMonth() > 0 ? +1 : (this.getWeekOfYear() >= 52 && this.getMonth() < 11 ? -1 : 0))) + ";
        case "Y":
            return "this.getFullYear() + ";
        case "y":
            return "('' + this.getFullYear()).substring(2, 4) + ";
        case "a":
            return "(this.getHours() < 12 ? Date.apm['am'] : Date.apm['pm']) + ";
        case "A":
            return "(this.getHours() < 12 ? Date.apm['AM'] : Date.apm['PM']) + ";
        case "g":
            return "((this.getHours() % 12) ? this.getHours() % 12 : 12) + ";
        case "G":
            return "this.getHours() + ";
        case "h":
            return "String.leftPad((this.getHours() % 12) ? this.getHours() % 12 : 12, 2, '0') + ";
        case "H":
            return "String.leftPad(this.getHours(), 2, '0') + ";
        case "i":
            return "String.leftPad(this.getMinutes(), 2, '0') + ";
        case "s":
            return "String.leftPad(this.getSeconds(), 2, '0') + ";
        case "u":
            return "String.leftPad(this.getMilliseconds(), 3, '0') + ";
        case "O":
            return "this.getGMTOffset() + ";
        case "P":
            return "this.getGMTOffset(true) + ";
        case "T":
            return "this.getTimezone() + ";
        case "Z":
            return "(this.getTimezoneOffset() * -60) + ";
        case "c":
            for (var m = Date._getFormatCode, n = "Y-m-dTH:i:sP", d = "", b = 0, a = n.length; b < a; ++b) {
                var h = n.charAt(b);
                d += h == "T" ? "'T' + " : m(h)
            }
            return d;
        case "U":
            return "Math.round(this.getTime() / 1000) + ";
        default:
            return "'" + Date.escape(g) + "' + "
        }
    },
    _createParser: function(format) {
        var funcName = "parse" + Date._parseFunctions.count++;
        var regexNum = Date._parseRegexes.length;
        var currentGroup = 1;
        Date._parseFunctions[format] = funcName;
        var code = "Date." + funcName + " = function(input){\nvar y = -1, m = -1, d = -1, h = -1, i = -1, s = -1, ms = -1, o, z, u, v;\ninput = String(input);var d = new Date();\ny = d.getFullYear();\nm = d.getMonth();\nd = d.getDate();\nvar results = input.match(Date._parseRegexes[" + regexNum + "]);\nif (results && results.length > 0) {";
        var regex = "";
        var special = false;
        var ch = "";
        for (var i = 0; i < format.length; ++i) {
            ch = format.charAt(i);
            if (!special && ch == "\\") {
                special = true
            } else {
                if (special) {
                    special = false;
                    regex += Date.escape(ch)
                } else {
                    var obj = Date._formatCodeToRegex(ch, currentGroup);
                    currentGroup += obj.g;
                    regex += obj.s;
                    if (obj.g && obj.c) {
                        code += obj.c
                    }
                }
            }
        }
        code += "if (u)\n{v = new Date(u * 1000);}else if (y >= 0 && m >= 0 && d > 0 && h >= 0 && i >= 0 && s >= 0 && ms >= 0)\n{v = new Date(y, m, d, h, i, s, ms);}\nelse if (y >= 0 && m >= 0 && d > 0 && h >= 0 && i >= 0 && s >= 0)\n{v = new Date(y, m, d, h, i, s);}\nelse if (y >= 0 && m >= 0 && d > 0 && h >= 0 && i >= 0)\n{v = new Date(y, m, d, h, i);}\nelse if (y >= 0 && m >= 0 && d > 0 && h >= 0)\n{v = new Date(y, m, d, h);}\nelse if (y >= 0 && m >= 0 && d > 0)\n{v = new Date(y, m, d);}\nelse if (y >= 0 && m >= 0)\n{v = new Date(y, m);}\nelse if (y >= 0)\n{v = new Date(y);}\n}return (v && (z || o))?\n    (z ? v.add(Date.SECOND, (v.getTimezoneOffset() * 60) + (z*1)) :\n        v.add(Date.HOUR, (v.getGMTOffset() / 100) + (o / -100))) : v\n;}";
        Date._parseRegexes[regexNum] = new RegExp("^" + regex + "$","i");
        eval(code)
    },
    _formatCodeToRegex: function(n, m) {
        switch (n) {
        case "d":
            return {
                g: 1,
                c: "d = parseInt(results[" + m + "], 10);\n",
                s: "(\\d{2})"
            };
        case "D":
            for (var d = [], h = 0; h < 7; d.push(Date.getShortDayName(h)),
            ++h) {}
            return {
                g: 0,
                c: null ,
                s: "(?:" + d.join("|") + ")"
            };
        case "j":
            return {
                g: 1,
                c: "d = parseInt(results[" + m + "], 10);\n",
                s: "(\\d{1,2})"
            };
        case "l":
            return {
                g: 0,
                c: null ,
                s: "(?:" + Date.dayNames.join("|") + ")"
            };
        case "N":
            return {
                g: 0,
                c: null ,
                s: "[1-7]"
            };
        case "S":
            return {
                g: 0,
                c: null ,
                s: "(?:st|nd|rd|th)"
            };
        case "w":
            return {
                g: 0,
                c: null ,
                s: "[0-6]"
            };
        case "z":
            return {
                g: 0,
                c: null ,
                s: "(?:\\d{1,3})"
            };
        case "W":
            return {
                g: 0,
                c: null ,
                s: "(?:\\d{2})"
            };
        case "F":
            return {
                g: 1,
                c: "m = parseInt(Date.getMonthNumber(results[" + m + "].replace(/��/,'')), 10);\n",
                s: "(" + Date.monthNames.join("|") + ")"
            };
        case "m":
            return {
                g: 1,
                c: "m = parseInt(results[" + m + "], 10) - 1;\n",
                s: "(\\d{2})"
            };
        case "M":
            for (var d = [], h = 0; h < 12; d.push(Date.getShortMonthName(h)),
            ++h) {}
            return {
                g: 1,
                c: "m = parseInt(Date.getMonthNumber(results[" + m + "]), 10);\n",
                s: "(" + d.join("|") + ")"
            };
        case "n":
            return {
                g: 1,
                c: "m = parseInt(results[" + m + "], 10) - 1;\n",
                s: "(\\d{1,2})"
            };
        case "t":
            return {
                g: 0,
                c: null ,
                s: "(?:\\d{2})"
            };
        case "L":
            return {
                g: 0,
                c: null ,
                s: "(?:1|0)"
            };
        case "o":
        case "Y":
            return {
                g: 1,
                c: "y = parseInt(results[" + m + "], 10);\n",
                s: "(\\d{4})"
            };
        case "y":
            return {
                g: 1,
                c: "var ty = parseInt(results[" + m + "], 10);\ny = ty > Date._y2kYear ? 1900 + ty : 2000 + ty;\n",
                s: "(\\d{1,2})"
            };
        case "a":
            return {
                g: 1,
                c: "if (results[" + m + "] == Date.apm['am']) {\nif (h == 12) { h = 0; }\n} else { if (h < 12) { h += 12; }}",
                s: "(" + Date.apm.am + "|" + Date.apm.pm + ")"
            };
        case "A":
            return {
                g: 1,
                c: "if (results[" + m + "] == Date.apm['AM']) {\nif (h == 12) { h = 0; }\n} else { if (h < 12) { h += 12; }}",
                s: "(" + Date.apm.AM + "|" + Date.apm.PM + ")"
            };
        case "g":
        case "G":
            return {
                g: 1,
                c: "h = parseInt(results[" + m + "], 10);\n",
                s: "(\\d{1,2})"
            };
        case "h":
        case "H":
            return {
                g: 1,
                c: "h = parseInt(results[" + m + "], 10);\n",
                s: "(\\d{2})"
            };
        case "i":
            return {
                g: 1,
                c: "i = parseInt(results[" + m + "], 10);\n",
                s: "(\\d{2})"
            };
        case "s":
            return {
                g: 1,
                c: "s = parseInt(results[" + m + "], 10);\n",
                s: "(\\d{2})"
            };
        case "u":
            return {
                g: 1,
                c: "ms = parseInt(results[" + m + "], 10);\n",
                s: "(\\d{3})"
            };
        case "O":
            return {
                g: 1,
                c: ["o = results[", m, "];\n", "var sn = o.substring(0,1);\n", "var hr = o.substring(1,3)*1 + Math.floor(o.substring(3,5) / 60);\n", "var mn = o.substring(3,5) % 60;\n", "o = ((-12 <= (hr*60 + mn)/60) && ((hr*60 + mn)/60 <= 14))?\n", "    (sn + String.leftPad(hr, 2, '0') + String.leftPad(mn, 2, '0')) : null;\n"].join(""),
                s: "([+-]\\d{4})"
            };
        case "P":
            return {
                g: 1,
                c: ["o = results[", m, "];\n", "var sn = o.substring(0,1);\n", "var hr = o.substring(1,3)*1 + Math.floor(o.substring(4,6) / 60);\n", "var mn = o.substring(4,6) % 60;\n", "o = ((-12 <= (hr*60 + mn)/60) && ((hr*60 + mn)/60 <= 14))?\n", "    (sn + String.leftPad(hr, 2, '0') + String.leftPad(mn, 2, '0')) : null;\n"].join(""),
                s: "([+-]\\d{2}:\\d{2})"
            };
        case "T":
            return {
                g: 0,
                c: null ,
                s: "[A-Z]{1,4}"
            };
        case "Z":
            return {
                g: 1,
                c: "z = results[" + m + "] * 1;\nz = (-43200 <= z && z <= 50400)? z : null;\n",
                s: "([+-]?\\d{1,5})"
            };
        case "c":
            var o = Date._formatCodeToRegex
              , g = [];
            var b = [o("Y", 1), o("m", 2), o("d", 3), o("h", 4), o("i", 5), o("s", 6), o("P", 7)];
            for (var h = 0, c = b.length; h < c; ++h) {
                g.push(b[h].c)
            }
            return {
                g: 1,
                c: g.join(""),
                s: b[0].s + "-" + b[1].s + "-" + b[2].s + "T" + b[3].s + ":" + b[4].s + ":" + b[5].s + b[6].s
            };
        case "U":
            return {
                g: 1,
                c: "u = parseInt(results[" + m + "], 10);\n",
                s: "(-?\\d+)"
            };
        default:
            return {
                g: 0,
                c: null ,
                s: n
            }
        }
    }
});
Object.override(Date.prototype, {
    format: function(b) {
        if (Date._formatFunctions[b] == null ) {
            Date._createNewFormat(b)
        }
        var a = Date._formatFunctions[b];
        return this[a]()
    },
    getTimezone: function() {
        return this.toString().replace(/^.* (?:\((.*)\)|([A-Z]{1,4})(?:[\-+][0-9]{4})?(?: -?\d+)?)$/, "$1$2").replace(/[^A-Z]/g, "")
    },
    getGMTOffset: function(a) {
        return (this.getTimezoneOffset() > 0 ? "-" : "+") + String.leftPad(Math.abs(Math.floor(this.getTimezoneOffset() / 60)), 2, "0") + (a ? ":" : "") + String.leftPad(this.getTimezoneOffset() % 60, 2, "0")
    },
    getDayOfYear: function() {
        var a = 0;
        Date._daysInMonth[1] = this.isLeapYear() ? 29 : 28;
        for (var b = 0; b < this.getMonth(); ++b) {
            a += Date._daysInMonth[b]
        }
        return a + this.getDate() - 1
    },
    getWeekOfYear: function() {
        var b = 86400000;
        var c = 7 * b;
        var d = Date.UTC(this.getFullYear(), this.getMonth(), this.getDate() + 3) / b;
        var a = Math.floor(d / 7);
        var g = new Date(a * c).getUTCFullYear();
        return a - Math.floor(Date.UTC(g, 0, 7) / c) + 1
    },
    isLeapYear: function() {
        var a = this.getFullYear();
        return !!((a & 3) == 0 && (a % 100 || (a % 400 == 0 && a)))
    },
    getFirstDayOfMonth: function() {
        var a = (this.getDay() - (this.getDate() - 1)) % 7;
        return (a < 0) ? (a + 7) : a
    },
    getLastDayOfMonth: function() {
        var a = (this.getDay() + (Date._daysInMonth[this.getMonth()] - this.getDate())) % 7;
        return (a < 0) ? (a + 7) : a
    },
    getFirstDateOfMonth: function() {
        return new Date(this.getFullYear(),this.getMonth(),1)
    },
    getLastDateOfMonth: function() {
        return new Date(this.getFullYear(),this.getMonth(),this.getDaysInMonth())
    },
    getDaysInMonth: function() {
        Date._daysInMonth[1] = this.isLeapYear() ? 29 : 28;
        return Date._daysInMonth[this.getMonth()]
    },
    _getSuffix: function() {
        switch (this.getDate()) {
        case 1:
        case 21:
        case 31:
            return "st";
        case 2:
        case 22:
            return "nd";
        case 3:
        case 23:
            return "rd";
        default:
            return "th"
        }
    },
    clone: function() {
        return new Date(this.getTime())
    },
    clearTime: function() {
        this.setHours(0);
        this.setMinutes(0);
        this.setSeconds(0);
        this.setMilliseconds(0)
    },
    add: function(b, c) {
        var g = this.clone();
        if (!b || c === 0) {
            return g
        }
        switch (b.toLowerCase()) {
        case Date.MILLI:
            g.setMilliseconds(this.getMilliseconds() + c);
            break;
        case Date.SECOND:
            g.setSeconds(this.getSeconds() + c);
            break;
        case Date.MINUTE:
            g.setMinutes(this.getMinutes() + c);
            break;
        case Date.HOUR:
            g.setHours(this.getHours() + c);
            break;
        case Date.DAY:
            g.setDate(this.getDate() + c);
            break;
        case Date.MONTH:
            var a = this.getDate();
            if (a > 28) {
                a = Math.min(a, this.getFirstDateOfMonth().add("mo", c).getLastDateOfMonth().getDate())
            }
            g.setDate(a);
            g.setMonth(this.getMonth() + c);
            break;
        case Date.YEAR:
            g.setFullYear(this.getFullYear() + c);
            break
        }
        return g
    },
    between: function(c, a) {
        var b = this.getTime();
        return c.getTime() <= b && b <= a.getTime()
    }
});
DNA.widget.LayoutAux = function() {
    DNA.widget.LayoutAux.superclass.constructor.call(this)
}
;
DNA.widget.LayoutAux.extend(DNA.engine.JWTObject, {
    newPoint: function() {
        return new DNA.widget.Point(0,0)
    },
    newRectangle: function() {
        return new DNA.widget.Rectangle(0,0,0,0)
    },
    newPoint: function(a, b) {
        return new DNA.widget.Point(a,b)
    },
    newRectangle: function(a, d, b, c) {
        return new DNA.widget.Rectangle(a,d,b,c)
    },
    println: function(a) {
        alert(a)
    }
});
DNA.widget.LayoutData = function() {
    DNA.widget.LayoutData.superclass.constructor.call(this)
}
;
DNA.widget.LayoutData.extend(DNA.widget.LayoutAux, {});
DNA.widget.Layout = function() {
    DNA.widget.Layout.superclass.constructor.call(this)
}
;
DNA.widget.Layout.extend(DNA.widget.LayoutAux, {
    getLayoutControls: function(g) {
        var c = g.getChildren();
        var d = [];
        if (c) {
            for (var b = 0, a = c.length; b < a; b++) {
                d[b] = c[b]
            }
        }
        return d
    }
});
DNA.widget.BorderData = function(a) {
    DNA.widget.BorderData.superclass.constructor.call(this);
    if (a != null ) {
        this.position = a
    }
}
;
DNA.widget.BorderData.extend(DNA.widget.LayoutData, {
    position: DNA.JWT.CENTER
});
DNA.widget.BorderLayout = function(a, d, c, b) {
    DNA.widget.BorderLayout.superclass.constructor.call(this);
    if (a != null ) {
        this.hgap = a
    }
    if (d != null ) {
        this.vgap = d
    }
    if (c != null ) {
        this.marginWidth = c
    }
    if (b != null ) {
        this.marginHeight = b
    }
}
;
DNA.widget.BorderLayout.extend(DNA.widget.Layout, {
    hgap: 0,
    vgap: 0,
    marginWidth: 0,
    marginHeight: 0,
    computeSize: function(d, b, a, c) {
        return DNA.adapter.BorderLayoutCalculator.computeSize(d, b, a, c, this)
    },
    layout: function(b, a) {
        DNA.adapter.BorderLayoutCalculator.layout(b, a, this)
    },
    flushCache: function(a) {
        DNA.adapter.BorderLayoutCalculator.flushCache(a, this);
        return true
    },
    newData: function() {
        return new DNA.widget.BorderData()
    }
});
DNA.widget.FillData = function() {
    DNA.widget.FillData.superclass.constructor.call(this)
}
;
DNA.widget.FillData.extend(DNA.widget.LayoutData, {
    defaultWidth: -1,
    defaultHeight: -1,
    currentWidth: -1,
    currentHeight: -1,
    currentWhint: -1,
    currentHhint: -1
});
DNA.widget.FillLayout = function(a, c, b, d) {
    DNA.widget.FillLayout.superclass.constructor.call(this);
    if (a != null ) {
        this.type = a
    }
    if (c != null ) {
        this.marginWidth = c
    }
    if (b != null ) {
        this.marginHeight = b
    }
    if (d != null ) {
        this.spacing = d
    }
}
;
DNA.widget.FillLayout.extend(DNA.widget.Layout, {
    type: DNA.JWT.HORIZONTAL,
    marginWidth: 0,
    marginHeight: 0,
    spacing: 0,
    computeSize: function(d, b, a, c) {
        return DNA.adapter.FillLayoutCalculator.computeSize(d, b, a, c, this)
    },
    layout: function(b, a) {
        DNA.adapter.FillLayoutCalculator.layout(b, a, this)
    },
    flushCache: function(a) {
        DNA.adapter.FillLayoutCalculator.flushCache(a, this);
        return true
    },
    newData: function() {
        return new DNA.widget.FillData()
    }
});
DNA.widget.GridData = function(p, l, a, q, g, n, h, d, m, c, o, r, b) {
    DNA.widget.GridData.superclass.constructor.call(this);
    if (p != null ) {
        this.horizontalAlignment = p
    }
    if (l != null ) {
        this.verticalAlignment = l
    }
    if (a != null ) {
        this.widthHint = a
    }
    if (q != null ) {
        this.heightHint = q
    }
    if (g != null ) {
        this.horizontalIndent = g
    }
    if (n != null ) {
        this.verticalIndent = n
    }
    if (h != null ) {
        this.horizontalSpan = h
    }
    if (d != null ) {
        this.verticalSpan = d
    }
    if (m != null ) {
        this.grabExcessHorizontalSpace = m
    }
    if (c != null ) {
        this.grabExcessVerticalSpace = c
    }
    if (o != null ) {
        this.minimumWidth = o
    }
    if (r != null ) {
        this.minimumHeight = r
    }
    if (b != null ) {
        this.exclude = b
    }
}
;
DNA.widget.GridData.extend(DNA.widget.LayoutData, {
    horizontalAlignment: DNA.JWT.BEGINNING,
    verticalAlignment: DNA.JWT.CENTER,
    widthHint: DNA.JWT.DEFAULT,
    heightHint: DNA.JWT.DEFAULT,
    horizontalIndent: 0,
    verticalIndent: 0,
    horizontalSpan: 1,
    verticalSpan: 1,
    grabExcessHorizontalSpace: false,
    grabExcessVerticalSpace: false,
    minimumWidth: 0,
    minimumHeight: 0,
    exclude: false,
    cacheWidth: -1,
    cacheHeight: -1,
    defaultWhint: 0,
    defaultHhint: 0,
    defaultWidth: -1,
    defaultHeight: -1,
    currentWhint: 0,
    currentHhint: 0,
    currentWidth: -1,
    currentHeight: -1
});
DNA.widget.GridLayout = function(b, h, g, d, c, m, l, a) {
    DNA.widget.GridLayout.superclass.constructor.call(this);
    if (b != null ) {
        this.numColumns = b
    }
    if (h != null ) {
        this.makeColumnsEqualWidth = h
    }
    if (g != null ) {
        this.marginLeft = g
    }
    if (d != null ) {
        this.marginTop = d
    }
    if (c != null ) {
        this.marginRight = c
    }
    if (m != null ) {
        this.marginBottom = m
    }
    if (l != null ) {
        this.horizontalSpacing = l
    }
    if (a != null ) {
        this.verticalSpacing = a
    }
    this.widths = [];
    this.heights = []
}
;
DNA.widget.GridLayout.extend(DNA.widget.Layout, {
    numColumns: 1,
    makeColumnsEqualWidth: false,
    marginWidth: 0,
    marginHeight: 0,
    marginLeft: 0,
    marginTop: 0,
    marginRight: 0,
    marginBottom: 0,
    horizontalSpacing: 5,
    verticalSpacing: 5,
    computeSize: function(d, b, a, c) {
        return DNA.adapter.GridLayoutCalculator.computeSize(d, b, a, c, this)
    },
    layout: function(b, a) {
        DNA.adapter.GridLayoutCalculator.layout(b, a, this)
    },
    flushCache: function(a) {
        DNA.adapter.GridLayoutCalculator.flushCache(a, this);
        return true
    },
    newData: function() {
        return new DNA.widget.GridData()
    }
});
DNA.widget.RowData = function(b, a, c) {
    DNA.widget.RowData.superclass.constructor.call(this);
    if (b != null ) {
        this.width = b
    }
    if (a != null ) {
        this.height = a
    }
    if (c != null ) {
        this.alignment = c
    }
}
;
DNA.widget.RowData.extend(DNA.widget.LayoutData, {
    width: DNA.JWT.DEFAULT,
    height: DNA.JWT.DEFAULT,
    alignment: DNA.JWT.BEGINNING,
    exclude: false
});
DNA.widget.RowLayout = function(m, d, b, h, g, l, o, c, n, a) {
    DNA.widget.RowLayout.superclass.constructor.call(this);
    if (m != null ) {
        this.type = m
    }
    if (d != null ) {
        this.marginLeft = d
    }
    if (b != null ) {
        this.marginTop = b
    }
    if (h != null ) {
        this.marginRight = h
    }
    if (g != null ) {
        this.marginBottom = g
    }
    if (l != null ) {
        this.spacing = l
    }
    if (o != null ) {
        this.fill = o
    }
    if (c != null ) {
        this.justify = c
    }
    if (n != null ) {
        this.pack = n
    }
    if (a != null ) {
        this.wrap = a
    }
}
;
DNA.widget.RowLayout.extend(DNA.widget.Layout, {
    type: DNA.JWT.HORIZONTAL,
    marginLeft: DNA.JWT.ROWLAYOUT_MARGIN_LEFT,
    marginTop: DNA.JWT.ROWLAYOUT_MARGIN_TOP,
    marginRight: DNA.JWT.ROWLAYOUT_MARGIN_RIGHT,
    marginBottom: DNA.JWT.ROWLAYOUT_MARGIN_BOTTOM,
    spacing: DNA.JWT.ROWLAYOUT_SPACING,
    fill: false,
    justify: false,
    pack: true,
    wrap: true,
    computeSize: function(d, b, a, c) {
        return DNA.adapter.RowLayoutCalculator.computeSize(d, b, a, c, this)
    },
    layout: function(b, a) {
        DNA.adapter.RowLayoutCalculator.layout(b, a, this)
    },
    flushCache: function(a) {
        DNA.adapter.RowLayoutCalculator.flushCache(a, this);
        return true
    },
    newData: function() {
        return new DNA.widget.RowData()
    }
});
DNA.widget.TableData = function(h, a, b, d, l, g, c) {
    DNA.widget.TableData.superclass.constructor.call(this);
    if (h != null ) {
        this.width = h
    }
    if (a != null ) {
        this.height = a
    }
    if (b != null ) {
        this.horizontalAlignment = b
    }
    if (d != null ) {
        this.verticalAlignment = d
    }
    if (l != null ) {
        this.horizontalIndent = l
    }
    if (g != null ) {
        this.verticalIndent = g
    }
    if (c != null ) {
        this.exclude = c
    }
}
;
DNA.widget.TableData.extend(DNA.widget.LayoutData, {
    width: DNA.JWT.DEFAULT,
    height: DNA.JWT.DEFAULT,
    horizontalAlignment: DNA.JWT.FILL,
    verticalAlignment: DNA.JWT.FILL,
    horizontalIndent: 0,
    verticalIndent: 0,
    exclude: false
});
DNA.widget.TableLayout = function(c, n, a, m, o, d, b, l, g) {
    DNA.widget.TableLayout.superclass.constructor.call(this);
    this.width = c;
    this.height = n;
    this.rowHeights = new Array();
    if (m != null ) {
        for (var h = 0; h < m.length; h++) {
            this.rowHeights[h] = m[h]
        }
    }
    this.columnWidths = new Array();
    if (a != null ) {
        for (var h = 0; h < a.length; h++) {
            this.columnWidths[h] = a[h]
        }
    }
    this.cellInfos = new Array(this.rowHeights.length);
    for (var h = 0; h < this.cellInfos.length; h++) {
        this.cellInfos[h] = new Array(this.columnWidths.length)
    }
    this.pixelFirst = o;
    if (d != null ) {
        this.marginLeft = d
    }
    if (b != null ) {
        this.marginTop = b
    }
    if (l != null ) {
        this.marginRight = l
    }
    if (g != null ) {
        this.marginBottom = g
    }
}
;
DNA.widget.TableLayout.extend(DNA.widget.Layout, {
    width: 0,
    height: 0,
    columnWidths: null ,
    rowHeights: null ,
    cellInfos: null ,
    pixelFirst: false,
    realColumnWidths: null ,
    realRowHeights: null ,
    newIntegerArray: function(c) {
        var a = [];
        for (var b = 0; b < c; b++) {
            a[b] = 0
        }
        return a
    },
    computeSize: function(d, b, a, c) {
        return DNA.adapter.TableLayoutCalculator.computeSize(d, b, a, c, this)
    },
    layout: function(b, a) {
        DNA.adapter.TableLayoutCalculator.layout(b, a, this)
    },
    flushCache: function(a) {
        DNA.adapter.TableLayoutCalculator.flushCache(a, this);
        return true
    },
    newData: function() {
        return new DNA.widget.TableData()
    }
});
DNA.widget.TableCellInfo = function(b, a, c, d) {
    DNA.widget.TableCellInfo.superclass.constructor.call(this);
    if (b != null ) {
        this.rowSpan = b
    }
    if (a != null ) {
        this.columnSpan = a
    }
    if (c != null ) {
        this.isSpan = c
    }
    if (d != null ) {
        this.ignore = d
    }
}
;
DNA.widget.TableCellInfo.extend(DNA.engine.JWTObject, {
    rowSpan: 1,
    columnSpan: 1,
    isSpan: false,
    ignore: false
});
DNA.widget.TableLayoutExt = function(d, a, c, g, b) {
    DNA.widget.TableLayoutExt.superclass.constructor.call(this, d, a, c, g, b)
}
;
DNA.widget.TableLayoutExt.extend(DNA.widget.TableLayout, {
    DEFAULT: -1,
    PERCENT: 0,
    INTEGER: 1,
    getColumnWidth: function(a) {
        if (!this.realColumnWidths || a < 0 || a > this.realColumnWidths.length) {
            return 0
        }
        return this.realColumnWidths[a]
    },
    getRowHeight: function(a) {
        if (!this.realRowHeights || a < 0 || a > this.realRowHeights.length) {
            return 0
        }
        return this.realRowHeights[a]
    },
    getWidth: function() {
        return this.width
    },
    getHeight: function() {
        return this.height
    },
    getWidthType: function() {
        if (DNA.adapter.TableLayoutCalculator.isDefault(this.width)) {
            return this.DEFAULT
        } else {
            if (DNA.adapter.TableLayoutCalculator.isPercent(this.width)) {
                return this.PERCENT
            } else {
                return this.INTEGER
            }
        }
    },
    getHeightType: function() {
        if (DNA.adapter.TableLayoutCalculator.isDefault(this.height)) {
            return this.DEFAULT
        } else {
            if (DNA.adapter.TableLayoutCalculator.isPercent(this.height)) {
                return this.PERCENT
            } else {
                return this.INTEGER
            }
        }
    },
    setRowHeight: function(b, a) {
        if (b < 0 || b > this.realRowHeights.length) {
            return
        }
        this.rowHeights[b] = a
    },
    setColumnWidth: function(a, b) {
        if (a < 0 || a > this.realColumnWidths.length) {
            return
        }
        this.columnWidths[a] = b
    },
    getColumnCount: function() {
        return this.columnWidths != null  ? this.columnWidths.length : 0
    },
    getRowCount: function() {
        return this.rowHeights != null  ? this.rowHeights.length : 0
    },
    getTableCellInfo: function(b, c) {
        if (b < 0 || b >= this.getColumnCount() || c < 0 || c >= this.getRowCount()) {
            return null 
        }
        var a = this.cellInfos[c][b];
        return a
    },
    getColumnType: function() {
        return DNA.adapter.TableLayoutCalculator.initNumType(this.columnWidths, this)
    },
    getRowType: function() {
        return DNA.adapter.TableLayoutCalculator.initNumType(this.rowHeights, this)
    },
    reCompute: function() {
        DNA.adapter.TableLayoutCalculator.advancedLayout(null , false, this.tableRect.x, this.tableRect.y, this.tableRect.width, this.tableRect.height, false, this)
    }
});
DNA.widget.Widget = function(a) {
    DNA.widget.Widget.superclass.constructor.call(this);
    this._initData = a;
    this._eid = a.eid
}
;
DNA.widget.Widget.extend(DNA.engine.EventTarget, {
    autoRender: false,
    init: function() {
        if (this.autoRender) {
            this._buildElements()
        }
    },
    _getState: function() {
        if (this._state == undefined) {
            this._state = 0;
            var b = this._initData[DNA.JWTProperty.PROPERTY_VISIBLE];
            if (b != false) {
                this._state |= DNA.JWT.STATE_VISIBLE
            }
            delete this._initData[DNA.JWTProperty.PROPERTY_VISIBLE];
            var a = this._initData[DNA.JWTProperty.PROPERTY_MODE];
            if (a != undefined) {
                this._state = this._state & 4294836224 | a;
                delete this._initData[DNA.JWTProperty.PROPERTY_MODE]
            }
        }
        return this._state
    },
    getModeState: function() {
        return this._state & 131071
    },
    getStyle: function() {
        return this._initData.style
    },
    getEid: function() {
        return this._eid
    },
    getFont: function() {
        return DNA.widget.CssStyleFinder.getFont(this)
    },
    indexOf: function(a) {
        return DNA.widget.WidgetRegistry.indexOf(this, a)
    },
    getPrevious: function() {
        var b = this.getParent();
        var a = b.indexOf(this);
        return b.getChildren(a - 1)
    },
    getNext: function() {
        var b = this.getParent();
        var a = b.indexOf(this);
        return b.getChildren(a + 1)
    },
    getParent: function(a) {
        var b = DNA.widget.WidgetRegistry.getParent(a || this);
        return b
    },
    getParentControl: function() {
        var a = this.getParent();
        while (a && !(a instanceof DNA.widget.Control)) {
            a = a.getParent()
        }
        return a
    },
    isAncestorOf: function(b) {
        if (b) {
            var c = DNA.widget.WidgetRegistry.getNode(b.getEid());
            var a = DNA.widget.WidgetRegistry.getNode(this.getEid());
            while (c) {
                if (c == a) {
                    return true
                } else {
                    c = c.parent
                }
            }
        }
        return false
    },
    insertChildHtml: function(b, a) {
        if (b) {
            this._add(b, a)
        } else {
            this._add(undefined, a)
        }
    },
    appendChildHtml: function(a) {
        this._add(null , a)
    },
    _add: function(b, a) {
        if (a) {
            var c = null ;
            var d;
            if (b) {
                c = DNA.engine.DomUtil.findChild(this.getBody(), "*[id=" + b + "]");
                d = DNA.JWT.RENDER_POS_TYPE_BEFORE
            } else {
                if (b === null ) {
                    d = DNA.JWT.RENDER_POS_TYPE_FIRST
                } else {
                    d = DNA.JWT.RENDER_POS_TYPE_LAST
                }
            }
            return this._renderChild(this.getBody(), d, a, c)
        }
    },
    _renderChild: function(d, c, b, a) {
        if (c == DNA.JWT.RENDER_POS_TYPE_BEFORE) {
            return DNA.engine.DomUtil.insertBefore(a, b)
        } else {
            if (c == DNA.JWT.RENDER_POS_TYPE_LAST) {
                return DNA.engine.DomUtil.append(d, b)
            } else {
                if (c == DNA.JWT.RENDER_POS_TYPE_FIRST) {
                    return DNA.engine.DomUtil.insertFirst(d, b)
                } else {
                    return DNA.engine.DomUtil.insertAfter(a, b)
                }
            }
        }
    },
    getEl: function() {
        if (!this.el) {
            this.el = this._buildEl()
        }
        return this.el
    },
    _buildElements: function() {
        var b = this._buildEl();
        if (b) {
            delete this.el;
            this.el = b;
            var a = this._doBuildElements();
            if (a !== false) {
                this._maskState(DNA.JWT.STATE_RENDERD);
                this._afterBuild();
                return true
            }
        }
        return false
    },
    _afterBuild: Function.emptyFunction,
    _buildEl: function() {
        var m;
        var l = DNA.engine.application.getFrontCompositeInfo();
        var d = l ? l.eid : null ;
        if (this.getEid() != d) {
            var c = DNA.widget.WidgetRegistry.getNode(this.getEid()).parent;
            while (c) {
                var b = c.eid;
                var h = DNA.widget.WidgetRegistry.getRawData(b).etype;
                if (h === "ComboPanel" || h === "MenuItem") {
                    var a = DNA.widget.WidgetRegistry.get(b);
                    if (!a.checkRendered()) {
                        a._buildElements()
                    }
                    m = document;
                    break
                } else {
                    if (h === "Menu" && c.parent.etype === "MenuItem") {
                        var g = DNA.widget.WidgetRegistry.get(c.parent.eid);
                        if (!g.checkRendered()) {
                            g._buildElements()
                        }
                        m = document;
                        break
                    } else {
                        if (h === "Composite" && (b == d)) {
                            m = document;
                            break
                        } else {
                            if (c.widget && c.widget.doc) {
                                m = c.widget.doc;
                                break
                            }
                        }
                    }
                }
                c = c.parent
            }
        }
        m = m || document;
        return m.getElementById(this.getEid())
    },
    _doBuildElements: Function.emptyFunction,
    checkRendered: function(c) {
        var a = this._checkState(DNA.JWT.STATE_RENDERD);
        if (!a && c) {
            return this._buildElements()
        } else {
            return a
        }
    },
    isDisposed: function() {
        return DNA.widget.WidgetRegistry.isDisposed(this.getEid())
    },
    _removeHtml: function(a) {
        var b = function(h) {
            if (h._removeFlowHtml) {
                h._removeFlowHtml()
            }
            var g = DNA.widget.WidgetRegistry.getChildren(h, false);
            if (g) {
                var d = g.length;
                for (var c = 0; c < d; c++) {
                    b(g[c])
                }
            }
        }
        ;
        b(this);
        if (a != false) {
            DNA.engine.DomUtil.dispose(this.getEl())
        }
    },
    dispose: function(a) {
        if (!this.isDisposed()) {
            this._checkFocus();
            DNA.engine.application.getJWTEventMgr()._fireGlobleEvent(DNA.JWTEvent.PREDISPOSE, [this]);
            this._maskState(DNA.JWT.STATE_DISPOSED);
            this._removeHtml(a);
            DNA.widget.WidgetRegistry.dispose(this.getEid())
        }
    },
    doDispose: function() {
        this.fireEvent(DNA.JWTEvent.DISPOSE, [this]);
        this.clearListeners();
        DNA.engine.application.getJWTEventMgr().removeAllListeners(this);
        delete this.el;
        delete this._data;
        delete this._initData
    },
    _preRebuildElements: function(d) {
        var h = d || DNA.widget.WidgetRegistry._nodes[this.getEid()];
        if (h) {
            var g = h.widget;
            if (g && g._doPreRebuildElements) {
                g._doPreRebuildElements()
            }
            var c = h.children;
            if (c) {
                for (var b = 0, a = c.length; b < a; b++) {
                    this._preRebuildElements(c[b])
                }
            }
        }
    },
    _rebuildElements: function() {
        this._buildElements(true);
        if (this.getChildren) {
            var c = this.getChildren();
            if (c) {
                for (var b = 0, a = c.length; b < a; b++) {
                    c[b]._rebuildElements()
                }
            }
        }
    },
    _setHoveredState: function(a) {
        if (a) {
            this._maskState(DNA.JWT.STATE_BEHAVIOUR_HOVER)
        } else {
            this._unmaskState(DNA.JWT.STATE_BEHAVIOUR_HOVER)
        }
    },
    _isHoveredState: function() {
        return this._checkState(DNA.JWT.STATE_BEHAVIOUR_HOVER)
    },
    _setActivedState: function(a) {
        if (a) {
            this._maskState(DNA.JWT.STATE_BEHAVIOUR_ACTIVE)
        } else {
            this._unmaskState(DNA.JWT.STATE_BEHAVIOUR_ACTIVE)
        }
    },
    _isActivedState: function() {
        return this._checkState(DNA.JWT.STATE_BEHAVIOUR_ACTIVE)
    },
    _setSelectedState: function(a) {
        if (a) {
            this._maskState(DNA.JWT.STATE_BEHAVIOUR_SELECT)
        } else {
            this._unmaskState(DNA.JWT.STATE_BEHAVIOUR_SELECT)
        }
    },
    _isSelectedState: function() {
        return this._checkState(DNA.JWT.STATE_BEHAVIOUR_SELECT)
    },
    setModeState: function(a) {
        var b = this._getState();
        if (!this._checkEnableStateChange(b, a)) {
            this._state = this._state & 4294836224 | a;
            DNA.widget.CssStyleFinder.updateCss(this)
        } else {
            this._state = this._state & 4294836224 | a
        }
    },
    removeModeState: function(a) {
        var b = this._getState();
        this._state = this._state & ~a;
        if (!this._checkEnableStateChange(b, this._state)) {
            DNA.widget.CssStyleFinder.updateCss(this)
        }
    },
    isNormalMode: function() {
        return ((this._getState() & 131071) == 0) && (!this.isDisposed()) && this.isEnabled()
    },
    _checkState: function(a) {
        return (this._getState() & a) != 0
    },
    _maskState: function(a) {
        var b = this._getState();
        this._state |= a
    },
    _unmaskState: function(a) {
        var b = this._getState();
        this._state &= ~a
    },
    _checkEnableStateChange: function(c, a) {
        var b = (c | a) & ~(c & a);
        if (b == 0) {
            return false
        }
        if ((b & DNA.JWT.STATE_MODE_DISABLED) != 0) {
            if ((a & DNA.JWT.STATE_MODE_DISABLED) != 0) {
                this._disable()
            } else {
                this._enable()
            }
            return true
        }
        return false
    },
    setEnabled: function(a) {
        DNA.widget.WidgetRegistry.setEnabled(this.getEid(), a);
        if (a) {
            this._unmaskState(DNA.JWT.STATE_MODE_DISABLED);
            this._enable()
        } else {
            this._disable();
            this._maskState(DNA.JWT.STATE_MODE_DISABLED)
        }
    },
    _checkFocus: function() {
        var a = DNA.engine.application.getFocused();
        if (a && this.isAncestorOf(a)) {
            DNA.engine.application.getFocusListener().doBlurAndDispatchEvent(a);
            DNA.engine.application.setFocused(null )
        }
    },
    isEnabled: function() {
        return DNA.widget.WidgetRegistry.isEnabled(DNA.widget.WidgetRegistry.getNode(this.getEid()))
    },
    _disable: function() {
        var g = this.getEl();
        if (g) {
            this._checkFocus();
            DNA.engine.application.getJWTEventMgr()._fireGlobleEvent(DNA.JWTEvent.PRE_DISABLED, [this]);
            DNA.engine.DomUtil.addClass(g, "disabled");
            var c = DNA.engine.DomUtil.findIframes(g);
            var b = c.length;
            for (var a = 0; a < b; a++) {
                var h = c[a].contentWindow.document;
                if (h.documentElement) {
                    DNA.engine.DomUtil.addClass(h.documentElement, "disabled")
                }
            }
        }
        DNA.widget.WidgetRegistry.setEnabled(this.getEid(), false)
    },
    _enable: function() {
        DNA.widget.WidgetRegistry.setEnabled(this.getEid(), true);
        var h = this.getEl();
        if (h) {
            DNA.engine.DomUtil.removeClass(h, "disabled")
        }
        var g = DNA.engine.DomUtil.findIframes(h);
        var b = g.length;
        for (var a = 0; a < b; a++) {
            var m = DNA.widget.WidgetRegistry.get(g[a].id);
            if (!m || (m && !m._checkState(DNA.JWT.STATE_MODE_DISABLED))) {
                var l = g[a].contentWindow.document;
                if (l.documentElement) {
                    DNA.engine.DomUtil.removeClass(l.documentElement, "disabled")
                }
            }
        }
        DNA.engine.application.getJWTEventMgr()._fireGlobleEvent(DNA.JWTEvent.POST_ENABLED, [this])
    },
    _getMenu: function() {
        if (this._menuEid == undefined) {
            var a = this._initData.menu_handle;
            if (a) {
                this._menuEid = a;
                delete this._initData.menu_handle
            }
        }
        return this._menuEid ? DNA.engine.application.getMenuMgr().getMenuByHandle(this._menuEid) : null 
    },
    setCssStyles: function(a) {
        this._cssStyles = a;
        DNA.widget.CssStyleFinder.updateCss(this)
    },
    getCssStyles: function() {
        if (!this._cssStyles) {
            var a = this.getInitData(DNA.JWTProperty.PROPERTY_CSSSTYLES);
            this._cssStyles = a ? a : {};
            delete this._initData.css_styles
        }
        return this._cssStyles
    },
    setCssClassNames: function(a) {
        this.cssClassNames = a;
        DNA.widget.CssStyleFinder.updateCss(this)
    },
    getCssClassNames: function() {
        if (!this.cssClassNames) {
            this.cssClassNames = this._initData.css_class_name;
            delete this._initData.css_class_name
        }
        if (!this.cssClassNames) {
            this.cssClassNames = [this.jtype]
        }
        return this.cssClassNames
    },
    setToolTipText: function(b) {
        var a = this.getEl();
        if (a) {
            a.title = b || ""
        }
    },
    getToolTipText: function() {
        var a = this.getEl();
        if (a) {
            return a.title || ""
        }
    },
    _getStyleEl: function() {
        return this.getEl()
    },
    _setBackground: function(a) {
        var b = this._getStyleEl();
        if (b) {
            b.style.backgroundColor = a || ""
        }
    },
    _setFont: function(a) {
        var b = this._getStyleEl();
        if (b) {
            DNA.engine.DomUtil.setFont(b, a)
        }
    },
    _setForeground: function(b) {
        var a = this._getStyleEl();
        if (a) {
            a.style.color = b || ""
        }
    },
    _setCursor: function(b) {
        var a = this._getStyleEl();
        if (a) {
            a.style.cursor = b || "default"
        }
    },
    _setBackimage: function(b) {
        var c = this._getStyleEl();
        if (c) {
            if (b) {
                var a = c.style.backgroundImage;
                if (a != undefined && a != null  && a.indexOf(b.url) == -1) {
                    c.style.backgroundImage = "url(" + b.url + ")"
                }
            } else {
                c.style.backgroundImage = ""
            }
        }
    },
    setBackimage: function(a) {
        this._setBackimage(a);
        this.getCssStyles()[DNA.JWT.BASE_PROPERTY_BACKIMAGE] = a
    },
    setVisible: function(b) {
        var a = this.getEl();
        if (a) {
            if (b === false) {
                this._checkFocus();
                DNA.engine.application.getJWTEventMgr()._fireGlobleEvent(DNA.JWTEvent.PREHIDDEN, [this]);
                this._unmaskState(DNA.JWT.STATE_VISIBLE);
                this._setVisible(false)
            } else {
                this._maskState(DNA.JWT.STATE_VISIBLE);
                this._setVisible(true);
                DNA.engine.application.getJWTEventMgr()._fireGlobleEvent(DNA.JWTEvent.POSTVISIBLE, [this])
            }
        }
    },
    _setVisible: function(a) {
        DNA.engine.DomUtil.setVisible(this.el, a)
    },
    getVisible: function() {
        return this._checkState(DNA.JWT.STATE_VISIBLE)
    },
    isVisible: function() {
        var b = this.getEl();
        if (b) {
            var a = DNA.engine.DomUtil.getSize(b);
            if (a.width <= 0 || a.height <= 0 || DNA.engine.DomUtil.getPageXY(this.el).x >= DNA.JWTProperty.SYS_HIDDEN_X) {
                return false
            } else {
                return true
            }
        }
        return false
    },
    _getPageBounds: function(a) {
        var c = this.getEl();
        var b = DNA.engine.DomUtil.getSize(c);
        var d = DNA.engine.DomUtil.getPageXY(c, a);
        b.x = d.x;
        b.y = d.y;
        return b
    },
    setData: function(a, b) {
        if (a) {
            if (!this._data) {
                this._data = {}
            }
            this._data[a] = b
        }
    },
    getData: function(a) {
        var b = this._data;
        if (b) {
            return b[a]
        }
    },
    removeData: function(a) {
        delete this._data[a]
    },
    getInitData: function(b) {
        if (b) {
            var a = this._initData[b];
            if (a && DNA.widget.InitDataParser[b]) {
                a = DNA.widget.InitDataParser[b](a)
            }
            return a
        }
        return this._initData
    },
    getChildrenCount: function() {
        return DNA.widget.WidgetRegistry.getChildrenCount(this)
    }
});
DNA.widget.Item = function(a) {
    DNA.widget.Item.superclass.constructor.call(this, a)
}
;
DNA.widget.Item.extend(DNA.widget.Widget, {
    setImage: function(a) {
        this._image = a
    },
    setText: function(a) {
        this._text = a
    },
    setVisible: function(b) {
        var a = this.getEl();
        if (a) {
            if (b === false) {
                this._unmaskState(DNA.JWT.STATE_VISIBLE);
                this._setVisible(false)
            } else {
                this._maskState(DNA.JWT.STATE_VISIBLE);
                this._setVisible(true)
            }
        }
    },
    _getImage: function() {
        if (!this._image) {
            this._image = this.getInitData(DNA.JWTProperty.PROPERTY_IMAGE);
            delete this._initData.image
        }
        return this._image
    },
    getText: Function.emptyFunction,
    _animatedCheck: function() {
        var b = new DNA.engine.Sprite(this._boxEl);
        b.setScale(1.1);
        var a = new DNA.engine.Sprite(this._boxEl);
        a.setScale(1);
        new DNA.engine.LinearMotion(new DNA.engine.Frame([b]),new DNA.engine.Frame([a]),20,350).play()
    },
    _animatedHover: function(b) {
        if (DNA.engine.application.isAnimated() && !this._hoverAnimation && this.getParentControl().getSelected().indexOf(this) == -1) {
            if (b) {
                var m = this.getParentControl();
                if (m && m.hoverd == this) {
                    if (this._unhoverAnimation) {
                        this._unhoverAnimation.stop()
                    }
                    var a = this._getImage() ? this._imageEl : this._textEl;
                    var l = new DNA.engine.Sprite(a);
                    l.setMargin({
                        left: 0,
                        top: 0
                    });
                    var h = new DNA.engine.Sprite(a);
                    h.setMargin({
                        left: 5,
                        top: 0
                    });
                    var d = this._hoverAnimation = new DNA.engine.Animation(new DNA.engine.LinearMotion(new DNA.engine.Frame([l]),new DNA.engine.Frame([h]),30,200));
                    function g() {
                        delete this._hoverAnimation;
                        if (!this.isDisposed()) {
                            var o = this._getImage() ? this._imageEl : this._textEl;
                            if (m.hoverd != this) {
                                o.style.marginLeft = "0px"
                            } else {
                                o.style.marginLeft = "5px"
                            }
                        }
                    }
                    d.setEndCallBack(g, this);
                    d.play()
                }
            } else {
                var n = this;
                function c() {
                    try {
                        n._animatedHover(true)
                    } catch (o) {}
                }
                setTimeout(c, 100)
            }
        }
    },
    _animatedUnhover: function() {
        if (DNA.engine.application.isAnimated() && !this._unhoverAnimation) {
            if (this._hoverAnimation) {
                this._hoverAnimation.stop()
            } else {
                var d = this._getImage() ? this._imageEl : this._textEl;
                if (d.style.marginLeft != "" && d.style.marginLeft != "0px") {
                    var a = new DNA.engine.Sprite(d);
                    a.setMargin({
                        left: 5,
                        top: 0
                    });
                    var c = new DNA.engine.Sprite(d);
                    c.setMargin({
                        left: 0,
                        top: 0
                    });
                    var g = this._unhoverAnimation = new DNA.engine.Animation(new DNA.engine.LinearMotion(new DNA.engine.Frame([a]),new DNA.engine.Frame([c]),30,200));
                    function b() {
                        delete this._unhoverAnimation;
                        if (!this.isDisposed()) {
                            if (this.getParentControl().hoverd != this) {
                                d.style.marginLeft = "0px"
                            } else {
                                d.style.marginLeft = "5px"
                            }
                        }
                    }
                    g.setEndCallBack(b, this);
                    g.play()
                }
            }
        }
    }
});
DNA.widget.Control = function(a) {
    DNA.widget.Control.superclass.constructor.call(this, a)
}
;
DNA.widget.Control.extend(DNA.widget.Widget, {
    focusable: false,
    _absoluteEvents: {
        resize: true,
        locationChange: true,
        predispose: true,
        dispose: true,
        load: true
    },
    getFocusEffectBounds: function(a) {
        return this._getPageBounds(a)
    },
    init: function() {
        DNA.widget.Control.superclass.init.call(this);
        this._registEvents()
    },
    getTabIndex: function() {
        var a = this._tab;
        if (a === undefined) {
            a = this._tab = this._initData[DNA.JWTProperty.PROPERTY_FOCUS_TRAVERSAL_INDEX] || 0;
            delete this._initData[DNA.JWTProperty.PROPERTY_FOCUS_TRAVERSAL_INDEX]
        }
        return a
    },
    setDragHandler: function(a) {
        this._dragHandler = a
    },
    getDragHandler: function() {
        var a = this._dragHandler;
        if (a === undefined) {
            a = this._dragHandler = this._initData[DNA.JWTProperty.PROPERTY_DRAGSOURCE_ID];
            delete this._initData[DNA.JWTProperty.PROPERTY_DRAGSOURCE_ID]
        }
        return a
    },
    setDropHandler: function(a) {
        if (this._dropHandler) {
            DNA.widget.DragDrop.removeTarget(this)
        }
        this._dropHandler = a;
        if (a) {
            DNA.widget.DragDrop.registerTarget(this)
        }
    },
    getDropHandler: function(a) {
        var b = this._dropHandler;
        if (b === undefined) {
            b = this._dropHandler = this._initData[DNA.JWTProperty.PROPERTY_DROPTARGET_ID];
            delete this._initData[DNA.JWTProperty.PROPERTY_DROPTARGET_ID]
        }
        return b
    },
    _setBorder: function(g, d) {
        var m = this.getEl();
        if (m) {
            var l = m.style;
            var c = false;
            if (g) {
                l.borderColor = g.color;
                l.borderStyle = g.lineStyle;
                var h = g.getSize();
                var n = h + "px";
                if (l.borderWidth != (h + "px")) {
                    c = true;
                    l.borderWidth = n;
                    this._borderSize = 2 * h
                }
            } else {
                l.borderColor = "";
                l.borderStyle = "";
                if (l.borderWidth != "") {
                    c = true;
                    l.borderWidth = "";
                    this._borderSize = 0
                }
            }
            if (c && d !== false) {
                var a = this.getBounds(true);
                this._setSize(a.width, a.height)
            }
        }
    },
    setTabIndex: function(a) {
        if (this._tab != a) {
            this._tab = a
        }
    },
    focus: function() {
        DNA.engine.application.getFocusListener()._focus(this)
    },
    _focus: function() {
        this._focusDom()
    },
    _focusDom: function() {
        var a = DNA.engine.Client;
        try {
            if (a.isIE() && a.getBrowserVersion() == 8) {
                document.focus()
            } else {
                DNA.engine.application.getBrowserBody().focus()
            }
        } catch (b) {}
    },
    _blur: Function.emptyFunction,
    canFocus: function() {
        if (this.focusable && (!this.isDisposed()) && this.isVisible() === true && this.isEnabled() === true) {
            return true
        }
        return false
    },
    setBounds: function(b, h, g, a) {
        var d;
        var c;
        if (h || h == 0) {
            d = this.setLocation(Math.round(b), Math.round(h));
            c = this.setSize(g, a)
        } else {
            d = this.setLocation(Math.round(b.x), Math.round(b.y));
            c = this.setSize(b.width, b.height)
        }
        if (d || c) {
            DNA.engine.application.getJWTEventMgr()._fireGlobleEvent("bounds_change", [this])
        }
    },
    reBoundsSelf: function(a) {
        if (a.x != undefined) {
            this._setLocation(a.x, a.y)
        }
        if (a.width != undefined) {
            this._setSize(a.width, a.height);
            this._resize(false, a)
        }
        DNA.engine.application.getJWTEventMgr()._fireGlobleEvent("bounds_change", [this])
    },
    setSize: function(b, g) {
        var d = b;
        var a = false;
        if (!g && g != 0) {
            d = b.width;
            g = b.height
        }
        var c = this._size = this._size || {};
        if (d < 0) {
            d = 0
        }
        if (g < 0) {
            g = 0
        }
        a = (c.width != d || c.height != g);
        if (DNA.engine.application.isForceLayoutAll() || a) {
            if (a) {
                var l = this.getBounds(true);
                l.width = c.width = d;
                l.height = c.height = g;
                this._setSize(d, g)
            }
            if (this._resize) {
                this._resize()
            }
            if (a) {
                this.fireEvent(DNA.JWTEvent.RESIZE, [this])
            }
            return true
        }
    },
    _setSize: function(a, d) {
        if (!DNA.engine.Client.isIE() || (DNA.engine.Client.isIE() && DNA.engine.Client.isStrict())) {
            var c = this.getBorderSize();
            a -= c;
            d -= c
        }
        if (a < 0) {
            a = 0
        }
        if (d < 0) {
            d = 0
        }
        var b = this.getEl();
        b.style.width = a + "px";
        b.style.height = d + "px"
    },
    _setLocation: function(a, b) {
        DNA.engine.DomUtil.setLeftTop(this.getEl(), a, b)
    },
    setLocation: function(a, c) {
        var b = this.getBounds(true);
        if (b.x != a || b.y != c) {
            b.x = a;
            b.y = c;
            this._setLocation(a, c);
            if (this._relocation) {
                this._relocation()
            }
            this.fireEvent(DNA.JWTEvent.LOCATIONCHANGE, [this]);
            return true
        }
    },
    setMenu: function(a) {
        this._menuEid = a
    },
    getMenu: function() {
        return DNA.widget.Control.superclass._getMenu.call(this)
    },
    getBounds: function(a) {
        if (!this._bounds) {
            var c = this.getInitData(DNA.JWTProperty.PROPERTY_RECTANGLE);
            if (c) {
                this._bounds = new DNA.widget.Rectangle(c.x,c.y,c.width,c.height);
                delete this._initData[DNA.JWTProperty.PROPERTY_RECTANGLE]
            } else {
                this._bounds = new DNA.widget.Rectangle(0,0,0,0)
            }
        }
        if (a) {
            return this._bounds
        } else {
            var d = this._bounds;
            return {
                x: d.x,
                y: d.y,
                width: d.width,
                height: d.height
            }
        }
    },
    _setPageXY: function(d) {
        var a = this.getEl();
        var c = DNA.engine.DomUtil.setPageXY(a, d.x, d.y);
        var b = this.getBounds(true);
        b.x = c.x;
        b.y = c.y
    },
    getBorderSize: function() {
        var b = this._borderSize;
        if (!b) {
            var a = 0;
            var d = this.getEl();
            if (d) {
                var c = d.style;
                a = parseInt(c.borderLeftWidth);
                a = isNaN(a) ? 0 : a
            }
            b = this._borderSize = 2 * a
        }
        return b
    },
    computeSize: Function.emptyFunction,
    setLayoutData: function(a) {
        this._layoutData = a
    },
    getLayoutData: function() {
        var a = this._layoutData;
        if (!a) {
            a = this._layoutData = this.getInitData(DNA.JWTProperty.PROPERTY_LAYOUT_DATA);
            delete this._initData.layoutData
        }
        return a
    },
    getBorderWidth: function() {
        return 0
    },
    isExcludeLayout: function() {
        return false
    },
    getDragger: function(c) {
        var b = DNA.engine.DomUtil.findParent(c.getSrcElement(), "*[resize*=d_resize]");
        if (b) {
            return new DNA.widget.DesignDragResize(DNA.engine.DomUtil.getStyle(c.getSrcElement(), "cursor"))
        }
        if (!this.getDragHandler()) {
            return null 
        }
        if (c.getSrcControl().getParent() instanceof DNA.widget.XYLayoutPanel) {
            return new DNA.widget.DesignDragDrop()
        }
        var a = c.getSrcWidget();
        if (a.isEnabled()) {
            if (this instanceof DNA.widget.Iteration) {
                if (this != a) {
                    return new DNA.widget.DragDrop()
                }
            } else {
                return new DNA.widget.DragDrop()
            }
        }
    },
    _canFire: function(b) {
        var a = false;
        if (this._absoluteEvents[b]) {
            a = true
        } else {
            if (!this.isDisposed() && this.isEnabled()) {
                a = true
            }
        }
        return a
    },
    isEventReachable: function(c, g, d, b) {
        var a = true;
        if (this.isDisposed()) {
            a = false
        } else {
            if (b) {
                if (!b.isEnabled()) {
                    a = false
                }
            } else {
                if (!this.isEnabled()) {
                    a = false
                }
            }
        }
        return a
    },
    _removeScrollbar: function() {
        this._getScrollElement().style.overflow = "hidden"
    },
    _restoreScrollbar: function() {
        this._getScrollElement().style.overflow = "auto"
    },
    _getScrollElement: function() {
        return this.getEl()
    },
    getScrollPosition: function() {
        var c = this._getScrollElement();
        var a = c.offsetHeight;
        if (a === 0) {
            return null 
        }
        var d = (c.scrollHeight - a);
        var b = 2;
        if (c.scrollHeight <= a) {
            return null 
        }
        if (c.scrollTop <= b) {
            return "top"
        }
        if (c.scrollTop + a + b >= c.scrollHeight) {
            return "bottom"
        }
        return "middle"
    },
    doDispose: function() {
        if (this._dropHandler) {
            DNA.widget.DragDrop.removeTarget(this)
        }
        if (DNA.engine.application._focused == this) {
            DNA.engine.application._focused = null 
        }
        DNA.widget.Control.superclass.doDispose.call(this)
    },
    _registEvents: Function.emptyFunction,
    getFocusTraversalKey: function() {
        if (!this._keyDescriptor) {
            this._keyDescriptor = this._initData[DNA.JWTProperty.PROPERTY_FOCUS_TRAVERSAL_KEY];
            delete this._initData[DNA.JWTProperty.PROPERTY_FOCUS_TRAVERSAL_KEY]
        }
        return this._keyDescriptor
    },
    setFocusTraversalKey: function(a) {
        this._keyDescriptor = a
    }
});
(function() {
    var a = function(c, l, h, d, g) {
        this._user = c;
        this._target = h;
        this._minpos = d;
        a.superclass.constructor.call(this, g);
        DNA.engine.application.getRoot().appendChildHtml("<div class=Scroller-" + l + " id=" + this.getEid() + " style='z-index:0;'></div>");
        DNA.widget.WidgetRegistry.putWidget(this, DNA.engine.application.getRoot());
        this._dir = l;
        this._registEvents();
        this._indent = this._START_INDENT = 10
    }
    ;
    a.extend(DNA.widget.Control, {
        _minpos: -100,
        setVisible: function(c) {
            if (c && (!this._isActive())) {
                return
            }
            a.superclass.setVisible.call(this, c)
        },
        showScroller: function(d) {
            var c = this.getEl();
            DNA.engine.DomUtil.setLeftTop(c, d.x, d.y);
            this.setVisible(true)
        },
        _registEvents: function() {
            this.addListener(DNA.JWTEvent.MOUSEOVER, this._mouseoverAction);
            this.addListener(DNA.JWTEvent.MOUSEOUT, this._mouseoutAction)
        },
        _isActive: function() {
            var c = this._target;
            if (this._dir == "right" && DNA.engine.DomUtil.getLeft(c) <= this._minpos) {
                return false
            } else {
                if (this._dir == "left" && DNA.engine.DomUtil.getLeft(c) >= 0) {
                    return false
                } else {
                    if (this._dir == "up" && DNA.engine.DomUtil.getTop(c) >= 0) {
                        return false
                    } else {
                        if (this._dir == "down" && DNA.engine.DomUtil.getTop(c) <= this._minpos) {
                            return false
                        }
                    }
                }
            }
            return true
        },
        reset: function(c) {
            if (this._user == c) {
                this._reset();
                delete this._target;
                delete this._user
            }
        },
        _reset: function() {
            this.getEl().className = "Scroller-" + this._dir;
            this.setVisible(false);
            this._indent = this._START_INDENT;
            var c = this._timer;
            if (c) {
                c.stop();
                delete this._timer
            }
        },
        _increase: function() {
            if (new Date() - this._startTime > 200) {
                this._startTime = new Date();
                this._indent++
            }
        },
        _doScroll: function() {
            var c = this._target;
            if (c) {
                if (this._dir == "right") {
                    if (!this._isActive()) {
                        this._reset()
                    } else {
                        this._increase();
                        var d = DNA.engine.DomUtil.getLeft(c) - this._indent;
                        d = d <= this._minpos ? this._minpos : d;
                        c.style.left = (d) + "px";
                        this._user.doScroll();
                        DNA.widget.ScrollBar.h.setVisible(true)
                    }
                } else {
                    if (this._dir == "left") {
                        if (!this._isActive()) {
                            this._reset()
                        } else {
                            this._increase();
                            var d = DNA.engine.DomUtil.getLeft(c) + this._indent;
                            d = d >= 0 ? 0 : d;
                            c.style.left = (d) + "px";
                            this._user.doScroll();
                            DNA.widget.ScrollBar.h.setVisible(true)
                        }
                    } else {
                        if (this._dir == "up") {
                            if (!this._isActive()) {
                                this._reset()
                            } else {
                                this._increase();
                                var d = DNA.engine.DomUtil.getTop(c) + this._indent;
                                d = d >= 0 ? 0 : d;
                                c.style.top = (d) + "px";
                                this._user.doScroll();
                                DNA.widget.ScrollBar.v.setVisible(true)
                            }
                        } else {
                            if (this._dir == "down") {
                                if (!this._isActive()) {
                                    this._reset()
                                } else {
                                    this._increase();
                                    var d = DNA.engine.DomUtil.getTop(c) - this._indent;
                                    d = d <= this._minpos ? this._minpos : d;
                                    c.style.top = (d) + "px";
                                    this._user.doScroll();
                                    DNA.widget.ScrollBar.v.setVisible(true)
                                }
                            }
                        }
                    }
                }
            }
        },
        _mouseoverAction: new DNA.engine.Action({
            handle: function(d) {
                this.getEl().className = "Scroller-" + this._dir + "-a";
                var c = this._timer = new DNA.engine.Thread(100,new DNA.engine.Runnable(this._doScroll,this));
                this._startTime = new Date();
                c.start()
            }
        }),
        _mouseoutAction: new DNA.engine.Action({
            handle: function(g) {
                this.getEl().className = "Scroller-" + this._dir;
                this._indent = this._START_INDENT;
                var d = this._timer;
                if (d) {
                    d.stop();
                    delete this._timer
                }
                var c = this._user;
                if (c && g.getSrcControl() !== c) {
                    c.removeScrollBar()
                }
            }
        })
    });
    var b = function(d, c) {
        this._left = d;
        this._right = c
    }
    ;
    b.extend(Object, {
        showScrollBar: function(d, c) {
            this._left.showScroller(d);
            this._right.showScroller(c)
        },
        setVisible: function(c) {
            this._left.setVisible(c);
            this._right.setVisible(c)
        },
        removeScrollBar: function(c) {
            this._left.reset(c);
            this._right.reset(c)
        },
        getUser: function() {
            return this._left._user
        },
        setZIndex: function(c) {
            this._left.getEl().style.zIndex = c;
            this._right.getEl().style.zIndex = c
        }
    });
    DNA.widget.ScrollBar = {
        HORIZONTAL: "h",
        VERTICAL: "v",
        getScrollBar: function(h, q, p, g) {
            if (!this[q]) {
                var o = DNA.engine.JWTObject._serialNumberSeed++;
                var m = DNA.engine.JWTObject._serialNumberSeed++;
                if (q == "h") {
                    this["left"] = new a(h,"left",p,g,{
                        eid: o,
                        etype: "Scroller",
                        pid: "_e_0",
                        init: {
                            eid: o
                        }
                    });
                    this["right"] = new a(h,"right",p,g,{
                        eid: m,
                        etype: "Scroller",
                        pid: "_e_0",
                        init: {
                            eid: m
                        }
                    });
                    this[q] = new b(this["left"],this["right"])
                } else {
                    this["up"] = new a(h,"up",p,g,{
                        eid: o,
                        etype: "Scroller",
                        pid: "_e_0",
                        init: {
                            eid: o
                        }
                    });
                    this["down"] = new a(h,"down",p,g,{
                        eid: m,
                        etype: "Scroller",
                        pid: "_e_0",
                        init: {
                            eid: m
                        }
                    });
                    this[q] = new b(this["up"],this["down"])
                }
            } else {
                if (q == "h") {
                    var d = this["left"];
                    var c = this["right"];
                    d._target = c._target = p;
                    d._minpos = c._minpos = g;
                    d._user = c._user = h
                } else {
                    var d = this["up"];
                    var c = this["down"];
                    d._target = c._target = p;
                    d._minpos = c._minpos = g;
                    d._user = c._user = h
                }
            }
            var n = DNA.engine.application.getTopWindowZIndexAnd1();
            this[q].setZIndex(n);
            return this[q]
        }
    }
})();
DNA.widget.MenuDropper = function(b, c) {
    this._owner = b;
    var a = {
        eid: this.getSerialNumber()
    };
    DNA.widget.MenuDropper.superclass.constructor.call(this, a);
    this.el = DNA.engine.DomUtil.append(c, this.getHtml());
    DNA.widget.WidgetRegistry.putWidget(this, null );
    this._registEvents()
}
;
DNA.widget.MenuDropper.size = 16;
DNA.widget.MenuDropper.extend(DNA.widget.Control, {
    _registEvents: function() {
        this.addListener(DNA.JWTEvent.CLICK, this._clickAction, this)
    },
    _clickAction: new DNA.engine.Action({
        handle: function(b) {
            var d = DNA.engine.application.getMenuMgr().getSystemMenu(this, this._owner.getDropMenuContent());
            var g = DNA.engine.DomUtil.getPageXY(this.getEl());
            var a = DNA.engine.DomUtil.getSize(this.getEl());
            if (this._owner instanceof DNA.widget.ToolBar && a.height && a.height > 16) {
                d.showMenu(-2000, -2000);
                var c = DNA.engine.DomUtil.getSize(d.getEl());
                d.showMenu(g.x + a.width - c.width, g.y + a.height)
            } else {
                if (this._owner instanceof DNA.widget.ToolBar) {
                    d.showMenu(-2000, -2000);
                    var c = DNA.engine.DomUtil.getSize(d.getEl());
                    d.showMenu(g.x + a.width - c.width, g.y + 16)
                } else {
                    if (a.height && a.height > 16) {
                        d.showMenu(g.x, g.y + a.height)
                    } else {
                        d.showMenu(g.x, g.y + 16)
                    }
                }
            }
        }
    }),
    doSysMenuAction: function(b, a) {
        this._owner.doDropMenuAction(b, a)
    },
    getHtml: function() {
        return "<div class=MenuDropper id=" + this.getEid() + "></div>"
    }
});
DNA.widget.MenuDropper.checkReset = function(n, w, t) {
    var d = false;
    var h = "offsetWidth";
    var l = "x";
    var q = "left";
    var m = "width";
    if (w & DNA.JWT.VERTICAL) {
        h = "offsetHeight";
        l = "y";
        q = "top";
        m = "height"
    }
    if (n instanceof DNA.widget.ToolBar) {
        var a = n.getEl();
        var p = n.getBody();
        var g = n.getChildren();
        if (p[h] > t && g.length > 1) {
            return true
        }
    } else {
        var a = n.getEl();
        var p = n.getBody();
        var g = n.getChildren();
        if (g) {
            for (var r = 0, s = g.length; r < s; r++) {
                var v = g[r];
                if (v instanceof DNA.widget.TabItem && v.getVisible() != false) {
                    v.getEl().style.display = ""
                }
            }
            if (p[h] > t && g.length > 1) {
                d = true;
                var b = n.getSelected()[0];
                if (b) {
                    var z = b.getEl();
                    var u = function() {
                        return (DNA.engine.DomUtil.getPageXY(z)[l] + z[h]) > (DNA.engine.DomUtil.getPageXY(a)[l] + t - DNA.widget.MenuDropper.size)
                    }
                    ;
                    if (p[h] > t - DNA.widget.MenuDropper.size) {
                        var o = z.id;
                        var g = p.children || p.childNodes;
                        for (var r = g.length - 1; r > 0; r--) {
                            var v = g[r];
                            if (v.id != o) {
                                v.style.display = "none";
                                if (p[h] <= t - DNA.widget.MenuDropper.size) {
                                    break
                                }
                            } else {
                                break
                            }
                        }
                    }
                    if (u()) {
                        var o = z.id;
                        var g = DNA.engine.DomUtil.getChildren(p);
                        for (var r = 0, s = g.length; r < s; r++) {
                            var v = g[r];
                            v.style.display = "none";
                            if (!u()) {
                                break
                            }
                        }
                    }
                } else {
                    if (p[h] > t - DNA.widget.MenuDropper.size) {
                        var g = p.children || p.childNodes;
                        for (var r = g.length - 1; r > 0; r--) {
                            var v = g[r];
                            v.style.display = "none";
                            if (p[h] <= t - DNA.widget.MenuDropper.size) {
                                break
                            }
                        }
                    }
                }
            }
        }
    }
    return d
}
;
DNA.widget.Composite = function(a) {
    DNA.widget.Composite.superclass.constructor.call(this, a)
}
;
DNA.widget.Composite.extend(DNA.widget.Control, {
    jtype: "Composite",
    _doPreRebuildElements: function() {
        if (this.doc) {
            DNA.engine.application.unHandleIframe(this)
        }
    },
    getBody: function() {
        if (this.checkRendered(true)) {
            return this._body || this.getEl()
        }
    },
    getChildren: function(a) {
        return DNA.widget.WidgetRegistry.getChildren(this, a)
    },
    replace2Iframe: function(a) {
        var d = this.el;
        if (!d) {
            d = this._buildEl()
        }
        this.oldEl = d;
        if (this.doc) {
            DNA.engine.application.unHandleIframe(this)
        }
        var c = d.style;
        var b = ["<iframe allowTransparency=true class='" + this.jtype + "' unselectable=on id='", this.getEid(), "' frameborder='0' scrolling='no' style='position:absolute;", "left:", c.left, ";", "top:", c.top, ";", "width:", c.width, ";", "height:", c.height, ";", "background-image:", c.backgroundImage, c.display == "none" ? "display:none;" : "", "' src='", a, "'></iframe>"];
        this.el = DNA.engine.DomUtil.insertBefore(d, b.join(""))
    },
    _setBackimage: function(b) {
        var c;
        if (this.doc) {
            c = this.doc.body
        } else {
            c = this.getEl()
        }
        if (c) {
            if (b) {
                var a = c.style.backgroundImage;
                if (a != undefined && a != null  && a.indexOf(b.url) == -1) {
                    c.style.backgroundImage = "url(" + b.url + ")"
                }
            } else {
                c.style.backgroundImage = ""
            }
        }
    },
    getClientArea: function() {
        var a = this.getClientRectangle();
        a.x = 0;
        a.y = 0;
        return a
    },
    getClientRectangle: function() {
        var a = this.getBorderSize();
        var b = this.getBounds();
        return new DNA.widget.Rectangle(a / 2,a / 2,b.width - a,b.height - a)
    },
    setLayout: function(a) {
        this._layout = a
    },
    getLayout: function() {
        var a = this._layout;
        if (!a) {
            a = this._layout = this.getInitData(DNA.JWTProperty.PROPERTY_LAYOUT);
            delete this._initData.layout
        }
        return a
    },
    _add: function(b, a) {
        var c = DNA.widget.Composite.superclass._add.call(this, b, a);
        return c
    },
    clear: function() {
        var d = this.getChildren();
        if (d) {
            var b = d.length;
            for (var a = 0; a < b; a++) {
                d[a].dispose(false)
            }
        }
        if (!DNA.adapter.browserPage.getIframeManager().has(this.getEid())) {
            this.getBody().innerHTML = ""
        }
        var c = this.getParent();
        if (c && c.__doAfterChildClear) {
            c.__doAfterChildClear(this)
        }
    },
    _removeFlowHtml: function() {
        if (this.doc) {
            DNA.engine.application.unHandleIframe(this);
            delete this.doc
        }
    },
    doDispose: function() {
        DNA.widget.Composite.superclass.doDispose.call(this);
        delete this._body
    },
    cacheComputeSize: function(a) {
        this._computeSize = a
    },
    clearComputeSize: function() {
        delete this._computeSize
    },
    computeSize: function(d, b, h) {
        if (this._computeSize) {
            return this._computeSize
        }
        var c;
        var g = this.getLayout();
        if (g) {
            if (d == DNA.JWT.DEFAULT || b == DNA.JWT.DEFAULT) {
                c = g.computeSize(this, d, b, h)
            } else {
                c = new DNA.widget.Point(d,b)
            }
        } else {
            c = this._minimumSize(d, b, h)
        }
        if (c.x == 0) {
            c.x = DNA.JWT.DEFAULT_WIDTH
        }
        if (c.y == 0) {
            c.y = DNA.JWT.DEFAULT_HEIGHT
        }
        if (d != DNA.JWT.DEFAULT) {
            c.x = d
        }
        if (b != DNA.JWT.DEFAULT) {
            c.y = b
        }
        var a = this.getBorderSize();
        c.x += a;
        c.y += a;
        return c
    },
    _minimumSize: function(c, l, d) {
        var b = this.getChildren();
        var a = 0
          , n = 0;
        if (b) {
            for (var g = 0, h = b.length; g < h; g++) {
                var m = b[g].getBounds();
                a = Math.max(a, m.x + m.width);
                n = Math.max(n, m.y + m.height)
            }
        }
        return new DNA.widget.Point(a,n)
    },
    layout: function() {
        var a = this.getLayout();
        if (a) {
            a.layout(this, true)
        }
    },
    animatedLayout: function(a, n) {
        var d = this._reboundsChildren;
        if (!d) {
            d = this._reboundsChildren = []
        }
        d.push(a);
        if (d.length == n) {
            var p = [];
            var o = [];
            for (var b = 0; b < n; b++) {
                var c = d[b];
                var m = new DNA.engine.Sprite(c.w);
                m.setBounds(c.b0);
                p.push(m);
                var h = new DNA.engine.Sprite(c.w);
                h.setBounds(c.b1);
                o.push(h)
            }
            delete this._reboundsChildren;
            var l = new DNA.engine.Frame(p);
            var g = new DNA.engine.Frame(o);
            var q = new DNA.engine.LinearMotion(l,g,20,200);
            new DNA.engine.Animation(q).play()
        }
        return d.length
    },
    _resize: function(d, c) {
        var a = this._bounds;
        if (d != false) {
            this.layout()
        }
    },
    _insertIntoSortedArray: function(h, g, b) {
        if (!h[0] || b > h[0].getTabIndex()) {
            h.insert(g, 0);
            return
        }
        var a = h.length - 1;
        for (var d = 0; d < a; d++) {
            if (b <= h[d].getTabIndex() && b >= h[d + 1].getTabIndex()) {
                h.insert(g, d + 1);
                return
            }
        }
        h.insertLast(g)
    },
    _getTabList: function(h) {
        var g = this.getChildren();
        if (!g) {
            return g
        }
        var b = null ;
        for (var d = 0, a = g.length; d < a; ) {
            var c = g[d].getTabIndex();
            if (c == -1 || g[d].isEnabled() !== true) {
                g.removeAt(d);
                a--;
                continue
            }
            if (c) {
                if (!b) {
                    b = new Array()
                }
                this._insertIntoSortedArray(b, g[d], c);
                g.removeAt(d);
                a--;
                continue
            }
            d++
        }
        if (b) {
            for (var d = 0, a = b.length; d < a; d++) {
                g.insertFirst(b[d])
            }
        }
        if (h === true) {
            return g.reverse()
        }
        return g
    },
    _checkInnerComp: function(h, d, b) {
        var a = h.getInnerComp();
        if (a) {
            return a._findNextTabAnchor(null , d)
        }
        var g = h.getParent();
        return g._findNextTabAnchor(h, d, true)
    },
    _findNextTabAnchor_withNoChild: function(b) {
        var a = this.getParent();
        if (a instanceof DNA.widget.Menu) {
            return null 
        }
        var c = this;
        while (!(a instanceof DNA.widget.Composite)) {
            c = a;
            a = a.getParent()
        }
        return a._findNextTabAnchor(c, b, true)
    },
    _findNextTabAnchor_withLastChild: function(b) {
        if (this.getTabIndex() == -1) {
            return this._findNextTabAnchor(null , b)
        } else {
            var a = this.getParentControl();
            if (a instanceof DNA.widget.Menu) {
                return this._findNextTabAnchor(null , b)
            } else {
                var c = this;
                while (!(a instanceof DNA.widget.Composite)) {
                    c = a;
                    if (a.getTabIndex() == -1) {
                        return this._findNextTabAnchor(null , b)
                    }
                    a = a.getParentControl()
                }
                return a._findNextTabAnchor(c, b, true)
            }
        }
    },
    _findNextTabAnchor: function(m, l, g, h) {
        if (!h && !g && DNA.engine.application.getFocusListener()._isNoFocusedInTheTopLevelComposite(this, m)) {
            return null 
        }
        if (h && !g && m && m.getInnerComp) {
            return this._checkInnerComp(m, l, g)
        }
        var b = this._getTabList(l);
        if (!b) {
            return this._findNextTabAnchor_withNoChild(l)
        }
        var d = m ? b.indexOf(m) + 1 : 0;
        for (; d < b.length; d++) {
            var m = b[d];
            if (m instanceof DNA.widget.Control && m.canFocus() && m.isVisible()) {
                return m
            }
            if (m instanceof DNA.widget.Composite) {
                return m._findNextTabAnchor(null , l)
            }
            if (m.getInnerComp) {
                var a = m.getInnerComp();
                if (a) {
                    return m.getInnerComp()._findNextTabAnchor(null , l)
                }
            }
        }
        return this._findNextTabAnchor_withLastChild(l)
    }
});
DNA.widget.Shell = function(a) {
    DNA.widget.Shell.superclass.constructor.call(this, a);
    var d = this.getEid();
    document.documentElement.unselectable = "on";
    var c = a[DNA.JWTProperty.PROPERTY_TITLE];
    if (c) {
        this.setTitle(c);
        delete a[DNA.JWTProperty.PROPERTY_TITLE]
    }
    var b = a[DNA.JWTProperty.PROPERTY_STATUS];
    if (b) {
        this.setStatus(b);
        delete a[DNA.JWTProperty.PROPERTY_STATUS]
    }
    this._locale = a[DNA.JWTProperty.PROPERTY_LOCALE];
    this._locale = this._locale || "zh_CN";
    delete a[DNA.JWTProperty.PROPERTY_LOCALE]
}
;
DNA.widget.Shell.extend(DNA.widget.Composite, {
    jtype: "Shell",
    clear: function() {
        if (DNA._isURLMode()) {
            var c = this.getChildren();
            if (c) {
                var b = c.length;
                for (var a = 0; a < b; a++) {
                    c[a].dispose()
                }
            }
        } else {
            DNA.widget.Shell.superclass.clear.call(this)
        }
    },
    getLocale: function() {
        return this._locale
    },
    setTitle: function(a) {
        document.title = a
    },
    getTitle: function() {
        return document.title
    },
    setStatus: function(a) {
        window.defaultStatus = a
    },
    getStatus: function() {
        return window.defaultStatus
    },
    _setFocused: function(a) {
        this._focused = a
    },
    getFocused: function() {
        if (this._focused != null ) {
            if (!this._focused.isDisposed()) {
                return this._focused
            } else {
                this._setFocused(null );
                return null 
            }
        }
    },
    _findNextTabAnchor_withNoChild: function(a) {
        return null 
    },
    _findNextTabAnchor_withLastChild: function(a) {
        return this._findNextTabAnchor(null , a)
    }
});
DNA.widget.Window = function(b) {
    DNA.widget.Window.superclass.constructor.call(this, b);
    this._childWins = [];
    this._winState = this._WindowState.DEFAULT;
    if (this.getStyle() & DNA.JWT.RESIZE) {
        this._resizeable = true
    }
    var c = this.getInitData()[DNA.JWTProperty.PROPERTY_MINIMUM_WIDTH];
    if (c) {
        this._minWidth = c;
        delete this.getInitData()[DNA.JWTProperty.PROPERTY_MINIMUM_WIDTH]
    }
    var h = this.getInitData()[DNA.JWTProperty.PROPERTY_MINIMUM_HEIGHT];
    if (h) {
        this._minHeight = h;
        delete this.getInitData()[DNA.JWTProperty.PROPERTY_MINIMUM_HEIGHT]
    }
    var a = this.getInitData()[DNA.JWTProperty.PROPERTY_PARENT_WINDOW_HANDLE];
    if (a) {
        this.setParentHandle(a)
    }
    var d = this.getInitData()[DNA.JWTProperty.PROPERTY_WINDOW_HANDLE];
    if (d) {
        this.setHandle(d)
    }
    if (this.getStyle() & DNA.JWT.MODAL) {
        var g = "#";
        if (DNA.engine.Client.isChrome() || DNA.engine.Client.isSafari()) {
            g = ""
        }
        this._mask = DNA.engine.DomUtil.append(DNA.engine.application.getBrowserBody(), "<div id=" + this.getEid() + ' class="window-mask" unselectable="on" style="display:none;position:absolute;left:0px;top:0px;width: 100%;height: 100%;"><div unselectable="on" style="position:absolute;width:100%;height:100%"></div><iframe src="' + g + '" unselectable="on" style="z-index:-1;width:100%;height:100%;filter: alpha(opacity=0)"></iframe></div>');
        if (DNA.engine.Client.isIE()) {
            this._resizeMask()
        }
    }
    DNA.engine.application.getWindowMgr().register(this)
}
;
DNA.widget.Window.extend(DNA.widget.Composite, {
    jtype: "Window",
    _closeReg: /close/i,
    _maxReg: /maximize/i,
    _minReg: /minimize/i,
    _WindowState: {
        MAXIMIZED: 1,
        DEFAULT: 0,
        MINIMIZED: -1
    },
    _zIndex: 0,
    _setFont: function(a) {
        var b = this._titleEl;
        if (b) {
            DNA.engine.DomUtil.setFont(b, a)
        }
    },
    _setForeground: function(b) {
        var a = this._titleEl;
        if (a) {
            a.style.color = b || ""
        }
    },
    _setBackground: function(a) {
        if (this.checkRendered(true)) {
            this._body.style.backgroundColor = a || ""
        }
    },
    _setBackimage: function(a) {
        if (this.checkRendered(true)) {
            if (a) {
                this._body.style.backgroundImage = "url(" + a.url + ")"
            } else {
                this._body.style.backgroundImage = ""
            }
        }
    },
    getDragger: function(d) {
        var a = d.getSrcElement();
        var c = DNA.engine.DomUtil.findParent(a, "*[resize*=resize]");
        if (c && this._resizeable === true) {
            var b = c.getAttribute("resize");
            return new DNA.widget.DragResize(b)
        } else {
            c = DNA.engine.DomUtil.findParent(a, "*[class*=draggable]");
            if (c && this._draggable === true) {
                return new DNA.widget.DragMove()
            }
        }
    },
    _changeToClientXY: function(a) {
        a.x += this.__OUT_BORDER_WIDTH;
        a.y += this.getTitleHeight() + this.__OUT_BORDER_HEIGHT;
        return a
    },
    _changeToClientSize: function(a) {
        a.width -= this.__OUT_BORDER_WIDTH2;
        a.height -= (this.__OUT_BORDER_HEIGHT2 + this.getTitleHeight());
        return a
    },
    _changeToClientArea: function(a) {
        a = this._changeToClientXY(a);
        a = this._changeToClientSize(a);
        return a
    },
    _setPageXY: function(b) {
        var a = new DNA.widget.Point();
        a.x = b.x;
        a.y = b.y;
        a = this._changeToClientXY(a);
        this.setLocation(a.x, a.y);
        DNA.engine.application.getJWTEventMgr()._fireGlobleEvent("bounds_change", [this])
    },
    _dragResizeEnd: new DNA.engine.Action({
        handle: function(a) {
            a = this._changeToClientArea(a);
            this.setBounds(a)
        }
    }),
    _registEvents: function() {
        if (((DNA.engine.Client.isIE() || DNA.engine.Client.isFF()) && (this.getStyle() & DNA.JWT.MODAL)) || (this.getStyle() & DNA.JWT.MAXIMUM)) {
            DNA.engine.application.getJWTEventMgr().addListener(DNA.JWTEvent.RESIZE, this._resizeAction, this)
        }
        this.addListener(DNA.JWTEvent.MOUSEUP, this._mouseupAction);
        this.addListener(DNA.JWTEvent.INNERMOUSEOVER, this._innermouseoverAction);
        this.addListener(DNA.JWTEvent.MOUSEOUT, this._mouseoutAction);
        this.addListener(DNA.JWTEvent.MOUSEDOWN, this._mousedownAction);
        this.addListener(DNA.JWTEvent.DRAGRESIZEEND, this._dragResizeEnd);
        if (this.getStyle() & DNA.JWT.MAXIMUM) {
            this.addListener(DNA.JWTEvent.DBLCLICK, this._dbclickAction)
        }
    },
    _removeFlowHtml: function() {
        if (this.getStyle() & DNA.JWT.MODAL) {
            DNA.engine.DomUtil.dispose(this._mask);
            delete this._mask
        }
        var a = this._parentWin;
        if (a && a._childWins) {
            a._childWins.remove(this)
        }
    },
    getTitleHeight: function() {
        var a = 0;
        if (this.checkRendered(true)) {
            var c = this._textEl.innerHTML;
            if ((this.getStyle() & DNA.JWT.CLOSE) != 0 || (this.getStyle() & DNA.JWT.MAXIMUM) != 0 || (this.getStyle() & DNA.JWT.MINIMUM) != 0) {
                a = this.TITLE_HEIGHT
            }
            var b = this._imageEl.firstChild;
            if (b) {
                a = Math.max(b.height, a)
            }
            if (c && c != "&nbsp;") {
                a = Math.max(DNA.engine.DomUtil.computeTextSize(c, this.getFont()).height, a)
            }
        }
        return a
    },
    _setFocused: function(a) {
        this._focused = a
    },
    getFocused: function() {
        if (this._focused != null ) {
            if (!this._focused.isDisposed()) {
                return this._focused
            } else {
                this._setFocused(null );
                return null 
            }
        }
    },
    _resizeable: false,
    _draggable: true,
    computeSize: function(c, a, d) {
        var b = DNA.widget.Window.superclass.computeSize.call(this, c, a, d);
        return b
    },
    pack: function() {
        var a = this.computeSize(-1, -1, true);
        this.setSize(a)
    },
    setMinimumSize: function(d, g) {
        if (d) {
            this._minWidth = d
        }
        if (g) {
            this._minHeight = g
        }
        var b = this._bounds;
        if ((this._minWidth && b.width < this._minWidth) || (this._minHeight && b.height < this._minHeight)) {
            var a = this._minWidth ? (b.width < this._minWidth ? b.width : this._minWidth) : b.width;
            var c = this._minHeight ? (b.height < this._minHeight ? b.height : this._minHeight) : this._minHeight;
            this.setSize(a, c)
        }
    },
    _getMinHeight: function() {
        if (this._minHeight) {
            return this._minHeight
        } else {
            return this.getTitleHeight() + this.__OUT_BORDER_HEIGHT2
        }
    },
    _getMinWidth: function() {
        if (this._minWidth) {
            return this._minWidth
        } else {
            if (this.checkRendered(true)) {
                var a = this.__OUT_BORDER_WIDTH2;
                var b = this._imageEl.firstChild;
                if (b) {
                    a += b.width
                }
                if ((this.getStyle() & DNA.JWT.CLOSE) != 0) {
                    a += 15
                }
                if ((this.getStyle() & DNA.JWT.MAXIMUM) != 0) {
                    a += 15
                }
                if ((this.getStyle() & DNA.JWT.MINIMUM) != 0) {
                    a += 15
                }
                return a
            }
        }
    },
    setIcon: function(a) {
        if (this.checkRendered(true)) {
            this._imageEl.innerHTML = a ? a.getHTML() : "";
            var b = this.getTitleHeight();
            if (b == 0) {
                this._titleEl.style.display = "none"
            } else {
                this._titleEl.style.display = ""
            }
        }
    },
    setTitle: function(b) {
        if (this.checkRendered(true)) {
            this._textEl.innerHTML = b || "&nbsp;";
            var a = this.getTitleHeight();
            if (a == 0) {
                this._titleEl.style.display = "none"
            } else {
                this._titleEl.style.display = ""
            }
        }
    },
    getClientArea: function() {
        var a = this.getBounds();
        return new DNA.widget.Rectangle(0,0,a.width,a.height)
    },
    getClientRectangle: function() {
        var a = this.getClientArea();
        a.x = this.__OUT_BORDER_WIDTH;
        a.y = this.__OUT_BORDER_HEIGHT;
        return a
    },
    _resizeMask: function() {
        DNA.engine.DomUtil.setStyle(this._mask, "height", DNA.engine.application.getShell().getBounds().height + "px")
    },
    _resizeAction: new DNA.engine.Action({
        handle: function() {
            if (this._mask) {
                this._resizeMask()
            }
            if (this._winState == this._WindowState.MAXIMIZED) {
                var a = DNA.engine.application.getShell().getBounds();
                a = this._changeToClientArea(a);
                this.setSize(a.width, a.height)
            }
        }
    }),
    _disposeDOM: function() {
        if (this._mask) {
            DNA.engine.DomUtil.dispose(this._mask);
            delete this._mask
        }
        this._focusNextWindow()
    },
    doDispose: function() {
        DNA.widget.Window.superclass.doDispose.call(this);
        delete this._childWins;
        delete this._topEl;
        delete this._imageEl;
        delete this._textEl;
        delete this._leftEl;
        delete this._rightEl;
        delete this._footEl;
        delete this._maxEl;
        delete this._minEl;
        delete this._closeEl;
        delete this._titleEl
    },
    _doBuildElements: function() {
        this._body = this.el.childNodes[5];
        this._topEl = this.el.childNodes[1];
        var a = this._titleEl = this.el.childNodes[3].firstChild;
        this._imageEl = a.firstChild.firstChild.childNodes[2];
        this._textEl = a.firstChild.firstChild.childNodes[3];
        this._leftEl = this.el.childNodes[4];
        this._rightEl = this.el.childNodes[6];
        this._footEl = this.el.childNodes[8];
        this._maxEl = DNA.engine.DomUtil.findChild(a.firstChild.firstChild, "td[el*=maximize]");
        this._minEl = DNA.engine.DomUtil.findChild(a.firstChild.firstChild, "td[el*=minimize]");
        this._closeEl = DNA.engine.DomUtil.findChild(a.firstChild.firstChild, "td[el*=close]")
    },
    _initWindowSizeInfo: function() {
        var a = this._topEl.previousSibling;
        var c = this.__OUT_BORDER_HEIGHT = parseInt(a.style.height) || (a.offsetWidth ? a.offsetHeight : 0);
        var d = this._footEl.previousSibling;
        var b = this.__OUT_BORDER_WIDTH = parseInt(d.style.width) || d.offsetWidth;
        this.__OUT_BORDER_HEIGHT_B = parseInt(d.style.height) || d.offsetHeight;
        this.__OUT_BORDER_WIDTH2 = b + b;
        this.__OUT_BORDER_HEIGHT2 = c + this.__OUT_BORDER_HEIGHT_B;
        this.TITLE_HEIGHT = parseInt(this._titleEl.style.height) || this._titleEl.offsetHeight
    },
    _doSpecialRerender: function() {
        if (DNA.engine.Client.isIE()) {
            var a = this.getEl().lastChild;
            var b = a.style;
            b.position = "relative";
            b.position = "absolute"
        }
    },
    _afterBuild: function() {
        this._initWindowSizeInfo();
        if (this.getInitData()[DNA.JWTProperty.PROPERTY_WINDOW_MAXIMUM]) {
            var a = new DNA.widget.Point();
            a = this._changeToClientXY(a);
            this._draggable = false;
            this._resizeable = false;
            this._lastWinState = this._winState;
            this._winState = this._WindowState.MAXIMIZED;
            delete this.getInitData()[DNA.JWTProperty.PROPERTY_WINDOW_MAXIMUM]
        }
        this._doSpecialRerender()
    },
    _mousedownAction: new DNA.engine.Action({
        handle: function(a) {
            if (this.checkRendered(true)) {
                var b = a.getSrcElement();
                if ((this.getStyle() & DNA.JWT.MODAL) && DNA.engine.DomUtil.isChildren(b, this._mask, 2)) {
                    DNA.engine.application.getWindowMgr().shake(this);
                    return
                }
                if (b == this._closeEl) {
                    this._updateState(b, "active", true);
                    this._updateState(this._maxEl, "active", false);
                    this._updateState(this._minEl, "active", false)
                } else {
                    if (b == this._maxEl) {
                        this._updateState(this._closeEl, "active", false);
                        this._updateState(b, "active", true);
                        this._updateState(this._minEl, "active", false)
                    } else {
                        if (b == this._minEl) {
                            this._updateState(this._closeEl, "active", false);
                            this._updateState(this._maxEl, "active", false);
                            this._updateState(b, "active", true)
                        } else {
                            this._updateState(this._closeEl, "active", false);
                            this._updateState(this._maxEl, "active", false);
                            this._updateState(this._minEl, "active", false)
                        }
                    }
                }
            }
        }
    }),
    _innermouseoverAction: new DNA.engine.Action({
        handle: function(a) {
            if (this.checkRendered(true)) {
                var b = a.getSrcElement();
                if (b == this._closeEl) {
                    this._updateState(b, "hover", true);
                    this._updateState(this._maxEl, "hover", false);
                    this._updateState(this._minEl, "hover", false)
                } else {
                    if (b == this._maxEl) {
                        this._updateState(this._closeEl, "hover", false);
                        this._updateState(b, "hover", true);
                        this._updateState(this._minEl, "hover", false)
                    } else {
                        if (b == this._minEl) {
                            this._updateState(this._closeEl, "hover", false);
                            this._updateState(this._maxEl, "hover", false);
                            this._updateState(b, "hover", true)
                        } else {
                            this._updateState(this._closeEl, "hover", false);
                            this._updateState(this._maxEl, "hover", false);
                            this._updateState(this._minEl, "hover", false)
                        }
                    }
                }
            }
        }
    }),
    _mouseoutAction: new DNA.engine.Action({
        handle: function(a) {
            if (this.checkRendered(true)) {
                this._updateState(this._closeEl, "hover", false);
                this._updateState(this._maxEl, "hover", false);
                this._updateState(this._minEl, "hover", false)
            }
        }
    }),
    _mouseupAction: new DNA.engine.Action({
        handle: function(a) {
            var b = a.getSrcElement();
            if (this.checkRendered(true)) {
                if (b == this._closeEl) {
                    this.fireEvent("close", [a, this])
                } else {
                    if (b == this._maxEl) {
                        if (b.className.match(this._maxReg)) {
                            this.maximize()
                        } else {
                            this._restore()
                        }
                    } else {
                        if (b == this._minEl) {
                            if (b.className.match(this._minReg)) {
                                this._minimize()
                            } else {
                                this._restore()
                            }
                        }
                    }
                }
            }
        }
    }),
    _isDomReceiveDblClickEvent: function(a) {
        if (a == this._textEl) {
            return true
        }
        return false
    },
    _dbclickAction: new DNA.engine.Action({
        handle: function(b) {
            var a = b.getSrcElement();
            if (this._isDomReceiveDblClickEvent(a)) {
                if (this._winState == this._WindowState.MAXIMIZED) {
                    this._restore()
                } else {
                    this.maximize()
                }
            }
        }
    }),
    setHandle: function(a) {
        this._handle = a
    },
    setParentHandle: function(a) {
        this._parentHandle = a
    },
    _setParentWin: function(a) {
        this._parentWin = a
    },
    _setZIndex: function(a) {
        this._zIndex = a;
        DNA.engine.DomUtil.setStyle(this.getEl(), "z-index", a);
        DNA.engine.DomUtil.setStyle(this.getEl(), "innerorder", a);
        if (this.getStyle() & DNA.JWT.MODAL) {
            DNA.engine.DomUtil.setStyle(this._mask, "z-index", a - 1)
        }
    },
    setVisible: function(a) {
        if (a) {
            this.open()
        } else {
            this.close()
        }
    },
    open: function() {
        DNA.widget.Window.superclass.setVisible.call(this, true);
        var a = !!(this.getStyle() & DNA.JWT.MODAL);
        if (a) {
            this._mask.style.display = ""
        }
        DNA.engine.application.getFocusListener()._blurFocusedControl();
        DNA.engine.application.getMenuMgr()._clearBarCache(a);
        if (DNA.engine.application.isAnimated()) {
            DNA.engine.application.getWindowMgr().appear(this)
        } else {
            this._initZIndex()
        }
    },
    _initZIndex: function() {
        if (!this._zIndex) {
            var a = DNA.engine.application.getWindowMgr();
            this._setZIndex(a.getTopWindowZIndexPlusInterval());
            a.bring2Front(this)
        }
    },
    close: function() {
        if (this.getStyle() & DNA.JWT.MODAL) {
            this._mask.style.display = "none"
        }
        DNA.widget.Window.superclass.setVisible.call(this, false);
        this._focusNextWindow();
        if (DNA.engine.application.isAnimated()) {
            DNA.engine.application.getWindowMgr().disappear(this)
        }
    },
    dispose: function() {
        delete this._focused;
        DNA.widget.Window.superclass.dispose.call(this);
        DNA.engine.application.getWindowMgr().unregister(this);
        this._focusNextWindow();
        DNA.engine.application.getJWTEventMgr().removeListener(this, DNA.JWTEvent.RESIZE, this._resizeAction);
        if (DNA.engine.application.isAnimated() && this.getVisible()) {
            DNA.engine.application.getWindowMgr().disappear(this)
        }
    },
    _focusNextWindow: function() {
        var b = DNA.engine.application.getFocusListener();
        var a = b._getCurrentWindow();
        if (a && a instanceof DNA.widget.Window) {
            DNA.engine.application.getWindowMgr().setActiveWin(a)
        }
        var c = a._focused;
        if (c) {
            c.focus()
        }
    },
    _restore: function() {
        if (this._winState == this._WindowState.MINIMIZED) {
            this.setBounds(this._lastBounds);
            this._winState = this._lastWinState
        } else {
            if (!this._defaultWinBounds) {
                this._pack2Center()
            } else {
                this.setBounds(this._defaultWinBounds)
            }
            this._winState = this._WindowState.DEFAULT
        }
        if (this.checkRendered(true)) {
            if (this._winState == this._WindowState.DEFAULT) {
                this._draggable = true;
                this._resizeable = true;
                if (this.getStyle() & DNA.JWT.MINIMUM) {
                    this._minEl.className = "j-tool j-tool-minimize"
                }
                if (this.getStyle() & DNA.JWT.MAXIMUM) {
                    this._maxEl.className = "j-tool j-tool-maximize"
                }
            } else {
                if (this._winState == this._WindowState.MAXIMIZED) {
                    if (this.getStyle() & DNA.JWT.MINIMUM) {
                        this._minEl.className = "j-tool j-tool-minimize"
                    }
                    if (this.getStyle() & DNA.JWT.MAXIMUM) {
                        this._maxEl.className = "j-tool j-tool-restore"
                    }
                }
            }
        }
    },
    maximize: function() {
        if (this.checkRendered(true)) {
            if (this._maxEl) {
                this._maxEl.className = "j-tool j-tool-restore"
            }
            if (this.getStyle() & DNA.JWT.MINIMUM) {
                this._minEl.className = "j-tool j-tool-minimize"
            }
            if (this._winState == this._WindowState.DEFAULT) {
                this._defaultWinBounds = this.getBounds()
            }
            this.setBounds(this._changeToClientArea(DNA.engine.application.getShell().getBounds()));
            this._draggable = false;
            this._resizeable = false;
            this._lastWinState = this._winState;
            this._winState = this._WindowState.MAXIMIZED
        }
    },
    _minimize: function() {
        if (this.checkRendered(true)) {
            this._minEl.className = "j-tool j-tool-restore";
            if (this.getStyle() & DNA.JWT.MAXIMUM) {
                this._maxEl.className = "j-tool j-tool-maximize"
            }
            if (this._winState == this._WindowState.DEFAULT) {
                this._defaultWinBounds = this.getBounds()
            }
            this._lastBounds = this.getBounds();
            this.setSize(this._lastBounds.width, this._getMinHeight() - (this.__OUT_BORDER_HEIGHT2 + this.getTitleHeight()));
            this._draggable = (this._winState == this._WindowState.MAXIMIZED) ? true : this._draggable;
            this._resizeable = false;
            this._lastWinState = this._winState;
            this._winState = this._WindowState.MINIMIZED
        }
    },
    _updateState: function(c, d, a) {
        if (!c || !c.className) {
            return
        }
        if (!d || (d != "hover" && d != "active")) {
            return
        }
        var b = c.className;
        if (a) {
            if (d == "hover" && b.indexOf("-hover") == -1) {
                c.className = b.replace("-active", "").trim() + "-hover"
            } else {
                if (d == "active" && b.indexOf("-active") == -1) {
                    c.className = b.replace("-hover", "").trim() + "-active"
                }
            }
        } else {
            c.className = b.replace("-hover", "").replace("-active", "")
        }
    },
    setSize: function(b, d) {
        var a = this._getMinWidth();
        var c = this._getMinHeight();
        var g = DNA.engine.application.getShell().getBounds();
        if (b < 0) {
            b = 0
        } else {
            if (b > g.width) {
                b = g.width
            }
        }
        if (d < 0) {
            d = 0
        } else {
            if (d > g.height) {
                d = g.height
            }
        }
        DNA.widget.Window.superclass.setSize.call(this, b, d)
    },
    _setLocation: function(a, b) {
        if (this.checkRendered(true)) {
            a -= this.__OUT_BORDER_WIDTH;
            b -= this.getTitleHeight() + this.__OUT_BORDER_HEIGHT;
            DNA.widget.Window.superclass._setLocation.call(this, a, b)
        }
    },
    _setSize: function(a, c) {
        if (this.checkRendered(true)) {
            a += this.__OUT_BORDER_WIDTH2;
            c += this.getTitleHeight() + this.__OUT_BORDER_HEIGHT2;
            DNA.widget.Window.superclass._setSize.call(this, a, c);
            if (DNA.engine.Client.isIE()) {
                var b = this.el.lastChild;
                DNA.engine.DomUtil.setWidth(b, a);
                DNA.engine.DomUtil.setHeight(b, c)
            }
        }
    },
    _resizeBody: function(b, a) {
        DNA.engine.DomUtil.setStyle(this._body, "width", b + "px");
        DNA.engine.DomUtil.setStyle(this._body, "height", a + "px");
        if (b > 0 && a > 0 && this.getLayout()) {
            this.layout()
        }
    },
    _resize: function() {
        var c = this.getClientArea();
        var b = c.width;
        var a = c.height;
        if (this.__OUT_BORDER_HEIGHT != 0) {
            DNA.engine.DomUtil.setStyle(this._topEl, "width", b + "px")
        }
        DNA.engine.DomUtil.setStyle(this._titleEl, "width", b + this.__OUT_BORDER_WIDTH2 + "px");
        DNA.engine.DomUtil.setStyle(this._leftEl, "height", a + "px");
        DNA.engine.DomUtil.setStyle(this._rightEl, "height", a + "px");
        DNA.engine.DomUtil.setStyle(this._footEl, "width", b + "px");
        this._resizeBody(b, a)
    },
    _pack2Center: function() {
        var g = new DNA.widget.Rectangle(0,0,0,0);
        var m = DNA.engine.DomUtil.getViewSize();
        var c = this.computeSize(-1, -1, true);
        g.width = c.x;
        g.height = c.y;
        var b = this.__OUT_BORDER_WIDTH2;
        var h = this.__OUT_BORDER_HEIGHT2;
        var l = this.getTitleHeight();
        var d = g.width + b;
        var a = g.height + h + l;
        d = d > m.width ? m.width : d;
        a = a > m.height ? m.height : a;
        g.width = d - b;
        g.height = a - h - l;
        g.x = (m.width - d) / 2 + this.__OUT_BORDER_WIDTH;
        g.y = (m.height - a) / 2 + this.__OUT_BORDER_HEIGHT + l;
        this.setBounds(g)
    },
    _clientLayout: function() {
        if (this.checkRendered(true)) {
            var a = this.getBounds();
            var l = new DNA.widget.Rectangle(0,0,0,0);
            var h = DNA.engine.DomUtil.getViewSize();
            var m = this.getInitData()[DNA.JWTProperty.PROPERTY_WINDOW_MAXIMUM];
            if (m === true) {
                l.width = h.width;
                l.height = h.height
            } else {
                if (this.getInitData()[DNA.JWTProperty.PROPERTY_PACK] != null ) {
                    var p = this.computeSize(-1, -1, true);
                    l.width = p.x;
                    l.height = p.y
                } else {
                    if (!a || (a.width == 0 && a.height == 0)) {
                        l.width = 400;
                        l.height = 300
                    } else {
                        l.width = a.width;
                        l.height = a.height
                    }
                }
            }
            var o = this.__OUT_BORDER_WIDTH2;
            var g = this.__OUT_BORDER_HEIGHT2;
            var d = this.getTitleHeight();
            var c = l.width + o;
            var n = l.height + g + d;
            c = c > h.width ? h.width : c;
            n = n > h.height ? h.height : n;
            l.width = c - o;
            l.height = n - g - d;
            if (!a || (a.x <= 0 && a.y <= 0)) {
                l.x = (h.width - c) / 2 + this.__OUT_BORDER_WIDTH;
                l.y = (h.height - n) / 2 + this.__OUT_BORDER_HEIGHT + d
            } else {
                l.x = a.x;
                l.y = a.y
            }
            this.setBounds(l)
        }
    },
    _findNextTabAnchor_withNoChild: function(a) {
        return null 
    },
    _findNextTabAnchor_withLastChild: function(a) {
        return this._findNextTabAnchor(null , a)
    }
});
DNA.widget.WindowNoTrim = function(a) {
    DNA.widget.WindowNoTrim.superclass.constructor.superclass.constructor.call(this, a);
    this._childWins = [];
    if (this.getStyle() & DNA.JWT.MODAL) {
        var b = "#";
        if (DNA.engine.Client.isChrome() || DNA.engine.Client.isSafari()) {
            b = ""
        }
        this._mask = DNA.engine.DomUtil.append(DNA.engine.application.getBrowserBody(), '<div class="window-mask" unselectable="on" style="display:none;position:absolute;left:0px;top:0px;width: 100%;height: 100%;"><div unselectable="on" style="position:absolute;width:100%;height:100%"></div><iframe src="' + b + '" unselectable="on" style="z-index:-1;width:100%;height:100%;filter: alpha(opacity=0)"></iframe></div>');
        if (DNA.engine.Client.isIE()) {
            this._resizeMask()
        }
    }
    DNA.engine.application.getWindowMgr().register(this)
}
;
DNA.widget.WindowNoTrim.extend(DNA.widget.Window, {
    jtype: "Window",
    setIcon: function(a) {},
    setMinimumSize: function(a, b) {},
    maximize: function() {
        this.setBounds(this._changeToClientArea(DNA.engine.application.getShell().getBounds()))
    },
    _registEvents: function() {
        if ((DNA.engine.Client.isIE() && (this.getStyle() & DNA.JWT.MODAL)) || (this.getStyle() & DNA.JWT.MAXIMUM)) {
            DNA.engine.application.getJWTEventMgr().addListener(DNA.JWTEvent.RESIZE, this._resizeAction, this)
        }
    },
    getDragger: undefined,
    _doBuildElements: function() {
        this._body = this.el.childNodes[0]
    },
    _afterBuild: function() {
        this._initWindowSizeInfo();
        this._doSpecialRerender()
    },
    _initWindowSizeInfo: function() {
        this.__OUT_BORDER_WIDTH = 0;
        this.__OUT_BORDER_HEIGHT_B = 0;
        this.__OUT_BORDER_WIDTH2 = 0;
        this.__OUT_BORDER_HEIGHT = 0;
        this.__OUT_BORDER_HEIGHT2 = 0
    },
    setTitle: function(a) {},
    _resizeMask: function() {
        DNA.engine.DomUtil.setStyle(this._mask, "height", DNA.engine.application.getShell().getBounds().height + "px")
    },
    _doResizeMask: function() {
        if (this._mask) {
            this._resizeMask()
        }
    },
    _resizeAction: new DNA.engine.Action({
        handle: function() {
            this._doResizeMask()
        }
    }),
    getTitleHeight: function() {
        return 0
    },
    doDispose: function() {
        DNA.widget.WindowNoTrim.superclass.constructor.superclass.doDispose.call(this);
        if (this._parentWin) {
            this._parentWin._childWins.remove(this)
        }
        delete this._childWins
    },
    setSize: function(a, b) {
        DNA.widget.WindowNoTrim.superclass.constructor.superclass.setSize.call(this, a, b)
    },
    _setSize: function(a, b) {
        DNA.widget.WindowNoTrim.superclass.constructor.superclass._setSize.call(this, a, b)
    },
    _setLocation: function(a, b) {
        if (this.checkRendered(true)) {
            DNA.widget.Window.superclass.constructor.superclass._setLocation.call(this, a, b)
        }
    },
    maximize: function() {
        if (this.checkRendered(true)) {
            this.setBounds(this._changeToClientArea(DNA.engine.application.getShell().getBounds()))
        }
    },
    _resize: function() {
        if (!this.checkRendered(true)) {
            return
        }
        var a = this.getClientArea();
        this._resizeBody(a.width, a.height)
    }
});
DNA.widget.Root = function(a) {
    DNA.widget.Root.superclass.constructor.call(this, a);
    var b = this.el = document.body;
    b.id = a.eid;
    if (DNA.engine.application.isAnimated()) {
        DNA.engine.Animation.showLoadingMask({
            x: 0,
            y: 0,
            width: window.screen.width,
            height: window.screen.height
        })
    }
}
;
DNA.widget.Root.extend(DNA.widget.Composite, {
    jtype: "Root",
    getBody: function() {
        return this.el
    },
    getEl: function() {
        return this.el
    },
    removeLoading: function() {
        if (DNA.engine.application.isAnimated()) {
            DNA.engine.Animation.hideLoadingMask()
        }
    }
});
DNA.widget.Iteration = function(a) {
    DNA.widget.Iteration.superclass.constructor.call(this, a);
    this._selected = []
}
;
DNA.widget.Iteration.extend(DNA.widget.Control, {
    getBody: function() {
        if (this.checkRendered(true)) {
            return this._body || this.getEl()
        }
    },
    insertChildHtml: function(b, a) {
        if (b) {
            this._add(b, a)
        } else {
            this._add(undefined, a)
        }
    },
    appendChildHtml: function(a) {
        this._add(null , a)
    },
    _add: function(b, a) {
        var d;
        var c;
        if (b) {
            c = DNA.engine.DomUtil.findChild(this.getBody(), "*[id=" + b + "]");
            d = DNA.JWT.RENDER_POS_TYPE_AFTER
        } else {
            if (b === null ) {
                d = DNA.JWT.RENDER_POS_TYPE_LAST
            } else {
                d = DNA.JWT.RENDER_POS_TYPE_FIRST
            }
        }
        this._renderChild(this.getBody(), d, a, c)
    },
    clear: function() {
        var c = this.getChildren();
        if (c) {
            var b = c.length;
            for (var a = 0; a < b; a++) {
                c[a].dispose(false)
            }
        }
        this._selected = []
    },
    getChildren: function(a) {
        return DNA.widget.WidgetRegistry.getChildren(this, a)
    },
    getSelected: function() {
        return this._selected
    },
    select: function(a, c, b) {
        if (!c && a.isEnabled && !a.isEnabled()) {
            return
        }
        this.unselectAll(b);
        this._selectItem(a, c, b)
    },
    selectItems: function(d, c) {
        this.unselectAll();
        for (var b = 0, a = d.length; b < a; b++) {
            if (d[b] || 0 === d[b]) {
                this._selectItem(d[b], c)
            }
        }
        if (this.setScrollPosition) {
            this.setScrollPosition()
        }
    },
    selectIndex: function(a, d, c) {
        var b = this.findItem(a);
        if (b) {
            this.select(b, d, c)
        }
    },
    selectRange: function(g, b, d) {
        this.unselectAll();
        if (g >= b) {
            for (var c = 0, a = g - b; c <= a; c++) {
                this._selectItem(b + c, d)
            }
        } else {
            for (var c = 0, a = b - g; c <= a; c++) {
                this._selectItem(g + c, d)
            }
        }
    },
    unselect: function(b, a, c) {
        if (!a) {
            b._unselect(c)
        }
        this._selected.remove(b)
    },
    unselectItems: function(c) {
        for (var b = 0, a = c.length; b < a; b++) {
            this.unselect(c[b])
        }
    },
    unselectAll: function(c) {
        var a = this._selected;
        for (var b = a.length - 1; b >= 0; b--) {
            this.unselect(a[b], false, c)
        }
    },
    doDispose: function() {
        DNA.widget.Iteration.superclass.doDispose.call(this);
        delete this._selected;
        delete this._body
    },
    _selectItem: function(b, d, c) {
        var a = this.findItem(b);
        if (a instanceof DNA.widget.Item) {
            if (!d) {
                a._select(c)
            }
            this._selected.push(a)
        }
    },
    findItem: function(b) {
        if (!isNaN(b)) {
            var a = this.getChildren();
            if (a) {
                return a[b]
            }
        }
        return b
    },
    setLastMouseSelection: function(a) {
        this._lastMouseSelection = a
    },
    getLastMouseSelection: function(a) {
        var a = this._lastMouseSelection;
        if (a && !a.isDisposed()) {
            return a
        }
    }
});
DNA.widget.Menu = function(a) {
    DNA.widget.Menu.superclass.constructor.call(this, a);
    DNA.engine.application.getMenuMgr()._register(this);
    this.eid = this.getEid();
    this.isVirtualControl = this.getInitData("isVirtualControl") || false
}
;
DNA.widget.Menu.extend(DNA.widget.Iteration, {
    jtype: "Menu",
    _rebuildElements: Function.emptyFunction,
    setVisible: function(c) {
        var a = this.getEl();
        if (a) {
            var b = new DNA.JWTEvent();
            b.setSrcControl(this);
            if (c === false) {
                this.fireEvent(DNA.JWTEvent.PREHIDDEN, [b]);
                if (b.isPrevented() === false) {
                    if (this.getStyle() & DNA.JWT.MIXED) {
                        DNA.engine.application.getJWTEventMgr()._fireGlobleEvent(DNA.JWTEvent.PREHIDDEN, [this])
                    }
                    this._unmaskState(DNA.JWT.STATE_VISIBLE);
                    this._setVisible(false)
                }
            } else {
                this._maskState(DNA.JWT.STATE_VISIBLE);
                this._setVisible(true);
                this.fireEvent(DNA.JWTEvent.POSTVISIBLE, [b]);
                if (this.getStyle() & DNA.JWT.MIXED) {
                    DNA.engine.application.getJWTEventMgr()._fireGlobleEvent(DNA.JWTEvent.POSTVISIBLE, [this])
                }
            }
        }
    },
    _setFocused: function(a) {
        this._focused = a
    },
    getFocused: function() {
        if (this._focused != null ) {
            if (!this._focused.isDisposed()) {
                return this._focused
            } else {
                this._setFocused(null );
                return null 
            }
        }
    },
    _findNextTabAnchor: function() {
        if ((this.getStyle() & DNA.JWT.MIXED) != 0) {
            return this.getChildren()[0]._findNextTabAnchor()
        }
    },
    _findPreviousTabAnchor: function() {
        if ((this.getStyle() & DNA.JWT.MIXED) != 0) {
            return this.getChildren()[0]._findPreviousTabAnchor()
        }
    },
    _state: (0) & (~DNA.JWT.STATE_MODE_DISABLED) & (~DNA.JWT.STATE_VISIBLE),
    clear: function() {
        if (this.checkRendered(true)) {
            DNA.widget.Menu.superclass.clear.call(this);
            this.el.innerHTML = this._getInnerHtml();
            this._body = this.el.firstChild.firstChild.childNodes[1].childNodes[1].firstChild.firstChild
        }
    },
    _getInnerHtml: function() {
        return "<table cellspacing=0 cellpadding=0><tbody><tr><td class=menu-lt></td><td class=menu-t></td><td class=menu-rt></td></tr><tr><td class=menu-l></td><td><table class=menubody cellspacing=0 cellpadding=0><tbody></tbody></table></td><td class=menu-r></td></tr><tr><td class=menu-lb></td><td class=menu-b></td><td class=menu-rb></td></tr></tbody></table>"
    },
    _doBuildElements: function() {
        this._body = this.el.firstChild.firstChild.childNodes[1].childNodes[1].firstChild.firstChild
    },
    _setLocation: function(a) {
        if (this.getEl()) {
            DNA.engine.DomUtil.setLeftTop(this.el, a.x, a.y)
        }
    },
    getHostControl: function() {
        return DNA.widget.WidgetRegistry.get(this.getInitData()[DNA.JWTProperty.PROPERTY_MENU_HOST])
    },
    isVisible: function() {
        return this._checkState(DNA.JWT.STATE_VISIBLE)
    },
    doDispose: function() {
        DNA.widget.Menu.superclass.doDispose.call(this);
        DNA.engine.application.getMenuMgr()._unregister(this)
    },
    _adjustPosition: function(a, g) {
        var b = DNA.engine.DomUtil.getWidth(this.el);
        var d = DNA.engine.DomUtil.getViewSize();
        if (a + b > d.width) {
            a = d.width - b - 2;
            if (this.parent && this.parent.parent && this.parent.parent instanceof DNA.widget.Menu) {
                a -= DNA.engine.DomUtil.getWidth(this.parent.parent.el)
            }
        }
        var c = DNA.engine.DomUtil.getHeight(this.el);
        if (g + c > d.height) {
            g = g - c;
            if (g < 0) {
                g = 0
            }
        }
        return {
            x: a,
            y: g
        }
    },
    _initMixedMenuSize: function() {
        if ((this.getStyle() & DNA.JWT.MIXED) != 0) {
            var a = this.getChildren()[0];
            var c = a.getBounds();
            if (c == null  || c.width === 0 && c.height === 0) {
                var b = a.computeSize(-1, -1, true);
                a.setBounds(0, 0, b.x, b.y)
            }
        }
    },
    showMenu: function(a, c) {
        this._initMixedMenuSize();
        this.setVisible(true);
        var b = DNA.engine.application.getTopWindowZIndexAnd1();
        DNA.engine.DomUtil.setStyle(this.el, "z-index", b);
        DNA.engine.DomUtil.setStyle(this.el, "innerorder", b);
        if (c) {
            this._setLocation(this._adjustPosition(a, c))
        } else {
            this._setLocation(this._adjustPosition(a.x, a.y))
        }
        this._animatedShowBody()
    },
    _animatedShowBody: function() {
        var b = this.el.firstChild.firstChild.childNodes[1].childNodes[1].firstChild;
        var a = b.offsetHeight;
        var h = new DNA.engine.Sprite(b);
        h.setMargin({
            top: -a
        });
        var d = new DNA.engine.Sprite(b);
        d.setMargin({
            top: 0
        });
        var g = new DNA.engine.Frame([h]);
        var c = new DNA.engine.Frame([d]);
        new DNA.engine.LinearMotion(g,c,20,200).play()
    },
    hideMenuCascade: function(b) {
        var d = DNA.engine.application.getMenuMgr();
        if (!b) {
            if (!this.getVisible()) {
                return true
            }
            if (!d.isMenuOnCurrentModalWindow(this)) {
                return false
            }
        }
        var l = true;
        var h = this.getChildren(true);
        if (h) {
            for (var c = 0, a = h.length; c < a; c++) {
                var m = h[c];
                if (m instanceof DNA.widget.MenuItem) {
                    var g = m._getMenu();
                    if (g) {
                        l = g.hideMenuCascade(true)
                    }
                }
            }
        }
        if ((d.canCloseMixedMenu() == false) && (!l || (this.getStyle() & DNA.JWT.MIXED) != 0)) {
            return false
        }
        this.setVisible(false);
        return l
    }
});
DNA.widget.MenuItem = function(a) {
    DNA.widget.MenuItem.superclass.constructor.call(this, a)
}
;
DNA.widget.MenuItem.extend(DNA.widget.Item, {
    autoRender: true,
    _rebuildElements: Function.emptyFunction,
    getChildren: function(a) {
        return DNA.widget.WidgetRegistry.getChildren(this, a)
    },
    getSelection: function() {
        if (this._selected == undefined) {
            this._selected = this._initData[DNA.JWTProperty.PROPERTY_SELECTION] || false;
            delete this._initData[DNA.JWTProperty.PROPERTY_SELECTION]
        }
        return this._selected
    },
    setSelection: function(c) {
        if (this.getStyle() & DNA.JWT.CHECK) {
            if (c) {
                this._boxEl.className = "check-on"
            } else {
                this._boxEl.className = ""
            }
            this._selected = c
        } else {
            if (this.getStyle() & DNA.JWT.RADIO) {
                if (this._selected == false && c) {
                    this._selectRadio(true);
                    var h = this.getParent().getChildren(true);
                    var d = h.indexOf(this);
                    for (var g = d + 1, a = h.length; g < a; g++) {
                        if (h[g].getStyle() & DNA.JWT.RADIO) {
                            h[g]._selectRadio(false)
                        } else {
                            if (h[g].getStyle() & DNA.JWT.SEPARATOR) {
                                break
                            }
                        }
                    }
                    for (var g = d - 1; g >= 0; g--) {
                        if (h[g].getStyle() & DNA.JWT.RADIO) {
                            h[g]._selectRadio(false)
                        } else {
                            if (h[g].getStyle() & DNA.JWT.SEPARATOR) {
                                break
                            }
                        }
                    }
                } else {
                    this._selectRadio(false)
                }
            }
        }
    },
    insertChildHtml: function(b, a) {
        var c = this._getMenu();
        if (c) {
            c.insertChildHtml(b, a)
        }
    },
    appendChildHtml: function(a) {
        var b = this._getMenu();
        if (b) {
            b.appendChildHtml(a)
        }
    },
    _getMenu: function() {
        return DNA.widget.WidgetRegistry.get(this.getEid() + "_menu")
    },
    DEFAULT_CHILD_MENU_SHOW_DIRECTION: "defaultChildMenuShowDirection",
    _setMenuExpanded: function(n) {
        var d = this._getMenu();
        var m, r, s, h, o, l, g;
        var c = DNA.engine.DomUtil;
        if (d) {
            if (n == undefined) {
                n = !d.isVisible()
            }
            if (n === true && this.getEl()) {
                var q = this.getParent();
                if (q instanceof DNA.widget.MenuBar) {
                    var a = c.getPageXY(this.el);
                    d.showMenu(a.x, a.y + 22)
                } else {
                    l = c.getPageXY(this.el).y;
                    m = c.getPageXY(q.getEl());
                    r = c.getWidth(q.getEl());
                    s = c.getWidth(d.getEl());
                    h = c.getViewSize();
                    g = q.getData(this.DEFAULT_CHILD_MENU_SHOW_DIRECTION) || DNA.JWT.RIGHT;
                    var t = g === DNA.JWT.RIGHT ? m.x + r + s > h.width : m.x - s > 0;
                    if (t) {
                        d.setData(this.DEFAULT_CHILD_MENU_SHOW_DIRECTION, DNA.JWT.LEFT);
                        o = m.x - s;
                        o += 1
                    } else {
                        d.setData(this.DEFAULT_CHILD_MENU_SHOW_DIRECTION, DNA.JWT.RIGHT);
                        o = m.x + r;
                        o -= 1
                    }
                    d.showMenu(o, l)
                }
            } else {
                return d.hideMenuCascade()
            }
        }
    },
    setText: function(a) {
        DNA.engine.DomUtil.setInnerText(this._textEl, a)
    },
    getText: function() {
        return DNA.engine.DomUtil.getInnerText(this._textEl)
    },
    setImage: function(a) {
        this._image = a;
        this._imgEl.innerHTML = a ? a.getHTML() : ""
    },
    _selectRadio: function(a) {
        if (a) {
            this._boxEl.className = "radio-on"
        } else {
            this._boxEl.className = ""
        }
        this._selected = a
    },
    _lowLight: function() {
        this._rightEl.className = "menuitem-r";
        if (this.getParent() instanceof DNA.widget.MenuBar) {
            this._leftEl.className = "menuitem-l";
            this._imgEl.className = "menuitem-c icon";
            this._textEl.className = "menuitem-c txt";
            this._arrowEl.parentNode.className = "menuitem-c"
        } else {
            this._leftEl.className = "menuitem-l imgbox";
            this._boxEl.parentNode.className = "menuitem-c imgbox";
            this._imgEl.parentNode.className = "menuitem-c imgbox";
            this._textIndentEl.className = "menuitem-c";
            this._textEl.parentNode.className = "menuitem-c";
            this._arrowEl.parentNode.className = "menuitem-c"
        }
    },
    _highLight: function() {
        this._leftEl.className = "menuitem-l-h";
        this._rightEl.className = "menuitem-r-h";
        if (this.getParent() instanceof DNA.widget.MenuBar) {
            this._imgEl.className = "menuitem-c-h icon";
            this._textEl.className = "menuitem-c-h txt";
            this._arrowEl.parentNode.className = "menuitem-c-h"
        } else {
            this._boxEl.parentNode.className = "menuitem-c-h";
            this._imgEl.parentNode.className = "menuitem-c-h";
            this._textIndentEl.className = "menuitem-c-h";
            this._textEl.parentNode.className = "menuitem-c-h";
            this._arrowEl.parentNode.className = "menuitem-c-h"
        }
    },
    _grayLight: function() {
        this._leftEl.className = "menuitem-l-a";
        this._rightEl.className = "menuitem-r-a";
        if (this.getParent() instanceof DNA.widget.MenuBar) {
            this._imgEl.className = "menuitem-c-a icon";
            this._textEl.className = "menuitem-c-a txt";
            this._arrowEl.parentNode.className = "menuitem-c-a"
        } else {
            this._boxEl.parentNode.className = "menuitem-c-a";
            this._imgEl.parentNode.className = "menuitem-c-a";
            this._textIndentEl.className = "menuitem-c-a";
            this._textEl.parentNode.className = "menuitem-c-a";
            this._arrowEl.parentNode.className = "menuitem-c-a"
        }
    },
    _doBuildElements: function() {
        var b = this.getParent();
        if (b instanceof DNA.widget.MenuBar) {
            this._leftEl = this.el.firstChild.firstChild.firstChild.childNodes[0];
            this._imgEl = this.el.firstChild.firstChild.firstChild.childNodes[1];
            this._textEl = this.el.firstChild.firstChild.firstChild.childNodes[2];
            this._arrowEl = this.el.firstChild.firstChild.firstChild.childNodes[3].firstChild;
            this._rightEl = this.el.firstChild.firstChild.firstChild.childNodes[4]
        } else {
            if (!(this.getStyle() & DNA.JWT.SEPARATOR)) {
                this._leftEl = this.el.childNodes[0];
                this._imgEl = this._boxEl = this.el.childNodes[1].firstChild;
                this._textIndentEl = this.el.childNodes[2];
                this._textEl = this.el.childNodes[3].firstChild;
                this._arrowEl = this.el.childNodes[4].firstChild;
                this._rightEl = this.el.childNodes[5]
            }
        }
        if (this.getStyle() & DNA.JWT.CASCADE) {
            var c = this._getMenu();
            var a;
            if (b instanceof DNA.widget.MenuBar) {
                a = this.el.firstChild.firstChild.firstChild.lastChild.firstChild;
                if (c.el) {
                    DNA.engine.DomUtil.dispose(a)
                } else {
                    if (DNA.engine.Client.isIE()) {
                        c.el = DNA.engine.DomUtil.append(DNA.engine.application.getBrowserBody(), a.outerHTML);
                        DNA.engine.DomUtil.dispose(a)
                    } else {
                        c.el = DNA.engine.application.getBrowserBody().appendChild(a)
                    }
                    c.el.id = c.getEid()
                }
            } else {
                a = this.el.lastChild.firstChild;
                if (c.el) {
                    DNA.engine.DomUtil.dispose(a)
                } else {
                    if (DNA.engine.Client.isIE()) {
                        c.el = DNA.engine.DomUtil.append(DNA.engine.application.getBrowserBody(), a.outerHTML);
                        DNA.engine.DomUtil.dispose(this.el.lastChild)
                    } else {
                        c.el = DNA.engine.application.getBrowserBody().appendChild(a)
                    }
                    c.el.id = c.getEid()
                }
            }
        }
    },
    _removeFlowHtml: function() {
        if ((this.getStyle() & DNA.JWT.CASCADE) && (this.checkRendered())) {
            var b = this._getMenu();
            var a = b.el;
            if (a) {
                DNA.engine.DomUtil.dispose(a)
            }
        }
    },
    _unselect: function() {},
    _select: function() {},
    dispose: function(a) {
        DNA.widget.MenuItem.superclass.dispose.call(this, a);
        if ((this.getStyle() & DNA.JWT.CASCADE) && (this.checkRendered())) {
            var b = this._getMenu();
            DNA.engine.application.getMenuMgr()._unregister(b)
        }
    },
    doDispose: function() {
        DNA.widget.MenuItem.superclass.doDispose.call(this);
        delete this._boxEl;
        delete this._imgEl;
        delete this._textIndentEl;
        delete this._textEl;
        delete this._arrowEl
    }
});
Object.override(DNA.widget.MenuItem.prototype, {
    jtype: "MenuItem"
});
DNA.widget.MenuBar = function(a) {
    DNA.widget.MenuBar.superclass.constructor.call(this, a);
    DNA.engine.application.getMenuMgr()._register(this)
}
;
DNA.widget.MenuBar.extend(DNA.widget.Iteration, {
    autoRender: true,
    clear: function() {
        this._tableDiv.innerHTML = '<table unselectable="on" cellpadding=0 cellspacing=0 ><tr></tr></table>';
        this._tableEl = this._tableDiv.firstChild;
        this._body = this._tableEl.firstChild.firstChild;
        DNA.widget.MenuBar.superclass.clear.call(this);
        delete this._hoveredMenuItem;
        delete this._activedDropMenuItem
    },
    setSize: function(a, b) {
        DNA.widget.ToolBar.superclass.setSize.call(this, a, b)
    },
    _doBuildElements: function() {
        var a = this.el.firstChild.firstChild.firstChild;
        this._tableDiv = a.firstChild.firstChild;
        this._tableEl = this._tableDiv.firstChild;
        this._body = this._tableEl.firstChild.firstChild
    },
    _registEvents: function() {
        this.addListener(DNA.JWTEvent.MOUSEOUT, this._clearHoveredCacheAction);
        this.addListener(DNA.JWTEvent.MOUSEOVER, this._doMouseoverAction)
    },
    doDispose: function() {
        DNA.widget.MenuBar.superclass.doDispose.call(this);
        DNA.engine.application.getMenuMgr()._unregister(this);
        delete this._tableDiv;
        delete this._tableEl;
        delete this._body
    },
    _clearHoveredCache: function() {
        if (this._hoveredMenuItem) {
            this._hoveredMenuItem._lowLight();
            this._hoveredMenuItem = null 
        }
    },
    removeScrollBar: function() {
        this._scrollBar.removeScrollBar(this);
        delete this._scrollBar
    },
    _clearHoveredCacheAction: new DNA.engine.Action({
        handle: function(a) {
            this._clearHoveredCache();
            if (this._scrollBar) {
                if (!DNA.engine.DomUtil.contains(DNA.engine.DomUtil.getPageBounds(this.el), a.getXY(), false)) {
                    this.removeScrollBar()
                }
            }
        }
    }),
    _getMinpos: function() {
        return -(this._tableEl.offsetWidth - this.el.offsetWidth)
    },
    _checkHeaderVisibility: function() {
        var h = this.getChildren();
        if (h && h.length > 0) {
            var d = this.getBounds();
            var b = this.getBorderSize();
            var m = d.width - b;
            var c = d.height - b;
            var l = this.computeSize(-1, -1);
            var a = l.x - b;
            var g = l.y - b;
            if ((m < a) ) {
                return false
            }
            return true
        }
    },
    doScroll: function() {},
    _doMouseoverAction: new DNA.engine.Action({
        handle: function(h) {
            var c = h.getSrcWidget();
            if (!this._scrollBar) {
                var d = this.getBorderSize();
                if (!this._checkHeaderVisibility()) {
                    var a = this.getBounds();
                    var l = DNA.engine.DomUtil.getPageXY(this.getEl());
                    var g = this._scrollBar = DNA.widget.ScrollBar.getScrollBar(this, DNA.widget.ScrollBar.HORIZONTAL, this._tableEl, this._getMinpos());
                    g.showScrollBar({
                        x: l.x + d / 2,
                        y: l.y + d / 2
                    }, {
                        x: l.x + a.width - 16 - d / 2,
                        y: l.y + d / 2
                    })
                }
            }
        }
    }),
    _computeItemWidth: function(c) {
        var a = 0;
        var g = this.getChildren();
        if (g) {
            var h = g[c];
            if (h instanceof DNA.widget.MenuItem) {
                var d = DNA.engine.DomUtil.computeTextSize(h.getText(), h.getFont());
                a += d.width;
                var b = h._getImage();
                if (b) {
                    a += b.width
                }
                a += 6;
                a += 8;
                a += 5;
                return a
            }
        }
    },
    computeSize: function(b, l, d) {
        var q = new DNA.widget.Point(100,24);
        if (b == DNA.JWT.DEFAULT || l == DNA.JWT.DEFAULT) {
            var m = 0;
            var a = this.getChildren();
            if (a) {
                for (var g = 0, h = a.length; g < h; g++) {
                    var o = a[g];
                    if (o instanceof DNA.widget.MenuItem) {
                        var n = 0;
                        var p = DNA.engine.DomUtil.computeTextSize(o.getText(), o.getFont());
                        n += p.width;
                        var c = o._getImage();
                        if (c) {
                            n += c.width
                        }
                        n += 6;
                        n += 8;
                        n += 5;
                        n += 7;
                        m += n
                    }
                }
            }
            if (b == DNA.JWT.DEFAULT) {
                q.x = m
            }
        }
        if (b != DNA.JWT.DEFAULT) {
            q.x = b
        }
        var p = this.getBorderSize();
        q.x += p;
        q.y += p;
        q.x += 4;
        q.x += 5;
        return q
    },
    _resize: function() {
        this.resetScroller()
    },
    _removeFlowHtml: function() {
        if (this._scrollBar) {
            this.removeScrollBar()
        }
    },
    getDropMenuContent: function() {
        var d = this.getChildren();
        var g = [];
        for (var c = 0, a = d.length; c < a; c++) {
            var b = d[c];
            if (!b.isVisible()) {
                g.push(b)
            }
        }
        return g
    },
    doDropMenuAction: function(c, b) {
        var a = DNA.widget.WidgetRegistry.get(b);
        this.select(a);
        this.resetHeader()
    },
    _startScrollPos: 0,
    _endScrollPos: 0,
    resetScroller: function() {
        if (this._checkHeaderVisibility()) {
            this._tableEl.style.left = "0px"
        }
    }
});
Object.override(DNA.widget.MenuBar.prototype, {
    jtype: "MenuBar"
});
DNA.widget.ToolBar = function(a) {
    DNA.widget.ToolBar.superclass.constructor.call(this, a);
    DNA.engine.application.getMenuMgr()._register(this)
}
;
DNA.widget.ToolBar.extend(DNA.widget.Iteration, {
    autoRender: true,
    clear: function() {
        DNA.widget.ToolBar.superclass.clear.call(this);
        if ((this.getStyle() & DNA.JWT.HORIZONTAL) && (!(this.getStyle() & DNA.JWT.WRAP))) {
            this._tableDiv.innerHTML = '<table unselectable="on" cellpadding=0 cellspacing=0 style="border-collapse:collapse;position:relative"><tr></tr></table>';
            this._scrollTable = this._tableDiv.firstChild;
            this._body = this._scrollTable.firstChild.firstChild
        } else {
            this._body.innerHTML = ""
        }
        delete this._hoveredToolItem;
        delete this._activedDropToolItem
    },
    computeSize: function(h, c, l) {
        var d = new DNA.widget.Point(0,0);
        var a = (this.getStyle() & DNA.JWT.HORIZONTAL) != 0;
        if ((this.getStyle() & DNA.JWT.WRAP) != 0) {
            if (a) {
                if (h == -1 && c == -1) {
                    d = this._computeNOWrapSize()
                } else {
                    if (h != -1 && c == -1) {
                        d.x = h;
                        d.y = this._computeWrapHeigh(h)
                    } else {
                        if (h != -1 && c != -1) {
                            d.x = h;
                            d.y = c
                        } else {
                            if (h == -1 && c != -1) {
                                d = this._computeNOWrapSize();
                                d.y = c
                            }
                        }
                    }
                }
            } else {
                if (h == -1 && c == -1) {
                    d = this._computeNOWrapSize()
                } else {
                    if (h != -1 && c == -1) {
                        d = this._computeNOWrapSize();
                        d.x = h
                    } else {
                        if (h != -1 && c != -1) {
                            d.x = h;
                            d.y = c
                        } else {
                            if (h == -1 && c != -1) {
                                d.x = this._computeWrapWidth(c);
                                d.y = c
                            }
                        }
                    }
                }
            }
        } else {
            if (h == -1 || c == -1) {
                var b = this._computeNOWrapSize();
                if (h == -1) {
                    d.x = b.x
                } else {
                    d.x = h
                }
                if (c == -1) {
                    d.y = b.y
                } else {
                    d.y = c
                }
            } else {
                d.x = h;
                d.y = c
            }
        }
        var g = this.getBorderSize();
        d.x += g;
        d.y += g;
        return d
    },
    _computeNOWrapSize: function() {
        var n = {
            x: 0,
            y: 0
        };
        var b = 0;
        var l = 0;
        var h = (this.getStyle() & DNA.JWT.HORIZONTAL) != 0;
        var c = this.getChildren();
        if (c) {
            for (var d = 0, g = c.length; d < g; d++) {
                var m = c[d];
                if (m instanceof DNA.widget.ToolItem) {
                    var a = m._computeSize();
                    if (h) {
                        b += a.x;
                        l = Math.max(l, a.y)
                    } else {
                        l += a.y;
                        b = Math.max(b, a.x)
                    }
                }
            }
        }
        n.y = l;
        n.x = b;
        return n
    },
    _computeWrapHeigh: function(g) {
        var o = 0;
        var l = 0;
        var b = 0;
        var m = 0;
        var c = this.getChildren();
        if (c) {
            for (var d = 0, h = c.length; d < h; d++) {
                var n = c[d];
                if (n instanceof DNA.widget.ToolItem) {
                    var a = n._computeSize();
                    if (b + a.x > g && l != 0) {
                        o += m;
                        m = a.y;
                        b = a.x;
                        l = 1
                    } else {
                        m = Math.max(m, a.y);
                        b += a.x;
                        l++
                    }
                }
            }
            o += m
        }
        return o
    },
    _computeWrapWidth: function(g, d) {
        var q = 0;
        var o = 0;
        var m = 0;
        var b = 0;
        var c = this.getChildren();
        if (c) {
            for (var h = 0, l = c.length; h < l; h++) {
                var n = c[h];
                if (n instanceof DNA.widget.ToolItem) {
                    var a = n._computeSize();
                    if (m + a.y > g && o != 0) {
                        q += b;
                        m = a.y;
                        b = a.x;
                        o = 1;
                        if (d) {
                            DNA.engine.DomUtil.setLeftTop(n.getEl(), q, 0)
                        }
                    } else {
                        if (d) {
                            DNA.engine.DomUtil.setLeftTop(n.getEl(), q, m)
                        }
                        b = Math.max(b, a.x);
                        m += a.y;
                        o++
                    }
                }
            }
            q += b
        }
        return q
    },
    _doBuildElements: function() {
        if ((this.getStyle() & DNA.JWT.HORIZONTAL) && (!(this.getStyle() & DNA.JWT.WRAP))) {
            this._tableDiv = this.el.firstChild;
            this._scrollTable = this._tableDiv.firstChild;
            this._body = this._scrollTable.firstChild.firstChild;
            this._dropEl = DNA.engine.DomUtil.findChild(this.el, "*[class^=drop]")
        } else {
            this._scrollTable = this._tableDiv = this._body = this.el.firstChild
        }
    },
    _getStyleEl: function() {
        if (((this.getStyle() & DNA.JWT.HORIZONTAL) && (!(this.getStyle() & DNA.JWT.WRAP))) && (this.getStyle() & DNA.JWT.RIGHT)) {
            return this._tableDiv.firstChild
        }
        return this._tableDiv
    },
    _setForeground: function(c) {
        var b;
        DNA.widget.ToolBar.superclass._setForeground.call(this, c);
        if (DNA.engine.Client.isIE()) {
            b = this.getChildren();
            if (!b) {
                return
            }
            for (var a = 0; a < b.length; a++) {
                if ((b[a].getStyle() & DNA.JWT.SEPARATOR) != 0) {
                    continue
                }
                b[a]._setForeground(DNA.widget.CssStyleFinder.getForeground(b[a]))
            }
        }
    },
    _setFont: function(a) {
        var c;
        DNA.widget.ToolBar.superclass._setFont.call(this, a);
        if (DNA.engine.Client.isIE() && !DNA.engine.Client.isStrict()) {
            c = this.getChildren();
            if (!c) {
                return
            }
            for (var b = 0; b < c.length; b++) {
                if ((c[b].getStyle() & DNA.JWT.SEPARATOR) != 0) {
                    continue
                }
                c[b]._setFont(DNA.widget.CssStyleFinder.getFont(c[b]))
            }
        }
    },
    _registEvents: function() {
        this.addListener(DNA.JWTEvent.CLICK, this._doClickAction);
        this.addListener(DNA.JWTEvent.MOUSEDOWN, this._doMousedownAction);
        this.addListener(DNA.JWTEvent.MOUSEOUT, this._doMouseoutAction);
        if (this.getStyle() & DNA.JWT.SCROLL) {
            if (DNA.engine.Client.isIE()) {
                this.addListener(DNA.JWTEvent.MOUSEMOVE, this._doMouseoverAction)
            } else {
                this.addListener(DNA.JWTEvent.MOUSEOVER, this._doMouseoverAction)
            }
        }
    },
    doDispose: function() {
        DNA.widget.ToolBar.superclass.doDispose.call(this);
        DNA.engine.application.getMenuMgr()._unregister(this);
        var a = this._dropper;
        if (a) {
            a.dispose();
            delete this._dropper
        }
        delete this._tableDiv;
        delete this._scrollTable;
        delete this._dropEl
    },
    _doClickAction: new DNA.engine.Action({
        handle: function(c) {
            var a = c.getSrcWidget();
            var b = c.getSrcElement();
            if (a instanceof DNA.widget.ToolItem && !(a.getStyle() & DNA.JWT.SEPARATOR) && a.isEnabled() && b != a._getArrowEl()) {
                if ((a.getStyle() & DNA.JWT.CHECK) ) {
                    a.setSelection(!(a.getSelection()));
                    if (a.getSelection() === false) {
                        this._hoveredToolItem = a;
                        a._highLight()
                    }
                } else {
                    if (a.getStyle() & DNA.JWT.RADIO) {
                        if (!a.getSelection()) {
                            a.setSelection(true)
                        }
                    } else {
                        this._hoveredToolItem = a;
                        a._highLight()
                    }
                }
                a.fireEvent("action", [c]);
                this._animatedClick(a)
            }
        }
    }),
    _animatedClick: function(a) {
        if (!(a.getStyle() & DNA.JWT.DROP_DOWN)) {
            if (this.getStyle() & DNA.JWT.RIGHT) {
                var d = new DNA.engine.Sprite(a._centerEl.firstChild);
                d.setMargin({
                    left: 0
                });
                var c = new DNA.engine.Frame([d]);
                new DNA.engine.ElasticMotion(c,c,30,200,3,5).play()
            } else {
                var d = new DNA.engine.Sprite(a._centerEl.firstChild);
                d.setMargin({
                    left: 0
                });
                var b = new DNA.engine.Sprite(a._centerEl.lastChild);
                b.setMargin({
                    left: 0
                });
                var c = new DNA.engine.Frame([d, b]);
                new DNA.engine.ElasticMotion(c,c,30,200,3,5).play()
            }
        }
    },
    _doMousedownAction: new DNA.engine.Action({
        handle: function(b) {
            var a = b.getSrcWidget();
            if (a instanceof DNA.widget.ToolItem && !(a.getStyle() & DNA.JWT.SEPARATOR) && a.isEnabled()) {
                a._grayLight();
                delete this._hoveredToolItem
            }
        }
    }),
    _addMenuDropper: function() {
        if (!this._dropper) {
            var a = this._dropper = new DNA.widget.MenuDropper(this,this._dropEl)
        }
        return this._dropper
    },
    resetBar: function() {
        if (!this.isDisposed()) {
            if (!this.isVisible()) {
                this._neededReset = true;
                return
            }
            this._neededReset = false;
            var l = "offsetWidth";
            var b = "offsetLeft";
            var d = "left";
            var g = DNA.JWT.HORIZONTAL;
            var c = true;
            var a = this.getAvailableOffset();
            if (DNA.widget.MenuDropper.checkReset(this, g, a)) {
                DNA.engine.DomUtil.setVisible(this._dropEl, true);
                if (this._scrollTable[l] > this.el[l] - this._dropEl[l]) {
                    this._tableDiv.style.width = this.el[l] - this._dropEl[l] + "px"
                }
                c = false;
                var h = this._addMenuDropper();
                h.setVisible(true)
            } else {
                if (this._dropper) {
                    DNA.engine.DomUtil.setVisible(this._dropEl, false);
                    this._tableDiv.style.width = ""
                }
            }
        }
    },
    getAvailableOffset: function() {
        var c = "offsetWidth";
        var a = "offsetLeft";
        var b = this.getBorderSize();
        return this.el[c] - b / 2
    },
    doDropMenuAction: function(c, b) {
        var a = DNA.widget.WidgetRegistry.get(b);
        c.setSrcWidget(a);
        c.setSrcControl(a.getParent());
        if (a instanceof DNA.widget.ToolItem && !(a.getStyle() & DNA.JWT.SEPARATOR) && a.isEnabled()) {
            if ((a.getStyle() & DNA.JWT.CHECK) ) {
                a.setSelection(!(a.getSelection()));
                if (a.getSelection() === false) {
                    this._hoveredToolItem = a;
                    a._highLight()
                }
            } else {
                if (a.getStyle() & DNA.JWT.RADIO) {
                    if (!a.getSelection()) {
                        a.setSelection(true)
                    }
                } else {
                    this._hoveredToolItem = a;
                    a._highLight()
                }
            }
            a.fireEvent("action", [c])
        }
    },
    getDropMenuContent: function() {
        var g = "offsetWidth";
        var a = "offsetLeft";
        var b = this.getChildren();
        var d = [];
        var l;
        for (var h = 0, m = b.length; h < m; h++) {
            var n = b[h];
            if (n instanceof DNA.widget.ToolItem && !(n.getStyle() & DNA.JWT.SEPARATOR)) {
                if (n.isVisible()) {
                    var o = this._scrollTable[a];
                    if ((n.el[a] + o) < 0 || (n.el[a] + n.el[g] + o - this._tableDiv[g]) > 0) {
                        d.push(n);
                        if (h + 1 < m) {
                            d.push(null )
                        }
                    }
                }
            }
        }
        if (d.length == 1 && d[0] == null ) {
            d.splice(0, 1)
        }
        return d
    },
    _getActivedDropItem: function() {
        return this._activedDropToolItem
    },
    _clearActivedDropItem: function() {
        var a = this._activedDropToolItem;
        if (a) {
            if (a._setMenuExpanded(false)) {
                a._lowLight();
                delete this._activedDropToolItem;
                return true
            } else {
                return false
            }
        }
    },
    _cacheActivedDropItem: function(a) {
        a._grayLight();
        a._setMenuExpanded(true);
        this._activedDropToolItem = a
    },
    _clearHoveredCache: function() {
        var a = this._hoveredToolItem;
        if (!a) {
            return
        }
        if (a.isDisposed()) {
            delete this._hoveredToolItem;
            return
        }
        if (a.getSelection() === false) {
            a._lowLight();
            delete this._hoveredToolItem
        }
    },
    _cacheHoveredItem: function(a) {
        this._hoveredToolItem = a;
        this._hoveredToolItem._highLight()
    },
    _getHovered: function() {
        return this._hoveredToolItem
    },
    _computeItemSize: function(a) {
        var b = this.getChildren()[a];
        if (b instanceof DNA.widget.ToolItem) {
            return b._computeSize()
        }
    },
    _removeFlowHtml: function() {
        delete this._activedDropToolItem;
        if (this.getStyle() & DNA.JWT.SCROLL) {
            this.removeScrollBar()
        }
    },
    _resize: function() {
        if (this.getStyle() & DNA.JWT.SCROLL && !(this.getStyle() & DNA.JWT.DROP_DOWN)) {
            this.resetScroller()
        }
        if ((this.getStyle() & DNA.JWT.VERTICAL) && (this.getStyle() & DNA.JWT.WRAP)) {
            var c = this.getBorderSize();
            var a = this.getBounds();
            var d = this._computeWrapWidth(a.height - c, true);
            this._scrollTable.style.width = d + "px"
        }
        if (!(this.getStyle() & DNA.JWT.WRAP) && (this.getStyle() & DNA.JWT.DROP_DOWN)) {
            this.resetBar()
        }
    },
    getStyle: function() {
        return DNA.widget.ToolBar.superclass.getStyle.call(this) | DNA.JWT.SCROLL
    },
    doScroll: function() {
        this._clearActivedDropItem()
    },
    _doMouseoverAction: new DNA.engine.ItemDisabledAction({
        handle: function(h) {
            var c = h.getSrcWidget();
            if (!this._scrollBar) {
                var d = this.getBorderSize();
                if ((((this.getStyle() & DNA.JWT.HORIZONTAL) && (!(this.getStyle() & DNA.JWT.WRAP))) || ((this.getStyle() & DNA.JWT.VERTICAL) && (this.getStyle() & DNA.JWT.WRAP))) && (!this._checkHeaderVisibility())) {
                    var a = this.getBounds();
                    var l = DNA.engine.DomUtil.getPageXY(this.getEl());
                    var g = this._scrollBar = DNA.widget.ScrollBar.getScrollBar(this, DNA.widget.ScrollBar.HORIZONTAL, this._scrollTable, this._getMinpos());
                    g.showScrollBar({
                        x: l.x + d / 2,
                        y: l.y + d / 2 + 8
                    }, {
                        x: l.x + a.width - 16 - d / 2,
                        y: l.y + d / 2 + 8
                    })
                } else {
                    if (!this._checkHeaderVisibility()) {
                        var a = this.getBounds();
                        var g = this._scrollBar = DNA.widget.ScrollBar.getScrollBar(this, DNA.widget.ScrollBar.VERTICAL, this._scrollTable, this._getMinpos());
                        var l = DNA.engine.DomUtil.getPageXY(this.getEl());
                        g.showScrollBar({
                            x: l.x + d / 2,
                            y: l.y + d / 2
                        }, {
                            x: l.x + d / 2,
                            y: l.y + a.height - 16 - d / 2
                        })
                    }
                }
            } else {
                if (DNA.engine.Client.isIE() && this._scrollBar.getUser() !== this) {
                    this.removeScrollBar()
                }
            }
        }
    }),
    _checkHeaderVisibility: function() {
        var a = this.getChildren();
        if (a && a.length > 0) {
            if (((this.getStyle() & DNA.JWT.HORIZONTAL) && (!(this.getStyle() & DNA.JWT.WRAP))) || ((this.getStyle() & DNA.JWT.VERTICAL) && (this.getStyle() & DNA.JWT.WRAP))) {
                if (this.getEl().clientWidth < this._tableDiv.offsetWidth) {
                    return false
                }
            } else {
                if (this.getEl().clientHeight < this._tableDiv.offsetHeight - 2) {
                    return false
                }
            }
            return true
        }
    },
    _getMinpos: function() {
        if (((this.getStyle() & DNA.JWT.HORIZONTAL) && (!(this.getStyle() & DNA.JWT.WRAP))) || ((this.getStyle() & DNA.JWT.VERTICAL) && (this.getStyle() & DNA.JWT.WRAP))) {
            return -(this._scrollTable.offsetWidth - this.el.offsetWidth)
        } else {
            return -(this._scrollTable.offsetHeight - this.el.offsetHeight)
        }
    },
    _doMouseoutAction: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            this._clearHoveredCache();
            if (this._scrollBar) {
                if (!DNA.engine.DomUtil.contains(DNA.engine.DomUtil.getPageBounds(this.el), a.getXY(), false)) {
                    this.removeScrollBar()
                } else {
                    if (DNA.engine.Client.isIE()) {
                        var b = a.getSrcElement().className;
                        if (b === "Composite" || b === "Shell") {
                            this.removeScrollBar()
                        }
                    }
                }
            }
        }
    }),
    removeScrollBar: function() {
        if (this._scrollBar) {
            this._scrollBar.removeScrollBar(this);
            delete this._scrollBar
        }
    },
    resetScroller: function() {
        this._scrollTable.style.left = "0px";
        this._scrollTable.style.top = "0px"
    }
});
Object.override(DNA.widget.ToolBar.prototype, {
    jtype: "ToolBar"
});
DNA.widget.ToolItem = function(a) {
    DNA.widget.ToolItem.superclass.constructor.call(this, a)
}
;
DNA.widget.ToolItem.extend(DNA.widget.Item, {
    autoRender: true,
    setSelection: function(c) {
        if (this.getStyle() & DNA.JWT.CHECK) {
            if (c) {
                this._check()
            } else {
                this._unCheck()
            }
        } else {
            if (this.getStyle() & DNA.JWT.RADIO) {
                if (this._selected === false && c) {
                    this._check();
                    var l = this.getParent();
                    var h = DNA.widget.WidgetRegistry.getChildren(l, true);
                    var d = h.indexOf(this);
                    for (var g = d + 1, a = h.length; g < a; g++) {
                        var m = h[g];
                        if ((m.getStyle() & DNA.JWT.RADIO) && m.getSelection()) {
                            m._unCheck();
                            return
                        } else {
                            if (m.getStyle() & DNA.JWT.SEPARATOR) {
                                break
                            }
                        }
                    }
                    for (var g = d - 1; g >= 0; g--) {
                        var m = h[g];
                        if ((m.getStyle() & DNA.JWT.RADIO) && m.getSelection()) {
                            m._unCheck();
                            return
                        } else {
                            if (m.getStyle() & DNA.JWT.SEPARATOR) {
                                break
                            }
                        }
                    }
                } else {
                    this._unCheck()
                }
            }
        }
    },
    getSelection: function() {
        return this._selected
    },
    _computeSize: function() {
        var o = 0;
        var c = 0;
        var n = this.getParent();
        if (!(this.getStyle() & DNA.JWT.SEPARATOR)) {
            var l = 0
              , m = 0
              , d = 0
              , g = 0;
            var b = this._getImage();
            if (b) {
                l = b.width;
                m = b.height
            }
            var q = DNA.engine.DomUtil.computeTextSize(this.getText(), this.getFont());
            d = q.width;
            g = q.height;
            if (n.getStyle() & DNA.JWT.RIGHT) {
                o = l + d;
                o += 2;
                c = Math.max(m, g)
            } else {
                c = m + g;
                o = Math.max(l, d)
            }
            if (this.getStyle() & DNA.JWT.DROP_DOWN) {
                o += 9;
                o += 3;
                o += 10;
                o += 1
            }
            o += 8;
            c += 6;
            o += 6;
            c += 6
        } else {
            if (n.getStyle() & DNA.JWT.HORIZONTAL) {
                o = 1
            } else {
                c = 3
            }
        }
        var p = new DNA.widget.Point();
        p.x = o;
        p.y = c;
        if (this.getParent().getStyle() & DNA.JWT.RIGHT) {
            var a = DNA.engine.application.getWidgetGlobalProperties().getGlobalProperty("ToolItem", "RightHeight");
            if (a && a > p.y) {
                p.y = a
            }
        }
        return p
    },
    _lowLight: function() {
        this._topLeftEl.className = "toolitem-lt";
        this._topEl.className = "toolitem-t";
        this._topRightEl.className = "toolitem-rt";
        this._leftEl.className = "toolitem-l";
        this._rightEl.className = "toolitem-r";
        this._bottomLeftEl.className = "toolitem-lb";
        this._footEl.className = "toolitem-b";
        this._bottomRightEl.className = "toolitem-rb";
        this._centerEl.className = "toolitem-c";
        if (this.getStyle() & DNA.JWT.DROP_DOWN) {
            this._centerEl.firstChild.className = "toolitem-textimage"
        }
    },
    _highLight: function() {
        this._topLeftEl.className = "toolitem-lt-h";
        this._topEl.className = "toolitem-t-h";
        this._topRightEl.className = "toolitem-rt-h";
        this._leftEl.className = "toolitem-l-h";
        this._rightEl.className = "toolitem-r-h";
        this._bottomLeftEl.className = "toolitem-lb-h";
        this._footEl.className = "toolitem-b-h";
        this._bottomRightEl.className = "toolitem-rb-h";
        this._centerEl.className = "toolitem-c-h";
        if (this.getStyle() & DNA.JWT.DROP_DOWN) {
            this._centerEl.firstChild.className = "toolitem-textimage-h"
        }
    },
    _grayLight: function() {
        this._topLeftEl.className = "toolitem-lt-h";
        this._topEl.className = "toolitem-t-h";
        this._topRightEl.className = "toolitem-rt-h";
        this._leftEl.className = "toolitem-l-h";
        this._rightEl.className = "toolitem-r-h";
        this._bottomLeftEl.className = "toolitem-lb-h";
        this._footEl.className = "toolitem-b-h";
        this._bottomRightEl.className = "toolitem-rb-h";
        this._centerEl.className = "toolitem-c-c";
        if (this.getStyle() & DNA.JWT.DROP_DOWN) {
            this._centerEl.firstChild.className = "toolitem-textimage-h"
        }
    },
    _unCheck: function() {
        if (this.getEl()) {
            this._lowLight()
        }
        this._selected = false
    },
    _check: function() {
        if (this.getEl()) {
            this._grayLight()
        }
        this._selected = true
    },
    _resize: function() {
        var a = this._computeSize();
        var b = this._innerEl;
        b.style.width = a.x + "px";
        b.style.height = a.y + "px";
        this._topEl.style.width = (a.x - 8) + "px";
        this._leftEl.style.height = (a.y - 8) + "px";
        this._centerEl.style.height = (a.y - 8) + "px";
        this._centerEl.style.width = (a.x - 8) + "px";
        this._rightEl.style.height = (a.y - 8) + "px";
        this._footEl.style.width = (a.x - 8) + "px"
    },
    setMenu: function(a) {
        this._menuEid = a
    },
    getMenu: function() {
        return DNA.widget.ToolItem.superclass._getMenu.call(this)
    },
    _setMenuExpanded: function(a) {
        var g = this.getMenu();
        var c = true;
        if (g && (!g.isDisposed()) && this.getEl()) {
            if (a) {
                var d = DNA.engine.DomUtil.getPageXY(this._innerEl);
                g.showMenu(d.x, d.y + DNA.engine.DomUtil.getHeight(this._innerEl) - 2)
            } else {
                return g.hideMenuCascade()
            }
        }
    },
    _doDelayInit: function() {
        this._selected = this.getInitData()[DNA.JWTProperty.PROPERTY_SELECTION] || false;
        delete this.getInitData()[DNA.JWTProperty.PROPERTY_SELECTION]
    },
    _doBuildElements: function() {
        if (!(this.getStyle() & DNA.JWT.SEPARATOR)) {
            var c = this.getParent();
            if (!c) {
                c = this.getParent()
            }
            var b = this._innerEl = (c.getStyle() & DNA.JWT.HORIZONTAL) && (!(c.getStyle() & DNA.JWT.WRAP)) ? this.el.firstChild : this.el;
            var a = this._centerEl = b.childNodes[4];
            this._topLeftEl = b.childNodes[0];
            this._topEl = b.childNodes[1];
            this._topRightEl = b.childNodes[2];
            this._leftEl = b.childNodes[3];
            this._rightEl = b.childNodes[5];
            this._bottomLeftEl = b.childNodes[6];
            this._footEl = b.childNodes[7];
            this._bottomRightEl = b.childNodes[8];
            if (c.getStyle() & DNA.JWT.RIGHT) {
                if (this.getStyle() & DNA.JWT.DROP_DOWN) {
                    this._textEl = a.firstChild.firstChild.firstChild.firstChild.lastChild;
                    this._imageEl = a.firstChild.firstChild.firstChild.firstChild.firstChild;
                    this._arrowEl = a.lastChild
                } else {
                    this._textEl = a.firstChild.firstChild.firstChild.lastChild;
                    this._imageEl = a.firstChild.firstChild.firstChild.firstChild
                }
            } else {
                if (this.getStyle() & DNA.JWT.DROP_DOWN) {
                    this._textEl = a.firstChild.lastChild;
                    this._imageEl = a.firstChild.firstChild;
                    this._arrowEl = a.lastChild
                } else {
                    this._textEl = a.lastChild;
                    this._imageEl = a.firstChild
                }
            }
        }
        this._doDelayInit()
    },
    _getStyleEl: function() {
        if (DNA.engine.Client.isStrict() || (this.getParent().getStyle() & DNA.JWT.RIGHT) == 0) {
            return DNA.widget.ToolItem.superclass._getStyleEl.call(this).firstChild
        }
        var a = null ;
        if (this.getStyle() & DNA.JWT.DROP_DOWN) {
            a = this._centerEl.firstChild.firstChild
        } else {
            if (this.getStyle() & DNA.JWT.SEPARATOR) {} else {
                a = this._centerEl.firstChild
            }
        }
        return a
    },
    _getArrowEl: function() {
        return this._arrowEl
    },
    setImage: function(a) {
        if (!(this.getStyle() & DNA.JWT.SEPARATOR)) {
            this._image = a;
            this._imageEl.innerHTML = a ? a.getHTML() : "";
            this._resize()
        }
    },
    setText: function(a) {
        if ((!(this.getStyle() & DNA.JWT.SEPARATOR)) ) {
            DNA.engine.DomUtil.setInnerText(this._textEl, a);
            this._resize()
        }
    },
    getText: function() {
        if ((!(this.getStyle() & DNA.JWT.SEPARATOR)) ) {
            return DNA.engine.DomUtil.getInnerText(this._textEl)
        }
    },
    _unselect: function() {},
    _select: function() {},
    doDispose: function() {
        DNA.widget.ToolItem.superclass.doDispose.call(this);
        delete this._innerEl;
        delete this._topLeftEl;
        delete this._topEl;
        delete this._topRightEl;
        delete this._leftEl;
        delete this._centerEl;
        delete this._rightEl;
        delete this._bottomLeftEl;
        delete this._footEl;
        delete this._bottomRightEl;
        delete this._textEl;
        delete this._imageEl;
        delete this._arrowEl;
        delete this._menu;
        delete this._selected
    }
});
Object.override(DNA.widget.ToolItem.prototype, {
    jtype: "ToolItem"
});
DNA.widget.TabFolder = function(a) {
    DNA.widget.TabFolder.superclass.constructor.call(this, a);
    this._minHeaderCompositeSize = a[DNA.JWTProperty.PROPERTY_MINIMUM_WIDTH] ? a[DNA.JWTProperty.PROPERTY_MINIMUM_WIDTH] : 0
}
;
DNA.widget.TabFolder.extend(DNA.widget.Iteration, {
    jtype: "TabFolder",
    focusable: true,
    autoRender: true,
    _headerHeight: 25,
    indexOf: function(b) {
        if (this.getStyle() & DNA.JWT.MIXED) {
            var a = DNA.widget.TabFolder.superclass.indexOf.call(this, b);
            if (a != -1) {
                return a - 1
            }
        } else {
            return DNA.widget.TabFolder.superclass.indexOf.call(this, b)
        }
    },
    findItem: function(b) {
        if (this.getStyle() & DNA.JWT.MIXED) {
            if (!isNaN(b)) {
                var a = this.getChildren();
                if (a) {
                    return a[b + 1]
                }
            }
        }
        return DNA.widget.TabFolder.superclass.findItem.call(this, b)
    },
    computeSize: function(h, b, l) {
        var c = new DNA.widget.Point();
        if (h == DNA.JWT.DEFAULT || b == DNA.JWT.DEFAULT) {
            var g = this._selected[0];
            if (g) {
                var d = g.getChildren()[0].computeSize(DNA.JWT.DEFAULT, DNA.JWT.DEFAULT);
                if (h == DNA.JWT.DEFAULT) {
                    c.x = d.x
                }
                if (b == DNA.JWT.DEFAULT) {
                    c.y = d.y
                }
            }
        }
        if (c.x == 0) {
            c.x = DNA.JWT.DEFAULT_WIDTH
        }
        if (c.y == 0) {
            c.y = DNA.JWT.DEFAULT_HEIGHT
        }
        if (h != DNA.JWT.DEFAULT) {
            c.x = h
        }
        if (b != DNA.JWT.DEFAULT) {
            c.y = b
        }
        c.y += this._headerHeight;
        var a = this.getBorderSize();
        c.x += a + 2;
        c.y += a + 1;
        return c
    },
    setMinHeaderCompositeSize: function(a) {
        this._minHeaderCompositeSize = a
    },
    _getHeaderSize: function() {
        var a = this.getBounds();
        var c = this.getBorderSize();
        if ((this.getStyle() & DNA.JWT.TOP) || (this.getStyle() & DNA.JWT.BOTTOM)) {
            return a.width - c
        } else {
            return a.height - c
        }
    },
    _add: function(b, c, a) {
        if (c) {
            var m = c.split("@@");
            var h = null ;
            var l;
            if (b) {
                h = DNA.engine.DomUtil.findChild(this._body, "*[id=" + b + "]");
                if (!h) {
                    l = DNA.JWT.RENDER_POS_TYPE_FIRST
                } else {
                    l = DNA.JWT.RENDER_POS_TYPE_AFTER
                }
            } else {
                if (b === null ) {
                    l = DNA.JWT.RENDER_POS_TYPE_LAST
                } else {
                    l = DNA.JWT.RENDER_POS_TYPE_FIRST
                }
            }
            this._renderChild(this._body, l, m[0], h);
            var n;
            var d = this._mixEl;
            if (h) {
                var g = d.children || d.childNodes;
                n = g[this.indexOf(b)]
            }
            this._renderChild(d, l, m[1], n)
        }
    },
    _doBuildElements: function() {
        if (this.getStyle() & DNA.JWT.TOP) {
            this._headerEl = this.el.firstChild;
            this._mixEl = this.el.lastChild;
            this._body = this._headerEl.firstChild.firstChild.firstChild
        } else {
            if (this.getStyle() & DNA.JWT.BOTTOM) {
                this._headerEl = this.el.lastChild;
                this._body = this._headerEl.firstChild.firstChild.firstChild;
                this._mixEl = this.el.firstChild
            } else {
                if (this.getStyle() & DNA.JWT.LEFT) {
                    this._headerEl = this.el.firstChild;
                    this._body = this._headerEl.firstChild.firstChild;
                    this._mixEl = this.el.lastChild
                } else {
                    this._headerEl = this.el.lastChild;
                    this._body = this._headerEl.firstChild.firstChild;
                    this._mixEl = this.el.firstChild
                }
            }
        }
        this._remainEl = DNA.engine.DomUtil.findChild(this._headerEl, "*[class^=remain]");
        this._dropEl = DNA.engine.DomUtil.findChild(this._headerEl, "*[class^=drop]");
        this._scrollTable = this._headerEl.firstChild
    },
    _afterBuild: function() {
        if (this.getStyle() & DNA.JWT.TOP || this.getStyle() & DNA.JWT.BOTTOM) {
            var a = parseInt(this._headerEl.style.height);
            if (a) {
                this._headerHeight = a
            }
        } else {
            var a = parseInt(this._headerEl.style.width);
            if (a) {
                this._headerHeight = a
            }
        }
    },
    _removeFlowHtml: function() {
        var a = this._dropper;
        if (a) {
            a.dispose();
            delete this._dropper
        }
        this.removeScrollBar()
    },
    _removeMixHtml: function(a) {
        if (this.checkRendered(true)) {
            var c = this._mixEl;
            var b = c.children || c.childNodes;
            DNA.engine.DomUtil.dispose(b[a])
        }
    },
    doDispose: function() {
        DNA.widget.TabFolder.superclass.doDispose.call(this);
        delete this._mixEl;
        delete this._closeEl;
        delete this._remainEl;
        delete this._scrollTable;
        delete this._dropEl
    },
    _registEvents: function() {
        this.addListener(DNA.JWTEvent.MOUSEDOWN, this._mousedownAction, this);
        this.addListener(DNA.JWTEvent.CLICK, this._clickAction, this);
        this.addListener(DNA.JWTEvent.MOUSEMOVE, this._mousemoveAction, this);
        if (DNA.engine.Client.isIE()) {
            this.addListener(DNA.JWTEvent.MOUSEMOVE, this._mouseoverAction, this)
        } else {
            if (DNA.engine.Client.isFF()) {
                this.addListener(DNA.JWTEvent.MOUSEOVER, this._mouseoverAction, this)
            }
        }
        this.addListener(DNA.JWTEvent.MOUSEOUT, this._mouseoutAction, this);
        DNA.engine.application.getJWTEventMgr().addListener(DNA.JWTEvent.POSTVISIBLE, this._doAfterVisible, this)
    },
    _doAfterVisible: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            if (this._neeadReset === true) {
                this.resetHeaderMayBeInSuspendTime()
            }
        }
    }),
    _doSelectionChange: function(b, a) {
        var c = {
            doit: true,
            control: this,
            item: a
        };
        this.fireEvent("selectionchanging", [c]);
        if (c.doit === true) {
            this.select(a);
            this.fireEvent("selection", [b])
        }
    },
    _mousedownAction: new DNA.engine.Action({
        handle: function(a) {
            this._doMousedown(a)
        }
    }),
    _doMousedown: function(c) {
        var a = c.getSrcWidget();
        var b = c.getSrcElement();
        if (a && a != this && a != this._selected[0] && a.getCloseEl() != b) {
            this._doSelectionChange(c, a)
        }
    },
    _addMenuDropper: function() {
        if (!this._dropper) {
            var a = this._dropper = new DNA.widget.MenuDropper(this,this._dropEl)
        }
        return this._dropper
    },
    resetHeader: function() {
        if (!this.isDisposed()) {
            if (!this.isVisible()) {
                this._neeadReset = true;
                return
            }
            this._neeadReset = false;
            var h = "offsetWidth";
            var a = "offsetLeft";
            var z = "left";
            var B = DNA.JWT.HORIZONTAL;
            var C = this.getAvailableOffset();
            var m = "x";
            var G = true;
            var n = "width";
            var H = this.getBorderSize();
            if ((this.getStyle() & DNA.JWT.LEFT) || (this.getStyle() & DNA.JWT.RIGHT)) {
                h = "offsetHeight";
                a = "offsetTop";
                m = "y";
                z = "top";
                n = "height";
                B = DNA.JWT.VERTICAL
            }
            if (this.getStyle() & DNA.JWT.SCROLL) {
                var c = this.getSelected()[0];
                if (c) {
                    if (this._body[h] < C) {
                        this._scrollTable.style[z] = "0px"
                    } else {
                        var I = c.getEl();
                        var s = this._getHeadBounds();
                        var r = this._getItemPageBounds(I);
                        if (!DNA.engine.DomUtil.contains(s, r)) {
                            G = false;
                            var E = r[m] - s[m];
                            var d = parseInt(this._scrollTable.style[z]);
                            d = isNaN(d) ? 0 : d;
                            d -= E;
                            var D = this._getMinpos();
                            d = d < D ? D : d;
                            this._scrollTable.style[z] = d + "px"
                        }
                    }
                }
            } else {
                if (DNA.widget.MenuDropper.checkReset(this, B, C)) {
                    DNA.engine.DomUtil.setVisible(this._dropEl, true);
                    G = false;
                    var b = this._addMenuDropper();
                    b.setVisible(true);
                    var q = this._body[h];
                    if (q >= C) {
                        q = C - 16
                    }
                    if (q < 0) {
                        b.el.style.display = "none"
                    } else {
                        b.el.style.display = "";
                        b.el.style[z] = q + this._scrollTable[a] + "px"
                    }
                } else {
                    if (this._dropper) {
                        DNA.engine.DomUtil.setVisible(this._dropEl, false)
                    }
                }
            }
            if ((this.getStyle() & DNA.JWT.MIXED) ) {
                var u = this._minHeaderCompositeSize;
                if (G) {
                    if (this._dropEl) {
                        DNA.engine.DomUtil.setVisible(this._dropEl, false)
                    }
                    var g = DNA.engine.DomUtil.getChildren(this._body);
                    var o;
                    if (g.length - 1 >= 0) {
                        o = g[g.length - 1]
                    }
                    var p = DNA.engine.DomUtil.getPageXY(this._headerEl);
                    p[n] = this._getHeaderSize();
                    var t, E;
                    if (o) {
                        t = this._getItemPageBounds(o);
                        E = p[m] + p[n] - (t[m] + t[n])
                    } else {
                        E = p[n]
                    }
                    E = DNA.engine.Client.isIE() ? E - 1 : E;
                    if (u <= E) {
                        this._remainEl.style[n] = (E > 0 ? E : 0) + "px"
                    } else {
                        this._remainEl.style[n] = u + "px"
                    }
                } else {
                    this._remainEl.style[n] = u + "px"
                }
                var A = this._remainEl.offsetWidth
                  , v = this._remainEl.offsetHeight;
                var F = DNA.widget.WidgetRegistry.get(this._remainEl.firstChild.id);
                F.setSize(A, v)
            }
        }
    },
    _getItemPageBounds: function(a) {
        return DNA.engine.DomUtil.getPageBounds(a)
    },
    getDropMenuContent: function() {
        var d = this.getChildren();
        var g = [];
        var h;
        for (var b = 0, a = d.length; b < a; b++) {
            var l = d[b];
            if (l instanceof DNA.widget.TabItem) {
                if (l.isVisible()) {
                    if (!h) {
                        h = l;
                        g.push(null )
                    }
                } else {
                    if (l.getVisible() != false) {
                        g.push(l)
                    }
                }
            }
        }
        if (g.length == 1 && g[0] == null ) {
            g.splice(0, 1)
        }
        return g
    },
    _clickAction: new DNA.engine.Action({
        handle: function(c) {
            var a = c.getSrcWidget();
            var b = c.getSrcElement();
            if (a instanceof DNA.widget.TabItem) {
                var d = a.getCloseEl();
                if (b == d) {
                    this.fireEvent("close", [c])
                }
            }
        }
    }),
    getAvailableOffset: function() {
        var c = "offsetWidth";
        var a = "offsetLeft";
        var b = this.getBorderSize();
        if ((this.getStyle() & DNA.JWT.LEFT) || (this.getStyle() & DNA.JWT.RIGHT)) {
            c = "offsetHeight";
            a = "offsetTop"
        }
        return this.el[c] - this._minHeaderCompositeSize - b / 2
    },
    doDropMenuAction: function(m, d) {
        if ("close_all_tabitem" === d) {
            var h = this.getChildren();
            var l = new DNA.JWTEvent(null );
            l.setType(DNA.JWTEvent.CLICK);
            for (var g = 0, a = h.length; g < a; g++) {
                var n = h[g];
                if (n instanceof DNA.widget.TabItem) {
                    if (n.isEnabled()) {
                        l.setSrcControl(n.getParent());
                        l.setSrcWidget(n);
                        this.fireEvent("close", [l])
                    }
                }
            }
        } else {
            var b = DNA.widget.WidgetRegistry.get(d);
            m.setSrcWidget(b);
            m.setSrcControl(b.getParent());
            this._doMousedown(m);
            this.resetHeader()
        }
    },
    _checkHeaderVisibility: function() {
        if (((this.getStyle() & DNA.JWT.TOP) || (this.getStyle() & DNA.JWT.BOTTOM)) ) {
            if ((this.getAvailableOffset() < this._body.offsetWidth) || DNA.engine.DomUtil.getLeft(this._scrollTable) < 0) {
                return false
            }
        } else {
            if ((this.getAvailableOffset() < this._body.offsetHeight) || DNA.engine.DomUtil.getTop(this._scrollTable) < 0) {
                return false
            }
        }
        return true
    },
    doScroll: function() {
        if (((this.getStyle() & DNA.JWT.TOP) || (this.getStyle() & DNA.JWT.BOTTOM)) && (this._remainEl.offsetWidth > this._minHeaderCompositeSize)) {
            this.resetHeader()
        } else {
            if ((this.getStyle() & DNA.JWT.LEFT || this.getStyle() & DNA.JWT.RIGHT) && (this._remainEl.offsetHeight > this._minHeaderCompositeSize)) {
                this.resetHeader()
            }
        }
    },
    _getMinpos: function() {
        if (((this.getStyle() & DNA.JWT.TOP) || (this.getStyle() & DNA.JWT.BOTTOM)) ) {
            return -(this._body.offsetWidth - this.getAvailableOffset())
        } else {
            return -(this._body.offsetHeight - this.getAvailableOffset())
        }
    },
    _mouseoverAction: new DNA.engine.Action({
        handle: function(l) {
            var h = l.getSrcElement();
            var c = l.getSrcWidget();
            if ((this.getStyle() & DNA.JWT.SCROLL) ) {
                if (!this._scrollBar) {
                    if (!DNA.engine.Client.isIE() || DNA.engine.DomUtil.isChildren(h, this._headerEl)) {
                        var d = this.getBorderSize();
                        if (((this.getStyle() & DNA.JWT.TOP) || (this.getStyle() & DNA.JWT.BOTTOM)) && (!this._checkHeaderVisibility())) {
                            var a = this.getBounds();
                            var m = DNA.engine.DomUtil.getPageXY(this.getEl());
                            var g = this._scrollBar = DNA.widget.ScrollBar.getScrollBar(this, DNA.widget.ScrollBar.HORIZONTAL, this._scrollTable, this._getMinpos());
                            if ((this.getStyle() & DNA.JWT.TOP) ) {
                                g.showScrollBar({
                                    x: m.x + d / 2,
                                    y: m.y + d / 2
                                }, {
                                    x: m.x + this.getAvailableOffset() - 14,
                                    y: m.y + d / 2
                                })
                            } else {
                                g.showScrollBar({
                                    x: m.x + d / 2,
                                    y: m.y + a.height - 16 - d / 2
                                }, {
                                    x: m.x + this.getAvailableOffset() - 14,
                                    y: m.y + a.height - 16 - d / 2
                                })
                            }
                        } else {
                            if (!this._checkHeaderVisibility()) {
                                var a = this.getBounds();
                                var g = this._scrollBar = DNA.widget.ScrollBar.getScrollBar(this, DNA.widget.ScrollBar.VERTICAL, this._scrollTable, this._getMinpos());
                                var m = DNA.engine.DomUtil.getPageXY(this.getEl());
                                if ((this.getStyle() & DNA.JWT.LEFT) ) {
                                    g.showScrollBar({
                                        x: m.x + d / 2,
                                        y: m.y + d / 2
                                    }, {
                                        x: m.x + d / 2,
                                        y: m.y + a.height - 16 - d / 2
                                    })
                                } else {
                                    g.showScrollBar({
                                        x: m.x + a.width - 16 - d / 2,
                                        y: m.y + d / 2
                                    }, {
                                        x: m.x + a.width - 16 - d / 2,
                                        y: m.y + a.height - 16 - d / 2
                                    })
                                }
                            }
                        }
                    }
                } else {
                    if (DNA.engine.Client.isIE() && this._scrollBar.getUser() !== this) {
                        this.removeScrollBar()
                    }
                }
            }
        }
    }),
    _getHeadBounds: function() {
        var a = DNA.engine.DomUtil.getPageBounds(this._headerEl);
        var b = this.getAvailableOffset();
        if ((this.getStyle() & DNA.JWT.LEFT) || (this.getStyle() & DNA.JWT.RIGHT)) {
            a.height = b
        } else {
            a.width = b
        }
        return a
    },
    _mouseoutAction: new DNA.engine.Action({
        handle: function(b) {
            var a = b.getSrcWidget();
            if ((this.getStyle() & DNA.JWT.SCROLL) ) {
                if (this._scrollBar) {
                    if (!DNA.engine.DomUtil.contains(this._getHeadBounds(), b.getXY(), false)) {
                        this.removeScrollBar()
                    } else {
                        if (DNA.engine.Client.isIE()) {
                            var c = b.getSrcElement().className;
                            if (c === "Composite" || c === "Shell") {
                                this.removeScrollBar()
                            }
                        }
                    }
                }
            }
        }
    }),
    removeScrollBar: function() {
        if (this._scrollBar) {
            this._scrollBar.removeScrollBar(this);
            delete this._scrollBar
        }
    },
    _mousemoveAction: new DNA.engine.Action({
        handle: function(c) {
            var a = c.getSrcWidget();
            var b = c.getSrcElement();
            if (a instanceof DNA.widget.TabItem) {
                var d = a.getCloseEl();
                if (b == d) {
                    this._closeEl = b;
                    b.className = "tab-close-h"
                } else {
                    if (this._closeEl) {
                        this._closeEl.className = "tab-close"
                    }
                }
            } else {
                if (this._closeEl) {
                    this._closeEl.className = "tab-close";
                    delete this._closeEl
                }
            }
        }
    }),
    _setForeground: function(g) {
        if (DNA.engine.Client.isStrict() === false) {
            var c = this.getChildren();
            if (c) {
                var b = c.length;
                for (var a = 0; a < b; a++) {
                    var d = c[a];
                    if (d instanceof DNA.widget.TabItem) {
                        d._setForeground(g)
                    }
                }
            }
        } else {
            DNA.widget.TabFolder.superclass._setForeground.call(this, g)
        }
    },
    setInnerBorder: function(b) {
        var a = this._innerBorder = DNA.widget.ParserTools.parseBorder(b);
        var c = this._mixEl;
        c.style.border = a.getSize() + "px " + a.getLineStyle() + " " + a.getColor();
        if ((this.getStyle() & DNA.JWT.TOP) != 0) {
            c.style.borderTop = "0"
        } else {
            if ((this.getStyle() & DNA.JWT.LEFT) != 0) {
                c.style.borderLeft = "0"
            } else {
                if ((this.getStyle() & DNA.JWT.RIGHT) != 0) {
                    c.style.borderRight = "0"
                } else {
                    c.style.borderBottom = "0"
                }
            }
        }
        this._resizeCompositeBounds()
    },
    getInnerBorder: function() {
        if (!this._innerBorder) {
            var a = this.getInitData(DNA.JWTProperty.PROPERTY_INNER_BORDER);
            if (!a) {
                return null 
            }
            this._innerBorder = DNA.widget.ParserTools.parseBorder(a);
            delete this._initData[DNA.JWTProperty.PROPERTY_INNER_BORDER]
        }
        return this._innerBorder
    },
    getInnerBorderSize: function() {
        var a = this.getInnerBorder();
        return !a ? 0 : a.getSize()
    },
    _resizeCompositeBounds: function() {
        var l = this.getBorderSize();
        var n = this.getBounds();
        var o;
        var m;
        var d = this._mixEl;
        var c = this.getInnerBorderSize();
        if ((this.getStyle() & DNA.JWT.LEFT) || (this.getStyle() & DNA.JWT.RIGHT)) {
            domSize = {
                width: n.width - l - this._headerHeight,
                height: n.height - l
            };
            o = {
                width: domSize.width - c,
                height: domSize.height - c - c
            }
        } else {
            domSize = {
                width: n.width - l,
                height: n.height - l - this._headerHeight
            };
            o = {
                width: domSize.width - c - c,
                height: domSize.height - c
            }
        }
        if (DNA.engine.Client.isStrict()) {
            domSize = o
        }
        if (domSize.height >= 0) {
            DNA.engine.DomUtil.setStyle(d, "height", domSize.height + "px")
        }
        if (domSize.width >= 0) {
            DNA.engine.DomUtil.setStyle(d, "width", domSize.width + "px")
        }
        var h = d.children || d.childNodes;
        for (var a = 0, g = h.length; a < g; a++) {
            DNA.widget.WidgetRegistry.get(h[a].id).setSize(o.width, o.height)
        }
    },
    resetHeaderMayBeInSuspendTime: function() {
        if (DNA.engine.application.isSuspend() && (this.getStyle() & DNA.JWT.MIXED)) {
            DNA.adapter.browserPage.addFinalTask([this.resetHeader, this])
        } else {
            this.resetHeader()
        }
    },
    _resize: function() {
        this.removeScrollBar();
        this._resizeCompositeBounds();
        this.resetHeaderMayBeInSuspendTime()
    },
    clear: function() {
        var d = this.getChildren();
        if (d) {
            var b = d.length;
            for (var a = 0; a < b; a++) {
                var g = d[a];
                if (g instanceof DNA.widget.TabItem) {
                    g.dispose(false)
                }
            }
        }
        this._selected = [];
        if (DNA.engine.Client.isIE()) {
            while (this._body.childNodes.length > 0) {
                DNA.engine.DomUtil.dispose(this._body.childNodes[0])
            }
        } else {
            this._body.innerHTML = ""
        }
        this._mixEl.innerHTML = ""
    },
    getInnerComp: function() {
        var a = this._selected[0];
        if (a) {
            return a.getChildren()[0]
        }
    },
    select: function(a, b) {
        if (this._selected.indexOf(a) != -1) {
            return
        }
        DNA.widget.TabFolder.superclass.select.call(this, a, b)
    }
});
DNA.widget.OverLapTabFolder = function(a) {
    DNA.widget.OverLapTabFolder.superclass.constructor.call(this, a)
}
;
DNA.widget.OverLapTabFolder.extend(DNA.widget.TabFolder, {
    OVERLAP_SIZE: 6,
    _mousedownAction: new DNA.engine.Action({
        handle: function(c) {
            var a = c.getSrcWidget();
            var b = c.getSrcElement();
            if (a && a != this && a != this._selected[0] && a.getCloseEl() != b && (!DNA.engine.Client.isFF() || b.id !== a.getEid())) {
                this._doSelectionChange(c, a)
            }
        }
    }),
    _getItemPageBounds: function(a) {
        if (a.firstChild) {
            return DNA.engine.DomUtil.getPageBounds(a.firstChild)
        }
        return DNA.engine.DomUtil.getPageBounds(a)
    },
    select: function(b, d) {
        var a = this.findItem(b);
        if (a) {
            var c = this.getSelected();
            if (c && c[0]) {
                DNA.engine.DomUtil.setStyle(this._getItemElForZIndex(c[0].getEl()), "zIndex", this.getChildrenCount() - this.indexOf(c[0]))
            }
            DNA.engine.DomUtil.setStyle(this._getItemElForZIndex(a.getEl()), "zIndex", this.getChildren().length);
            DNA.widget.OverLapTabFolder.superclass.select.call(this, a, d)
        }
    },
    resetHeader: function(a) {
        DNA.widget.OverLapTabFolder.superclass.resetHeader.call(this);
        if (a !== true) {
            this._handleOverlapItems([this._updateItemPositionAndZindex])
        }
    },
    getSelectedIndex: function() {
        var b = this.getSelected();
        if (b && b[0]) {
            return this.indexOf(b[0])
        } else {
            var a = this._initData[DNA.JWTProperty.PROPERTY_SELECTION];
            if (!a) {
                a = 0
            }
            return a
        }
    },
    _getItemElForZIndex: function(a) {
        if (!DNA.engine.Client.isStrict()) {
            return a
        }
        return a.firstChild
    },
    _updateItemPositionAndZindex: function(c, a, b, d) {
        c.firstChild.style.left = -a * this.OVERLAP_SIZE + "px";
        if (c != b) {
            c = this._getItemElForZIndex(c);
            DNA.engine.DomUtil.setStyle(c, "zIndex", d - a)
        } else {
            c = this._getItemElForZIndex(c);
            DNA.engine.DomUtil.setStyle(c, "zIndex", d)
        }
    },
    _handleOverlapItems: function(b) {
        var m = this._body.childNodes;
        var l = m.length;
        var a = this.getSelectedIndex();
        var h = m[a];
        for (var g = 0; g < l; g++) {
            var d = m[g];
            for (var c = 0; c < b.length; c++) {
                b[c].call(this, d, g, h, l)
            }
        }
    }
});
DNA.widget.TabItem = function(a) {
    DNA.widget.TabItem.superclass.constructor.call(this, a)
}
;
DNA.widget.TabItem.extend(DNA.widget.Item, {
    jtype: "TabItem",
    getChildren: function(a) {
        return DNA.widget.WidgetRegistry.getChildren(this, a)
    },
    _doBuildElements: function() {
        if ((this.getParent().getStyle() & DNA.JWT.TOP) || (this.getParent().getStyle() & DNA.JWT.BOTTOM)) {
            var c = this.el.firstChild.firstChild.firstChild;
            var b = c.children || c.childNodes;
            this._leftEl = b[0];
            this._centerEl = b[1];
            this._rightEl = b[2];
            c = b[1].firstChild.firstChild.firstChild;
            b = c.children || c.childNodes;
            this._imageEl = b[0];
            this._textEl = b[1];
            if (this.getParent().getStyle() & DNA.JWT.CLOSE) {
                this._closeEl = b[2]
            }
        } else {
            var a = this.el.firstChild.firstChild.firstChild;
            var b = a.children || a.childNodes;
            this._leftEl = b[0].firstChild;
            this._centerEl = b[1];
            this._rightEl = b[2].firstChild;
            a = b[1].firstChild.firstChild.firstChild;
            b = a.children || a.childNodes;
            this._imageEl = b[0].firstChild;
            this._textEl = b[1].firstChild;
            if (this.getParent().getStyle() & DNA.JWT.CLOSE) {
                this._closeEl = b[2].firstChild
            }
        }
    },
    getCloseEl: function() {
        if (this.checkRendered(true)) {
            return this._closeEl
        }
    },
    setImage: function(a) {
        if (this.checkRendered(true)) {
            this._image = a;
            this._imageEl.innerHTML = a ? a.getHTML() : ""
        }
    },
    _setForeground: function(a) {
        if (this.checkRendered(true)) {
            this._textEl.style.color = a || ""
        }
    },
    _setFont: function(a) {
        if (this.checkRendered(true)) {
            DNA.engine.DomUtil.setFont(this._textEl, a)
        }
    },
    setText: function(a) {
        if (this.checkRendered(true)) {
            this._text = a;
            DNA.engine.DomUtil.setInnerText(this._textEl, a)
        }
    },
    setVisible: function(a) {
        if (this.checkRendered(true)) {
            DNA.widget.TabItem.superclass.setVisible.call(this, a);
            this.getParent().resetHeader()
        }
    },
    getText: function() {
        if (this._text === undefined) {
            this._text = this._initData[DNA.JWTProperty.PROPERTY_TEXT];
            delete this._initData[DNA.JWTProperty.PROPERTY_TEXT]
        }
        return this._text
    },
    _select: function() {
        if (this.checkRendered(true)) {
            this._leftEl.firstChild.style.display = "none";
            this._leftEl.lastChild.style.display = "";
            this._rightEl.firstChild.style.display = "none";
            this._rightEl.lastChild.style.display = "";
            if (this.getParent().getStyle() & DNA.JWT.TOP) {
                this._centerEl.className = "header-center-a-top"
            } else {
                if (this.getParent().getStyle() & DNA.JWT.BOTTOM) {
                    this._centerEl.className = "header-center-a-bottom"
                } else {
                    if (this.getParent().getStyle() & DNA.JWT.LEFT) {
                        this._centerEl.className = "header-center-a-left"
                    } else {
                        this._centerEl.className = "header-center-a-right"
                    }
                }
            }
        }
        var b = this.getChildren();
        if (b) {
            var a = b[0].getEl();
            if (a) {
                var c = this.getParent().getInitData()[DNA.JWTProperty.PROPERTY_CLIENTOBJECT + "_animation"];
                if (DNA.engine.application.isAnimated()) {
                    this.animatedSelect(b[0], function() {
                        DNA.engine.application.getJWTEventMgr()._fireGlobleEvent(DNA.JWTEvent.POSTVISIBLE, [b[0]])
                    })
                } else {
                    a.style.left = "0px";
                    DNA.engine.application.getJWTEventMgr()._fireGlobleEvent(DNA.JWTEvent.POSTVISIBLE, [b[0]])
                }
            }
        }
    },
    animatedSelect: function(r, s) {
        DNA.engine.Animation.showLoadingMask(DNA.engine.DomUtil.getPageBounds(this.getParent()._mixEl));
        var o = [];
        var m = [];
        var c = this.getParent()._animated_unselecting;
        if (c) {
            delete this.getParent()._animated_unselecting;
            var b = c.getChildren()[0];
            var a = b.getEl();
            var q = new DNA.engine.Sprite(a);
            q.setPoint({
                x: 0,
                y: 0
            });
            o.push(q);
            var n = new DNA.engine.Sprite(a);
            n.setPoint({
                x: a.parentNode.offsetWidth,
                y: 0
            });
            m.push(n)
        }
        var a = r.getEl();
        var l = new DNA.engine.Sprite(r);
        l.setPoint({
            x: -a.parentNode.offsetWidth,
            y: 0
        });
        o.push(l);
        var h = new DNA.engine.Frame(o);
        var g = new DNA.engine.Sprite(r);
        g.setPoint({
            x: 0,
            y: 0
        });
        m.push(g);
        var d = new DNA.engine.Frame(m);
        var t = new DNA.engine.LinearMotion(h,d,30,400);
        function p(v, u) {
            if (v) {
                DNA.engine.application.getJWTEventMgr()._fireGlobleEvent(DNA.JWTEvent.PREHIDDEN, [v]);
                v.getEl().style.left = DNA.JWTProperty.SYS_HIDDEN_X + "px"
            }
            if (u) {
                u()
            }
            DNA.engine.Animation.hideLoadingMask()
        }
        t.setEndCallBack(p, null , [b, s]);
        new DNA.engine.Animation(t).play()
    },
    _unselect: function() {
        if (this.checkRendered(true)) {
            this._leftEl.firstChild.style.display = "";
            this._leftEl.lastChild.style.display = "none";
            this._rightEl.firstChild.style.display = "";
            this._rightEl.lastChild.style.display = "none";
            if (this.getParent().getStyle() & DNA.JWT.TOP) {
                this._centerEl.className = "header-center-top"
            } else {
                if (this.getParent().getStyle() & DNA.JWT.BOTTOM) {
                    this._centerEl.className = "header-center-bottom"
                } else {
                    if (this.getParent().getStyle() & DNA.JWT.LEFT) {
                        this._centerEl.className = "header-center-left"
                    } else {
                        this._centerEl.className = "header-center-right"
                    }
                }
            }
        }
        var b = this.getChildren();
        if (b) {
            var a = b[0].getEl();
            if (a) {
                var c = this.getParent().getInitData()[DNA.JWTProperty.PROPERTY_CLIENTOBJECT + "_animation"];
                if (DNA.engine.application.isAnimated()) {
                    this.getParent()._animated_unselecting = this
                } else {
                    DNA.engine.application.getJWTEventMgr()._fireGlobleEvent(DNA.JWTEvent.PREHIDDEN, [b[0]]);
                    a.style.left = DNA.JWTProperty.SYS_HIDDEN_X + "px"
                }
            }
        }
    },
    _removeHtml: function(a) {
        var b = this.getParent();
        b.unselect(this, true);
        DNA.widget.TabItem.superclass._removeHtml.call(this, a);
        b._removeMixHtml(b.indexOf(this))
    },
    isAncestorDisposingWithoutSelf: function() {
        var a = this.parent;
        while (a) {
            if (a.isDisposing()) {
                return true
            }
            a = a.parent
        }
        return false
    },
    doDispose: function() {
        DNA.widget.TabItem.superclass.doDispose.call(this);
        delete this._imageEl;
        delete this._textEl;
        delete this._leftEl;
        delete this._centerEl;
        delete this._rightEl;
        delete this._closeEl
    }
});
DNA.widget.InputMenuItem = function(b, a) {
    this._id = b;
    this._text = a
}
;
DNA.widget.InputMenuItem.extend(DNA.engine.JWTObject, {
    getEid: function() {
        return this._id
    },
    getText: function() {
        return this._text
    },
    handle: function() {}
});
DNA.widget.CopyMenuItem = function() {
    DNA.widget.CopyMenuItem.superclass.constructor.call(this, "copy", "����")
}
;
DNA.widget.CopyMenuItem.extend(DNA.widget.InputMenuItem, {
    handle: function(b) {
        var g = b.getText();
        if (g) {
            var d = b.getSelectPoint();
            var a = g.substring(d.x, d.y);
            var c = b.getInputEl();
            if (c && c.type == "password") {
                return
            }
            console.log("copy  " + d.x + " " + d.y);
            DNA.adapter.ClipboardUtil.copyToClipboard(a)
        }
    }
});
DNA.widget.ParserMenuItem = function() {
    DNA.widget.ParserMenuItem.superclass.constructor.call(this, "paste", "ճ��")
}
;
DNA.widget.ParserMenuItem.extend(DNA.widget.InputMenuItem, {
    handle: function(a) {
        if (!a.isEditable()) {
            return
        }
        DNA.adapter.ClipboardUtil.getClipboard(function(l) {
            var m = a.getText();
            if (m) {
                var h = a.getSelectPoint();
                console.log("parser  " + h.x + " " + h.y);
                var c = m.substring(0, h.x);
                var b = m.substring(h.y, m.length);
                var g = l;
                if (!g) {
                    g = ""
                }
                var d = c + g + b;
                a.setText4Event(d.substring(0, a.getMaximumLength()), DNA.JWT.INPUT);
                var n = h.x + g.length;
                a.processText();
                a.setSelectPoint(n, n)
            } else {
                a.setText4Event(l.substring(0, a.getMaximumLength()), DNA.JWT.INPUT);
                a.processText()
            }
        })
    }
});
DNA.widget.InputMenu = function(a) {
    DNA.widget.InputMenu.superclass.constructor.call(this, a)
}
;
DNA.widget.InputMenu.extend(DNA.widget.Control, {
    arr: [new DNA.widget.CopyMenuItem(), new DNA.widget.ParserMenuItem()],
    _registEvents: function() {
        DNA.widget.InputMenu.superclass._registEvents.call(this);
        this.addListener(DNA.JWTEvent.CONTEXTMENU, this._menuShowListener)
    },
    _menuShowListener: new DNA.engine.Action({
        handle: function(b) {
            if (!this.getMenu()) {
                b._preventDefault();
                var c = DNA.engine.application.getMenuMgr().getSystemMenu(this, this.arr);
                var d = DNA.engine.DomUtil.getPageXY(this.getEl());
                var a = b.getLocation();
                c.showMenu(d.x + a.x, d.y + a.y)
            }
        }
    }),
    doSysMenuAction: function(d, a) {
        for (var b = 0; b < this.arr.length; b++) {
            var c = this.arr[b];
            if (c.getEid() == a) {
                c.handle.apply(c, [this])
            }
        }
    }
});
DNA.widget.AbstractText = function(a) {
    DNA.widget.AbstractText.superclass.constructor.call(this, a);
    this._fontBak = DNA.widget.CssStyleFinder.getFont(this)
}
;
DNA.widget.AbstractText.extend(DNA.widget.InputMenu, {
    autoRender: true,
    computeSize: function(d, b, h) {
        var c = new DNA.widget.Point();
        var a = this._getPerfectSize();
        if (!isNaN(d) && d != DNA.JWT.DEFAULT) {
            c.x = d
        } else {
            c.x = a.x
        }
        if (!isNaN(b) && b != DNA.JWT.DEFAULT) {
            c.y = b
        } else {
            c.y = a.y;
            if (this.getStyle() & DNA.JWT.SINGLE) {
                var g = DNA.engine.application.getWidgetGlobalProperties().getGlobalProperty("Text", "defaultheight");
                if (g && g > c.y) {
                    c.y = g
                }
            }
        }
        return c
    },
    _focusDom: function(a) {
        if (a && a.getSrcElement() != this._inputEl) {
            a._preventDefault()
        }
    },
    _getPerfectSize: function() {},
    _doBuildElements: function() {
        this._inputMask = this.getEl().lastChild;
        var b = this.getEl().firstChild.firstChild;
        this.centerTd = b.childNodes[1].childNodes[1];
        this._innerBorderEl = this.centerTd.firstChild;
        this._inputEl = this._innerBorderEl.firstChild;
        this._borderLT = b.childNodes[0].childNodes[0];
        this._borderT = b.childNodes[0].childNodes[1];
        this._borderRT = b.childNodes[0].childNodes[2];
        this._borderR = b.childNodes[1].childNodes[2];
        this._borderRB = b.childNodes[2].childNodes[2];
        this._borderB = b.childNodes[2].childNodes[1];
        this._borderLB = b.childNodes[2].childNodes[0];
        this._borderL = b.childNodes[1].childNodes[0];
        this.rng = null ;
        this._doRegTextChange();
        if (this._hasButton()) {
            var b = this.getEl().firstChild.firstChild;
            this._center = b.childNodes[1].childNodes[1];
            var a = this._center.firstChild;
            if (DNA.engine.Client.isIE()) {
                this.arrowEl = a.children[2]
            } else {
                this.arrowEl = a.childNodes[2]
            }
            this.arrowCenter = this.arrowEl.firstChild.firstChild.childNodes[1].childNodes[1]
        }
        this._oldText = this.getText()
    },
    _afterBuild: function() {
        this._selStart = this.getInitData(DNA.JWTProperty.PROPERTY_SELECTION_START) || 0;
        delete this.getInitData()[DNA.JWTProperty.PROPERTY_SELECTION_START];
        this._selEnd = this.getInitData(DNA.JWTProperty.PROPERTY_SELECTION_END) || 0;
        delete this.getInitData()[DNA.JWTProperty.PROPERTY_SELECTION_END]
    },
    setRegexp: function(a) {
        this._regexp = a
    },
    getRegexp: function() {
        if (this._regexp == null  || this._regexp == undefined) {
            this._regexp = this.getInitData(DNA.JWTProperty.PROPERTY_TEXT_REGEXP) || "";
            delete this.getInitData()[DNA.JWTProperty.PROPERTY_TEXT_REGEXP]
        }
        return this._regexp
    },
    _validateTextInput: function(c) {
        var d = this.getText();
        var a = this._oldText;
        if (d == null ) {
            d = ""
        }
        if (a === null ) {
            a = ""
        }
        if (a === d) {
            return false
        }
        if (this._judgeIllegalText(d, c)) {
            this.setText(a);
            try {
                this.setStartSelectionPosition(a.length);
                this.setEndSelectionPosition(a.length)
            } catch (b) {}
            this.processText();
            return false
        } else {
            this._oldText = d;
            return true
        }
    },
    _judgeIllegalText: function(d, c) {
        if (d == null  || d == "") {
            return false
        }
        if (c) {
            try {
                var b = new RegExp(c);
                return !b.test(d)
            } catch (a) {
                return false
            }
        }
    },
    setText: function(a) {
        if (this.getRegexp()) {
            if (this._judgeIllegalText(a, this.getRegexp())) {
                return
            }
        }
        this._text = a ? a : "";
        this._updateProperty = true
    },
    setText4Event: function(b, a) {
        if (this._checkTextValue(this.getText(), b)) {
            this.setText(b);
            this.fireEvent("document", [this, a])
        }
    },
    getSelectPoint: function() {
        var d = 0;
        var a = 0;
        try {
            if (this._inputEl.selectionStart != undefined) {
                d = this._inputEl.selectionStart;
                a = this._inputEl.selectionEnd
            } else {
                var c = this._doGetIESelectPoint();
                d = c.x;
                a = c.y
            }
        } catch (b) {
            d = this._selStart || 0;
            a = this._selEnd || 0
        }
        return new DNA.widget.Point(d,a)
    },
    _doGetIESelectPoint: function() {},
    setStartSelectionPosition: function(a) {
        this._selStart = a
    },
    setEndSelectionPosition: function(a) {
        this._selEnd = a;
        this.setSelectPoint(this._selStart, this._selEnd)
    },
    setSelectPoint: function(a, c) {
        if (isNaN(a)) {
            a = 0
        }
        if (isNaN(c)) {
            c = 0
        }
        try {
            if (this._inputEl.selectionStart != undefined) {
                this._inputEl.selectionStart = a;
                this._inputEl.selectionEnd = c
            } else {
                this.rng = this._inputEl.createTextRange();
                this.rng.moveEnd("character", -this._inputEl.value.length);
                this.rng.moveStart("character", -this._inputEl.value.length);
                this.rng.collapse(true);
                this.rng.moveEnd("character", c);
                this.rng.moveStart("character", a);
                if (DNA.engine.application.getFocused() == this) {
                    if (this._inputEl.value) {
                        this.rng.select()
                    } else {
                        this._inputEl.focus()
                    }
                }
            }
        } catch (b) {}
    },
    setMaximumLength: function(a) {
        if (a < 0) {
            a = 1 << 30
        }
        this._propertyChange = true;
        this._inputEl.maxLength = a;
        this._maxLength = a;
        this._propertyChange = false
    },
    getMaximumLength: function() {
        if (!this._maxLength) {
            this._maxLength = this.getInitData().maximumLength;
            delete this.getInitData().maximumLength
        }
        if (isNaN(this._maxLength) || this._maxLength < 0) {
            this._maxLength = 1 << 30
        }
        return this._maxLength
    },
    setDescription: function(a) {
        this._desc = a;
        this._updateProperty = true
    },
    setHint: function(a) {
        this._hint = a;
        this._updateProperty = true
    },
    _processDisabled: function(a) {
        this._propertyChange = true;
        this._inputEl.readOnly = a;
        this._updateProperty = true;
        this.processText();
        this._propertyChange = false
    },
    processText: function() {
        if (this._updateProperty) {
            this._updateProperty = false;
            this._stopDocumentEvent = true;
            var b = this._inputEl.value;
            var c;
            if (this === DNA.engine.application.getFocused() && this.isEditable()) {
                c = this.getText();
                if (b != c) {
                    this._updateText(c)
                }
                DNA.engine.DomUtil.removeClass(this._inputEl, "hint-input")
            } else {
                var a = this.getDescription();
                if (a && a.length > 0) {
                    c = a;
                    DNA.engine.DomUtil.removeClass(this._inputEl, "hint-input")
                } else {
                    if (this.getText() && this.getText().length > 0) {
                        c = this.getText();
                        DNA.engine.DomUtil.removeClass(this._inputEl, "hint-input")
                    } else {
                        c = this.getHint();
                        DNA.engine.DomUtil.addClass(this._inputEl, "hint-input")
                    }
                }
                if (b != c) {
                    this._updateText(c)
                }
            }
            this._stopDocumentEvent = false
        }
    },
    _updateText: function(a) {
        if (a == "") {
            if (this._backspaceEvent) {
                this._inputEl.value = " ";
                return
            }
        }
        this._inputEl.value = a;
        this._oldText = a
    },
    getText: function() {
        if (this._text == undefined) {
            this._text = this.getInitData(DNA.JWTProperty.PROPERTY_TEXT) || "";
            delete this.getInitData()[DNA.JWTProperty.PROPERTY_TEXT]
        }
        return this._text
    },
    getDescription: function() {
        if (this._desc == undefined) {
            this._desc = this.getInitData(DNA.JWTProperty.PROPERTY_TEXT_DESCRIPTION) || "";
            delete this.getInitData()[DNA.JWTProperty.PROPERTY_TEXT_DESCRIPTION]
        }
        return this._desc
    },
    getHint: function() {
        if (this._hint == undefined) {
            this._hint = this.getInitData(DNA.JWTProperty.PROPERTY_TEXT_HINT) || "";
            delete this.getInitData()[DNA.JWTProperty.PROPERTY_TEXT_HINT]
        }
        return this._hint
    },
    isEditable: function() {
        return !this._checkState(DNA.JWT.STATE_MODE_READONLY)
    },
    setEditable: function(a) {
        if (a) {
            this._unmaskState(DNA.JWT.STATE_MODE_READONLY)
        } else {
            this._maskState(DNA.JWT.STATE_MODE_READONLY)
        }
        this._propertyChange = true;
        this._inputEl.readOnly = !a;
        this._updateProperty = true;
        this.processText();
        this._propertyChange = false;
        this._updateReadonlyStyle()
    },
    setModeState: function(a) {
        DNA.widget.AbstractText.superclass.setModeState.call(this, a);
        this._updateReadonlyStyle()
    },
    _setBackground: function(a) {
        DNA.engine.DomUtil.setStyle(this.centerTd, "background-color", a);
        DNA.engine.DomUtil.setStyle(this._inputEl, "background-color", a)
    },
    _setFont: function(a) {
        if (a) {
            var b = this._fontBak;
            if (!b || b.getSize() != a.getSize()) {
                DNA.engine.DomUtil.setFont(this._inputEl, a);
                this._resize()
            } else {
                if (!b.equals(a)) {
                    DNA.engine.DomUtil.setFont(this._inputEl, a)
                }
            }
            this._fontBak = a
        }
    },
    _setForeground: function(a) {
        DNA.engine.DomUtil.setStyle(this._inputEl, "color", a)
    },
    _setBackimage: function(a) {
        if (this.checkRendered(false)) {
            if (a != null ) {
                DNA.engine.DomUtil.setStyle(this._inputEl, "background-image", "url(" + a.url + ")");
                DNA.engine.DomUtil.setStyle(this.getEl(), "background-image", "url(" + a.url + ")")
            } else {
                DNA.engine.DomUtil.setStyle(this._inputEl, "background-image", "");
                DNA.engine.DomUtil.setStyle(this.getEl(), "background-image", "")
            }
        }
    },
    _doRegTextChange: function() {
        var a = DNA.engine.application.getJWTEventMgr();
        if (DNA.engine.Client.isIE()) {
            if (!a.hasSelfEvent(this, "propertychange")) {
                a.handleSelfEvent(this, "propertychange", this._inputEl)
            }
        } else {
            if (!a.hasSelfEvent(this, "input")) {
                a.handleSelfEvent(this, "input", this._inputEl)
            }
        }
    },
    _registEvents: function() {
        DNA.widget.AbstractText.superclass._registEvents.call(this);
        this.addListener(DNA.JWTEvent.KEYDOWN, this._doKeydown);
        this.addListener(DNA.JWTEvent.KEYUP, this._doKeyup);
        this.addListener(DNA.JWTEvent.MOUSEUP, this._doMouseup);
        this.addListener(DNA.JWTEvent.MOUSEDOWN, this._doMousedown);
        this.addListener(DNA.JWTEvent.CLICK, this._doClick);
        this.addListener("beforeReplace", this._doElmentsRebuild);
        if (DNA.engine.Client.isIE()) {
            this.addListener("propertychange", this._textChange)
        } else {
            this.addListener("input", this._textChange)
        }
        if (this._hasButton()) {
            this.addListener("mousemove", this._doButtonMove, this);
            this.addListener("mousedown", this._doButtonDown, this);
            this.addListener("mouseup", this._doButtonUp, this);
            this.addListener("mouseout", this._doMouseout, this);
            if (this._isButtonFireAction()) {
                this.addListener("mousedown", this._doButtonDownFlag, this);
                this.addListener("mouseup", this._doButtonDownAction, this)
            }
        }
    },
    _doClick: new DNA.engine.Action({
        handle: function(a) {
            if (a.getSrcElement().className == "clear") {
                this.setText4Event("");
                this.processText()
            }
        }
    }),
    _doButtonDownAction: new DNA.engine.Action({
        handle: function(a) {
            if (this._isOnButton(a)) {
                if (this._buttonDownFlag) {
                    this._buttonDownFlag = false;
                    this.fireEvent("action", [this, DNA.JWT.BUTTON])
                }
            }
        }
    }),
    _setArrowClassName: function(a) {
        if (this._getImage()) {
            a = ""
        }
        this.arrowCenter.className = a
    },
    _doButtonMove: new DNA.engine.Action({
        handle: function(a) {
            if (this._isOnButton(a)) {
                this._setButtonHover()
            } else {
                if (DNA.engine.application.getFocused() == this) {
                    this._setControlFocus()
                } else {
                    this._setButtonNormal()
                }
            }
        }
    }),
    _doButtonDown: new DNA.engine.Action({
        handle: function(a) {
            if (this._isOnButton(a)) {
                this._setButtonDown()
            }
        }
    }),
    _hasButton: function() {
        return (this.getStyle() & DNA.JWT.BUTTON) != 0
    },
    _doButtonUp: new DNA.engine.Action({
        handle: function(a) {
            this._buttonDown = false;
            if (this._isOnButton(a)) {
                this._setButtonHover()
            } else {
                if (DNA.engine.application.getFocused() == this) {
                    this._setControlFocus()
                } else {
                    this._setButtonNormal()
                }
            }
        }
    }),
    _getImage: function() {
        if (!this._image) {
            this._image = this.getInitData(DNA.JWTProperty.PROPERTY_IMAGE);
            delete this.getInitData()[DNA.JWTProperty.PROPERTY_IMAGE]
        }
        return this._image
    },
    _setButtonClassName: function(b) {
        if (this._getImage()) {
            b = ""
        }
        var a = this.arrowEl.firstChild.firstChild;
        a.childNodes[0].childNodes[0].className = "text-" + b + "-lt";
        a.childNodes[0].childNodes[1].className = "text-" + b + "-t";
        a.childNodes[0].childNodes[2].className = "text-" + b + "-rt";
        a.childNodes[1].childNodes[0].className = "text-" + b + "-l";
        a.childNodes[1].childNodes[2].className = "text-" + b + "-r";
        a.childNodes[2].childNodes[0].className = "text-" + b + "-lb";
        a.childNodes[2].childNodes[1].className = "text-" + b + "-b";
        a.childNodes[2].childNodes[2].className = "text-" + b + "-rb"
    },
    _doMouseout: new DNA.engine.Action({
        handle: function(a) {
            if (DNA.engine.application.getFocused() == this) {
                this._setControlFocus()
            } else {
                this._setButtonNormal()
            }
        }
    }),
    _isButtonFireAction: function() {
        return true
    },
    _isOnButton: function(g) {
        var a = false;
        var b = g.getSrcElement();
        var d = this.arrowEl;
        var c = this.getEl();
        while (c && b && b != c) {
            if (b == d) {
                a = true;
                break
            }
            b = b.parentNode
        }
        return a
    },
    _setButtonHover: function() {
        if (!this._buttonDown) {
            this._setButtonClassName("h");
            this._setArrowClassName("bg-h")
        }
    },
    _setButtonNormal: function() {
        this._buttonDown = false;
        this._setButtonClassName("n");
        this._setArrowClassName("bg-n")
    },
    _setButtonDown: function() {
        this._buttonDown = true;
        this._setArrowClassName("bg-a")
    },
    _doButtonDownFlag: new DNA.engine.Action({
        handle: function(a) {
            if (this._isOnButton(a)) {
                this._buttonDownFlag = true
            }
        }
    }),
    isButtonVisible: function() {
        if (this._downbuttonVisible == undefined) {
            if (this.getStyle() & DNA.JWT.BUTTON) {
                this._downbuttonVisible = this.getInitData(DNA.JWTProperty.PROPERTY_DOWNBUTTON_VISIBLE) === false ? false : true
            } else {
                this._downbuttonVisible = this.getInitData(DNA.JWTProperty.PROPERTY_DOWNBUTTON_VISIBLE) || false
            }
            delete this.getInitData()[DNA.JWTProperty.PROPERTY_DOWNBUTTON_VISIBLE]
        }
        return this._downbuttonVisible
    },
    setButtonVisible: function(a) {
        this._downbuttonVisible = a;
        if (this._hasButton()) {
            if (a) {
                this.arrowEl.style.display = ""
            } else {
                this.arrowEl.style.display = "none"
            }
            this._resize()
        }
    },
    getButtonBounds: function() {
        var a = DNA.engine.DomUtil.getSize(this.arrowEl);
        var b = DNA.engine.DomUtil.getPageXY(this.arrowEl, null );
        a.x = b.x;
        a.y = b.y;
        return a
    },
    getButtonEl: function() {
        return this.arrowEl
    },
    setImage: function(a) {
        this._image = a;
        if (this._hasButton()) {
            this.arrowCenter.firstChild.firstChild.src = a ? a.url : "";
            this.arrowCenter.firstChild.firstChild.width = a ? a.width : 0;
            this.arrowCenter.firstChild.firstChild.height = a ? a.height : 0;
            if (a) {
                this._setButtonClassName("")
            } else {
                this._setButtonClassName("n")
            }
            this.resizeImage()
        }
    },
    _getImage: function() {
        if (!this._image) {
            this._image = this.getInitData(DNA.JWTProperty.PROPERTY_IMAGE);
            delete this.getInitData()[DNA.JWTProperty.PROPERTY_IMAGE]
        }
        return this._image
    },
    _checkSelPos: function() {
        if (this._selEnd) {
            return true
        }
        if (this._selEnd === 0) {
            return true
        }
        return false
    },
    _focus: function(b) {
        try {
            if (!DNA.engine.Client.isTouchDevice()) {
                var a = b.getOriginalEvent() ? b.getOriginalEvent().srcElement ? b.getOriginalEvent().srcElement : b.getOriginalEvent().target : null ;
                if (!b.getOriginalType() || b.getOriginalType() != DNA.JWTEvent.MOUSEDOWN || (b.getOriginalType() == DNA.JWTEvent.MOUSEDOWN && a && a != this._inputEl)) {
                    this._inputEl.focus();
                    b.preventDefault()
                } else {
                    if (!DNA.engine.Client.isChrome()) {
                        this._inputEl.focus()
                    }
                }
            }
            if (this._checkSelPos() && (!b.getOriginalType() || b.getOriginalType() != DNA.JWTEvent.MOUSEDOWN || (b.getOriginalType() == DNA.JWTEvent.MOUSEDOWN && a && a != this._inputEl))) {
                this.setSelectPoint(this._selStart, this._selEnd)
            }
        } catch (b) {}
        this._afterFocus();
        this._setControlFocus()
    },
    _blur: function(a) {
        try {
            this._inputEl.blur();
            if (!this.blur2TextValue) {
                this._afterBlur()
            }
            this._setControlLost()
        } catch (a) {}
    },
    _focusIESelectionArea: function() {
        if (this._inputEl.selectionStart == undefined) {
            if (this._checkSelPos()) {
                this.setSelectPoint(this._selStart, this._selEnd);
                this.rng.select()
            }
        }
    },
    clearSelectionVar: function() {
        this._selStart = null ;
        this._selEnd = null 
    },
    _afterFocus: function() {
        this._updateProperty = true;
        this.processText()
    },
    _afterBlur: function() {
        this._updateProperty = true;
        this.processText()
    },
    _setControlFocus: function() {
        this._innerBorderEl.className = "text-innerboder-gain";
        if ((this.getModeState() & DNA.JWT.STATE_MODE_ERROR) == 0) {
            this._updateBorderClasses("f")
        }
        if (this.getStyle() & DNA.JWT.CLEAR && this.isEditable()) {
            this._inputEl.nextSibling.className = "clear";
            this._resizeInput()
        }
    },
    _setControlLost: function() {
        this._innerBorderEl.className = "text-innerboder-lost";
        if ((this.getModeState() & DNA.JWT.STATE_MODE_ERROR) == 0) {
            this._updateBorderClasses("n")
        }
        if (this.getStyle() & DNA.JWT.CLEAR && this.isEditable()) {
            this._inputEl.nextSibling.className = "";
            this._resizeInput()
        }
    },
    _updateBorderClasses: function(a) {
        this._borderLT.className = "text-border-" + a + "-lt";
        this._borderT.className = "text-border-" + a + "-t";
        this._borderRT.className = "text-border-" + a + "-rt";
        this._borderR.className = "text-border-" + a + "-r";
        this._borderRB.className = "text-border-" + a + "-rb";
        this._borderB.className = "text-border-" + a + "-b";
        this._borderLB.className = "text-border-" + a + "-lb";
        this._borderL.className = "text-border-" + a + "-l"
    },
    _doKeydown: new DNA.engine.Action({
        handle: function(a) {
            DNA.engine.DomUtil.removeClass(this._inputEl, "hint-input");
            if (a.getKeyCode() === DNA.JWTEvent.BACKSPACE) {
                this._backspaceEvent = a
            }
            if (a.getKeyCode() == DNA.JWTEvent.ENTER) {
                this._updateTextValue();
                this.fireEvent("action", [this, DNA.JWT.TEXT])
            }
            if (!this.isEnabled()) {
                a._preventDefault()
            } else {
                if (!this.isEditable()) {
                    if (!(a.isCtrl() || a.isAlt())) {
                        a._preventDefault();
                        return
                    }
                }
            }
            this._doKeydownDispatch(a)
        }
    }),
    _doKeydownDispatch: function(a) {},
    _doKeyup: new DNA.engine.Action({
        handle: function(a) {
            if (a.getKeyCode() === DNA.JWTEvent.BACKSPACE) {
                delete this._backspaceEvent
            }
            this._updateSelectionsAfterUserSelect();
            this._updateTextValue()
        }
    }),
    _doMousedown: new DNA.engine.Action({
        handle: function(a) {
            if (a.getButton() === 0) {
                this._focusIESelectionArea()
            }
        }
    }),
    _doMouseup: new DNA.engine.Action({
        handle: function(a) {
            this._updateSelectionsAfterUserSelect()
        }
    }),
    _updateSelectionsAfterUserSelect: function() {
        var a = this.getSelectPoint();
        this._selStart = a.x;
        this._selEnd = a.y
    },
    _textChange: new DNA.engine.Action({
        handle: function(a) {
            if (!this._stopDocumentEvent) {
                if (!(this.isEnabled() && this.isEditable())) {
                    this._updateProperty = true;
                    this.processText();
                    return
                }
                if (DNA.engine.Client.isIE()) {
                    if (a.getOriginalEvent().propertyName == "value") {
                        if (this._propertyChange) {
                            this._propertyChange = false;
                            return
                        }
                        this._updateTextValue()
                    }
                } else {
                    this._updateTextValue()
                }
            }
        }
    }),
    _checkTextValue: function(a, b) {
        var c = b === this.getDescription();
        if (a != b && (!c || DNA.engine.application.getFocused() === this)) {
            return true
        }
        return false
    },
    _updateTextValue: function() {
        if (this.isEnabled() && this.isEditable()) {
            var c = this.getText();
            var b = this._inputEl.value;
            if (this._checkTextValue(c, b)) {
                this._text = this._inputEl.value;
                var a = true;
                if (this.getRegexp()) {
                    a = this._validateTextInput(this.getRegexp())
                }
                if (a) {
                    this.fireEvent("document", [this, DNA.JWT.INPUT])
                }
            }
        }
    },
    _doElmentsRebuild: new DNA.engine.Action({
        handle: function(b) {
            var a = DNA.engine.application.getJWTEventMgr();
            if (DNA.engine.Client.isIE()) {
                a.deleteSelfEvent(this, "propertychange", this._inputEl)
            } else {
                a.deleteSelfEvent(this, "input", this._inputEl)
            }
        }
    }),
    _resize: function() {
        this._resizeInput();
        this.resizeImage()
    },
    _resizeInput: function() {
        var a = this.getBorderSize();
        if (this._isRoundBorder()) {
            a = 4
        }
        var d = this.getBounds();
        var c = d.width - a - 2;
        var l = d.height - a - 2;
        if (c >= 0 && l >= 0) {
            if (DNA.engine.Client.isStrict()) {
                DNA.engine.DomUtil.setStyle(this._innerBorderEl, "width", c + "px");
                DNA.engine.DomUtil.setStyle(this._innerBorderEl, "height", l + "px")
            }
        }
        var g = this._getInputTrim();
        c -= g.x;
        l -= g.y;
        if (((this.getStyle() & (DNA.JWT.SINGLE | DNA.JWT.BUTTON)) != 0) && ((this.getStyle() & DNA.JWT.MULTI) === 0)) {
            var m = DNA.engine.DomUtil.getTextHeight(this.getFont());
            m += 1;
            if (m == 0) {
                m = 14
            }
            var n = 0;
            if ((this.getStyle() & DNA.JWT.MIDDLE) != 0) {
                n = (d.height - a - m) / 2
            } else {
                if ((this.getStyle() & DNA.JWT.BOTTOM) != 0) {
                    n = l - m
                }
            }
            DNA.engine.DomUtil.setStyle(this._inputEl, "top", n + "px");
            if (m >= 0) {
                DNA.engine.DomUtil.setStyle(this._inputEl, "height", m + "px")
            }
        } else {
            if (c >= 0 && l >= 0) {
                DNA.engine.DomUtil.setStyle(this._inputEl, "height", l + "px")
            }
        }
        if (DNA.engine.Client.isTouchDevice() && (this.getStyle() & DNA.JWT.MULTI)) {
            c -= 4
        }
        if (this._inputEl.nextSibling.className == "clear") {
            c -= 16
        }
        if (c >= 0) {
            DNA.engine.DomUtil.setStyle(this._inputEl, "width", c + "px");
            DNA.engine.DomUtil.setStyle(this._inputMask, "width", c + "px")
        }
    },
    resizeImage: function() {
        if (this._hasButton()) {
            var a;
            if (this._getImage()) {
                if (this.arrowCenter.firstChild.firstChild && this.getBounds()) {
                    a = this.getBounds().height;
                    if (a > 8) {
                        a -= 8
                    }
                    this.arrowCenter.firstChild.style.height = (a + "px");
                    this.arrowCenter.firstChild.firstChild.height = a
                }
            } else {
                if (this.getBounds()) {
                    a = this.getBounds().height;
                    if (a > 8) {
                        a -= 8
                    }
                    if (a > 2 && this._isRoundBorder()) {
                        a -= 2
                    }
                    this.arrowCenter.firstChild.style.height = (a + "px")
                }
                this.arrowCenter.firstChild.firstChild.height = 0
            }
        }
    },
    _setBorder: function(b, a) {
        if (!this._isRoundBorder()) {
            DNA.widget.AbstractText.superclass._setBorder.call(this, b, a)
        } else {
            if ((this.getModeState() & DNA.JWT.STATE_MODE_ERROR) != 0) {
                this._updateBorderClasses("e")
            } else {
                if (this.isNormalMode() || ((this._getState() & DNA.JWT.STATE_MODE_READONLY) != 0)) {
                    if ((this._state & DNA.JWT.STATE_BEHAVIOUR_HOVER) != 0) {
                        this._updateBorderClasses("h")
                    } else {
                        this._updateBorderClasses("n")
                    }
                }
            }
        }
    },
    _isRoundBorder: function() {
        return !!this._innerBorderEl.getAttribute("rb")
    },
    getInputEl: function() {
        return this._inputEl
    },
    getInnerBorderEl: function() {
        return this._innerBorderEl
    },
    _getInputTrim: function() {},
    _updateReadonlyStyle: function() {
        if (this.checkRendered(false)) {
            if (this.isEditable()) {
                if (DNA.engine.DomUtil.hasClass(this.getEl(), "text-readonly")) {
                    DNA.engine.DomUtil.removeClass(this.getEl(), "text-readonly")
                }
                if (DNA.engine.Client.isTouchDevice()) {
                    if ((this.getStyle() & DNA.JWT.SINGLE) && DNA.engine.DomUtil.hasClass(this.getEl(), "text-readonly-touch")) {
                        DNA.engine.DomUtil.removeClass(this.getEl(), "text-readonly-touch")
                    }
                }
            } else {
                if (!DNA.engine.DomUtil.hasClass(this.getEl(), "text-readonly")) {
                    DNA.engine.DomUtil.addClass(this.getEl(), "text-readonly")
                }
                if (DNA.engine.Client.isTouchDevice()) {
                    if ((this.getStyle() & DNA.JWT.SINGLE) && !DNA.engine.DomUtil.hasClass(this.getEl(), "text-readonly-touch")) {
                        DNA.engine.DomUtil.addClass(this.getEl(), "text-readonly-touch")
                    }
                }
            }
        }
    },
    blur2Text: function(a) {
        this.blur2TextValue = a
    },
    doDispose: function() {
        delete this._inputMask;
        delete this._inputEl;
        delete this.centerTd;
        delete this._innerBorderEl;
        delete this._borderLT;
        delete this._borderT;
        delete this._borderRT;
        delete this._borderR;
        delete this._borderRB;
        delete this._borderB;
        delete this._borderLB;
        delete this._borderL;
        DNA.widget.AbstractText.superclass.doDispose.call(this)
    },
    jtype: "Text",
    focusable: true
});
DNA.widget.SingleText = function(a) {
    DNA.widget.SingleText.superclass.constructor.call(this, a)
}
;
DNA.widget.SingleText.extend(DNA.widget.AbstractText, {
    _getPerfectSize: function() {
        return new DNA.widget.Point(DNA.PropertyDefaultValue[DNA.JWTProperty.DV_TEXT_WIDTH],DNA.PropertyDefaultValue[DNA.JWTProperty.DV_TEXT_HEIGHT])
    },
    _doGetIESelectPoint: function() {
        var d = 0;
        var b = 0;
        var c = 0;
        var a = this.getEl().ownerDocument.selection.createRange();
        if (this._inputEl.createTextRange().inRange(a)) {
            c = a.text.length
        }
        a.setEndPoint("StartToStart", this._inputEl.createTextRange());
        b = a.text.length;
        d = b - c;
        return new DNA.widget.Point(d,b)
    },
    _doMenuFunc: new DNA.engine.Action({
        handle: function(a) {
            if (a.getButton() == 2) {
                this._stopDocumentEvent = true;
                var b = this.getText();
                this._inputEl.value = " " + b;
                this._inputEl.value = b;
                this._stopDocumentEvent = false
            }
        }
    }),
    _getInputTrim: function() {
        var a = new DNA.widget.Point();
        if (!(DNA.engine.Client.isIE() && !DNA.engine.Client.isStrict())) {
            a.x += 1;
            a.y += 2
        }
        var b = 18;
        if (this._hasButton() && this.isButtonVisible()) {
            a.x += b
        }
        return a
    },
    doDispose: function() {
        if (this._hasButton()) {
            delete this.arrowEl;
            delete this.arrowCenter
        }
        DNA.widget.SingleText.superclass.doDispose.call(this)
    }
});
DNA.widget.MultiText = function(a) {
    DNA.widget.MultiText.superclass.constructor.call(this, a)
}
;
DNA.widget.MultiText.extend(DNA.widget.AbstractText, {
    _getPerfectSize: function() {
        return new DNA.widget.Point(DNA.PropertyDefaultValue[DNA.JWTProperty.DV_TEXT_MULTI_WIDTH],DNA.PropertyDefaultValue[DNA.JWTProperty.DV_TEXT_MULTI_HEIGHT])
    },
    _doGetIESelectPoint: function() {
        var a = 0;
        var c = 0;
        var g = 0;
        var n = this.getEl().ownerDocument;
        var m = n.selection.createRange();
        var o = this._inputEl.createTextRange();
        var h = m.getBookmark();
        o.collapse();
        o.moveToBookmark(h);
        var l = o.text;
        g = l.length;
        var b = this._inputEl.value.length;
        if (b < 20) {
            b = 20
        }
        o.moveStart("character", -b);
        c = o.text.length;
        a = c - g;
        var d = n.body.createTextRange();
        d.moveToElementText(this._inputEl);
        d.moveStart("character", a);
        for (; d.compareEndPoints("StartToStart", m) < 0; a += 2) {
            d.moveStart("character", 1)
        }
        d = n.body.createTextRange();
        d.moveToElementText(this._inputEl);
        d.moveStart("character", c);
        for (; d.compareEndPoints("StartToEnd", m) < 0; c += 2) {
            d.moveStart("character", 1)
        }
        return new DNA.widget.Point(a,c)
    },
    setHorizontalPosition: function(a) {
        this._inputEl.scrollLeft = a
    },
    setVerticalPosition: function(a) {
        this._inputEl.scrollTop = a
    },
    getHorizontalPosition: function() {
        return this._inputEl.scrollLeft
    },
    getVerticalPosition: function() {
        return this._inputEl.scrollTop
    },
    getHScrollWidth: function() {
        return this._inputEl.scrollWidth
    },
    getVScrollHeight: function() {
        return this._inputEl.scrollHeight
    },
    _doKeydownDispatch: function(h) {
        if ((h.isCtrl() || h.isAlt()) && h.getKeyCode() == DNA.JWTEvent.ENTER) {
            var l = this.getText();
            var d = "";
            var a = this.getSelectPoint();
            d += l.substring(0, a.x);
            d += "\r\n";
            if (a.y < l.length) {
                d += l.substring(a.y, l.length)
            }
            this.setText(d);
            this.processText();
            var b = 0;
            for (var c = 0; c < a.x; c++) {
                if (d.substring(c, c + 2) == "\r\n") {
                    b++
                }
            }
            var g = d.substring(a.x, a.y + 2) == "\r\n";
            this.setSelectPoint(a.x - b + 1, a.x - b + 1);
            if (this.rng) {
                this.rng.select()
            }
        }
    },
    _getInputTrim: function() {
        var a = new DNA.widget.Point();
        a.x += 2;
        a.y += 2;
        var b = 18;
        if (this._hasButton() && this.isButtonVisible()) {
            a.x += b
        }
        return a
    },
    _doMousedown: new DNA.engine.Action({
        handle: function(a) {}
    }),
    _doKeyup: new DNA.engine.Action({
        handle: function(a) {
            if (a.getKeyCode() === DNA.JWTEvent.BACKSPACE) {
                delete this._backspaceEvent
            }
            this._updateTextValue()
        }
    }),
    _updateTextValue: function() {
        if (this.isEnabled() && this.isEditable()) {
            this._trim4MaxLength();
            var c = this.getText();
            var b = this._inputEl.value;
            if (this._checkTextValue(c, b)) {
                this._text = this._inputEl.value;
                var a = true;
                if (this.getRegexp()) {
                    a = this._validateTextInput(this.getRegexp())
                }
                if (a) {
                    this.fireEvent("document", [this, DNA.JWT.INPUT])
                }
            }
        }
    },
    _trim4MaxLength: function() {
        if (DNA.engine.Client.isIE() || (DNA.engine.Client.isFF() && DNA.engine.Client.getBrowserVersion() < 4)) {
            var b = this._inputEl.value;
            var a = this.getMaximumLength();
            if ((a || a === 0) && b.length > a) {
                this._inputEl.value = b.substring(0, a)
            }
        }
    }
});
DNA.widget.ComboPanelCommon = function(a) {
    this.thisObj = a
}
;
Object.override(DNA.widget.ComboPanelCommon.prototype, {
    computeSize: function(c, a, d) {
        var b = new DNA.widget.Point(DNA.PropertyDefaultValue[DNA.JWTProperty.DV_COMBO_WIDTH],DNA.PropertyDefaultValue[DNA.JWTProperty.DV_COMBO_HEIGHT]);
        if (c != DNA.JWT.DEFAULT) {
            b.x = c
        }
        if (a != DNA.JWT.DEFAULT) {
            b.y = a
        }
        return b
    },
    getBody: function() {
        return this.thisObj._bodyEl
    },
    getChildren: function(a) {
        return DNA.widget.WidgetRegistry.getChildren(this.thisObj, a)
    },
    _doBuildElements: function(d) {
        d.superclass._doBuildElements.call(this.thisObj);
        var h = this.thisObj.el.firstChild.firstChild;
        var b = h.childNodes[1].childNodes[1];
        var c = b.firstChild;
        var a = c.lastChild;
        if (this.thisObj._bodyEl) {
            if (a.id) {
                DNA.engine.DomUtil.dispose(a)
            }
        } else {
            if (DNA.engine.Client.isIE()) {
                this.thisObj._bodyEl = DNA.engine.DomUtil.append(DNA.engine.application.getBrowserBody(), a.outerHTML);
                DNA.engine.DomUtil.dispose(a)
            } else {
                this.thisObj._bodyEl = DNA.engine.application.getBrowserBody().appendChild(a)
            }
            this.thisObj._bodyEl.id = this.thisObj.getEid()
        }
        if (this.thisObj._isPanelDragged()) {
            this.thisObj._dragEl = this.thisObj._bodyEl.firstChild.lastChild.firstChild
        }
        var g = this.thisObj.getInitData().arrowImage;
        if (g) {
            this.thisObj._arrowImage = new DNA.widget.ImageDescriptor(g.w,g.h,g.i)
        }
    },
    _registEvents: function(b) {
        b.superclass._registEvents.call(this.thisObj);
        var a = DNA.engine.application.getJWTEventMgr();
        a.addFilter("mousedown", this.thisObj._doComboMousedown, this.thisObj);
        a.addListener("focus", this.thisObj._doFocus, this.thisObj);
        a.addListener("keydown", this.thisObj._fullDomainKeydown, this.thisObj);
        a.addListener("scroll", this.thisObj._onScroll, this.thisObj);
        a.addListener("prehidden", this.thisObj._onPreHidden, this.thisObj);
        if (this.thisObj._isPanelDragged()) {
            this.thisObj.addListener(DNA.JWTEvent.DRAGRESIZEEND, this.thisObj._dragResizeEnd, this.thisObj)
        }
    },
    _onScroll: function(a) {
        if (this.thisObj.isPanelVisible() && a.getSrcControl().isAncestorOf(this.thisObj)) {
            this.thisObj.setPanelVisible(false)
        }
    },
    _onPreHidden: function(a) {
        if (this.thisObj.isPanelVisible() && a.isAncestorOf(this.thisObj)) {
            this.thisObj.setPanelVisible(false)
        }
    },
    _doFocus: function(c) {
        var a = c.getOriginalType();
        if (a == "keydown") {
            var b = DNA.engine.application.getFocused();
            if (!this.thisObj.isAncestorOf(b)) {
                this.thisObj.setPanelVisible(false)
            }
        }
    },
    _doComboMousedown: function(b) {
        if (!this.thisObj.isDisposed() && this.thisObj.isEnabled()) {
            var d = b.getSrcControl();
            var a = b.getSrcElement();
            if (this.thisObj._isOnButton(b)) {
                this.thisObj.setPanelVisible()
            } else {
                if (DNA.engine.DomUtil.isChildren(a, this.thisObj.getEl(), 7)) {
                    if (this.thisObj.isButtonVisible()) {
                        if (this.thisObj.isEditable()) {
                            this.thisObj.setPanelVisible(false)
                        } else {
                            this.thisObj.setPanelVisible()
                        }
                    } else {
                        this.thisObj.setPanelVisible(false)
                    }
                } else {
                    if (this.thisObj.isPanelVisible() && (!this.thisObj.isAncestorOf(d))) {
                        if (DNA.engine.application.getWindowMgr().isWidgetOnCurrentModalWindow(this.thisObj)) {
                            this.thisObj.setPanelVisible(false)
                        }
                    }
                }
            }
        }
    },
    getDragger: function(h, m) {
        var d = h.getSrcElement();
        var b = null ;
        if (d == this.thisObj._dragEl) {
            var l = h.getSrcControl();
            var p = this.thisObj.computePanelSize();
            var a = new DNA.widget.Rectangle();
            var o = DNA.engine.DomUtil.getSize(this.thisObj._bodyEl);
            var n = DNA.engine.DomUtil.getPageXY(this.thisObj._bodyEl);
            var g = new DNA.widget.Rectangle();
            g.x = n.x;
            g.y = n.y;
            g.width = o.width;
            g.height = o.height;
            b = new DNA.widget.DragResize(DNA.JWT.DIRECTION.EASTSOUTH,g)
        } else {
            b = m.superclass.getDragger.call(this.thisObj, h)
        }
        return b
    },
    _fullDomainKeydown: function(a) {
        if (a.getKeyCode() === DNA.JWTEvent.ESC && this.thisObj.isPanelVisible()) {
            var b = a.getSrcControl();
            if (this.thisObj.isAncestorOf(b)) {
                this.thisObj.setPanelVisible(false)
            }
        }
    },
    _dragResizeEnd: function(a) {
        this.thisObj.setPanelSize({
            width: a.width,
            height: a.height
        })
    },
    setPanelVisible: function(c, d) {
        if (!this.thisObj.isVisible() && this.thisObj._bodyVisible === false) {
            return
        }
        if (this.thisObj._bodyVisible !== c) {
            if (c === true || (c == undefined && this.thisObj._bodyVisible === false)) {
                var g = this.thisObj;
                this.thisObj._bodyVisible = true;
                DNA.engine.DomUtil.setStyle(g._bodyEl, "display", "");
                DNA.engine.DomUtil.setLeftTop(g._bodyEl, -1000, -1000);
                g.resizePanel(true);
                DNA.engine.DomUtil.setStyle(g._bodyEl, "z-index", DNA.engine.application.getTopWindowZIndexAnd1());
                var a = new DNA.engine.Thread(20,new DNA.engine.Runnable(function() {
                    a.stop();
                    g.resizePanel(true);
                    DNA.engine.DomUtil.setStyle(g._bodyEl, "z-index", DNA.engine.application.getTopWindowZIndexAnd1())
                }
                ));
                a.timerName = "ComboPanelչ��panel��ʱ���ӳ�����λ�úʹ�С";
                a.start();
                if (!d) {
                    this._popuping = true;
                    this.thisObj.fireEvent("popup", [this.thisObj]);
                    delete this._popuping
                }
            } else {
                if (c === false || (c == undefined && this.thisObj._bodyVisible === true)) {
                    this.thisObj._bodyVisible = false;
                    DNA.engine.DomUtil.setStyle(this.thisObj._bodyEl, "display", "none");
                    if (!d) {
                        this.thisObj.fireEvent("collapse", [this.thisObj])
                    }
                }
            }
        }
    },
    setVisible: function(b, a) {
        if (!b) {
            this.thisObj.setPanelVisible(false)
        }
        a.superclass.setVisible.call(this.thisObj, b)
    },
    _resetPanelPos: function() {
        var a = this._getAdjustBodyPosition();
        DNA.engine.DomUtil.setPageXY(this.thisObj._bodyEl, a.x, a.y)
    },
    _getAdjustBodyPosition: function() {
        var c = DNA.engine.DomUtil.getPageXY(this.thisObj.el);
        var b = this.thisObj.getBounds();
        var a = c.x;
        var d = c.y + b.height;
        return this.thisObj._adjustPosition(a, d)
    },
    _adjustPosition: function(a, m) {
        var g = this.computePanelSize();
        var b = g.width;
        var d = g.height;
        var l = DNA.engine.DomUtil.getViewSize();
        var c;
        if (this.thisObj._isPanelDragged()) {
            c = 10
        } else {
            c = 0
        }
        if (a + b > l.width) {
            a -= a + b - l.width
        }
        if (m + d > l.height) {
            m = m - d - DNA.engine.DomUtil.getHeight(this.thisObj.el) - c
        }
        if (m < 0) {
            m = 0
        }
        return {
            x: a,
            y: m
        }
    },
    isPanelVisible: function() {
        return this.thisObj._bodyVisible
    },
    setPanelSize: function(a) {
        this.thisObj._panelSize = a;
        this.thisObj.getInitData()["pack"] = false;
        this.thisObj.resizePanel()
    },
    getPanelSize: function() {
        return this.thisObj._panelSize
    },
    computePanelSize: function() {
        if (!this.thisObj._panelSize) {
            var o = this.thisObj.getInitData(DNA.JWTProperty.PROPERTY_POPUPPANEL_SIZE);
            if (o) {
                var b = {
                    width: 0,
                    height: 0
                };
                b.width = o.w || o.width;
                b.height = o.h || o.height;
                this.thisObj._panelSize = b;
                delete this.thisObj.getInitData()[DNA.JWTProperty.PROPERTY_POPUPPANEL_SIZE]
            }
        }
        var p = this.thisObj._panelSize ? this.thisObj._panelSize.width : null ;
        var d;
        var q = this.thisObj.getBounds();
        if (!p) {
            p = q.width
        }
        var c = this.thisObj._panelSize ? this.thisObj._panelSize.height : null ;
        if (this.thisObj.getInitData("pack")) {
            if (!d) {
                d = this.thisObj.getChildren(0).computeSize(p, -1, true)
            }
            c = d.y;
            var g = this.thisObj.getEl();
            var a = 0;
            while (g) {
                a += g.offsetTop;
                g = g.parentElement
            }
            var s = document.body.offsetHeight - (a + q.height);
            var m = a > s ? a : s;
            if (c > m) {
                if (s > 120) {
                    c = s
                } else {
                    c = a
                }
            }
        } else {
            if (!c) {
                c = 120
            }
        }
        var t = DNA.engine.DomUtil.getPageXY(this.thisObj.el);
        var q = this.thisObj.getBounds();
        var n = t.x;
        var l = t.y + q.height;
        var r = DNA.engine.DomUtil.getViewSize();
        if (l < r.height && c + l > r.height && c > t.y) {
            c = r.height - l
        }
        return {
            width: p,
            height: c
        }
    },
    pack: function() {
        this.thisObj.getInitData().pack = true
    },
    unpack: function() {
        this.thisObj.getInitData().pack = false
    },
    isPack: function() {
        return this.thisObj.getInitData("pack")
    },
    _hideBody: function() {
        DNA.engine.DomUtil.setStyle(this.thisObj._bodyEl, "display", "none")
    },
    _hasButton: function() {
        return true
    },
    _isButtonFireAction: function() {
        return false
    },
    _resize: function(a) {
        a.superclass._resize.call(this.thisObj);
        this.thisObj.resizePanel();
        this.thisObj.resizeArrowImage()
    },
    setImage: function(b, a) {
        a.superclass.setImage.call(this.thisObj, b);
        this.thisObj.resizeArrowImage();
        if (b) {
            this.thisObj._removeDownClass()
        } else {
            if (!this.thisObj._arrowImage) {
                this.thisObj._addDownClass()
            }
        }
    },
    resizePanel: function(h) {
        if (!h && this._popuping) {
            return
        }
        var g;
        if (this.thisObj._isPanelDragged()) {
            g = 10
        } else {
            g = 0
        }
        var c = this.thisObj.computePanelSize();
        var b = c.width;
        var l = (DNA.engine.Client.isStrict() ? c.height + 2 : c.height) + g;
        var a = DNA.engine.Client.isStrict() ? b - 2 : b;
        var d = DNA.engine.Client.isStrict() ? l - 2 : l;
        this.thisObj._bodyEl.style.width = b + "px";
        this.thisObj._bodyEl.style.height = l + "px";
        this.thisObj._bodyEl.firstChild.style.width = a + "px";
        this.thisObj._bodyEl.firstChild.style.height = d + "px";
        var m = this.thisObj.getChildren(0);
        if (m) {
            m.setSize(c.width - 2, c.height)
        }
        if (this.thisObj._isPanelDragged()) {
            this.thisObj._dragEl.parentNode.style.top = (c.height) + "px"
        }
        this.thisObj._resetPanelPos();
        if (!this._showClip && this.thisObj._bodyVisible && h) {
            this._animatedShowPanel()
        }
        this.thisObj._bodyEl.firstChild.style.zoom = "";
        this.thisObj._bodyEl.firstChild.style.zoom = "1"
    },
    _animatedShowPanel: function() {
        var o = this._getAdjustBodyPosition();
        var c = DNA.engine.DomUtil.getPageXY(this.thisObj.el);
        var n = c.y > o.y;
        var l = new DNA.engine.Sprite(this.thisObj._bodyEl.firstChild);
        if (n) {
            l.setMargin({
                top: this.thisObj._bodyEl.firstChild.offsetHeight
            })
        } else {
            l.setMargin({
                top: -this.thisObj._bodyEl.firstChild.offsetHeight
            })
        }
        var d = new DNA.engine.Sprite(this.thisObj._bodyEl.firstChild);
        d.setMargin({
            top: 0
        });
        var m = new DNA.engine.Frame([l]);
        var g = new DNA.engine.Frame([d]);
        var a = this._showClip = new DNA.engine.LinearMotion(m,g,25,250);
        var h = function() {
            delete this._showClip
        }
        ;
        a.setEndCallBack(h, this);
        a.play()
    },
    _isPanelDragged: function() {
        return (this.thisObj.getStyle() & DNA.JWT.RESIZE) != 0
    },
    isButtonVisible: function() {
        if (this.thisObj._downbuttonVisible == undefined) {
            this.thisObj._downbuttonVisible = this.thisObj.getInitData(DNA.JWTProperty.PROPERTY_DOWNBUTTON_VISIBLE) === false ? false : true;
            delete this.thisObj.getInitData()[DNA.JWTProperty.PROPERTY_DOWNBUTTON_VISIBLE]
        }
        return this.thisObj._downbuttonVisible
    },
    _removeFlowHtml: function() {
        if (this.thisObj._bodyEl) {
            DNA.engine.DomUtil.dispose(this.thisObj._bodyEl);
            delete this.thisObj._bodyEl;
            delete this.thisObj._dragEl
        }
    },
    setArrowImage: function(a) {
        this.thisObj._arrowImage = a;
        if (this.thisObj._hasButton()) {
            this.thisObj.arrowCenter.firstChild.lastChild.src = a ? a.url : "";
            this.thisObj.arrowCenter.firstChild.lastChild.width = a ? a.width : 0;
            this.thisObj.arrowCenter.firstChild.lastChild.height = a ? a.height : 0;
            if (a) {
                this.thisObj._removeDownClass();
                this.thisObj.arrowCenter.firstChild.lastChild.style.position = "relative"
            } else {
                if (!this.thisObj._image) {
                    this.thisObj._addDownClass()
                }
            }
            this.thisObj.resizeArrowImage()
        }
    },
    resizeArrowImage: function() {
        if (this.thisObj._hasButton()) {
            var a = this.thisObj.arrowCenter.firstChild.lastChild;
            if (this.thisObj._arrowImage) {
                if (this.thisObj._image) {
                    a.style.top = 0 - parseInt((parseInt(a.parentNode.style.height) - this.thisObj._arrowImage.height) / 2) - this.thisObj._arrowImage.height + "px"
                } else {
                    a.style.top = parseInt((parseInt(a.parentNode.style.height) - this.thisObj._arrowImage.height) / 2) + "px"
                }
                a.style.left = parseInt((18 - this.thisObj._arrowImage.width) / 2) + "px"
            } else {
                a.style.top = "0px";
                a.style.left = "0px"
            }
        }
    },
    _addDownClass: function() {
        DNA.engine.DomUtil.addClass(this.thisObj.arrowCenter.firstChild, "down")
    },
    _removeDownClass: function() {
        DNA.engine.DomUtil.removeClass(this.thisObj.arrowCenter.firstChild, "down")
    }
});
DNA.widget.ComboPanel = function(a) {
    DNA.widget.ComboPanel.superclass.constructor.call(this, a);
    this.common = new DNA.widget.ComboPanelCommon(this)
}
;
DNA.widget.ComboPanel.extend(DNA.widget.SingleText, {
    computeSize: function(b, a, c) {
        return this.common.computeSize(b, a, c)
    },
    getBody: function() {
        return this.common.getBody()
    },
    getChildren: function(a) {
        return this.common.getChildren(a)
    },
    _doBuildElements: function() {
        return this.common._doBuildElements(DNA.widget.ComboPanel)
    },
    _registEvents: function() {
        this.common._registEvents(DNA.widget.ComboPanel)
    },
    _onScroll: new DNA.engine.Action({
        handle: function(a) {
            this.common._onScroll(a)
        }
    }),
    _onPreHidden: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            this.common._onPreHidden(a)
        }
    }),
    _doFocus: new DNA.engine.Action({
        handle: function(a) {
            this.common._doFocus(a)
        }
    }),
    _doComboMousedown: new DNA.engine.Action({
        handle: function(a) {
            this.common._doComboMousedown(a)
        }
    }),
    getDragger: function(a) {
        return this.common.getDragger(a, DNA.widget.ComboPanel)
    },
    _fullDomainKeydown: new DNA.engine.Action({
        handle: function(a) {
            this.common._fullDomainKeydown(a)
        }
    }),
    _dragResizeEnd: new DNA.engine.Action({
        handle: function(a) {
            this.common._dragResizeEnd(a)
        }
    }),
    setPanelVisible: function(a, c) {
        this.common.setPanelVisible(a, c)
    },
    setVisible: function(a) {
        this.common.setVisible(a, DNA.widget.ComboPanel)
    },
    _resetPanelPos: function() {
        this.common._resetPanelPos()
    },
    _adjustPosition: function(a, b) {
        return this.common._adjustPosition(a, b)
    },
    isPanelVisible: function() {
        return this.common.isPanelVisible()
    },
    setPanelSize: function(a) {
        this.common.setPanelSize(a)
    },
    getPanelSize: function() {
        return this.common.getPanelSize()
    },
    computePanelSize: function() {
        return this.common.computePanelSize()
    },
    pack: function() {
        this.common.pack()
    },
    unpack: function() {
        this.common.unpack()
    },
    isPack: function() {
        return this.common.isPack()
    },
    _hideBody: function() {
        this.common._hideBody()
    },
    _hasButton: function() {
        return this.common._hasButton()
    },
    _isButtonFireAction: function() {
        return this.common._isButtonFireAction()
    },
    _resize: function() {
        this.common._resize(DNA.widget.ComboPanel)
    },
    setImage: function(a) {
        this.common.setImage(a, DNA.widget.ComboPanel)
    },
    resizePanel: function(a) {
        this.common.resizePanel(a)
    },
    _isPanelDragged: function() {
        return this.common._isPanelDragged()
    },
    isButtonVisible: function() {
        return this.common.isButtonVisible()
    },
    _removeFlowHtml: function() {
        this.common._removeFlowHtml()
    },
    setArrowImage: function(a) {
        this.common.setArrowImage(a)
    },
    resizeArrowImage: function() {
        this.common.resizeArrowImage()
    },
    _addDownClass: function() {
        this.common._addDownClass()
    },
    _removeDownClass: function() {
        this.common._removeDownClass()
    },
    _bodyVisible: false
});
Object.override(DNA.widget.ComboPanel.prototype, {
    jtype: "ComboPanel",
    focusable: true
});
DNA.widget.ComboPanelMulti = function(a) {
    DNA.widget.ComboPanelMulti.superclass.constructor.call(this, a);
    this.common = new DNA.widget.ComboPanelCommon(this)
}
;
DNA.widget.ComboPanelMulti.extend(DNA.widget.MultiText, {
    computeSize: function(b, a, c) {
        return this.common.computeSize(b, a, c)
    },
    getBody: function() {
        return this.common.getBody()
    },
    getChildren: function(a) {
        return this.common.getChildren(a)
    },
    _doBuildElements: function() {
        return this.common._doBuildElements(DNA.widget.ComboPanelMulti)
    },
    _registEvents: function() {
        this.common._registEvents(DNA.widget.ComboPanelMulti)
    },
    _onScroll: new DNA.engine.Action({
        handle: function(a) {
            this.common._onScroll(a)
        }
    }),
    _onPreHidden: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            this.common._onPreHidden(a)
        }
    }),
    _doFocus: new DNA.engine.Action({
        handle: function(a) {
            this.common._doFocus(a)
        }
    }),
    _doComboMousedown: new DNA.engine.Action({
        handle: function(a) {
            this.common._doComboMousedown(a)
        }
    }),
    getDragger: function(a) {
        return this.common.getDragger(a, DNA.widget.ComboPanelMulti)
    },
    _fullDomainKeydown: new DNA.engine.Action({
        handle: function(a) {
            this.common._fullDomainKeydown(a)
        }
    }),
    _dragResizeEnd: new DNA.engine.Action({
        handle: function(a) {
            this.common._dragResizeEnd(a)
        }
    }),
    setPanelVisible: function(a, c) {
        this.common.setPanelVisible(a, c)
    },
    setVisible: function(a) {
        this.common.setVisible(a, DNA.widget.ComboPanelMulti)
    },
    _resetPanelPos: function() {
        this.common._resetPanelPos()
    },
    _adjustPosition: function(a, b) {
        return this.common._adjustPosition(a, b)
    },
    isPanelVisible: function() {
        return this.common.isPanelVisible()
    },
    setPanelSize: function(a) {
        this.common.setPanelSize(a)
    },
    getPanelSize: function() {
        return this.common.getPanelSize()
    },
    computePanelSize: function() {
        return this.common.computePanelSize()
    },
    pack: function() {
        this.common.pack()
    },
    unpack: function() {
        this.common.unpack()
    },
    isPack: function() {
        return this.common.isPack()
    },
    _hideBody: function() {
        this.common._hideBody()
    },
    _hasButton: function() {
        return this.common._hasButton()
    },
    _isButtonFireAction: function() {
        return this.common._isButtonFireAction()
    },
    _resize: function() {
        this.common._resize(DNA.widget.ComboPanelMulti)
    },
    setImage: function(a) {
        this.common.setImage(a, DNA.widget.ComboPanelMulti)
    },
    resizePanel: function() {
        this.common.resizePanel()
    },
    _isPanelDragged: function() {
        return this.common._isPanelDragged()
    },
    isButtonVisible: function() {
        return this.common.isButtonVisible()
    },
    _removeFlowHtml: function() {
        this.common._removeFlowHtml()
    },
    setArrowImage: function(a) {
        this.common.setArrowImage(a)
    },
    resizeArrowImage: function() {
        this.common.resizeArrowImage()
    },
    _addDownClass: function() {
        this.common._addDownClass()
    },
    _removeDownClass: function() {
        this.common._removeDownClass()
    },
    _bodyVisible: false
});
Object.override(DNA.widget.ComboPanelMulti.prototype, {
    jtype: "ComboPanel",
    focusable: true
});
DNA.widget.AbstractButton = function(a) {
    DNA.widget.AbstractButton.superclass.constructor.call(this, a)
}
;
DNA.widget.AbstractButton.extend(DNA.widget.Control, {
    autoRender: true,
    computeSize: function(m, p, n) {
        var s = new DNA.widget.Point();
        var a = null ;
        if (m != DNA.JWT.DEFAULT) {
            s.x = m
        } else {
            a = DNA.engine.DomUtil.computeTextSize(this.getText(), this.getFont());
            var r = a.width;
            var l = this._getImage();
            if (l) {
                r += l.width
            }
            var q = this.getBorderSize();
            s.x = r + q;
            var g = this._getTrim();
            s.x += g.x
        }
        if (p != DNA.JWT.DEFAULT) {
            s.y = p
        } else {
            if (a == null ) {
                a = DNA.engine.DomUtil.computeTextSize(this.getText(), this.getFont())
            }
            var o;
            if (this.getText()) {
                o = a.height
            } else {
                o = 14
            }
            var l = this._getImage();
            if (l) {
                o = Math.max(o, l.height)
            }
            var q = this.getBorderSize();
            s.y = o + q;
            var g = this._getTrim();
            s.y += g.y;
            if (this.getStyle() & ((JWT.PUSH | JWT.TOGGLE))) {
                var c = DNA.engine.application.getWidgetGlobalProperties().getGlobalProperty("Button", "defaultheight");
                if (c && c > s.y) {
                    s.y = c
                }
            }
        }
        var d = this._getMin();
        if (s.x < d.x) {
            s.x = d.x
        }
        if (s.y < d.y) {
            s.y = d.y
        }
        return s
    },
    _getTrim: function() {
        return new DNA.widget.Point(0,0)
    },
    _getMin: function() {
        return new DNA.widget.Point(0,0)
    },
    setImage: function(a) {
        this._image = a;
        this._imageEl.innerHTML = a ? a.getHTML() : ""
    },
    setText: function(a) {
        this._text = a;
        DNA.engine.DomUtil.setInnerText(this._textEl, this._text || "")
    },
    _getImage: function() {
        if (!this._image) {
            this._image = this.getInitData(DNA.JWTProperty.PROPERTY_IMAGE);
            delete this.getInitData()[DNA.JWTProperty.PROPERTY_IMAGE]
        }
        return this._image
    },
    getText: function() {
        if (!this._text) {
            this._text = this.getInitData(DNA.JWTProperty.PROPERTY_TEXT) || "";
            delete this.getInitData()[DNA.JWTProperty.PROPERTY_TEXT]
        }
        return this._text
    },
    getSelection: function() {
        if (this._selected == undefined) {
            this._selected = this.getInitData(DNA.JWTProperty.PROPERTY_SELECTION) | false;
            delete this.getInitData()[DNA.JWTProperty.PROPERTY_SELECTION]
        }
        return this._selected
    },
    setSelection: function(a) {
        this._selected = a;
        this.fireEvent("action", [this])
    },
    _registEvents: function() {
        this.addListener("click", this._doClick);
        this.addListener("keyup", this._doKeyup)
    },
    _doKeyup: new DNA.engine.Action({
        handle: function(a) {
            if (a.getKeyCode() == DNA.JWTEvent.SPACE) {
                this._onClick(a)
            }
        }
    }),
    _doClick: new DNA.engine.Action({
        handle: function(a) {
            this._onClick(a)
        }
    }),
    _onClick: function(a) {},
    doDispose: function() {
        delete this._imageEl;
        delete this._textEl;
        DNA.widget.AbstractButton.superclass.doDispose.call(this)
    }
});
Object.override(DNA.widget.AbstractButton.prototype, {
    jtype: "Button",
    focusable: true
});
DNA.widget.AbstractCheckButton = function(a) {
    DNA.widget.AbstractCheckButton.superclass.constructor.call(this, a)
}
;
DNA.widget.AbstractCheckButton.extend(DNA.widget.AbstractButton, {
    _getTrim: function() {
        return new DNA.widget.Point(24,5)
    },
    _getMin: function() {
        return new DNA.widget.Point(20,18)
    },
    _registEvents: function() {
        DNA.widget.AbstractCheckButton.superclass._registEvents.call(this);
        this.addListener("mouseover", this._onMouseover);
        this.addListener("mouseout", this._onMouseout);
        this.addListener("keydown", this._onKeyDown)
    },
    _onMouseover: new DNA.engine.Action({
        handle: function() {
            if (this.getSelection()) {
                this._input.className = this.HSCLS
            } else {
                this._input.className = this.HCLS
            }
        }
    }),
    _onMouseout: new DNA.engine.Action({
        handle: function() {
            if (this.getSelection()) {
                this._input.className = this.NSCLS
            } else {
                this._input.className = this.NCLS
            }
        }
    }),
    _onKeyDown: new DNA.engine.Action({
        handle: function(a) {
            if (a.getKeyCode() == DNA.JWTEvent.ENTER) {
                this._onClick(a)
            }
        }
    }),
    _focus: function() {
        if (this.getText()) {
            this._textEl.className = "btn-chk-a"
        }
    },
    _blur: function() {
        this._textEl.className = "btn-chk"
    },
    _doBuildElements: function() {
        var a = this.el.firstChild.firstChild.firstChild;
        this._input = a.cells[0];
        this._imageEl = a.childNodes[1];
        this._textEl = a.childNodes[2].firstChild
    },
    _setForeground: function(a) {
        DNA.engine.DomUtil.setStyle(this.el.firstChild.firstChild.firstChild.childNodes[2], "color", a)
    },
    _setFont: function(a) {
        DNA.engine.DomUtil.setFont(this.el.firstChild.firstChild.firstChild.childNodes[2], a)
    },
    doDispose: function() {
        delete this._input;
        DNA.widget.AbstractCheckButton.superclass.doDispose.call(this)
    }
});
DNA.widget.AbstractPushButton = function(a) {
    DNA.widget.AbstractPushButton.superclass.constructor.call(this, a)
}
;
DNA.widget.AbstractPushButton.extend(DNA.widget.AbstractButton, {
    _stateClassName: [["lt", "t", "rt"], ["l", "", "r"], ["lb", "b", "rb"]],
    _getTrim: function() {
        return new DNA.widget.Point(10,10)
    },
    _registEvents: function() {
        DNA.widget.AbstractPushButton.superclass._registEvents.call(this);
        this.addListener("mouseover", this._doMouseover);
        this.addListener("mouseout", this._doMouseupout);
        this.addListener("mouseup", this._doMouseup);
        this.addListener("mousedown", this._doMousedown);
        this.addListener("keydown", this._doKeyDown);
        DNA.engine.application.getJWTEventMgr().addListener(DNA.JWTEvent.PRE_DISABLED, this._onDisable, this)
    },
    _doMouseover: new DNA.engine.Action({
        handle: function() {
            if (!this._mousedownFlag) {
                this._center.className = "btn-push-h-center";
                this._center.firstChild.style.marginTop = "0px";
                this._updateBorderClasses("h")
            }
        }
    }),
    _doMouseupout: new DNA.engine.Action({
        handle: function() {
            this._clearOverStyle()
        }
    }),
    _clearOverStyle: function() {
        this._center.className = "btn-push-n-center";
        this._center.firstChild.style.marginTop = "0px";
        this._mousedownFlag = false;
        this._updateBorderClasses("n")
    },
    _doMousedown: new DNA.engine.Action({
        handle: function() {
            this._center.className = "btn-push-a-center";
            this._center.firstChild.style.marginTop = "2px";
            this._mousedownFlag = true
        }
    }),
    _doMouseup: new DNA.engine.Action({
        handle: function() {
            this._mousedownFlag = false;
            this._center.className = "btn-push-h-center";
            this._center.firstChild.style.marginTop = "0px"
        }
    }),
    _doKeyDown: new DNA.engine.Action({
        handle: function(a) {
            if (a.getKeyCode() == DNA.JWTEvent.SPACE || a.getKeyCode() == DNA.JWTEvent.ENTER) {
                this._mouseDownFlag = true;
                this._center.className = "btn-push-a-center";
                this._center.firstChild.style.marginTop = "2px";
                this._mousedownFlag = true
            }
        }
    }),
    _doKeyup: new DNA.engine.Action({
        handle: function(a) {
            if (a.getKeyCode() == DNA.JWTEvent.SPACE || a.getKeyCode() == DNA.JWTEvent.ENTER) {
                this._center.className = "btn-push-n-center";
                this._center.firstChild.style.marginTop = "0px";
                this._mousedownFlag = false;
                if (this._mouseDownFlag) {
                    this._onClick(a)
                }
                this._mouseDownFlag = false;
                this._updateBorderClasses("n")
            }
        }
    }),
    _onDisable: new DNA.engine.AppSuspendedAction({
        handle: function(a) {}
    }),
    _focus: function() {
        this.el.firstChild.focus();
        this._updateBorderClasses("f")
    },
    _blur: function() {
        this._updateBorderClasses("n")
    },
    _updateBorderClasses: function(d) {
        var g = this.el.firstChild.firstChild;
        for (var c = 0; c < 3; c++) {
            for (var b = 0; b < 3; b++) {
                var a = this._stateClassName[c][b];
                if (a) {
                    g.childNodes[c].childNodes[b].className = "btn-push-" + d + "-" + a
                }
            }
        }
    },
    _doBuildElements: function() {
        var b = this.el.firstChild.firstChild;
        this._center = b.childNodes[1].childNodes[1];
        var a = this._center.firstChild.firstChild.firstChild;
        this._imageEl = a.childNodes[0];
        this._textEl = a.childNodes[1]
    },
    _setBackground: function(a) {},
    _setBackimage: function(a) {},
    _setForeground: function(a) {
        DNA.engine.DomUtil.setStyle(this._textEl.parentNode, "color", a)
    },
    _setFont: function(a) {
        DNA.engine.DomUtil.setFont(this._textEl.parentNode, a)
    },
    _disable: function() {
        DNA.widget.AbstractPushButton.superclass._disable.call(this);
        this._clearOverStyle()
    },
    doDispose: function() {
        DNA.widget.AbstractPushButton.superclass.doDispose.call(this);
        delete this._center
    }
});
DNA.widget.CheckButton = function(a) {
    DNA.widget.CheckButton.superclass.constructor.call(this, a)
}
;
DNA.widget.CheckButton.extend(DNA.widget.AbstractCheckButton, {
    HCLS: "btn-chk-input btn-chk-h",
    HSCLS: "btn-chk-input btn-chk-s-h",
    DCLS: "btn-chk-input btn-chk-d",
    DSCLS: "btn-chk-input btn-chk-s-d",
    NCLS: "btn-chk-input btn-chk-n",
    NSCLS: "btn-chk-input btn-chk-s-n",
    getFocusEffectBounds: function(a) {
        var b = {
            width: 16,
            height: 16
        };
        if (this._getImage()) {
            if (this.getText()) {
                b.width += this._imageEl.offsetWidth;
                b.width += this._textEl.offsetWidth
            } else {
                b.width += this._imageEl.firstChild.offsetWidth
            }
        } else {
            if (this.getText()) {
                b.width += this._textEl.offsetWidth
            }
        }
        b.height = Math.max(16, this._textEl.offsetHeight);
        var c = DNA.engine.DomUtil.getPageXY(this._input, a);
        b.y = c.y + (this._input.offsetHeight - b.height) / 2;
        b.x = c.x;
        return b
    },
    setSelection: function(a, c) {
        if (this.getSelection() === a) {
            return
        }
        if (a) {
            if (c) {
                this._input.className = this.HSCLS
            } else {
                this._input.className = this.NSCLS
            }
        } else {
            if (c) {
                this._input.className = this.HCLS
            } else {
                this._input.className = this.NCLS
            }
        }
        DNA.widget.CheckButton.superclass.setSelection.call(this, a)
    },
    _onClick: function(a) {
        this._animatedCheck();
        this.setSelection(!this.getSelection(), true)
    },
    _animatedCheck: function() {
        var b = new DNA.engine.Sprite(this._input);
        b.setScale(1.2);
        var a = new DNA.engine.Sprite(this._input);
        a.setScale(1);
        new DNA.engine.LinearMotion(new DNA.engine.Frame([b]),new DNA.engine.Frame([a]),30,400).play()
    }
});
DNA.widget.LinkButton = function(a) {
    DNA.widget.LinkButton.superclass.constructor.call(this, a)
}
;
DNA.widget.LinkButton.extend(DNA.widget.AbstractButton, {
    setImage: function(a) {},
    _getImage: function() {},
    _getTrim: function() {
        return new DNA.widget.Point(2,2)
    },
    _focus: function() {
        this._textEl.className = "btn-link-text-a"
    },
    _blur: function() {
        this._textEl.className = "btn-link-text"
    },
    _doBuildElements: function() {
        var a = this.el.firstChild.firstChild.firstChild;
        this._textEl = a.childNodes[0].firstChild
    },
    _onClick: function(b) {
        var a = b.getSrcElement();
        if (a == this._textEl) {
            this.setSelection(false)
        }
    }
});
DNA.widget.PushButton = function(a) {
    DNA.widget.PushButton.superclass.constructor.call(this, a)
}
;
DNA.widget.PushButton.extend(DNA.widget.AbstractPushButton, {
    _onClick: function(a) {
        this.setSelection(false)
    },
    _onDisable: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            if (a.isAncestorOf(this)) {
                this._clearOverStyle()
            }
        }
    })
});
DNA.widget.RadioButton = function(a) {
    DNA.widget.RadioButton.superclass.constructor.call(this, a)
}
;
DNA.widget.RadioButton.extend(DNA.widget.AbstractCheckButton, {
    HCLS: "btn-chk-input btn-rdo-h",
    HSCLS: "btn-chk-input btn-rdo-s-h",
    DCLS: "btn-chk-input btn-rdo-d",
    DSCLS: "btn-chk-input btn-rdo-s-d",
    NCLS: "btn-chk-input btn-rdo-n",
    NSCLS: "btn-chk-input btn-rdo-s-n",
    setSelection: function(c, l) {
        if (c) {
            this._animatedCheck();
            if (l) {
                this._input.className = this.HSCLS
            } else {
                this._input.className = this.NSCLS
            }
        } else {
            if (l) {
                this._input.className = this.HCLS
            } else {
                this._input.className = this.NCLS
            }
        }
        DNA.widget.RadioButton.superclass.setSelection.call(this, c);
        if (c) {
            var g = this.getParentControl().getChildren();
            for (var d = 0, a = g.length; d < a; d++) {
                var m = g[d];
                if (m != this && m instanceof DNA.widget.RadioButton) {
                    if (m.getSelection()) {
                        m.checkRendered(true);
                        m.setSelection(false)
                    }
                }
            }
        }
    },
    _onClick: function(a) {
        this.setSelection(true, true)
    },
    _animatedCheck: function() {
        var b = new DNA.engine.Sprite(this._input);
        b.setScale(1.2);
        var a = new DNA.engine.Sprite(this._input);
        a.setScale(1);
        new DNA.engine.LinearMotion(new DNA.engine.Frame([b]),new DNA.engine.Frame([a]),30,400).play()
    }
});
DNA.widget.ToggleButton = function(a) {
    DNA.widget.ToggleButton.superclass.constructor.call(this, a)
}
;
DNA.widget.ToggleButton.extend(DNA.widget.AbstractPushButton, {
    setSelection: function(a) {
        DNA.widget.ToggleButton.superclass.setSelection.call(this, a);
        if (a) {
            this._center.className = "btn-push-a-center";
            this._center.firstChild.style.marginTop = "2px";
            this._mousedownFlag = true
        } else {
            this._center.className = "btn-push-n-center";
            this._center.firstChild.style.marginTop = "0px";
            this._mousedownFlag = false
        }
    },
    _doMouseover: new DNA.engine.Action({
        handle: function() {
            if (!this.getSelection()) {
                if (!this._mousedownFlag) {
                    this._center.className = "btn-push-h-center";
                    this._center.firstChild.style.marginTop = "0px";
                    this._updateBorderClasses("h")
                }
            }
        }
    }),
    _doMouseupout: new DNA.engine.Action({
        handle: function() {
            if (!this.getSelection()) {
                this._clearOverStyle()
            }
        }
    }),
    _doMouseup: new DNA.engine.Action(),
    _onClick: function(a) {
        this.setSelection(!this.getSelection())
    }
});
DNA.widget.AbstractLabel = function(a) {
    DNA.widget.AbstractLabel.superclass.constructor.call(this, a)
}
;
DNA.widget.AbstractLabel.extend(DNA.widget.Control, {
    autoRender: true,
    computeSize: function(g, c, h) {
        var d = new DNA.widget.Point();
        if (g != DNA.JWT.DEFAULT && c != DNA.JWT.DEFAULT) {
            d.x = g;
            d.y = c
        } else {
            d = this._getComputeSize(g, c, h);
            var a = this.getBorderSize();
            d.x += a;
            d.y += a;
            if (g != DNA.JWT.DEFAULT) {
                d.x = g
            } else {
                if (c != DNA.JWT.DEFAULT) {
                    d.y = c
                }
            }
        }
        return d
    },
    _getComputeSize: function() {},
    setImage: function(a) {},
    setText: function(a) {},
    _getImage: function() {},
    getText: function() {}
});
Object.override(DNA.widget.AbstractLabel.prototype, {
    jtype: "Label",
    focusable: false
});
DNA.widget.SeparatorLabel = function(a) {
    DNA.widget.SeparatorLabel.superclass.constructor.call(this, a)
}
;
DNA.widget.SeparatorLabel.extend(DNA.widget.AbstractLabel, {
    _getComputeSize: function(b, a, c) {
        if (this.getStyle() & DNA.JWT.HORIZONTAL) {
            return new DNA.widget.Point(20,2)
        } else {
            return new DNA.widget.Point(2,20)
        }
    }
});
DNA.widget.TextLabel = function(a) {
    DNA.widget.TextLabel.superclass.constructor.call(this, a)
}
;
DNA.widget.TextLabel.extend(DNA.widget.AbstractLabel, {
    _getComputeSize: function(g, n, l) {
        var d = this.getFont();
        var p = this.getText();
        var o = DNA.engine.DomUtil.getTextHeight(d);
        if (p) {
            if (this.getStyle() & DNA.JWT.WRAP) {
                if (g != DNA.JWT.DEFAULT) {
                    var q = DNA.engine.DomUtil.getFoldedTextInf(p, d, g, DNA.engine.DomUtil.WRAP_CHAR.HTML);
                    if (!(DNA.engine.Client.isIE() && !DNA.engine.Client.isStrict())) {
                        q.height = q.height + q.lineCounter
                    }
                    return new DNA.widget.Point(q.width,q.height)
                } else {
                    var m = p.split("\n");
                    var c = 0;
                    var b = m.length;
                    for (var h = 0; h < b; h++) {
                        c = Math.max(c, DNA.engine.DomUtil.computeTextSize(m[h], d).width)
                    }
                    if (m[b - 1] == "\n") {
                        b--
                    }
                    return new DNA.widget.Point(c,b * o)
                }
            } else {
                var a = DNA.engine.DomUtil.computeTextSize(p, d);
                return new DNA.widget.Point(a.width,o)
            }
        } else {
            return new DNA.widget.Point(0,o)
        }
    },
    setText: function(a) {
        this._text = a;
        DNA.engine.DomUtil.setInnerText(this.getEl().firstChild, this._text || "");
        this._handleResizeText()
    },
    getText: function() {
        if (!this._text) {
            this._text = this.getInitData(DNA.JWTProperty.PROPERTY_TEXT);
            delete this.getInitData()[DNA.JWTProperty.PROPERTY_TEXT]
        }
        return this._text
    },
    _resize: function() {
        if (this.getStyle() & DNA.JWT.WRAP) {
            var a = this.getBorderSize();
            var c = this.getBounds();
            var d = DNA.engine.DomUtil.getFoldedTextInf(this.getText(), this.getFont(), c.width - a, DNA.engine.DomUtil.WRAP_CHAR.HTML).text;
            if (d) {
                this.getEl().firstChild.innerHTML = d
            }
        }
        this._handleResizeText()
    },
    _handleResizeText: function() {
        if (this.getStyle() & (DNA.JWT.MIDDLE | DNA.JWT.BOTTOM)) {
            if (this.getStyle() & DNA.JWT.WRAP) {
                var c = this.getBorderSize();
                var g = this.getBounds();
                var h = DNA.engine.DomUtil.getFoldedTextInf(this.getText(), this.getFont(), g.width - c, DNA.engine.DomUtil.WRAP_CHAR.HTML).text;
                if (h) {
                    var a = h.split("<br/>");
                    var d = a.length;
                    d = a[a.length - 1] == "" ? d - 1 : d;
                    d = d >= 0 ? d : 0;
                    this._resizeText(d)
                }
            } else {
                this._resizeText(1)
            }
        }
    },
    _resizeText: function(b) {
        var c = this.getBounds();
        var a = DNA.engine.DomUtil.computeTextSize(this.getText(), this.getFont()).height;
        if (!(DNA.engine.Client.isIE() && !DNA.engine.Client.isStrict())) {
            a = a + 1
        }
        var d = 0;
        if (this.getStyle() & DNA.JWT.MIDDLE) {
            d = (c.height - a * b) / 2
        } else {
            if (this.getStyle() & DNA.JWT.BOTTOM) {
                d = c.height - a * b
            }
        }
        if (this.getText() && this.getText().indexOf(" ") != -1 && !(this.getStyle() & DNA.JWT.WRAP)) {
            if (DNA.engine.Client.isChrome() && DNA.engine.Client.getBrowserVersion() < 49) {
                d -= c.height == 12 ? 2 : 3
            }
            if (DNA.engine.Client.isFF()) {
                d -= c.height == 12 ? 0 : 2
            }
        }
        this.getEl().firstChild.style.position = "relative";
        this.getEl().firstChild.style.top = d + "px"
    },
    _setFont: function(a) {
        var c = this.getEl();
        if (c) {
            DNA.engine.DomUtil.setFont(c, a);
            var b = c.firstChild;
            if (b) {
                DNA.engine.DomUtil.setFont(b, a)
            }
        }
    }
});
DNA.widget.ImageLabel = function(a) {
    DNA.widget.ImageLabel.superclass.constructor.call(this, a)
}
;
DNA.widget.ImageLabel.extend(DNA.widget.AbstractLabel, {
    _getComputeSize: function(b, a, d) {
        var c = this._getImage();
        if (c) {
            return new DNA.widget.Point(c.width,c.height)
        } else {
            return new DNA.widget.Point(0,0)
        }
    },
    setImage: function(b) {
        this._image = b;
        var a;
        if (this.getStyle() & DNA.JWT.FILL || this.getStyle() & DNA.JWT.STRETCH) {
            a = this.getEl().firstChild.firstChild;
            if (a && b) {
                a.src = b.url
            } else {
                this.getEl().firstChild.innerHTML = b ? b.getHTML(DNA.JWT.FILL) : ""
            }
            this._resize()
        } else {
            a = this.getEl().firstChild;
            if (a && b) {
                a.src = b.url;
                a.style.width = b.width + "px";
                a.style.height = b.height + "px"
            } else {
                this.getEl().innerHTML = b ? b.getHTML() : ""
            }
        }
    },
    _getImage: function() {
        if (!this._image) {
            this._image = this.getInitData(DNA.JWTProperty.PROPERTY_IMAGE);
            delete this.getInitData()[DNA.JWTProperty.PROPERTY_IMAGE]
        }
        return this._image
    },
    _resize: function() {
        if (this.getStyle() & DNA.JWT.FILL) {
            var g = this._getImage();
            var d = this.getEl().firstChild.firstChild;
            if (g && d) {
                var n = this.getBorderSize();
                var q = this.getBounds();
                var a = q.width - n;
                var r = q.height - n;
                if (a > 0 && r > 0) {
                    var o = 0;
                    var p = 0;
                    var l = a / r;
                    var h = g.width / g.height;
                    if (l >= h) {
                        o = Math.round((r / g.height) * g.width);
                        o = o < 0 ? 0 : o;
                        p = r;
                        var c = (a - o) / 2;
                        c = c < 0 ? 0 : c;
                        d.style.left = c + "px";
                        d.style.top = "0px";
                        d.style.width = o + "px";
                        d.style.height = "100%"
                    } else {
                        o = a;
                        p = Math.round((a / g.width) * g.height);
                        p = p < 0 ? 0 : p;
                        var m = (r - p) / 2;
                        m = m < 0 ? 0 : m;
                        d.style.left = "0px";
                        d.style.top = m + "px";
                        d.style.width = "100%";
                        d.style.height = p + "px"
                    }
                }
            }
        } else {
            if (this.getStyle() & DNA.JWT.STRETCH) {
                var g = this._getImage();
                var d = this.getEl().firstChild.firstChild;
                if (g && d) {
                    var n = this.getBorderSize();
                    var q = this.getBounds();
                    var a = q.width - n;
                    var r = q.height - n;
                    if (a > 0 && r > 0) {
                        d.style.left = "0px";
                        d.style.top = "0px";
                        d.style.width = "100%";
                        d.style.height = "100%"
                    }
                }
            }
        }
    }
});
DNA.widget.Abstract2ButtonControl = function(a) {
    DNA.widget.Abstract2ButtonControl.superclass.constructor.call(this, a)
}
;
DNA.widget.Abstract2ButtonControl.extend(DNA.widget.Control, {
    autoRender: true,
    _setBackground: function(a) {
        this._setDomStyle(this._getDomArray(), "background-color", a)
    },
    _setForeground: function(a) {
        this._setDomStyle(this._getDomArray(), "color", a)
    },
    _setFont: function(a) {
        DNA.engine.DomUtil.setFont(this._hour, a);
        DNA.engine.DomUtil.setFont(this._minute, a);
        DNA.engine.DomUtil.setFont(this._second, a)
    },
    _registEvents: function() {
        DNA.widget.Abstract2ButtonControl.superclass._registEvents.call(this);
        this.addListener("mousemove", this._doButtonMove, this);
        this.addListener("keydown", this._doKeydown, this);
        this.addListener("keyup", this._doKeyup, this);
        this.addListener("mousedown", this._doMousedown, this);
        this.addListener("mouseup", this._doMouseup, this);
        this.addListener("dblclick", this._doDBClick, this);
        this.addListener("mouseout", this._doMouseout, this)
    },
    _doButtonMove: new DNA.engine.Action({
        handle: function(a) {
            if (this._checkDomEqual(a.getSrcElement(), this._incBtn)) {
                this._setButtonHover(this._incBtn);
                this._setButtonNormal(this._decBtn)
            } else {
                if (this._checkDomEqual(a.getSrcElement(), this._decBtn)) {
                    this._setButtonHover(this._decBtn);
                    this._setButtonNormal(this._incBtn)
                } else {
                    this._setButtonNormal(this._incBtn);
                    this._setButtonNormal(this._decBtn)
                }
            }
        }
    }),
    _doMousedown: new DNA.engine.Action({
        handle: function(a) {
            this._doMousedownFun(a)
        }
    }),
    _doMousedownFun: function(b) {
        this._cancelThread();
        var a = b.getSrcElement();
        if (this._checkDomEqual(b.getSrcElement(), this._incBtn)) {
            this._setButtonDown(this._incBtn);
            this._executechange(this._increaseSelection)
        } else {
            if (this._checkDomEqual(b.getSrcElement(), this._decBtn)) {
                this._setButtonDown(this._decBtn);
                this._executechange(this._decreaseSelection)
            }
        }
    },
    _executechange: function(b) {
        b.apply(this);
        var c = this._longDelayRunnable;
        var a = this;
        this._changeWaiter = setTimeout(function() {
            c.call(a, b)
        }, 300)
    },
    _longDelayRunnable: function(a) {
        this._cancelThread();
        this._thread = new DNA.engine.Thread(80,new DNA.engine.Runnable(a,this));
        this._thread.start()
    },
    _doMouseup: new DNA.engine.AppSuspendedAction({
        handle: function(b) {
            this._cancelThread();
            this._buttonDown = null ;
            var a = b.getSrcElement();
            if (this._checkDomEqual(a, this._incBtn) || this._checkDomEqual(a, this._decBtn)) {
                this._setButtonNormal(this._incBtn);
                this._setButtonNormal(this._decBtn)
            }
        }
    }),
    _doDBClick: new DNA.engine.Action({
        handle: function(b) {
            var a = b.getSrcElement();
            if (this._checkDomEqual(a, this._incBtn)) {
                this._increaseSelection(false)
            } else {
                if (this._checkDomEqual(a, this._decBtn)) {
                    this._decreaseSelection(false)
                } else {
                    this._contentSelection()
                }
            }
        }
    }),
    _doMouseout: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            this._cancelThread();
            this._buttonDown = null ;
            this._setButtonNormal(this._incBtn);
            this._setButtonNormal(this._decBtn)
        }
    }),
    _setButtonNormal: function(a) {
        a.className = "datetime-btn-bg spinner-bg-n"
    },
    _setButtonHover: function(a) {
        if (this._buttonDown != a) {
            a.className = "datetime-btn-bg spinner-bg-h"
        }
    },
    _setButtonDown: function(a) {
        this._buttonDown = a;
        a.className = "datetime-btn-bg spinner-bg-a"
    },
    _cancelThread: function() {
        if (this._changeWaiter) {
            clearTimeout(this._changeWaiter);
            delete this._changeWaiter
        }
        if (this._thread) {
            this._thread.stop();
            this._thread = null 
        }
    },
    _checkDomEqual: function(b, a) {
        return b == a || b == a.firstChild
    },
    _getDomArray: function() {},
    _setDomStyle: function(d, b, c) {
        for (var a = 0; a < d.length; a++) {
            DNA.engine.DomUtil.setStyle(d[a], b, c)
        }
    },
    doDispose: function() {
        this._cancelThread();
        DNA.widget.Abstract2ButtonControl.superclass.doDispose.call(this)
    },
    getInitValue: function(b, c, a) {
        if (this[c] == undefined) {
            this[c] = this.getInitData(b) || a;
            delete this.getInitData()[b]
        }
        return this[c]
    },
    _contentSelection: function() {}
});
DNA.widget.Spinner = function(a) {
    DNA.widget.Spinner.superclass.constructor.call(this, a)
}
;
DNA.widget.Spinner.extend(DNA.widget.Abstract2ButtonControl, {
    _registEvents: function() {
        DNA.widget.Spinner.superclass._registEvents.call(this);
        if (!DNA.engine.Client.isIE()) {
            DNA.engine.application.getJWTEventMgr().handleSelfEvent(this, "input", this._inputEl);
            this.addListener("input", this._textChange, this)
        }
    },
    isEditable: function() {
        return !this._checkState(DNA.JWT.STATE_MODE_READONLY)
    },
    setEditable: function(a) {
        if (a) {
            this._unmaskState(DNA.JWT.STATE_MODE_READONLY)
        } else {
            this._maskState(DNA.JWT.STATE_MODE_READONLY)
        }
    },
    _textChange: new DNA.engine.Action({
        handle: function(b) {
            var a = this._inputEl.value || "";
            if (!a.match(/^[\-0-9.]*$/)) {
                a = a.replace(/[^\-0-9.]/g, "")
            }
            if (!(this.getDigits() > 0)) {
                a = a.replace(/\./g, "")
            }
            if (this.getMinimum() < 0) {
                a = a.replace(/(.)-/g, "$1")
            } else {
                a = a.replace(/-/g, "")
            }
            this._inputEl.value = a
        }
    }),
    getDigits: function() {
        return this.getInitValue(DNA.JWTProperty.PROPERTY_DIGITS, "_digits", 0)
    },
    setDigits: function(a) {
        this._digits = a;
        this._renderSelection(this._getSelection())
    },
    getIncrement: function() {
        return this.getInitValue(DNA.JWTProperty.PROPERTY_INCREMENT, "_increment", 1)
    },
    setIncrement: function(a) {
        this._increment = a
    },
    getMaximum: function() {
        return this.getInitValue(DNA.JWTProperty.PROPERTY_MAXIMUM, "_maximum", 100)
    },
    setMaximum: function(a) {
        this._maximum = a;
        this._inputEl.setAttribute("maxlength", ("" + a).length);
        this.setSelection(this.getSelection())
    },
    getMinimum: function() {
        return this.getInitValue(DNA.JWTProperty.PROPERTY_MINIMUM, "_minimum", 0)
    },
    setMinimum: function(a) {
        this._minimum = a;
        this.setSelection(this.getSelection())
    },
    getPageIncrement: function() {
        return this.getInitValue(DNA.JWTProperty.PROPERTY_PAGE_INCREMENT, "_pageIncrement", 10)
    },
    setPageIncrement: function(a) {
        this._pageIncrement = a
    },
    setStartSelectionPosition: function(a) {
        this._selStart = a
    },
    setEndSelectionPosition: function(a) {
        this._selEnd = a;
        this.setSelectPoint(this._selStart, this._selEnd)
    },
    setSelectPoint: function(a, d) {
        if (!this.checkRendered(true)) {
            return
        }
        if (isNaN(a)) {
            a = 0
        }
        if (isNaN(d)) {
            d = 0
        }
        try {
            if (DNA.engine.Client.isIE()) {
                var b = this._inputEl.createTextRange();
                b.moveEnd("character", -this._inputEl.value.length);
                b.moveStart("character", -this._inputEl.value.length);
                b.collapse(true);
                b.moveEnd("character", d);
                b.moveStart("character", a);
                b.select()
            } else {
                this._inputEl.selectionStart = a;
                this._inputEl.selectionEnd = d
            }
        } catch (c) {}
    },
    _checkSelPos: function() {
        if (this._selEnd) {
            return true
        }
        if (this._selEnd === 0) {
            return true
        }
        return false
    },
    setButtonVisible: function(a) {
        this._buttonVisible = a;
        if (a) {
            this._btnEl.style.display = ""
        } else {
            this._btnEl.style.display = "none"
        }
        this._resize()
    },
    isButtonVisible: function() {
        return this.getInitValue(DNA.JWTProperty.PROPERTY_DOWNBUTTON_VISIBLE, "_buttonVisible", true)
    },
    getSelection: function() {
        return this.getInitValue(DNA.JWTProperty.PROPERTY_SELECTION, "_selection", 0)
    },
    setSelection: function(b, a) {
        this.bak = this._selection;
        this._setSelection(b, a);
        this._renderSelection(this._selection);
        this._updateState(this._selection)
    },
    _setSelection: function(b, a, c) {
        var d = Math.floor(b);
        if (d >= this.getMinimum() && d <= this.getMaximum()) {
            this._selection = d
        }
        if (!a) {
            this.fireEvent("document", [this, c != undefined ? c : d, this.bak != this._selection])
        }
    },
    _getSelection: function() {
        var a = this.getSelection();
        if (a < this.getMinimum()) {
            a = this.getMinimum()
        } else {
            if (a > this.getMaximum()) {
                a = this.getMaximum()
            }
        }
        return a
    },
    computeSize: function(c, a, g) {
        var b = new DNA.widget.Point();
        if (c != -1) {
            b.x = c
        } else {
            b.x = DNA.PropertyDefaultValue[DNA.JWTProperty.DV_SPINNER_WIDTH]
        }
        if (a != -1) {
            b.y = a
        } else {
            b.y = DNA.PropertyDefaultValue[DNA.JWTProperty.DV_SPINNER_HEIGHT];
            var d = DNA.engine.application.getWidgetGlobalProperties().getGlobalProperty("Text", "defaultheight");
            if (d && d > b.y) {
                b.y = d
            }
        }
        return b
    },
    _setFont: function(a) {
        DNA.engine.DomUtil.setFont(this._inputEl, a)
    },
    _doBuildElements: function() {
        var a = this.el.firstChild.firstChild.firstChild;
        this._inputEl = a.childNodes[0].firstChild;
        this._btnEl = a.childNodes[1];
        this._incBtn = this._btnEl.childNodes[0];
        this._decBtn = this._btnEl.childNodes[1]
    },
    _doKeydown: new DNA.engine.Action({
        handle: function(c) {
            var a = c.getSrcElement();
            var b = c.getKeyCode();
            if (this.getDigits() > 0 && b == 190) {
                return
            } else {
                if (this.getMinimum() < 0 && (b == DNA.JWTEvent.SUBTRACT || b == 173) && (this._inputEl.value.length == 0 || (this._inputEl.value.length > 0 && this._inputEl.selectionStart == 0 && this._inputEl.value.substring(this._inputEl.selectionEnd).indexOf("-") < 0))) {
                    return
                } else {
                    if (b == DNA.JWTEvent.UP) {
                        this._increaseSelection()
                    } else {
                        if (b == DNA.JWTEvent.DOWN) {
                            this._decreaseSelection()
                        } else {
                            if (b == DNA.JWTEvent.PAGEUP) {
                                this._increaseSelection(true)
                            } else {
                                if (b == DNA.JWTEvent.PAGEDOWN) {
                                    this._decreaseSelection(true)
                                } else {
                                    if (b == DNA.JWTEvent.LEFT) {
                                        return
                                    } else {
                                        if (b == DNA.JWTEvent.RIGHT) {
                                            return
                                        } else {
                                            if (b == DNA.JWTEvent.ENTER) {
                                                this.fireEvent("action", [c])
                                            } else {
                                                if ((this.getStyle() & DNA.JWT.READ_ONLY) === 0) {
                                                    if (this.isEditable()) {
                                                        if ((!c.isShift() && b >= 48 && b <= 57) || (b >= 96 && b <= 105)) {
                                                            return
                                                        } else {
                                                            if (c.isCtrl() && b == 86) {
                                                                this.bak = this._selection;
                                                                return
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            if (c.isCtrl() && b == 67) {
                return
            } else {
                if (b <= 20 || b == 46) {
                    return
                } else {
                    c._preventDefault()
                }
            }
        }
    }),
    _doKeyup: new DNA.engine.Action({
        handle: function(c) {
            var b = c.getKeyCode();
            var a = c.getSrcElement();
            if ((this.getDigits() > 0 && b == 190) || ((!c.isShift()) && ((b >= 48 && b <= 57) || (b >= 96 && b <= 105))) || (b <= 20 || b == 46) || (this.getMinimum() < 0 && (b == DNA.JWTEvent.SUBTRACT || b == 173))) {
                this._checkInputSelection()
            }
        }
    }),
    _renderSelection: function(b) {
        var a = "";
        var c = this.getDigits();
        if (c > 0) {
            a += (b / Math.pow(10, c)).toFixed(c)
        } else {
            a += b
        }
        if (a != this._inputEl.value) {
            this._inputEl.value = a
        }
    },
    _checkInputSelection: function() {
        var d = this._inputEl.value;
        if (!d.match(/^[\-0-9.]*$/)) {
            d = d.replace(/[^\-0-9.]/g, "")
        }
        if (!(this.getDigits() > 0)) {
            d = d.replace(/\./g, "")
        }
        if (this.getMinimum() < 0) {
            d = d.replace(/(.)-/g, "$1")
        } else {
            d = d.replace(/-/g, "")
        }
        var b = d.length;
        var a = "";
        if (d && b > 0) {
            var c = this.getDigits();
            if (c > 0) {
                a = parseInt(parseFloat(d) * Math.pow(10, c))
            } else {
                if (d != "-") {
                    a = parseInt(d, 10)
                } else {
                    a = "-"
                }
            }
        }
        this._renderSelection(a);
        this._setSelection(a, false, d);
        this._updateState(a, d)
    },
    _updateState: function(b, a) {
        if (a != undefined && this.getDigits() > 0 && a.substring(a.indexOf(".") + 1).length > this.getDigits() && parseInt(a.substring(a.indexOf(".") + 1 + this.getDigits())) > 0) {
            this.setModeState(DNA.JWT.STATE_MODE_ERROR)
        } else {
            if (b >= this.getMinimum() && b <= this.getMaximum()) {
                this.removeModeState(DNA.JWT.STATE_MODE_ERROR)
            } else {
                this.setModeState(DNA.JWT.STATE_MODE_ERROR)
            }
        }
    },
    _increaseSelection: function(a) {
        if (a) {
            this.setSelection(this._getSelection() + this.getPageIncrement())
        } else {
            this.setSelection(this._getSelection() + this.getIncrement())
        }
    },
    _decreaseSelection: function(a) {
        if (a) {
            this.setSelection(this._getSelection() - this.getPageIncrement())
        } else {
            this.setSelection(this._getSelection() - this.getIncrement())
        }
    },
    _contentSelection: function() {
        if (this.isEnabled()) {
            this._inputEl.focus()
        }
    },
    _focus: function(a) {
        if (this.isEnabled()) {
            this._inputEl.focus();
            a._preventDefault();
            if (DNA.engine.Client.isIE()) {
                if (this._checkSelPos()) {
                    this.setSelectPoint(this._selStart, this._selEnd)
                } else {
                    this._inputEl.select()
                }
            }
        }
    },
    _blur: function(a) {
        this.setSelection(this._getSelection());
        if (this.isEnabled()) {
            this._inputEl.blur()
        }
    },
    _getDomArray: function() {
        return [this.el, this._inputEl]
    },
    _resize: function() {},
    doDispose: function() {
        DNA.widget.Spinner.superclass.doDispose.call(this);
        delete this._inputEl;
        delete this._incBtn;
        delete this._decBtn;
        delete this._buttonDown;
        delete this._btnEl
    }
});
Object.override(DNA.widget.Spinner.prototype, {
    jtype: "Spinner",
    focusable: true
});
DNA.widget.DateTime = function(a) {
    DNA.widget.DateTime.superclass.constructor.call(this, a)
}
;
DNA.widget.DateTime.extend(DNA.widget.Abstract2ButtonControl, {
    _selectionType: 0,
    getDate: function() {
        if (this._date == undefined) {
            var a = this.getInitData(DNA.JWTProperty.PROPERTY_DATETIME);
            if (a) {
                this._date = new Date(this.getInitData(DNA.JWTProperty.PROPERTY_DATETIME))
            } else {
                this._date = new Date()
            }
            delete this.getInitData()[DNA.JWTProperty.PROPERTY_DATETIME]
        }
        return this._date
    },
    setDate: function(c) {
        this._date = new Date(c);
        var a = this._date.getHours();
        var b = this._date.getMinutes();
        var d = this._date.getSeconds();
        if (a < 10) {
            a = "0" + a
        }
        if (b < 10) {
            b = "0" + b
        }
        if (d < 10) {
            d = "0" + d
        }
        this._setDate(a, b, d);
        this._renderDate(a, b, d)
    },
    setTime: function(b, d, n) {
        var c = this.getDate();
        var l = c.getHours();
        var a = c.getMinutes();
        var g = c.getSeconds();
        if ((b != l) || (d != a) || (n != g)) {
            this._setDate(b < 0 ? l : b, d < 0 ? a : d, n < 0 ? g : n);
            this._renderDate(b, d, n);
            this.fireEvent("selection", [this])
        }
    },
    _setFont: function(a) {
        DNA.engine.DomUtil.setFont(this._hour, a);
        DNA.engine.DomUtil.setFont(this._minute, a);
        DNA.engine.DomUtil.setFont(this._second, a)
    },
    computeSize: function(c, a, d) {
        var b = new DNA.widget.Point();
        if (!isNaN(c) && c != DNA.JWT.DEFAULT) {
            b.x = c
        } else {
            b.x = 100
        }
        if (!isNaN(a) && a != DNA.JWT.DEFAULT) {
            b.y = a
        } else {
            b.y = 21
        }
        return b
    },
    _doBuildElements: function() {
        var b = this.el.firstChild.firstChild.firstChild;
        this._hour = b.childNodes[0].firstChild;
        this._s1 = b.childNodes[1].firstChild;
        this._minute = b.childNodes[2].firstChild;
        this._s2 = b.childNodes[3].firstChild;
        this._second = b.childNodes[4].firstChild;
        var a = b.childNodes[5];
        this._incBtn = a.childNodes[0];
        this._decBtn = a.childNodes[1]
    },
    _doKeydown: new DNA.engine.Action({
        handle: function(d) {
            var a = d.getSrcElement();
            if (a == this._hour || a == this._minute || a == this._second) {
                var c = d.getKeyCode();
                if (c == DNA.JWTEvent.UP) {
                    this._increaseSelection()
                } else {
                    if (c == DNA.JWTEvent.DOWN) {
                        this._decreaseSelection()
                    } else {
                        if (c == DNA.JWTEvent.LEFT) {
                            var b = this._getSelectionType();
                            b--;
                            this._setSelectionType(b < 0 ? 2 : b);
                            this._select();
                            d._preventDefault()
                        } else {
                            if (c == DNA.JWTEvent.RIGHT) {
                                var b = this._getSelectionType();
                                b++;
                                this._setSelectionType(b > 2 ? 0 : b);
                                this._select();
                                d._preventDefault()
                            } else {
                                if ((!d.isShift()) && ((c >= 48 && c <= 57) || (c >= 96 && c <= 105))) {
                                    return
                                } else {
                                    if (c <= 20) {
                                        return
                                    } else {
                                        d._preventDefault()
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }),
    _registEvents: function() {
        DNA.widget.DateTime.superclass._registEvents.call(this);
        this.addListener("mousedown", this._doMouseDown, this);
        this.addListener("click", this._doClick, this)
    },
    _doClick: new DNA.engine.Action({
        handle: function(a) {
            this._select()
        }
    }),
    _doMouseDown: new DNA.engine.Action({
        handle: function(b) {
            var a = b.getSrcElement();
            if (a == this._hour) {
                this._setSelectionType(0)
            } else {
                if (a == this._minute) {
                    this._setSelectionType(1)
                } else {
                    if (a == this._second) {
                        this._setSelectionType(2)
                    }
                }
            }
        }
    }),
    _doKeyup: new DNA.engine.Action({
        handle: function(c) {
            var b = c.getKeyCode();
            var a = c.getSrcElement();
            if (a == this._hour || a == this._minute || a == this._second) {
                if (((!c.isShift()) && ((b >= 48 && b <= 57) || (b >= 96 && b <= 105))) || (b <= 20)) {
                    this._checkInputSelection()
                }
            }
        }
    }),
    _setDate: function(a, b, c) {
        if (!this._date) {
            this._date = new Date()
        }
        if (a >= 0) {
            this._date.setHours(a)
        }
        if (b >= 0) {
            this._date.setMinutes(b)
        }
        if (c >= 0) {
            this._date.setSeconds(c)
        }
    },
    _renderZero: function() {
        if (this._selectionType != 0 && this._hour.value < 10 && this._hour.value.length == 1) {
            this._hour.value = "0" + this._hour.value
        }
        if (this._selectionType != 1 && this._minute.value < 10 && this._minute.value.length == 1) {
            this._minute.value = "0" + this._minute.value
        }
        if (this._selectionType != 2 && this._second.value < 10 && this._second.value.length == 1) {
            this._second.value = "0" + this._second.value
        }
    },
    _blur: function(a) {
        if (this._hour.value < 10 && this._hour.value.length == 1) {
            this._hour.value = "0" + this._hour.value
        }
        if (this._minute.value < 10 && this._minute.value.length == 1) {
            this._minute.value = "0" + this._minute.value
        }
        if (this._second.value < 10 && this._second.value.length == 1) {
            this._second.value = "0" + this._second.value
        }
    },
    _renderDate: function(a, b, c) {
        if (a >= 0) {
            this._hour.value = a
        }
        if (b >= 0) {
            this._minute.value = b
        }
        if (c >= 0) {
            this._second.value = c
        }
        this._renderZero()
    },
    _increaseSelection: function() {
        var b = this.getDate();
        var d = this._getSelectionType();
        if (d == 0) {
            var a = b.getHours();
            a++;
            if (a < 10) {
                this.setTime(a > 23 ? "00" : "0" + a, -1, -1)
            } else {
                this.setTime(a > 23 ? "00" : a, -1, -1)
            }
        } else {
            if (d == 1) {
                var c = b.getMinutes();
                c++;
                if (c < 10) {
                    this.setTime(-1, c > 59 ? "00" : "0" + c, -1)
                } else {
                    this.setTime(-1, c > 59 ? "00" : c, -1)
                }
            } else {
                if (d == 2) {
                    var g = b.getSeconds();
                    g++;
                    if (g < 10) {
                        this.setTime(-1, -1, g > 59 ? "00" : "0" + g)
                    } else {
                        this.setTime(-1, -1, g > 59 ? "00" : g)
                    }
                }
            }
        }
        this._select()
    },
    _decreaseSelection: function() {
        var b = this.getDate();
        var d = this._getSelectionType();
        if (d == 0) {
            var a = b.getHours();
            a--;
            if (a < 10 & a >= 0) {
                this.setTime(a < 0 ? 23 : "0" + a, -1, -1)
            } else {
                this.setTime(a < 0 ? 23 : a, -1, -1)
            }
        } else {
            if (d == 1) {
                var c = b.getMinutes();
                c--;
                if (c < 10 & c >= 0) {
                    this.setTime(-1, c < 0 ? 59 : "0" + c, -1)
                } else {
                    this.setTime(-1, c < 0 ? 59 : c, -1)
                }
            } else {
                if (d == 2) {
                    var g = b.getSeconds();
                    g--;
                    if (g < 10 & g >= 0) {
                        this.setTime(-1, -1, g < 0 ? 59 : "0" + g)
                    } else {
                        this.setTime(-1, -1, g < 0 ? 59 : g)
                    }
                }
            }
        }
        this._select()
    },
    _checkInputSelection: function() {
        var b = this.getDate();
        var c = this._getSelectionType();
        if (c == 0) {
            var a = this._hour.value;
            if (a && a.length > 0) {
                if (this._hour.value.length > 1) {
                    this._setSelectionType(1);
                    this._minute.select(0, this._minute.value.length)
                }
                var d = parseInt(a);
                if (d < 0) {
                    d = 0
                } else {
                    if (d > 23) {
                        d = 23
                    }
                }
                this.setTime(d, -1, -1)
            }
        } else {
            if (c == 1) {
                var a = this._minute.value;
                if (a && a.length > 0) {
                    if (this._minute.value.length > 1) {
                        this._setSelectionType(2);
                        this._second.select(0, this._second.value.length)
                    }
                    var d = parseInt(a);
                    if (d < 0) {
                        d = 0
                    } else {
                        if (d > 59) {
                            d = 59
                        }
                    }
                    this.setTime(-1, d, -1)
                }
            } else {
                if (c == 2) {
                    var a = this._second.value;
                    if (a && a.length > 0) {
                        var d = parseInt(a);
                        if (d < 0) {
                            d = 0
                        } else {
                            if (d > 59) {
                                d = 59
                            }
                        }
                        this.setTime(-1, -1, d)
                    }
                }
            }
        }
    },
    _getSelectionType: function() {
        return this._selectionType
    },
    _setSelectionType: function(a) {
        this._selectionType = a;
        this._renderZero()
    },
    _select: function() {
        var a = this._selectionType;
        if (a == 0) {
            this._hour.select(0, this._hour.value.length)
        } else {
            if (a == 1) {
                this._minute.select(0, this._minute.value.length)
            } else {
                if (a == 2) {
                    this._second.select(0, this._second.value.length)
                }
            }
        }
    },
    _getDomArray: function() {
        return [this.el, this._hour, this._s1, this._minute, this._s2, this._second]
    },
    doDispose: function() {
        DNA.widget.DateTime.superclass.doDispose.call(this);
        delete this._hour;
        delete this._s1;
        delete this._minute;
        delete this._s2;
        delete this._second;
        delete this._incBtn;
        delete this._decBtn;
        delete this._date
    }
});
Object.override(DNA.widget.DateTime.prototype, {
    jtype: "DateTime",
    focusable: true
});
DNA.widget.DateCalendar = function(a) {
    DNA.widget.DateCalendar.superclass.constructor.call(this, a)
}
;
DNA.widget.DateCalendar.extend(DNA.widget.SingleText, {
    setDate: function(a) {
        this._date = new Date(a);
        this._inputEl.value = this._date.format("Y-m-d")
    },
    getDate: function() {
        if (this._date == undefined) {
            var a = this.getInitData(DNA.JWTProperty.PROPERTY_DATETIME);
            if (a) {
                this._date = new Date(this.getInitData(DNA.JWTProperty.PROPERTY_DATETIME))
            } else {
                this._date = new Date()
            }
            delete this.getInitData()[DNA.JWTProperty.PROPERTY_DATETIME]
        }
        return this._date
    },
    computeSize: function(c, a, d) {
        var b = new DNA.widget.Point();
        if (!isNaN(c) && c != DNA.JWT.DEFAULT) {
            b.x = c
        } else {
            b.x = 100
        }
        if (!isNaN(a) && a != DNA.JWT.DEFAULT) {
            b.y = a
        } else {
            b.y = 21
        }
        return b
    },
    _doKeydown: new DNA.engine.Action({
        handle: function(a) {
            this._curText = this.getText();
            if (a.getKeyCode() == DNA.JWTEvent.ENTER) {
                this.fireEvent("action", [this])
            } else {
                if (a.getKeyCode() >= 48 && a.getKeyCode() <= 57) {
                    return
                } else {
                    if (a.getKeyCode() <= 20) {
                        return
                    } else {
                        if (a.getKeyCode() == DNA.JWTEvent.SUBTRACT) {
                            return
                        } else {
                            a._preventDefault()
                        }
                    }
                }
            }
        }
    }),
    _doKeyup: new DNA.engine.Action({
        handle: function(a) {
            var b = this._inputEl.value;
            if (this._curText != b) {
                this._text = b;
                this._transferDate(b);
                this.fireEvent("document", [this])
            }
        }
    }),
    _transferDate: function(b) {
        try {
            if (b) {
                var a = b.split("-");
                if (a.length == 3) {
                    this._date = new Date(a[0],a[1],a[2])
                }
            }
        } catch (c) {}
    }
});
Object.override(DNA.widget.DateCalendar.prototype, {
    jtype: "DateTime"
});
DNA.widget.DateMinute = function(a) {
    DNA.widget.DateMinute.superclass.constructor.call(this, a)
}
;
DNA.widget.DateMinute.extend(DNA.widget.Abstract2ButtonControl, {
    _selectionType: 0,
    getDate: function() {
        if (this._date == undefined) {
            var a = this.getInitData(DNA.JWTProperty.PROPERTY_DATETIME);
            if (a) {
                this._date = new Date(this.getInitData(DNA.JWTProperty.PROPERTY_DATETIME))
            } else {
                this._date = new Date()
            }
            delete this.getInitData()[DNA.JWTProperty.PROPERTY_DATETIME]
        }
        return this._date
    },
    setDate: function(c) {
        this._date = new Date(c);
        var a = this._date.getHours();
        var b = this._date.getMinutes();
        var d = this._date.getSeconds();
        if (a < 10) {
            a = "0" + a
        }
        if (b < 10) {
            b = "0" + b
        }
        if (d < 10) {
            d = "0" + d
        }
        this._setDate(a, b, d);
        this._renderDate(a, b, d)
    },
    setTime: function(b, d, n) {
        var c = this.getDate();
        var l = c.getHours();
        var a = c.getMinutes();
        var g = c.getSeconds();
        if ((b != l) || (d != a) || (n != g)) {
            this._setDate(b < 0 ? l : b, d < 0 ? a : d, n < 0 ? g : n);
            this._renderDate(b, d, n);
            this.fireEvent("selection", [this])
        }
    },
    _setFont: function(a) {
        DNA.engine.DomUtil.setFont(this._hour, a);
        DNA.engine.DomUtil.setFont(this._minute, a)
    },
    computeSize: function(c, a, d) {
        var b = new DNA.widget.Point();
        if (!isNaN(c) && c != DNA.JWT.DEFAULT) {
            b.x = c
        } else {
            b.x = 100
        }
        if (!isNaN(a) && a != DNA.JWT.DEFAULT) {
            b.y = a
        } else {
            b.y = 21
        }
        return b
    },
    _doBuildElements: function() {
        var b = this.el.firstChild.firstChild.firstChild;
        this._hour = b.childNodes[0].firstChild;
        this._s1 = b.childNodes[1].firstChild;
        this._minute = b.childNodes[2].firstChild;
        var a = b.childNodes[3];
        this._incBtn = a.childNodes[0];
        this._decBtn = a.childNodes[1]
    },
    _doKeydown: new DNA.engine.Action({
        handle: function(d) {
            var a = d.getSrcElement();
            if (a == this._hour || a == this._minute) {
                var c = d.getKeyCode();
                if (c == DNA.JWTEvent.UP) {
                    this._increaseSelection()
                } else {
                    if (c == DNA.JWTEvent.DOWN) {
                        this._decreaseSelection()
                    } else {
                        if (c == DNA.JWTEvent.LEFT) {
                            var b = this._getSelectionType();
                            b--;
                            this._setSelectionType(b < 0 ? 1 : b);
                            this._select();
                            d._preventDefault()
                        } else {
                            if (c == DNA.JWTEvent.RIGHT) {
                                var b = this._getSelectionType();
                                b++;
                                this._setSelectionType(b > 1 ? 0 : b);
                                this._select();
                                d._preventDefault()
                            } else {
                                if ((!d.isShift()) && ((c >= 48 && c <= 57) || (c >= 96 && c <= 105))) {
                                    return
                                } else {
                                    if (c <= 20) {
                                        return
                                    } else {
                                        d._preventDefault()
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }),
    _registEvents: function() {
        DNA.widget.DateMinute.superclass._registEvents.call(this);
        this.addListener("mousedown", this._doMouseDown, this);
        this.addListener("click", this._doClick, this)
    },
    _doClick: new DNA.engine.Action({
        handle: function(a) {
            this._select()
        }
    }),
    _doMouseDown: new DNA.engine.Action({
        handle: function(b) {
            var a = b.getSrcElement();
            if (a == this._hour) {
                this._setSelectionType(0)
            } else {
                if (a == this._minute) {
                    this._setSelectionType(1)
                }
            }
        }
    }),
    _doKeyup: new DNA.engine.Action({
        handle: function(c) {
            var b = c.getKeyCode();
            var a = c.getSrcElement();
            if (a == this._hour || a == this._minute) {
                if (((!c.isShift()) && ((b >= 48 && b <= 57) || (b >= 96 && b <= 105))) || (b <= 20)) {
                    this._checkInputSelection()
                }
            }
        }
    }),
    _setDate: function(a, b, c) {
        if (!this._date) {
            this._date = new Date()
        }
        if (a >= 0) {
            this._date.setHours(a)
        }
        if (b >= 0) {
            this._date.setMinutes(b)
        }
        if (c >= 0) {
            this._date.setSeconds(c)
        }
    },
    _renderZero: function() {
        if (this._selectionType != 0 && this._hour.value < 10 && this._hour.value.length == 1) {
            this._hour.value = "0" + this._hour.value
        }
        if (this._selectionType != 1 && this._minute.value < 10 && this._minute.value.length == 1) {
            this._minute.value = "0" + this._minute.value
        }
    },
    _blur: function(a) {
        if (this._hour.value < 10 && this._hour.value.length == 1) {
            this._hour.value = "0" + this._hour.value
        }
        if (this._minute.value < 10 && this._minute.value.length == 1) {
            this._minute.value = "0" + this._minute.value
        }
    },
    _renderDate: function(a, b, c) {
        if (a >= 0) {
            this._hour.value = a
        }
        if (b >= 0) {
            this._minute.value = b
        }
        this._renderZero()
    },
    _increaseSelection: function() {
        var b = this.getDate();
        var d = this._getSelectionType();
        if (d == 0) {
            var a = b.getHours();
            a++;
            if (a < 10) {
                this.setTime(a > 23 ? "00" : "0" + a, -1, -1)
            } else {
                this.setTime(a > 23 ? "00" : a, -1, -1)
            }
        } else {
            if (d == 1) {
                var c = b.getMinutes();
                c++;
                if (c < 10) {
                    this.setTime(-1, c > 59 ? "00" : "0" + c, -1)
                } else {
                    this.setTime(-1, c > 59 ? "00" : c, -1)
                }
            } else {
                if (d == 2) {
                    var g = b.getSeconds();
                    g++;
                    if (g < 10) {
                        this.setTime(-1, -1, g > 59 ? "00" : "0" + g)
                    } else {
                        this.setTime(-1, -1, g > 59 ? "00" : g)
                    }
                }
            }
        }
        this._select()
    },
    _decreaseSelection: function() {
        var b = this.getDate();
        var d = this._getSelectionType();
        if (d == 0) {
            var a = b.getHours();
            a--;
            if (a < 10 & a >= 0) {
                this.setTime(a < 0 ? 23 : "0" + a, -1, -1)
            } else {
                this.setTime(a < 0 ? 23 : a, -1, -1)
            }
        } else {
            if (d == 1) {
                var c = b.getMinutes();
                c--;
                if (c < 10 & c >= 0) {
                    this.setTime(-1, c < 0 ? 59 : "0" + c, -1)
                } else {
                    this.setTime(-1, c < 0 ? 59 : c, -1)
                }
            } else {
                if (d == 2) {
                    var g = b.getSeconds();
                    g--;
                    if (g < 10 & g >= 0) {
                        this.setTime(-1, -1, g < 0 ? 59 : "0" + g)
                    } else {
                        this.setTime(-1, -1, g < 0 ? 59 : g)
                    }
                }
            }
        }
        this._select()
    },
    _checkInputSelection: function() {
        var b = this.getDate();
        var c = this._getSelectionType();
        if (c == 0) {
            var a = this._hour.value;
            if (a && a.length > 0) {
                if (this._hour.value.length > 1) {
                    this._setSelectionType(1);
                    this._minute.select(0, this._minute.value.length)
                }
                var d = parseInt(a);
                if (d < 0) {
                    d = 0
                } else {
                    if (d > 23) {
                        d = 23
                    }
                }
                this.setTime(d, -1, -1)
            }
        } else {
            if (c == 1) {
                var a = this._minute.value;
                if (a && a.length > 0) {
                    var d = parseInt(a);
                    if (d < 0) {
                        d = 0
                    } else {
                        if (d > 59) {
                            d = 59
                        }
                    }
                    this.setTime(-1, d, -1)
                }
            }
        }
    },
    _getSelectionType: function() {
        return this._selectionType
    },
    _setSelectionType: function(a) {
        this._selectionType = a;
        this._renderZero()
    },
    _select: function() {
        var a = this._selectionType;
        if (a == 0) {
            this._hour.select(0, this._hour.value.length)
        } else {
            if (a == 1) {
                this._minute.select(0, this._minute.value.length)
            }
        }
    },
    _getDomArray: function() {
        return [this.el, this._hour, this._s1, this._minute]
    },
    doDispose: function() {
        DNA.widget.DateMinute.superclass.doDispose.call(this);
        delete this._hour;
        delete this._s1;
        delete this._minute;
        delete this._incBtn;
        delete this._decBtn;
        delete this._date
    }
});
Object.override(DNA.widget.DateMinute.prototype, {
    jtype: "DateTime",
    focusable: true
});
DNA.widget.Accordion = function(a) {
    DNA.widget.Accordion.superclass.constructor.call(this, a)
}
;
DNA.widget.Accordion.extend(DNA.widget.Iteration, {
    autoRender: true,
    computeSize: function(c, l, g) {
        var o = new DNA.widget.Point();
        if (c == DNA.JWT.DEFAULT || l == DNA.JWT.DEFAULT) {
            var d = this._selected[0];
            if (d) {
                var b = d.getChildren();
                if (b) {
                    var n = b[0].computeSize(DNA.JWT.DEFAULT, DNA.JWT.DEFAULT);
                    if (c == DNA.JWT.DEFAULT) {
                        o.x = n.x
                    }
                    if (l == DNA.JWT.DEFAULT) {
                        o.y = n.y
                    }
                }
            }
        }
        if (o.x == 0) {
            o.x = DNA.JWT.DEFAULT_WIDTH
        }
        if (o.y == 0) {
            o.y = DNA.JWT.DEFAULT_HEIGHT
        }
        if (c != DNA.JWT.DEFAULT) {
            o.x = c
        }
        if (l != DNA.JWT.DEFAULT) {
            o.y = l
        }
        var h = 0;
        var a = this.getChildren();
        if (a) {
            h = a.length
        }
        o.y += h * this._titleHeight;
        var m = this.getBorderSize();
        o.x += m;
        o.y += m;
        return o
    },
    clear: function() {
        DNA.widget.Accordion.superclass.clear.call(this);
        this.getEl().innerHTML = ""
    },
    getClientArea: function() {
        var g = this.getChildren();
        var c = 0;
        if (g) {
            c = g.length
        }
        var a = this.getBorderSize();
        var d = this.getBounds();
        return new DNA.widget.Rectangle(0,0,d.width - a,d.height - a - c * this._titleHeight)
    },
    _registEvents: function() {
        this.addListener(DNA.JWTEvent.MOUSEDOWN, this._doMousedownAction);
        this.addListener(DNA.JWTEvent.MOUSEMOVE, this._doMousemoveAction);
        this.addListener(DNA.JWTEvent.MOUSEOUT, this._doMouseoutAction)
    },
    _resize: function() {
        var a = this._selected[0];
        if (a) {
            a._select()
        }
    },
    _doMousedownAction: new DNA.engine.Action({
        handle: function(b) {
            var a = b.getSrcWidget();
            if (a != this && a != this._selected[0]) {
                var c = {
                    doit: true,
                    control: this,
                    item: a
                };
                this.fireEvent("selectionchanging", [c]);
                if (c.doit === true) {
                    this.select(a, false, b);
                    this.fireEvent("selection", [b])
                }
            }
        }
    }),
    _doMousemoveAction: new DNA.engine.Action({
        handle: function(b) {
            var a = b.getSrcWidget();
            if (a != this && a != this._selected[0]) {
                if (this._hoverItem && this._hoverItem != this._selected[0] && this._hoverItem.el) {
                    this._hoverItem.el.firstChild.className = "accordionItem-n"
                }
                if (a.el) {
                    a.el.firstChild.className = "accordionItem-h";
                    this._hoverItem = a
                }
            }
        }
    }),
    _doMouseoutAction: new DNA.engine.Action({
        handle: function(a) {
            if (this._hoverItem && this._hoverItem != this._selected[0] && this._hoverItem.el) {
                this._hoverItem.el.firstChild.className = "accordionItem-n";
                this._hoverItem = null 
            }
        }
    }),
    getInnerComp: function() {
        var b = this._selected[0];
        var a = b.getChildren();
        if (a) {
            return a[0]
        }
    }
});
Object.override(DNA.widget.Accordion.prototype, {
    jtype: "Accordion",
    focusable: true,
    _titleHeight: 22
});
DNA.widget.AccordionItem = function(a) {
    DNA.widget.AccordionItem.superclass.constructor.call(this, a)
}
;
DNA.widget.AccordionItem.extend(DNA.widget.Item, {
    autoRender: true,
    add: function(b, a) {
        if (!this._children) {
            b.parent = this;
            this._children = [b]
        }
    },
    getChildren: function() {
        return DNA.widget.WidgetRegistry.getChildren(this, true)
    },
    _select: function(g) {
        this._body.style.display = "";
        var d = this.getParent().getClientArea();
        var a = d.width;
        var c = d.height;
        a = a < 0 ? 0 : a;
        c = c < 0 ? 0 : c;
        var b = this.getChildren();
        if (b) {
            b[0].setSize(a, c)
        }
        this.el.firstChild.className = "accordionItem-a";
        DNA.engine.DomUtil.setHeight(this._body, c);
        if (g) {
            this._animatedSelect(c)
        } else {
            DNA.engine.DomUtil.setHeight(this.el, c + 22)
        }
    },
    _animatedSelect: function(b) {
        var n = this.getParent()._animated_unselecting;
        var p = [];
        var o = [];
        if (n) {
            delete this.getParent()._animated_unselecting;
            var q = new DNA.engine.Sprite(n.getEl());
            q.setSize({
                height: n.getEl().offsetHeight
            });
            p.push(q);
            var m = new DNA.engine.Sprite(n.getEl());
            m.setSize({
                height: 22
            });
            o.push(m)
        }
        var g = new DNA.engine.Sprite(this.getEl());
        g.setSize({
            height: 22
        });
        p.push(g);
        var l = new DNA.engine.Frame(p);
        var d = new DNA.engine.Sprite(this.getEl());
        d.setSize({
            height: 22 + b
        });
        o.push(d);
        var c = new DNA.engine.Frame(o);
        var a = new DNA.engine.LinearMotion(l,c,25,300);
        if (n) {
            a.setEndCallBack(n._unselect, n)
        }
        a.play()
    },
    _unselect: function(a) {
        if (a) {
            this.getParent()._animated_unselecting = this
        } else {
            DNA.engine.DomUtil.setHeight(this.el, 22);
            this.el.firstChild.className = "accordionItem-n";
            DNA.engine.DomUtil.setStyle(this._body, "display", "none")
        }
    },
    _doBuildElements: function() {
        this._body = this.el.lastChild;
        this._imageEl = this.el.firstChild.firstChild;
        this._textEl = this.el.firstChild.lastChild
    },
    setText: function(a) {
        DNA.engine.DomUtil.setInnerText(this._textEl, a)
    },
    getText: function() {
        return DNA.engine.DomUtil.getInnerText(this._textEl)
    },
    setImage: function(a) {
        this._imageEl.innerHTML = a ? a.getHTML() : ""
    },
    _remove: function(a) {
        if (this._children) {
            this._children.remove(a)
        }
    },
    _disposeDOM: function() {
        if (this._children) {
            this._children[0].dispose(true, true)
        }
    },
    doDispose: function() {
        DNA.widget.AccordionItem.superclass.doDispose.call(this);
        if (this._body) {
            delete this._body
        }
    }
});
Object.override(DNA.widget.AccordionItem.prototype, {
    jtype: "AccordionItem"
});
DNA.widget.Group = function(a) {
    DNA.widget.Group.superclass.constructor.call(this, a)
}
;
DNA.widget.Group.extend(DNA.widget.Composite, {
    autoRender: true,
    computeSize: function(g, c, l) {
        var d = DNA.widget.Group.superclass.computeSize.call(this, g, c, l);
        var h = this._getTitleSize();
        var a = this.getBorderSize();
        d.x += a + 8;
        d.y += a + 6 + h.height;
        return d
    },
    getClientArea: function() {
        var c = this.getBorderSize();
        var d = this.getBounds();
        var l = this._getTitleSize().height;
        var g = d.width - c - 8;
        g = g < 0 ? 0 : g;
        var a = d.height - c - l - 6;
        a = a < 0 ? 0 : a;
        if (l == 0) {
            return new DNA.widget.Rectangle(4,2 + c / 2,g,a)
        } else {
            return new DNA.widget.Rectangle(4,l + c / 2,g,a)
        }
    },
    getClientRectangle: function() {
        return this.getClientArea()
    },
    setImage: function(a) {
        this._image = a;
        this.el.childNodes[1].firstChild.innerHTML = a ? a.getHTML() : ""
    },
    setText: function(a) {
        this._text = a ? a : "";
        this.el.childNodes[1].lastChild.innerHTML = this._text
    },
    _getImage: function() {
        if (!this._image) {
            this._image = this.getInitData().image;
            delete this.getInitData().image
        }
        return this._image
    },
    getText: function() {
        if (!this._text) {
            this._text = this.getInitData().text;
            delete this.getInitData().text
        }
        return this._text
    },
    _doBuildElements: function() {
        this._body = this.el.lastChild;
        this._borderEl = this.el.firstChild;
        this._topEl = this.el.firstChild.childNodes[1];
        this._leftEl = this.el.firstChild.childNodes[3];
        this._centerEl = this.el.firstChild.childNodes[4];
        this._rightEl = this.el.firstChild.childNodes[5];
        this._bottomEl = this.el.firstChild.childNodes[7]
    },
    _getTitleSize: function() {
        var c = 0;
        var a = 0;
        var d = this._getImage();
        if (d) {
            a = d.width;
            c = d.height
        }
        var b = DNA.engine.DomUtil.computeTextSize(this.getText(), this.getFont());
        c = c > b.height ? c : b.height;
        c = c % 2 > 0 ? c + 1 : c;
        a += b.width;
        return {
            width: a,
            height: c
        }
    },
    _resize: function() {
        var d = this.getBounds();
        if (d.width > 0 && d.height > 0) {
            var a = this.getBorderSize();
            var l = this._getTitleSize().height / 2;
            var g = d.height - a - 4 - l;
            var c = d.width - a - 4;
            DNA.engine.DomUtil.setWidth(this._topEl, c);
            DNA.engine.DomUtil.setWidth(this._centerEl, c);
            DNA.engine.DomUtil.setWidth(this._bottomEl, c);
            DNA.engine.DomUtil.setHeight(this._leftEl, g);
            DNA.engine.DomUtil.setHeight(this._rightEl, g);
            DNA.engine.DomUtil.setHeight(this._centerEl, g);
            this._borderEl.style.top = l + "px";
            DNA.widget.Group.superclass._resize.call(this)
        }
    },
    doDispose: function() {
        DNA.widget.Group.superclass.doDispose.call(this);
        delete this._borderEl;
        delete this._topEl;
        delete this._leftEl;
        delete this._centerEl;
        delete this._rightEl;
        delete this._bottomEl
    }
});
Object.override(DNA.widget.Group.prototype, {
    jtype: "Group",
    focusable: false
});
DNA.widget.SashForm = function(a) {
    DNA.widget.SashForm.superclass.constructor.call(this, a);
    this.initProperties(a)
}
;
DNA.widget.SashForm.MOVE_TO_FIRST = 1;
DNA.widget.SashForm.MOVE_TO_SECOND = 2;
DNA.widget.SashForm.SPLIT_MODE_RATE = 0;
DNA.widget.SashForm.SPLIT_MODE_FIRST_FIXED = 1;
DNA.widget.SashForm.SPLIT_MODE_LAST_FIXED = 2;
DNA.widget.SashForm.SPLIT_MODE_FIRST_HIDDEN = 3;
DNA.widget.SashForm.SPLIT_MODE_LAST_HIDDEN = 4;
DNA.widget.SashForm.SPLIT_MODE_FIRST_COMPUTE = 5;
DNA.widget.SashForm.SPLIT_MODE_LAST_COMPUTE = 6;
DNA.widget.SashForm.FOLD_STATE_NORMAL = 0;
DNA.widget.SashForm.FOLD_STATE_FIRST = 1;
DNA.widget.SashForm.FOLD_STATE_LAST = 2;
DNA.widget.SashForm.extend(DNA.widget.Composite, {
    _splitMode: DNA.widget.SashForm.SPLIT_MODE_RATE,
    _fixedPix: 10,
    _splitable: true,
    _foldState: DNA.widget.SashForm.FOLD_STATE_NORMAL,
    _direction: DNA.JWT.HORIZONTAL,
    _structChanged: false,
    isStructChanged: function() {
        return this._structChanged
    },
    initProperties: function() {
        var a = this.getInitData()[DNA.JWTProperty.PROPERTY_WEIGHTS];
        this._parseRate(a || "1:1");
        delete this.getInitData()[DNA.JWTProperty.PROPERTY_WEIGHTS];
        this.handleOneChildHidden(a);
        if (this.getStyle() & DNA.JWT.DRAG_UNSUPPORTED) {
            this._splitable = false
        }
        this._direction = this.getInitData()[DNA.JWTProperty.PROPERTY_SASH_DIRECTION];
        delete this.getInitData()[DNA.JWTProperty.PROPERTY_SASH_DIRECTION];
        this.setSeparatorBarSize(this.getInitData()[DNA.JWTProperty.PROPERTY_SASH_BARSIZE]);
        delete this.getInitData()[DNA.JWTProperty.PROPERTY_SASH_BARSIZE]
    },
    setSeparatorBarSize: function(a) {
        this._barSize = a
    },
    getDirection: function() {
        return this._direction
    },
    setDirection: function(a) {
        if (this._direction != a && this.checkRendered(true)) {
            this._direction = a;
            if (this._direction == DNA.JWT.HORIZONTAL) {
                DNA.engine.DomUtil.setStyle(this.firstBody, "position", "absolute");
                this.splitBar.className = "j-splitbar-h";
                this.splitBar.style.width = this._barSize + "px";
                if (this.firstFoldImage) {
                    this.firstFoldImage.className = "sashform-n-west";
                    this.firstFoldImage.style.left = ""
                }
                if (this.lastFoldImage) {
                    this.lastFoldImage.className = "sashform-n-east";
                    this.lastFoldImage.style.left = ""
                }
                if (this.spotchartsImage) {
                    this.spotchartsImage.className = "sashform-spotcharts-j-splitbar-h";
                    this.spotchartsImage.style.left = ""
                }
                DNA.engine.DomUtil.setStyle(this.lastBody, "position", "absolute")
            } else {
                if (this._direction == DNA.JWT.VERTICAL) {
                    DNA.engine.DomUtil.setStyle(this.firstBody, "position", "relative");
                    this.splitBar.className = "j-splitbar-v";
                    this.splitBar.style.left = "";
                    this.splitBar.style.height = this._barSize + "px";
                    if (this.firstFoldImage) {
                        this.firstFoldImage.className = "sashform-n-north";
                        this.firstFoldImage.style.left = "";
                        this.firstFoldImage.style.top = ""
                    }
                    if (this.lastFoldImage) {
                        this.lastFoldImage.className = "sashform-n-south";
                        this.lastFoldImage.style.left = "";
                        this.lastFoldImage.style.top = ""
                    }
                    if (this.spotchartsImage) {
                        this.spotchartsImage.className = "sashform-spotcharts-j-splitbar-v";
                        this.spotchartsImage.style.left = "";
                        this.spotchartsImage.style.top = ""
                    }
                    DNA.engine.DomUtil.setStyle(this.lastBody, "position", "relative");
                    this.lastBody.style.left = "";
                    this.lastBody.style.top = ""
                }
            }
            this._resize()
        }
    },
    _add: function(b, a) {
        if (a && this.checkRendered(true)) {
            var c = null ;
            var g = null ;
            var h = null ;
            var d;
            if (b) {
                c = DNA.engine.DomUtil.findChild(this.firstBody, "*[id=" + b + "]");
                if (c) {
                    g = this.lastBody
                } else {
                    g = this.firstBody;
                    c = DNA.engine.DomUtil.findChild(this.lastBody, "*[id=" + b + "]")
                }
                d = DNA.JWT.RENDER_POS_TYPE_BEFORE
            } else {
                d = DNA.JWT.RENDER_POS_TYPE_LAST;
                if (this.firstBody.firstChild) {
                    this.lastBody.appendChild(this.firstBody.firstChild);
                    h = this.firstBody
                } else {
                    this.firstBody.appendChild(this.lastBody.firstChild);
                    h = this.lastBody
                }
            }
            h = h ? h : c.parentNode;
            this._renderChild(h, d, a, c);
            if (c) {
                g.appendChild(c)
            }
            this._structChanged = true
        }
    },
    handleOneChildHidden: function(b, a) {
        var c;
        if (b) {
            if (b.startsWith("0:") && ((this.getStyle() & DNA.JWT.FOLDING_FIRST)) && !(this.getStyle() & DNA.JWT.FOLDING_SECOND)) {
                c = DNA.widget.SashForm.FOLD_STATE_FIRST
            } else {
                if (b.endsWith(":0") && ((this.getStyle() & DNA.JWT.FOLDING_SECOND)) && !(this.getStyle() & DNA.JWT.FOLDING_FIRST)) {
                    c = DNA.widget.SashForm.FOLD_STATE_LAST
                }
            }
            if (a) {
                this._changeFoldState(c)
            } else {
                if (c) {
                    this._foldState = c
                }
            }
        }
        return c ? true : false
    },
    _parseRate: function(c) {
        var b = parseFloat(c.substr(0, c.indexOf(":")));
        var a = parseFloat(c.substr(c.indexOf(":") + 1));
        if (b == 0) {
            this._splitMode = DNA.widget.SashForm.SPLIT_MODE_FIRST_HIDDEN
        } else {
            if (a == 0) {
                this._splitMode = DNA.widget.SashForm.SPLIT_MODE_LAST_HIDDEN
            } else {
                if (b == -2) {
                    this._splitMode = DNA.widget.SashForm.SPLIT_MODE_FIRST_COMPUTE
                } else {
                    if (a == -2) {
                        this._splitMode = DNA.widget.SashForm.SPLIT_MODE_LAST_COMPUTE
                    } else {
                        if (b == -1) {
                            this._splitMode = DNA.widget.SashForm.SPLIT_MODE_LAST_FIXED
                        } else {
                            if (a == -1) {
                                this._splitMode = DNA.widget.SashForm.SPLIT_MODE_FIRST_FIXED
                            } else {
                                this._splitMode = DNA.widget.SashForm.SPLIT_MODE_RATE;
                                this._rate = b / (b + a)
                            }
                        }
                    }
                }
            }
        }
        if (this._splitMode == DNA.widget.SashForm.SPLIT_MODE_LAST_FIXED) {
            this._fixedPix = a
        } else {
            if (this._splitMode == DNA.widget.SashForm.SPLIT_MODE_FIRST_FIXED) {
                this._fixedPix = b
            }
        }
    },
    _setBackground: function(a) {
        this.splitBar.style.backgroundColor = a || ""
    },
    _setBackimage: function(a) {
        if (this.checkRendered(true)) {
            if (a) {
                this.splitBar.style.backgroundImage = "url(" + a.url + ")"
            } else {
                this.splitBar.style.backgroundImage = ""
            }
        }
    },
    setRate: function(a) {
        if (a && this.checkRendered(true)) {
            this._parseRate(a);
            if (!this.handleOneChildHidden(a, true)) {
                this._changeFoldState(DNA.widget.SashForm.FOLD_STATE_NORMAL)
            }
            this._resize()
        }
    },
    getRate: function() {
        if (this.checkRendered(true)) {
            if (this._splitMode == DNA.widget.SashForm.SPLIT_MODE_FIRST_FIXED) {
                return this._fixedPix + ":-1"
            } else {
                if (this._splitMode == DNA.widget.SashForm.SPLIT_MODE_LAST_FIXED) {
                    return "-1:" + this._fixedPix
                } else {
                    if (this._splitMode == DNA.widget.SashForm.SPLIT_MODE_FIRST_COMPUTE) {
                        return "-2:-1"
                    } else {
                        if (this._splitMode == DNA.widget.SashForm.SPLIT_MODE_LAST_COMPUTE) {
                            return "-1:-2"
                        } else {
                            var a, b;
                            if (this._direction & DNA.JWT.VERTICAL) {
                                a = this.firstCmp.getBounds().height;
                                b = this.lastCmp.getBounds().height
                            } else {
                                a = this.firstCmp.getBounds().width;
                                b = this.lastCmp.getBounds().width
                            }
                            if (a === 0) {
                                return "0:1"
                            }
                            if (b === 0) {
                                return "1:0"
                            }
                            return a + ":" + b
                        }
                    }
                }
            }
        }
    },
    _split: function(c, b, a) {
        this._splitMode = DNA.widget.SashForm.SPLIT_MODE_RATE;
        this._rate = b / (b + a);
        this._changeFoldState(DNA.widget.SashForm.FOLD_STATE_NORMAL);
        this.fireEvent("rateChange", [c, this, null , [b, a], null , DNA.JWT.SEPARATOR])
    },
    _changeFoldState: function(a) {
        if (this._foldState != a) {
            if (this.getStyle() & DNA.JWT.FOLDING_FIRST && this.getStyle() & DNA.JWT.FOLDING_SECOND) {} else {
                if (this.getStyle() & DNA.JWT.FOLDING_FIRST) {
                    if (this._foldState == DNA.widget.SashForm.FOLD_STATE_NORMAL) {
                        if (a == DNA.widget.SashForm.FOLD_STATE_FIRST) {
                            this.firstFoldImage.style.display = "none";
                            this.lastFoldImage.style.display = ""
                        }
                    } else {
                        if (this._foldState == DNA.widget.SashForm.FOLD_STATE_FIRST) {
                            if (a == DNA.widget.SashForm.FOLD_STATE_NORMAL) {
                                this.firstFoldImage.style.display = "";
                                this.lastFoldImage.style.display = "none"
                            }
                        }
                    }
                } else {
                    if (this.getStyle() & DNA.JWT.FOLDING_SECOND) {
                        if (this._foldState == DNA.widget.SashForm.FOLD_STATE_NORMAL) {
                            if (a == DNA.widget.SashForm.FOLD_STATE_LAST) {
                                this.firstFoldImage.style.display = "";
                                this.lastFoldImage.style.display = "none"
                            }
                        } else {
                            if (this._foldState == DNA.widget.SashForm.FOLD_STATE_LAST) {
                                if (a == DNA.widget.SashForm.FOLD_STATE_NORMAL) {
                                    this.firstFoldImage.style.display = "none";
                                    this.lastFoldImage.style.display = ""
                                }
                            }
                        }
                    }
                }
            }
            this._foldState = a
        }
    },
    _remove: function(a) {
        DNA.widget.SashForm.superclass._remove.call(this);
        if (this.firstCmp == a) {
            delete this.firstCmp
        } else {
            if (this.lastCmp == a) {
                delete this.lastCmp
            }
        }
    },
    computeSize: function(c, g, d) {
        var o = new DNA.widget.Point();
        if (c == DNA.JWT.DEFAULT || g == DNA.JWT.DEFAULT) {
            var b = 0;
            var m = 0;
            var a = 0;
            var h = 0;
            if (this.firstCmp) {
                var n = this.firstCmp.computeSize(-1, -1);
                b = n.x;
                m = n.y
            }
            if (this.lastCmp) {
                var n = this.lastCmp.computeSize(-1, -1);
                a = n.x;
                h = n.y
            }
            if (this._direction & DNA.JWT.VERTICAL) {
                o.y += m;
                o.y += h;
                o.x = (b > a ? b : a)
            } else {
                o.x += b;
                o.x += a;
                o.y = (m > h ? m : h)
            }
        }
        if (c != DNA.JWT.DEFAULT) {
            o.x = c
        }
        if (g != DNA.JWT.DEFAULT) {
            o.y = g
        }
        if (this._direction & DNA.JWT.VERTICAL) {
            o.y += this._barSize
        } else {
            o.x += this._barSize
        }
        var l = this.getBorderSize();
        o.x += l;
        o.y += l;
        return o
    },
    add: function(b, a) {
        if (!this.firstCmp) {
            this.firstCmp = b;
            this._children[0] = b;
            this._add2TabList(b)
        } else {
            if (!this.lastCmp) {
                this.lastCmp = b;
                this._children[1] = b;
                this._add2TabList(b)
            }
        }
    },
    doDispose: function() {
        DNA.widget.SashForm.superclass.doDispose.call(this);
        delete this.firstCmp;
        delete this.lastCmp;
        delete this.splitBar;
        delete this.firstBody;
        delete this.lastBody;
        delete this.firstFoldImage;
        delete this.lastFoldImage;
        delete this.spotchartsImage
    },
    initChildCtr: function() {
        var a = this.getChildren();
        this.firstCmp = a[0];
        this.lastCmp = a[1];
        this._structChanged = false
    },
    _doBuildElements: function() {
        this.splitBar = this.el.childNodes[1];
        this.firstBody = this.el.childNodes[0];
        this.lastBody = this.el.childNodes[2];
        if (this.getStyle() & DNA.JWT.FOLDING_FIRST || this.getStyle() & DNA.JWT.FOLDING_SECOND) {
            this.firstFoldImage = this.splitBar.firstChild;
            this.lastFoldImage = this.splitBar.lastChild
        } else {
            if ((this.getStyle() & DNA.JWT.DRAG_UNSUPPORTED) == 0) {
                this.spotchartsImage = this.splitBar.firstChild
            }
        }
        if (!document.getElementById("flowproxy-iframe")) {
            var a;
            if (DNA.engine.Client.isChrome() || DNA.engine.Client.isSafari()) {
                a = DNA.engine.DomUtil.append(document.body, "<IFRAME id=\"flowproxy-iframe\" frameborder=0 scrolling=no class=\"flowproxy-iframe\" src='' style='display:none;z-index:9999999;'></IFRAME>")
            } else {
                a = DNA.engine.DomUtil.append(document.body, "<IFRAME id=\"flowproxy-iframe\" frameborder=0 scrolling=no class=\"flowproxy-iframe\" src='#' style='display:none;z-index:9999999;'></IFRAME>")
            }
            DNA.engine.application.getJWTEventMgr().handleDocumentEvent(a.contentWindow.document, [DNA.JWTEvent.MOUSEMOVE, DNA.JWTEvent.MOUSEUP]);
            a.contentWindow.document.ownerIframe = document.body
        }
        this.initChildCtr()
    },
    _removeFlowHtml: function() {},
    getShim: function() {
        return document.getElementById("flowproxy-iframe")
    },
    _registEvents: function() {
        this.addListener(DNA.JWTEvent.CLICK, this._doClickAction);
        this.addListener(DNA.JWTEvent.MOUSEMOVE, this._doMousemoveAction);
        this.addListener(DNA.JWTEvent.MOUSEOUT, this._doMouseoutAction)
    },
    _doMouseoutAction: new DNA.engine.Action({
        handle: function(a) {
            this._unhoverFoldImg()
        }
    }),
    _unhoverFoldImg: function() {
        if (this.getStyle() & DNA.JWT.FOLDING_FIRST || this.getStyle() & DNA.JWT.FOLDING_SECOND) {
            if (this._direction & DNA.JWT.VERTICAL) {
                this.firstFoldImage.className = "sashform-n-north";
                this.lastFoldImage.className = "sashform-n-south"
            } else {
                this.firstFoldImage.className = "sashform-n-west";
                this.lastFoldImage.className = "sashform-n-east"
            }
        }
    },
    _doMousemoveAction: new DNA.engine.Action({
        handle: function(b) {
            var a = b.getSrcElement();
            if (a == this.splitBar) {
                this._unhoverFoldImg()
            } else {
                if (a == this.firstFoldImage) {
                    if (this._direction & DNA.JWT.VERTICAL) {
                        this.firstFoldImage.className = "sashform-h-north";
                        this.lastFoldImage.className = "sashform-n-south"
                    } else {
                        this.firstFoldImage.className = "sashform-h-west";
                        this.lastFoldImage.className = "sashform-n-east"
                    }
                } else {
                    if (a == this.lastFoldImage) {
                        if (this._direction & DNA.JWT.VERTICAL) {
                            this.firstFoldImage.className = "sashform-n-north";
                            this.lastFoldImage.className = "sashform-h-south"
                        } else {
                            this.firstFoldImage.className = "sashform-n-west";
                            this.lastFoldImage.className = "sashform-h-east"
                        }
                    }
                }
            }
        }
    }),
    _foldFirst: function(c) {
        this._changeFoldState(DNA.widget.SashForm.FOLD_STATE_FIRST);
        var b = this.getRate();
        var a = this._getChangingRate();
        this.fireEvent("rateChange", [c, this, b, a, DNA.widget.SashForm.MOVE_TO_FIRST, DNA.JWT.BUTTON])
    },
    _foldLast: function(c) {
        this._changeFoldState(DNA.widget.SashForm.FOLD_STATE_LAST);
        var b = this.getRate();
        var a = this._getChangingRate();
        this.fireEvent("rateChange", [c, this, b, a, DNA.widget.SashForm.MOVE_TO_SECOND, DNA.JWT.BUTTON])
    },
    _unfold: function(d, b) {
        this._changeFoldState(DNA.widget.SashForm.FOLD_STATE_NORMAL);
        var c = this.getRate();
        var a = this._getChangingRate();
        this.fireEvent("rateChange", [d, this, c, a, b, DNA.JWT.BUTTON])
    },
    _doClickAction: new DNA.engine.Action({
        handle: function(b) {
            var a = b.getSrcElement();
            if (this._foldState == DNA.widget.SashForm.FOLD_STATE_NORMAL) {
                if (a == this.firstFoldImage) {
                    this._foldFirst(b)
                } else {
                    if (a == this.lastFoldImage) {
                        this._foldLast(b)
                    }
                }
            } else {
                if (this._foldState == DNA.widget.SashForm.FOLD_STATE_FIRST) {
                    if (a == this.lastFoldImage) {
                        this._unfold(b, DNA.widget.SashForm.MOVE_TO_SECOND)
                    }
                } else {
                    if (this._foldState == DNA.widget.SashForm.FOLD_STATE_LAST) {
                        if (a == this.firstFoldImage) {
                            this._unfold(b, DNA.widget.SashForm.MOVE_TO_FIRST)
                        }
                    }
                }
            }
            if (a == this.firstFoldImage) {
                if (this._direction & DNA.JWT.VERTICAL) {
                    this.firstFoldImage.className = "sashform-n-north"
                } else {
                    this.firstFoldImage.className = "sashform-n-west"
                }
            } else {
                if (a == this.lastFoldImage) {
                    if (this._direction & DNA.JWT.VERTICAL) {
                        this.lastFoldImage.className = "sashform-n-south"
                    } else {
                        this.lastFoldImage.className = "sashform-n-east"
                    }
                }
            }
        }
    }),
    _getChangingRate: function() {
        if (this.checkRendered(true)) {
            var q, n;
            var t = this.getBorderSize();
            var u = this.getBounds();
            u.width -= t;
            u.height -= t;
            if (this._foldState == DNA.widget.SashForm.FOLD_STATE_NORMAL) {
                if (this._direction & DNA.JWT.VERTICAL) {
                    var b = u.width;
                    b = b < 0 ? 0 : b;
                    DNA.engine.DomUtil.setSize(this.splitBar, {
                        width: b,
                        height: this._barSize
                    });
                    if (this._splitMode == DNA.widget.SashForm.SPLIT_MODE_RATE) {
                        var m = (u.height - this._barSize) * this._rate;
                        m = Math.floor(m);
                        var l = u.height - this._barSize - m;
                        if (this.firstCmp && this.lastCmp) {
                            q = m < 0 ? 0 : m;
                            n = l < 0 ? 0 : l
                        }
                    } else {
                        if (this._splitMode == DNA.widget.SashForm.SPLIT_MODE_FIRST_FIXED) {
                            var a = this._fixedPix;
                            var p = u.height - this._barSize;
                            if (a > p) {
                                this._fixedPix = a = p < 0 ? 0 : p
                            }
                            var g = p > a ? p - a : 0;
                            q = a;
                            n = g
                        } else {
                            if (this._splitMode == DNA.widget.SashForm.SPLIT_MODE_LAST_FIXED) {
                                var a = this._fixedPix;
                                var p = u.height - this._barSize;
                                if (a > p) {
                                    this._fixedPix = a = p < 0 ? 0 : p
                                }
                                var g = p > a ? p - a : 0;
                                q = g;
                                n = a
                            } else {
                                if (this._splitMode == DNA.widget.SashForm.SPLIT_MODE_FIRST_HIDDEN) {
                                    var p = u.height - this._barSize;
                                    q = 0;
                                    n = p > 0 ? p : 0
                                } else {
                                    if (this._splitMode == DNA.widget.SashForm.SPLIT_MODE_LAST_HIDDEN) {
                                        var p = u.height - this._barSize;
                                        q = p > 0 ? p : 0;
                                        n = 0
                                    } else {
                                        if (this._splitMode == DNA.widget.SashForm.SPLIT_MODE_FIRST_COMPUTE) {
                                            var p = u.height - this._barSize;
                                            q = this.firstCmp.computeSize(-1, -1).y;
                                            q = q > p ? p : q;
                                            n = p - q;
                                            n = n > 0 ? n : 0
                                        } else {
                                            if (this._splitMode == DNA.widget.SashForm.SPLIT_MODE_LAST_COMPUTE) {
                                                var p = u.height - this._barSize;
                                                n = this.lastCmp.computeSize(-1, -1).y;
                                                n = n > p ? p : n;
                                                q = p - n;
                                                q = q > 0 ? q : 0
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                } else {
                    var r = u.height;
                    r = r < 0 ? 0 : r;
                    DNA.engine.DomUtil.setSize(this.splitBar, {
                        width: this._barSize,
                        height: r
                    });
                    if (this._splitMode == DNA.widget.SashForm.SPLIT_MODE_RATE) {
                        var d = (u.width - this._barSize) * this._rate;
                        d = Math.floor(d);
                        var c = u.width - this._barSize - d;
                        if (this.firstCmp && this.lastCmp) {
                            q = d;
                            n = c
                        }
                    } else {
                        if (this._splitMode == DNA.widget.SashForm.SPLIT_MODE_FIRST_FIXED) {
                            var a = this._fixedPix;
                            var p = u.width - this._barSize;
                            if (a > p) {
                                this._fixedPix = a = p < 0 ? 0 : p
                            }
                            var o = p > a ? p - a : 0;
                            q = a;
                            n = o
                        } else {
                            if (this._splitMode == DNA.widget.SashForm.SPLIT_MODE_LAST_FIXED) {
                                var a = this._fixedPix;
                                var p = u.width - this._barSize;
                                if (a > p) {
                                    this._fixedPix = a = p < 0 ? 0 : p
                                }
                                var o = p > a ? p - a : 0;
                                q = o;
                                n = a
                            } else {
                                if (this._splitMode == DNA.widget.SashForm.SPLIT_MODE_FIRST_HIDDEN) {
                                    var p = u.width - this._barSize;
                                    q = 0;
                                    n = p > 0 ? p : 0
                                } else {
                                    if (this._splitMode == DNA.widget.SashForm.SPLIT_MODE_LAST_HIDDEN) {
                                        var p = u.width - this._barSize;
                                        q = p > 0 ? p : 0;
                                        n = 0
                                    } else {
                                        if (this._splitMode == DNA.widget.SashForm.SPLIT_MODE_FIRST_COMPUTE) {
                                            var p = u.width - this._barSize;
                                            q = this.firstCmp.computeSize(-1, -1).x;
                                            q = q > p ? p : q;
                                            n = p - q;
                                            n = n > 0 ? n : 0
                                        } else {
                                            if (this._splitMode == DNA.widget.SashForm.SPLIT_MODE_LAST_COMPUTE) {
                                                var p = u.width - this._barSize;
                                                n = this.lastCmp.computeSize(-1, -1).x;
                                                n = n > p ? p : n;
                                                q = p - n;
                                                q = q > 0 ? q : 0
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            } else {
                if (this._foldState == DNA.widget.SashForm.FOLD_STATE_FIRST) {
                    if (this._direction & DNA.JWT.VERTICAL) {
                        var b = u.width;
                        b = b < 0 ? 0 : b;
                        var p = u.height - this._barSize;
                        q = 0;
                        n = p > 0 ? p : 0
                    } else {
                        var r = u.height;
                        r = r < 0 ? 0 : r;
                        var p = u.width - this._barSize;
                        q = 0;
                        n = p > 0 ? p : 0
                    }
                } else {
                    if (this._foldState == DNA.widget.SashForm.FOLD_STATE_LAST) {
                        if (this._direction & DNA.JWT.VERTICAL) {
                            var b = u.width;
                            b = b < 0 ? 0 : b;
                            var p = u.height - this._barSize;
                            q = p > 0 ? p : 0;
                            n = 0
                        } else {
                            var r = u.height;
                            r = r < 0 ? 0 : r;
                            var p = u.width - this._barSize;
                            q = p > 0 ? p : 0;
                            n = 0
                        }
                    }
                }
            }
            this._relocationFoldImages(u.width, u.height);
            return [q, n]
        }
    },
    _resizeChildren: function(b, a, z, n) {
        var t = this.getBorderSize();
        var h = this.getBounds();
        if (this._direction & DNA.JWT.VERTICAL) {
            h.width -= t;
            var p = h.width;
            p = p < 0 ? 0 : p;
            DNA.engine.DomUtil.setSize(this.splitBar, {
                width: p,
                height: Math.min(this._barSize, h.height)
            });
            if (n) {
                var w = new DNA.engine.Sprite(this.firstBody);
                w.setSize({
                    width: parseInt(this.firstBody.style.width),
                    height: parseInt(this.firstBody.style.height)
                });
                var u = new DNA.engine.Sprite(this.firstBody);
                u.setSize({
                    width: p,
                    height: b
                });
                var g = new DNA.engine.Sprite(this.lastBody);
                g.setSize({
                    width: parseInt(this.lastBody.style.width),
                    height: parseInt(this.lastBody.style.height)
                });
                var d = new DNA.engine.Sprite(this.lastBody);
                d.setSize({
                    width: p,
                    height: a
                });
                var v = new DNA.engine.Frame([w, g]);
                var r = new DNA.engine.Frame([u, d]);
                var q = new DNA.engine.LinearMotion(v,r,30,200);
                function c() {
                    if (z) {
                        this.fireEvent("rateChanged", [this])
                    }
                    DNA.engine.application.getJWTEventMgr()._fireGlobleEvent("bounds_change", [this])
                }
                q.play(c, this)
            } else {
                DNA.engine.DomUtil.setSize(this.firstBody, {
                    width: p,
                    height: b
                });
                DNA.engine.DomUtil.setSize(this.lastBody, {
                    width: p,
                    height: a
                })
            }
            this.firstCmp.setSize(p, b);
            this.lastCmp.setSize(p, a);
            if (z && !n) {
                this.fireEvent("rateChanged", [this])
            }
        } else {
            h.height -= t;
            var m = h.height;
            DNA.engine.DomUtil.setSize(this.splitBar, {
                width: Math.min(this._barSize, h.width),
                height: m
            });
            if (n) {
                var w = new DNA.engine.Sprite(this.firstBody);
                w.setSize({
                    width: parseInt(this.firstBody.style.width),
                    height: parseInt(this.firstBody.style.height)
                });
                var u = new DNA.engine.Sprite(this.firstBody);
                u.setSize({
                    width: b,
                    height: m
                });
                var g = new DNA.engine.Sprite(this.splitBar);
                g.setPoint({
                    x: parseInt(this.splitBar.style.left),
                    y: 0
                });
                var d = new DNA.engine.Sprite(this.splitBar);
                d.setPoint({
                    x: b,
                    y: 0
                });
                var o = new DNA.engine.Sprite(this.lastBody);
                o.setBounds({
                    x: parseInt(this.lastBody.style.left),
                    y: 0,
                    width: parseInt(this.lastBody.style.width),
                    height: parseInt(this.lastBody.style.height)
                });
                var l = new DNA.engine.Sprite(this.lastBody);
                l.setBounds({
                    x: b + this._barSize,
                    y: 0,
                    width: a,
                    height: m
                });
                var v = new DNA.engine.Frame([w, g, o]);
                var r = new DNA.engine.Frame([u, d, l]);
                var q = new DNA.engine.LinearMotion(v,r,30,200);
                function c() {
                    if (z) {
                        this.fireEvent("rateChanged", [this])
                    }
                    DNA.engine.application.getJWTEventMgr()._fireGlobleEvent("bounds_change", [this])
                }
                q.play(c, this)
            } else {
                DNA.engine.DomUtil.setSize(this.firstBody, {
                    width: b,
                    height: m
                });
                DNA.engine.DomUtil.setSize(this.lastBody, {
                    width: a,
                    height: m
                });
                DNA.engine.DomUtil.setLeftTop(this.splitBar, b, 0);
                DNA.engine.DomUtil.setLeftTop(this.lastBody, b + this._barSize, 0)
            }
            this.firstCmp.setSize(b, m);
            this.lastCmp.setSize(a, m);
            if (z && !n) {
                this.fireEvent("rateChanged", [this])
            }
        }
    },
    _resize: function() {
        var a = this._getChangingRate();
        this._resizeChildren(a[0], a[1])
    },
    _relocationFoldImages: function(a, l) {
        if (this.getStyle() & DNA.JWT.FOLDING_FIRST || this.getStyle() & DNA.JWT.FOLDING_SECOND) {
            if (this._direction & DNA.JWT.VERTICAL) {
                var c = 0;
                var b = 0;
                if ((this.getStyle() & DNA.JWT.FOLDING_FIRST) != 0 && (this.getStyle() & DNA.JWT.FOLDING_SECOND) != 0) {
                    c = (a - this._arrowSize - this._arrowSize) / 2;
                    b = c + this._arrowSize
                } else {
                    c = (a - this._arrowSize) / 2;
                    b = (a - this._arrowSize) / 2
                }
                this.firstFoldImage.style.left = c + "px";
                this.lastFoldImage.style.left = b + "px"
            } else {
                var g = 0;
                var d = 0;
                if ((this.getStyle() & DNA.JWT.FOLDING_FIRST) != 0 && (this.getStyle() & DNA.JWT.FOLDING_SECOND) != 0) {
                    g = (l - this._arrowSize - this._arrowSize) / 2;
                    d = g + this._arrowSize
                } else {
                    g = (l - this._arrowSize) / 2;
                    d = (l - this._arrowSize) / 2
                }
                this.firstFoldImage.style.top = g + "px";
                this.lastFoldImage.style.top = d + "px"
            }
        } else {
            if ((this.getStyle() & DNA.JWT.DRAG_UNSUPPORTED) == 0) {
                if (this._direction & DNA.JWT.VERTICAL) {
                    var c = (a - this._arrowSize) / 2;
                    this.spotchartsImage.style.left = c + "px"
                } else {
                    var g = (l - this._arrowSize) / 2;
                    this.spotchartsImage.style.top = g + "px"
                }
            }
        }
    },
    indexOf: function(a) {
        if (a === this.firstCmp) {
            return 0
        } else {
            return 1
        }
    },
    getDragger: function(g) {
        var d = null ;
        if (this.checkRendered(true)) {
            var b = g.getSrcElement();
            if ((this.getStyle() & DNA.JWT.DRAG_UNSUPPORTED) == 0 && (b == this.splitBar || b == this.spotchartsImage)) {
                var a = DNA.engine.DomUtil.getSize(this.splitBar);
                var c = DNA.engine.DomUtil.getPageXY(this.splitBar);
                a.x = c.x;
                a.y = c.y;
                if (this._direction & DNA.JWT.HORIZONTAL) {
                    d = new DNA.widget.DragSplit(DNA.widget.DragSplit._dir_h,this.firstCmp.getBounds().width,this.lastCmp.getBounds().width,a)
                } else {
                    d = new DNA.widget.DragSplit(DNA.widget.DragSplit._dir_v,this.firstCmp.getBounds().height,this.lastCmp.getBounds().height,a)
                }
            } else {
                d = DNA.widget.SashForm.superclass.getDragger.call(this, g)
            }
        }
        return d
    }
});
Object.override(DNA.widget.SashForm.prototype, {
    jtype: "SashForm",
    _arrowSize: 32,
    focusable: false
});
DNA.widget.AbstractPanelSelection = function(a, b) {
    this.panel = a;
    this.control = b;
    this.createDivs()
}
;
DNA.widget.AbstractPanelSelection.RESIZE_STRING = "d_resize";
DNA.widget.AbstractPanelSelection.extend(DNA.engine.JWTObject, {
    isDragSourceThatNeedDragMoveProxy: function(a) {
        if (a instanceof DNA.widget.Group || a instanceof DNA.widget.SashForm || a instanceof DNA.widget.ScrolledPanel) {
            return true
        }
        return false
    },
    createDivs: function() {
        var h = this.control;
        var d = h.getBounds();
        if (h._initData[DNA.JWTProperty.PROPERTY_DESIGNLISTENER]) {
            var b = "dragresize";
            if (DNA.engine.Client.isIE() && !DNA.engine.Client.isStrict()) {
                b += "_IE"
            }
            this.divRightResize = DNA.engine.DomUtil.insertAfter(h.getEl(), "<div resize=" + DNA.widget.AbstractPanelSelection.RESIZE_STRING + " id=" + h.getEid() + " class=" + b + " unselectable='on' " + this.bluidRightMiddleStyle(d) + "></div>");
            this.divBottomResize = DNA.engine.DomUtil.insertAfter(h.getEl(), "<div resize=" + DNA.widget.AbstractPanelSelection.RESIZE_STRING + " id=" + h.getEid() + " class=" + b + " unselectable='on' " + this.bluidBottomMiddleStyle(d) + "></div>");
            this.divRightBottomResize = DNA.engine.DomUtil.insertAfter(h.getEl(), "<div resize=" + DNA.widget.AbstractPanelSelection.RESIZE_STRING + " id=" + h.getEid() + " class=" + b + " unselectable='on' " + this.bluidRightBottomStyle(d) + "></div>");
            this.divLeftResize = DNA.engine.DomUtil.insertAfter(h.getEl(), "<div resize=" + DNA.widget.AbstractPanelSelection.RESIZE_STRING + " id=" + h.getEid() + " class=" + b + " unselectable='on' " + this.bluidLeftMiddleStyle(d) + "></div>");
            this.divTopResize = DNA.engine.DomUtil.insertAfter(h.getEl(), "<div resize=" + DNA.widget.AbstractPanelSelection.RESIZE_STRING + " id=" + h.getEid() + " class=" + b + " unselectable='on' " + this.bluidTopMiddleStyle(d) + "></div>");
            this.divLeftTopResize = DNA.engine.DomUtil.insertAfter(h.getEl(), "<div resize=" + DNA.widget.AbstractPanelSelection.RESIZE_STRING + " id=" + h.getEid() + " class=" + b + " unselectable='on' " + this.bluidLeftTopStyle(d) + "></div>");
            this.divLeftBottomResize = DNA.engine.DomUtil.insertAfter(h.getEl(), "<div resize=" + DNA.widget.AbstractPanelSelection.RESIZE_STRING + " id=" + h.getEid() + " class=" + b + " unselectable='on' " + this.bluidLeftBottomStyle(d) + "></div>");
            this.divRightTopResize = DNA.engine.DomUtil.insertAfter(h.getEl(), "<div resize=" + DNA.widget.AbstractPanelSelection.RESIZE_STRING + " id=" + h.getEid() + " class=" + b + " unselectable='on' " + this.bluidRightTopStyle(d) + "></div>")
        } else {
            this.divTop = DNA.engine.DomUtil.insertAfter(h.getEl(), "<div class='XYSelection' unselectable='on' " + this.bluidTopStyle(d) + "></div>");
            this.divLfet = DNA.engine.DomUtil.insertAfter(h.getEl(), "<div class='XYSelection' unselectable='on' " + this.bluidLeftStyle(d) + "></div>");
            this.divRight = DNA.engine.DomUtil.insertAfter(h.getEl(), "<div class='XYSelection' unselectable='on' " + this.bluidRightStyle(d) + "></div>");
            this.divBottom = DNA.engine.DomUtil.insertAfter(h.getEl(), "<div class='XYSelection' unselectable='on' " + this.bluidBottomStyle(d) + "></div>")
        }
        if (this.isDragSourceThatNeedDragMoveProxy(h)) {
            var g = h.getBounds();
            var a = {
                id: h.getEid(),
                d_m: "d_m" + h.getEid(),
                "class": "dragmoveProxy",
                display: "none",
                style: {
                    left: g.x + "px",
                    top: g.y - DNA.widget.AbstractLayoutPanel.DRAGMOVE_PROXY_WIDTH + "px",
                    width: DNA.widget.AbstractLayoutPanel.DRAGMOVE_PROXY_WIDTH + "px",
                    height: DNA.widget.AbstractLayoutPanel.DRAGMOVE_PROXY_WIDTH + "px",
                    "z-index": 9999999,
                    position: "absolute",
                    cursor: "move",
                    overflow: "hidden"
                }
            };
            this.dragMoveProxyDom = DNA.engine.DomUtil.append(this.panel.getEl(), DNA.widget.TagBuilder.buildSingleDivStr(a))
        }
    },
    redraw: function() {
        this.updateBounds();
        var a = DNA.engine.DomUtil.getStyle(this.control.el, "z-index");
        this.refreshIndex(a)
    },
    updateBounds: function() {
        var a = this.control.getBounds();
        if (this.control._initData[DNA.JWTProperty.PROPERTY_DESIGNLISTENER]) {
            this.divRightResize.style.left = a.x + a.width - 4 + "px";
            this.divRightResize.style.top = (a.y + a.height / 2 - 2) + "px";
            this.divBottomResize.style.left = (a.x + a.width / 2 - 2) + "px";
            this.divBottomResize.style.top = a.y + a.height - 3 + "px";
            this.divRightBottomResize.style.left = a.x + a.width - 4 + "px";
            this.divRightBottomResize.style.top = a.y + a.height - 3 + "px";
            this.divLeftResize.style.left = a.x - 3 + "px";
            this.divLeftResize.style.top = a.y + a.height / 2 - 2 + "px";
            this.divTopResize.style.left = a.x + a.width / 2 - 2 + "px";
            this.divTopResize.style.top = a.y - 1 + "px";
            this.divLeftTopResize.style.left = a.x - 3 + "px";
            this.divLeftTopResize.style.top = a.y - 1 + "px";
            this.divLeftBottomResize.style.left = a.x - 3 + "px";
            this.divLeftBottomResize.style.top = a.y + a.height - 3 + "px";
            this.divRightTopResize.style.left = a.x + a.width - 4 + "px";
            this.divRightTopResize.style.top = a.y - 1 + "px"
        } else {
            this.divTop.style.left = a.x - 1 + "px";
            this.divTop.style.top = a.y - 1 + "px";
            this.divTop.style.width = a.width + 2 + "px";
            this.divLfet.style.left = a.x - 1 + "px";
            this.divLfet.style.top = a.y - 1 + "px";
            this.divLfet.style.height = a.height + 2 + "px";
            this.divRight.style.left = a.x + a.width + 1 + "px";
            this.divRight.style.top = a.y - 1 + "px";
            this.divRight.style.height = a.height + 2 + "px";
            this.divBottom.style.left = a.x - 1 + "px";
            this.divBottom.style.top = a.y + a.height + 1 + "px";
            this.divBottom.style.width = a.width + 2 + "px"
        }
        var b = this.dragMoveProxyDom;
        if (b) {
            DNA.engine.DomUtil.setStyle(b, "left", a.x + "px");
            DNA.engine.DomUtil.setStyle(b, "top", (a.y - DNA.widget.AbstractLayoutPanel.DRAGMOVE_PROXY_WIDTH) + "px")
        }
    },
    refreshIndex: function(a) {
        if (this.control._initData[DNA.JWTProperty.PROPERTY_DESIGNLISTENER]) {
            this.divRightResize.style.zIndex = a;
            this.divBottomResize.style.zIndex = a;
            this.divRightBottomResize.style.zIndex = a;
            this.divLeftResize.style.zIndex = a;
            this.divTopResize.style.zIndex = a;
            this.divLeftTopResize.style.zIndex = a;
            this.divLeftBottomResize.style.zIndex = a;
            this.divRightTopResize.style.zIndex = a
        } else {
            this.divTop.style.zIndex = a;
            this.divLfet.style.zIndex = a;
            this.divRight.style.zIndex = a;
            this.divBottom.style.zIndex = a
        }
        var b = this.dragMoveProxyDom;
        if (b) {
            b.style.zIndex = a
        }
    },
    bluidTopStyle: function(b) {
        var a = "style='top:";
        a += b.y - 1;
        a += "px;left:";
        a += b.x - 1;
        a += "px;width:";
        a += b.width + 2;
        a += "px;height:1px;z-index:";
        a += DNA.engine.DomUtil.getStyle(this.control.el, "z-index") + "'";
        return a
    },
    bluidLeftStyle: function(b) {
        var a = "style='top:";
        a += b.y - 1;
        a += "px;left:";
        a += b.x - 1;
        a += "px;height:";
        a += b.height + 2;
        a += "px;width:1px;z-index:";
        a += DNA.engine.DomUtil.getStyle(this.control.el, "z-index") + "'";
        return a
    },
    bluidRightStyle: function(b) {
        var a = "style='top:";
        a += b.y - 1;
        a += "px;left:";
        a += b.x + b.width + 1;
        a += "px;height:";
        a += b.height + 2;
        a += "px;width:1px;z-index:";
        a += DNA.engine.DomUtil.getStyle(this.control.el, "z-index") + "'";
        return a
    },
    bluidBottomStyle: function(b) {
        var a = "style='top:";
        a += b.y + b.height + 1;
        a += "px;left:";
        a += b.x - 1;
        a += "px;width:";
        a += b.width + 1;
        a += "px;height:1px;z-index:";
        a += DNA.engine.DomUtil.getStyle(this.control.el, "z-index") + "'";
        return a
    },
    bluidRightMiddleStyle: function(b) {
        var a = "style='top:";
        a += b.y + b.height / 2 - 2;
        a += "px;left:";
        a += b.x + b.width - 4;
        a += "px;z-index:";
        a += DNA.engine.DomUtil.getStyle(this.control.el, "z-index");
        a += ";cursor:e-resize'";
        return a
    },
    bluidBottomMiddleStyle: function(b) {
        var a = "style='top:";
        a += b.y + b.height - 3;
        a += "px;left:";
        a += b.x + b.width / 2 - 2;
        a += "px;z-index:";
        a += DNA.engine.DomUtil.getStyle(this.control.el, "z-index");
        a += ";cursor:s-resize'";
        return a
    },
    bluidRightBottomStyle: function(b) {
        var a = "style='top:";
        a += b.y + b.height - 3;
        a += "px;left:";
        a += b.x + b.width - 4;
        a += "px;z-index:";
        a += DNA.engine.DomUtil.getStyle(this.control.el, "z-index");
        a += ";cursor:se-resize'";
        return a
    },
    bluidLeftMiddleStyle: function(b) {
        var a = "style='top:";
        a += b.y + b.height / 2 - 2;
        a += "px;left:";
        a += b.x - 3;
        a += "px;z-index:";
        a += DNA.engine.DomUtil.getStyle(this.control.el, "z-index");
        a += ";cursor:w-resize'";
        return a
    },
    bluidTopMiddleStyle: function(b) {
        var a = "style='top:";
        a += b.y - 1;
        a += "px;left:";
        a += b.x + b.width / 2 - 2;
        a += "px;z-index:";
        a += DNA.engine.DomUtil.getStyle(this.control.el, "z-index");
        a += ";cursor:n-resize'";
        return a
    },
    bluidLeftTopStyle: function(b) {
        var a = "style='top:";
        a += b.y - 1;
        a += "px;left:";
        a += b.x - 3;
        a += "px;z-index:";
        a += DNA.engine.DomUtil.getStyle(this.control.el, "z-index");
        a += ";cursor:nw-resize'";
        return a
    },
    bluidLeftBottomStyle: function(b) {
        var a = "style='top:";
        a += b.y + b.height - 3;
        a += "px;left:";
        a += b.x - 3;
        a += "px;z-index:";
        a += DNA.engine.DomUtil.getStyle(this.control.el, "z-index");
        a += ";cursor:sw-resize'";
        return a
    },
    bluidRightTopStyle: function(b) {
        var a = "style='top:";
        a += b.y - 1;
        a += "px;left:";
        a += b.x + b.width - 4;
        a += "px;z-index:";
        a += DNA.engine.DomUtil.getStyle(this.control.el, "z-index");
        a += ";cursor:ne-resize'";
        return a
    },
    setVisible: function(a) {
        var c = "none";
        if (a == true) {
            c = ""
        }
        if (this.control._initData[DNA.JWTProperty.PROPERTY_DESIGNLISTENER]) {
            this.divRightResize.style.display = c;
            this.divBottomResize.style.display = c;
            this.divRightBottomResize.style.display = c;
            this.divLeftResize.style.display = c;
            this.divTopResize.style.display = c;
            this.divLeftTopResize.style.display = c;
            this.divLeftBottomResize.style.display = c;
            this.divRightTopResize.style.display = c
        } else {
            this.divTop.style.display = c;
            this.divLfet.style.display = c;
            this.divRight.style.display = c;
            this.divBottom.style.display = c
        }
        var b = this.dragMoveProxyDom;
        if (b) {
            b.style.display = c
        }
    },
    isVisible: function() {
        var b = this.divTop;
        if (this.control._initData[DNA.JWTProperty.PROPERTY_DESIGNLISTENER]) {
            b = this.divRightResize
        }
        if (b) {
            var a = DNA.engine.DomUtil.getSize(b);
            if (a.width <= 0 || a.height <= 0) {
                return false
            } else {
                return true
            }
        }
    },
    destory: function() {
        var a = this.panel;
        if (!a.isDisposed()) {
            if (this.divTop) {
                this.divTop.parentNode.removeChild(this.divTop)
            }
            if (this.divLfet) {
                this.divLfet.parentNode.removeChild(this.divLfet)
            }
            if (this.divRight) {
                this.divRight.parentNode.removeChild(this.divRight)
            }
            if (this.divBottom) {
                this.divBottom.parentNode.removeChild(this.divBottom)
            }
            if (this.divRightResize) {
                this.divRightResize.parentNode.removeChild(this.divRightResize)
            }
            if (this.divBottomResize) {
                this.divBottomResize.parentNode.removeChild(this.divBottomResize)
            }
            if (this.divRightBottomResize) {
                this.divRightBottomResize.parentNode.removeChild(this.divRightBottomResize)
            }
            if (this.divLeftResize) {
                this.divLeftResize.parentNode.removeChild(this.divLeftResize)
            }
            if (this.divTopResize) {
                this.divTopResize.parentNode.removeChild(this.divTopResize)
            }
            if (this.divLeftTopResize) {
                this.divLeftTopResize.parentNode.removeChild(this.divLeftTopResize)
            }
            if (this.divLeftBottomResize) {
                this.divLeftBottomResize.parentNode.removeChild(this.divLeftBottomResize)
            }
            if (this.divRightTopResize) {
                this.divRightTopResize.parentNode.removeChild(this.divRightTopResize)
            }
            if (this.dragMoveProxyDom) {
                DNA.engine.DomUtil.dispose(this.dragMoveProxyDom)
            }
        }
        delete this.divRightResize;
        delete this.divBottomResize;
        delete this.divRightBottomResize;
        delete this.divLeftResize;
        delete this.divTopResize;
        delete this.divLeftTopResize;
        delete this.divLeftBottomResize;
        delete this.divRightTopResize;
        delete this.dragMoveProxyDom;
        delete this.panel;
        delete this.contrrol
    }
});
DNA.widget.XYPanelSelection = function(a, b) {
    DNA.widget.XYPanelSelection.superclass.constructor.call(this, a, b)
}
;
DNA.widget.XYPanelSelection.extend(DNA.widget.AbstractPanelSelection, {});
DNA.widget.TablePanelSelection = function(a, b) {
    DNA.widget.TablePanelSelection.superclass.constructor.call(this, a, b)
}
;
DNA.widget.TablePanelSelection.extend(DNA.widget.AbstractPanelSelection, {
    redraw: function() {
        this.updateBounds()
    },
    setVisible: function(a) {
        DNA.widget.TablePanelSelection.superclass.setVisible.call(this, a);
        this.refreshIndex(DNA.engine.application.getTopWindowZIndexAnd1())
    }
});
DNA.widget.RowLayoutPanel = function(a) {
    DNA.widget.RowLayoutPanel.superclass.constructor.call(this, a);
    this.isdragtarget = true;
    this.getLayout()
}
;
DNA.widget.RowLayoutPanel.extend(DNA.widget.Composite, {
    autoRender: true,
    _doBuildElements: function() {
        this.rowPanelBorder = DNA.engine.DomUtil.insertFirst(this.getEl(), "<div style='top: 1px; left: 1px; border: 2px solid rgb(255, 0 , 0); z-index: 9999; display:none'>");
        this.rowPanelLine = DNA.engine.DomUtil.insertFirst(this.getEl(), "<div style='top: 0px;height:" + (this.getBounds().height - 2) + "px; width: 3px; background-color: rgb(0, 0, 255); position: absolute;overflow: hidden; z-index: 9999; display:none'></div>")
    },
    _registEvents: function() {
        this.addListener(DNA.JWTEvent.DRAGOVER, this._doDragOver);
        this.addListener(DNA.JWTEvent.DRAGSTART, this._doDragStart);
        this.addListener(DNA.JWTEvent.MOUSEOUT, this._doMouseOut);
        var a = DNA.engine.application.getJWTEventMgr();
        a.addListener(DNA.JWTEvent.MOUSEUP, this._onGlobalMouseUp, this)
    },
    _doDragStart: new DNA.engine.Action({
        handle: function() {
            this.isdragtarget = false
        }
    }),
    _doMouseOut: new DNA.engine.Action({
        handle: function(a) {
            DNA.engine.DomUtil.setVisible(this.rowPanelBorder, false);
            DNA.engine.DomUtil.setVisible(this.rowPanelLine, false)
        }
    }),
    _onGlobalMouseUp: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            this.isdragtarget = true;
            DNA.engine.DomUtil.setVisible(this.rowPanelBorder, false);
            DNA.engine.DomUtil.setVisible(this.rowPanelLine, false)
        }
    }),
    _doDragOver: new DNA.engine.Action({
        handle: function(g) {
            if (!this.getEl() || this.isdragtarget == false) {
                return
            }
            DNA.engine.DomUtil.setWidth(this.rowPanelBorder, this.getBounds().width - this.getBorderSize() / 2);
            DNA.engine.DomUtil.setHeight(this.rowPanelBorder, this.getBounds().height - this.getBorderSize() / 2);
            DNA.engine.DomUtil.setVisible(this.rowPanelBorder, true);
            var b = 0;
            var h = -1;
            var d = g.getXY();
            var c = DNA.engine.DomUtil.getPageXY(this.getEl());
            c = {
                x: d.x - c.x,
                y: d.y - c.y
            };
            if (this._layout.type == DNA.JWT.HORIZONTAL) {
                var a = this.getDropIndex(c.x);
                if (a == h) {
                    return
                }
                if (a == 0) {
                    b = 3
                } else {
                    b = this.getContentTop(a) - this._layout.spacing + 2
                }
                DNA.engine.DomUtil.setHeight(this.rowPanelLine, this.getBounds().height - 2);
                this.rowPanelLine.style.left = (b - 2) + "px";
                DNA.engine.DomUtil.setVisible(this.rowPanelLine, true)
            } else {
                var a = this.getDropIndex(c.y);
                if (a == h) {
                    return
                }
                if (a == 0) {
                    b = 3
                } else {
                    b = this.getContentTop(a) - this._layout.spacing + 2
                }
                DNA.engine.DomUtil.setWidth(this.rowPanelLine, this.getBounds().width - 2);
                this.rowPanelLine.style.top = (b - 2) + "px";
                DNA.engine.DomUtil.setVisible(this.rowPanelLine, true)
            }
            h = a;
            this.posInfo = a.toString()
        }
    }),
    getServerControls: function(a) {
        if (!a) {
            return null 
        }
        var g = [];
        var b = 0;
        for (var c = 0; c < a.length; c++) {
            var d = a[c].getLayoutData();
            if (!d) {
                if (!a[c].isExcludeLayout()) {
                    g[b] = a[c];
                    b++
                }
            } else {
                if (!d.exclude) {
                    g[b] = a[c];
                    b++
                }
            }
        }
        return g
    },
    getContentTop: function(b) {
        var a = this.getChildren();
        if (a) {
            if (this._layout.type == DNA.JWT.HORIZONTAL) {
                a = this.getServerControls(a);
                if (a == null ) {
                    return this._layout.marginLeft
                }
                if (b < 0) {
                    return 0
                }
                if (a.length == 0) {
                    return 0
                }
                if (b >= a.length) {
                    return a[a.length - 1].getBounds().x + a[a.length - 1].getBounds().width + this._layout.spacing
                }
                return a[b].getBounds().x
            } else {
                a = this.getServerControls(a);
                if (a == null ) {
                    return this._layout.marginTop
                }
                if (b < 0) {
                    return 0
                }
                if (a.length == 0) {
                    return 0
                }
                if (b >= a.length) {
                    return a[a.length - 1].getBounds().y + a[a.length - 1].getBounds().height + this._layout.spacing
                }
                return a[b].getBounds().y
            }
        } else {
            return 0
        }
    },
    getDropIndex: function(a) {
        var o = this.getChildren();
        if (o) {
            if (this._layout.type == DNA.JWT.HORIZONTAL) {
                var n = a;
                o = this.getServerControls(o);
                if (!o || o.length == 0) {
                    return 0
                }
                var h = DNA.engine.DomUtil.getSize(o[0].getEl()).width;
                if (n >= 0 && n < h / 2 + this._layout.marginLeft) {
                    return 0
                }
                var b = this.getContentTop(1);
                for (var g = 1; g < o.length; g++) {
                    var l = o[g];
                    if (n >= b - this._layout.spacing - DNA.engine.DomUtil.getSize(o[g - 1].getEl()).width / 2 && n < b + DNA.engine.DomUtil.getSize(l.getEl()).width / 2) {
                        return g
                    }
                    b += DNA.engine.DomUtil.getSize(l.getEl()).width + this._layout.spacing
                }
                return o.length
            } else {
                var m = a;
                o = this.getServerControls(o);
                if (!o || o.length == 0) {
                    return 0
                }
                var d = DNA.engine.DomUtil.getSize(o[0].getEl()).height;
                if (m >= 0 && m < d / 2 + this._layout.marginTop) {
                    return 0
                }
                var p = this.getContentTop(1);
                for (var g = 1; g < o.length; g++) {
                    var l = o[g];
                    if (m >= p - this._layout.spacing - DNA.engine.DomUtil.getSize(o[g - 1].getEl()).height / 2 && m < p + DNA.engine.DomUtil.getSize(l.getEl()).height / 2) {
                        return g
                    }
                    p += DNA.engine.DomUtil.getSize(l.getEl()).height + this._layout.spacing
                }
                return o.length
            }
        } else {
            return 0
        }
    },
    doDispose: function() {
        DNA.widget.RowLayoutPanel.superclass.doDispose.call(this);
        delete this.rowPanelBorder;
        delete this.rowPanelLine
    }
});
Object.override(DNA.widget.RowLayoutPanel.prototype, {
    jtype: "RowLayoutPanel",
    focusable: true
});
DNA.widget.AbstractLayoutPanel = function(a) {
    DNA.widget.AbstractLayoutPanel.superclass.constructor.call(this, a);
    this.selections = new Array();
    this.dragger = new DNA.widget.Dragger();
    this.newChArray = new Array();
    this.dragOverFlag = false;
    this.mouseDownOnPanelFlag = false
}
;
DNA.widget.AbstractLayoutPanel.KEY_TRIMMING_OFFSET = 1;
DNA.widget.AbstractLayoutPanel.MINWIDTH = 10;
DNA.widget.AbstractLayoutPanel.MINHEIGHT = 10;
DNA.widget.AbstractLayoutPanel.INNER_EFFECT_DOM_ID = "effect";
DNA.widget.AbstractLayoutPanel.DRAGMOVE_PROXY_WIDTH = 16;
DNA.widget.AbstractLayoutPanel.extend(DNA.widget.Composite, {
    setSelection: function(b) {
        this.hideAllSelection();
        if (!b) {
            return
        }
        b = b.split(",");
        var a = b.length;
        for (var g = 0; g < a; ++g) {
            var d = b[g];
            var h = DNA.widget.WidgetRegistry.get(d);
            if (h) {
                this._addSelectionAndShow(h)
            }
        }
    },
    getSelections: function() {
        var g = this.selections;
        var b = new Array();
        var a = g.length;
        var c = 0;
        for (var d = 0; d < a; ++d) {
            var h = g[d];
            if (h.isVisible()) {
                b[c] = h.control;
                c++
            }
        }
        return b
    },
    setDropTargetEnabled: function(a) {
        this._isDropTargetEnabled = a
    },
    isDropTargetEnabled: function() {
        return this._isDropTargetEnabled
    },
    createSelectionByPanel: function(a, b) {
        if (a instanceof DNA.widget.XYLayoutPanel) {
            return new DNA.widget.XYPanelSelection(a,b)
        }
        return new DNA.widget.TablePanelSelection(a,b)
    },
    _addSelectionAndShow: function(b) {
        var a = this._getSelectionObject(b);
        if (!a) {
            a = this.createSelectionByPanel(this, b);
            this.selections.push(a)
        } else {
            this.selections.remove(a);
            this.selections.push(a)
        }
        a.setVisible(true)
    },
    addSelection: function(a) {
        this._addSelectionAndShow(a);
        this.fireEvent("selectionCtr", [this])
    },
    hideSelection: function(b) {
        this.boundRec = null ;
        var a = this._getSelection(b);
        if (a) {
            a.setVisible(false)
        }
    },
    hideAllSelection: function() {
        var d = this.selections;
        var a = d.length;
        var b = false;
        for (var c = 0; c < a; ++c) {
            if (d[c] && d[c].isVisible()) {
                b = true;
                d[c].setVisible(false)
            }
        }
        return b
    },
    destorySelections: function() {
        var c = this.selections;
        var a = c.length;
        for (var b = 0; b < a; ++b) {
            if (c[b]) {
                c[b].destory()
            }
        }
        c.length = 0
    },
    destorySelection: function(b) {
        var a = this._getSelectionObject(b);
        if (a) {
            a.destory();
            this.selections.remove(a)
        }
    },
    _hasSelection: function() {
        var c = this.selections;
        var a = c.length;
        for (var b = 0; b < a; ++b) {
            var d = c[b];
            if (d && d.isVisible()) {
                return true
            }
        }
        return false
    },
    _isControlSelected: function(a) {
        return this._getSelection(a) != null 
    },
    _setSelectionCtrl: function(a) {
        this.hideAllSelection();
        this._addSelectionAndShow(a);
        this.fireEvent("selectionCtr", [this])
    },
    _getSelection: function(h) {
        var d = this.selections;
        var a = d.length;
        for (var b = 0; b < a; ++b) {
            var g = d[b];
            if (g && g.control == h && g.isVisible()) {
                return g
            }
        }
        return null 
    },
    _getSelectionObject: function(h) {
        var d = this.selections;
        var a = d.length;
        for (var b = 0; b < a; ++b) {
            var g = d[b];
            if (g && g.control == h) {
                return g
            }
        }
        return null 
    },
    _isMutilSelected: function() {
        var b = 0;
        var d = this.selections;
        var a = d.length;
        for (var c = (a - 1); c > -1; --c) {
            var g = d[c];
            if (g && g.isVisible()) {
                b++
            }
            if (b === 2) {
                return true
            }
        }
        return false
    },
    redrawSelection: function(b) {
        var a = this._getSelectionObject(b);
        if (a) {
            a.redraw()
        }
    },
    controlInRectangle: function(d, b) {
        var a = d.getBounds();
        return (a.x - this.getHOffset() >= b.x) && (a.x + a.width - this.getHOffset() <= b.x + b.width) && (a.y - this.getVOffset() >= b.y) && (a.y + a.height - this.getVOffset() <= b.y + b.height)
    },
    handleDragSelection: function(h) {
        if (h) {
            var b = this.getChildren();
            if (b) {
                var a = b.length;
                for (var g = 0; g < a; ++g) {
                    var l = b[g];
                    var d = this._isControlSelected(l);
                    if (this.controlInRectangle(l, h)) {
                        if (d === false) {
                            l.checkRendered(true);
                            this._addSelectionAndShow(l)
                        }
                    } else {
                        if (d === true) {
                            this.hideSelection(l)
                        }
                    }
                }
            }
        }
    },
    getBoundRec: function() {
        var o = this.getSelections();
        if (o.length == 0) {
            return new DNA.widget.Rectangle(0,0,0,0)
        }
        var g = Number.MAX_VALUE;
        var d = Number.MAX_VALUE;
        var b = Number.MIN_VALUE;
        var a = Number.MIN_VALUE;
        var l = o.length;
        for (var h = 0; h < l; h++) {
            var n = o[h];
            var m = n.getBounds();
            if (m.x <= g) {
                g = m.x;
                this.leftSelectedControl = n
            }
            if (m.y <= d) {
                d = m.y;
                this.topSelectedControl = n
            }
            if (m.x + m.width > b) {
                b = m.x + m.width
            }
            if (m.y + m.height > a) {
                a = m.y + m.height
            }
        }
        this.boundRec = new DNA.widget.Rectangle(g,d,b - g,a - d);
        return this.boundRec
    },
    computeRectangle: function() {
        return this.getBoundRec()
    },
    isDragResizeDom: function(a) {
        return a.getAttribute("resize") == DNA.widget.AbstractPanelSelection.RESIZE_STRING
    },
    _add: function(b, a) {
        var c = DNA.widget.Composite.superclass._add.call(this, b, a);
        this.newChArray.push(c.id);
        return c
    },
    _isControlDom: function(a) {
        return !DNA.engine.DomUtil.compare(a, "*[" + DNA.widget.AbstractLayoutPanel.INNER_EFFECT_DOM_ID + "=e]")
    },
    _initNewInsertCh: function() {
        var a = this.newChArray.length;
        if (a) {
            for (var b = 0; b < a; b++) {
                var c = DNA.widget.WidgetRegistry.get(this.newChArray[b]);
                if (c) {
                    this.initChild(c)
                }
            }
            this.newChArray.length = 0
        }
    },
    _doWhenInitChild: function(a) {},
    initChild: function(a) {
        a.addListener(DNA.JWTEvent.LOCATIONCHANGE, this._onChildLocationChange, this);
        a.addListener(DNA.JWTEvent.RESIZE, this._onChildResizeChange, this);
        a.addListener(DNA.JWTEvent.DRAGSTART, this._onChildDragStart, this);
        if (a.jtype == "Composite") {
            this._createInnerCompDiv(a)
        }
        this._doWhenInitChild(a)
    },
    __doAfterChildClear: function(a) {
        this._createInnerCompDiv(a)
    },
    _createInnerCompDiv: function(c) {
        var h = c.getBounds();
        var b = c.getEid();
        var g = h.width;
        var a = h.height;
        var d = DNA.engine.DomUtil.insertFirst(c.getEl(), "<div id='d" + b + "' style='position: absolute;overflow: hidden;width:" + g + "px;height:" + a + "px;z-index:" + 9999 + "'></div>");
        if (DNA.engine.Client.isIE()) {
            d.style.backgroundColor = "#FFF";
            if (DNA.engine.Client.isStrict()) {
                d.style.opacity = "0"
            } else {
                d.style.filter = "alpha(opacity=0)"
            }
        }
    },
    _doWhenChildLocationChange: function(a) {},
    _onChildLocationChange: new DNA.engine.Action({
        handle: function(a) {
            this.redrawSelection(a);
            this._doWhenChildLocationChange(a)
        }
    }),
    _doWhenChildSizeChange: function(a) {},
    _onChildResizeChange: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            this.redrawSelection(a);
            this._doWhenChildSizeChange(a);
            if (a.jtype == "Composite") {
                var b = this.getEl().ownerDocument.getElementById("d" + a.getEid());
                DNA.engine.DomUtil.setStyle(b, "width", a.getBounds().width + "px");
                DNA.engine.DomUtil.setStyle(b, "height", a.getBounds().height + "px")
            }
        }
    }),
    _doWhenChildDragStart: function() {},
    _onChildDragStart: new DNA.engine.Action({
        handle: function(a) {
            this._doWhenChildDragStart(a)
        }
    }),
    _doWhenChildDispose: function() {},
    _handleChildDispose: new DNA.engine.Action({
        handle: function(a) {
            if (this === a.getParent()) {
                this.destorySelection(a);
                this._doWhenChildDispose(a)
            }
        }
    }),
    _isPanelDirectChild: function(a) {
        return a && a.getParentControl && a.getParentControl() == this
    },
    _registEvents: function() {
        DNA.widget.AbstractLayoutPanel.superclass._registEvents.call(this);
        this.addListener(DNA.JWTEvent.MOUSEDOWN, this._doMouseDown);
        this.addListener(DNA.JWTEvent.DRAGOVER, this._doDragOver);
        var a = DNA.engine.application.getJWTEventMgr();
        a.addListener(DNA.JWTEvent.MOUSEUP, this._onGlobalMouseUp, this);
        a.addListener(DNA.JWTEvent.MOUSEMOVE, this._onGlobalMouseMove, this);
        a.addListener(DNA.JWTEvent.MOUSEDOWN, this._onCtrlGlobalMouseDown, this);
        a.addBubbleListener(DNA.JWTEvent.MOUSEOVER, this._doBubbleMouseOver, this);
        a.addListener(DNA.JWTEvent.PREDISPOSE, this._handleChildDispose, this);
        a.addListener(DNA.JWTEvent.KEYDOWN, this._onKeyDown, this);
        a.addListener(DNA.JWTEvent.KEYUP, this._onKeyUp, this)
    },
    _doBubbleMouseOver: new DNA.engine.Action({
        handle: function(a) {
            this._initNewInsertCh()
        }
    }),
    _doMouseDown: new DNA.engine.PreventableAction({
        handle: function(c) {
            var b = c.getLocation();
            if (this.hideAllSelection()) {
                this.fireEvent("selectionCtr", [this])
            }
            if (!this._initData[DNA.JWTProperty.PROPERTY_DESIGNLISTENER]) {
                var a = c.getLocation();
                this.mouseDownOnPanelFlag = true;
                this._startBox = this._getPageBounds();
                this._startBox.x += a.x;
                this._startBox.y += a.y;
                this._startBox.width = this._startBox.height = 0;
                this._startBox.ZIndex = this._zIndex ? this._zIndex + 1 : 999999;
                return
            }
        }
    }),
    _doDragOver: new DNA.engine.Action({
        handle: function(a) {
            this.dragOverFlag = true
        }
    }),
    _acceptMove: function(a) {
        return this._acceptmove ? true : this._acceptmove = (a.getXY().x != this._startBox.x || a.getXY().y != this._startBox.y)
    },
    _onCtrlGlobalMouseDown: new DNA.engine.Action({
        handle: function(b) {
            if (this.isVisible() === false) {
                return
            }
            var d = b.getSrcControl();
            if (this._isPanelDirectChild(d)) {
                this.mouseDownOnChildFlag = true;
                if (this.isDragResizeDom(b.getSrcElement())) {
                    this.mouseDownOnDragResizeDomFlag = true
                }
                var a = DNA.engine.application.getFocused();
                if (a != d) {
                    DNA.engine.application.getFocusListener()._focus(this)
                }
                if (!b.isCtrl()) {
                    if (!this._isControlSelected(d)) {
                        this._setSelectionCtrl(d)
                    }
                }
            }
        }
    }),
    _onGlobalMouseMove: new DNA.engine.Action({
        handle: function(l) {
            if (this.mouseDownOnPanelFlag && this._acceptMove(l)) {
                var g = l.getXY();
                if (!this.dragger._snapshot) {
                    this.dragger._showSnapshot(this._startBox)
                } else {
                    var a = Math.abs(g.x - this._startBox.x);
                    var c = Math.abs(g.y - this._startBox.y);
                    DNA.engine.DomUtil.setSize(this.dragger._snapshot, {
                        width: a,
                        height: c
                    });
                    DNA.engine.DomUtil.setLeftTop(this.dragger._snapshot, Math.min(g.x, this._startBox.x), Math.min(g.y, this._startBox.y))
                }
                var a = g.x - this._startBox.x;
                var c = g.y - this._startBox.y;
                var d = DNA.engine.DomUtil.getPageXY(this.el);
                var b = {
                    x: (parseInt(DNA.engine.DomUtil.getStyle(this.dragger._snapshot, "left")) - d.x),
                    y: (parseInt(DNA.engine.DomUtil.getStyle(this.dragger._snapshot, "top")) - d.y),
                    width: parseInt(DNA.engine.DomUtil.getStyle(this.dragger._snapshot, "width")),
                    height: parseInt(DNA.engine.DomUtil.getStyle(this.dragger._snapshot, "height"))
                };
                this.handleDragSelection(b)
            }
        }
    }),
    _onGlobalMouseUp: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            this.mouseDownOnChildFlag = false;
            var b = a.getSrcControl();
            if (this._isPanelDirectChild(b)) {
                if (a.isCtrl()) {
                    if (!this._isControlSelected(b)) {
                        this.addSelection(b)
                    } else {
                        this.hideSelection(b);
                        this.fireEvent("selectionCtr", [this])
                    }
                } else {
                    if (!this.dragger._snapshot && this.dragOverFlag !== true && this.mouseDownOnDragResizeDomFlag !== true && this._isMutilSelected()) {
                        this._setSelectionCtrl(b)
                    }
                }
            }
            this.dragOverFlag = false;
            this.mouseDownOnDragResizeDomFlag = false;
            if (this.mouseDownOnPanelFlag) {
                this.mouseDownOnPanelFlag = false;
                if (this.dragger._snapshot) {
                    if (this._hasSelection()) {
                        this.fireEvent("selectionCtr", [this])
                    }
                    this.dragger._resetSnapshot();
                    this.dragger._snapshot = null 
                }
            }
            this._acceptmove = false
        }
    }),
    _refreshSelectedChildrenSize: function(l, d) {
        var b = this.getSelections();
        var a = b.length;
        for (var h = 0; h < a; h++) {
            var n = b[h];
            var m = n.getBounds().width + l;
            var g = n.getBounds().height + d;
            if (m < DNA.widget.AbstractLayoutPanel.MINWIDTH || g < DNA.widget.AbstractLayoutPanel.MINHEIGHT || !n._initData[DNA.JWTProperty.PROPERTY_DESIGNLISTENER]) {
                continue
            }
            n.setSize(m, g);
            this.resizeChild = true
        }
    },
    _refreshSelectedChildrenLocation: function(d, l) {
        var b = this.getSelections();
        if (b[0].getDragHandler()) {
            var a = b.length;
            for (var g = 0; g < a; g++) {
                var h = b[g];
                if (h.getDragHandler()) {
                    h.setLocation(h.getBounds(true).x + d, h.getBounds(true).y + l)
                }
            }
        }
    },
    _getIntPos: function(a, b) {
        return Math.floor(a) + "," + Math.floor(b)
    },
    _handleLeftKeyDown: function(a, c) {
        if (this.leftSelectedControl.getBounds().x <= 0) {
            return
        }
        var b = a.getBounds().x - c;
        if (b < 0) {
            b = 0
        }
        this._refreshSelectedChildrenLocation(-c, 0);
        this.posInfo = this._getIntPos(b, a.getBounds().y)
    },
    _handleRightKeyDown: function(a, c) {
        if (a.getBounds().x + a.getBounds().width >= this.getBounds().width) {
            return
        }
        var b = a.getBounds().x + c;
        if (b + a.getBounds().width > this.getBounds().width) {
            b = this.getBounds().y - a.getBounds().width
        }
        this._refreshSelectedChildrenLocation(c, 0);
        this.posInfo = this._getIntPos(b, a.getBounds().y)
    },
    _handleUpKeyDown: function(a, c) {
        if (this.topSelectedControl.getBounds().y <= 0) {
            return
        }
        var b = a.getBounds().y - c;
        if (b < 0) {
            b = 0
        }
        this._refreshSelectedChildrenLocation(0, -c);
        this.posInfo = this._getIntPos(a.getBounds().x, b)
    },
    _handleDownKeyDown: function(a, c) {
        if (a.getBounds().y + a.getBounds().height >= this.getBounds().height) {
            return
        }
        var b = a.getBounds().y + c;
        if (b + a.getBounds().height > this.getBounds().height) {
            b = this.getBounds().y - a.getBounds().height
        }
        this._refreshSelectedChildrenLocation(0, c);
        this.posInfo = this._getIntPos(a.getBounds().x, b)
    },
    _isFocusOnPanelOrPanelChild: function(a) {
        return ( a == this || a.getParent() == this) 
    },
    _onKeyDown: new DNA.engine.Action({
        handle: function(d) {
            var b = this.getSelections();
            if (b.length != 0 && !this.mouseDownOnChildFlag && (this._isFocusOnPanelOrPanelChild(d.getSrcControl()))) {
                this._initNewInsertCh();
                var c = d.getKeyCode();
                var a = b[0];
                var g = DNA.widget.AbstractLayoutPanel.KEY_TRIMMING_OFFSET;
                this.getBoundRec();
                switch (c) {
                case DNA.JWTEvent.LEFT:
                    if (d.isShift()) {
                        this._refreshSelectedChildrenSize(-g, 0)
                    } else {
                        this._handleLeftKeyDown(a, g)
                    }
                    break;
                case DNA.JWTEvent.RIGHT:
                    if (d.isShift()) {
                        this._refreshSelectedChildrenSize(g, 0)
                    } else {
                        this._handleRightKeyDown(a, g)
                    }
                    break;
                case DNA.JWTEvent.UP:
                    if (d.isShift()) {
                        this._refreshSelectedChildrenSize(0, -g)
                    } else {
                        this._handleUpKeyDown(a, g)
                    }
                    break;
                case DNA.JWTEvent.DOWN:
                    if (d.isShift()) {
                        this._refreshSelectedChildrenSize(0, +g)
                    } else {
                        this._handleDownKeyDown(a, g)
                    }
                    break;
                default:
                    return
                }
                d._preventDefault();
                this.uniqueKeyDown = true
            }
        }
    }),
    _onKeyUp: new DNA.engine.Action({
        handle: function(d) {
            if (!this.uniqueKeyDown) {
                return
            }
            this.uniqueKeyDown = false;
            var b = this.getSelections();
            if (b.length != 0 && !this.mouseDownOnChildFlag) {
                d._preventDefault();
                var c = d.getKeyCode();
                if (this.resizeChild) {
                    this.fireEvent("childresize", [this]);
                    this.resizeChild = false
                } else {
                    if (c !== DNA.JWTEvent.SHIFT && this.posInfo) {
                        var a = b[0];
                        if (a.getDragHandler()) {
                            a.dragSourcePos = null ;
                            this.fireEvent("dragdrop", [a, this, this.posInfo])
                        }
                    }
                }
            }
        }
    }),
    doDispose: function() {
        this.destorySelections();
        this.selections.length = 0;
        delete this.selections;
        delete this.dragger;
        DNA.widget.AbstractLayoutPanel.superclass.doDispose.call(this)
    }
});
DNA.widget.TagBuilder = {
    buildSingleDivStr: function(c) {
        var g = "<div";
        for (var a in c) {
            if (a !== "style") {
                g += (" " + a + "=" + c[a])
            } else {
                var d = c[a];
                g += " style='";
                for (var b in d) {
                    g += b + ":" + d[b] + ";"
                }
                g += "'"
            }
        }
        g += " />";
        return g
    }
};
DNA.widget.XYLayoutPanel = function(a) {
    DNA.widget.XYLayoutPanel.superclass.constructor.call(this, a);
    this.hAdsorptionLine = null ;
    this.vAdsorptionLine = null ;
    this.xMap = new DNA.engine.Map();
    this.yMap = new DNA.engine.Map();
    this.xArray = new Array();
    this.yArray = new Array();
    this.isAdsorption = true;
    this.hAdsorptionDistance = 0;
    this.vAdsorptionDistance = 0
}
;
DNA.widget.XYLayoutPanel.extend(DNA.widget.AbstractLayoutPanel, {
    autoRender: true,
    _doBuildElements: function() {
        var b = this.getBounds().width;
        var a = this.getBounds().height;
        this.hAdsorptionLine = "<div class='hDashedLine' style='height:" + (a) + "px'></div>";
        this.hAdsorptionLine = DNA.engine.DomUtil.insertFirst(this.getEl(), this.hAdsorptionLine);
        DNA.engine.DomUtil.setVisible(this.hAdsorptionLine, false);
        this.vAdsorptionLine = "<div class='vDashedLine' style='width:" + (b) + "px'></div>";
        this.vAdsorptionLine = DNA.engine.DomUtil.insertFirst(this.getEl(), this.vAdsorptionLine);
        DNA.engine.DomUtil.setVisible(this.vAdsorptionLine, false)
    },
    _setEffectDivSize: function(a, b) {
        if (this.hAdsorptionLine) {
            DNA.engine.DomUtil.setStyle(this.hAdsorptionLine, "height", this.getBounds().height + "px");
            DNA.engine.DomUtil.setStyle(this.vAdsorptionLine, "width", a + "px")
        }
    },
    setBounds: function(b, d, c, a) {
        DNA.widget.XYLayoutPanel.superclass.setBounds.call(this, b, d, c, a);
        if (d || d === 0) {
            this._setEffectDivSize(c, a)
        } else {
            this._setEffectDivSize(b.width, b.height)
        }
    },
    _registEvents: function() {
        DNA.widget.XYLayoutPanel.superclass._registEvents.call(this);
        this.addListener(DNA.JWTEvent.DRAGOVER, this._doXYDragOver);
        var a = DNA.engine.application.getJWTEventMgr();
        a.addListener(DNA.JWTEvent.MOUSEUP, this._onXYGlobalMouseUp, this)
    },
    _onXYGlobalMouseUp: new DNA.engine.Action({
        handle: function(a) {
            if (this.hAdsorptionLine) {
                this._blankHAdsorptionLine()
            }
            if (this.vAdsorptionLine) {
                this._blankVAdsorptionLine()
            }
        }
    }),
    _doXYDragOver: new DNA.engine.Action({
        handle: function(c) {
            if (!this.getEl()) {
                return
            }
            var b = c.getXY();
            var a = DNA.engine.DomUtil.getPageXY(this.getEl());
            a = {
                x: b.x - a.x,
                y: b.y - a.y
            };
            this.posInfo = (Math.floor(a.x) + this.getHOffset()) + "," + (Math.floor(a.y) + this.getVOffset())
        }
    }),
    _doWhenInitChild: function(a) {
        this._addNewBorderInfo(a)
    },
    _doWhenChildLocationChange: function(b) {
        var a = b.getEid();
        this._removeOldBorderInfo(a);
        this._addNewBorderInfo(b)
    },
    _doWhenChildSizeChange: function(b) {
        var a = b.getEid();
        this._removeOldBorderInfo(a);
        this._addNewBorderInfo(b)
    },
    _doWhenChildDispose: function(b) {
        var a = b.getEid();
        this._removeOldBorderInfo(a);
        this.xMap.remove(a);
        this.yMap.remove(a)
    },
    _addNewBorderInfo: function(b) {
        var a = b.getBounds();
        this._insertIntoSortedArray(this.xArray, a.x, DNA.JWT.VERTICAL);
        this._insertIntoSortedArray(this.xArray, a.x + a.width, DNA.JWT.VERTICAL);
        this._insertIntoSortedArray(this.yArray, a.y, DNA.JWT.HORIZONTAL);
        this._insertIntoSortedArray(this.yArray, a.y + a.height, DNA.JWT.HORIZONTAL);
        this.xMap.set(b.getEid(), a.x + "," + (a.x + a.width));
        this.yMap.set(b.getEid(), a.y + "," + (a.y + a.height))
    },
    _removeOldBorderInfo: function(b) {
        var c = this.xMap.get(b);
        var a = this.yMap.get(b);
        if (c) {
            c = c.split(",");
            a = a.split(",");
            this.xArray.remove(parseInt(c[0]));
            this.xArray.remove(parseInt(c[1]));
            this.yArray.remove(parseInt(a[0]));
            this.yArray.remove(parseInt(a[1]))
        }
    },
    _insertIntoSortedArray: function(g, d, c) {
        if (g.length == 0) {
            g.insert(d, 0);
            return
        }
        if (d < g[0]) {
            g.insert(d, 0);
            return
        }
        if (d.length == 1) {
            g.insert(d, 1);
            return
        }
        var a = g.length - 1;
        for (var b = 0; b < a; b++) {
            if (d >= g[b] && d <= g[b + 1]) {
                g.insert(d, b + 1);
                return
            }
        }
        if (c == DNA.JWT.VERTICAL) {
            if (d <= this.getBounds().width && DNA.engine.DomUtil.getStyle(this.getEl(), "overflow-x") == "auto") {
                this.getEl().scrollLeft = 0;
                DNA.engine.DomUtil.setStyle(this.getEl(), "overflow-x", "hidden")
            }
        }
        if (c == DNA.JWT.HORIZONTAL) {
            if (d <= this.getBounds().height && DNA.engine.DomUtil.getStyle(this.getEl(), "overflow-y") == "auto") {
                this.getEl().scrollTop = 0;
                DNA.engine.DomUtil.setStyle(this.getEl(), "overflow-y", "hidden")
            }
        }
        g.insertLast(d)
    },
    getStrawPos: function(h, c) {
        var g = null ;
        if (c === DNA.JWT.HORIZONTAL) {
            g = this.xArray
        } else {
            g = this.yArray
        }
        var a = 0;
        var d = g.length - 1;
        while (a <= d) {
            var b = (a + d) / 2;
            b = Math.floor(b);
            if (h - g[b] <= 5 && h - g[b] >= -5) {
                if (c === DNA.JWT.HORIZONTAL) {
                    DNA.engine.DomUtil.setVisible(this.hAdsorptionLine, true);
                    DNA.engine.DomUtil.setLeftTop(this.hAdsorptionLine, g[b], this.getVOffset());
                    this.hAdsorptionDistance = h - g[b]
                } else {
                    DNA.engine.DomUtil.setVisible(this.vAdsorptionLine, true);
                    DNA.engine.DomUtil.setLeftTop(this.vAdsorptionLine, this.getHOffset(), g[b]);
                    this.vAdsorptionDistance = h - g[b]
                }
                return g[b] + 1
            } else {
                if (h < g[b]) {
                    d = b - 1
                } else {
                    a = b + 1
                }
            }
        }
        if (c === DNA.JWT.HORIZONTAL && this.hAdsorptionLine && this.hAdsorptionLine.style) {
            this._blankHAdsorptionLine();
            this.hAdsorptionDistance = 0
        }
        if (c === DNA.JWT.VERTICAL && this.vAdsorptionLine && this.vAdsorptionLine.style) {
            this._blankVAdsorptionLine();
            this.vAdsorptionDistance = 0
        }
        return h
    },
    _blankHAdsorptionLine: function() {
        DNA.engine.DomUtil.setVisible(this.hAdsorptionLine, false)
    },
    _blankVAdsorptionLine: function() {
        DNA.engine.DomUtil.setVisible(this.vAdsorptionLine, false)
    },
    setAdsorption: function(a) {
        this.isAdsorption = a
    },
    getVOffset: function() {
        if (!this.getEl().scrollTop) {
            return 0
        }
        return this.getEl().scrollTop
    },
    getHOffset: function() {
        if (!this.getEl().scrollLeft) {
            return 0
        }
        return this.getEl().scrollLeft
    },
    doDispose: function() {
        delete this.hAdsorptionLine;
        delete this.vAdsorptionLine;
        delete this.xMap;
        delete this.yMap;
        delete this.xArray;
        delete this.yArray;
        delete this.leftTopSelectedControl;
        DNA.widget.XYLayoutPanel.superclass.doDispose.call(this)
    }
});
Object.override(DNA.widget.XYLayoutPanel.prototype, {
    jtype: "XYLayoutPanel",
    focusable: true
});
DNA.widget.TableLayoutPanel = function(a) {
    DNA.widget.TableLayoutPanel.superclass.constructor.call(this, a);
    this.mouseDownOnGridFlag = false;
    this.resizeFlag = false;
    this.canBeDragTarget = true;
    this.selectionCells = new DNA.engine.Map();
    this.minRowHeight = 10;
    this.minColWidth = 10;
    this.resizeAreaSize = 6;
    this.resizeColumnIndex = -1;
    this.resizeColumnLeft = 0;
    this.resizeRowIndex = -1;
    this.resizeRowTop = 0;
    this.newRowSize = 0;
    this.newColumnSize = 0;
    this.startPoint = null ;
    this.lastPoint = {
        x: -1,
        y: -1
    };
    this.lineRestore = null ;
    this.lineX = null ;
    this.lineY = null ;
    this.resizeEffect = false
}
;
DNA.widget.TableLayoutPanel.extend(DNA.widget.AbstractLayoutPanel, {
    autoRender: true,
    _doBuildElements: function() {
        this.tablepanelselectgrid = "tablepanelselectgrid" + this.getEid();
        this.tablepanelgridid = "tablepanelgridid" + this.getEid();
        this.lineid = "line" + this.getEid();
        var b = this.getBounds().width;
        var a = this.getBounds().height;
        this.drawUniqueDom(0, 0, b, a);
        this.showGridsFlag = true;
        this.onPaint();
        this.hideGrids();
        if (!this.getLayout()) {
            this.setLayout(new DNA.widget.TableLayoutExt(b,a,[1],[1]));
            this.layout()
        }
    },
    drawUniqueDom: function(g, d, c, a) {
        var b = {
            id: this.getEid(),
            name: "unique" + this.getEid(),
            style: {
                left: g + "px",
                top: d + "px",
                width: c + "px",
                height: a + "px",
                "z-index": -100,
                position: "absolute",
                overflow: "hidden"
            }
        };
        b[DNA.widget.AbstractLayoutPanel.INNER_EFFECT_DOM_ID] = "e";
        this.uniqueDiv = DNA.engine.DomUtil.insertFirst(this.getEl(), DNA.widget.TagBuilder.buildSingleDivStr(b))
    },
    setSize: function(a, b) {
        DNA.widget.TableLayoutPanel.superclass.setSize.call(this, a, b);
        DNA.engine.DomUtil.setWidth(this.uniqueDiv, a);
        DNA.engine.DomUtil.setHeight(this.uniqueDiv, b)
    },
    buildDiv: function(m, l, h, b, g, a, d, c) {
        return "<div id=" + m + " name=" + l + " style='top:" + h + "px; left:" + b + "px; width:" + g + "px; height:" + a + "px; border:" + d + "; z-index:" + c + "; position:absolute; overflow:hidden'>"
    },
    _registEvents: function() {
        this.addListener(DNA.JWTEvent.MOUSEDOWN, this._doControlMouseDown);
        this.addListener(DNA.JWTEvent.RESIZE, this._doResizeRefresh);
        this.addListener(DNA.JWTEvent.DRAGOVER, this._doDragOver);
        this.addListener(DNA.JWTEvent.DRAGSTART, this._doDragStart);
        this.addListener(DNA.JWTEvent.DRAGOUT, this._doDragOut);
        var a = DNA.engine.application.getJWTEventMgr();
        a.addListener(DNA.JWTEvent.MOUSEUP, this._onGlobalTableMouseUp, this);
        a.addListener(DNA.JWTEvent.MOUSEMOVE, this._onTableMouseMove, this);
        a.addListener(DNA.JWTEvent.MOUSEDOWN, this._onTableGlobalMouseDown, this);
        DNA.widget.TableLayoutPanel.superclass._registEvents.call(this)
    },
    _doControlMouseDown: new DNA.engine.Action({
        handle: function(a) {
            if (this.resizeFlag === true) {
                a.preventDefault()
            }
        }
    }),
    _doDragStart: new DNA.engine.Action({
        handle: function(a) {
            if (this.resizeFlag || this.mouseDownOnGridFlag) {
                this.canBeDragTarget = false;
                a.doit = false;
                return
            }
            this.canBeDragTarget = true
        }
    }),
    _doWhenChildDragStart: function(a) {
        if (this.resizeFlag) {
            a.doit = false
        }
    },
    _doResizeRefresh: new DNA.engine.Action({
        handle: function() {
            this.getLayout().layout(this, true);
            this.onPaint()
        }
    }),
    _checkMouseDragOut: function(a) {
        if (a.x <= 0 || a.y <= 0) {
            return true
        }
        return false
    },
    setDragEffectDirections: function(b) {
        this._dragEffectDirections = b;
        var a = this._getTablePanelDragPosProxy();
        if (a) {
            a._setDragEffectDirections(b)
        }
    },
    getDragEffectDirections: function() {
        var a = this._dragEffectDirections;
        if (!a) {
            a = this._dragEffectDirections = this.getInitData(DNA.JWTProperty.DESIGNER_TABLE_DRAGOVEREFFECT_DIRECTIONS);
            if (a == undefined) {
                a = this._dragEffectDirections = -1
            }
        }
        return a
    },
    setTableCellsDragEffect: function(a) {
        this._dragEffect2DArray = a
    },
    getTableCellsDragEffect: function() {
        var a = this._dragEffect2DArray;
        if (!a) {
            a = this._dragEffect2DArray = this.getInitData(DNA.JWTProperty.DESIGNER_TABLE_DRAGOVEREFFECT_ARRAY);
            delete this._initData[DNA.JWTProperty.DESIGNER_TABLE_DRAGOVEREFFECT_ARRAY]
        }
        return a
    },
    isGridSupportDrag: function(d, a) {
        var c = true;
        var b = this.getTableCellsDragEffect();
        if (b && a < b.length && d < b[0].length) {
            c = b[a][d]
        }
        return c
    },
    _doDragOver: new DNA.engine.Action({
        handle: function(m) {
            this.showGrids();
            var g = this.getLayout();
            if (!g) {
                return
            }
            if (this.resizeFlag || !this.canBeDragTarget) {
                m.doit = false;
                return
            }
            this.removeDivsByName(this.tablepanelselectgrid);
            if (!g.realColumnWidths) {
                g.layout(this, true)
            }
            var z = m.getXY();
            var h = DNA.engine.DomUtil.getPageXY(this.getEl());
            var c = {
                x: z.x - h.x,
                y: z.y - h.y
            };
            var u = this.getDropPosition(c.x, c.y);
            if (u.y > g.getColumnCount() - 1) {
                u.y = g.getColumnCount() - 1
            }
            if (u.x > g.getRowCount() - 1) {
                u.x = g.getRowCount() - 1
            }
            var b = m.getSrcElement();
            var n = this._isDragPosProxyDom(b);
            if (!n && !this.isGridSupportDrag(u.y, u.x)) {
                m.doit = false;
                this._clearDragPosProxy();
                return
            }
            if (n) {
                var q = this._getTablePanelDragPosProxy();
                if (n) {
                    q.highLight(b)
                } else {
                    q.clearHighLight()
                }
                var d = q.getCurrentDragPosBitValue();
                if (parseInt(d) && this.posInfo) {
                    var o = this.posInfo.split(",");
                    this.posInfo = o[0] + "," + o[1] + "," + d;
                    return
                }
            }
            this.posInfo = u.y + "," + u.x;
            var v = g.getTableCellInfo(u.y, u.x);
            if (v == null ) {
                return
            }
            var t = this.getXForCol(u.y);
            var s = this.getYForRow(u.x);
            var a = this.getXForCol(u.y + v.columnSpan);
            var r = this.getYForRow(u.x + v.rowSpan);
            this.removeDivsByName("dragPos");
            if (DNA.engine.Client.isStrict()) {
                var w = new DNA.widget.Rectangle((t + this.getHOffset()),(s + this.getVOffset()),(a - t - 2),(r - s))
            } else {
                var w = new DNA.widget.Rectangle((t + this.getHOffset()) + 1,(s + this.getVOffset()) + 2,(a - t),(r - s))
            }
            if (this.checkStyleDragPos()) {
                var q = this._getTablePanelDragPosProxy();
                w.x += h.x;
                w.y += h.y;
                q.showProxy(w)
            } else {
                this.drawDragPosDom(w.x, w.y, w.width, w.height)
            }
        }
    }),
    _doDragOut: new DNA.engine.Action({
        handle: function(b) {
            if (this.canBeDragTarget) {
                var a = this._getTablePanelDragPosProxy();
                if (a) {
                    a.setVisible(false)
                } else {
                    this.removeDivsByName("dragPos")
                }
            }
        }
    }),
    drawDragPosDom: function(g, d, b, a) {
        var c = {
            id: "dragPos",
            name: "dragPos",
            style: {
                left: g + "px",
                top: d + "px",
                width: b + "px",
                height: a + "px",
                border: "2px solid #FF0000",
                "z-index": 1000,
                position: "absolute",
                overflow: "hidden"
            }
        };
        DNA.engine.DomUtil.insertFirst(this.getEl(), DNA.widget.TagBuilder.buildSingleDivStr(c))
    },
    getDropPosition: function(b, g) {
        var d = this.getRowForY(g);
        var c = this.getColumnForX(b);
        var a = this.belongToCell(d, c);
        return a
    },
    _clearDragPosProxy: function() {
        var a = this._getTablePanelDragPosProxy();
        if (a) {
            a.setVisible(false)
        }
    },
    checkStyleDragPos: function() {
        return this.getDragEffectDirections() !== -1
    },
    _getTablePanelDragPosProxy: function() {
        if (!this._tablePanelDragPosProxy) {
            this._tablePanelDragPosProxy = new DNA.widget.TablePanelDragPosProxy(this.getEid(),this.getDragEffectDirections())
        }
        return this._tablePanelDragPosProxy
    },
    _isDragPosProxyDom: function(a) {
        return DNA.widget.DragProxy.isDragPosProxyDom(a)
    },
    _handleDragPosProxyHighLight: function(a) {
        if (this._isDragPosProxyDom(a)) {
            this._getTablePanelDragPosProxy().highLight(a)
        } else {
            this._getTablePanelDragPosProxy().clearHighLight()
        }
    },
    _onTableMouseMove: new DNA.engine.PreventableAction({
        handle: function(C) {
            var n = C.getSrcElement();
            if (!this.isEditable()) {
                return
            }
            if (this.dragOverFlag) {
                return
            }
            var v = this.getLayout();
            if (!v.realColumnWidths) {
                v.layout(this, true)
            }
            var h = C.getXY();
            var r = DNA.engine.DomUtil.getPageXY(this.getEl());
            r = {
                x: h.x - r.x,
                y: h.y - r.y
            };
            if (r.x < 0) {
                r.x = 0
            }
            if (r.y < 0) {
                r.y = 0
            }
            var q = C.getSrcControl();
            if (!this.mouseDownOnGridFlag) {
                if (this.mouseInAnySpanCell(r.x, r.y)) {
                    q._setCursor("default");
                    this.resizeFlag = false
                } else {
                    if (((this.resizeRowIndex >= 0) || (this.getRowForResize(r.x, r.y) >= 0)) && this.isResizable()) {
                        q._setCursor("n-resize");
                        this.resizeFlag = true
                    } else {
                        if (((this.resizeColumnIndex >= 0) || (this.getColumnForResize(r.x, r.y) >= 0)) && this.isResizable()) {
                            q._setCursor("e-resize");
                            this.resizeFlag = true
                        } else {
                            if (q) {
                                q._setCursor("default");
                                this.resizeFlag = false
                            }
                        }
                    }
                }
                return
            }
            if (this.resizeFlag) {
                if (this.resizeRowIndex >= 0) {
                    this.resizeEffect = true;
                    this.newRowSize = r.y - this.resizeRowTop;
                    if (this.newRowSize < this.minRowHeight) {
                        this.newRowSize = this.minRowHeight
                    }
                    var d = v.getRowHeight(this.resizeRowIndex);
                    if (this.resizeRowIndex != v.getRowCount() - 1) {
                        var b = v.getRowHeight(this.resizeRowIndex + 1);
                        if (this.newRowSize > (d + b - this.minRowHeight)) {
                            this.newRowSize = d + b - this.minRowHeight
                        }
                    }
                    var A = this.getTotalWidth();
                    lineX = 0;
                    lineY = this.resizeRowTop + this.newRowSize;
                    this.removeDivsByName(this.lineid);
                    this.drawChangeRowDom((lineY + this.getVOffset()), A)
                }
                if (this.resizeColumnIndex >= 0) {
                    this.resizeEffect = true;
                    this.newColumnSize = r.x - this.resizeColumnLeft;
                    if (this.newColumnSize < this.minColWidth) {
                        this.newColumnSize = this.minColWidth
                    }
                    var o = v.getColumnWidth(this.resizeColumnIndex);
                    if (this.resizeColumnIndex != v.getColumnCount() - 1) {
                        var B = v.getColumnWidth(this.resizeColumnIndex + 1);
                        if (this.newColumnSize > (o + B - this.minColWidth)) {
                            this.newColumnSize = o + B - this.minColWidth
                        }
                    }
                    var A = this.getTotalHeight();
                    lineX = this.resizeColumnLeft + this.newColumnSize;
                    lineY = 0;
                    this.removeDivsByName(this.lineid);
                    this.drawChangeColDom((lineX + this.getHOffset()), A)
                }
                return
            }
            if (!this.isSelectionEnable()) {
                return
            }
            if (this.selectionCells.getKeys().length == 0) {
                return
            }
            if (!this.startPoint) {
                var z = this.getRowForY(r.y);
                var t = this.getColumnForX(r.x);
                this.startPoint = this.belongToCell(z, t)
            }
            var m = this.getRowForY(r.y);
            var g = this.getColumnForX(r.x);
            var u = this.belongToCell(m, g);
            if (this.lastPoint.x === u.x && this.lastPoint.y === u.y) {
                return
            }
            this.lastPoint.x = u.x;
            this.lastPoint.y = u.y;
            this.drawSelectionCellsBack();
            this.selectionCells.clear();
            var a = this.startPoint.x <= u.x ? this.startPoint.x : u.x;
            var D = this.startPoint.y <= u.y ? this.startPoint.y : u.y;
            var w = this.startPoint.x > u.x ? this.startPoint.x : u.x;
            var s = this.startPoint.y > u.y ? this.startPoint.y : u.y;
            var c = v.getTableCellInfo(a, D);
            this.setSelectionCells(a, D, w, s);
            this.drawSelectionCells()
        }
    }),
    drawChangeRowDom: function(c, b) {
        var a = {
            id: this.lineid,
            name: this.lineid,
            style: {
                left: "0px",
                top: c + "px",
                width: b + "px",
                height: "1px",
                "border-top": "1px dashed #000000",
                "z-index": 999,
                position: "absolute",
                overflow: "hidden"
            }
        };
        DNA.engine.DomUtil.insertFirst(this.getEl(), DNA.widget.TagBuilder.buildSingleDivStr(a))
    },
    drawChangeColDom: function(b, a) {
        var c = {
            id: this.lineid,
            name: this.lineid,
            style: {
                left: b + "px",
                top: "0px",
                width: "1px",
                height: a + "px",
                "border-left": "1px dashed #000000",
                "z-index": 999,
                position: "absolute",
                overflow: "hidden"
            }
        };
        DNA.engine.DomUtil.insertFirst(this.getEl(), DNA.widget.TagBuilder.buildSingleDivStr(c))
    },
    _doMouseOver: new DNA.engine.Action({
        handle: function(a) {}
    }),
    _onTableGlobalMouseOver: new DNA.engine.Action({
        handle: function(a) {
            if (this.isAncestorOf(a.getSrcControl())) {} else {}
        }
    }),
    _onTableBubbleMouseOver: new DNA.engine.Action({
        handle: function(a) {}
    }),
    _onGlobalTableMouseUp: new DNA.engine.AppSuspendedAction({
        handle: function(b) {
            this.hideGrids();
            this._clearDragPosProxy();
            if (this.mouseDownOnGridFlag && !this.resizeFlag) {
                this.fireEvent("selection", [this])
            }
            this.removeDivsByName("dragPos");
            this.canBeDragTarget = true;
            this.mouseDownOnGridFlag = false;
            this.startPoint = null ;
            this.lastPoint = {
                x: -1,
                y: -1
            };
            if (!this.resizeEffect) {
                this.resizeRowIndex = -1;
                this.resizeColumnIndex = -1;
                return
            }
            this.resizeEffect = false;
            if (this.resizeRowIndex >= 0) {
                var c = this.resizeRowIndex;
                this.resizeRowIndex = -1;
                this.processNewRowHeight(c, this.newRowSize);
                this.newRowSize = 0;
                this.getLayout().layout(this, true);
                this.fireEvent("rowresize", [this]);
                this.onPaint()
            }
            if (this.resizeColumnIndex >= 0) {
                var a = this.resizeColumnIndex;
                this.resizeColumnIndex = -1;
                this.processNewColumnWidth(a, this.newColumnSize);
                this.newColumnSize = 0;
                this.getLayout().layout(this, true);
                this.fireEvent("columnresize", [this]);
                this.onPaint()
            }
            this.removeDivsByName(this.lineid)
        }
    }),
    _onTableGlobalMouseDown: new DNA.engine.Action({
        handle: function(h) {
            if (!this.isEditable() || h.isCtrl()) {
                return
            }
            var l = h.getSrcElement();
            if (this.isDragResizeDom(l)) {
                return
            }
            var b = h.getSrcControl();
            if (!this.isAncestorOf(b)) {
                return
            }
            this.mouseDownOnGridFlag = true;
            var g = h.getXY();
            var d = DNA.engine.DomUtil.getPageXY(this.getEl());
            d = {
                x: g.x - d.x,
                y: g.y - d.y
            };
            if (!this.getLayout().realColumnWidths) {
                this.getLayout().layout(this, true)
            }
            if (this.resizeFlag) {
                if (!this.mouseInAnySpanCell(d.x, d.y)) {
                    var m = this.getRowForResize(d.x, d.y);
                    if (m >= 0) {
                        this.resizeRowIndex = m;
                        this.resizeRowTop = this.getRowTop(m);
                        this.newRowSize = this.getLayout().getRowHeight(m);
                        return
                    }
                    var c = this.getColumnForResize(d.x, d.y);
                    if (c >= 0) {
                        this.resizeColumnIndex = c;
                        this.resizeColumnLeft = this.getColumnLeft(c);
                        this.newColumnSize = this.getLayout().getColumnWidth(c);
                        return
                    }
                }
                return
            }
            if (!this.isSelectionEnable()) {
                return
            }
            if (b != this) {
                this.selectionCells.clear();
                this.removeDivsByName(this.tablepanelselectgrid);
                return
            }
            if (!this.mouseInAnySelectionCell(d.x, d.y)) {
                this.selectionCells.clear();
                if (this.resizeRowIndex == -1 && this.resizeColumnIndex == -1) {
                    var a = this._getCellByRelativeCoordinate(d);
                    this._setSelectionCell(a);
                    this.fireEvent("selection", [this]);
                    this.drawSelectionCells();
                    return
                }
            }
            if (this.mouseInAnySelectionCell(d.x, d.y) && this.selectionCells.getKeys().length !== 1) {
                if (this.resizeRowIndex == -1 && this.resizeColumnIndex == -1) {
                    this.selectionCells.clear();
                    this.removeDivsByName(this.tablepanelselectgrid);
                    var a = this._getCellByRelativeCoordinate(d);
                    this._setSelectionCell(a);
                    this.fireEvent("selection", [this]);
                    this.drawSelectionCells()
                }
            }
        }
    }),
    _handleLeftKeyDown: function(a, b) {
        this.posInfo = null 
    },
    _handleRightKeyDown: function(a, b) {
        this.posInfo = null 
    },
    _handleUpKeyDown: function(a, b) {
        this.posInfo = null 
    },
    _handleDownKeyDown: function(a, b) {
        this.posInfo = null 
    },
    _setSelectionCell: function(a) {
        var b = this.getLayout().getTableCellInfo(a.y, a.x);
        if (b != null ) {
            this.selectionCells.set("{x : " + a.x + ",y : " + a.y + "}", b)
        }
    },
    _getCellByRelativeCoordinate: function(b) {
        var c = this.getRowForY(b.y);
        var a = this.getColumnForX(b.x);
        return this.belongToCell(c, a)
    },
    belongToCell: function(l, b) {
        var h = new DNA.widget.Point(l,b);
        var d = this.getLayout().getTableCellInfo(b, l);
        if (d == null ) {
            return h
        } else {
            if (!d.isSpan) {
                return h
            } else {
                for (var c = l; c >= 0; c--) {
                    for (var a = b; a >= 0; a--) {
                        var g = this.getLayout().getTableCellInfo(a, c);
                        if (g != null  && (!g.isSpan) && (c + g.rowSpan) > l && (a + g.columnSpan) > b) {
                            return new DNA.widget.Point(c,a)
                        }
                    }
                }
                return new DNA.widget.Point(-1,-1)
            }
        }
    },
    drawSelectionCellsBack: function() {
        if (this.selectionCells == null  || this.selectionCells.getKeys().length == 0) {
            return
        }
        this.removeDivsByName(this.tablepanelselectgrid)
    },
    setSelectionCells: function(r, a, c, m) {
        if (c < r || m < a) {
            return
        }
        var q = r;
        var l = a;
        var o = c;
        var h = m;
        for (var d = r; d <= c; d++) {
            for (var b = a; b <= m; b++) {
                var n = this.belongToCell(d, b);
                var p = this.getLayout().getTableCellInfo(n.y, n.x);
                if (p == null ) {
                    continue
                }
                if (n.x < q) {
                    q = n.x
                }
                if (n.y < l) {
                    l = n.y
                }
                if ((n.x + p.rowSpan) > o) {
                    o = n.x + p.rowSpan
                }
                if ((n.y + p.columnSpan) > h) {
                    h = n.y + p.columnSpan
                }
            }
        }
        var g = 0;
        for (var d = q; d < o; d++) {
            for (var b = l; b < h; b++) {
                var p = this.getLayout().getTableCellInfo(b, d);
                if (p != null  && (!p.isSpan)) {
                    g++;
                    this.selectionCells.set("{x : " + d + ",y : " + b + "}", p)
                }
            }
        }
    },
    mouseInAnySelectionCell: function(x, y) {
        if (this.selectionCells.getKeys().length == 0) {
            return false
        }
        var key = this.selectionCells.getKeys();
        for (var i = 0; i < key.length; i++) {
            var point = key[i];
            var cell = this.selectionCells.get(point);
            point = eval("(" + point + ")");
            var x1 = this.getXForCol(point.y);
            var y1 = this.getYForRow(point.x);
            var x2 = this.getXForCol(point.y + cell.columnSpan);
            var y2 = this.getYForRow(point.x + cell.rowSpan);
            if (x > x1 && x < x2 && y > y1 && y < y2) {
                return true
            }
        }
        return false
    },
    mouseInAnySpanCell: function(m, h) {
        for (var d = 0; d < this.getLayout().getRowCount(); d++) {
            for (var c = 0; c < this.getLayout().getColumnCount(); c++) {
                var n = this.getLayout().getTableCellInfo(c, d);
                if (n.isSpan) {
                    continue
                }
                if (n.columnSpan == 1 && n.rowSpan == 1) {
                    continue
                }
                var b = this.getXForCol(c);
                var l = this.getYForRow(d);
                var a = this.getXForCol(c + n.columnSpan);
                var g = this.getYForRow(d + n.rowSpan);
                if (m > (b + 3) && m < (a - 3) && h > (l + 3) && h < (g - 3)) {
                    return true
                }
            }
        }
        return false
    },
    getRowForResize: function(a, c) {
        if (a < (this.getTotalWidth() + 3) && c < (this.getTotalHeight() - this.getVOffset() + 3)) {
            for (var b = 0; b < this.getLayout().getRowCount() - 1; b++) {
                if (c >= (this.getRowBottom(b) - this.resizeAreaSize / 2) && c <= (this.getRowBottom(b) + this.resizeAreaSize / 2)) {
                    return b
                }
            }
        }
        return -1
    },
    getColumnForResize: function(a, c) {
        if (a < (this.getTotalWidth() + 3) && c < (this.getTotalHeight() - this.getVOffset() + 3)) {
            for (var b = 0; b < this.getLayout().getColumnCount() - 1; b++) {
                if (a >= (this.getColumnRight(b) - this.resizeAreaSize / 2) && a <= (this.getColumnRight(b) + this.resizeAreaSize / 2)) {
                    return b
                }
            }
        }
        return -1
    },
    getColumnLeft: function(b) {
        if (b < 0) {
            return -1
        }
        if (b >= this.getLayout().getColumnCount()) {
            return getTotalWidth()
        }
        var c = 0;
        for (var a = 0; a < b; a++) {
            c += this.getLayout().getColumnWidth(a)
        }
        return c - this.getHOffset()
    },
    getColumnRight: function(a) {
        if (a < 0) {
            return 0
        }
        if (a >= this.getLayout().getColumnCount() - 1) {
            return this.getTotalWidth()
        }
        return this.getColumnLeft(a) + this.getLayout().getColumnWidth(a)
    },
    getRowTop: function(c) {
        if (c < 0) {
            return -1
        }
        if (c >= this.getLayout().getRowCount()) {
            return this.getTotalHeight() - this.getVOffset()
        }
        var b = 0;
        for (var a = 0; a < c; a++) {
            b += this.getLayout().getRowHeight(a)
        }
        return b - this.getVOffset()
    },
    getTotalHeight: function() {
        var b = 0;
        for (var a = 0; a < this.getLayout().getRowCount(); a++) {
            b += this.getLayout().getRowHeight(a)
        }
        return b
    },
    getTotalWidth: function() {
        var b = 0;
        for (var a = 0; a < this.getLayout().getColumnCount(); a++) {
            b += this.getLayout().getColumnWidth(a)
        }
        return b
    },
    getRowTop: function(c) {
        if (c < 0) {
            return -1
        }
        if (c >= this.getLayout().getRowCount()) {
            return this.getTotalHeight() - this.getVOffset()
        }
        var b = 0;
        for (var a = 0; a < c; a++) {
            b += this.getLayout().getRowHeight(a)
        }
        return b - this.getVOffset()
    },
    getRowBottom: function(a) {
        if (a < 0) {
            return 0
        }
        if (a > this.getLayout().getRowCount() - 1) {
            return this.getTotalHeight()
        }
        return this.getRowTop(a) + this.getLayout().getRowHeight(a)
    },
    getYForRow: function(b) {
        if (b == 0) {
            return ( 0 - this.getVOffset()) 
        }
        var c = this.getLayout().getRowHeight(0);
        for (var a = 1; a < b; a++) {
            c += this.getLayout().getRowHeight(a)
        }
        return ( c - this.getVOffset()) 
    },
    getXForCol: function(b) {
        if (b == 0) {
            return ( 0 - this.getHOffset()) 
        }
        var a = this.getLayout().getColumnWidth(0);
        for (var c = 1; c < b; c++) {
            a += this.getLayout().getColumnWidth(c)
        }
        return ( a - this.getHOffset()) 
    },
    getRowForY: function(d) {
        if (d == 0) {
            return 0
        }
        var b = 0;
        for (var c = 0; c < this.getLayout().getRowCount(); c++) {
            var a = this.getLayout().getRowHeight(c);
            if (b < (d + this.getVOffset()) && (b + a) >= (d + this.getVOffset())) {
                return c
            }
            b += a
        }
        return this.getLayout().getRowCount()
    },
    getColumnForX: function(a) {
        if (a == 0) {
            return 0
        }
        var c = 0;
        for (var b = 0; b < this.getLayout().getColumnCount(); b++) {
            var d = this.getLayout().getColumnWidth(b);
            if (c < (a + this.getHOffset()) && (c + d) >= (a + this.getHOffset())) {
                return b
            }
            c += d
        }
        return this.getLayout().getColumnCount()
    },
    getVOffset: function() {
        return this.getEl().scrollTop
    },
    getHOffset: function() {
        return this.getEl().scrollLeft
    },
    removeDivsByName: function(d) {
        var c = this.getEl().ownerDocument.getElementsByName(d);
        if (!c) {
            return
        }
        var a = -1;
        for (var b = 0; b < c.length; ) {
            a = c.length;
            if (!c[0].parentNode) {
                continue
            }
            c[0].parentNode.removeChild(c[0]);
            if (a == c.length) {
                return
            }
        }
    },
    getTablePanelGrid: function() {
        return this.getEl().ownerDocument.getElementsByName(this.tablepanelgridid)
    },
    clearInnnerGrids: function() {
        this.removeDivsByName(this.tablepanelgridid)
    },
    hideGrids: function() {
        if (this.getDragEffectDirections() === -1) {
            return
        }
        if (this.showGridsFlag === true) {
            this.showGridsFlag = false;
            DNA.engine.DomUtil.setVisible(this.gridsParent, false)
        }
    },
    showGrids: function() {
        if (this.gridsParent && this.showGridsFlag === false) {
            this.showGridsFlag = true;
            DNA.engine.DomUtil.setVisible(this.gridsParent, true)
        }
    },
    onPaint: function() {
        var c = this.getLayout();
        if (c) {
            this.clearInnnerGrids();
            var o = 0
              , n = 0;
            var a = 0;
            var q = 0;
            if (!c.realColumnWidths) {
                c.layout(this, true)
            }
            for (var h = 0; h < c.cellInfos[0].length; h++) {
                for (var g = 0; g < c.cellInfos.length; g++) {
                    var p = c.cellInfos[g][h];
                    for (var b = 0; b < p.rowSpan; b++) {
                        q += c.getRowHeight(g + b);
                        if (g + b >= c.cellInfos.length - 1) {
                            q -= 1
                        }
                    }
                    for (var d = 0; d < p.columnSpan; d++) {
                        a += c.getColumnWidth(h + d);
                        if (h + d >= c.cellInfos[0].length - 1) {
                            a -= 1
                        }
                    }
                    if (!p.isSpan && this.isGridSupportDrag(h, g)) {
                        if (DNA.engine.Client.isStrict()) {
                            a -= 1;
                            q -= 1
                        }
                        this.drawGridDom(n, o, a, q)
                    }
                    o += c.getRowHeight(g);
                    a = 0;
                    q = 0
                }
                o = 0;
                n += c.getColumnWidth(h)
            }
            this.drawSelectionCells()
        }
    },
    drawGridDom: function(l, h, c, a) {
        var b = {
            id: this.tablepanelgridid,
            name: this.tablepanelgridid,
            style: {
                left: l + "px",
                top: h + "px",
                width: c + "px",
                height: a + "px",
                "border-style": "dashed",
                "border-color": "#5C5C5C",
                "border-width": "0 1px 1px 0",
                position: "absolute",
                overflow: "hidden"
            }
        };
        if (!this.gridsParent) {
            var g = this.getBounds();
            var d = {
                id: this.tablepanelgridid + "_parent",
                style: {
                    width: "100%",
                    height: "100%",
                    "border-style": "dashed",
                    "border-color": "#5C5C5C",
                    "border-width": "1px 0 0 1px",
                    position: "absolute"
                }
            };
            d[DNA.widget.AbstractLayoutPanel.INNER_EFFECT_DOM_ID] = "e";
            this.gridsParent = DNA.engine.DomUtil.insertFirst(this.getEl(), DNA.widget.TagBuilder.buildSingleDivStr(d))
        }
        DNA.engine.DomUtil.insertFirst(this.gridsParent, DNA.widget.TagBuilder.buildSingleDivStr(b))
    },
    drawSelectionCells: function() {
        if (!this.selectionCells || this.selectionCells.getKeys().length === 0) {
            return
        }
        var key = this.selectionCells.getKeys();
        this.removeDivsByName(this.tablepanelselectgrid);
        var boundsMinX = Number.MAX_VALUE;
        var boundsMinY = Number.MAX_VALUE;
        var boundsMaxX = Number.MIN_VALUE;
        var boundsMaxY = Number.MIN_VALUE;
        for (var i = 0; i < key.length; i++) {
            var point = key[i];
            var cell = this.selectionCells.get(point);
            point = eval("(" + point + ")");
            var row = point.x;
            var col = point.y;
            var x1 = this.getXForCol(col);
            var y1 = this.getYForRow(row);
            var x2 = this.getXForCol(col + cell.columnSpan);
            var y2 = this.getYForRow(row + cell.rowSpan);
            if (x1 <= boundsMinX) {
                boundsMinX = x1
            }
            if (y1 <= boundsMinY) {
                boundsMinY = y1
            }
            if (x2 > boundsMaxX) {
                boundsMaxX = x2
            }
            if (y2 > boundsMaxY) {
                boundsMaxY = y2
            }
        }
        DNA.engine.DomUtil.insertFirst(this.getEl(), "<div id=" + this.tablepanelselectgrid + " name=" + this.tablepanelselectgrid + " style='top: " + (boundsMinY + this.getVOffset()) + "px; left: " + (boundsMinX + this.getHOffset()) + "px; width: " + (boundsMaxX - boundsMinX) + "px; height: " + (boundsMaxY - boundsMinY) + "px; border:2px solid #3333FF; position: absolute; '>")
    },
    getSelection: function() {
        if (!this.selectionCells || this.selectionCells.getKeys().length === 0) {
            return null 
        }
        var boundsMinX = 18014398509481984;
        var boundsMinY = 18014398509481984;
        var boundsMaxX = -1;
        var boundsMaxY = -1;
        var key = this.selectionCells.getKeys();
        for (var i = 0; i < key.length; i++) {
            var point = key[i];
            var cell = this.selectionCells.get(point);
            point = eval("(" + point + ")");
            if (point.x < boundsMinX) {
                boundsMinX = point.x
            }
            if (point.y < boundsMinY) {
                boundsMinY = point.y
            }
            if (point.x + cell.rowSpan > boundsMaxX) {
                boundsMaxX = point.x + cell.rowSpan
            }
            if (point.y + cell.columnSpan > boundsMaxY) {
                boundsMaxY = point.y + cell.columnSpan
            }
        }
        return new DNA.widget.Rectangle(boundsMinY,boundsMinX,boundsMaxY - boundsMinY,boundsMaxX - boundsMinX)
    },
    processNewColumnWidth: function(g, h) {
        var d = this.getLayout().getColumnType();
        if (this.getLayout().getWidthType() === this.getLayout().DEFAULT) {
            this.getLayout().setColumnWidth(g, h);
            return
        }
        var b = this.getLayout().getColumnWidth(g);
        var a = this.getTotalWidth();
        if (g < this.getLayout().getColumnCount() - 1) {
            var c = this.getLayout().getColumnWidth(g + 1);
            c = b + c - h;
            this.setColumnWidthWithType(g, h, a, d[g]);
            this.setColumnWidthWithType(g + 1, c, a, d[g + 1])
        } else {
            this.setColumnWidthWithType(g, h, a, d[g])
        }
    },
    processNewRowHeight: function(h, a) {
        var d = this.getLayout().getRowType();
        if (this.getLayout().getHeightType() === this.getLayout().DEFAULT) {
            this.getLayout().setRowHeight(h, a);
            return
        }
        var g = this.getLayout().getRowHeight(h);
        var c = this.getTotalHeight();
        if (h < this.getLayout().getRowCount() - 1) {
            var b = this.getLayout().getRowHeight(h + 1);
            b = g + b - a;
            this.setRowHeightWithType(h, a, c, d[h]);
            this.setRowHeightWithType(h + 1, b, c, d[h + 1])
        } else {
            this.setRowHeightWithType(h, a, c, d[h])
        }
    },
    setColumnWidthWithType: function(c, d, a, b) {
        if (b === this.getLayout().PERCENT) {
            this.getLayout().setColumnWidth(c, d / a)
        } else {
            if (b === this.getLayout().DEFAULT) {
                this.getLayout().setColumnWidth(c, 0)
            } else {
                this.getLayout().setColumnWidth(c, d)
            }
        }
    },
    setRowHeightWithType: function(d, a, b, c) {
        if (c === this.getLayout().PERCENT) {
            this.getLayout().setRowHeight(d, a / b)
        } else {
            if (c === this.getLayout().DEFAULT) {
                this.getLayout().setRowHeight(d, 0)
            } else {
                this.getLayout().setRowHeight(d, a)
            }
        }
    },
    setEditable: function(a) {
        this.editable = a
    },
    isEditable: function() {
        var a = this.editable;
        if (a == undefined) {
            this.editable = this.getInitData(DNA.JWTProperty.DESIGNER_TABLE_EDITABLE);
            a = this.editable = this.editable == undefined ? true : this.editable;
            delete this._initData[DNA.JWTProperty.DESIGNER_TABLE_EDITABLE]
        }
        return a
    },
    setResizable: function(a) {
        this.resizable = a
    },
    isResizable: function() {
        if (this.resizable == undefined) {
            this.resizaable = this.getInitData(DNA.JWTProperty.DESIGNER_TABLE_RESIZABLE);
            this.resizable = (this.resizable == undefined ? true : this.resizable);
            delete this._initData[DNA.JWTProperty.DESIGNER_TABLE_RESIZABLE]
        }
        return this.resizable
    },
    setSelectionEnable: function(a) {
        this.selectable = a;
        this.selectionCells.clear();
        this.removeDivsByName(this.tablepanelselectgrid)
    },
    isSelectionEnable: function() {
        var a = this.selectable;
        if (a == undefined) {
            this.selectable = this.getInitData(DNA.JWTProperty.DESIGNER_TABLE_SELECTIONENABLE);
            a = this.selectable = this.selectable == undefined ? true : this.selectable;
            delete this._initData[DNA.JWTProperty.DESIGNER_TABLE_SELECTIONENABLE]
        }
        return a
    },
    setLayout: function(layout) {
        if (typeof (layout) == "string") {
            this._layout = eval("(" + layout + ")")
        } else {
            DNA.widget.TableLayoutPanel.superclass.setLayout.call(this, layout)
        }
    },
    _removeFlowHtml: function() {
        if (this._tablePanelDragPosProxy) {
            this._tablePanelDragPosProxy.dispose()
        }
    },
    doDispose: function() {
        DNA.widget.TableLayoutPanel.superclass.doDispose.call(this);
        delete this.gridsParent;
        delete this.uniqueDiv;
        delete this.selectionCells;
        delete this._dragEffectDirections;
        delete this._tablePanelDragPosProxy
    }
});
Object.override(DNA.widget.TableLayoutPanel.prototype, {
    jtype: "TableLayoutPanel",
    focusable: true
});
DNA.widget.DragProxy = function() {}
;
DNA.widget.DragProxy.extend(DNA.engine.JWTObject, {
    setVisible: function(a) {
        DNA.engine.DomUtil.setVisible(DNA.widget.DragProxy.getDragProxyRootDom(), a)
    }
});
Object.override(DNA.widget.DragProxy, {
    _proxyRootDom: null ,
    getDragProxyRootDom: function(c, b) {
        if (this._proxyRootDom == null ) {
            this._proxyRootDom = DNA.engine.DomUtil.append(DNA.engine.application.getBrowserBody(), '<div id="dragPosProxyRoot" style="position:absolute;overflow:hidden"></div>')
        }
        var a = DNA.engine.application.getTopWindowZIndexAnd1();
        this._proxyRootDom.style.zIndex = a;
        return this._proxyRootDom
    },
    isDragPosProxyDom: function(b) {
        var a;
        if (!this._proxyRootDom) {
            a = false
        } else {
            a = (b != this._proxyRootDom && DNA.engine.DomUtil.isChildren(b, this._proxyRootDom, 5))
        }
        return a
    }
});
DNA.widget.TablePanelDragPosProxy = function(b, a) {
    DNA.widget.TablePanelDragPosProxy.superclass.constructor.call(this);
    this._id = b;
    this._style = a;
    this._highLightDom = null ;
    this._domArray = []
}
;
DNA.widget.TablePanelDragPosProxy.PROXY_WIDTH = 15;
DNA.widget.TablePanelDragPosProxy.LEFT = 14;
DNA.widget.TablePanelDragPosProxy.TOP_LEFT = 5;
DNA.widget.TablePanelDragPosProxy.TOP = 7;
DNA.widget.TablePanelDragPosProxy.TOP_RIGHT = 6;
DNA.widget.TablePanelDragPosProxy.RIGHT = 17;
DNA.widget.TablePanelDragPosProxy.BOTTOM_RIGHT = 4;
DNA.widget.TablePanelDragPosProxy.BOTTOM = 10;
DNA.widget.TablePanelDragPosProxy.BOTTOM_LEFT = 3;
DNA.widget.TablePanelDragPosProxy.BOTTOM_CENTER = 0;
DNA.widget.TablePanelDragPosProxy.POS_PROXY_BORDER_COLOR = "rgb(0,196,0)";
DNA.widget.TablePanelDragPosProxy.POS_PROXY_HIGHLIGHT_BACK_COLOR = "rgb(255,255,0)";
DNA.widget.TablePanelDragPosProxy.POS_PROXY_BACK_COLOR = "rgb(196,255,196)";
DNA.widget.TablePanelDragPosProxy.POS_PROXY_CENTER_BACK_COLOR = "rgb(96,255,96)";
DNA.widget.TablePanelDragPosProxy.POS_PROXY_WIDTH_SEIZE_PROPORTION = 0.2;
DNA.widget.TablePanelDragPosProxy.extend(DNA.widget.DragProxy, {
    setVisible: function(a) {
        if (this._domArray) {
            for (var b = 0; b < this._domArray.length; b++) {
                if (this._domArray[b]) {
                    DNA.engine.DomUtil.setVisible(this._domArray[b], a)
                }
            }
        }
        DNA.widget.TablePanelDragPosProxy.superclass.setVisible.call(this, a)
    },
    containsStyle: function(b, a) {
        return (b & a) != 0
    },
    removeStyle: function(a, b) {
        return a ^ b
    },
    showProxy: function(a) {
        this._setReferBounds(a);
        this._refresh();
        this.setVisible(true)
    },
    drawDragPosProxyDom: function(g, b) {
        if (!this._domArray[g]) {
            var d = DNA.widget.TablePanelDragPosProxy.POS_PROXY_BACK_COLOR;
            if (g == DNA.widget.TablePanelDragPosProxy.BOTTOM_CENTER) {
                d = DNA.widget.TablePanelDragPosProxy.POS_PROXY_CENTER_BACK_COLOR
            }
            var a = {
                id: this._id,
                name: g,
                style: {
                    left: b.x + "px",
                    top: b.y + "px",
                    width: b.width + "px",
                    height: b.height + "px",
                    border: "1px dashed " + DNA.widget.TablePanelDragPosProxy.POS_PROXY_BORDER_COLOR,
                    "z-index": 1000,
                    position: "absolute",
                    "background-color": d,
                    filter: "alpha(opacity=60)",
                    opacity: 0.6,
                    overflow: "hidden"
                }
            };
            this._domArray[g] = DNA.engine.DomUtil.insertFirst(DNA.widget.DragProxy.getDragProxyRootDom(), DNA.widget.TagBuilder.buildSingleDivStr(a))
        } else {
            var c = this._domArray[g];
            DNA.engine.DomUtil.setStyle(c, "left", b.x + "px");
            DNA.engine.DomUtil.setStyle(c, "top", b.y + "px");
            DNA.engine.DomUtil.setStyle(c, "width", b.width + "px");
            DNA.engine.DomUtil.setStyle(c, "height", b.height + "px")
        }
    },
    getCurrentDragPosBitValue: function() {
        if (!this._highLightDom) {
            return -1
        }
        return this._getDomName(this._highLightDom)
    },
    _getDomName: function(a) {
        if (a) {
            return a.getAttribute("name")
        }
    },
    highLight: function(a) {
        if (a == this._highLightDom) {
            return
        }
        this.clearHighLight();
        DNA.engine.DomUtil.setStyle(a, "backgroundColor", DNA.widget.TablePanelDragPosProxy.POS_PROXY_HIGHLIGHT_BACK_COLOR);
        this._highLightDom = a
    },
    clearHighLight: function() {
        if (this._highLightDom) {
            var a = DNA.widget.TablePanelDragPosProxy.POS_PROXY_BACK_COLOR;
            if (this._getDomName(this._highLightDom) == DNA.widget.TablePanelDragPosProxy.BOTTOM_CENTER) {
                a = DNA.widget.TablePanelDragPosProxy.POS_PROXY_CENTER_BACK_COLOR
            }
            DNA.engine.DomUtil.setStyle(this._highLightDom, "backgroundColor", a)
        }
        delete this._highLightDom
    },
    dispose: function() {
        if (this._domArray) {
            for (var a = 0; a < this._domArray.length; a++) {
                if (this._domArray[a]) {
                    DNA.engine.DomUtil.dispose(this._domArray[a])
                }
            }
            delete this._domArray
        }
    },
    _setReferBounds: function(a) {
        this._referBounds = a
    },
    _getReferBounds: function(a) {
        return this._referBounds
    },
    _handleReferBounds: function(a, b) {
        a.x += b;
        a.y += b;
        a.width -= (b + b);
        a.height -= (b + b);
        return a
    },
    _computeAQuarterOfShortEdgeAsDelta: function(b) {
        var a = b.width > b.height ? b.height : b.width;
        return delta = parseInt(a * DNA.widget.TablePanelDragPosProxy.POS_PROXY_WIDTH_SEIZE_PROPORTION)
    },
    _setDragEffectDirections: function(a) {
        this._style = a
    },
    _refresh: function() {
        var c = this._style;
        var h = this._referBounds;
        var b = 0;
        if (c != 0) {
            var l = this._computeAQuarterOfShortEdgeAsDelta(h);
            h = this._handleReferBounds(h, l);
            b = DNA.widget.TablePanelDragPosProxy.PROXY_WIDTH + l
        }
        var g = null ;
        var a = null ;
        while (c != 0) {
            if (this.containsStyle(c, DNA.JWT.LEFT)) {
                c = this.removeStyle(c, DNA.JWT.LEFT);
                g = DNA.widget.TablePanelDragPosProxy.LEFT;
                a = this.computePosProxyBounds_left(h, b)
            } else {
                if (this.containsStyle(c, DNA.JWT.TOP)) {
                    c = this.removeStyle(c, DNA.JWT.TOP);
                    g = DNA.widget.TablePanelDragPosProxy.TOP;
                    a = this.computePosProxyBounds_top(h, b)
                } else {
                    if (this.containsStyle(c, DNA.JWT.BOTTOM)) {
                        c = this.removeStyle(c, DNA.JWT.BOTTOM);
                        g = DNA.widget.TablePanelDragPosProxy.BOTTOM;
                        a = this.computePosProxyBounds_bottom(h, b)
                    } else {
                        if (this.containsStyle(c, DNA.JWT.RIGHT)) {
                            c = this.removeStyle(c, DNA.JWT.RIGHT);
                            g = DNA.widget.TablePanelDragPosProxy.RIGHT;
                            a = this.computePosProxyBounds_right(h, b)
                        } else {
                            if (this.containsStyle(c, DNA.JWT.TOP_LEFT)) {
                                c = this.removeStyle(c, DNA.JWT.TOP_LEFT);
                                g = DNA.widget.TablePanelDragPosProxy.TOP_LEFT;
                                a = this.computePosProxyBounds_top_left(h, b)
                            } else {
                                if (this.containsStyle(c, DNA.JWT.TOP_RIGHT)) {
                                    c = this.removeStyle(c, DNA.JWT.TOP_RIGHT);
                                    g = DNA.widget.TablePanelDragPosProxy.TOP_RIGHT;
                                    a = this.computePosProxyBounds_top_right(h, b)
                                } else {
                                    if (this.containsStyle(c, DNA.JWT.BOTTOM_LEFT)) {
                                        c = this.removeStyle(c, DNA.JWT.BOTTOM_LEFT);
                                        g = DNA.widget.TablePanelDragPosProxy.BOTTOM_LEFT;
                                        a = this.computePosProxyBounds_bottom_left(h, b)
                                    } else {
                                        if (this.containsStyle(c, DNA.JWT.BOTTOM_RIGHT)) {
                                            c = this.removeStyle(c, DNA.JWT.BOTTOM_RIGHT);
                                            g = DNA.widget.TablePanelDragPosProxy.BOTTOM_RIGHT;
                                            a = this.computePosProxyBounds_bottom_right(h, b)
                                        } else {
                                            break
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            this.drawDragPosProxyDom(g, a)
        }
        g = DNA.widget.TablePanelDragPosProxy.BOTTOM_CENTER;
        a = this.computePosProxyBounds_center(h, b);
        this.drawDragPosProxyDom(g, a);
        var d = this._domArray[g].parentNode;
        DNA.engine.DomUtil.setStyle(d, "left", h.x - b + "px");
        DNA.engine.DomUtil.setStyle(d, "top", h.y - b + "px");
        DNA.engine.DomUtil.setStyle(d, "width", h.width + (b + b) + "px");
        DNA.engine.DomUtil.setStyle(d, "height", h.height + (b + b) + "px")
    },
    computePosProxyBounds_center: function(b, a) {
        return new DNA.widget.Rectangle(a,a,b.width,b.height)
    },
    computePosProxyBounds_left: function(b, a) {
        return new DNA.widget.Rectangle(0,a,a,b.height)
    },
    computePosProxyBounds_top_left: function(b, a) {
        return new DNA.widget.Rectangle(0,0,a,a)
    },
    computePosProxyBounds_top: function(b, a) {
        return new DNA.widget.Rectangle(a,0,b.width,a)
    },
    computePosProxyBounds_top_right: function(b, a) {
        return new DNA.widget.Rectangle(b.width + a,0,a,a)
    },
    computePosProxyBounds_right: function(b, a) {
        return new DNA.widget.Rectangle(b.width + a,a,a,b.height)
    },
    computePosProxyBounds_bottom_right: function(b, a) {
        return new DNA.widget.Rectangle(b.width + a,b.height + a,a,a)
    },
    computePosProxyBounds_bottom: function(b, a) {
        return new DNA.widget.Rectangle(a,b.height + a,b.width,a)
    },
    computePosProxyBounds_bottom_left: function(b, a) {
        return new DNA.widget.Rectangle(0,b.height + a,a,a)
    }
});
DNA.widget.DesignDragDrop = function() {}
;
DNA.widget.DesignDragDrop.extend(DNA.widget.DragDrop, {
    createDragDropStartBox: function() {
        if (!this._startBox) {
            var c = this._dragControl.getParentControl();
            if (c && c.jtype == "XYLayoutPanel") {
                var a = c._getPageBounds();
                this._startBox = c.computeRectangle();
                this._startBox.x += a.x - this._readyTarget.getHOffset();
                this._startBox.y += a.y - this._readyTarget.getVOffset();
                this._startBox.ZIndex = c._zIndex ? c._zIndex + 1 : 999999
            } else {
                this._startBox = this._dragControl._getPageBounds();
                this._startBox.ZIndex = this._dragControl._zIndex ? this._dragControl._zIndex + 1 : 999999
            }
        }
        return this._startBox
    },
    dragMove: function(a) {
        if (this._dragControl) {
            if (!this._readyTarget) {
                this._readyTarget = this._dragControl.getParentControl();
                if (!(this._readyTarget instanceof DNA.widget.XYLayoutPanel)) {
                    delete this._dragControl;
                    return
                }
            }
            this.dragDropMove(a)
        }
    },
    _setReadyTarget: function(b) {
        var a = b.getXY();
        this._targets = this._getTargets(this._dragControl.getDragHandler());
        this._readyTarget = this._findTarget(a)
    },
    dragDropMove: function(d) {
        if (this._dragControl && this._dragging !== true) {
            var n = d.getXY();
            if (n.x != this._startXY.x || n.y != this._startXY.y) {
                this.createDragDropStartBox();
                DNA.widget.DragMove.superclass.dragMove.call(this, d);
                this._dragControl.dragSourcePos = this._dragSourcePos;
                this._dragging = true
            }
        } else {
            if (this._dragging === true) {
                var m = this._readyTarget;
                var a = d.getXY();
                var l = (a.x - this._startXY.x) + this._startBox.x;
                var h = (a.y - this._startXY.y) + this._startBox.y;
                var g = DNA.engine.DomUtil.getPageXY(m.el);
                if (m && m.isAdsorption === true) {
                    l = m.getStrawPos(l - g.x + m.getHOffset(), DNA.JWT.HORIZONTAL) + g.x - m.getHOffset();
                    if (m.hAdsorptionDistance == 0) {
                        var c = m.getStrawPos(l + this._startBox.width - g.x + m.getHOffset(), DNA.JWT.HORIZONTAL) + g.x - this._startBox.width;
                        l = c - m.getHOffset()
                    }
                    h = m.getStrawPos(h - g.y + m.getVOffset(), DNA.JWT.VERTICAL) + g.y - m.getVOffset();
                    if (m.vAdsorptionDistance == 0) {
                        var b = m.getStrawPos(h + this._startBox.height - g.y + m.getVOffset(), DNA.JWT.VERTICAL) + g.y - this._startBox.height;
                        h = b - m.getVOffset()
                    }
                }
                if (l - g.x + m.getHOffset() < 0) {
                    l = g.x - m.getHOffset()
                }
                if (h - g.y + m.getVOffset() < 0) {
                    h = g.y - +m.getVOffset()
                }
                DNA.engine.DomUtil.setLeftTop(this._snapshot, l, h);
                if (m) {
                    m.fireEvent("dragover", [d])
                } else {
                    if (!m) {
                        m.fireEvent("dragout", [d])
                    }
                }
                this._dragControl.fireEvent("dragmove", [d])
            }
        }
    },
    _doWestResize: function(d, g) {
        if (this._readyTarget.isAdsorption) {
            d.x = this._readyTarget.getStrawPos(d.x - g.x + this._readyTarget.getHOffset(), DNA.JWT.HORIZONTAL) + g.x - this._readyTarget.getHOffset()
        }
        var c = this._startXY.x - d.x;
        var a = this._startBox.width + c;
        var b = this._startXY.x - this._startBox.x;
        if (a >= (this._srcMinWidth)) {
            DNA.engine.DomUtil.setLeftTop(this._snapshot, (d.x), this._startBox.y);
            DNA.engine.DomUtil.setWidth(this._snapshot, a - b)
        }
    },
    dragEnd: function(a) {
        this.dragDropEnd(a)
    },
    dragDropEnd: function(g) {
        if (this._readyTarget && this._snapshot) {
            var b = DNA.engine.DomUtil.getPageXY(this._readyTarget.el);
            var d = DNA.engine.DomUtil.getPageXY(this._snapshot);
            if (d.x < b.x + this._readyTarget.getBounds().width && d.y < b.y + this._readyTarget.getBounds().height) {
                var a = (parseInt(DNA.engine.DomUtil.getStyle(this._snapshot, "left")) - b.x - 1);
                var h = (parseInt(DNA.engine.DomUtil.getStyle(this._snapshot, "top")) - b.y - 1);
                var c = this._dragControl.dragSourcePos.split(",");
                a = (a + parseInt(c[0]) + Math.abs(this._startBox.x - b.x - this._dragControl.getBounds().x));
                h = (h + parseInt(c[1]) + Math.abs(this._startBox.y - b.y - this._dragControl.getBounds().y));
                a = Math.floor(a);
                h = Math.floor(h);
                c = this._readyTarget.posInfo = a + "," + h;
                this._readyTarget.fireEvent("dragdrop", [this._dragControl, this._readyTarget, c])
            }
        }
        this._deleteCommonFields();
        if (this._dragging) {
            delete this._dragging
        }
        if (this._targets) {
            delete this._targets
        }
        if (this._startBox) {
            delete this._startBox
        }
    },
    _deleteCommonFields: function() {
        if (this._dragControl) {
            delete this._dragControl
        }
        if (this._readyTarget) {
            delete this._readyTarget
        }
        if (this._snapshot) {
            this._resetSnapshot();
            delete this._snapshot
        }
        if (this._startXY) {
            delete this._startXY
        }
    },
    _showSnapshot: function(b) {
        var a = this._snapshot = DNA.widget.DragListener.getSnapshotEl();
        DNA.engine.DomUtil.setStyle(a, "border-style", "dotted");
        DNA.engine.DomUtil.setStyle(a, "border-color", "#ff0000");
        DNA.engine.DomUtil.setStyle(a, "border-width", "1px");
        DNA.engine.DomUtil.setVisible(a, true);
        DNA.engine.DomUtil.setSize(a, {
            width: b.width,
            height: b.height
        });
        DNA.engine.DomUtil.setLeftTop(a, b.x, b.y);
        DNA.engine.DomUtil.setStyle(a, "z-index", b.ZIndex || 9999999);
        DNA.engine.DomUtil.setStyle(a, "cursor", this._direction);
        if (DNA.engine.Client.isIE() && a.lastChild.nodeName == "IFRAME") {
            a.lastChild.parentNode.removeChild(a.lastChild)
        }
    },
    _resetSnapshot: function() {
        var a = this._snapshot;
        if (a) {
            DNA.engine.DomUtil.setStyle(a, "border-style", "");
            DNA.engine.DomUtil.setStyle(a, "border-color", "");
            DNA.engine.DomUtil.setStyle(a, "border-width", "");
            DNA.engine.DomUtil.setLeftTop(a, 0, 0);
            DNA.engine.DomUtil.setSize(a, {
                width: 0,
                height: 0
            });
            DNA.engine.DomUtil.setVisible(a, false);
            DNA.engine.DomUtil.setStyle(a, "cursor", "default")
        }
    }
});
DNA.widget.DesignDragResize = function(a) {
    this._direction = a
}
;
DNA.widget.DesignDragResize.extend(DNA.widget.DragResize, {
    _minWidth: 10,
    _minHeight: 10,
    createDragResizeStartBox: function(a) {
        this._startBox = a._getPageBounds();
        this._startBox.ZIndex = a._zIndex ? a._zIndex + 1 : 999999;
        this._srcMinWidth = a._getMinWidth ? a._getMinWidth() : this._minWidth;
        this._srcMinHeight = a._getMinHeight ? a._getMinHeight() : this._minHeight
    },
    dragMove: function(a) {
        if (this._dragControl) {
            if (!this._readyTarget) {
                this._readyTarget = this._dragControl.getParentControl()
            }
            this.dragResizeMove(a)
        }
    },
    _setReadyTarget: function(b) {
        var a = b.getXY();
        this._targets = this._getTargets(this._dragControl.getDragHandler());
        this._readyTarget = this._findTarget(a)
    },
    dragResizeMove: function(g) {
        var l = this._dragControl;
        if (!this._snapshot && this._direction) {
            DNA.widget.DragResize.superclass.dragMove.call(this, g);
            this._srcMinWidth = l._getMinWidth ? l._getMinWidth() : this._minWidth;
            this._srcMinHeight = l._getMinHeight ? l._getMinHeight() : this._minHeight
        } else {
            if (this._direction) {
                var d = g.getXY();
                var a = DNA.engine.DomUtil.getPageXY(l.el);
                var h = DNA.engine.DomUtil.getPageXY(this._readyTarget.el);
                var b = {};
                b.x = a.x - h.x;
                b.y = a.y - h.y;
                if (this._direction == DNA.JWT.DIRECTION.EAST) {
                    this._doEastResize(d, b)
                } else {
                    if (this._direction == DNA.JWT.DIRECTION.SOUTH) {
                        this._doSouthResize(d, b)
                    } else {
                        if (this._direction == DNA.JWT.DIRECTION.WEST) {
                            this._doWestResize(d, h)
                        } else {
                            if (this._direction == DNA.JWT.DIRECTION.NORTH) {
                                this._doNorthResize(d, h)
                            } else {
                                if (this._direction == DNA.JWT.DIRECTION.EASTSOUTH) {
                                    this._doEastResize(d, b);
                                    this._doSouthResize(d, b)
                                } else {
                                    if (this._direction == DNA.JWT.DIRECTION.EASTNORTH) {
                                        this._doNorthEestResize(d, h)
                                    } else {
                                        if (this._direction == DNA.JWT.DIRECTION.WESTSOUTH) {
                                            this._doSorthWestResize(d, h)
                                        } else {
                                            if (this._direction == DNA.JWT.DIRECTION.WESTNORTH) {
                                                this._doNorthWestResize(d, h)
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    },
    _doWestResize: function(d, g) {
        if (this._readyTarget.isAdsorption) {
            d.x = this._readyTarget.getStrawPos(d.x - g.x + this._readyTarget.getHOffset(), DNA.JWT.HORIZONTAL) + g.x - this._readyTarget.getHOffset()
        }
        var c = this._startXY.x - d.x;
        var a = this._startBox.width + c;
        var b = this._startXY.x - this._startBox.x;
        if (a >= (this._srcMinWidth)) {
            DNA.engine.DomUtil.setLeftTop(this._snapshot, (d.x), this._startBox.y);
            DNA.engine.DomUtil.setWidth(this._snapshot, a - b)
        }
    },
    _doNorthResize: function(d, g) {
        if (this._readyTarget.isAdsorption) {
            d.y = this._readyTarget.getStrawPos(d.y - g.y + this._readyTarget.getVOffset(), DNA.JWT.VERTICAL) + g.y - this._readyTarget.getVOffset()
        }
        var c = this._startXY.y - d.y;
        var b = this._startBox.height + c;
        var a = this._startXY.y - this._startBox.y;
        if (b >= (this._srcMinHeight)) {
            DNA.engine.DomUtil.setLeftTop(this._snapshot, this._startBox.x, (d.y));
            DNA.engine.DomUtil.setHeight(this._snapshot, b - a)
        }
    },
    _doNorthWestResize: function(a, b) {
        if (this._readyTarget.isAdsorption) {
            a.x = this._readyTarget.getStrawPos(a.x - b.x + this._readyTarget.getHOffset(), DNA.JWT.HORIZONTAL) + b.x - this._readyTarget.getHOffset()
        }
        if (this._readyTarget.isAdsorption) {
            a.y = this._readyTarget.getStrawPos(a.y - b.y + this._readyTarget.getVOffset(), DNA.JWT.VERTICAL) + b.y - this._readyTarget.getVOffset()
        }
        var o = this._startXY.x - this._startBox.x;
        var n = this._startXY.y - this._startBox.y;
        var h = this._startXY.x - a.x;
        var c = this._startBox.width + h - o;
        var l = this._startBox.x - h;
        if (c >= (this._srcMinWidth)) {
            DNA.engine.DomUtil.setWidth(this._snapshot, c)
        } else {
            a.x = parseInt(DNA.engine.DomUtil.getStyle(this._snapshot, "left")) + 1
        }
        var m = this._startXY.y - a.y;
        var g = this._startBox.height + m - n;
        var d = this._startBox.y - m;
        if (g >= (this._srcMinHeight)) {
            DNA.engine.DomUtil.setHeight(this._snapshot, g)
        } else {
            a.y = parseInt(DNA.engine.DomUtil.getStyle(this._snapshot, "top")) + 1
        }
        DNA.engine.DomUtil.setLeftTop(this._snapshot, (a.x), (a.y))
    },
    _doSorthWestResize: function(l, m) {
        if (this._readyTarget.isAdsorption) {
            l.x = this._readyTarget.getStrawPos(l.x - m.x + this._readyTarget.getHOffset(), DNA.JWT.HORIZONTAL) + m.x - this._readyTarget.getHOffset()
        }
        if (this._readyTarget.isAdsorption) {
            l.y = this._readyTarget.getStrawPos(l.y - m.y + this._readyTarget.getVOffset(), DNA.JWT.VERTICAL) + m.y - this._readyTarget.getVOffset()
        }
        var c = this._startXY.x - this._startBox.x;
        var b = this._startXY.y - this._startBox.y - this._startBox.height;
        var h = this._startXY.x - l.x;
        var a = this._startBox.width + h - c;
        if (a >= (this._srcMinWidth)) {
            DNA.engine.DomUtil.setLeftTop(this._snapshot, this._startBox.x - h + c, this._startBox.y);
            DNA.engine.DomUtil.setWidth(this._snapshot, a)
        }
        var g = this._startXY.y - l.y;
        var d = this._startBox.height - g + b;
        if (d >= (this._srcMinHeight)) {
            DNA.engine.DomUtil.setHeight(this._snapshot, d)
        }
    },
    _doNorthEestResize: function(l, m) {
        if (this._readyTarget.isAdsorption) {
            l.x = this._readyTarget.getStrawPos(l.x - m.x + this._readyTarget.getHOffset(), DNA.JWT.HORIZONTAL) + m.x - this._readyTarget.getHOffset()
        }
        if (this._readyTarget.isAdsorption) {
            l.y = this._readyTarget.getStrawPos(l.y - m.y + this._readyTarget.getVOffset(), DNA.JWT.VERTICAL) + m.y - this._readyTarget.getVOffset()
        }
        var c = this._startXY.x - this._startBox.x - this._startBox.width;
        var b = this._startXY.y - this._startBox.y;
        var h = this._startXY.y - l.y;
        var d = this._startBox.height + h - b;
        if (d >= (this._srcMinHeight)) {
            DNA.engine.DomUtil.setLeftTop(this._snapshot, this._startBox.x, this._startBox.y - h + b);
            DNA.engine.DomUtil.setHeight(this._snapshot, d)
        }
        var g = this._startXY.x - l.x;
        var a = this._startBox.width - g + c;
        if (a >= (this._srcMinWidth)) {
            DNA.engine.DomUtil.setWidth(this._snapshot, a)
        }
    },
    _doEastResize: function(d, b) {
        var c = this._startXY.x - d.x;
        var a = this._startBox.width - c;
        if (a >= (this._srcMinWidth)) {
            if (this._readyTarget.isAdsorption) {
                a = this._readyTarget.getStrawPos(a + b.x + this._readyTarget.getHOffset(), DNA.JWT.HORIZONTAL) - b.x - this._readyTarget.getHOffset()
            }
            DNA.engine.DomUtil.setWidth(this._snapshot, a)
        }
    },
    _doSouthResize: function(d, b) {
        var c = this._startXY.y - d.y;
        var a = this._startBox.height - c;
        if (a >= (this._srcMinHeight)) {
            if (this._readyTarget.isAdsorption) {
                a = this._readyTarget.getStrawPos(a + b.y + this._readyTarget.getVOffset(), DNA.JWT.VERTICAL) - b.y - this._readyTarget.getVOffset()
            }
            DNA.engine.DomUtil.setHeight(this._snapshot, a)
        }
    },
    dragEnd: function(a) {
        this.dragResizeEnd(a)
    },
    _deleteCommonFields: function() {
        if (this._dragControl) {
            delete this._dragControl
        }
        if (this._readyTarget) {
            delete this._readyTarget
        }
        if (this._snapshot) {
            this._resetSnapshot();
            delete this._snapshot
        }
        if (this._startXY) {
            delete this._startXY
        }
    },
    dragResizeEnd: function(g) {
        var c = null ;
        var b = this._readyTarget;
        if (this._snapshot && b && b.getHOffset) {
            var c = DNA.engine.DomUtil.getSize(this._snapshot);
            var d = DNA.engine.DomUtil.getPageXY(b.getEl());
            var a = parseInt(DNA.engine.DomUtil.getStyle(this._snapshot, "left")) - 1 - d.x + b.getHOffset();
            var h = parseInt(DNA.engine.DomUtil.getStyle(this._snapshot, "top")) - 1 - d.y + b.getVOffset();
            if (a < 0) {
                a = 0
            }
            if (h < 0) {
                h = 0
            }
            this._dragControl.fireEvent("designResize", [this._dragControl, c, a, h])
        }
        this._deleteCommonFields();
        if (this._srcMinWidth) {
            delete this._srcMinWidth
        }
        if (this._srcMinHeight) {
            delete this._srcMinHeight
        }
        if (this._direction) {
            delete this._direction
        }
        if (this._startBox) {
            delete this._startBox
        }
    },
    _showSnapshot: function(b) {
        var a = this._snapshot = DNA.widget.DragListener.getSnapshotEl();
        DNA.engine.DomUtil.setStyle(a, "border-style", "dotted");
        DNA.engine.DomUtil.setStyle(a, "border-color", "#ff0000");
        DNA.engine.DomUtil.setStyle(a, "border-width", "1px");
        DNA.engine.DomUtil.setVisible(a, true);
        DNA.engine.DomUtil.setSize(a, {
            width: b.width,
            height: b.height
        });
        DNA.engine.DomUtil.setLeftTop(a, b.x, b.y);
        DNA.engine.DomUtil.setStyle(a, "z-index", b.ZIndex || 9999999);
        DNA.engine.DomUtil.setStyle(a, "cursor", this._direction);
        if (DNA.engine.Client.isIE() && a.lastChild.nodeName == "IFRAME") {
            a.lastChild.parentNode.removeChild(a.lastChild)
        }
    },
    _resetSnapshot: function() {
        var a = this._snapshot;
        if (a) {
            DNA.engine.DomUtil.setStyle(a, "border-style", "");
            DNA.engine.DomUtil.setStyle(a, "border-color", "");
            DNA.engine.DomUtil.setStyle(a, "border-width", "");
            DNA.engine.DomUtil.setLeftTop(a, 0, 0);
            DNA.engine.DomUtil.setSize(a, {
                width: 0,
                height: 0
            });
            DNA.engine.DomUtil.setVisible(a, false);
            DNA.engine.DomUtil.setStyle(a, "cursor", "default")
        }
    }
});
DNA.widget.RichText = function(a) {
    DNA.widget.RichText.superclass.constructor.call(this, a)
}
;
DNA.widget.RichText.extend(DNA.widget.Control, {
    autoRender: true,
    _registEvents: function() {
        DNA.widget.RichText.superclass._registEvents.call(this);
        DNA.engine.application.getJWTEventMgr().addListener(DNA.JWTEvent.PREDISPOSE, this._doPreDispose, this);
        DNA.engine.application.getJWTEventMgr().addListener(DNA.JWTEvent.POST_ENABLED, this._doEnable, this);
        DNA.engine.application.getJWTEventMgr().addListener(DNA.JWTEvent.PRE_DISABLED, this._doDisable, this)
    },
    computeSize: function(c, a, d) {
        var b = new DNA.widget.Point();
        if (!isNaN(c) && c != DNA.JWT.DEFAULT) {
            b.x = c
        } else {
            b.x = DNA.PropertyDefaultValue[DNA.JWTProperty.DV_TEXT_MULTI_WIDTH]
        }
        if (!isNaN(a) && a != DNA.JWT.DEFAULT) {
            b.y = a
        } else {
            if (this.getStyle() & DNA.JWT.MULTI) {
                b.y = DNA.PropertyDefaultValue[DNA.JWTProperty.DV_TEXT_MULTI_HEIGHT]
            } else {
                b.y = DNA.PropertyDefaultValue[DNA.JWTProperty.DV_TEXT_HEIGHT]
            }
        }
        return b
    },
    _focusDom: function(a) {},
    execScript: function(script) {
        this.el.firstChild.contentWindow.eval(script)
    },
    setContent: function(a) {
        this.el.firstChild.contentWindow.document.body.innerHTML = a
    },
    getContent: function() {
        return this.el.firstChild.contentWindow.document.body.innerHTML
    },
    _doPreDispose: new DNA.engine.Action({
        handle: function(a) {
            this.fireEvent("customDispose", [a, this])
        }
    }),
    _doEnable: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            if (a.isAncestorOf(this)) {
                this._processDisabled(false)
            }
        }
    }),
    _doDisable: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            if (a.isAncestorOf(this)) {
                this._processDisabled(true)
            }
        }
    }),
    _processDisabled: function(a) {
        if (a) {
            this.el.firstChild.contentWindow.document.body.contentEditable = "false"
        } else {
            this.el.firstChild.contentWindow.document.body.contentEditable = "true"
        }
    }
});
Object.override(DNA.widget.RichText.prototype, {
    jtype: "RichText",
    focusable: true
});
DNA.widget.ImageArea = function(a) {
    DNA.widget.ImageArea.superclass.constructor.call(this, a)
}
;
DNA.widget.ImageArea.extend(DNA.widget.Iteration, {
    autoRender: true,
    focusable: true,
    _styles: [],
    _image: null ,
    _selectIndex: -1,
    setImage: function(a) {
        this._image = a
    },
    _getImage: function() {
        if (!this._image) {
            this._image = this.getInitData()[DNA.JWTProperty.PROPERTY_IMAGE];
            delete this.getInitData()[DNA.JWTProperty.PROPERTY_IMAGE]
        }
        return this._image
    },
    computeSize: function(b, a, g) {
        var d = this._getImage();
        if (d) {
            var c = new DNA.widget.Point(d.w,d.h);
            return c
        } else {
            return new DNA.widget.Point(200,200)
        }
    },
    _getSelectIndex: function() {
        return this._selectIndex
    },
    _clearChildrenDom: function() {
        if (this.getEl()) {
            var a = this.el.children || this.el.childNodes;
            var b = a[1];
            if (b && b.tagName == "MAP") {
                b.innerHTML = ""
            }
        }
    },
    _registEvents: function() {
        this.addListener("click", new DNA.engine.Action({
            handle: function(h) {
                this._selectIndex = -1;
                var g = h.getSrcControl();
                var d = h.getSrcElement();
                if (d.tagName != "AREA" && d.tagName != "area") {
                    return
                }
                var a = d.parentNode.childNodes;
                var b = -1;
                for (var c = 0; c < a.length; c++) {
                    if (a[c].tagName == "AREA" || a[c].tagName == "area") {
                        b++;
                        if (d == a[c]) {
                            break
                        }
                    }
                }
                this._selectIndex = b;
                if (b >= 0) {
                    g.fireEvent("itemSelected", [g, b, h])
                }
            }
        }))
    }
});
DNA.widget.ImageArea.prototype.jtype = "ImageArea";
DNA.widget.ImageArea.prototype._defaultBorder = null ;
DNA.widget.RichList = function(a) {
    DNA.widget.RichList.superclass.constructor.call(this, a);
    this.itemCount = this.getInitData("itemCount");
    this.itemHeight = this.getInitData(DNA.JWTProperty.PROPERTY_ITEM_HEIGHT);
    this.columnCount = this.getInitData(DNA.JWTProperty.PROPERTY_TABLE_COLUMNS);
    if (!this.itemHeight) {
        this.itemHeight = DNA.JWTProperty.RICHLIST_DEFAULT_LINE_HEIGHT
    }
    if (!this.columnCount) {
        this.columnCount = 1
    }
}
;
DNA.widget.RichList.extend(DNA.widget.Control, {
    autoRender: true,
    setColumnCount: function(a) {
        if (a) {
            this.columnCount = a
        } else {
            this.columnCount = 1
        }
    },
    _setFont: function(a) {
        var c = this._getStyleEl();
        if (c) {
            DNA.engine.DomUtil.setFont(c, a);
            childTables = c.children;
            if (childTables) {
                for (var b = 0; b < childTables.length; b++) {
                    DNA.engine.DomUtil.setFont(childTables[b], a)
                }
            }
        }
    },
    setItemHeight: function(a) {
        if (a) {
            this.itemHeight = a
        } else {
            this.itemHeight = DNA.JWTProperty.RICHLIST_DEFAULT_LINE_HEIGHT
        }
    },
    setItemCount: function(a) {
        this.columnCount = a
    },
    computeSize: function(c, a, d) {
        var b = new DNA.widget.Point(200,(this.itemCount / this.columnCount + (this.itemCount % this.columnCount == 0 ? 0 : 1)) * this.itemHeight);
        return b
    },
    _registEvents: function() {
        DNA.widget.RichList.superclass._registEvents.call(this);
        this.addListener("click", this._doClick)
    },
    _updateContent: function(a) {
        this.el.innerHTML = a
    },
    _doClick: new DNA.engine.Action({
        handle: function(d) {
            var c = d.getSrcControl();
            var b = d.getSrcElement();
            var a = DNA.engine.DomUtil.findParent(b, "a[className=RichList-Item-Link]");
            if (a) {
                c.fireEvent("itemSelected", [c, a.id, d])
            }
        }
    })
});
Object.override(DNA.widget.RichList.prototype, {
    jtype: "RichList",
    focusable: true
});
DNA.widget.ImageAreaItem = function(a) {
    DNA.widget.ImageAreaItem.superclass.constructor.call(this, a)
}
;
DNA.widget.ImageAreaItem.extend(DNA.widget.Item, {});
DNA.widget.ImageAreaItem.prototype.jtype = "ImageAreaItem";
DNA.widget.ImageAreaItem.prototype._defaultBorder = null ;
DNA.widget.AbstractFileChooser = function(a) {
    DNA.widget.AbstractFileChooser.superclass.constructor.call(this, a);
    var b = this.getEid() + "_uploader";
    var c = "#";
    if (DNA.engine.Client.isChrome() || DNA.engine.Client.isSafari()) {
        c = ""
    }
    this._uploader = DNA.engine.DomUtil.append(DNA.engine.application.getBrowserBody(), "<iframe src='" + c + "' name=" + b + " style='display:none;'>");
    this._uploader.id = this.getEid()
}
;
DNA.widget.AbstractFileChooser.extend(DNA.widget.Control, {
    autoRender: true,
    focusable: true,
    open: function() {
        this._form.firstChild.click()
    },
    computeSize: function(c, a, d) {
        var b = this._getPerfectSize();
        if (c != -1) {
            b.x = c
        }
        if (a != -1) {
            b.y = a
        }
        return b
    },
    setRelativeControl: function(a) {
        this.getInitData()[DNA.JWTProperty.PROPERTY_FILECHOOSER_WIDGET] = a
    },
    getRelativeControl: function() {
        return this.getInitData()[DNA.JWTProperty.PROPERTY_FILECHOOSER_WIDGET]
    },
    setRelativeEventName: function(a) {
        this.getInitData()[DNA.JWTProperty.PROPERTY_FILECHOOSER_EVENT] = a
    },
    getRelativeEventName: function() {
        return this.getInitData()[DNA.JWTProperty.PROPERTY_FILECHOOSER_EVENT]
    },
    _resize: function() {
        var a = this.getBounds();
        var d = this.getBorderSize();
        var c = a.width - d - 20;
        this._doResize(c > 0 ? c : 0)
    },
    _registEvents: function() {
        this.addListener("change", this._doAddFile);
        this.addListener("load", this._doAfterUpload);
        this.addListener("elementsRebuld", this._deleteFirstFileSelfEvent)
    },
    _deleteFirstFileSelfEvent: new DNA.engine.Action({
        handle: function(a) {
            this._interalDeleteFirstFileSelfEvent()
        }
    }),
    _interalDeleteFirstFileSelfEvent: function(a) {
        var b = DNA.engine.application.getJWTEventMgr();
        b.deleteSelfEvent(this, "change", a || this._form.firstChild)
    },
    _doAddFile: new DNA.engine.Action({
        handle: function() {
            this._interalAddFile()
        }
    }),
    _interalAddFile: function() {
        this._insertNewFile();
        this._handNewFileEvent();
        this.fireEvent("document", [this])
    },
    _insertNewFile: function() {
        var b = "<input type=file class='filechooser-button-open' name='" + this.getEid() + "'  size='1'";
        var a = DNA.engine.Client;
        if (a.isIE()) {
            b += " style='position:relative !important;left:-30px;top:-20px;height:1000px;cursor:pointer'"
        }
        var c = "";
        if (a.isChinese()) {
            c = "����ļ�"
        } else {
            c = "add file"
        }
        b += " title='" + c + "'";
        b += " >";
        DNA.engine.DomUtil.insertFirst(this._form, b)
    },
    _handNewFileEvent: function() {
        DNA.engine.application.getJWTEventMgr().handleSelfEvent(this, "change", this._form.firstChild)
    },
    submit: function() {
        var a = DNA.engine.application.getJWTEventMgr();
        if (!a.hasSelfEvent(this, "load")) {
            a.handleSelfEvent(this, "load", this._uploader)
        }
        this._form.firstChild.disabled = true;
        this._form.submit();
        this._form.firstChild.disabled = false
    },
    _doAfterUpload: new DNA.engine.Action({
        handle: function() {
            var b = this._uploader.contentWindow.document.body.innerHTML;
            var a = true;
            b = b.replace(/<pre>|<\/pre>/ig, "");
            if (b != "") {
                a = false;
                alert(b)
            }
            this.fireEvent("upload", [this, a])
        }
    }),
    doDispose: function() {
        delete this._form;
        delete this._selectedFile;
        DNA.engine.DomUtil.dispose(this._uploader);
        delete this._uploader;
        DNA.widget.AbstractFileChooser.superclass.doDispose.call(this)
    }
});
DNA.widget.AbstractFileChooser.prototype.jtype = "FileChooser";
DNA.widget.MultiFileChooser = function(a) {
    DNA.widget.MultiFileChooser.superclass.constructor.call(this, a)
}
;
DNA.widget.MultiFileChooser.extend(DNA.widget.AbstractFileChooser, {
    _getPerfectSize: function() {
        return new DNA.widget.Point(150,100)
    },
    _doBuildElements: function() {
        this._contentDiv = this.el.firstChild;
        var c = this.el.lastChild;
        this._addDiv = c.firstChild;
        var b = DNA.engine.Client;
        if (b.isIE()) {
            var h = this._addDiv.firstChild.contentWindow.document;
            h.open();
            h.write("<html><head><meta http-equiv='content-Type' content='text/html; charset=GBK' /> </head><body style='padding:0px;margin:0px' id='" + this.getEid() + "'><form style='padding:0px;margin:0px' method=post enctype='multipart/form-data' target='" + this.getEid() + "_uploader' action='" + DNA.engine.application.getServerBaseUrl() + "serviceId=file_upload&eid=" + this.getEid() + "&maxSize=" + this.getInitData(DNA.JWTProperty.PROPERTY_FILE_MAXSIZE) + "&sessionId=" + DNA.adapter.browserPage.getSessionId() + "&verificationCode=" + DNA.adapter.browserPage._verificationCode + "'><input type=file name='" + this.getEid() + "'  size='1' style='position:relative !important;left:-30px;top:-20px;height:1000px;cursor:pointer;padding:0px;margin:0px' ></form></body></html>");
            h.close();
            h.charset = "GBK";
            this._form = h.body.firstChild
        } else {
            this._form = this._addDiv.firstChild
        }
        this._delDiv = c.childNodes[1];
        this._clearDiv = c.lastChild;
        this._handNewFileEvent();
        var d = "";
        var a = "";
        var g = "";
        if (b.isChinese()) {
            d = "����ļ�";
            a = "ɾ���ļ�";
            g = "ɾ�������ļ�"
        } else {
            d = "add file";
            a = "delete file";
            g = "delete all file"
        }
        this._form.firstChild.title = d;
        this._delDiv.title = a;
        this._clearDiv.title = g
    },
    _doResize: function(a) {
        this._contentDiv.style.width = a + "px"
    },
    _registEvents: function() {
        DNA.widget.MultiFileChooser.superclass._registEvents.call(this);
        this.addListener("mousedown", this._doMultiMousedown);
        this.addListener("mousemove", this._doMouseMove);
        this.addListener("mousedown", this._doMouseDown);
        this.addListener("mouseup", this._doMouseUp);
        this.addListener("mouseover", this._doMouseOver);
        this.addListener("mouseout", this._doMouseOut)
    },
    _doMultiMousedown: new DNA.engine.Action({
        handle: function(h) {
            var c = h.getSrcElement();
            if (c.parentNode == this._contentDiv) {
                c.style.backgroundColor = "#e0e0e0";
                var g = this._selectedFile;
                if (g) {
                    g.style.backgroundColor = ""
                }
                this._selectedFile = c
            } else {
                if (c == this._delDiv && this._selectedFile) {
                    var b = 0;
                    var a = this._contentDiv.childNodes;
                    while (a[b] !== this._selectedFile) {
                        b++
                    }
                    var d = this._form.childNodes[b + 1];
                    DNA.engine.DomUtil.dispose(d);
                    DNA.engine.DomUtil.dispose(a[b]);
                    delete this._selectedFile;
                    this.fireEvent("document", [this])
                } else {
                    if (c == this._clearDiv) {
                        this._clear();
                        this.fireEvent("document", [this])
                    }
                }
            }
        }
    }),
    _doAddFile: new DNA.engine.Action({
        handle: function() {
            var a = this._form.firstChild;
            var b = this.getFileNames();
            this._interalDeleteFirstFileSelfEvent(a);
            if (b.indexOf(a.value) != -1) {
                DNA.engine.DomUtil.dispose(a)
            } else {
                a.style.display = "none";
                DNA.engine.DomUtil.insertFirst(this._contentDiv, '<div style="white-space:nowrap;">' + a.value + "</div>")
            }
            this._interalAddFile()
        }
    }),
    _clear: function() {
        this._contentDiv.innerHTML = "";
        for (var a = this._form.childNodes.length - 1; a > 0; a--) {
            var b = this._form.childNodes[a];
            DNA.engine.DomUtil.dispose(b)
        }
        delete this._selectedFile
    },
    getFileNames: function() {
        var a = [];
        var b = 0;
        for (var c = this._form.childNodes.length - 1; c > 0; c--) {
            var d = this._form.childNodes[c];
            a[b++] = d.value
        }
        return a
    },
    _doMouseMove: new DNA.engine.Action({
        handle: function(d) {
            var a = this._getDivArray();
            var b = false;
            for (var c = 0; c < a.length; c++) {
                var g = a[c];
                if (this._checkDomEqual(d.getSrcElement(), g)) {
                    this._setHoverClass(g);
                    b = true
                }
            }
            if (!b) {
                this._setNormalClass(this._addDiv);
                this._setNormalClass(this._delDiv);
                this._setNormalClass(this._clearDiv)
            }
        }
    }),
    _doMouseDown: new DNA.engine.Action({
        handle: function(c) {
            var a = this._getDivArray();
            for (var b = 0; b < a.length; b++) {
                var d = a[b];
                if (this._checkDomEqual(c.getSrcElement(), d)) {
                    this._setDownClass(d)
                }
            }
        }
    }),
    _doMouseUp: new DNA.engine.Action({
        handle: function(c) {
            var a = this._getDivArray();
            for (var b = 0; b < a.length; b++) {
                var d = a[b];
                if (this._checkDomEqual(c.getSrcElement(), d)) {
                    this._setHoverClass(d)
                }
            }
        }
    }),
    _doMouseOver: new DNA.engine.Action({
        handle: function(a) {
            this._setNormalClass(this._addDiv);
            this._setNormalClass(this._delDiv);
            this._setNormalClass(this._clearDiv)
        }
    }),
    _doMouseOut: new DNA.engine.Action({
        handle: function(a) {
            this._setNormalClass(this._addDiv);
            this._setNormalClass(this._delDiv);
            this._setNormalClass(this._clearDiv)
        }
    }),
    _setNormalClass: function(a) {
        a._downFlag = false;
        DNA.engine.DomUtil.removeClass(a, "filechooser-hover");
        a.style.backgroundColor = ""
    },
    _setHoverClass: function(a) {
        if (!a._downFlag) {
            DNA.engine.DomUtil.addClass(a, "filechooser-hover")
        }
    },
    _setDownClass: function(a) {
        a._downFlag = true
    },
    _getDivArray: function() {
        return [this._addDiv, this._delDiv, this._clearDiv]
    },
    _checkDomEqual: function(b, a) {
        if (a.firstChild) {
            return b == a || b == a.firstChild || DNA.engine.DomUtil.isChildren(b, this._form, 2)
        } else {
            return b == a
        }
    },
    doDispose: function() {
        delete this._contentDiv,
        this._addDiv,
        this._delDiv,
        this._clearDiv;
        DNA.widget.MultiFileChooser.superclass.doDispose.call(this)
    }
});
DNA.widget.SingleFileChooser = function(a) {
    DNA.widget.SingleFileChooser.superclass.constructor.call(this, a)
}
;
DNA.widget.SingleFileChooser.extend(DNA.widget.AbstractFileChooser, {
    _getPerfectSize: function() {
        return new DNA.widget.Point(150,22)
    },
    _doBuildElements: function() {
        var a = DNA.engine.Client;
        if (a.isIE()) {
            var b = this.el.lastChild.firstChild.lastChild.contentWindow.document;
            b.open();
            b.write("<html><head><meta http-equiv='content-Type' content='text/html; charset=GBK' /> </head><body style='padding:0px;margin:0px' id='" + this.getEid() + "'><form style='padding:0px;margin:0px' method=post enctype='multipart/form-data' target='" + this.getEid() + "_uploader' action='" + DNA.engine.application.getServerBaseUrl() + "serviceId=file_upload&eid=" + this.getEid() + "&maxSize=" + this.getInitData(DNA.JWTProperty.PROPERTY_FILE_MAXSIZE) + "&sessionId=" + DNA.adapter.browserPage.getSessionId() + "&verificationCode=" + DNA.adapter.browserPage._verificationCode + "'><input type=file name='" + this.getEid() + "'  size='1' style='position:relative !important;left:-30px;top:-20px;height:1000px;cursor:pointer;padding:0px;margin:0px' ></form></body></html>");
            b.close();
            b.charset = "GBK";
            this._form = b.body.firstChild
        } else {
            this._form = this.el.lastChild.firstChild.firstChild
        }
        this.arrowEl = this.el.lastChild;
        this._contentInput = this.el.firstChild;
        this._handNewFileEvent()
    },
    _doResize: function(a) {
        this._contentInput.style.width = a + "px"
    },
    _doAddFile: new DNA.engine.Action({
        handle: function() {
            var a = this._form.firstChild;
            this._contentInput.value = a.value;
            a.style.display = "none";
            this._interalDeleteFirstFileSelfEvent(a);
            var b = a.nextSibling;
            if (b) {
                DNA.engine.DomUtil.dispose(b)
            }
            this._interalAddFile()
        }
    }),
    getFileNames: function() {
        var a = this._form.lastChild.value;
        return a ? [a] : []
    },
    _registEvents: function() {
        DNA.widget.SingleFileChooser.superclass._registEvents.call(this);
        this.addListener("mousemove", this._doMouseMove);
        this.addListener("mousedown", this._doMouseDown);
        this.addListener("mouseup", this._doMouseUp);
        this.addListener("mouseover", this._doMouseOver);
        this.addListener("mouseout", this._doMouseOut)
    },
    _doMouseMove: new DNA.engine.Action({
        handle: function(a) {
            if (this._checkDomEqual(a.getSrcElement(), this.arrowEl)) {
                this._setHoverClass()
            } else {
                this._setNormalClass()
            }
        }
    }),
    _doMouseDown: new DNA.engine.Action({
        handle: function(a) {
            if (this._checkDomEqual(a.getSrcElement(), this.arrowEl)) {
                this._setDownClass()
            }
        }
    }),
    _doMouseUp: new DNA.engine.Action({
        handle: function(a) {
            this._buttonDown = false;
            if (this._checkDomEqual(a.getSrcElement(), this.arrowEl)) {
                this._setHoverClass()
            } else {
                this._setNormalClass()
            }
        }
    }),
    _doMouseOver: new DNA.engine.Action({
        handle: function(a) {
            this._setNormalClass()
        }
    }),
    _doMouseOut: new DNA.engine.Action({
        handle: function(a) {
            this._setNormalClass()
        }
    }),
    _setNormalClass: function() {
        this._buttonDown = false;
        this.arrowEl.className = "text-bg bg-n  filechooser-div-open";
        this.arrowEl.firstChild.style.marginTop = 0
    },
    _setHoverClass: function() {
        if (!this._buttonDown) {
            this.arrowEl.className = "text-bg bg-h filechooser-div-open";
            this.arrowEl.firstChild.style.marginTop = 0
        }
    },
    _setDownClass: function() {
        this._buttonDown = true;
        this.arrowEl.className = "text-bg bg-a filechooser-div-open";
        this.arrowEl.firstChild.style.marginTop = "1px"
    },
    _checkDomEqual: function(b, a) {
        return b == a || b == a.firstChild || b == a.firstChild.firstChild || DNA.engine.DomUtil.isChildren(b, this._form, 2)
    },
    doDispose: function() {
        delete this._contentInput;
        delete this.arrowEl;
        DNA.widget.SingleFileChooser.superclass.doDispose.call(this)
    }
});
DNA.widget.ImageBorderComposite = function(a) {
    DNA.widget.ImageBorderComposite.superclass.constructor.call(this, a)
}
;
DNA.widget.ImageBorderComposite.extend(DNA.widget.Composite, {
    autoRender: true,
    _imageSort: ["lt", "t", "rt", "r", "rb", "b", "lb", "l"],
    _doBuildElements: function() {
        this._body = this.el.childNodes[0];
        this._textEl = this.el.childNodes[2]
    },
    setAlignment: function(c) {
        var b = "center";
        if (c & DNA.JWT.LEFT) {
            b = "left"
        } else {
            if (c & DNA.JWT.RIGHT) {
                b = "right"
            }
        }
        this._textEl.style.textAlign = b
    },
    setText: function(a) {
        this._textEl.innerHTML = a
    },
    getText: function() {
        return this._textEl.innerHTML
    },
    setImageBorder: function(a) {
        if (a.img_t) {
            this._imageBorder = a
        } else {
            this._imageBorder = new DNA.widget.ImageBorder(a)
        }
        this._updateImageBorder()
    },
    getImageBorder: function() {
        if (this._imageBorder == undefined) {
            this._imageBorder = this.getInitData().style_border;
            if (this._imageBorder) {
                this._imageBorder = new DNA.widget.ImageBorder(this._imageBorder)
            }
            delete this.getInitData().style_border
        }
        return this._imageBorder
    },
    setBorder: Function.emptyFunction,
    getBorder: Function.emptyFunction,
    computeSize: function(b, a, g) {
        var d = DNA.widget.ImageBorderComposite.superclass.computeSize.call(this, b, a, g);
        var c = this.getImageBorderSize();
        d.x += c.width;
        d.y += c.height;
        return d
    },
    getClientRectangle: function() {
        var d = this.getImageBorder();
        var b = 0;
        var a = 0;
        if (d) {
            b = d.img_l.width;
            a = d.img_t.height
        }
        var c = this.getBorderSize();
        var h = this.getBounds();
        var g = this.getImageBorderSize();
        return new DNA.widget.Rectangle(c / 2 + b,c / 2 + a,h.width - c - g.width,h.height - c - g.height)
    },
    getImageBorderSize: function() {
        var a = this.getImageBorder();
        if (a) {
            return {
                width: (a.img_l.width + a.img_r.width),
                height: (a.img_t.height + a.img_b.height)
            }
        } else {
            return {
                width: 0,
                height: 0
            }
        }
    },
    _updateImageBorder: function() {
        var b = this.getImageBorder();
        var d = this.el.childNodes;
        for (var c = 1; c < 9; c++) {
            if (b) {
                var g = b["img_" + this._imageSort[c - 1]];
                var a = (g.url != undefined ? "url(" + g.url + ")" : "url(" + Display.getImageUrl(g.id) + ")");
                d[c].style.backgroundImage = a
            } else {
                d[c].style.backgroundImage = ""
            }
        }
        this._resize()
    },
    _resize: function(m, l) {
        var r = l || this.getBounds();
        var z = r.width;
        var t = r.height;
        var F = this.getBorderSize();
        var n = z - F;
        var C = t - F;
        var A = this.getImageBorder();
        if (A) {
            var c = n - A.img_l.width - A.img_r.width;
            var o = C - A.img_t.height - A.img_b.height;
            this._setImageBounds(this._body, A.img_l.width, A.img_t.height, c, o);
            this._setImageBounds(this.el.childNodes[1], 0, 0, A.img_lt.width, A.img_lt.height);
            this._setImageBounds(this.el.childNodes[2], A.img_lt.width, 0, n - A.img_lt.width - A.img_rt.width, A.img_t.height);
            var g = n - A.img_rt.width;
            this._setImageBounds(this.el.childNodes[3], g, 0, A.img_rt.width, A.img_rt.height);
            var p = n - A.img_r.width;
            var u = C - A.img_rt.height - A.img_rb.height;
            this._setImageBounds(this.el.childNodes[4], p, A.img_rt.height, A.img_rt.width, u);
            var a = n - A.img_rb.width;
            var G = C - A.img_rb.height;
            this._setImageBounds(this.el.childNodes[5], a, G, A.img_rb.width, A.img_rb.height);
            var E = C - A.img_b.height;
            var D = n - A.img_lb.width - A.img_rb.width;
            this._setImageBounds(this.el.childNodes[6], A.img_lb.width, E, D, A.img_b.height);
            var v = C - A.img_lb.height;
            this._setImageBounds(this.el.childNodes[7], 0, v, A.img_lb.width, A.img_lb.height);
            var q = C - A.img_lt.height - A.img_lb.height;
            q = q > 0 ? q : 0;
            this.el.childNodes[8].style.height = q + "px";
            this._setImageBounds(this.el.childNodes[8], 0, A.img_lt.height, A.img_l.width, q)
        } else {
            this._setImageBounds(this._body, 0, 0, n, C);
            var d = this.el.childNodes;
            for (var B = 1; B < 9; B++) {
                this._setImageBounds(d[B], 0, 0, 0, 0)
            }
        }
        DNA.widget.ImageBorderComposite.superclass._resize.call(this, m, l)
    },
    _setImageBounds: function(c, b, g, d, a) {
        b = b > 0 ? b : 0;
        g = g > 0 ? g : 0;
        d = d > 0 ? d : 0;
        a = a > 0 ? a : 0;
        c.style.left = b + "px";
        c.style.top = g + "px";
        c.style.width = d + "px";
        c.style.height = a + "px"
    },
    _setBackground: function(a) {
        DNA.engine.DomUtil.setStyle(this._body, "background-color", a)
    },
    _setBackimage: function(a) {
        if (a != null ) {
            DNA.engine.DomUtil.setStyle(this._body, "background-image", "url(" + a.url + ")")
        } else {
            DNA.engine.DomUtil.setStyle(this._body, "background-image", "")
        }
    }
});
Object.override(DNA.widget.ImageBorderComposite.prototype, {
    jtype: "ImageBorderComposite"
});
DNA.widget.Browser = function(a) {
    DNA.widget.Browser.superclass.constructor.call(this, a);
    this._loaded = false
}
;
DNA.widget.Browser.extend(DNA.widget.Control, {
    focusable: true,
    autoRender: true,
    _registEvents: function() {
        DNA.engine.application.getJWTEventMgr().addListener(DNA.JWTEvent.POST_ENABLED, this._doEnable, this);
        DNA.engine.application.getJWTEventMgr().addListener(DNA.JWTEvent.PRE_DISABLED, this._doDisable, this);
        this.addListener("load", this._doReload, this)
    },
    exeScript: function(script) {
        if (this.getEl()) {
            this.iframe.contentWindow.eval(script)
        }
    },
    _doBuildElements: function() {
        this.iframe = this.el.firstChild.nextSibling;
        DNA.engine.application.getJWTEventMgr().handleSelfEvent(this, "load", this.iframe)
    },
    _doReload: new DNA.engine.Action({
        handle: function() {
            var a = this.getInitData()[DNA.JWTProperty.PROPERTY_HANDLER_NAME];
            if (a) {
                this.setHandlerName(a)
            }
        }
    }),
    doDispose: function() {
        DNA.widget.Browser.superclass.doDispose.call(this);
        delete this.iframe
    },
    setHandlerName: function(b) {
        if (this.getEl()) {
            var d = this.iframe.contentWindow;
            var a = this.getEid();
            var c = this;
            d[b] = function() {
                var h = "";
                for (var g = 0; g < arguments.length; g++) {
                    if (g > 0) {
                        h = h + ","
                    }
                    h = h + arguments[g]
                }
                c.invoke(h)
            }
        }
    },
    handleDocumentEvent: function(a) {
        if (a && a.contentWindow.document) {
            DNA.engine.application.getJWTEventMgr().handleSelfEvent(this, "mousedown", a.contentWindow.document);
            a.contentWindow.document.ownerBrowserEl = this.getEl()
        }
    },
    invokes: function(m) {
        if (!this.getEl()) {
            return
        }
        var h = this.iframe.contentWindow;
        for (var g = 0, l = m.length; g < l; ++g) {
            var b = m[g];
            var o = b.name.split(".");
            var c = h;
            for (var d = 0, a = o.length; d < a; d++) {
                c = c[o[d]]
            }
            try {
                if (c) {
                    c(b.arg)
                }
            } catch (n) {
                if (DNA.JWTProperty.DEVOLOPE_MODE) {
                    alert("�쳣��" + n.toString() + "\n����Browser�ؼ��� " + b.name + " �����ĵ� " + n.lineNumber + " ��\n" + c)
                } else {
                    DNA.engine.application.alert("Browser�ؼ��ű�ִ���쳣������ϵϵͳ����Ա��")
                }
            }
        }
    },
    exeMethod: function(c, b) {
        if (this.getEl()) {
            var a = this.iframe.contentWindow;
            if (b) {
                return a[c].apply(a, b)
            } else {
                return a[c].apply(a, [])
            }
        }
        return null 
    },
    invoke: function(c) {
        var b = this;
        var a = function() {
            b.fireEvent(DNA.JWTEvent.ACTION, [b, c])
        }
        ;
        if (DNA.adapter.browserPage.getSynchronizeManager().getSynchronizeLifeCycle().isSynchronizing()) {
            DNA.adapter.browserPage.addFinalTask([a])
        } else {
            a()
        }
    },
    computeSize: function(g, b, l) {
        var c = new DNA.widget.Point();
        if (!g || !b || (g == DNA.JWT.DEFAULT && b == DNA.JWT.DEFAULT)) {
            var d = this.getEl().childNodes[1];
            try {
                c.x = d.contentWindow.document.body.style.width;
                c.y = d.contentWindow.document.body.style.height;
                if (!c.x || c.x.endsWith("%")) {
                    c.x = 200
                }
                if (!c.y || c.y.endsWith("%")) {
                    c.y = 200
                }
            } catch (h) {
                c.x = 200;
                c.y = 200
            }
        } else {
            if (g != DNA.JWT.DEFAULT) {
                c.x = g
            } else {
                c.x = 200
            }
            if (b != DNA.JWT.DEFAULT) {
                c.y = b
            } else {
                c.y = 200
            }
        }
        c.x = parseInt(c.x);
        c.y = parseInt(c.y);
        var a = this.getBorderSize();
        c.x += a;
        c.y += a;
        return c
    },
    setUrl: function(a) {
        if (this.getEl()) {
            this.iframe.src = a;
            this.addMouseEvent();
            this.reloadCause = DNA.JWT.URL
        }
    },
    getUrl: function() {
        if (this.getEl()) {
            return this.iframe.src
        }
    },
    addMouseEvent: function() {
        try {
            if (this.iframe.contentWindow.document) {
                DNA.engine.application.getJWTEventMgr().handleSelfEvent(this, "mousedown", this.iframe.contentWindow.document);
                this.iframe.contentWindow.document.ownerBrowserEl = this.getEl()
            }
        } catch (a) {}
    },
    getIframe: function() {
        return this.el.firstChild
    },
    setHtml: function(a) {
        if (this.getEl()) {
            this.iframe.contentWindow.document.open();
            this.iframe.contentWindow.document.write(a);
            this.iframe.contentWindow.document.close();
            this.addMouseEvent();
            this.el._loaded = true;
            this.htmlReloadCause = DNA.JWT.HTML
        }
    },
    getElementBound: function(h) {
        var g = this.getEl().firstChild;
        if (h == "") {
            var a = g.contentWindow.document.body;
            if (!a) {
                return null 
            }
            var d = DNA.engine.DomUtil.getSize(a);
            return {
                x: 0,
                y: 0,
                width: DNA.engine.Client.isIE() ? a.scrollWidth : d.width,
                height: DNA.engine.Client.isIE() ? a.scrollHeight : (d.height + 25)
            }
        }
        var c = g.contentWindow.document.getElementById(h);
        if (!c) {
            return null 
        }
        var d = DNA.engine.DomUtil.getSize(c);
        var b = DNA.engine.DomUtil.getPageXY(c);
        return {
            x: b.x,
            y: b.y,
            width: d.width,
            height: d.height
        }
    },
    setBodyMargin: function(g, c, d, b) {
        var h = this.getEl().firstChild;
        var a = h.contentWindow.document.body;
        if (a) {
            if (d) {
                a.topMargin = d + "px"
            }
            if (c) {
                a.rightMargin = c + "px"
            }
            if (b) {
                a.bottomMargin = b + "px"
            }
            if (g) {
                a.leftMargin = g + "px"
            }
        }
    },
    _doEnable: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            if (a.isAncestorOf(this)) {
                this._processDisabled(false)
            }
        }
    }),
    _doDisable: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            if (a.isAncestorOf(this)) {
                this._processDisabled(true)
            }
        }
    }),
    _processDisabled: function(a) {
        if (a) {
            this.el.firstChild.style.width = "100%";
            this.el.firstChild.style.height = "100%"
        } else {
            this.el.firstChild.style.width = "0";
            this.el.firstChild.style.height = "0"
        }
    },
    setBodyScroll: function(b) {
        var c = this.getEl().firstChild;
        var a = c.contentWindow.document.body;
        if (a) {
            a.scroll = b
        }
    }
});
Object.override(DNA.widget.Browser.prototype, {
    jtype: "Browser"
});
DNA.widget.ProgressBar = function(a) {
    DNA.widget.ProgressBar.superclass.constructor.call(this, a);
    this._initRender()
}
;
DNA.widget.ProgressBar.extend(DNA.widget.Control, {
    autoRender: true,
    _registEvents: function() {
        DNA.widget.ProgressBar.superclass._registEvents.call(this);
        DNA.engine.application.getJWTEventMgr().addListener(DNA.JWTEvent.PREDISPOSE, this._doPreDispose, this)
    },
    setMaximum: function(a) {
        if (this._minimum > a || this._minimum == a) {
            alert("������ֵ����С�ڻ������С����ֵ")
        } else {
            this._maximum = a
        }
    },
    getMaximum: function() {
        if (this._maximum == undefined) {
            this._maximum = this.getInitData()[DNA.JWTProperty.PROPERTY_MAXIMUM] || 100;
            delete this.getInitData()[DNA.JWTProperty.PROPERTY_MAXIMUM]
        }
        return this._maximum
    },
    setMinimum: function(a) {
        if (a > this._maximum || a == this._maximum) {
            alert("��С����ֵ���ܴ��ڻ����������ֵ")
        } else {
            this._minimum = a
        }
    },
    getMinimum: function() {
        if (this._minimum == undefined) {
            this._minimum = this.getInitData()[DNA.JWTProperty.PROPERTY_MINIMUM] || 0;
            delete this.getInitData()[DNA.JWTProperty.PROPERTY_MINIMUM]
        }
        return this._minimum
    },
    setSelection: function(a) {
        if (this.getMinimum() > this.getMaximum()) {
            return
        }
        this._selection = a;
        if (this.getMinimum() == this.getMaximum()) {
            this._selection = this.getMinimum()
        }
        if (this._selection > this.getMaximum()) {
            this._selection = this.getMaximum()
        }
        if (this._selection < this.getMinimum()) {
            this._selection = this.getMinimum()
        }
        this._renderProgressBar(this._selection)
    },
    getSelection: function() {
        if (this._selection == undefined) {
            this._selection = this.getInitData()[DNA.JWTProperty.PROPERTY_SELECTION] || 0;
            delete this.getInitData()[DNA.JWTProperty.PROPERTY_SELECTION]
        }
        return this._selection
    },
    _setBorder: function() {},
    computeSize: function(c, a, d) {
        var b = new DNA.widget.Point();
        if (c != -1) {
            b.x = c
        } else {
            b.x = this._getPerfectSize().x
        }
        if (a != -1) {
            b.y = a
        } else {
            b.y = this._getPerfectSize().y
        }
        return b
    },
    _getPerfectSize: function() {
        if ((this.getStyle() & DNA.JWT.VERTICAL) != 0) {
            return new DNA.widget.Point(18,170)
        } else {
            return new DNA.widget.Point(170,18)
        }
    },
    _resize: function() {
        var a = this.getBounds();
        var d = this.getBorderSize();
        var c = a.width - d - 2;
        var g = a.height - d - 2;
        if (c >= 0 && g >= 0) {
            DNA.engine.DomUtil.setStyle(this.el.firstChild, "width", c + "px");
            DNA.engine.DomUtil.setStyle(this.el.firstChild, "height", g + "px");
            this._textBody.style.lineHeight = a.height + 1 + "px"
        }
    },
    _renderProgressBar: function(a) {
        this.checkRendered(true);
        var b = (a - this.getMinimum()) / (this.getMaximum() - this.getMinimum()) * 100;
        this._barBody.style.display = "";
        if (this.getStyle() & DNA.JWT.VERTICAL) {
            DNA.engine.DomUtil.setStyle(this._barBody, "height", b + "%");
            if (a == 0) {
                this._barBody.style.display = "none"
            } else {
                this._barBody.style.display = "block"
            }
        } else {
            DNA.engine.DomUtil.setStyle(this._barBody, "width", b + "%")
        }
        this._textBody.innerHTML = parseInt(b) + "%"
    },
    _doBuildElements: function() {
        var b = this.el.firstChild.firstChild;
        var a = b.childNodes[1].childNodes[1];
        this._barBody = a.firstChild.firstChild;
        this._textBody = a.childNodes[1]
    },
    _initRender: function() {
        if (this.getStyle() & DNA.JWT.INDETERMINATE) {
            if (this.getMaximum() > this.getMinimum()) {
                this._thread = new DNA.engine.Thread(100,new DNA.engine.Runnable(this._autoRenderSel,this));
                this._thread.start()
            }
        }
    },
    _autoRenderSel: function() {
        var a = (this.getMaximum() - this.getMinimum()) / 40;
        var b = this.getSelection() + a;
        if (b > this.getMaximum()) {
            b = this.getMinimum()
        }
        this.setSelection(b)
    },
    _cancelThread: function() {
        if (this._thread) {
            this._thread.stop();
            this._thread = null 
        }
    },
    _doPreDispose: new DNA.engine.Action({
        handle: function(a) {
            if (a.isAncestorOf(this)) {
                this._cancelThread()
            }
        }
    }),
    _setFont: function(a) {
        DNA.engine.DomUtil.setFont(this._textBody, a)
    },
    _setForeground: function(a) {
        DNA.engine.DomUtil.setStyle(this._textBody, "color", a)
    },
    doDispose: function() {
        this._cancelThread();
        DNA.widget.ProgressBar.superclass.doDispose.call(this);
        delete this._barBody;
        delete this._textBody
    }
});
Object.override(DNA.widget.ProgressBar.prototype, {
    jtype: "ProgressBar",
    focusable: false,
    _defaultBorder: new DNA.widget.Border(1,"gray","solid")
});
if (!window.console) {
    window.console = {}
}
if (!console.log) {
    console.log = Function.emptyFunction
}
if (!console.error) {
    console.error = Function.emptyFunction
}
if (!console.info) {
    console.info = Function.emptyFunction
}
if (!console.debug) {
    console.debug = Function.emptyFunction
}
if (!console.warn) {
    console.warn = Function.emptyFunction
}
if (!console.dir) {
    console.dir = Function.emptyFunction
}
DNA.widget.Listrace = {
    KEY_UP: 38,
    KEY_DOWN: 40,
    KEY_LEFT: 37,
    KEY_RIGHT: 39,
    KEY_PAGEUP: 33,
    KEY_PAGEDOWN: 34,
    supportKey: {
        "33": true,
        "34": true,
        "37": true,
        "38": true,
        "39": true,
        "40": true
    },
    getNodeByChild: function(g, b, d) {
        d = d || 5;
        var a = g;
        if (b instanceof Array) {
            while (d-- >= 0) {
                for (var c = b.length - 1; c >= 0; c--) {
                    if (DNA.engine.DomUtil.hasClass(a, b[c])) {
                        return a
                    }
                }
                a = a.parentNode;
                if (a.nodeType == 9) {
                    return null 
                }
            }
        } else {
            while (d-- >= 0) {
                if (DNA.engine.DomUtil.hasClass(a, b)) {
                    return a
                }
                a = a.parentNode;
                if (a.nodeType == 9) {
                    return null 
                }
            }
        }
        return null 
    },
    setScrollPostitonByKeyCode: function(g, c, b) {
        var a = g.offsetHeight
          , d = g.offsetWidth;
        if (a < 5 || d < 5) {
            return
        }
        var h = (g.scrollHeight - a);
        if (h <= 0) {
            return
        }
        b = b || 0;
        h = a - b;
        if (c) {
            g.scrollTop = g.scrollTop - h
        } else {
            g.scrollTop = g.scrollTop + h
        }
    },
    setScrollPosition: function(o, m, b, g) {
        var p = o.offsetHeight;
        if (p == 0) {
            return
        } else {
            g.initedScroll = true
        }
        var n = (o.scrollHeight - p);
        n = (o.scrollWidth - o.offsetWidth);
        var h = (o.scrollWidth - o.offsetWidth) > 0;
        b = b || 0;
        if ((o.scrollHeight > p) && m != null ) {
            var d = DNA.engine.DomUtil.getPageXY(m);
            var l = DNA.engine.DomUtil.getPageXY(o);
            var c = l.y + b;
            var a = l.y + p - 15 - (h ? 20 : 0);
            if (d.y < c || d.y > a) {
                o.scrollTop = o.scrollTop + (d.y - c);
                return true
            }
        }
        return false
    },
    before: function(c, a) {
        var b = function() {
            var d;
            d = b.advice.apply(this, arguments);
            if (d !== false) {
                b.src.apply(this, arguments)
            }
        }
        ;
        b.src = c;
        b.advice = a;
        return b
    },
    after: function(c, a) {
        var b = function() {
            var d;
            d = b.src.apply(this, arguments);
            if (d !== false) {
                b.advice.apply(this, arguments)
            }
        }
        ;
        b.src = c;
        b.advice = a;
        return b
    },
    replace: function(c, b) {
        var a = function() {
            b.apply(this, arguments)
        }
        ;
        a.src = c;
        return a
    },
    filterEvent: function(b) {
        if (b.getButton() == DNA.JWTEvent.BUTTON_MIDDLE) {
            return false
        }
        var d = b.getSrcControl();
        if (d instanceof DNA.widget.Iteration) {
            d.checkRendered(true)
        }
        var a = b.getSrcWidget();
        if (a instanceof DNA.widget.Item) {
            a.checkRendered(true)
        }
    },
    _selectionListener: function(n, m) {
        var g = "";
        if (n.getSelectedIds) {
            g = n.getSelectedIds();
            if (g != "") {
                this.recordUpdate(n.getEid(), DNA.JWTProperty.PROPERTY_SELECTION, g)
            }
        } else {
            var c = n.getSelected();
            if (c) {
                for (var d = 0; d < c.length; d++) {
                    var h = c[d];
                    if (d != 0) {
                        g += ","
                    }
                    g += h.getEid()
                }
            }
            if (g != "") {
                this.recordUpdate(n.getEid(), DNA.JWTProperty.PROPERTY_SELECTION_MODEL, g)
            }
        }
        if (this.getWrapper(n)._fireClientSelectionEvent(m)) {
            return
        }
        if (this.hasServerListener(n, DNA.JWTProperty.PROPERTY_SELECTIONLISTENER)) {
            var a = (m.getButton() == DNA.JWTEvent.BUTTON_RIGHT) && n.getMenu() != null ;
            var l = this.hasServerListener(n, DNA.JWTProperty.PROPERTY_MOUSEDBLCLICKLISTENER) || a;
            this.notifyAction(m, n, DNA.JWTProperty.INPUT_SELECTED_EVENT, null , l)
        }
    },
    _checkListener: function(d, b, c) {
        var h, g;
        if (b instanceof DNA.widget.Item) {
            h = b.isChecked();
            g = b.getEid();
            this.recordUpdate(g, DNA.JWTProperty.PROPERTY_CHECK, h);
            if (this.getWrapper(d)._fireClientCheckEvent(this.getWrapper(b), c)) {
                return
            }
            if (this.hasServerListener(d, DNA.JWTProperty.PROPERTY_CHECKLISTENER)) {
                var a = new DNA.adapter.ActionValueBuilder();
                a.setItemEid(g);
                this.notifyAction(c, d, DNA.JWTProperty.INPUT_CHECK_EVENT, a)
            }
        } else {
            h = d.isChecked(b);
            g = b;
            this.getWrapper(d)._fireClientCheckEvent(g, c)
        }
    },
    _nodeClickListener: function(b, a) {
        this.getWrapper(b)._fireClientNodeClickEvent(a)
    },
    _nodeDBClickListener: function(b, a, c) {
        if ((a.getButton() === 0) && DNA.adapter.browserPage._mousedownWidget == b) {
            this.getWrapper(b)._fireClientNodeDBClickEvent(a, c)
        }
    },
    _itemMouseListener: function(c, b, a) {
        this.getWrapper(c)._fireItemMouseEvent(b, a)
    },
    _selectionchangingListener: function(d) {
        var c = d.control;
        if (this.hasServerListener(c, DNA.JWTProperty.PROPERTY_SELECTIONCHANGINGLISTENER)) {
            d.doit = false;
            var a = new DNA.adapter.ActionValueBuilder();
            a.setCustom1(d.item.id || d.item.getEid());
            if (d.last) {
                a.setCustom2(d.last.getEid())
            }
            var b = this.hasServerListener(c, DNA.JWTProperty.PROPERTY_MOUSEDBLCLICKLISTENER);
            this.notifyAction(d.event, c, DNA.JWTProperty.INPUT_SELECTIONCHANGING_EVENT, a, b)
        }
    },
    createEnd: function(c) {
        var g = DNA.widget.WidgetRegistry.get(c);
        var a = g.getInitData()[DNA.JWTProperty.PROPERTY_SELECTION_MODEL] || g._selection_model;
        if (a) {
            a = a.split(",");
            var b = new Array(a.length);
            for (var d = 0; d < a.length; d++) {
                b[d] = DNA.widget.WidgetRegistry.get(a[d])
            }
            g.selectItems(b, true);
            delete g.getInitData()[DNA.JWTProperty.PROPERTY_SELECTION_MODEL];
            delete g._selection_model
        }
    },
    lwcreateEnd: function(a) {
        var c = DNA.widget.WidgetRegistry.get(a);
        c.selectNodes = [];
        var b = c._getInitData()["selection"];
        if (b) {
            c.doSelectIds(b, true)
        }
    },
    updateEnd: function() {},
    evalProcessor: function(widget, value) {
        if (!value) {
            return
        }
        value = value.replace(/\\/g, "\\\\");
        widget.__widget = widget;
        with (widget) {
            eval(value)
        }
        delete widget.__widget
    },
    selectionProcessor: function(d, c) {
        c = c || "";
        eidArray = c.split(",");
        var a = new Array(eidArray.length);
        for (var b = 0; b < eidArray.length; b++) {
            a[b] = DNA.widget.WidgetRegistry.get(eidArray[b])
        }
        d.selectItems(a, false)
    },
    setLastMouseSelection: function(b, a) {
        b.setLastMouseSelection(DNA.widget.WidgetRegistry.get(a))
    },
    bindProcessor: function(a, c, d) {
        var b = function(h, g) {
            h[c](g)
        }
        ;
        d.addProcessor(a, b)
    }
};
DNA.widget.Listrace.fn = {
    autoRender: true,
    addListener2: function(b, a, d) {
        var c = new DNA.engine.Action({
            handle: a
        });
        d = d || this;
        this.addListener(b, c, d)
    },
    addGlobalListener: function(b, a, d) {
        var c = new DNA.engine.Action({
            handle: a
        });
        d = d || this;
        DNA.engine.application.getJWTEventMgr().addListener(b, c, d)
    },
    addDomListener: function(d, b, a, c) {
        c = c || this;
        DNA.engine.application.getJWTEventMgr().handleSelfEvent(this, b, d);
        this.addListener2(b, a, c)
    },
    _focus: function() {
        if (this instanceof DNA.widget.List || this instanceof DNA.widget.LWList) {
            DNA.engine.DomUtil.addClass(this.getBody(), "focus")
        } else {
            DNA.engine.DomUtil.addClass(this.getEl(), "focus")
        }
        DNA.widget.Iteration.prototype._focus.call(this)
    },
    _blur: function() {
        if (this instanceof DNA.widget.List || this instanceof DNA.widget.LWList) {
            DNA.engine.DomUtil.removeClass(this.getBody(), "focus")
        } else {
            DNA.engine.DomUtil.removeClass(this.getEl(), "focus")
        }
    },
    getChildren: function(b) {
        var a = DNA.widget.WidgetRegistry.getChildren(this, b);
        if (a == null ) {
            if (b === undefined) {
                return []
            }
            return null 
        }
        return a
    },
    _getInitData: function() {
        return this.getInitData()
    },
    _onKeydown: function(b) {
        b._preventDefault();
        var a = 0;
        switch (b.getKeyCode()) {
        case DNA.widget.Listrace.KEY_UP:
            this._selectByKey(DNA.widget.Listrace.KEY_UP, b);
            break;
        case DNA.widget.Listrace.KEY_DOWN:
            this._selectByKey(DNA.widget.Listrace.KEY_DOWN, b);
            break;
        case DNA.widget.Listrace.KEY_LEFT:
            this._selectByKey(DNA.widget.Listrace.KEY_LEFT, b);
            break;
        case DNA.widget.Listrace.KEY_RIGHT:
            this._selectByKey(DNA.widget.Listrace.KEY_RIGHT, b);
            break;
        case DNA.widget.Listrace.KEY_PAGEUP:
            if (this instanceof DNA.widget.Table || this instanceof DNA.widget.LWTable) {
                a = 21
            }
            DNA.widget.Listrace.setScrollPostitonByKeyCode(this.getEl(), true, a);
            break;
        case DNA.widget.Listrace.KEY_PAGEDOWN:
            if (this instanceof DNA.widget.Table || this instanceof DNA.widget.LWTable) {
                a = 21
            }
            DNA.widget.Listrace.setScrollPostitonByKeyCode(this.getEl(), false, a);
            break
        }
    }
};
DNA.widget.Listrace.itemfn = {
    _getInitData: function() {
        return this.getInitData()
    },
    autoRender: true
};
DNA.widget.List = function(a) {
    DNA.widget.List.superclass.constructor.call(this, a);
    this.hoverd = null ;
    this.initedScroll = false
}
;
DNA.widget.List.extend(DNA.widget.Iteration, {
    setScrollPosition: function() {
        if (this._selected != null  && this._selected.length > 0) {
            var a = this._selected[0];
            DNA.widget.Listrace.setScrollPosition(this.getEl(), a.getEl(), 0, this)
        }
    },
    setVerticalPosition: function(a) {
        this.getEl().scrollTop = a
    },
    setHorizontalPosition: function(a) {
        this.getEl().scrollLeft = a
    },
    _resize: function() {
        if (this.initedScroll === false) {
            this.setScrollPosition()
        }
    },
    computeItemSize: function(h) {
        var g = DNA.engine.DomUtil.getInnerText(h.childNodes[2]);
        var a = h.childNodes[1].innerHTML;
        var c = new DNA.widget.Point(0,0);
        var b = (this.getStyle() & DNA.JWT.CHECK) != 0;
        var d = DNA.engine.DomUtil.computeTextSize(g);
        c.x = d.width;
        c.y = d.height > 18 ? d.height : 18;
        if (b) {
            c.x += 18
        }
        if (a != "") {
            c.x += 18
        }
        return c
    },
    computeSize: function(d, n, h) {
        if (d != -1 && n != -1) {
            return new DNA.widget.Point(d,n)
        }
        var b = 0;
        var m = this.getEl().firstChild.childNodes.length;
        if (m == 0) {
            if (d != -1) {
                return new DNA.widget.Point(d,0)
            }
            if (n != -1) {
                return new DNA.widget.Point(0,n)
            }
            return new DNA.widget.Point(b,0)
        }
        var a = this.getEl().firstChild.childNodes[0].offsetHeight;
        if (a == 0) {
            var o = this.computeItemSize(this.getEl().firstChild.childNodes[0]);
            a = o.y
        }
        var l = 0;
        var c = this.getChildren();
        for (var g = 0; g < m; g++) {
            var o = this.computeItemSize(this.getEl().firstChild.childNodes[g]);
            l += o.y;
            if (o.x + 2 > b) {
                b = o.x + 2
            }
            if (m > 100) {
                if (d != -1) {
                    b = d
                }
                l = a * m + 2;
                if (n != -1) {
                    l = n
                }
                return new DNA.widget.Point(DNA.engine.application.isAnimated() ? (b + 5) : b,l)
            }
        }
        l += 2;
        if (d != -1) {
            if (b > d) {
                l += 18
            }
            b = d
        }
        if (n != -1) {
            if (l > n) {
                b += 18
            }
            l = n
        }
        return new DNA.widget.Point(DNA.engine.application.isAnimated() ? (b + 5) : b,l)
    },
    _selectByKey: function(b, c) {
        if (!DNA.widget.Listrace.supportKey["" + b]) {
            return
        }
        var a = this.getSelected();
        if (a == null  || a.length <= 0) {
            if (b == DNA.widget.Listrace.KEY_DOWN) {
                a = DNA.widget.WidgetRegistry.getChildren(this, 0);
                if (a) {
                    var d = {
                        doit: true,
                        control: this,
                        item: a
                    };
                    this.fireEvent("selectionchanging", [d]);
                    if (d.doit === false) {
                        return
                    }
                    this.selectItems([a]);
                    this.fireEvent("selection", [this, c])
                }
            }
            return
        }
        a = a[0];
        a = DNA.widget.WidgetRegistry.indexOf(this, a);
        if (a == -1) {
            return
        }
        if (b == DNA.widget.Listrace.KEY_UP || b == DNA.widget.Listrace.KEY_LEFT) {
            a--
        } else {
            a++
        }
        if (a < 0 || a >= DNA.widget.WidgetRegistry.getChildrenCount(this)) {
            return
        }
        a = DNA.widget.WidgetRegistry.getChildren(this, a);
        var d = {
            doit: true,
            control: this,
            item: a
        };
        this.fireEvent("selectionchanging", [d]);
        if (d.doit === false) {
            return
        }
        this.selectItems([a]);
        this.fireEvent("selection", [this, c])
    },
    _registEvents: function() {
        this.addListener2(DNA.JWTEvent.MOUSEDOWN, this._onMousedown);
        if (this.getStyle() & DNA.JWT.MULTI) {
            this.addListener2(DNA.JWTEvent.MOUSEUP, this._onMouseup)
        }
        this.addListener2(DNA.JWTEvent.MOUSEMOVE, this._onMousemove);
        this.addListener2(DNA.JWTEvent.MOUSEOUT, this._onMouseout);
        this.addListener2(DNA.JWTEvent.DRAGOVER, this._onDragover);
        this.addListener2(DNA.JWTEvent.KEYDOWN, this._onKeydown)
    },
    _onMousedown: function(b) {
        var a = b.getSrcWidget();
        if (a && a != this && a.isEnabled()) {
            if ((this.getStyle() & DNA.JWT.CHECK) && a.isBoxEl(b.getSrcElement())) {
                a._animatedCheck();
                a.setChecked(!a.isChecked());
                this.fireEvent("check", [this, a, b])
            } else {
                if ((this.getStyle() & DNA.JWT.MULTI) && a.isSelected() && this.getDragHandler() != undefined) {
                    this._acceptUp = true
                } else {
                    this._justSelectItem(a, b)
                }
                this._fireNodeClickEvent(b)
            }
        }
    },
    _onMouseup: function(b) {
        var a = b.getSrcWidget();
        if (a && a != this && a.isEnabled() && this._acceptUp) {
            delete this._acceptUp;
            this._justSelectItem(a, b)
        }
    },
    _justSelectItem: function(b, d) {
        var g = {
            doit: true,
            control: this,
            item: b,
            last: this.getLastMouseSelection(),
            event: d
        };
        this.fireEvent("selectionchanging", [g]);
        if (g.doit === false) {
            return
        }
        if (this.getStyle() & DNA.JWT.MULTI) {
            var c = this.getLastMouseSelection();
            if (d.isShift() && c) {
                var a = this.indexOf(b.getEid());
                var h = this.indexOf(c.getEid());
                this.selectRange(h, a)
            } else {
                if (d.isCtrl()) {
                    if (this._selected.indexOf(b) != -1) {
                        this.unselect(b)
                    } else {
                        this._selectItem(b)
                    }
                    this.setLastMouseSelection(b)
                } else {
                    this.select(b);
                    this.setLastMouseSelection(b)
                }
            }
        } else {
            if (this.getStyle() & DNA.JWT.SINGLE) {
                this.select(b);
                this.setLastMouseSelection(b)
            }
        }
        this.fireEvent("selection", [this, d])
    },
    _fireNodeClickEvent: function(a) {
        this.fireEvent("nodeClick", [this, a])
    },
    _onMousemove: function(b) {
        var a = b.getSrcWidget();
        if (a instanceof DNA.widget.ListItem) {
            this._setHover(a)
        }
    },
    _onMouseout: function(a) {
        this._removeHover()
    },
    _setHover: function(a) {
        if (a != this.hoverd) {
            this._removeHover();
            if (a) {
                DNA.engine.DomUtil.addClass(a.getEl(), "hover");
                this.hoverd = a;
                a._animatedHover()
            }
        }
    },
    _removeHover: function() {
        if (this.hoverd) {
            var a = this.hoverd;
            delete this.hoverd;
            DNA.engine.DomUtil.removeClass(a.getEl(), "hover");
            a._animatedUnhover()
        }
    },
    _onDragover: function(c) {
        this.posInfo = "";
        if (!this.getEl()) {
            return
        }
        var b = c.getXY();
        var a = DNA.engine.DomUtil.getPageXY(this.getEl());
        a = {
            x: b.x - a.x,
            y: b.y - a.y
        };
        a = this.getItembyPoint(a.x, a.y);
        if (a) {
            this.posInfo = a.getEid()
        }
    },
    _doBuildElements: function() {
        this._body = this.body = this.el.firstChild
    },
    clear: function() {
        this.getEl().firstChild.innerHTML = "";
        this._selected = [];
        this.hoverd = null ;
        this._lastMouseSelection = null ;
        DNA.widget.List.superclass.clear.call(this)
    },
    removeAll: function() {
        this.clear()
    },
    indexOf: function(b) {
        for (var c = 0, a = this.getEl().firstChild.childNodes.length; c < a; c++) {
            if (this.getEl().firstChild.childNodes[c].id == b) {
                return c
            }
        }
        return -1
    },
    _selectItem: function(a, b) {
        if (!isNaN(a)) {
            a = DNA.widget.WidgetRegistry.getChildren(this, a)
        }
        if (!b) {
            a._select()
        }
        this._selected.push(a)
    },
    remove: function(a) {
        var b = DNA.widget.WidgetRegistry.get(a);
        if (b) {
            this._selected.remove(b);
            b.dispose(true)
        }
    },
    getItembyPoint: function(b, m) {
        var a = this.getEl().firstChild.childNodes.length;
        var g = b
          , d = m;
        var l = DNA.engine.DomUtil.getPageXY(this.getEl());
        g += l.x;
        d += l.y;
        for (var c = 0; c < a; c++) {
            var h = DNA.widget.WidgetRegistry.getChildren(this, c);
            if (this._compareItemPoint(h, g, d)) {
                return h
            }
        }
        return null 
    },
    _compareItemPoint: function(d, c, b) {
        var g = DNA.engine.DomUtil.getPageXY(d.el);
        var a = DNA.engine.DomUtil.getSize(d.el);
        if (c >= g.x && b >= g.y && c <= (g.x + a.width) && b <= (g.y + a.height)) {
            return true
        }
        return false
    },
    doDispose: function() {
        delete this._selected;
        DNA.widget.List.superclass.doDispose.apply(this, arguments)
    }
});
Object.override(DNA.widget.List.prototype, {
    jtype: "List",
    focusable: true
});
Object.override(DNA.widget.List.prototype, DNA.widget.Listrace.fn);
DNA.widget.List.prototype._onMousedown = DNA.widget.Listrace.before(DNA.widget.List.prototype._onMousedown, DNA.widget.Listrace.filterEvent);
DNA.widget.ListItem = function(a) {
    DNA.widget.ListItem.superclass.constructor.call(this, a)
}
;
DNA.widget.ListItem.extend(DNA.widget.Item, {
    __init: function() {
        if (this.getParent().getStyle() & DNA.JWT.CHECK) {
            var a = this._boxEl.className;
            if (a.indexOf("on") >= 0) {
                this._checked = true
            } else {
                this._checked = false
            }
            if (a.indexOf("gray") >= 0) {
                this._grayed = true
            } else {
                this._grayed = false
            }
        }
    },
    setText: function(a) {
        DNA.engine.DomUtil.setInnerText(this._textEl, a)
    },
    getText: function() {
        var a = DNA.engine.DomUtil.getInnerText(this._textEl);
        if (a) {
            a = a.replace(/\u00A0/g, " ")
        }
        return a
    },
    setImage: function(a) {
        if (a) {
            a = DNA.widget.ParserTools.parseImg(a)
        }
        this._image = a;
        this._imageEl.innerHTML = a ? a.getHTML() : ""
    },
    setChecked: function(a) {
        if (a === true) {
            if (this._grayed) {
                this._boxEl.className = "gray-on"
            } else {
                this._boxEl.className = "check-on"
            }
        } else {
            if (a === false) {
                if (this._grayed) {
                    this._boxEl.className = "gray-off"
                } else {
                    this._boxEl.className = "check-off"
                }
            }
        }
        this._checked = a
    },
    isChecked: function() {
        return this._checked
    },
    setGrayed: function(a) {
        if (a === true) {
            if (this._checked) {
                this._boxEl.className = "gray-on"
            } else {
                this._boxEl.className = "gray-off"
            }
            this._grayed = true
        } else {
            if (this._checked) {
                this._boxEl.className = "check-on"
            } else {
                this._boxEl.className = "check-off"
            }
            this._grayed = false
        }
    },
    isGrayed: function() {
        return this._grayed
    },
    isBoxEl: function(a) {
        return this._boxEl == a
    },
    isNodeEl: function(a) {
        return this._textEl == a || this._imageEl == a
    },
    _doBuildElements: function() {
        this._boxEl = this.el.firstChild;
        this._imageEl = this.el.childNodes[1];
        this._textEl = this.el.childNodes[2];
        this._dataEl = this.el.lastChild;
        this.__init()
    },
    doDispose: function() {
        delete this._imageEl;
        delete this._boxEl;
        delete this._textEl;
        delete this._dataEl;
        delete this.parent;
        delete this.el;
        delete this._wrapper;
        delete this.data;
        delete this._dataMap;
        DNA.widget.ListItem.superclass.doDispose.apply(this, arguments)
    },
    _select: function() {
        DNA.engine.DomUtil.addClass(this.getEl(), "selected")
    },
    isSelected: function() {
        return DNA.engine.DomUtil.hasClass(this.getEl(), "selected")
    },
    _unselect: function() {
        if (!this.getEl()) {
            return
        }
        DNA.engine.DomUtil.removeClass(this.getEl(), "selected")
    }
});
Object.override(DNA.widget.ListItem.prototype, {
    jtype: "ListItem"
});
Object.override(DNA.widget.ListItem.prototype, DNA.widget.Listrace.itemfn);
DNA.widget.Table = function(a) {
    DNA.widget.Table.superclass.constructor.call(this, a);
    this.hoverd = null ;
    this.initedScroll = false
}
;
DNA.widget.Table.extend(DNA.widget.Iteration, {
    setScrollPosition: function() {
        if (this._selected != null  && this._selected.length > 0) {
            var a = this._selected[0];
            if (DNA.widget.Listrace.setScrollPosition(this.el, a.el, 21, this)) {
                this._onScroll()
            }
        }
    },
    setVerticalPosition: function(a) {
        this.getEl().scrollTop = a
    },
    setHorizontalPosition: function(a) {
        this.getEl().scrollLeft = a
    },
    _resize: function() {
        if (this.initedScroll === false) {
            this.setScrollPosition()
        }
    },
    _updateWidths: function() {
        var b = this._headerEl.firstChild.childNodes;
        if (b) {
            var c = this._headerEl.lastChild.childNodes;
            if (c) {
                for (var a = 0; a < b.length; a++) {
                    c[a].style.width = parseInt(b[a].style.width) + 1 + "px"
                }
            }
        }
    },
    _setForeground: function(a) {
        this.el.style.color = a || "";
        this.table.style.color = a || "";
        this.fixedTable.style.color = a || ""
    },
    _setFont: function(a) {
        DNA.engine.DomUtil.setFont(this.el, a);
        DNA.engine.DomUtil.setFont(this.table, a);
        DNA.engine.DomUtil.setFont(this.fixedTable, a)
    },
    _setBackground: function(b) {
        this.checkRendered(true);
        if (b) {
            var a = b.toLocaleUpperCase();
            if (a == "WHITE" || a == "#FFFFFF") {
                this.el.style.backgroundColor = ""
            } else {
                this.el.style.backgroundColor = b
            }
        } else {
            this.el.style.backgroundColor = ""
        }
        this.fixedTable.style.backgroundColor = b || "";
        this.table.style.backgroundColor = b || ""
    },
    clear: function() {
        while (this.body.childNodes.length > 0) {
            this.body.removeChild(this.body.childNodes[0])
        }
        this._selected = [];
        DNA.widget.Table.superclass.clear.call(this)
    },
    removeAll: function() {
        this.clearInterval()
    },
    _selectItem: function(a, b) {
        if (!isNaN(a)) {
            a = DNA.widget.WidgetRegistry.getChildren(this, a)
        }
        if (!b) {
            a._select()
        }
        this._selected.push(a)
    },
    remove: function(a) {
        var b = DNA.widget.WidgetRegistry.get(a);
        if (b) {
            this._selected.remove(b);
            b.dispose(true)
        }
    },
    computeSize: function(d, o, h) {
        this.checkRendered(true);
        if (d != -1 && o != -1) {
            return new DNA.widget.Point(d,o)
        }
        var q = new DNA.widget.Point();
        var c = this.getHeaderVisible();
        var l = 0;
        if (c) {
            l = this._headerEl.offsetHeight
        }
        var b = this.el.offsetWidth;
        var n = this.body.childNodes.length;
        if (n == 0) {
            if (d != -1) {
                b = d
            }
            if (o != -1) {
                l = o
            }
            return new DNA.widget.Point(b,l)
        }
        var a = this.body.childNodes[0].offsetHeight;
        if (n > 100) {
            var p = n * a + 2 + l;
            if (d != -1) {
                b = d
            }
            if (o != -1) {
                p = o
            }
            return new DNA.widget.Point(b,p)
        }
        var m = 0;
        for (var g = 0; g < n; g++) {
            m += this.body.childNodes[g].offsetHeight;
            if (this.body.childNodes[g].offsetWidth + 2 > b) {
                b = this.body.childNodes[g].offsetWidth + 2
            }
        }
        var p = m + 2 + l;
        if (d != -1) {
            b = d
        }
        if (o != -1) {
            p = o
        }
        return new DNA.widget.Point(b,p)
    },
    getColumnCount: function() {
        return this._headerEl.firstChild.childNodes.length
    },
    setHeaderHeight: function(a) {
        DNA.engine.DomUtil.setStyle(this._headerEl.firstChild, "height", a + "px");
        DNA.engine.DomUtil.setStyle(this.fixedHeader.firstChild, "height", a + "px")
    },
    setItemHeight: function(b) {
        var d = this.body.childNodes;
        for (var c = 0, a = d.length; c < a; c++) {
            var g = d[c];
            DNA.engine.DomUtil.setStyle(g, "height", b + "px")
        }
    },
    setHeaderVisible: function(a) {
        DNA.engine.DomUtil.setStyle(this._headerEl.firstChild, "display", a ? "" : "none");
        DNA.engine.DomUtil.setStyle(this.fixedHeader.firstChild, "display", a ? "" : "none");
        if (!DNA.engine.Client.isIE()) {
            if (a) {
                DNA.engine.DomUtil.removeClass(this.fixedHeader, "theadForFF");
                DNA.engine.DomUtil.removeClass(this._headerEl, "theadForFF")
            } else {
                DNA.engine.DomUtil.addClass(this.fixedHeader, "theadForFF");
                DNA.engine.DomUtil.addClass(this._headerEl, "theadForFF")
            }
        }
    },
    getHeaderVisible: function() {
        return this._headerEl.firstChild.style.display != "none"
    },
    setLineVisible: function(p) {
        this._lineVisible = p;
        var a = this.body.childNodes;
        for (var m = 0, n = a.length; m < n; m++) {
            var o = a[m];
            var h = o.childNodes;
            for (var g = 0, d = h.length; g < d; g++) {
                var c = h[g];
                c.style.borderRightWidth = p ? "1px" : "0px";
                c.style.borderBottomWidth = p ? "1px" : "0px"
            }
        }
    },
    getLineVisible: function() {
        if (this._lineVisible == undefined) {
            this._lineVisible = this.table.style.border == ""
        }
        return this._lineVisible
    },
    _doBuildElements: function() {
        this.table = this.el.firstChild;
        this._headerEl = this.el.firstChild.firstChild;
        this._body = this.body = this.el.firstChild.lastChild;
        this.fixedTable = this.el.lastChild;
        this.fixedHeader = this.fixedTable.firstChild;
        this.headers = this._headerEl.firstChild.childNodes;
        this.fixedHeaders = this.fixedHeader.firstChild.childNodes
    },
    _selectByKey: DNA.widget.List.prototype._selectByKey,
    _registEvents: function() {
        this.addListener2("mousedown", this._onMousedown);
        this.addListener2("mousemove", this._onMousemove);
        this.addListener2("mouseup", this._onMouseup);
        this.addListener2("mouseout", this._onMouseout);
        this.addListener2("dragover", this._onDragover);
        this.addGlobalListener("mouseup", this._onGlobalMouseup);
        this.addDomListener(this.getEl(), "scroll", this._onScroll);
        this.addListener2(DNA.JWTEvent.KEYDOWN, this._onKeydown)
    },
    _onScroll: function() {
        var a = DNA.engine.Client.isIE();
        if (a) {
            return
        }
        this.fixedTable.style.top = this.el.scrollTop + "px"
    },
    _onMouseout: function(a) {
        this._removeHover();
        if (this.beginPoint) {
            this.beginPoint = undefined
        }
        this.fixedHeader.style.cursor = "default";
        if (this.moveIndex) {
            this.moveIndex = undefined
        }
    },
    _setHover: function(a) {
        this._removeHover();
        if (a) {
            DNA.engine.DomUtil.addClass(a.getEl(), "hover");
            this.hoverd = a
        }
    },
    _removeHover: function() {
        if (this.hoverd && this.hoverd.getEl()) {
            DNA.engine.DomUtil.removeClass(this.hoverd.getEl(), "hover")
        }
        this.hoverd = null 
    },
    _onDragOver: function(c) {
        this.posInfo = "";
        var b = c.getXY();
        var a = DNA.engine.DomUtil.getPageXY(this.body);
        a = {
            x: b.x - a.x,
            y: b.y - a.y
        };
        a = this.getItembyPoint(a.x, a.y);
        if (a) {
            this.posInfo = a.getEid()
        }
    },
    getItembyPoint: function(b, m) {
        var a = this.body.childNodes.length;
        var g = b
          , d = m;
        var l = DNA.engine.DomUtil.getPageXY(this.body);
        g += l.x;
        d += l.y;
        for (var c = 0; c < a; c++) {
            var h = DNA.widget.WidgetRegistry.getChildren(this, c);
            if (this._compareItemPoint(h, g, d)) {
                return h
            }
        }
        return null 
    },
    _compareItemPoint: function(d, c, b) {
        var g = DNA.engine.DomUtil.getPageXY(d.el);
        var a = DNA.engine.DomUtil.getSize(d.el);
        if (c >= g.x && b >= g.y && c <= (g.x + a.width) && b <= (g.y + a.height)) {
            return true
        }
        return false
    },
    _onGlobalMouseup: function(d) {
        var c = d.getXY();
        var g = new DNA.widget.Point();
        var b = this._getPageBounds().x
          , a = this._getPageBounds().y;
        g.x = c.x - b;
        g.y = c.y - a;
        this._doMoveTo(g)
    },
    _doMoveTo: function(b) {
        if (this.beginPoint) {
            var c = b.x - this.beginPoint.x;
            var a = this.fixedHeaders[this.moveIndex].style.width;
            a = a.toLowerCase().replace("px", "");
            a = new Number(a);
            a = a + c;
            if (a > 0) {
                this._setColumnWidth(this.moveIndex, a)
            }
            this.beginPoint = undefined
        }
        this.fixedHeader.style.cursor = "default";
        if (this.moveIndex) {
            this.moveIndex = undefined
        }
    },
    _setColumnWidth: function(a, b) {
        this.fixedHeaders[a].style.width = b + "px";
        this.headers[a].style.width = b + "px";
        if (DNA.engine.Client.isFF()) {
            this.fireEvent("columnWidthChanged", [this, a, b + 4])
        } else {
            this.fireEvent("columnWidthChanged", [this, a, b])
        }
    },
    _onMousemove: function(g) {
        var b = g.getSrcWidget();
        if (b != null  && b instanceof DNA.widget.TableItem) {
            this._setHover(b);
            b.checkRendered(true)
        } else {
            this._removeHover()
        }
        var h = g.getSrcElement();
        if (this._isNearHeaderEnd(g.getLocation())) {
            if (this.beginPoint) {
                var c = g.getLocation();
                var d = c.x - this.beginPoint.x;
                var a = this.fixedHeaders[this.moveIndex].style.width;
                a = a.toLowerCase().replace("px", "");
                a = new Number(a);
                a = a + d;
                if (a > 0) {
                    this._setColumnWidth(this.moveIndex, a)
                }
                this.beginPoint = c
            }
        }
    },
    _onMouseup: function(a) {
        if (this.isDisposed()) {
            return
        }
        this._doMoveTo(a.getLocation())
    },
    _isNearHeaderEnd: function(n) {
        var g = false;
        var m = n.x;
        var l = n.y;
        var a = 0;
        if (this.el.scrollLeft != 0) {
            a -= this.el.scrollLeft
        }
        var b = this.fixedHeader.offsetWidth;
        var o = this.fixedHeader.offsetHeight;
        var c = a;
        if (n.y < o && n.x <= b - a) {
            for (var d = 0, h = this.fixedHeaders.length; d < h; d++) {
                c += this.fixedHeaders[d].offsetWidth;
                if (Math.abs(c - m) <= 12) {
                    if (!this.beginPoint) {
                        if ((d + 1 < h) && (m > c) && (Math.abs(c + this.fixedHeaders[d + 1].offsetWidth - m) <= 12)) {
                            this.moveIndex = d + 1
                        } else {
                            this.moveIndex = d
                        }
                    }
                    g = true;
                    break
                }
                if (c > m + 12) {
                    break
                }
            }
        }
        if (g) {
            this.fixedHeader.style.cursor = "col-resize"
        } else {
            if (!this.beginPoint) {
                this.fixedHeader.style.cursor = "default"
            }
        }
        return g
    },
    _onMousedown: function(h) {
        var c = h.getSrcElement();
        if (this._isNearHeaderEnd(h.getLocation())) {
            this.beginPoint = h.getLocation();
            return
        }
        var b = h.getSrcWidget();
        if (!b) {
            return
        }
        if (b && b != this) {
            if (DNA.engine.DomUtil.hasClass(b.getEl(), "disabled")) {
                return
            }
            var d = this.getStyle();
            if ((d & DNA.JWT.CHECK) && b.isBoxEl(h.getSrcElement())) {
                b.setChecked(!b.isChecked());
                this.fireEvent("check", [this, b, h])
            } else {
                var l = {
                    doit: true,
                    control: this,
                    item: b
                };
                this.fireEvent("selectionchanging", [l]);
                if (l.doit === false) {
                    return
                }
                if (d & DNA.JWT.MULTI) {
                    var g = this._lastSelected;
                    if (h.isShift() && g) {
                        var a = this.indexOf(b.getEid());
                        var m = this.indexOf(g.getEid());
                        this.selectRange(m, a)
                    } else {
                        if (h.isCtrl()) {
                            if (this._selected.indexOf(b) != -1) {
                                this.unselect(b)
                            } else {
                                this._selectItem(b)
                            }
                            this._lastSelected = b
                        } else {
                            this.select(b);
                            this._lastSelected = b
                        }
                    }
                } else {
                    if (d & DNA.JWT.SINGLE) {
                        this.select(b);
                        this._lastSelected = b
                    }
                }
                this.fireEvent("selection", [this, h]);
                this.fireEvent("nodeClick", [this, h])
            }
        }
    },
    doDispose: function() {
        delete this._headerEl;
        delete this.body,
        this._body;
        delete this.fixedTable;
        delete this.table;
        delete this.fixedHeader;
        delete this.headers;
        delete this.fixedHeaders;
        DNA.widget.Table.superclass.doDispose.apply(this, arguments)
    }
});
Object.override(DNA.widget.Table.prototype, {
    jtype: "Table",
    focusable: true
});
Object.override(DNA.widget.Table.prototype, DNA.widget.Listrace.fn);
DNA.widget.Table.prototype._onMousedown = DNA.widget.Listrace.before(DNA.widget.Table.prototype._onMousedown, DNA.widget.Listrace.filterEvent);
DNA.widget.TableItem = function(a) {
    DNA.widget.TableItem.superclass.constructor.call(this, a)
}
;
DNA.widget.TableItem.extend(DNA.widget.Item, {
    __init: function() {
        if (this.getParent().getStyle() & DNA.JWT.CHECK) {
            var a = this._boxEl.className;
            if (a.indexOf("on") >= 0) {
                this._checked = true
            } else {
                this._checked = false
            }
            if (a.indexOf("gray") >= 0) {
                this._grayed = true
            } else {
                this._grayed = false
            }
        }
    },
    getImageNode: function(a) {
        if (a == 0) {
            return this.el.childNodes[a].childNodes[1]
        } else {
            return this.el.childNodes[a].firstChild
        }
    },
    getTextNode: function(a) {
        if (a == 0) {
            return this.el.childNodes[a].childNodes[2]
        } else {
            return this.el.childNodes[a].childNodes[1]
        }
    },
    setText: function(g, d) {
        if (g == undefined) {
            return
        }
        if (d != undefined) {
            this._setTextByIndex(g, d);
            return
        }
        if (g instanceof Array) {
            var c = this.el.childNodes;
            for (var b = 0, a = c.length; b < a; b++) {
                this._setTextByIndex(b, g[b])
            }
        } else {
            this._setTextByIndex(0, g)
        }
    },
    _setTextByIndex: function(a, c) {
        if (a == null  || a > this.el.childNodes.length - 1) {
            return
        }
        if (c) {
            var b = this.getTextNode(a);
            b.innerHTML = c
        }
    },
    getText: function(a) {
        if (a == undefined || a > (this.el.childNodes.length - 1)) {
            a = 0
        }
        var b = this.getTextNode(a);
        return DNA.engine.DomUtil.getInnerText(b)
    },
    setImage: function(b) {
        if (b) {
            var g = this.el.childNodes;
            for (var d = 0, a = g.length; d < a; d++) {
                var c = b[d];
                if (c) {
                    c = DNA.widget.ParserTools.parseImg(c)
                }
                var h = this.getImageNode(d);
                h.innerHTML = c ? c.getHTML() : ""
            }
        }
    },
    setChecked: function(a) {
        if (a === true) {
            if (this._grayed) {
                this._boxEl.className = "gray-on"
            } else {
                this._boxEl.className = "check-on"
            }
        } else {
            if (a === false) {
                if (this._grayed) {
                    this._boxEl.className = "gray-off"
                } else {
                    this._boxEl.className = "check-off"
                }
            }
        }
        this._checked = a
    },
    isChecked: function() {
        return this._checked
    },
    setGrayed: function(a) {
        if (a === true) {
            if (this._checked) {
                this._boxEl.className = "gray-on"
            } else {
                this._boxEl.className = "gray-off"
            }
            this._grayed = true
        } else {
            if (this._checked) {
                this._boxEl.className = "check-on"
            } else {
                this._boxEl.className = "check-off"
            }
            this._grayed = false
        }
    },
    isGrayed: function() {
        return this._grayed
    },
    isBoxEl: function(a) {
        return this._boxEl == a
    },
    _doBuildElements: function() {
        if (this.getParent().getStyle() & DNA.JWT.CHECK) {
            this._boxEl = this.el.firstChild.firstChild
        }
        this._dataEl = this.el.firstChild.lastChild;
        this.__init()
    },
    _select: function() {
        DNA.engine.DomUtil.addClass(this.getEl(), "selected")
    },
    _unselect: function() {
        if (!this.getEl()) {
            return
        }
        DNA.engine.DomUtil.removeClass(this.getEl(), "selected")
    },
    doDispose: function() {
        delete this._boxEl;
        delete this._checked;
        delete this._dataMap;
        delete this.parent;
        delete this.el;
        delete this._wrapper;
        delete this.data;
        DNA.widget.TableItem.superclass.doDispose.apply(this, arguments)
    }
});
Object.override(DNA.widget.TableItem.prototype, {
    jtype: "TableItem"
});
Object.override(DNA.widget.TableItem.prototype, DNA.widget.Listrace.itemfn);
DNA.widget.Tree = function(a) {
    DNA.widget.Tree.superclass.constructor.call(this, a);
    this.initedScroll = false;
    this.initializing = true
}
;
DNA.widget.Tree.extend(DNA.widget.Iteration, {
    getChildren: function() {
        var a = DNA.widget.WidgetRegistry.getChildren(this, true);
        if (a == null ) {
            return []
        }
        return a
    },
    computeSize: function(l, b, m) {
        var c = new DNA.widget.Point();
        if (l == DNA.JWT.DEFAULT || b == DNA.JWT.DEFAULT) {
            var a = 100
              , g = 100;
            if (l == DNA.JWT.DEFAULT) {
                c.x = a
            }
            if (b == DNA.JWT.DEFAULT) {
                c.y = g
            }
        }
        if (l != DNA.JWT.DEFAULT) {
            c.x = l
        }
        if (b != DNA.JWT.DEFAULT) {
            c.y = b
        }
        var d = this.getBorderSize();
        c.x += d;
        c.y += d;
        if (DNA.engine.application.isAnimated()) {
            c.x += 5
        }
        return c
    },
    setScrollPosition: function() {
        this.checkRendered(true);
        if (this._selected != null  && this._selected.length > 0) {
            var a = this._selected[0];
            DNA.widget.Listrace.setScrollPosition(this.el, a.el, 0, this)
        }
    },
    setVerticalPosition: function(a) {
        this.getEl().scrollTop = a
    },
    setHorizontalPosition: function(a) {
        this.getEl().scrollLeft = a
    },
    _resize: function() {
        if (this.initedScroll === false) {
            this.setScrollPosition()
        }
    },
    _remove: function(c) {
        var b = this.getChildren().indexOf(c);
        var a = this.getChildren().length;
        DNA.widget.Tree.superclass._remove.call(this, c);
        if (b == a - 1) {
            if (b == 0) {} else {
                this.getChildren()[b - 1]._changeExpandCss()
            }
        } else {
            if (b == 0) {
                this.getChildren()[0]._changeExpandCss()
            }
        }
    },
    clear: function() {
        this._selected = [];
        this.el.innerHTML = "";
        DNA.widget.Tree.superclass.clear.call(this)
    },
    getAllItem: function() {
        var c = new Array();
        var a = new Array();
        var g = this.getChildren();
        if (g && g.length > 0) {
            for (var d = 0; d < g.length; d++) {
                a.push(g[d])
            }
        }
        var b = null ;
        while (a && a.length > 0) {
            b = a.pop();
            c.push(b);
            g = b.getChildren();
            if (g && g.length > 0) {
                for (var d = 0; d < g.length; d++) {
                    a.push(g[d])
                }
            }
        }
        return c
    },
    removeAll: function() {
        this.clearInterval()
    },
    _registEvents: function() {
        this.addListener2("mousemove", this._onMouseover);
        this.addListener2("mouseout", this._onMouseout);
        this.addListener2("dragover", this._onDragover);
        this.addListener2("mousedown", this._onMousedownup);
        this.addListener2("mouseup", this._onMousedownup);
        this.addListener2(DNA.JWTEvent.KEYDOWN, this._onKeydown)
    },
    _findNext: function(d, c) {
        if (c) {
            var g = this._findChild(d);
            if (g != null ) {
                return g
            }
        }
        var b = d.getParent();
        var a = DNA.widget.WidgetRegistry.indexOf(b, d);
        if (a == DNA.widget.WidgetRegistry.getChildrenCount(b) - 1) {
            if (b instanceof DNA.widget.TreeItem) {
                return this._findNext(b, false)
            }
            return null 
        }
        return DNA.widget.WidgetRegistry.getChildren(b, ++a)
    },
    _findChild: function(a) {
        if (!a.isExpanded() || DNA.widget.WidgetRegistry.getChildrenCount(a) == 0) {
            return null 
        }
        return DNA.widget.WidgetRegistry.getChildren(a, 0)
    },
    _findLast: function(a) {
        if (!a.isExpanded() || DNA.widget.WidgetRegistry.getChildrenCount(a) == 0) {
            return a
        }
        return this._findLast(DNA.widget.WidgetRegistry.getChildren(a, DNA.widget.WidgetRegistry.getChildrenCount(a) - 1))
    },
    _findPrev: function(c) {
        var b = c.getParent();
        var a = DNA.widget.WidgetRegistry.indexOf(b, c);
        if (a == 0) {
            if (b instanceof DNA.widget.TreeItem) {
                return b
            }
            return null 
        }
        return this._findLast(DNA.widget.WidgetRegistry.getChildren(b, --a))
    },
    _selectByKey: function(b, c) {
        if (!DNA.widget.Listrace.supportKey["" + b]) {
            return
        }
        var a = this.getSelected();
        if (a == null  || a.length <= 0) {
            if (b == DNA.widget.Listrace.KEY_DOWN) {
                a = DNA.widget.WidgetRegistry.getChildren(this, 0);
                if (a) {
                    var d = {
                        doit: true,
                        control: this,
                        item: a
                    };
                    this.fireEvent("selectionchanging", [d]);
                    if (d.doit === false) {
                        return
                    }
                    this.selectItems([a]);
                    this.fireEvent("selection", [this, c])
                }
            }
            return
        }
        a = a[0];
        if (b == DNA.widget.Listrace.KEY_LEFT) {
            if (a.isExpanded()) {
                a.setExpanded(false, false);
                this.fireEvent("tree", [this, a, c]);
                return
            } else {
                a = a.getParent();
                if (a instanceof DNA.widget.Tree) {
                    return
                }
            }
        } else {
            if (b == DNA.widget.Listrace.KEY_UP) {
                a = this._findPrev(a)
            } else {
                if (b == DNA.widget.Listrace.KEY_RIGHT) {
                    if (a.isExpanded()) {
                        a = this._findChild(a)
                    } else {
                        a.setExpanded(true, false);
                        this.fireEvent("tree", [this, a, c]);
                        return
                    }
                } else {
                    a = this._findNext(a, true)
                }
            }
        }
        if (a) {
            var d = {
                doit: true,
                control: this,
                item: a
            };
            this.fireEvent("selectionchanging", [d]);
            if (d.doit === false) {
                return
            }
            this.selectItems([a]);
            this.fireEvent("selection", [this, c])
        }
    },
    _onDragover: function(g) {
        this.checkRendered(true);
        this.posInfo = "";
        var n = g.getXY();
        var m = g.getSrcWidget();
        var c = g.getSrcElement();
        var b = DNA.widget.Listrace.getNodeByChild(c, "txt", 2);
        if (!b) {
            return
        }
        var l = DNA.widget.Listrace.getNodeByChild(b, ["TreeItem-0", "TreeItem-1"], 3);
        if (!l) {
            return
        }
        var o = l.id;
        var a = DNA.engine.DomUtil.getPageXY(b);
        a = {
            x: n.x - a.x,
            y: n.y - a.y
        };
        var h = b.offsetHeight;
        if (!h || h <= 0 || a.y < 0 || a.y > h) {
            return
        }
        var d = "sub";
        if (a.y < 1 / 3 * h) {
            d = "before"
        } else {
            if (a.y > 2 / 3 * h) {
                d = "after"
            }
        }
        this.posInfo = o + "," + d
    },
    _onMouseover: function(b) {
        var a = b.getSrcWidget();
        if (a instanceof DNA.widget.TreeItem) {
            a.checkRendered(true);
            if (a.isNodeEl(b.getSrcElement())) {
                this._setHover(a);
                return
            }
        }
        this._removeHover()
    },
    _onMouseout: function(a) {
        this._removeHover()
    },
    _setHover: function(a) {
        if (this.hoverd != a) {
            this._removeHover();
            a.hover();
            this.hoverd = a;
            a._animatedHover()
        }
    },
    _removeHover: function() {
        if (this.hoverd) {
            var a = this.hoverd;
            delete this.hoverd;
            a.unhover();
            a._animatedUnhover()
        }
    },
    _multiSelect: function(h, a) {
        this.unselectAll();
        var d = DNA.engine.DomUtil.getPageXY(h.el).y;
        var c = DNA.engine.DomUtil.getPageXY(a.el).y;
        if (c < d) {
            var b = h;
            h = a;
            a = b
        }
        var g = this._selectGroup(h, a);
        if (g !== true) {
            this._selectLittleBrother(h, a)
        }
    },
    _selectLittleBrother: function(h, b) {
        var c = h.getParent().indexOf(h) + 1;
        for (var a = h.getParent().getChildren().length; c < a; c++) {
            var g = h.getParent().getChildren()[c];
            var d = this._selectGroup(g, b);
            if (d) {
                return true
            }
        }
        this._selectLittleBrother(h.getParent(), b)
    },
    _selectGroup: function(h, b) {
        this._selectItem(h);
        h.checkRendered(true);
        if (h == b) {
            return true
        }
        if (h.isExpanded()) {
            var c = h.getChildren();
            for (var d = 0, a = c.length; d < a; d++) {
                var g = this._selectGroup(c[d], b);
                if (g) {
                    return true
                }
            }
        }
    },
    _onMousedownup: function(d) {
        var a = d.getSrcWidget();
        a.checkRendered(true);
        var c = d.getSrcElement();
        var b = d.getOriginalType() == "mousedown";
        if (a && a != this) {
            if (DNA.engine.DomUtil.hasClass(a.getEl(), "disabled")) {
                return
            }
            if (b && c == a._expandEl && a._hasChildren) {
                a.setExpanded(null , false);
                this.fireEvent("tree", [this, a, d])
            }
            if (b && (this.getStyle() & DNA.JWT.CHECK) && a.isBoxEl(d.getSrcElement())) {
                a._animatedCheck();
                a.setChecked(!a.isChecked());
                this.fireEvent("check", [this, a, d])
            } else {
                if (a.isNodeEl(c)) {
                    if (b) {
                        this.acceptUp = true;
                        if (!a.isSelected() && !d.isCtrl() && !d.isShift()) {
                            this.acceptUp = false;
                            this._justSelectItem(a, d)
                        }
                    } else {
                        if ((a.isSelected() || d.isCtrl() || d.isShift()) && this.acceptUp) {
                            this._justSelectItem(a, d)
                        }
                    }
                }
            }
        }
    },
    _justSelectItem: function(a, c) {
        var d = {
            doit: true,
            control: this,
            item: a
        };
        this.fireEvent("selectionchanging", [d]);
        if (d.doit === false) {
            return
        }
        if (this.getStyle() & DNA.JWT.MULTI) {
            var b = this._lastSelected;
            if (c.isShift() && b) {
                this._multiSelect(a, b)
            } else {
                if (c.isCtrl()) {
                    if (this._selected.indexOf(a) != -1) {
                        this.unselect(a)
                    } else {
                        this._selectItem(a)
                    }
                    this._lastSelected = a
                } else {
                    this.select(a);
                    this._lastSelected = a
                }
            }
        } else {
            if (this.getStyle() & DNA.JWT.SINGLE) {
                this.select(a);
                this._lastSelected = a
            }
        }
        this.fireEvent("selection", [this, c]);
        this._fireNodeClickEvent(c)
    },
    _fireNodeClickEvent: function(a) {
        this.fireEvent("nodeClick", [this, a])
    },
    getItembyPoint: function(n, l) {
        var b = this.getChildren();
        var h = b.length;
        var d = n
          , c = l;
        var m = DNA.engine.DomUtil.getPageXY(this.el);
        d += m.x;
        c += m.y;
        for (var g = 0; g < h; g++) {
            var o = b[g];
            if (this._compareItemPoint(o, d, c)) {
                return o
            } else {
                if (o.isExpanded()) {
                    var a = this._comparePointFormChildren(o, d, c);
                    if (a) {
                        return a
                    }
                }
            }
        }
        return null 
    },
    _compareItemPoint: function(d, c, b) {
        var g = DNA.engine.DomUtil.getPageXY(d._textEl);
        var a = DNA.engine.DomUtil.getSize(d._textEl);
        if (c >= g.x && b >= g.y && c <= (g.x + a.width) && b <= (g.y + a.height)) {
            return true
        }
        return false
    },
    _comparePointFormChildren: function(l, g, d) {
        var c = l.getChildren();
        for (var b = 0, a = c.length; b < a; b++) {
            var h = c[b];
            if (this._compareItemPoint(h, g, d)) {
                return h
            } else {
                if (h.isExpanded()) {
                    var m = this._comparePointFormChildren(h);
                    if (m) {
                        return m
                    }
                }
            }
        }
    }
});
Object.override(DNA.widget.Tree.prototype, {
    jtype: "Tree",
    focusable: true
});
Object.override(DNA.widget.Tree.prototype, DNA.widget.Listrace.fn);
DNA.widget.Tree.prototype._onMousedownup = DNA.widget.Listrace.before(DNA.widget.Tree.prototype._onMousedownup, DNA.widget.Listrace.filterEvent);
DNA.widget.TreeItem = function(a) {
    DNA.widget.TreeItem.superclass.constructor.call(this, a);
    this._expanded = a[DNA.JWTProperty.PROPERTY_EXPANDED] || false;
    delete a[DNA.JWTProperty.PROPERTY_EXPANDED];
    if (this.getParentControl().getStyle() & DNA.JWT.CHECK) {
        this._checked = this._getInitData()[DNA.JWTProperty.PROPERTY_CHECK] || false;
        delete this._getInitData()[DNA.JWTProperty.PROPERTY_CHECK];
        this._grayed = this._getInitData()[DNA.JWTProperty.PROPERTY_CHECK_GRAYED] || false;
        delete this._getInitData()[DNA.JWTProperty.PROPERTY_CHECK_GRAYED]
    }
}
;
DNA.widget.TreeItem.extend(DNA.widget.Item, {
    getChildren: function() {
        var a = DNA.widget.WidgetRegistry.getChildren(this, true);
        if (a == null ) {
            return []
        }
        return a
    },
    afterInit: function() {
        DNA.widget.WidgetRegistry.get(this.getEid());
        var a = this.getParent().indexOf(this);
        if (a == 0 && this.getParent().getChildren().length > 1) {
            this.getParent().getChildren()[1]._changeExpandCss()
        } else {
            if (a == this.getParent().getChildren().length - 1) {
                var b = this.getParent().getChildren()[a - 1];
                if (b) {
                    b._changeExpandCss()
                } else {
                    this._changeExpandCss()
                }
            }
        }
        if (this.getParent() instanceof DNA.widget.TreeItem) {
            this.getParent()._changeExpandCss()
        }
    },
    setText: function(a) {
        DNA.engine.DomUtil.setInnerText(this._textEl, a)
    },
    getText: function() {
        return DNA.engine.DomUtil.getInnerText(this._textEl)
    },
    hover: function() {
        if (this.isDisposed()) {
            return
        }
        DNA.engine.DomUtil.addClass(this._textEl, "hover")
    },
    unhover: function() {
        if (this.isDisposed()) {
            return
        }
        DNA.engine.DomUtil.removeClass(this._textEl, "hover")
    },
    setImage: function(a) {
        if (a) {
            a = DNA.widget.ParserTools.parseImg(a)
        }
        this._imageEl.innerHTML = a ? a.getHTML() : ""
    },
    setExpanded: function(a, c) {
        if (a !== true && a !== false) {
            a = !this._expanded
        }
        if (a === true) {
            this._expandEl.className = this._expandEl.className.replace(this._plusReg, "minus");
            this._expanded = true
        } else {
            if (a === false) {
                this._expandEl.className = this._expandEl.className.replace(this._minusReg, "plus");
                this._expanded = false
            }
        }
        if (c != false) {
            this.renderExpandBody()
        }
    },
    renderExpandBody: function() {
        if (this._expanded) {
            if (this._body.childNodes.length > 0) {
                DNA.engine.DomUtil.setStyle(this._body, "display", "")
            }
        } else {
            DNA.engine.DomUtil.setStyle(this._body, "display", "none")
        }
    },
    isExpanded: function() {
        return this._expanded
    },
    setChecked: function(a) {
        if (!this.checkRendered(true)) {
            return
        }
        if (a === true) {
            if (this._grayed) {
                this._boxEl.className = "gray-on"
            } else {
                this._boxEl.className = "check-on"
            }
        } else {
            if (this._grayed) {
                this._boxEl.className = "gray-off"
            } else {
                this._boxEl.className = "check-off"
            }
        }
        this._checked = a
    },
    isChecked: function() {
        return this._checked
    },
    setGrayed: function(a) {
        if (!this.checkRendered(true)) {
            return
        }
        if (a === true) {
            if (this.checkRendered(true)) {
                if (this._checked) {
                    this._boxEl.className = "gray-on"
                } else {
                    this._boxEl.className = "gray-off"
                }
            }
            this._grayed = true
        } else {
            if (this.checkRendered(true)) {
                if (this._checked) {
                    this._boxEl.className = "check-on"
                } else {
                    this._boxEl.className = "check-off"
                }
            }
            this._grayed = false
        }
    },
    isGrayed: function() {
        return this._grayed
    },
    getBody: function() {
        return this._body
    },
    clear: function() {
        this.removeAll()
    },
    removeAll: function() {
        while (this.getChildren().length > 0) {
            this.getChildren()[0].dispose()
        }
    },
    _remove: function(c) {
        var b = this.getChildren().indexOf(c);
        var a = this.getChildren().length;
        this.getChildren().remove(c);
        if (b == a - 1) {
            if (b == 0) {
                this._changeExpandCss()
            } else {
                this.getChildren()[b - 1]._changeExpandCss()
            }
        } else {
            if (b == 0) {
                this.getChildren()[0]._changeExpandCss()
            }
        }
    },
    indexOf: function(a) {
        if (a instanceof String) {
            a = DNA.widget.WidgetRegistry.get(a)
        }
        return DNA.widget.TreeItem.superclass.indexOf.call(this, a)
    },
    _changeExpandCss: function() {
        var c = "";
        var a = this.getParent().indexOf(this);
        var b = this.getParent().getChildren().length;
        if (this.getParent() instanceof DNA.widget.Tree) {
            if (b == 1) {
                c = "";
                if (a == 0) {
                    c = "mid-"
                }
            } else {
                if (a == 0) {
                    c = "start-"
                } else {
                    if (a == b - 1) {
                        c = "end-"
                    } else {
                        c = "mid-"
                    }
                }
            }
        } else {
            if (a == b - 1) {
                c = "end-"
            } else {
                c = "mid-"
            }
        }
        if (this.getChildren().length > 0) {
            this._hasChildren = true;
            if (this.isExpanded()) {
                this._expandEl.className = "node-" + c + "minus";
                DNA.engine.DomUtil.setStyle(this._body, "display", "")
            } else {
                this._expandEl.className = "node-" + c + "plus";
                DNA.engine.DomUtil.setStyle(this._body, "display", "none")
            }
        } else {
            this._hasChildren = false;
            this._expandEl.className = "node-" + c + "line";
            DNA.engine.DomUtil.setStyle(this._body, "display", "none")
        }
        if (a == b - 1) {
            this._setIndentVisible(false)
        } else {
            this._setIndentVisible(true)
        }
    },
    _setIndentVisible: function(a) {
        if (this.checkRendered(true)) {
            var c = DNA.engine.DomUtil.hasClass(this.el, "disabled");
            if (a) {
                this.el.className = "TreeItem-1"
            } else {
                this.el.className = "TreeItem-0"
            }
            if (c) {
                DNA.engine.DomUtil.addClass(this.el, "disabled")
            }
        }
    },
    isBoxEl: function(a) {
        if (this.checkRendered(true)) {
            return this._boxEl == a
        }
    },
    isNodeEl: function(a) {
        if (!this.checkRendered(true)) {
            return
        }
        return this._textEl == a || this._imageEl == a || this._imageEl == a.parentNode
    },
    insertChildHtml: function(b, a) {
        if (b) {
            this._add(b, a)
        } else {
            this._add(undefined, a)
        }
    },
    appendChildHtml: function(a) {
        this._add(null , a)
    },
    _add: function(b, a) {
        var d;
        var c;
        if (b) {
            c = DNA.engine.DomUtil.findChild(this.getBody(), "*[id=" + b + "]");
            d = DNA.JWT.RENDER_POS_TYPE_AFTER
        } else {
            if (b === null ) {
                d = DNA.JWT.RENDER_POS_TYPE_LAST
            } else {
                d = DNA.JWT.RENDER_POS_TYPE_FIRST
            }
        }
        this._renderChild(this.getBody(), d, a, c)
    },
    _doBuildElements: function() {
        this._textEl = this.el.lastChild.childNodes[2];
        this._expandEl = this.el.firstChild;
        this._imageEl = this.el.lastChild.childNodes[1];
        if (this._imageEl.childNodes.length > 0) {
            this._image = this._imageEl.firstChild
        }
        this._body = this.el.lastChild.lastChild;
        if (this.getParentControl().getStyle() & DNA.JWT.CHECK) {
            this._boxEl = this.el.lastChild.childNodes[0]
        }
        var a = this._expandEl.className;
        if (a.indexOf("-line") >= 0) {
            this._hasChildren = false
        } else {
            this._hasChildren = true
        }
    },
    _getStyleEl: function() {
        return this._textEl
    },
    _select: function() {
        DNA.engine.DomUtil.addClass(this._textEl, "selected")
    },
    isSelected: function() {
        return DNA.engine.DomUtil.hasClass(this._textEl, "selected")
    },
    _unselect: function() {
        if (!this.getEl()) {
            return
        }
        DNA.engine.DomUtil.removeClass(this._textEl, "selected")
    },
    dispose: function(b) {
        if (b != false) {
            var g = this.getParent();
            var h = g.getChildren();
            var a = h.length;
            var d = h.indexOf(this);
            DNA.widget.TreeItem.superclass.dispose.call(this, b);
            h = g.getChildren();
            if (d == a - 1) {
                if (d == 0) {
                    g._changeExpandCss && g._changeExpandCss()
                } else {
                    h[h.length - 1]._changeExpandCss()
                }
            } else {
                if (d == 0) {
                    h[0]._changeExpandCss()
                }
            }
        } else {
            DNA.widget.TreeItem.superclass.dispose.call(this, b)
        }
    },
    doDispose: function() {
        delete this._expandEl;
        delete this._imageEl;
        delete this._textEl;
        delete this._body;
        delete this._boxEl;
        DNA.widget.TreeItem.superclass.doDispose.apply(this, arguments)
    }
});
Object.override(DNA.widget.TreeItem.prototype, {
    jtype: "TreeItem",
    _plusReg: /plus/,
    _endReg: /end/,
    _minusReg: /minus/
});
Object.override(DNA.widget.TreeItem.prototype, DNA.widget.Listrace.itemfn);
DNA.widget.LWList = function(a) {
    DNA.widget.LWList.superclass.constructor.call(this, a);
    this.initedScroll = false
}
;
DNA.widget.LWList.extend(DNA.widget.Control, {
    computeSize: function(d, n, h) {
        if (d != -1 && n != -1) {
            return new DNA.widget.Point(d,n)
        }
        var b = 0;
        var m = 0;
        var c = DNA.engine.DomUtil.getChildren(this.getEl().firstChild);
        if (c) {
            m = c.length
        }
        if (m == 0) {
            if (d != -1) {
                return new DNA.widget.Point(d,0)
            }
            if (n != -1) {
                return new DNA.widget.Point(0,n)
            }
            return new DNA.widget.Point(b,0)
        }
        var a = c[0].offsetHeight;
        if (a == 0) {
            var o = this.computeOneSize(c[0]);
            a = o.y
        }
        var l = 0;
        for (var g = 0; g < m; g++) {
            var o = this.computeOneSize(c[g]);
            l += o.y;
            if (o.x + 2 > b) {
                b = o.x + 2
            }
            if (m > 100) {
                if (d != -1) {
                    b = d
                }
                l = a * m + 2;
                if (n != -1) {
                    l = n
                }
                return new DNA.widget.Point(b,l)
            }
        }
        l += 2;
        if (d != -1) {
            if (b > d) {
                l += 18
            }
            b = d
        }
        if (n != -1) {
            if (l > n) {
                b += 18
            }
            l = n
        }
        return new DNA.widget.Point(b,l)
    },
    computeOneSize: function(h) {
        var g = DNA.engine.DomUtil.getInnerText(h.childNodes[2]);
        var a = h.childNodes[1].innerHTML;
        var c = new DNA.widget.Point(0,0);
        var b = (this.getStyle() & DNA.JWT.CHECK) != 0;
        var d = DNA.engine.DomUtil.computeTextSize(g);
        c.x = d.width;
        c.y = d.height > 18 ? d.height : 18;
        if (b) {
            c.x += 18
        }
        if (a != "") {
            c.x += 18
        }
        return c
    },
    _doPreRebuildElements: function() {
        this._rebuildIds = this.getSelectedIds();
        this.selectNodes = [];
        this._lastSelected = null 
    },
    _buildElements: function(a) {
        var b = DNA.widget.LWList.superclass._buildElements.apply(this, arguments);
        if (a) {
            this._didRebuildElement()
        }
        return b
    },
    _didRebuildElement: function() {
        this.doSelectIds(this._rebuildIds, false);
        delete this._rebuildIds
    },
    _doBuildElements: function() {
        this._body = this.body = this.el.firstChild
    },
    getBody: function() {
        if (this.checkRendered(true)) {
            return this._body || this.getEl()
        }
    },
    getItemText: function(b) {
        var a = this.getNodeById(b);
        if (a == null ) {
            return null 
        }
        return a.childNodes[2].innerText || a.childNodes[2].textContent
    },
    setItemText: function(c, b) {
        var a = this.getNodeById(c);
        if (a == null ) {
            return null 
        }
        DNA.engine.DomUtil.setInnerText(a.childNodes[2], b)
    },
    getClientDataNode: function(a) {
        return a.childNodes[3]
    },
    getClientDataById: function(b) {
        var a = this.getNodeById(b);
        if (a == null ) {
            return null 
        }
        return this.getClientDataNode(a).innerHTML
    },
    setScrollPosition: function() {
        if (this.selectNodes != null  && this.selectNodes.length > 0) {
            var a = this.selectNodes[0];
            DNA.widget.Listrace.setScrollPosition(this.el, a, 0, this)
        }
    },
    getNodeIndex: function(b) {
        for (var a = 0; a < this.getBody().childNodes.length; a++) {
            if (this.getBody().childNodes[a].id == b.id) {
                return a
            }
        }
        return -1
    },
    refresh: function(a) {
        this.el.innerHTML = a;
        this.selectNodes = [];
        this._lastSelected = null ;
        this._doBuildElements()
    },
    insert: function(a) {
        DNA.engine.DomUtil.insertHtml(this.getBody(), DNA.engine.DomUtil.BEFOREEND, a)
    },
    getIdFromHtml: function(b) {
        if (b == null ) {
            return null 
        }
        var c = b.indexOf(" id");
        if (c < 0) {
            return null 
        }
        c = b.indexOf('"', c);
        var a = b.indexOf('"', c + 1);
        if (c > 0 && a > c) {
            return b.substring(c + 1, a)
        }
    },
    insertToTarget: function(a, d, c) {
        var b = this.getNodeById(d);
        if (b == null ) {
            this.insert(a);
            return
        }
        DNA.engine.DomUtil.insertHtml(b, c == "true" ? DNA.engine.DomUtil.BEFOREBEGIN : DNA.engine.DomUtil.AFTEREND, a)
    },
    remove: function(b) {
        var a = this.getNodeById(b);
        if (a == null ) {
            return
        }
        this.getBody().removeChild(a);
        this.selectNodes.remove(a)
    },
    clear: function() {
        this.removeAll()
    },
    removeAll: function() {
        this.getBody().innerHTML = "";
        this.selectNodes = []
    },
    getNodeById: function(b) {
        if (b == null ) {
            return null 
        }
        for (var a = 0; a < this.getBody().childNodes.length; a++) {
            if (this.getBody().childNodes[a].id == b) {
                return this.getBody().childNodes[a]
            }
        }
        return null 
    },
    getInfoFromHtml: function(c) {
        var a = new Array(5);
        var l = c.split("#,#");
        var b, d, h, m;
        var g;
        if (l.length >= 3) {
            b = (l[0].split("#:#"))[1];
            d = (l[1].split("#:#"))[1];
            h = (l[2].split("#:#"))[1];
            m = (l[3].split("#:#"))[1];
            g = (l[4].split("#:#"))[1]
        }
        a[0] = b;
        a[1] = d;
        a[2] = h;
        a[3] = m;
        a[4] = g;
        return a
    },
    update: function(d) {
        var n = this.getInfoFromHtml(d);
        var c = n[1];
        var m = n[2];
        var a = n[3];
        var b = this.getNodeById(a);
        if (b == null ) {
            return
        }
        var l = b.childNodes[0];
        var h = b.childNodes[1];
        var g = b.childNodes[2];
        if (c != "null") {
            h.innerHTML = c
        }
        if (m == "") {
            m = "&nbsp;"
        }
        g.innerHTML = m
    },
    gray: function(b) {
        if (!this.isCheckStyle()) {
            return
        }
        var a = this.getNodeById(b);
        if (a == null ) {
            return
        }
        a = a.childNodes[0];
        a.className = a.className.replace("check-on", "gray-on");
        a.className = a.className.replace("check-off", "gray-off")
    },
    unGray: function(b) {
        if (!this.isCheckStyle()) {
            return
        }
        var a = this.getNodeById(b);
        if (a == null ) {
            return
        }
        a = a.childNodes[0];
        a.className = a.className.replace("gray-on", "check-on");
        a.className = a.className.replace("gray-off", "check-off")
    },
    check: function(b) {
        if (!this.isCheckStyle()) {
            return
        }
        var a = this.getNodeById(b);
        if (a == null ) {
            return
        }
        a = a.childNodes[0];
        a.className = a.className.replace("-off", "-on")
    },
    isCheckStyle: function() {
        return (this.getStyle() & DNA.JWT.CHECK) != 0
    },
    isChecked: function(b) {
        if (!this.isCheckStyle()) {
            return
        }
        var a = this.getNodeById(b);
        if (a == null ) {
            return
        }
        a = a.childNodes[0];
        if (a.className.indexOf("-on") >= 0) {
            return true
        } else {
            return false
        }
    },
    isGrayed: function(b) {
        if (!this.isCheckStyle()) {
            return
        }
        var a = this.getNodeById(b);
        if (a == null ) {
            return
        }
        a = a.childNodes[0];
        if (a.className.indexOf("gray") >= 0) {
            return true
        } else {
            return false
        }
    },
    unCheck: function(b) {
        if (!this.isCheckStyle()) {
            return
        }
        var a = this.getNodeById(b);
        if (a == null ) {
            return
        }
        a = a.childNodes[0];
        a.className = a.className.replace("-on", "-off")
    },
    unSelectAll: function() {
        for (var a = 0; a < this.selectNodes.length; a++) {
            DNA.engine.DomUtil.removeClass(this.selectNodes[a], "selected")
        }
        this.selectNodes = []
    },
    doSelectIds: function(c) {
        c = c || "";
        var b = c.split(",");
        this.unSelectAll();
        if (b.length <= 0) {
            return
        }
        if (((this.getStyle() & DNA.JWT.MULTI) != 0) ) {
            for (var a = 0; a < b.length; a++) {
                this.addSelect(b[a])
            }
        } else {
            this.select(b[b.length - 1])
        }
        this.setScrollPosition()
    },
    getSelectedItems: function() {
        var a = [];
        for (var b = 0; b < this.selectNodes.length; b++) {
            a.push(this.selectNodes[b].id)
        }
        return a
    },
    getSelectedIds: function() {
        return this.getSelectedItems().join()
    },
    getCheckedItems: function() {
        var a = [];
        if (!this.isCheckStyle()) {
            return a
        }
        for (var b = 0; b < this.getBody().childNodes.length; b++) {
            var c = this.getBody().childNodes[b].childNodes[0].className;
            if (c == "check-on" || c == "gray-on") {
                a.push(this.getBody().childNodes[b].id)
            }
        }
        return a
    },
    getCheckedIds: function() {
        return this.getCheckedItems().join()
    },
    select: function(c, b) {
        var a = this.getNodeById(c);
        if (a == null ) {
            return
        }
        this.unSelectAll();
        DNA.engine.DomUtil.addClass(a, "selected");
        this.selectNodes.push(a)
    },
    addSelect: function(c, b) {
        var a = this.getNodeById(c);
        if (a == null ) {
            return
        }
        if (DNA.engine.DomUtil.hasClass(a, "selected")) {
            DNA.engine.DomUtil.removeClass(a, "selected");
            a.style.cssText = "";
            this.selectNodes.remove(a)
        } else {
            if (!DNA.engine.DomUtil.hasClass(a, "selected")) {
                DNA.engine.DomUtil.addClass(a, "selected");
                a.style.cssText = "";
                this.selectNodes.push(a)
            }
        }
    },
    getIdByClickNode: function(b) {
        var a = this.getNodeByChild(b, 3);
        if (a != null ) {
            return a.id
        }
        return null 
    },
    getNodeByClickNode: function(b) {
        var a = this.getNodeByChild(b, 3);
        if (a != null ) {
            return a
        }
        return null 
    },
    getNodeByChild: function(b, c) {
        for (var a = 0; a < c; a++) {
            if (DNA.engine.DomUtil.hasClass(b, "ListItem")) {
                return b
            }
            b = b.parentNode
        }
        return null 
    },
    unSelect: function(b) {
        var a = this.getNodeById(b);
        DNA.engine.DomUtil.removeClass(a, "selected");
        this.selectNodes.remove(a)
    },
    _registEvents: function() {
        this.addListener2("mousemove", this._onMousemove);
        this.addListener2("mouseout", this._onMouseout);
        this.addListener2("mousedown", this._onMousedown);
        this.addListener2("dragover", this._doDragOver);
        this.addListener2(DNA.JWTEvent.KEYDOWN, this._onKeydown)
    },
    _selectByKey: function(b, c) {
        var a = this.selectNodes;
        if (a == null  || a.length <= 0) {
            if (b == DNA.widget.Listrace.KEY_DOWN) {
                a = (this.body || this._body || this.el).firstChild;
                if (a) {
                    var d = {
                        doit: true,
                        control: this,
                        item: a
                    };
                    this.fireEvent("selectionchanging", [d]);
                    if (d.doit === false) {
                        return
                    }
                    this.doSelectIds(a.id);
                    this.fireEvent("selection", [this, c])
                }
            }
            return
        }
        a = a[0];
        if (b == DNA.widget.Listrace.KEY_UP || b == DNA.widget.Listrace.KEY_LEFT) {
            a = a.previousSibling
        } else {
            a = a.nextSibling
        }
        if (a) {
            var d = {
                doit: true,
                control: this,
                item: a
            };
            this.fireEvent("selectionchanging", [d]);
            if (d.doit === false) {
                return
            }
            this.doSelectIds(a.id);
            this.fireEvent("selection", [this, c])
        }
    },
    _doDragOver: function(b) {
        this.posInfo = "";
        if (!this.el) {
            return
        }
        var a = this.getNodeByChild(b.getSrcElement(), 2);
        if (a) {
            this.posInfo = a.id
        }
    },
    _onMousemove: function(c) {
        var a = c.getSrcElement();
        var b = this.getNodeByClickNode(a);
        this._setHover(b)
    },
    _onMouseout: function(a) {
        this._removeHover()
    },
    _setHover: function(a) {
        if (this.hoverd != a) {
            this._removeHover();
            if (a) {
                DNA.engine.DomUtil.addClass(a, "hover");
                this.hoverd = a;
                this._animatedHover(a)
            }
        }
    },
    _animatedHover: function(b, c) {
        if (DNA.engine.application.isAnimated() && !(this._hoverAnimation && this._hoverAnimation.id == b.id)) {
            if (c) {
                if (this.hoverd == b) {
                    var a = b.childNodes[1].firstChild ? b.childNodes[1] : b.childNodes[2];
                    if (this._unhoverAnimation && this._unhoverAnimation.id == b.id) {
                        this._unhoverAnimation.stop()
                    }
                    var m = new DNA.engine.Sprite(a);
                    m.setMargin({
                        left: 0,
                        top: 0
                    });
                    var l = new DNA.engine.Sprite(a);
                    l.setMargin({
                        left: 5,
                        top: 0
                    });
                    var g = this._hoverAnimation = new DNA.engine.Animation(new DNA.engine.LinearMotion(new DNA.engine.Frame([m]),new DNA.engine.Frame([l]),20,300));
                    g.id = b.id;
                    function h(p, q, o) {
                        if (p == this._hoverAnimation) {
                            delete this._hoverAnimation
                        }
                        if (this.hoverd != q) {
                            o.style.marginLeft = "0px"
                        } else {
                            o.style.marginLeft = "5px"
                        }
                        delete p.id
                    }
                    g.setEndCallBack(h, this, [g, b, a]);
                    g.play()
                }
            } else {
                var n = this;
                function d() {
                    try {
                        n._animatedHover(b, true)
                    } catch (o) {}
                }
                setTimeout(d, 100)
            }
        }
    },
    _removeHover: function() {
        if (this.hoverd) {
            DNA.engine.DomUtil.removeClass(this.hoverd, "hover");
            this._animatedUnhover(this.hoverd);
            this.hoverd = null 
        }
    },
    _animatedUnhover: function(g) {
        if (DNA.engine.application.isAnimated() && !(this._unhoverAnimation && this._unhoverAnimation.id == g.id)) {
            var d = g.childNodes[1].firstChild ? g.childNodes[1] : g.childNodes[2];
            if (this._hoverAnimation && this._hoverAnimation.id == g.id) {
                this._hoverAnimation.stop()
            } else {
                if (d.style.marginLeft != "" && d.style.marginLeft != "0px") {
                    var a = new DNA.engine.Sprite(d);
                    a.setMargin({
                        left: 5,
                        top: 0
                    });
                    var c = new DNA.engine.Sprite(d);
                    c.setMargin({
                        left: 0,
                        top: 0
                    });
                    var h = this._unhoverAnimation = new DNA.engine.Animation(new DNA.engine.LinearMotion(new DNA.engine.Frame([a]),new DNA.engine.Frame([c]),20,300));
                    h.id = g.id;
                    function b(m, o, l) {
                        if (m == this._unhoverAnimation) {
                            delete this._unhoverAnimation
                        }
                        if (this.hoverd != o) {
                            l.style.marginLeft = "0px"
                        } else {
                            l.style.marginLeft = "5px"
                        }
                        delete m.id
                    }
                    h.setEndCallBack(b, this, [h, g, d]);
                    h.play()
                }
            }
        }
    },
    _resize: function() {
        if (this.initedScroll === false) {
            this.setScrollPosition()
        }
    },
    doDispose: function() {
        delete this.selectNodes;
        DNA.widget.LWList.superclass.doDispose.apply(this, arguments)
    },
    _multiSelect: function(h, a) {
        this.unSelectAll();
        var g = DNA.engine.DomUtil.getPageXY(h).y;
        var d = DNA.engine.DomUtil.getPageXY(a).y;
        if (d < g) {
            var b = h;
            h = a;
            a = b
        }
        if (h == a) {
            this.addSelect(h.id);
            return
        }
        for (var c = h; c != a; c = c.nextSibling) {
            this.addSelect(c.id)
        }
        this.addSelect(a.id)
    },
    _onCheckBox: function(c, b, d) {
        var a = d.className;
        if (a.indexOf("check-") >= 0 || a.indexOf("gray-") >= 0) {
            if (a == "check-on") {
                d.className = "check-off"
            } else {
                if (a == "check-off") {
                    d.className = "check-on"
                } else {
                    if (a == "gray-off") {
                        d.className = "gray-on"
                    } else {
                        if (a == "gray-on") {
                            d.className = "gray-off"
                        }
                    }
                }
            }
            this._animatedCheck(d);
            this.fireEvent("check", [this, b.id, c]);
            return false
        }
    },
    _animatedCheck: function(a) {
        var c = new DNA.engine.Sprite(a);
        c.setScale(1.1);
        var b = new DNA.engine.Sprite(a);
        b.setScale(1);
        new DNA.engine.LinearMotion(new DNA.engine.Frame([c]),new DNA.engine.Frame([b]),30,400).play()
    },
    _onMousedown: function(d) {
        var a = d.getSrcElement();
        var c = this.getNodeByClickNode(a);
        if (c == null ) {
            return
        }
        if (this._onCheckBox(d, c, a) === false) {
            return
        }
        var g = {
            doit: true,
            control: this,
            item: c
        };
        this.fireEvent("selectionchanging", [g]);
        if (g.doit === false) {
            return
        }
        var b = this._lastSelected;
        if (d.isShift() && b && ((this.getStyle() & DNA.JWT.MULTI) != 0)) {
            this._multiSelect(c, b)
        } else {
            if (d.isCtrl() && ((this.getStyle() & DNA.JWT.MULTI) != 0)) {
                this.addSelect(c.id);
                this._lastSelected = c
            } else {
                this.select(c.id);
                this._lastSelected = c
            }
        }
        this.fireEvent("selection", [this, d]);
        this.fireEvent("nodeClick", [this, d])
    }
});
Object.override(DNA.widget.LWList.prototype, {
    jtype: "LWList",
    focusable: true
});
Object.override(DNA.widget.LWList.prototype, DNA.widget.Listrace.fn);
DNA.widget.LWList.prototype._onMousedown = DNA.widget.Listrace.before(DNA.widget.LWList.prototype._onMousedown, DNA.widget.Listrace.filterEvent);
DNA.widget.LWTable = function(a) {
    DNA.widget.LWTable.superclass.constructor.call(this, a);
    this.initedScroll = false
}
;
DNA.widget.LWTable.extend(DNA.widget.Control, {
    computeSize: function(d, b, g) {
        var c = new DNA.widget.Point();
        if (!d || d == DNA.JWT.DEFAULT) {
            c.x = 200
        } else {
            c.x = d
        }
        if (!b || b == DNA.JWT.DEFAULT) {
            c.y = 200
        } else {
            c.y = b
        }
        var a = this.getBorderSize();
        c.x += a;
        c.y += a;
        return c
    },
    _setBackground: function(b) {
        if (b) {
            var a = b.toLocaleUpperCase();
            if (a == "WHITE" || a == "#FFFFFF") {
                this.el.style.backgroundColor = ""
            } else {
                this.el.style.backgroundColor = b
            }
        } else {
            this.el.style.backgroundColor = ""
        }
        this.fixedTable.style.backgroundColor = b || "";
        this.table.style.backgroundColor = b || ""
    },
    setHeaderHeight: function(a) {
        DNA.engine.DomUtil.setStyle(this._headerEl.firstChild, "height", a + "px");
        DNA.engine.DomUtil.setStyle(this.fixedHeader.firstChild, "height", a + "px")
    },
    setItemHeight: function(b) {
        var d = this.body.childNodes;
        for (var c = 0, a = d.length; c < a; c++) {
            var g = d[c];
            DNA.engine.DomUtil.setStyle(g, "height", b + "px")
        }
    },
    setHeaderVisible: function(a) {
        DNA.engine.DomUtil.setStyle(this._headerEl.firstChild, "display", a ? "" : "none");
        DNA.engine.DomUtil.setStyle(this.fixedHeader.firstChild, "display", a ? "" : "none")
    },
    getHeaderVisible: function() {
        return this._headerEl.firstChild.style.display != "none"
    },
    getColumnCount: function() {
        return this._headerEl.firstChild.childNodes.length
    },
    setLineVisible: function(p) {
        this._lineVisible = p;
        var a = this.body.childNodes;
        for (var m = 0, n = a.length; m < n; m++) {
            var o = a[m];
            var h = o.childNodes;
            for (var g = 0, d = h.length; g < d; g++) {
                var c = h[g];
                c.style.borderRightWidth = p ? "1px" : "0px";
                c.style.borderBottomWidth = p ? "1px" : "0px"
            }
        }
    },
    getLineVisible: function() {
        if (this._lineVisible == undefined) {
            this._lineVisible = this.table.style.border == ""
        }
        return this._lineVisible
    },
    _doPreRebuildElements: function() {
        this._rebuildIds = this.getSelectedIds();
        this.selectNodes = [];
        this._lastSelected = null 
    },
    _buildElements: function(a) {
        var b = DNA.widget.LWTable.superclass._buildElements.apply(this, arguments);
        if (a) {
            this._didRebuildElement()
        }
        return b
    },
    _didRebuildElement: function() {
        this.doSelectIds(this._rebuildIds, false);
        delete this._rebuildIds
    },
    _doBuildElements: function() {
        this.table = this.el.firstChild;
        this._headerEl = this.el.firstChild.firstChild;
        this.body = this.el.firstChild.lastChild;
        this.fixedTable = this.el.lastChild;
        this.fixedHeader = this.fixedTable.firstChild;
        this.headers = this._headerEl.firstChild.childNodes;
        this.fixedHeaders = this.fixedHeader.firstChild.childNodes
    },
    setScrollPosition: function() {
        if (this.selectNodes != null  && this.selectNodes.length > 0) {
            var a = this.selectNodes[0];
            if (DNA.widget.Listrace.setScrollPosition(this.el, a, 21, this)) {
                this._onScroll()
            }
        }
    },
    getNodeIndex: function(b) {
        for (var a = 0; a < this.body.childNodes.length; a++) {
            if (this.body.childNodes[a].id == b.id) {
                return a
            }
        }
        return -1
    },
    getItemText: function(c) {
        var a = this.getNodeById(c);
        if (a == null ) {
            return null 
        }
        var b = a.firstChild.childNodes[2];
        return b.innerText || b.textContent
    },
    setItemText: function(c, b) {
        var a = this.getNodeById(c);
        if (a == null ) {
            return null 
        }
        DNA.engine.DomUtil.setInnerText(a.firstChild.childNodes[2], b)
    },
    getSelectedItems: function() {
        var a = [];
        for (var b = 0; b < this.selectNodes.length; b++) {
            a.push(this.selectNodes[b].id)
        }
        return a
    },
    getCheckedItems: function() {
        var a = [];
        for (var b = 0; b < this.body.childNodes.length; b++) {
            var c = this.body.childNodes[b].firstChild.firstChild.className;
            if (c == "check-on" || c == "gray-on") {
                a.push(this.body.childNodes[b].id)
            }
        }
        return a
    },
    getClientDataNode: function(a) {
        return a.firstChild.childNodes[3]
    },
    getClientDataById: function(b) {
        var a = this.getNodeById(b);
        if (a == null ) {
            return null 
        }
        return this.getClientDataNode(a).innerHTML
    },
    refresh: function(c) {
        if (DNA.engine.Client.isIE()) {
            this.removeAllAndFiller();
            var d = "</tr>";
            var a = c.split(d);
            for (var b = 0; b < a.length - 1; b++) {
                this.insert(a[b] + d)
            }
            this.unSelectAll()
        } else {
            this.body.innerHTML = c
        }
        this.selectNodes = [];
        this._lastSelected = null 
    },
    insert: function(b) {
        if (b == null ) {
            return
        }
        var a;
        for (a = 0; a < this.body.childNodes.length; a++) {
            if (this.body.childNodes[a].className == "") {
                break
            }
        }
        if (a == 0) {
            DNA.engine.DomUtil.insertHtml(this.body, DNA.engine.DomUtil.AFTERBEGIN, b)
        } else {
            DNA.engine.DomUtil.insertHtml(this.body.childNodes[a - 1], DNA.engine.DomUtil.AFTEREND, b)
        }
        var c = this.getIdFromHtml(b)
    },
    getIdFromHtml: function(b) {
        if (b == null ) {
            return null 
        }
        var c = b.indexOf(" id");
        if (c < 0) {
            return null 
        }
        c = b.indexOf('"', c);
        var a = b.indexOf('"', c + 1);
        if (c > 0 && a > c) {
            return b.substring(c + 1, a)
        }
    },
    _setForeground: function(b) {
        var a = this._getStyleEl();
        if (a) {
            a.style.color = b || ""
        }
        this.fixedTable.style.color = b || "";
        this.table.style.color = b || ""
    },
    insertToTarget: function(a, d, c) {
        if (a == null ) {
            return
        }
        var b = this.getNodeById(d);
        if (b == null ) {
            this.insert(a);
            return
        }
        DNA.engine.DomUtil.insertHtml(b, c == "true" ? DNA.engine.DomUtil.BEFOREBEGIN : DNA.engine.DomUtil.AFTEREND, a);
        var g = this.getIdFromHtml(a)
    },
    remove: function(b) {
        var a = this.getNodeById(b);
        if (a == null ) {
            return
        }
        this.body.removeChild(a);
        this.selectNodes.remove(a)
    },
    clear: function() {
        this.removeAll()
    },
    removeAll: function() {
        this.selectNodes = [];
        if (DNA.engine.Client.isIE()) {
            this.fixedTable.style.top = "0px";
            var a = this.el.innerHTML;
            a = a.replace(/<TBODY>[\s\S]+?<\/TBODY>/ig, "<TBODY></TBODY>");
            this.el.innerHTML = a;
            this._doBuildElements();
            this.fixedTable.style.top = null 
        } else {
            this.body.innerHTML = ""
        }
    },
    removeAllAndFiller: function() {
        while (this.body.childNodes.length > 0) {
            this.body.removeChild(this.body.childNodes[0])
        }
        this.selectNodes = []
    },
    getNodeById: function(b) {
        if (b == null ) {
            return null 
        }
        for (var a = 0; a < this.body.childNodes.length; a++) {
            if (this.body.childNodes[a].id == null ) {
                return null 
            }
            if (this.body.childNodes[a].id == b) {
                return this.body.childNodes[a]
            }
        }
        return null 
    },
    getIndexById: function(b) {
        if (b == null  || b == "") {
            return -1
        }
        for (var a = 0; a < this.body.childNodes.length; a++) {
            if (this.body.childNodes[a].className == "") {
                return -1
            } else {
                if (this.body.childNodes[a].id == b) {
                    return a
                }
            }
        }
    },
    update: function(c, h) {
        var d = this.getNodeById(h);
        if (d == null ) {
            return
        }
        var g = c.split("#,#");
        var a = g.length / 2;
        var l = d.firstChild;
        l.childNodes[1].innerHTML = g[0];
        l.childNodes[2].innerHTML = g[1];
        for (var b = 1; b < a; b++) {
            l = d.childNodes[b];
            l.childNodes[0].innerHTML = g[2 * b];
            l.childNodes[1].innerHTML = g[2 * b + 1]
        }
    },
    isCheckStyle: function() {
        return (this.getStyle() & DNA.JWT.CHECK) != 0
    },
    gray: function(b) {
        if (!this.isCheckStyle()) {
            return
        }
        var a = this.getNodeById(b);
        if (a == null ) {
            return
        }
        a = a.childNodes[0].childNodes[0];
        a.className = a.className.replace("check-on", "gray-on");
        a.className = a.className.replace("check-off", "gray-off")
    },
    unGray: function(b) {
        if (!this.isCheckStyle()) {
            return
        }
        var a = this.getNodeById(b);
        if (a == null ) {
            return
        }
        a = a.childNodes[0].childNodes[0];
        a.className = a.className.replace("gray-on", "check-on");
        a.className = a.className.replace("gray-off", "check-off")
    },
    check: function(b) {
        if (!this.isCheckStyle()) {
            return
        }
        var a = this.getNodeById(b);
        if (a == null ) {
            return
        }
        a = a.childNodes[0].childNodes[0];
        a.className = a.className.replace("off", "on")
    },
    isChecked: function(b) {
        if (!this.isCheckStyle()) {
            return
        }
        var a = this.getNodeById(b);
        if (a == null ) {
            return
        }
        a = a.childNodes[0].childNodes[0];
        if (a.className.indexOf("on") >= 0) {
            return true
        } else {
            return false
        }
    },
    isGrayed: function(b) {
        if (!this.isCheckStyle()) {
            return
        }
        var a = this.getNodeById(b);
        if (a == null ) {
            return
        }
        a = a.childNodes[0].childNodes[0];
        if (a.className.indexOf("gray") >= 0) {
            return true
        } else {
            return false
        }
    },
    unCheck: function(b) {
        if (!this.isCheckStyle()) {
            return
        }
        var a = this.getNodeById(b);
        if (a == null ) {
            return
        }
        a = a.childNodes[0].childNodes[0];
        a.className = a.className.replace("on", "off")
    },
    unSelectAll: function() {
        for (var a = 0; a < this.selectNodes.length; a++) {
            DNA.engine.DomUtil.removeClass(this.selectNodes[a], "selected")
        }
        this.selectNodes = []
    },
    doSelectIds: function(d, a) {
        d = d || "";
        var c = d.split(",");
        this.unSelectAll();
        if (c.length <= 0) {
            return
        }
        if ((this.getStyle() & DNA.JWT.MULTI) != 0) {
            for (var b = 0; b < c.length; b++) {
                this.addSelect(c[b], true)
            }
        } else {
            this.select(c[c.length - 1])
        }
        if (a !== false) {
            this.setScrollPosition()
        }
    },
    getSelectedIds: function() {
        return this.getSelectedItems().join()
    },
    select: function(b) {
        var a = this.getNodeById(b);
        if (a == null ) {
            return
        }
        this.unSelectAll();
        DNA.engine.DomUtil.addClass(a, "selected");
        this.selectNodes.push(a)
    },
    addSelect: function(c, b) {
        var a = this.getNodeById(c);
        if (a == null ) {
            return
        }
        if (b) {
            DNA.engine.DomUtil.addClass(a, "selected");
            this.selectNodes.push(a);
            return
        }
        if (DNA.engine.DomUtil.hasClass(a, "selected")) {
            DNA.engine.DomUtil.removeClass(a, "selected");
            this.selectNodes.remove(a)
        } else {
            DNA.engine.DomUtil.addClass(a, "selected");
            this.selectNodes.push(a)
        }
    },
    getIdByClickNode: function(b) {
        var a = DNA.widget.Listrace.getNodeByChild(b, "TableItem");
        if (a != null ) {
            return a.id
        }
        return null 
    },
    getNodeByClickNode: function(b) {
        var a = DNA.widget.Listrace.getNodeByChild(b, "TableItem");
        if (a != null ) {
            return a
        }
        return null 
    },
    unSelect: function(b) {
        var a = this.getNodeById(b);
        if (a == null ) {
            return
        }
        DNA.engine.DomUtil.removeClass(a, "selected");
        this.selectNodes.remove(a)
    },
    _registEvents: function() {
        this.addListener2("mousedown", this._onMousedown);
        this.addListener2("mousemove", this._onMousemove);
        this.addListener2("mouseup", this._onMouseup);
        this.addListener2("mouseout", this._onMouseout);
        this.addListener2("dragover", this._onDragover);
        this.addGlobalListener("mouseup", this._onGlobalMouseup);
        this.addDomListener(this.getEl(), "scroll", this._onScroll);
        this.addListener2(DNA.JWTEvent.KEYDOWN, this._onKeydown)
    },
    _selectByKey: DNA.widget.LWList.prototype._selectByKey,
    _onScroll: function() {
        var a = DNA.engine.Client.isIE();
        if (a) {
            return
        }
        this.fixedTable.style.top = this.el.scrollTop + "px"
    },
    _onDragOver: function(b) {
        this.posInfo = "";
        if (!this.el) {
            return
        }
        var a = DNA.widget.Listrace.getNodeByChild(b.getSrcElement(), "TableItem", 2);
        if (a) {
            this.posInfo = a.id
        }
    },
    _onMouseout: function(a) {
        this._removeHover();
        if (this.beginPoint) {
            this.beginPoint = undefined
        }
        this.fixedHeader.style.cursor = "default";
        if (this.moveIndex) {
            this.moveIndex = undefined
        }
    },
    _setHover: function(a) {
        this._removeHover();
        if (a) {
            DNA.engine.DomUtil.addClass(a, "hover");
            this.hoverd = a
        }
    },
    _removeHover: function() {
        if (this.hoverd) {
            DNA.engine.DomUtil.removeClass(this.hoverd, "hover");
            this.hoverd = null 
        }
    },
    _resize: function() {
        if (this.initedScroll === false) {
            this.setScrollPosition()
        }
    },
    doDispose: function() {
        delete this.selectNodes;
        delete this.el;
        delete this.table;
        delete this._headerEl;
        delete this.body;
        delete this.fixedTable;
        delete this.fixedHeader;
        delete this.headers;
        delete this.fixedHeaders;
        DNA.widget.LWTable.superclass.doDispose.apply(this, arguments)
    },
    _onGlobalMouseup: function(d) {
        var c = d.getXY();
        var g = new DNA.widget.Point();
        var b = this._getPageBounds().x
          , a = this._getPageBounds().y;
        g.x = c.x - b;
        g.y = c.y - a;
        this._doMoveTo(g)
    },
    _setColumnWidth: function(a, b) {
        this.fixedHeaders[a].style.width = b + "px";
        this.headers[a].style.width = b + "px";
        if (DNA.engine.Client.isFF()) {
            this.fireEvent("columnWidthChanged", [this, a, b + 4])
        } else {
            this.fireEvent("columnWidthChanged", [this, a, b])
        }
    },
    _doMoveTo: function(b) {
        if (this.beginPoint) {
            var c = b.x - this.beginPoint.x;
            var a = this.fixedHeaders[this.moveIndex].style.width;
            a = a.toLowerCase().replace("px", "");
            a = new Number(a);
            a = a + c;
            if (a > 0) {
                this._setColumnWidth(this.moveIndex, a)
            }
            this.beginPoint = undefined
        }
        this.fixedHeader.style.cursor = "default";
        if (this.moveIndex) {
            this.moveIndex = undefined
        }
    },
    _onMousemove: function(g) {
        var h = g.getSrcElement();
        var d = this.getNodeByClickNode(h);
        this._setHover(d);
        if (this._isNearHeaderEnd(g.getLocation())) {
            if (this.beginPoint) {
                var b = g.getLocation();
                var c = b.x - this.beginPoint.x;
                var a = this.fixedHeaders[this.moveIndex].style.width;
                a = a.toLowerCase().replace("px", "");
                a = new Number(a);
                a = a + c;
                if (a > 0) {
                    this._setColumnWidth(this.moveIndex, a)
                }
                this.beginPoint = b
            }
        }
    },
    _onMouseup: function(a) {
        this._doMoveTo(a.getLocation())
    },
    _isNearHeaderEnd: function(n) {
        var g = false;
        var m = n.x;
        var l = n.y;
        var a = 0;
        if (this.el.scrollLeft != 0) {
            a -= this.el.scrollLeft
        }
        var b = this.fixedHeader.offsetWidth;
        var o = this.fixedHeader.offsetHeight;
        var c = a;
        if (n.y < o && n.x <= b - a) {
            for (var d = 0, h = this.fixedHeaders.length; d < h; d++) {
                c += this.fixedHeaders[d].offsetWidth;
                if (Math.abs(c - m) <= 12) {
                    if (!this.beginPoint) {
                        if ((d + 1 < h) && (m > c) && (Math.abs(c + this.fixedHeaders[d + 1].offsetWidth - m) <= 12)) {
                            this.moveIndex = d + 1
                        } else {
                            this.moveIndex = d
                        }
                    }
                    g = true;
                    break
                }
                if (c > m + 12) {
                    break
                }
            }
        }
        if (g) {
            this.fixedHeader.style.cursor = "col-resize"
        } else {
            if (!this.beginPoint) {
                this.fixedHeader.style.cursor = "default"
            }
        }
        return g
    },
    _multiSelect: function(h, a) {
        this.unSelectAll();
        var g = DNA.engine.DomUtil.getPageXY(h).y;
        var d = DNA.engine.DomUtil.getPageXY(a).y;
        if (d < g) {
            var b = h;
            h = a;
            a = b
        }
        if (h == a) {
            this.addSelect(h.id);
            return
        }
        for (var c = h; c != a; c = c.nextSibling) {
            this.addSelect(c.id)
        }
        this.addSelect(a.id)
    },
    _onCheckBox: function(c, b, d) {
        var a = d.className;
        if (a.indexOf("check-") >= 0 || a.indexOf("gray-") >= 0) {
            if (a == "check-on") {
                d.className = "check-off"
            } else {
                if (a == "check-off") {
                    d.className = "check-on"
                } else {
                    if (a == "gray-off") {
                        d.className = "gray-on"
                    } else {
                        if (a == "gray-on") {
                            d.className = "gray-off"
                        }
                    }
                }
            }
            this.fireEvent("check", [this, b.id, c]);
            return false
        }
    },
    _onMousedown: function(d) {
        if (this._isNearHeaderEnd(d.getLocation())) {
            this.beginPoint = d.getLocation();
            return
        }
        var a = d.getSrcElement();
        var c = this.getNodeByClickNode(a);
        if (c == null ) {
            return
        }
        if (this._onCheckBox(d, c, a) === false) {
            return
        }
        var g = {
            doit: true,
            control: this,
            item: c
        };
        this.fireEvent("selectionchanging", [g]);
        if (g.doit === false) {
            return
        }
        var b = this._lastSelected;
        if (d.isShift() && b && ((this.getStyle() & DNA.JWT.MULTI) != 0)) {
            this._multiSelect(c, b)
        } else {
            if (d.isCtrl() && ((this.getStyle() & DNA.JWT.MULTI) != 0)) {
                this.addSelect(c.id);
                this._lastSelected = c
            } else {
                this.select(c.id);
                this._lastSelected = c
            }
        }
        this.fireEvent("selection", [this, d]);
        this.fireEvent("nodeClick", [this, d])
    }
});
Object.override(DNA.widget.LWTable.prototype, {
    jtype: "LWTable",
    focusable: true
});
Object.override(DNA.widget.LWTable.prototype, DNA.widget.Listrace.fn);
DNA.widget.LWTable.prototype._onMousedown = DNA.widget.Listrace.before(DNA.widget.LWTable.prototype._onMousedown, DNA.widget.Listrace.filterEvent);
DNA.widget.LWTree = function(a) {
    DNA.widget.LWTree.superclass.constructor.call(this, a);
    this.initedScroll = false
}
;
DNA.widget.LWTree.extend(DNA.widget.Control, {
    computeSize: function(d, b, g) {
        var c = new DNA.widget.Point();
        if (!d || d == DNA.JWT.DEFAULT) {
            c.x = 200
        } else {
            c.x = d
        }
        if (!b || b == DNA.JWT.DEFAULT) {
            c.y = 200
        } else {
            c.y = b
        }
        var a = this.getBorderSize();
        c.x += a;
        c.y += a;
        return c
    },
    _doPreRebuildElements: function() {
        this._lastSelected = null ;
        this._rebuildIds = this.getSelectedIds();
        this.unSelectAll();
        this.hoverd = null 
    },
    _buildElements: function(a) {
        var b = DNA.widget.LWTree.superclass._buildElements.apply(this, arguments);
        if (a) {
            this._didRebuildElement()
        }
        return b
    },
    _didRebuildElement: function() {
        this.doSelectIds(this._rebuildIds, false);
        delete this._rebuildIds;
        this.hoverd = null 
    },
    _doBuildElements: function() {
        this.tree = this.getEl();
        this.hoverd = null 
    },
    removeDataSelect: function(a) {
        this.selectNodes.remove(a)
    },
    addDataSelect: function(a) {
        this.selectNodes.push(a)
    },
    removeDataCheck: function(a) {
        this.checkNodes.remove(a)
    },
    addDataCheck: function(a) {
        this.checkNodes.push(a)
    },
    getItemText: function(c) {
        var a = this.getNodeById(c, this.el);
        if (a == null ) {
            return null 
        }
        var b = this.getTextNode(a);
        return b.innerText || b.textContent
    },
    setItemText: function(d, c) {
        var a = this.getNodeById(d, this.el);
        if (a == null ) {
            return null 
        }
        var b = this.getTextNode(a);
        DNA.engine.DomUtil.setInnerText(b, c)
    },
    getItemBounds: function(l) {
        var d = this.getNodeById(l, this.el);
        if (d == null ) {
            return null 
        }
        var h = this.getTextNode(d);
        var g = this.getImageNode(d);
        var a = g.offsetWidth > 5 ? 18 : 0;
        var c = DNA.engine.DomUtil.getPageBounds(this.el);
        var b = DNA.engine.DomUtil.getPageBounds(h);
        b.x = b.x - c.x - a;
        b.y = b.y - c.y;
        b.width = b.width + a;
        return b
    },
    getSelectedItems: function() {
        return this.getSelectedIds().split(",")
    },
    getCheckedItems: function() {
        return this.getCheckedIds().split(",")
    },
    getSubTreeNode: function(a) {
        return a.lastChild.lastChild
    },
    getIcoNode: function(a) {
        return a.firstChild
    },
    getContentNode: function(a) {
        return a.lastChild
    },
    getCheckNode: function(a) {
        return this.getContentNode(a).firstChild
    },
    getImageNode: function(a) {
        return this.getContentNode(a).childNodes[1]
    },
    getTextNode: function(a) {
        return this.getContentNode(a).childNodes[2]
    },
    getClientDataNode: function(a) {
        return this.getContentNode(a).childNodes[3]
    },
    setClassName: function(b, a) {
        this.getIcoNode(b).className = a
    },
    getClassName: function(a) {
        return this.getIcoNode(a).className
    },
    getText: function(a) {
        return this.getTextNode(a).innerHTML
    },
    serText: function(a, b) {
        this.getTextNode(a).innerHTML = b
    },
    getImage: function(a) {
        return this.getImageNode(a).innerHTML
    },
    serImage: function(a, b) {
        this.getImageNode(a).innerHTML = b
    },
    getClientDataById: function(b) {
        var a = this.getNodeById(b, this.el);
        if (a == null ) {
            return null 
        }
        return this.getClientDataNode(a).innerHTML
    },
    setScrollPosition: function() {
        if (this.selectNodes != null  && this.selectNodes.length > 0) {
            var a = this.selectNodes[0];
            DNA.widget.Listrace.setScrollPosition(this.el, a, 0, this)
        }
    },
    getDataCheck: function() {
        this.checkNodes = [];
        this.getCheckNodeInTree(this.el)
    },
    getCheckNodeInTree: function(a) {
        var d;
        var g;
        var b;
        for (var c = 0; c < a.childNodes.length; c++) {
            g = a.childNodes[c];
            b = this.getCheckNode(g);
            if (b.className == "check-on" || b.className == "gray-on") {
                this.addDataCheck(g)
            }
            d = this.getSubTreeNode(g);
            if (g.childNodes.length > 0) {
                this.getCheckNodeInTree(d)
            }
        }
    },
    clearChildNode: function(a) {
        while (a.childNodes.length > 0) {
            a.removeChild(a.firstChild)
        }
    },
    refresh: function(b, h) {
        this._lastSelected = null ;
        this.hoverd = null ;
        var d = this.getSelectedIds();
        this.unSelectAll();
        if (h == "null") {
            this.unSelectAll();
            this.el.innerHTML = b
        } else {
            var g = this.getNodeById(h, this.el);
            if (g != null ) {
                var a = this.getSubTreeNode(g);
                if (b == "") {
                    this.clearChildNode(a)
                } else {
                    a.style.display = "";
                    a.innerHTML = b;
                    var c = this.getClassName(g);
                    if (c.indexOf("-line") >= 0) {
                        c = c.replace("-line", "-plus");
                        this.setClassName(g, c);
                        a.style.display = "none"
                    }
                }
            }
        }
        this.doSelectIds(d, false)
    },
    reset: function(g, d) {
        var c = this.getNodeById(g, this.el);
        if (c == null ) {
            return
        }
        var a = this.getSubTreeNode(c);
        if (a.childNodes.length > 0) {
            a.style.display = "none"
        }
        var b = this.getClassName(c);
        if (d == "true") {
            b = b.replace("-line", "-plus")
        } else {
            if (d == "false") {
                b = b.replace("-plus", "-line");
                b = b.replace("-minus", "-line")
            }
        }
        this.setClassName(c, b)
    },
    insert: function(a) {
        return this.insertToParent(a, "null")
    },
    insertToTarget: function(g, b, h) {
        var c = this.getNodeById(b, this.el);
        if (c == null ) {
            this.insert(g)
        } else {
            var n = g.split("#span#");
            var a = n[0];
            var d = n[1];
            var l = n[2];
            var q = n[3];
            var r = '<div class="TreeItem-1" id="' + a + '"><span class=node-end-line></span><span class=content>' + l + "<div class=sub></div></span></div>";
            var p = c.parentNode;
            if (h == "true") {
                DNA.engine.DomUtil.insertHtml(c, DNA.engine.DomUtil.BEFOREBEGIN, r);
                var o = c.previousSibling;
                this.getSubTreeNode(o).style.display = "none";
                var m = this.createClassName(o != p.firstChild, true, d == "true", q == "true");
                this.setClassName(o, m);
                m = this.getClassName(c);
                if (m.indexOf("-line") >= 0) {
                    d = "false"
                } else {
                    d = "true"
                }
                m = this.createClassName(true, c != p.lastChild, d == "true", this._isExpand(c));
                this.setClassName(c, m)
            } else {
                DNA.engine.DomUtil.insertHtml(c, DNA.engine.DomUtil.AFTEREND, r);
                var o = c.nextSibling;
                this.getSubTreeNode(o).style.display = "none";
                var m = this.createClassName(true, o != p.lastChild, d == "true", q == "true");
                this.setClassName(o, m);
                this.setBackground(o, o != p.lastChild);
                m = this.getClassName(c);
                if (m.indexOf("-line") >= 0) {
                    d = "false"
                } else {
                    d = "true"
                }
                m = this.createClassName(c != p.firstChild, true, d == "true", this._isExpand(c));
                this.setClassName(c, m);
                this.setBackground(c, true)
            }
        }
    },
    setBackground: function(a, b) {
        if (b == true) {
            a.className = "TreeItem-1"
        } else {
            if (b == false) {
                a.className = "TreeItem-0"
            }
        }
    },
    insertToParent: function(l, d) {
        var o = l.split("#span#");
        var b = o[0];
        var g = o[1];
        var m = o[2];
        var r = o[3];
        var n;
        var q;
        var a;
        var c;
        var s = '<div class="TreeItem-0" id="' + b + '"><span class=node-end-line></span><span class=content>' + m + "<div class=sub></div></span></div>";
        var p;
        if (d == "null") {
            p = this.el;
            DNA.engine.DomUtil.insertHtml(p, DNA.engine.DomUtil.BEFOREEND, s);
            q = p.lastChild;
            n = this.createClassName(q != p.firstChild, false, g == "true", r == "true");
            this.setClassName(q, n);
            if (p.childNodes.length > 1) {
                a = q.previousSibling;
                n = this.getClassName(a);
                if (a.previousSibling) {
                    n = n.replace("-end-", "-mid-")
                } else {
                    n = n.replace("node-", "node-start-")
                }
                this.setClassName(a, n);
                this.setBackground(a, true)
            }
            p.style.display = ""
        } else {
            var h = this.getNodeById(d, this.el);
            if (h == null ) {
                return
            }
            p = this.getSubTreeNode(h);
            DNA.engine.DomUtil.insertHtml(p, DNA.engine.DomUtil.BEFOREEND, s);
            q = p.lastChild;
            n = this.createClassName(true, false, g == "true", r == "true");
            this.setClassName(q, n);
            if (p.childNodes.length > 1) {
                a = q.previousSibling;
                n = this.getClassName(a);
                n = n.replace("-end-", "-mid-");
                this.setClassName(a, n);
                this.setBackground(a, true)
            }
        }
        this.getSubTreeNode(q).style.display = "none"
    },
    createClassName: function(c, a, b, d) {
        if (c && a) {
            if (b) {
                return d ? "node-mid-minus" : "node-mid-plus"
            } else {
                return "node-mid-line"
            }
        } else {
            if (!c && !a) {
                if (b) {
                    return d ? "node-minus" : "node-plus"
                } else {
                    return "node-line"
                }
            } else {
                if (c && !a) {
                    if (b) {
                        return d ? "node-end-minus" : "node-end-plus"
                    } else {
                        return "node-end-line"
                    }
                } else {
                    if (!c && a) {
                        if (b) {
                            return d ? "node-start-minus" : "node-start-plus"
                        } else {
                            return "node-start-line"
                        }
                    }
                }
            }
        }
        return ""
    },
    remove: function(l) {
        var h = this.getNodeById(l, this.el);
        if (h == null ) {
            return
        }
        this.removeDataSelect(h);
        var d = h.parentNode;
        var b = h.previousSibling;
        var a = h.nextSibling;
        var c;
        d.removeChild(h);
        if (d.childNodes.length == 0) {
            if (d.className.indexOf("LWTree") !== -1) {
                return
            } else {
                if (d.className == "sub") {
                    var g = this.getNodeByClickNode(d);
                    c = this.getClassName(g);
                    c = c.replace("-minus", "-line");
                    this.setClassName(g, c)
                }
            }
            d.style.display = "none"
        } else {
            if (a == null ) {
                c = this.getClassName(b);
                if (b == d.firstChild) {
                    if (d.className.indexOf("LWTree") !== -1) {
                        c = c.replace("-start-", "-")
                    } else {
                        if (d.className == "sub") {
                            c = c.replace("-mid-", "-end-")
                        }
                    }
                } else {
                    c = c.replace("-mid-", "-end-")
                }
                this.setClassName(b, c);
                this.setBackground(b, false)
            } else {
                if (b == null ) {
                    c = this.getClassName(a);
                    if (a == d.lastChild) {
                        if (d.className.indexOf("LWTree") !== -1) {
                            c = c.replace("-end-", "-")
                        }
                    }
                    this.setClassName(a, c)
                }
            }
        }
    },
    clear: function() {
        this.removeAll()
    },
    removeAll: function() {
        this.selectNodes = [];
        this.el.innerHTML = ""
    },
    getNodeById: function(g, a) {
        if (g == null  || a == null ) {
            return null 
        }
        for (var c = 0; c < a.childNodes.length; c++) {
            var d = a.childNodes[c];
            if (d.id == g) {
                return d
            } else {
                if (this.getSubTreeNode(d).childNodes.length > 0) {
                    var b = this.getNodeById(g, this.getSubTreeNode(d));
                    if (b != null ) {
                        return b
                    }
                }
            }
        }
        return null 
    },
    update: function(a, h) {
        var b = this.getNodeById(h, this.el);
        if (b == null ) {
            return
        }
        var g = a.split("#,#");
        var c = g[0];
        var d = g[1];
        this.getImageNode(b).innerHTML = c;
        this.getTextNode(b).innerHTML = d
    },
    gray: function(b) {
        if (!this.isCheckStyle()) {
            return
        }
        var a = this.getNodeById(b, this.el);
        if (a == null ) {
            return
        }
        a = this.getCheckNode(a);
        a.className = a.className.replace("check-on", "gray-on");
        a.className = a.className.replace("check-off", "gray-off")
    },
    unGray: function(b) {
        if (!this.isCheckStyle()) {
            return
        }
        var a = this.getNodeById(b, this.el);
        if (a == null ) {
            return
        }
        a = this.getCheckNode(a);
        a.className = a.className.replace("gray-on", "check-on");
        a.className = a.className.replace("gray-off", "check-off")
    },
    check: function(b) {
        if (!this.isCheckStyle()) {
            return
        }
        var a = this.getNodeById(b, this.el);
        if (a == null ) {
            return
        }
        a = this.getCheckNode(a);
        a.className = a.className.replace("off", "on")
    },
    isChecked: function(b) {
        if (!this.isCheckStyle()) {
            return
        }
        var a = this.getNodeById(b, this.el);
        if (a == null ) {
            return
        }
        a = this.getCheckNode(a);
        if (a.className.indexOf("on") >= 0) {
            return true
        } else {
            return false
        }
    },
    isGrayed: function(b) {
        if (!this.isCheckStyle()) {
            return
        }
        var a = this.getNodeById(b, this.el);
        if (a == null ) {
            return
        }
        a = this.getCheckNode(a);
        if (a.className.indexOf("gray") >= 0) {
            return true
        } else {
            return false
        }
    },
    isCheckStyle: function() {
        return (this.getStyle() & DNA.JWT.CHECK) != 0
    },
    unCheck: function(b) {
        if (!this.isCheckStyle()) {
            return
        }
        var a = this.getNodeById(b, this.el);
        if (a == null ) {
            return
        }
        a = this.getCheckNode(a);
        a.className = a.className.replace("on", "off")
    },
    unSelectAll: function() {
        for (var a = 0; a < this.selectNodes.length; a++) {
            var b = this.getTextNode(this.selectNodes[a]);
            DNA.engine.DomUtil.removeClass(b, "selected")
        }
        this.selectNodes = []
    },
    doSelectIds: function(d, a) {
        d = d || "";
        this.unSelectAll();
        var c = d.split(",");
        if (c.length <= 0) {
            return
        }
        if ((this.getStyle() & DNA.JWT.MULTI) != 0) {
            for (var b = 0; b < c.length; b++) {
                this.addSelect(c[b], true)
            }
        } else {
            this.select(c[c.length - 1])
        }
        if (a !== false) {
            this.setScrollPosition()
        }
    },
    getSelectedIds: function() {
        if (this.el.childNodes.length == 0) {
            return
        }
        var b = "";
        for (var a = 0; a < this.selectNodes.length; a++) {
            b += (this.selectNodes[a].id + ",")
        }
        if (b != "") {
            b = b.substring(0, b.length - 1)
        }
        return b
    },
    getCheckedIds: function() {
        if (this.el.childNodes.length == 0) {
            return
        }
        this.getDataCheck();
        var b = "";
        for (var a = 0; a < this.checkNodes.length; a++) {
            b += (this.checkNodes[a].id + ",")
        }
        if (b != "") {
            b = b.substring(0, b.length - 1)
        }
        return b
    },
    select: function(c) {
        var a;
        if (typeof c == "string") {
            a = this.getNodeById(c, this.el)
        } else {
            a = c
        }
        if (a == null  || c == "") {
            return
        }
        var b = this.getTextNode(a);
        this.unSelectAll();
        this.addDataSelect(a);
        DNA.engine.DomUtil.addClass(b, "selected")
    },
    addSelect: function(d, a) {
        var b = this.getNodeById(d, this.el);
        if (b == null ) {
            return
        }
        var c = this.getTextNode(b);
        if (DNA.engine.DomUtil.hasClass(c, "selected") && !a) {
            DNA.engine.DomUtil.removeClass(c, "selected");
            this.removeDataSelect(b)
        } else {
            DNA.engine.DomUtil.addClass(c, "selected");
            this.addDataSelect(b)
        }
    },
    getNodeByClickNode: function(b) {
        var a = this.getNodeByChild(b, 4);
        if (a != null ) {
            return a
        }
        return null 
    },
    getNodeByChild: function(b, c) {
        for (var a = 0; a < c; a++) {
            if (b.className == "TreeItem-0" || b.className == "TreeItem-1") {
                return b
            }
            b = b.parentNode
        }
        return null 
    },
    unSelect: function(c) {
        var a = this.getNodeById(c, this.el);
        if (a == null ) {
            return
        }
        this.removeDataSelect(a);
        var b = getTextNode(a);
        if (b) {
            DNA.engine.DomUtil.removeClass(b, "selected")
        }
    },
    expand: function(g) {
        var b = this.getNodeById(g, this.el);
        if (b == null ) {
            return
        }
        var d = this.getIcoNode(b);
        var c = d.className;
        c = c.replace("-plus", "-minus");
        c = c.replace("-line", "-minus");
        d.className = c;
        var a = this.getSubTreeNode(b);
        if (a.innerHTML != "") {
            this.getSubTreeNode(b).style.display = ""
        }
    },
    unExpand: function(c) {
        var b = this.getNodeById(c, this.el);
        if (b == null ) {
            return
        }
        var a = this.getIcoNode(b);
        if (a.className == "node-start-minus" || a.className == "node-mid-minus" || a.className == "node-end-minus" || a.className == "node-minus") {
            a.className = a.className.replace("-minus", "-plus");
            this.getSubTreeNode(b).style.display = "none"
        }
    },
    _registEvents: function() {
        this.addListener2("mousemove", this._onMousemove);
        this.addListener2("mouseout", this._onMouseout);
        this.addListener2("mousedown", this._onMousedownup);
        this.addListener2("mouseup", this._onMousedownup);
        this.addListener2("dragover", this._onDragOver);
        this.addListener2("dblclick", this._onDblclick);
        this.addListener2(DNA.JWTEvent.KEYDOWN, this._onKeydown)
    },
    _findNext: function(b, a) {
        if (a) {
            if (this._isChildVisible(b)) {
                return this._getChildByIndex(b, 0)
            }
        }
        if (b.nextSibling != null ) {
            return b.nextSibling
        }
        if (b.parentNode.className.indexOf("LWTree") != -1) {
            return null 
        }
        return this._findNext(b.parentNode.parentNode.parentNode, false)
    },
    _findLast: function(a) {
        if (this._isChildVisible(a)) {
            return this._findLast(this._getChildByIndex(a, this.getSubTreeNode(a).childNodes.length - 1))
        }
        return a
    },
    _findPrev: function(a) {
        if (a.previousSibling) {
            return this._findLast(a.previousSibling)
        }
        if (a.parentNode.className.indexOf("LWTree") != -1) {
            return null 
        }
        return a.parentNode.parentNode.parentNode
    },
    _isExpand: function(b) {
        var a = this.getIcoNode(b);
        if (a.className == "node-start-minus" || a.className == "node-mid-minus" || a.className == "node-end-minus" || a.className == "node-minus") {
            return true
        }
        return false
    },
    _isUnExpand: function(b) {
        var a = this.getIcoNode(b);
        if (a.className == "node-start-plus" || a.className == "node-mid-plus" || a.className == "node-end-plus" || a.className == "node-plus") {
            return true
        }
        return false
    },
    _selectByKey: function(b, c) {
        var a = this.selectNodes;
        if (a == null  || a.length <= 0) {
            if (b == DNA.widget.Listrace.KEY_DOWN) {
                a = (this.body || this.el || this._body).firstChild;
                if (a) {
                    var d = {
                        doit: true,
                        control: this,
                        item: a
                    };
                    this.fireEvent("selectionchanging", [d]);
                    if (d.doit === false) {
                        return
                    }
                    this.select(a);
                    this.setScrollPosition();
                    this.fireEvent("selection", [this, c])
                }
            }
            return
        }
        a = a[0];
        if (b == DNA.widget.Listrace.KEY_LEFT) {
            if (this._isExpand(a)) {
                this.expandId = {
                    id: a.id,
                    type: false
                };
                this.fireEvent("expand", [this, c, false]);
                return
            } else {
                if (DNA.engine.DomUtil.hasClass(a.parentNode, "LWTree")) {
                    return
                }
                a = a.parentNode.parentNode.parentNode
            }
        } else {
            if (b == DNA.widget.Listrace.KEY_UP) {
                a = this._findPrev(a)
            } else {
                if (b == DNA.widget.Listrace.KEY_RIGHT) {
                    if (this._isExpand(a)) {
                        if (this._isChildVisible(a)) {
                            a = this._getChildByIndex(a, 0)
                        } else {
                            a = null 
                        }
                    } else {
                        if (this._isUnExpand(a)) {
                            this.expandId = {
                                id: a.id,
                                type: true
                            };
                            this.fireEvent("expand", [this, c, true]);
                            return
                        }
                    }
                } else {
                    a = this._findNext(a, true)
                }
            }
        }
        if (a) {
            var d = {
                doit: true,
                control: this,
                item: a
            };
            this.fireEvent("selectionchanging", [d]);
            if (d.doit === false) {
                return
            }
            this.select(a);
            this.setScrollPosition();
            this.fireEvent("selection", [this, c])
        }
    },
    _onDragOver: function(g) {
        this.posInfo = "";
        if (!this.el) {
            return
        }
        var m = g.getXY();
        var c = g.getSrcElement();
        var b = DNA.widget.Listrace.getNodeByChild(c, "txt", 2);
        if (!b) {
            return
        }
        var l = DNA.widget.Listrace.getNodeByChild(b, ["TreeItem-0", "TreeItem-1"], 3);
        if (!l) {
            return
        }
        var n = l.id;
        var a = DNA.engine.DomUtil.getPageXY(b);
        a = {
            x: m.x - a.x,
            y: m.y - a.y
        };
        var h = b.offsetHeight;
        if (!h || h <= 0 || a.y < 0 || a.y > h) {
            return
        }
        var d = "sub";
        if (a.y < 1 / 3 * h) {
            d = "before"
        } else {
            if (a.y > 2 / 3 * h) {
                d = "after"
            }
        }
        this.posInfo = n + "," + d
    },
    _onMousemove: function(c) {
        var a = c.getSrcElement();
        var b = DNA.widget.Listrace.getNodeByChild(a, ["txt", "icon", "img"], 0);
        if (b) {
            b = DNA.widget.Listrace.getNodeByChild(a, "content", 2);
            b = b.childNodes[2]
        }
        this._setHover(b, c)
    },
    _onMouseout: function(a) {
        this._removeHover(a)
    },
    _setHover: function(a, b) {
        if (this.hoverd == a) {
            return
        }
        this._removeHover(b);
        if (a) {
            DNA.engine.DomUtil.addClass(a, "hover");
            this.hoverd = a;
            b.item = this.hoverd.parentNode.parentNode.id;
            this.fireEvent("mouse_item", [this, b, true]);
            this._animatedHover(a, b.item)
        }
    },
    _animatedHover: function(c, a, d) {
        if (DNA.engine.application.isAnimated() && !(this._hoverAnimation && this._hoverAnimation.id == a)) {
            if (d) {
                if (this.hoverd == c) {
                    var b = c.previousSibling;
                    if (this._unhoverAnimation && this._unhoverAnimation.id == a) {
                        this._unhoverAnimation.stop()
                    }
                    var n = new DNA.engine.Sprite(b);
                    n.setMargin({
                        left: 0,
                        top: 0
                    });
                    var m = new DNA.engine.Sprite(b);
                    m.setMargin({
                        left: 5,
                        top: 0
                    });
                    var h = this._hoverAnimation = new DNA.engine.Animation(new DNA.engine.LinearMotion(new DNA.engine.Frame([n]),new DNA.engine.Frame([m]),20,300));
                    h.id = a;
                    function l(q, r, p) {
                        if (q == this._hoverAnimation) {
                            delete this._hoverAnimation
                        }
                        if (this.hoverd != r) {
                            p.style.marginLeft = "0px"
                        } else {
                            p.style.marginLeft = "5px"
                        }
                        delete q.id
                    }
                    h.setEndCallBack(l, this, [h, c, b]);
                    h.play()
                }
            } else {
                var o = this;
                function g() {
                    try {
                        o._animatedHover(c, a, true)
                    } catch (p) {}
                }
                setTimeout(g, 100)
            }
        }
    },
    _removeHover: function(a) {
        if (this.hoverd) {
            DNA.engine.DomUtil.removeClass(this.hoverd, "hover");
            a.item = this.hoverd.parentNode.parentNode.id;
            this.fireEvent("mouse_item", [this, a, false]);
            this._animatedUnhover(this.hoverd, a.item);
            this.hoverd = null 
        }
    },
    _animatedUnhover: function(d, l) {
        if (DNA.engine.application.isAnimated() && !(this._unhoverAnimation && this._unhoverAnimation.id == l)) {
            var h = d.previousSibling;
            if (this._hoverAnimation && this._hoverAnimation.id == l) {
                this._hoverAnimation.stop()
            } else {
                if (h.style.marginLeft != "" && h.style.marginLeft != "0px") {
                    var a = new DNA.engine.Sprite(h);
                    a.setMargin({
                        left: 5,
                        top: 0
                    });
                    var c = new DNA.engine.Sprite(h);
                    c.setMargin({
                        left: 0,
                        top: 0
                    });
                    var g = this._unhoverAnimation = new DNA.engine.Animation(new DNA.engine.LinearMotion(new DNA.engine.Frame([a]),new DNA.engine.Frame([c]),20,300));
                    g.id = l;
                    function b(o, p, m) {
                        if (o == this._unhoverAnimation) {
                            delete this._unhoverAnimation
                        }
                        if (this.hoverd != p) {
                            m.style.marginLeft = "0px"
                        } else {
                            m.style.marginLeft = "5px"
                        }
                        delete o.id
                    }
                    g.setEndCallBack(b, this, [g, d, h]);
                    g.play()
                }
            }
        }
    },
    _resize: function() {
        if (this.initedScroll === false) {
            this.setScrollPosition()
        }
    },
    doDispose: function() {
        delete this.selectNodes;
        delete this.checkNodes;
        delete this.tree;
        DNA.widget.LWTree.superclass.doDispose.apply(this, arguments)
    },
    _multiSelect: function(h, a) {
        this.unSelectAll();
        var d = DNA.engine.DomUtil.getPageXY(h).y;
        var c = DNA.engine.DomUtil.getPageXY(a).y;
        if (c < d) {
            var b = h;
            h = a;
            a = b
        }
        var g = this._selectGroup(h, a);
        if (g !== true) {
            this._selectLittleBrother(h, a)
        }
    },
    _selectLittleBrother: function(h, b) {
        var c = this._getNodeIndex(h) + 1;
        for (var a = h.parentNode.childNodes.length; c < a; c++) {
            var g = h.parentNode.childNodes[c];
            var d = this._selectGroup(g, b);
            if (d) {
                return true
            }
        }
        this._selectLittleBrother(h.parentNode.parentNode.parentNode, b)
    },
    _getNodeIndex: function(d) {
        var c = d.parentNode.childNodes;
        for (var b = 0, a = c.length; b < a; b++) {
            if (c[b] == d) {
                return b
            }
        }
        return -1
    },
    _getChildByIndex: function(c, a) {
        var b = this.getSubTreeNode(c);
        return b.childNodes[a]
    },
    _selectGroup: function(h, b) {
        this.addSelect(h.id);
        if (h == b) {
            return true
        }
        if (this._isChildVisible(h)) {
            var c = this.getSubTreeNode(h).childNodes;
            for (var d = 0, a = c.length; d < a; d++) {
                var g = this._selectGroup(c[d], b);
                if (g) {
                    return true
                }
            }
        }
    },
    _isChildVisible: function(b) {
        var d = this.getIcoNode(b);
        var c = d.className;
        if (c.indexOf("-minus") == -1) {
            return false
        }
        var a = this.getSubTreeNode(b);
        return a.childNodes.length > 0
    },
    isSelected: function(b) {
        for (var a = 0; a < this.selectNodes.length; a++) {
            if (this.selectNodes[a] == b) {
                return true
            }
        }
        return false
    },
    _justSelectItem: function(b, c) {
        var d = {
            doit: true,
            control: this,
            item: b
        };
        this.fireEvent("selectionchanging", [d]);
        if (d.doit === false) {
            return
        }
        var a = this._lastSelected;
        if (c.isShift() && a && ((this.getStyle() & DNA.JWT.MULTI) != 0)) {
            this._multiSelect(b, a)
        } else {
            if (c.isCtrl() && ((this.getStyle() & DNA.JWT.MULTI) != 0)) {
                this.addSelect(b.id);
                this._lastSelected = b
            } else {
                this.select(b.id);
                this._lastSelected = b
            }
        }
        this.fireEvent("selection", [this, c]);
        this.fireEvent("nodeClick", [this, c])
    },
    _animatedCheck: function(a) {
        var c = new DNA.engine.Sprite(a);
        c.setScale(1.1);
        var b = new DNA.engine.Sprite(a);
        b.setScale(1);
        new DNA.engine.LinearMotion(new DNA.engine.Frame([c]),new DNA.engine.Frame([b]),30,400).play()
    },
    _onMousedownup: function(g) {
        var c = g.getSrcElement();
        var a = g.getLocation();
        var b = g.getOriginalType() == "mousedown";
        if (c.className == "TreeItem-0" || c.className == "TreeItem-1") {
            return
        }
        var d = this.getNodeByClickNode(c);
        if (d == null ) {
            return
        }
        if (b && c.className == "check-on") {
            c.className = "check-off";
            this._animatedCheck(c);
            this.fireEvent("check", [this, d.id, g])
        } else {
            if (b && c.className == "gray-on") {
                c.className = "gray-off";
                this._animatedCheck(c);
                this.fireEvent("check", [this, d.id, g])
            } else {
                if (b && c.className == "check-off") {
                    c.className = "check-on";
                    this._animatedCheck(c);
                    this.fireEvent("check", [this, d.id, g])
                } else {
                    if (b && c.className == "gray-off") {
                        c.className = "gray-on";
                        this._animatedCheck(c);
                        this.fireEvent("check", [this, d.id, g])
                    } else {
                        if (c.className == "node-start-plus" || c.className == "node-mid-plus" || c.className == "node-end-plus" || c.className == "node-plus") {
                            if (!b) {
                                return
                            }
                            this.expandId = {
                                id: d.id,
                                type: true
                            };
                            this.fireEvent("expand", [this, g, true])
                        } else {
                            if (c.className == "node-start-minus" || c.className == "node-mid-minus" || c.className == "node-end-minus" || c.className == "node-minus") {
                                if (!b) {
                                    return
                                }
                                this.expandId = {
                                    id: d.id,
                                    type: false
                                };
                                this.fireEvent("expand", [this, g, false])
                            } else {
                                if (b) {
                                    this.acceptUp = true;
                                    if (!this.isSelected(d) && !g.isCtrl() && !g.isShift()) {
                                        this.acceptUp = false;
                                        this._justSelectItem(d, g)
                                    }
                                } else {
                                    if ((this.isSelected(d) || g.isCtrl() || g.isShift()) && this.acceptUp) {
                                        this._justSelectItem(d, g)
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    },
    _onDblclick: function(c) {
        var a = c.getSrcElement();
        if (a.className == "TreeItem-0" || a.className == "TreeItem-1") {
            return
        }
        var b = this.getNodeByChild(a, 4);
        if (b) {
            this.fireEvent("nodeDBClick", [this, c, b.id])
        }
    }
});
Object.override(DNA.widget.LWTree.prototype, {
    jtype: "LWTree",
    focusable: true
});
Object.override(DNA.widget.LWTree.prototype, DNA.widget.Listrace.fn);
DNA.widget.LWTree.prototype._onMousedownup = DNA.widget.Listrace.before(DNA.widget.LWTree.prototype._onMousedownup, DNA.widget.Listrace.filterEvent);
DNA.widget.CalendarPanel = function(a) {
    DNA.widget.CalendarPanel.superclass.constructor.call(this, a);
    this._selectionDate = new Date();
    this._today = new Date()
}
;
DNA.widget.CalendarPanel.extend(DNA.widget.Control, {
    autoRender: true,
    _getInitData: function() {
        return this._initData
    },
    computeSize: function(c, a, d) {
        var b = new DNA.widget.Point();
        if (c != -1) {
            b.x = c
        } else {
            b.x = 195
        }
        if (a != -1) {
            b.y = a
        } else {
            b.y = 120
        }
        return b
    },
    _doBuildElements: function() {
        this._heads = [];
        for (var a = 0; a < 7; a++) {
            this._heads[a] = this.el.childNodes[0].childNodes[a]
        }
        this._days = [];
        for (var b = 0; b < 6; b++) {
            this._days[b] = [];
            for (var a = 0; a < 7; a++) {
                this._days[b][a] = this.el.childNodes[b + 1].childNodes[a]
            }
        }
    },
    _registEvents: function() {
        this.addListener("mousemove", this._doMouseMove);
        this.addListener("mousedown", this._doMouseDown)
    },
    setDate: function(b, c, a) {
        this._selectionDate = new Date(b,c,a);
        this._reset();
        this._fresh()
    },
    setMaxDate: function(a) {
        this._maxDate = a
    },
    setMinDate: function(a) {
        this._minDate = a
    },
    getMaxDate: function() {
        if (this._maxDate == undefined) {
            this._maxDate = this._getInitData()[DNA.JWTProperty.PROPERTY_MAX_DATE];
            delete this._getInitData()[DNA.JWTProperty.PROPERTY_MAX_DATE]
        }
        if (this._maxDate) {
            if (!isNaN(this._maxDate)) {
                this._maxDate = new Date(this._maxDate);
                this._maxDate = new Date(this._maxDate.getFullYear(),this._maxDate.getMonth(),this._maxDate.getDate())
            }
        }
        return this._maxDate
    },
    getMinDate: function() {
        if (this._minDate == undefined) {
            this._minDate = this._getInitData()[DNA.JWTProperty.PROPERTY_MIN_DATE];
            delete this._getInitData()[DNA.JWTProperty.PROPERTY_MIN_DATE]
        }
        if (this._minDate) {
            if (!isNaN(this._minDate)) {
                this._minDate = new Date(this._minDate);
                this._minDate = new Date(this._minDate.getFullYear(),this._minDate.getMonth(),this._minDate.getDate())
            }
        }
        return this._minDate
    },
    getYear: function() {
        return this._selectionDate.getFullYear()
    },
    getMonth: function() {
        return this._selectionDate.getMonth()
    },
    getDay: function() {
        return this._selectionDate.getDate()
    },
    _fresh: function() {
        var d = this._selectionDate.getFullYear();
        var g = this._selectionDate.getMonth();
        if (this._lastSelectionDom != null ) {
            this._resetDom(this._lastSelectionDom)
        }
        for (var c = 0; c < 6; c++) {
            for (var b = 0; b < 7; b++) {
                var h = this._days[c][b].innerHTML;
                if (h.length > 0 && h.length <= 2) {
                    var a = parseInt(h);
                    if (!this._checkDate(new Date(d,g,a))) {
                        if (b == 0 || b == 6) {
                            this._days[c][b].className = "calendar-day calendar-disableday"
                        } else {
                            this._days[c][b].className = "calendar-day calendar-disableday"
                        }
                        this._days[c][b].setAttribute("dis", true);
                        continue
                    }
                    if ((this._today.getFullYear() == d) && (this._today.getMonth() == g) && (this._today.getDate() == a)) {
                        this._days[c][b].setAttribute("today", true);
                        this._days[c][b].className = "calendar-day-today";
                        this._todayDom = this._days[c][b]
                    }
                    if (this._selectionDate.getDate() == a) {
                        this._days[c][b].setAttribute("selection", true);
                        this._days[c][b].className = "calendar-day-s";
                        this._selectionDom = this._days[c][b]
                    }
                }
            }
        }
    },
    _reset: function() {
        var c = this._selectionDate.getFullYear();
        var g = this._selectionDate.getMonth();
        var d = this._getMonthViewArray(c, g);
        for (var b = 0; b < 6; b++) {
            for (var a = 0; a < 7; a++) {
                this._resetDom(this._days[b][a]);
                var h = d[b * 7 + a];
                this._days[b][a].innerHTML = h
            }
        }
    },
    _resetDom: function(a) {
        if (a.getAttribute("j") == 0 || a.getAttribute("j") == 6) {
            a.className = "calendar-day weekend"
        } else {
            a.className = "calendar-day calendar-workday"
        }
        a.setAttribute("dis", false);
        a.setAttribute("selection", false);
        a.setAttribute("today", false)
    },
    _doMouseMove: new DNA.engine.Action(function(b) {
        var a = b.getSrcElement();
        var c = b.getSrcControl();
        this._processMouseExit(this._lastDom);
        this._processMouseEnter(a);
        this._lastDom = a
    }
    ),
    _doMouseDown: new DNA.engine.Action(function(b) {
        var a = b.getSrcElement();
        var c = b.getSrcControl();
        if (this._isDayBody(a) && this._checkDate(new Date(this.getYear(),this.getMonth(),parseInt(a.innerHTML)))) {
            this._selectionDate.setDate(parseInt(a.innerHTML));
            this._lastSelectionDom = this._selectionDom;
            this._selectionDom = a;
            this._fresh();
            this._fireSelectionEvent(b)
        }
    }
    ),
    _processMouseEnter: function(a) {
        this._processMouseAction(a, "calendar-day-h")
    },
    _processMouseExit: function(a) {
        this._processMouseAction(a, "calendar-day")
    },
    _processMouseAction: function(a, b) {
        if (a) {
            if (this._isDayBody(a) && ("false" === a.getAttribute("dis") || false === a.getAttribute("dis"))) {
                if (!this._isToday(a) && !this._isSelectionDay(a)) {
                    a.className = b
                }
            }
        }
    },
    _isDayBody: function(c) {
        if (c) {
            var b = c.innerHTML;
            var a = b.length;
            if (a > 0 && a <= 2 && !isNaN(b)) {
                return true
            }
        }
        return false
    },
    _isSelectionDay: function(a) {
        return a.getAttribute("selection") === "true" || a.getAttribute("selection") === true
    },
    _isToday: function(a) {
        return a.getAttribute("today") === "true" || a.getAttribute("selection") === true
    },
    _checkDate: function(a) {
        var b = this.getMinDate();
        var c = this.getMaxDate();
        if (c) {
            if (a.getTime() > c.getTime()) {
                return false
            }
        }
        if (b) {
            if (a.getTime() < b.getTime()) {
                return false
            }
        }
        return true
    },
    _getIndexs: function(d) {
        var c = new DNA.widget.Point();
        for (var b = 0; b < 6; b++) {
            for (var a = 0; a < 7; a++) {
                if (this._days[b][a] == d) {
                    c.x = b;
                    c.y = a;
                    return c
                }
            }
        }
        return c
    },
    _getIndexDay: function(g) {
        var b = {
            i: 0,
            j: 0,
            d: 0
        };
        for (var c = 0; c < 6; c++) {
            for (var a = 0; a < 7; a++) {
                if (this._days[c][a] == g) {
                    var d = this._days[c][a].innerHTML;
                    b.i = c;
                    b.j = a;
                    if (d != "&nbsp;") {
                        b.d = parseInt(d)
                    }
                    return b
                }
            }
        }
        return b
    },
    _getMonthViewArray: function(h, a) {
        var g = [];
        var d = new Date(h,a,1).getDay();
        var c = new Date(h,a + 1,0).getDate();
        for (var b = 0; b < 42; b++) {
            g[b] = "&nbsp;"
        }
        for (var b = 0; b < c; b++) {
            g[b + d] = b + 1
        }
        return g
    },
    _fireSelectionEvent: function(a) {
        this.fireEvent("selection", [a])
    },
    _disposeFields: function() {
        delete this._heads;
        delete this._days;
        delete this._lastDom
    }
});
Object.override(DNA.widget.CalendarPanel.prototype, {
    jtype: "CalendarPanel"
});
DNA.widget.ColorCommonPanel = function(a) {
    DNA.widget.ColorCommonPanel.superclass.constructor.call(this, a);
    this.rgb = new DNA.widget.RGB()
}
;
DNA.widget.ColorCommonPanel.extend(DNA.widget.Control, {
    autoRender: true,
    computeSize: function(c, a, d) {
        var b = new DNA.widget.Point();
        if (c != -1) {
            b.x = c
        } else {
            b.x = 320
        }
        if (a != -1) {
            b.y = a
        } else {
            b.y = 250
        }
        return b
    },
    setColor: function(c) {
        c = c & 16777215;
        var m = c >> 16;
        var l = (c >> 8) % 255;
        var a = c % 255;
        this.rgb = new DNA.widget.RGB(m,l,a);
        var d = (m / 51) * 6 * 6 + (l / 51) * 6 + a / 51;
        if (("" + d).indexOf(".") == -1) {
            var h = this.el.childNodes[d];
            if (this._selectElement) {
                DNA.engine.DomUtil.setStyle(this._selectElement, "border", "1px gray solid")
            }
            this._selectElement = h;
            DNA.engine.DomUtil.setStyle(this._selectElement, "border", "1px blue solid")
        }
    },
    getColor: function() {
        return this.rgb.r << 16 | this.rgb.g << 8 | this.rgb.b
    },
    _registEvents: function() {
        this.addListener("mousedown", new DNA.engine.Action({
            handle: function(b) {
                var a = b.getSrcElement();
                var c = b.getSrcControl();
                if (a.getAttribute("r")) {
                    c.rgb.setR(a.getAttribute("r"));
                    c.rgb.setG(a.getAttribute("g"));
                    c.rgb.setB(a.getAttribute("b"));
                    if (c._selectElement) {
                        DNA.engine.DomUtil.setStyle(c._selectElement, "border", "1px gray solid")
                    }
                    c._selectElement = a;
                    DNA.engine.DomUtil.setStyle(a, "border", "1px blue solid");
                    c._fireSelectionEvent(b)
                }
            }
        }));
        this.addListener("mousemove", new DNA.engine.Action({
            handle: function(b) {
                var a = b.getSrcElement();
                var c = b.getSrcControl();
                if (c._lastElement == a) {
                    return
                }
                if (a == c._selectElement) {
                    return
                }
                if (a.getAttribute("r")) {
                    if (c._lastElement) {
                        if (c._lastElement != c._selectElement) {
                            DNA.engine.DomUtil.setStyle(c._lastElement, "border", "1px gray solid");
                            DNA.engine.DomUtil.setStyle(a, "cursor", "auto")
                        }
                    }
                    c._lastElement = a;
                    DNA.engine.DomUtil.setStyle(a, "border", "1px LIGHTBLUE solid");
                    DNA.engine.DomUtil.setStyle(a, "cursor", "pointer")
                }
            }
        }))
    },
    _fireSelectionEvent: function(a) {
        this.fireEvent("selection", [a])
    },
    _disposeFields: function() {
        delete this._lastElement;
        delete this._selectElement
    }
});
Object.override(DNA.widget.ColorCommonPanel.prototype, {
    jtype: "ColorCommonPanel"
});
DNA.widget.ColorDesignPanel = function(a) {
    DNA.widget.ColorDesignPanel.superclass.constructor.call(this, a);
    this.hsl = new DNA.widget.HSL(0,0,128);
    this.bakRGB = null 
}
;
DNA.widget.ColorDesignPanel.extend(DNA.widget.Control, {
    autoRender: true,
    computeSize: function(c, a, d) {
        var b = new DNA.widget.Point();
        if (c != -1) {
            b.x = c
        } else {
            b.x = 357
        }
        if (a != -1) {
            b.y = a
        } else {
            b.y = 168
        }
        return b
    },
    setColor: function(d) {
        d = d & 16777215;
        var l = d >> 16;
        var h = (d >> 8) % 255;
        var c = d % 255;
        this.bakRGB = new DNA.widget.RGB(l,h,c);
        var a = this.hsl;
        this.hsl = this.bakRGB.toHSL();
        if (a.h != this.hsl.h || a.s != this.hsl.s) {
            this._redrawHSPointer()
        }
        if (a.l != this.hsl.l) {
            this._redrawLBody();
            this._redrawLPointer()
        }
    },
    getColor: function() {
        if (this.bakRGB == null ) {
            this.bakRGB = this.hsl.toRGB()
        }
        return this.bakRGB.r << 16 | this.bakRGB.g << 8 | this.bakRGB.b
    },
    _doBuildElements: function() {
        this._hsPanel = this.el.childNodes[0].childNodes[0];
        this._hsPointer = this.el.childNodes[0].childNodes[0].childNodes[0];
        this._lPanel = this.el.childNodes[1].childNodes[0];
        this._lPointer = this.el.childNodes[1].childNodes[1]
    },
    _registEvents: function() {
        this.addListener("mousedown", new DNA.engine.Action({
            handle: function(c) {
                var a = c.getSrcElement();
                var d = c.getSrcControl();
                if (a == d._hsPanel || a == d._hsPointer) {
                    var b = c.getLocation();
                    d._hsDownFlag = true;
                    d._selectHSPanel(b, c)
                } else {
                    if (a.getAttribute("i")) {
                        var b = c.getLocation();
                        d._lDownFlag = true;
                        d._selectLPanel(b.y, c)
                    }
                }
            }
        }));
        this.addListener("mousemove", new DNA.engine.Action({
            handle: function(c) {
                var a = c.getSrcElement();
                var d = c.getSrcControl();
                if (a == d._hsPanel || a == d._hsPointer) {
                    if (d._hsDownFlag) {
                        var b = c.getLocation();
                        d._selectHSPanel(b, c)
                    }
                } else {
                    if (a.getAttribute("i")) {
                        if (d._lDownFlag) {
                            var b = c.getLocation();
                            d._selectLPanel(b.y, c)
                        }
                    }
                }
            }
        }));
        this.addListener("mouseup", new DNA.engine.Action({
            handle: function(b) {
                var a = b.getSrcElement();
                var c = b.getSrcControl()
            }
        }));
        this.addGlobalListener("mouseup", this._doMouseUp, this)
    },
    addGlobalListener: function(b, a, d) {
        var c = new DNA.engine.Action({
            handle: a
        });
        d = d || this;
        DNA.engine.application.getJWTEventMgr().addListener(b, c, d)
    },
    _selectHSPanel: function(c, b) {
        if ((c.x >= 4 && c.x <= 292) && (c.y >= 8 && c.y <= 164)) {
            var a = c.x - 4;
            var d = c.y - 8;
            this.hsl.setH(a * (5 / 4));
            this.hsl.setS(255 - d * (255 / 156));
            this._redrawHSPointer();
            this._redrawLBody();
            this._fireSelectionEvent(b)
        }
    },
    _selectLPanel: function(c, b) {
        if (c >= 8 && c <= 164) {
            var a = c - 8;
            this.hsl.setL(255 - Math.floor(a * (255 / 156)));
            this._redrawLPointer();
            this._fireSelectionEvent(b)
        }
    },
    _fireSelectionEvent: function(a) {
        this.bakRGB = null ;
        this.fireEvent("selection", [a])
    },
    _redrawLBody: function() {
        var b = new DNA.widget.HSL(this.hsl.getH(),this.hsl.getS(),0);
        for (var a = 0; a <= 51; a++) {
            b.setL(255 - a * 5);
            DNA.engine.DomUtil.setStyle(this._lPanel.childNodes[a], "background-color", b.toRGB().getColor())
        }
    },
    _redrawHSPointer: function() {
        var a = Math.floor(this.hsl.getH() * (4 / 5));
        var b = Math.floor((255 - this.hsl.getS()) * (156 / 255));
        DNA.engine.DomUtil.setStyle(this._hsPointer, "left", a - 8 + "px");
        DNA.engine.DomUtil.setStyle(this._hsPointer, "top", b - 8 + "px")
    },
    _redrawLPointer: function() {
        var a = Math.floor((255 - this.hsl.getL()) * (156 / 255));
        DNA.engine.DomUtil.setStyle(this._lPointer, "top", a + "px")
    },
    _doMouseUp: function() {
        this._hsDownFlag = false;
        this._lDownFlag = false
    },
    afterInit: function() {
        this._redrawHSPointer();
        this._redrawLBody();
        this._redrawLPointer()
    },
    doDispose: function() {
        delete this._hsPanel;
        delete this._hsPointer;
        delete this._lPanel;
        delete this._lPointer;
        DNA.widget.ColorDesignPanel.superclass.doDispose.call(this)
    }
});
Object.override(DNA.widget.ColorDesignPanel.prototype, {
    jtype: "ColorDesignPanel"
});
DNA.widget.ScrolledPanel = function(a) {
    DNA.widget.ScrolledPanel.superclass.constructor.call(this, a)
}
;
DNA.widget.ScrolledPanel.extend(DNA.widget.Control, {
    autoRender: true,
    scrollBarSize: 17,
    _registEvents: function() {
        var a = DNA.engine.application.getJWTEventMgr();
        a.handleSelfEvent(this, DNA.JWTEvent.SCROLL, this.el);
        a.addListener(DNA.JWTEvent.PREDISPOSE, this._doBeforeDispose, this);
        if ((this.getStyle() & DNA.JWT.TOP) && (this.getStyle() & DNA.JWT.V_SCROLL)) {
            a.addListener(DNA.JWTEvent.SCROLL, this._showBacktop, this);
            this.addListener(DNA.JWTEvent.CLICK, this._doBacktop, this)
        }
    },
    _doBacktop: new DNA.engine.Action({
        handle: function(a) {
            this.setVerticalPosition(0)
        }
    }),
    _showBacktop: new DNA.engine.Action({
        handle: function(c) {
            var b = c.getSrcControl();
            if (b == this) {
                var a = this._backtopIcon;
                if (!a) {
                    a = this._backtopIcon = DNA.engine.DomUtil.append(this.getEl(), "<div class='backtop'></div>")
                }
                if (this.getEl().scrollTop > 0) {
                    this._relocateBacktopIcon();
                    DNA.engine.DomUtil.setVisible(a, true)
                } else {
                    DNA.engine.DomUtil.setVisible(a, false)
                }
            }
        }
    }),
    _relocation: function() {
        if (this._backtopIcon) {
            this._relocateBacktopIcon()
        }
    },
    _relocateBacktopIcon: function() {
        var b = this.getClientSize();
        if (DNA.engine.Client.isIE() && DNA.engine.Client.getBrowserVersion() < 9) {
            var a = b.width + this.getEl().scrollLeft - 65 - 70;
            var d = b.height + this.getEl().scrollTop - 72 - 100;
            this._backtopIcon.style.position = "absolute"
        } else {
            var c = DNA.engine.DomUtil.getPageXY(this.getEl(), true);
            var a = c.x + b.width - 65 - 70;
            var d = c.y + b.height - 72 - 100;
            this._backtopIcon.style.position = "fixed"
        }
        DNA.engine.DomUtil.setLeftTop(this._backtopIcon, a, d)
    },
    hasVScrollBar: function() {
        var a = this.getBorderSize();
        var b = this.getBounds();
        if (this.getEl().clientWidth + a < b.width) {
            return true
        }
        return false
    },
    hasHScrollBar: function() {
        var a = this.getBorderSize();
        var b = this.getBounds();
        if (this.getEl().clientHeight + a < b.height) {
            return true
        }
        return false
    },
    hasScrollBar: function() {
        var a = this.getBorderSize();
        var b = this.getBounds();
        if (this.getEl().clientWidth + a < b.width || this.getEl().clientHeight + a < b.height) {
            return true
        }
        return false
    },
    isOnScrollBar: function(g) {
        var a = g.x;
        var d = g.y;
        var b = this.getBorderSize();
        var c = this.getBounds();
        if ((this.hasHScrollBar() && (d >= this.el.clientHeight + b / 2 && d <= c.height - b / 2)) || (this.hasVScrollBar() && (a >= this.el.clientWidth + b / 2 && a <= c.width - b / 2))) {
            return true
        }
        return false
    },
    getDragger: function(a) {
        if (!DNA.engine.Client.isFF() || a.getSrcElement() != this.el) {
            return DNA.widget.ScrolledPanel.superclass.getDragger.call(this, a)
        }
        if (!this.getDragHandler() || this.isOnScrollBar(a.getLocation())) {
            return null 
        }
        return DNA.widget.ScrolledPanel.superclass.getDragger.call(this, a)
    },
    _doBeforeDispose: new DNA.engine.Action({
        handle: function(b) {
            if (b.isAncestorOf(this)) {
                var a = DNA.engine.application.getJWTEventMgr();
                a.deleteSelfEvent(this, "scroll", this.el)
            }
        }
    }),
    setHorizontalPosition: function(a) {
        this.getEl().scrollLeft = a
    },
    setVerticalPosition: function(a) {
        this.getEl().scrollTop = a
    },
    getHorizontalPosition: function() {
        return this.getEl().scrollLeft
    },
    getVerticalPosition: function() {
        return this.getEl().scrollTop
    },
    getChildren: function() {
        return DNA.widget.WidgetRegistry.getChildren(this, true)
    },
    _getClientArea: function() {
        var a = this.getBorderSize();
        var b = this.getBounds();
        return {
            width: b.width - a,
            height: b.height - a
        }
    },
    computeSize: function(g, b, h) {
        this._child = DNA.widget.WidgetRegistry.getChildren(this, 0);
        var c = new DNA.widget.Point();
        if (g == DNA.JWT.DEFAULT || b == DNA.JWT.DEFAULT) {
            if (this._child) {
                var d = this._child.computeSize(-1, -1);
                c.x += d.x;
                c.y += d.y
            }
        }
        if (c.x == 0) {
            c.x = DNA.JWT.DEFAULT_WIDTH
        }
        if (c.y == 0) {
            c.y = DNA.JWT.DEFAULT_HEIGHT
        }
        if (g != DNA.JWT.DEFAULT) {
            c.x = g
        }
        if (b != DNA.JWT.DEFAULT) {
            c.y = b
        }
        var a = this.getBorderSize();
        c.x += a;
        c.y += a;
        return c
    },
    getClientSize: function() {
        var c = this._getClientArea();
        var a = c.height;
        var b = c.width;
        if (this.hasHScrollBar()) {
            a = this.getEl().clientHeight
        }
        if (this.hasVScrollBar()) {
            b = this.getEl().clientWidth
        }
        return {
            width: b,
            height: a
        }
    },
    _add: function(b, a) {
        if (!this._child) {
            if (a && this.getEl()) {
                b._render(this.el, DNA.JWT.RENDER_POS_TYPE_LAST, -1, a)
            }
            this._child = b
        }
    },
    reflow: function() {
        var a = this;
        function b() {
            a._resize()
        }
        DNA.adapter.browserPage.addFinalTask([b])
    },
    _doResize: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            this.getParent()._resize()
        }
    }),
    _resize: function() {
        this._child = DNA.widget.WidgetRegistry.getChildren(this, 0);
        if (this._child) {
            var d = this._getClientArea();
            var a = d.width;
            var c = d.height;
            var b = (this.getStyle() & DNA.JWT.H_SCROLL) != 0;
            var l = (this.getStyle() & DNA.JWT.V_SCROLL) != 0;
            if (b || l) {
                var g = this._child.computeSize((!b ? a : -1), (!l ? c : -1), true);
                if (b && l) {
                    d = this._computeHVScroll(g, d);
                    a = d.width;
                    c = d.height
                } else {
                    if (b) {
                        if (g.x > a) {
                            this._setOverFlowXAuto();
                            a = g.x;
                            c -= this.scrollBarSize
                        } else {
                            this._setOverFlowXHidden()
                        }
                    } else {
                        if (l) {
                            if (g.y > c) {
                                c = g.y;
                                a -= this.scrollBarSize;
                                this._setOverFlowYAuto()
                            } else {
                                this._setOverFlowYHidden()
                            }
                        }
                    }
                }
            }
            this._child.setSize(a, c)
        }
        if (this._backtopIcon) {
            this._relocateBacktopIcon()
        }
    },
    _setOverFlowXAuto: function() {
        this.el.style.overflowX = "auto"
    },
    _setOverFlowYAuto: function() {
        this.el.style.overflowY = "auto"
    },
    _setOverFlowXHidden: function() {
        this.el.style.overflowX = "hidden"
    },
    _setOverFlowYHidden: function() {
        this.el.style.overflowY = "hidden"
    },
    _computeHVScroll: function(l, d) {
        var a = d.width;
        var c = d.height;
        if (l.x > a && l.y > c) {
            this._setOverFlowXAuto();
            this._setOverFlowYAuto();
            a = l.x;
            c = l.y
        } else {
            if (l.x > a) {
                a = l.x;
                this._setOverFlowXAuto();
                var g = c - l.y;
                if (g < this.scrollBarSize) {
                    this._setOverFlowYAuto()
                } else {
                    this._setOverFlowYHidden();
                    g = this.scrollBarSize
                }
                c -= g
            } else {
                if (l.y > c) {
                    c = l.y;
                    this._setOverFlowYAuto();
                    var b = a - l.x;
                    if (b < this.scrollBarSize) {
                        this._setOverFlowXAuto()
                    } else {
                        this._setOverFlowXHidden();
                        b = this.scrollBarSize
                    }
                    a -= b
                } else {
                    this._setOverFlowXHidden();
                    this._setOverFlowYHidden()
                }
            }
        }
        d.width = a;
        d.height = c;
        return d
    },
    doDispose: function() {
        DNA.widget.ScrolledPanel.superclass.doDispose.call(this);
        delete this._child;
        delete this._backtopIcon
    },
    getInnerComp: function() {
        var a = DNA.widget.WidgetRegistry.getChildren(this);
        if (a) {
            return a[0]
        }
    }
});
Object.override(DNA.widget.ScrolledPanel.prototype, {
    jtype: "ScrolledPanel"
});
DNA.widget.StyledPanel = function(a) {
    DNA.widget.StyledPanel.superclass.constructor.call(this, a)
}
;
DNA.widget.StyledPanel.extend(DNA.widget.ImageBorderComposite, {
    autoRender: true,
    computeSize: function(b, h, c) {
        var a = this.getChildren()[0];
        var l = this.getChildren()[1];
        var m = a.computeSize(b, h, c);
        var n = l.computeSize(b, h, c);
        var d = this.getImageBorderSize();
        var g = new DNA.widget.Point();
        g.x = n.x + d.width;
        g.y = n.y + d.height;
        return g
    },
    _resize: function() {
        DNA.widget.StyledPanel.superclass._resize.call(this);
        var t = this.getBounds();
        var l = this.getImageBorder();
        var p = this.getBorderSize();
        var d = t.width - p;
        var r = t.height - p;
        var c = this.getChildren()[0];
        var o = this.getChildren()[1];
        if (l) {
            var m = d - l.img_l.width - l.img_r.width;
            m = m > 0 ? m : 0;
            var a = r - l.img_t.height - l.img_b.height;
            a = a > 0 ? a : 0;
            var q = d - l.img_lt.width - l.img_rt.width;
            q = q > 0 ? q : 0;
            var n = l.img_t.height;
            c.setSize(q, n);
            o.setSize(m, a)
        } else {
            var g = c.computeSize(-1, -1, true);
            c.setSize(d, g.y);
            o.setSize(d, r - g.y);
            this._setImageBounds(this._textEl, 0, 0, d, g.y);
            this._setImageBounds(this._body, 0, g.y, d, r - g.y)
        }
    }
});
Object.override(DNA.widget.StyledPanel.prototype, {
    jtype: "StyledPanel"
});
DNA.widget.Grid = function(a) {
    DNA.widget.Grid.superclass.constructor.call(this, a);
    this._doInit();
    this.util = new DNA.widget.GridUtil(this)
}
;
DNA.widget.Grid.extend(DNA.widget.Composite, {
    autoRender: true,
    resizeCursorBound: 2,
    _defaultBorder: new DNA.widget.Border(1,"gray","solid"),
    _selTitleBackColor: "#ffe5a0",
    _selTitleBorderColor: "#f9bc54",
    notifyWillRebuild: function(g) {
        if (g.initFlag) {
            return
        }
        var c = g.getChildren();
        for (var b = 0, a = c.length; b < a; b++) {
            var d = c[b];
            if (d.checkRendered(false)) {
                d.fireEvent("willRebuild")
            }
            if (d.getChildren) {
                if (d.getChildren()) {
                    this.notifyWillRebuild(d)
                }
            }
        }
    },
    _initFormatter: function() {
        var a = this.getInitData()[DNA.JWTProperty.PROPERTY_FORMATTER];
        this.formatterMgr = new DNA.widget.CellFormatterMgr();
        this._addFormatters(a)
    },
    _addFormatters: function(c) {
        if (c) {
            var a = c.length;
            for (var b = 0; b < a; ++b) {
                if (c[b]) {
                    this.formatterMgr.addFormatter(c[b].id, this.createFormatter(c[b].script, c[b].opts))
                }
            }
        }
    },
    checkBuild: function(c) {
        var a = this._checkState(DNA.JWT.STATE_RENDERD);
        if (!a && c) {
            return this._buildElements()
        } else {
            return a
        }
    },
    createFormatter: function(scriptStr, opts) {
        var scrts = [];
        scrts[0] = "(function(){return new (function() {";
        scrts[1] = scriptStr;
        scrts[2] = "})();})();";
        try {
            return eval(scrts.join(""))
        } catch (exception) {
            alert("�ͻ������ɸ�ʽ���쳣��" + exception.toString())
        }
    },
    _doInit: function() {
        this.initFlag = this.getInitData().initFlag;
        delete this.getInitData().initFlag;
        this.gridState = DNA.widget.JWTGrid.STATE_NORMAL;
        this.needHandleGlobal = false;
        this.replacing = false;
        this.selectFinish = true;
        this.operateCell = null ;
        this.operateArea = null ;
        this.minColWidth = 1;
        this.minRowHeight = 1;
        this.defColWidth = 100;
        this.defRowHeight = 20;
        this.columnCount = this.getInitData().colCount;
        delete this.getInitData().colCount;
        this.rowCount = this.getInitData().rowCount;
        delete this.getInitData().rowCount;
        this.hColCount = this.getInitData().headerColCount;
        delete this.getInitData().headerColCount;
        this.hRowCount = this.getInitData().headerRowCount;
        delete this.getInitData().headerRowCount;
        this.contentTable = null ;
        this.currentCell = null ;
        this.gridOption = this.getInitData().gridOption;
        delete this.getInitData().gridOption;
        this.ignoreHidden = this.getInitData().ignoreHidden ? true : false;
        delete this.getInitData().ignoreHidden;
        this.hrDiv = null ;
        this.hrTable = null ;
        this.hcDiv = null ;
        this.hcTable = null ;
        this.resizeRowIdx = 0;
        this.resizeColIdx = 0;
        this.resizeRowPoint = null ;
        this.resizeColPoint = null ;
        this.resizeDiv = null ;
        this.newSize = 0;
        this.mouseCell = null ;
        this.cellOut = null ;
        this.lastMouseCell = {
            x: -1,
            y: -1
        };
        this.selBeginCell = {
            x: 0,
            y: 0
        };
        this.selectionAreas = new Array();
        this.selectionDiv = null ;
        this.currentRow = -1;
        this.currentCol = -1;
        var b = this.getInitData().cccf;
        delete this.getInitData().cccf;
        if (b) {
            var a = b.split(",");
            this.currentCellColorFocused = a[0];
            this.currentCellColorUnFocused = a[1]
        } else {
            this.currentCellColorFocused = null ;
            this.currentCellColorUnFocused = null 
        }
        this.activeEditor = null ;
        this.editorProvider = null 
    },
    _gridAfterInit: function() {},
    computeSize: function(g, b, h) {
        var d = new DNA.widget.Point();
        if (this.checkRendered()) {
            if (g != -1 && b != -1) {
                d.x = g;
                d.y = b
            } else {
                var a = this.getBorderSize();
                d.x += a;
                d.y += a;
                for (var c = 0; c < this.columnCount; c++) {
                    if (this.getColVisible(c)) {
                        d.x += this.getColumnWidthFromStyle(c)
                    }
                }
                for (c = 0; c < this.rowCount; c++) {
                    if (this.getRowVisible(c)) {
                        d.y += this.getRowHeightFromStyle(c)
                    }
                }
                d.y += 1;
                if (g != -1) {
                    if (d.x > g) {
                        d.y += 18
                    }
                    d.x = g
                }
                if (b != -1) {
                    if (d.y > b) {
                        d.x += 18
                    }
                    d.y = b
                }
            }
        } else {
            d.x = this.defColWidth * this.columnCount;
            d.y = this.defRowHeight * this.rowCount
        }
        return d
    },
    _doBuildElements: function() {
        if (this.el.tagName == "IFRAME") {
            if (!this.el.contentWindow.document) {
                return false
            }
            if (!this.el.contentWindow.document.body || !this.el.contentWindow.document.body.firstChild) {
                return false
            }
            this.tDiv = this.el.contentWindow.document.body.firstChild;
            var a = DNA.engine.DomUtil.getClientSize(this.el);
            this.tDiv.style.height = a.height + "px";
            this.tDiv.style.width = a.width + "px"
        } else {
            this.tDiv = this.el
        }
        this.contentTable = this.tDiv.firstChild;
        this.selectionDiv = this.tDiv.childNodes[1];
        this.resizeDiv = this.tDiv.childNodes[2];
        this.mCurLeft = this.tDiv.childNodes[3];
        this.mCurRight = this.tDiv.childNodes[4];
        this.mCurTop = this.tDiv.childNodes[5];
        this.mCurBottom = this.tDiv.childNodes[6];
        this.curLeft = this.mCurLeft;
        this.curRight = this.mCurRight;
        this.curTop = this.mCurTop;
        this.curBottom = this.mCurBottom;
        this.hrDiv = this.tDiv.childNodes[7];
        if (!this.hrDiv || !this.hrDiv.firstChild) {
            return false
        }
        this.hrTable = this.hrDiv.firstChild;
        this.hcDiv = this.tDiv.childNodes[8];
        this.hcTable = this.hcDiv.firstChild;
        this.hltDiv = this.tDiv.childNodes[9];
        this.hltTab = this.hltDiv.firstChild;
        this.inputProxy = this.tDiv.childNodes[10];
        this.listFace = this.tDiv.childNodes[11];
        this.listFace.style.display = "none";
        this.listFace.style.width = "18px";
        this.listFace.style.position = "absolute";
        this.listFace.style.paddingRight = "1px";
        this.listFace.style.paddingTop = "1px";
        this.listFace.style.paddingBottom = "1px";
        this.btnFace = this.tDiv.childNodes[12];
        this.btnFace.style.display = "none";
        this.btnFace.style.width = "18px";
        this.btnFace.style.position = "absolute";
        this.btnFace.style.paddingRight = "1px";
        this.btnFace.style.paddingTop = "1px";
        this.btnFace.style.paddingBottom = "1px";
        var b = DNA.engine.application.getJWTEventMgr();
        b.handleSelfEvent(this, "scroll", this.tDiv);
        if (DNA.engine.Client.isIE()) {
            b.handleSelfEvent(this, "propertychange", this.inputProxy)
        } else {
            if (DNA.engine.Client.isFF()) {
                b.handleSelfEvent(this, "input", this.inputProxy)
            }
        }
        this._ajustLockedSections();
        this._placeLockSections4FF();
        this.setCellEditorProvider(new DNA.widget.CellEditorProvider());
        if (this.getInitData().defEditorId) {
            this.defEditorId = this.getInitData().defEditorId;
            delete this.getInitData().defEditorId
        }
        this.hiddenRows = new Array();
        this.hiddenCols = new Array();
        this.updateCurrentCellColor();
        this._initFormatter();
        if (!this.isEnabled()) {
            this._disableGrid(this)
        }
        this.parentIframe = this.util.getNearestIframeOfDom(this.getEl());
        this._makeParentIframePaintInIE()
    },
    _makeParentIframePaintInIE: function() {
        if (DNA.engine.Client.isIE() && this.parentIframe) {
            var a = this.parentIframe.style.display;
            this.parentIframe.style.display = "none";
            this.parentIframe.style.display = a
        }
    },
    _afterGridCreate: function() {
        if (!(this.el.tagName == "IFRAME")) {
            if (this.getInitData().selections) {
                var c = this.getInitData().selections;
                delete this.getInitData().selections;
                var a = c.length;
                for (var b = 0; b < a; ++b) {
                    this.addSelection(c.get(b))
                }
            }
            this.mergeRectCache = this.getInitData().mergeRects || [];
            delete this.getInitData().mergeRects;
            if (this.getInitData().currentCell) {
                DNA.adapter.browserPage.addFinalTask([this._finalTask, this, [this.getInitData()]])
            }
            this.reCalculateHeaderHeight4FireFoxHavingWrapLine()
        }
    },
    _finalTask: function(b) {
        if (b.currentCell) {
            var a = b.currentCell;
            delete b.currentCell;
            this.setCurrentCell(a, null , null , null , null , DNA.widget.JWTGrid.SETCURRENTCELLCAUSE_PROGRAM)
        }
        if (b.open_editor) {
            delete b.open_editor;
            this.openCurrentEditor()
        }
    },
    _resizeGridDiv: function() {
        if (this.el.tagName == "IFRAME") {
            this.tDiv = this.el.contentWindow.document.body.firstChild;
            var a = DNA.engine.DomUtil.getClientSize(this.el);
            this.tDiv.style.height = a.height + "px";
            this.tDiv.style.width = a.width + "px"
        }
    },
    _resizeChildren: function(b) {
        var d = b.getChildren();
        for (var c = 0, a = d.length; c < a; c++) {
            var g = d[c];
            g.setBounds(0, 0, 0, 0)
        }
    },
    replace2Iframe: function(a) {
        this._replaceDom(a)
    },
    _replaceDom: function(a) {
        this.replacing = true;
        if (this.initFlag) {
            delete this.initFlag
        }
        if (this.tDiv) {
            DNA.engine.application.getJWTEventMgr().deleteSelfEvent(this, "scroll", this.tDiv)
        }
        if (this.inputProxy) {
            if (DNA.engine.Client.isIE()) {
                DNA.engine.application.getJWTEventMgr().deleteSelfEvent(this, "propertychange", this.inputProxy)
            } else {
                if (DNA.engine.Client.isFF()) {
                    DNA.engine.application.getJWTEventMgr().deleteSelfEvent(this, "input", this.inputProxy)
                }
            }
        }
        this.currentCell = null ;
        this.selectionAreas.length = 0;
        this.hiddenRows.length = 0;
        this.hiddenCols.length = 0;
        this.currentRow = -1;
        this.currentCol = -1;
        this.contentTable = null ;
        this.tDiv = null ;
        this.hrDiv = null ;
        this.hrTable = null ;
        this.hcDiv = null ;
        this.hcTable = null ;
        this.hltDiv = null ;
        this.hltTab = null ;
        this.resizeRowIdx = 0;
        this.resizeColIdx = 0;
        this.resizeRowPoint = null ;
        this.resizeColPoint = null ;
        this.resizeDiv = null ;
        this.newSize = 0;
        this.mouseCell = null ;
        this.lastMouseCell = {
            x: -1,
            y: -1
        };
        this.selBeginCell = {
            x: 0,
            y: 0
        };
        this.selectionDiv = null ;
        this.operateCell = null ;
        this.operateArea = null ;
        this.activeEditor = null ;
        this.curFace = null ;
        this.gridState = DNA.widget.JWTGrid.STATE_NORMAL;
        this._clearChildrenEl(this);
        if (a) {
            DNA.widget.Grid.superclass.replace2Iframe.call(this, a)
        }
        this._unmaskState(DNA.JWT.STATE_RENDERD);
        this._makeParentIframePaintInIE()
    },
    _clearChildrenEl: function(b) {
        var d = b.getChildren();
        for (var c = 0, a = d.length; c < a; c++) {
            var g = d[c];
            if (g.getChildren) {
                if (g.getChildren()) {
                    this._clearChildrenEl(g)
                }
            }
            if (g.el) {
                g.fireEvent("beforeReplace");
                g._unmaskState(DNA.JWT.STATE_RENDERD);
                if (g.el) {
                    g.el = null 
                }
            }
        }
    },
    _isResizeable: function() {
        if (this.getEl()) {
            return true
        }
    },
    doDispose: function() {
        DNA.widget.Grid.superclass.doDispose.call(this);
        delete this.util;
        delete this.currentCell;
        delete this.operateCell;
        delete this.operateArea;
        delete this.selectionAreas;
        delete this.contentTable;
        delete this.selectionDiv;
        delete this.resizeDiv;
        delete this.mCurLeft;
        delete this.mCurRight;
        delete this.mCurTop;
        delete this.mCurBottom;
        delete this.curLeft;
        delete this.curRight;
        delete this.curTop;
        delete this.curBottom;
        delete this.hrDiv;
        delete this.hrTable;
        delete this.hcDiv;
        delete this.hcTable;
        delete this.hltDiv;
        delete this.hltTab;
        delete this.inputProxy;
        delete this.listFace;
        delete this.btnFace;
        delete this.hiddenRows;
        delete this.hiddenCols;
        delete this.headerCursor;
        delete this.mergeRectCache;
        delete this.parentIframe
    },
    _placeLockSections4FF: function() {
        if (!this.hrDiv) {
            return
        }
        if (DNA.engine.Client.isFF()) {
            this.hrDiv.style.visibility = "visible";
            this.hcDiv.style.visibility = "visible";
            this.hltDiv.style.visibility = "visible"
        }
    },
    _getPageXY: function(d) {
        var m = d.ownerDocument || d;
        var r;
        if (d.getBoundingClientRect) {
            var h = d.getBoundingClientRect();
            r = {
                x: h.left,
                y: h.top
            }
        } else {
            if (d == m.body || d == m || d == m.documentElement) {
                r = {
                    x: 0,
                    y: 0
                }
            } else {
                var l = 0
                  , g = 0;
                var c = d;
                while (c) {
                    if (c == m) {
                        break
                    }
                    var o = c.offsetLeft;
                    var n = c.offsetTop;
                    var a = c.style;
                    l += o;
                    g += n;
                    if (c != d) {
                        l += parseInt(a.borderLeftWidth, 10) || 0;
                        g += parseInt(a.borderTopWidth, 10) || 0;
                        var q = DNA.engine.DomUtil.getScroll(c);
                        l -= q.x;
                        g -= q.y
                    }
                    c = c.offsetParent
                }
                r = {
                    x: l,
                    y: g
                }
            }
        }
        return r
    },
    _ajustLockedSections: function() {
        var b = DNA.engine.DomUtil.getClientSize(this.tDiv);
        if (b.width === 0 || b.height === 0) {
            return
        }
        if (this.contentTable) {
            var d = DNA.engine.DomUtil.getSize(this.tDiv);
            if ((this.contentTable.offsetHeight > d.height || this.tDiv.scrollHeight > d.height) && d.width < b.width + 10) {
                b.width = d.width - 17 - (d.width - b.width)
            }
            if ((this.contentTable.offsetWidth > d.width || this.tDiv.scrollWidth > d.width) && d.height < b.height + 10) {
                b.height = d.height - 17 - (d.height - b.height)
            }
        }
        this._ajustHCSize(b);
        this._ajustHRSize(b);
        this._ajustHLTSize(b);
        var a = this.tDiv.scrollLeft + "px";
        var c = this.tDiv.scrollTop + "px";
        if (this.hrDiv) {
            this.hrDiv.scrollLeft = this.tDiv.scrollLeft;
            if (DNA.engine.Client.isFF()) {
                this.hrDiv.style.left = a;
                this.hrDiv.style.top = c
            }
        }
        if (this.hcDiv) {
            this.hcDiv.scrollTop = this.tDiv.scrollTop;
            if (DNA.engine.Client.isFF()) {
                this.hcDiv.style.left = a;
                this.hcDiv.style.top = c
            }
        }
        if (this.hltDiv && DNA.engine.Client.isFF()) {
            this.hltDiv.style.left = a;
            this.hltDiv.style.top = c
        }
    },
    _doAfterParentVisible: new DNA.engine.AppSuspendedAction({
        handle: function(d) {
            if (!this.tDiv) {
                return
            }
            if (this.el && this.el.tagName == "IFRAME") {
                if (DNA.engine.Client.isFF()) {
                    this.el.style.display = "none";
                    this.el.style.display = ""
                }
                var c = DNA.engine.DomUtil.getClientSize(this.el);
                var a = this.el.contentWindow.document.body;
                if (a.offsetHeight == 0) {
                    this.el.contentWindow.document.documentElement.id = ""
                }
                DNA.engine.DomUtil.setSize(this.tDiv, c)
            }
            this._ajustLockedSections();
            this.reCalculateHeaderHeight4FireFoxHavingWrapLine()
        }
    }),
    _ajustHCSize: function(m) {
        if (!this.hcTable) {
            return
        }
        var d = DNA.engine.DomUtil.getSize(this.hcTable);
        var n = d.width;
        var c = m.width;
        var l = d.height;
        var b = m.height;
        var a = n <= c ? n : c;
        var g = l <= b ? l : b;
        d.width = a;
        d.height = g;
        DNA.engine.DomUtil.setSize(this.hcDiv, d)
    },
    _ajustHRSize: function(m) {
        if (!this.hrTable) {
            return
        }
        var d = DNA.engine.DomUtil.getSize(this.hrTable);
        var n = d.width;
        var c = m.width;
        var l = d.height;
        var b = m.height;
        var a = n <= c ? n : c;
        var g = l <= b ? l : b;
        d.width = a;
        d.height = g;
        DNA.engine.DomUtil.setSize(this.hrDiv, d)
    },
    _ajustHLTSize: function(m) {
        if (!this.hltTab) {
            return
        }
        var d = DNA.engine.DomUtil.getSize(this.hltTab);
        var n = d.width;
        var c = m.width;
        var l = d.height;
        var b = m.height;
        var a = n <= c ? n : c;
        var g = l <= b ? l : b;
        d.width = a;
        d.height = g;
        DNA.engine.DomUtil.setSize(this.hltDiv, d)
    },
    _buildHeaderCols: function(a) {
        if (!this.checkRendered(true)) {
            return
        }
        this.operateCell = null ;
        var u = this.hColCount > 1 ? this.hColCount : 1;
        if (u < a) {
            this.closeEditor();
            var q = this.rowCount;
            var r;
            var b;
            var l;
            var p = this.hRowCount > 1 ? this.hRowCount : 1;
            for (var h = 0; h <= q; ++h) {
                r = this.hcTable.rows[h];
                b = this.hcTable.ownerDocument.createDocumentFragment();
                var t;
                var q;
                l = this.contentTable.rows[h];
                for (var g = u + 1; g <= a; ++g) {
                    var o = this._getRowCell(l, g - 1, h - 1);
                    t = o.cloneNode(true);
                    var m = t.colSpan ? t.colSpan : 1;
                    if (g + m - 1 > a) {
                        t.colSpan = a - g + 1
                    }
                    if (t.style.display == "none") {
                        var d = new DNA.widget.AbstractGridCell(this,this.contentTable,g - 1,h - 1,false);
                        var s = d.getColIndex();
                        if (s < u && (d.getRowIndex() == (h - 1))) {
                            this._getRowCell(r, s, h - 1).colSpan += 1;
                            this._getCellDom(s, h - 1, this.hltTab).colSpan += 1
                        }
                    }
                    b.appendChild(t)
                }
                if (h <= p) {
                    var n = this.hltTab.ownerDocument.createDocumentFragment();
                    n = b.cloneNode(true);
                    this.hltTab.rows[h].appendChild(n)
                }
                r.appendChild(b)
            }
            this._ajustLockedSections();
            this.hColCount = a;
            if (this.currentCell) {
                var s = this.currentCell.getColIndex();
                if (s >= u && s < a) {
                    this._drawCurrentCellBack();
                    this._drawCurrentCell(this.currentCell)
                }
            }
        }
        var c = a > 1 ? a : 1;
        if (u > c) {
            this.closeEditor();
            this._deleteCols(this.hcTable, c, u - 1);
            this._deleteCols(this.hltTab, c, u - 1);
            this._ajustLockedSections();
            this.hColCount = a;
            if (this.currentCell) {
                var s = this.currentCell.getColIndex();
                if (s < u && s >= c) {
                    this._drawCurrentCellBack();
                    this._drawCurrentCell(this.currentCell)
                }
            }
        }
    },
    _buildHeaderRows: function(m) {
        if (!this.checkRendered(true)) {
            return
        }
        this.operateCell = null ;
        var d = this.hRowCount > 1 ? this.hRowCount : 1;
        if (d < m) {
            this.closeEditor();
            var c;
            var z;
            var u = this.hrTable.rows[0].parentNode;
            var w = this.hrTable.ownerDocument.createDocumentFragment();
            var v = this.hltTab.ownerDocument.createDocumentFragment();
            var l, p;
            var r = this.hColCount > 1 ? this.hColCount : 1;
            for (var s = d + 1; s <= m; ++s) {
                var b = this.contentTable.rows[s];
                l = b.cloneNode(true);
                w.appendChild(l);
                p = b.cloneNode(false);
                for (var t = 0; t <= r; ++t) {
                    var q = this._getRowCell(b, t - 1, s - 1);
                    var a = q.cloneNode(true);
                    var n = a.rowSpan ? a.rowSpan : 1;
                    if (s + n - 1 > m) {
                        a.rowSpan = m - s + 1
                    }
                    if (a.style.display == "none") {
                        var g = new DNA.widget.AbstractGridCell(this,this.contentTable,t - 1,s - 1,false);
                        var o = g.getRowIndex();
                        if (o < d && (g.getColIndex() == (t - 1))) {
                            this._getCellDom(t - 1, o, this.hrTable).rowSpan += 1;
                            this._getCellDom(t - 1, o, this.hltTab).colSpan += 1
                        }
                    }
                    p.appendChild(a)
                }
                v.appendChild(p)
            }
            this.hltTab.rows[0].parentNode.appendChild(v);
            u.appendChild(w);
            this._ajustLockedSections();
            this.hRowCount = m;
            if (this.currentCell) {
                var o = this.currentCell.getRowIndex();
                if (o >= d && o < m) {
                    this._drawCurrentCellBack();
                    this._drawCurrentCell(this.currentCell)
                }
            }
        }
        var h = m > 1 ? m : 1;
        if (d > h) {
            this.closeEditor();
            this._deleteRows(this.hrTable, h, d - 1);
            this._deleteRows(this.hltTab, h, d - 1);
            this._ajustLockedSections();
            this.hRowCount = m;
            if (this.currentCell) {
                var o = this.currentCell.getRowIndex();
                if (o < d && o >= h) {
                    this._drawCurrentCellBack();
                    this._drawCurrentCell(this.currentCell)
                }
            }
        }
    },
    _registEvents: function() {
        var a = DNA.engine.application.getJWTEventMgr();
        a.addListener("mousemove", this._onGlobalMousemove, this);
        a.addListener("mouseup", this._onGlobalMouseup, this);
        a.addListener("scroll", this._onScroll, this);
        this.addListener("dblclick", this._onDblclick);
        a.addBubbleListener("keydown", this.onBubbleKeyDown, this);
        this.addListener("mousedown", this._onMousedown);
        if (DNA.engine.Client.isIE()) {
            this.addListener("propertychange", this._onProxyChange)
        } else {
            if (DNA.engine.Client.isFF()) {
                this.addListener("input", this._onProxyChange)
            }
        }
        this.addListener("keydown", this._onKeyDown);
        this.addListener("dragover", this._doDragOver);
        this.addListener("resize", this._doResize);
        a.addListener(DNA.JWTEvent.PREDISPOSE, this._doBeforeDispose, this);
        a.addListener(DNA.JWTEvent.POSTVISIBLE, this._doAfterParentVisible, this);
        this.addListener("focus", this._onFocus);
        this.addListener("blur", this._onBlur);
        a.addListener(DNA.JWTEvent.PRE_DISABLED, this._onDisable, this);
        a.addListener(DNA.JWTEvent.POST_ENABLED, this._onEnable, this)
    },
    _onDisable: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            this._disableGrid(a)
        }
    }),
    _onEnable: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            this._enableGrid(a)
        }
    }),
    _disableGrid: function(b) {
        try {
            if (b.isAncestorOf(this)) {
                if (this.tDiv) {
                    this.tDiv.scrollTop = 0;
                    this.tDiv.scrollLeft = 0;
                    this._handleScroll()
                }
                this._removeScrollbar()
            }
        } catch (a) {}
    },
    _enableGrid: function(b) {
        try {
            if (b.isAncestorOf(this)) {
                this._restoreScrollbar()
            }
        } catch (a) {}
    },
    _onFocus: new DNA.engine.Action({
        handle: function(a) {
            try {
                this._focusDom()
            } catch (a) {}
            this.updateCurrentCellColor()
        }
    }),
    _onBlur: new DNA.engine.Action({
        handle: function(a) {
            try {
                this._blurInputProxy()
            } catch (a) {}
            this.updateCurrentCellColor()
        }
    }),
    _onProxyChange: new DNA.engine.Action({
        handle: function(g) {
            if (!this.checkRendered(true)) {
                return
            }
            if (!this.currentCell) {
                return
            }
            if (DNA.engine.Client.isIE()) {
                var c = g.getOriginalEvent().propertyName;
                if (c != "value") {
                    return
                }
            }
            var h = this.inputProxy.value;
            if (!h || h == "") {
                return
            }
            if (this.activeEditor) {
                return
            }
            var b = this.currentCell.getColIndex();
            var l = this.currentCell.getRowIndex();
            if ((this.getEditMode() != DNA.widget.JWTGrid.EDIT_MODE_READONLY) && this.util.isCellEditable(b, l)) {
                var a = this.getCell(b, l);
                var d = new DNA.widget.AbstractGridCell(this,null ,b,l,false);
                this.openEditor(d, null , false, DNA.widget.JWTGrid.EDITOPEN_INPUT, h)
            } else {
                this.inputProxy.value = "";
                this.inputProxy.blur()
            }
        }
    }),
    _onGlobalMouseup: new DNA.engine.AppSuspendedAction({
        handle: function(h) {
            if (this.replacing) {
                return
            }
            if (!this.checkRendered(true)) {
                return
            }
            if (!this.isEnabled()) {
                return
            }
            var n = DNA.engine.DomUtil.getSize(this.tDiv);
            if (n.x == 0 || n.y == 0) {
                return
            }
            var m = h.getSrcElement();
            var b = h.getSrcControl();
            if (!this.isDraging()) {
                if (this.mousedownonSelf) {
                    if (b == this) {
                        this.fireEvent("gridClick", [h])
                    }
                    this.mousedownonSelf = false
                }
                return
            }
            var d = h.getXY();
            var g = this._getPageBounds();
            var c = this.getBounds();
            var l = {
                x: d.x - g.x,
                y: d.y - g.y
            };
            h.setSrcControl(this);
            h.setLocation(l);
            var a = this.getCellByCoordinate(l.x, l.y);
            if (!a && !this.isDraging()) {
                this.gridState = DNA.widget.JWTGrid.STATE_OUT;
                return
            }
            this.mouseCell = a;
            switch (this.gridState) {
            case DNA.widget.JWTGrid.STATE_ROW_SELECT:
                this.rowSelectEnd(h);
                break;
            case DNA.widget.JWTGrid.STATE_COL_SELECT:
                this.colSelectEnd(h);
                break;
            case DNA.widget.JWTGrid.STATE_ALL_SELECT:
                this.allSelectEnd(h);
                break;
            case DNA.widget.JWTGrid.STATE_CELL_SELECT:
                this.mouseCellSelectEnd(h);
                break;
            case DNA.widget.JWTGrid.STATE_ROW_RESIZE:
                this.rowResizeEnd(h);
                break;
            case DNA.widget.JWTGrid.STATE_COL_RESIZE:
                this.colResizeEnd(h);
                break
            }
            if (this.gridState != DNA.widget.JWTGrid.STATE_ROW_RESIZE && this.gridState != DNA.widget.JWTGrid.STATE_COL_RESIZE) {
                if (this.mousedownonSelf && b == this) {
                    this.fireEvent("gridClick", [h])
                }
            }
            this.mousedownonSelf = false;
            this.gridState = DNA.widget.JWTGrid.STATE_NORMAL
        }
    }),
    isDraging: function() {
        return !(this.gridState != DNA.widget.JWTGrid.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid.STATE_ROW_RESIZE && this.gridState != DNA.widget.JWTGrid.STATE_CELL_SELECT && this.gridState != DNA.widget.JWTGrid.STATE_ROW_SELECT && this.gridState != DNA.widget.JWTGrid.STATE_COL_SELECT && this.gridState != DNA.widget.JWTGrid2.STATE_ALL_SELECT)
    },
    _findEventCtrol: function(b) {
        var c = b;
        while (c && c.nodeType == 1) {
            if (c.id) {
                var a = DNA.widget.WidgetRegistry.get(c.id);
                if (a instanceof DNA.widget.Control) {
                    return a
                }
            }
            c = c.parentNode
        }
        return null 
    },
    onBubbleKeyDown: new DNA.engine.PreventableAction({
        handle: function(a) {
            if (!a.isCtrl() && !a.isAlt() && a.getKeyCode() == DNA.JWTEvent.ENTER) {
                this.keyEnterDown(a);
                a.preventDefault()
            }
        }
    }),
    _onGlobalMousemove: new DNA.engine.Action({
        handle: function(h) {
            if (this.replacing) {
                return
            }
            if (!this.checkRendered(true)) {
                return
            }
            if (!this.isEnabled()) {
                return
            }
            var m = h.getSrcElement();
            var a = this._findEventCtrol(m);
            if (a != this && this.gridState != DNA.widget.JWTGrid.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid.STATE_ROW_RESIZE) {
                if (this.cellOut) {
                    if (this.cellOut.x != -1) {
                        this.fireEvent("cellout", [this, {
                            x: this.cellOut.x,
                            y: this.cellOut.y
                        }])
                    }
                }
                this.cellOut = null ;
                return
            }
            if (h.getButton() != 0 && !this.selectFinish && DNA.engine.Client.isIE() && !(DNA.engine.Client.isIE() && DNA.engine.Client.getBrowserVersion() > 9)) {
                this.gridState = DNA.widget.JWTGrid.STATE_NORMAL;
                this.mouseCellSelectEnd(h);
                return
            }
            var n = DNA.engine.DomUtil.getSize(this.tDiv);
            if (n.x == 0 || n.y == 0) {
                return
            }
            if (m == this.tDiv && this.gridState != DNA.widget.JWTGrid.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid.STATE_ROW_RESIZE) {
                return
            }
            var d = h.getXY();
            var g = this._getPageBounds();
            var c = this.getBounds();
            var l = {
                x: d.x - g.x,
                y: d.y - g.y
            };
            h.setSrcControl(this);
            h.setLocation(l);
            var b = this.getCellByCoordinate(l.x, l.y);
            if (!b && this.gridState != DNA.widget.JWTGrid.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid.STATE_ROW_RESIZE) {
                this.gridState = DNA.widget.JWTGrid.STATE_OUT;
                return
            }
            this.mouseCell = b;
            if (b) {
                if (this.cellOut) {
                    if (this.cellOut.x != -1) {
                        if (!(b.x == this.cellOut.x && b.y == this.cellOut.y)) {
                            this.fireEvent("cellout", [this, {
                                x: this.cellOut.x,
                                y: this.cellOut.y
                            }]);
                            this.fireEvent("cellin", [this, {
                                x: this.mouseCell.x,
                                y: this.mouseCell.y,
                                width: l.x,
                                height: l.y
                            }])
                        }
                    }
                } else {
                    this.fireEvent("cellin", [this, {
                        x: this.mouseCell.x,
                        y: this.mouseCell.y,
                        width: l.x,
                        height: l.y
                    }])
                }
            }
            this.cellOut = this.mouseCell;
            switch (this.gridState) {
            case DNA.widget.JWTGrid.STATE_ROW_SELECT:
                this.rowSelecting(h);
                break;
            case DNA.widget.JWTGrid.STATE_COL_SELECT:
                this.colSelecting(h);
                break;
            case DNA.widget.JWTGrid.STATE_CELL_SELECT:
                this.mouseCellSelecting(h);
                this._autoScroll(h);
                break;
            case DNA.widget.JWTGrid.STATE_ROW_RESIZE:
                this.rowResizing(h);
                break;
            case DNA.widget.JWTGrid.STATE_COL_RESIZE:
                this.colResizing(h);
                break;
            default:
                this.updateCursor(h);
                break
            }
        }
    }),
    _onDblclick: new DNA.engine.Action({
        handle: function(g) {
            if (!this.checkRendered(true)) {
                return
            }
            var b = g.getSrcElement();
            this.resizeRowIdx = 0;
            this.resizeColIdx = 0;
            if (this.getEditMode() === DNA.widget.JWTGrid.EDIT_MODE_READONLY) {
                return
            }
            if (b == this.tDiv) {
                return
            }
            var c = g.getLocation();
            var a = this.getCellByCoordinate(c.x, c.y);
            if (!a) {
                return
            }
            if (this.util.isCellSelectable(a.x, a.y)) {
                this.setCurrentCell(a, null , null , null , g.getButton());
                if (!this._stopDbClick) {
                    if (this.currentCell && this.util.isCellEditable(this.currentCell.getColIndex(), this.currentCell.getRowIndex())) {
                        var d = new DNA.widget.AbstractGridCell(this,null ,a.x,a.y,false);
                        this.openEditor(d, g, true, DNA.widget.JWTGrid.EDITOPEN_DBCLICK)
                    }
                }
            }
        }
    }),
    _doBeforeDispose: new DNA.engine.Action({
        handle: function(h) {
            if (h.isAncestorOf(this)) {
                var g = DNA.engine.application.getJWTEventMgr();
                g.deleteSelfEvent(this, "scroll", this.tDiv);
                g.deleteSelfEvent(this, "propertychange", this.inputProxy);
                if (DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) {
                    var b = this.util.getDocumentOfElement(this.tDiv);
                    var l = b.getElementsByTagName("head")[0];
                    for (var d = 0, c = l.childNodes.length; d < c; d++) {
                        var a = l.childNodes[d].getAttribute("gsid");
                        if (a && a == this._eid) {
                            l.removeChild(l.childNodes[d]);
                            if (b.ownerIframe) {
                                b.ownerIframe.style.zoom = "1"
                            }
                            return
                        }
                    }
                }
            }
        }
    }),
    _doResize: new DNA.engine.Action({
        handle: function(b) {
            if (!this._isResizeable()) {
                return
            }
            if (this.el && this.tDiv) {
                if (this.el.tagName == "IFRAME") {
                    var a = DNA.engine.DomUtil.getClientSize(this.el);
                    DNA.engine.DomUtil.setSize(this.tDiv, a)
                }
                this._ajustLockedSections();
                this._adjustScroll()
            }
            this._placeLockSections4FF();
            this._handleScroll()
        }
    }),
    _doDragOver: new DNA.engine.Action({
        handle: function(c) {
            if (!this.checkRendered(true)) {
                return
            }
            if (!this.el) {
                return
            }
            var b = c.getXY();
            var a = DNA.engine.DomUtil.getPageXY(this.el);
            a = {
                x: b.x - a.x,
                y: b.y - a.y
            };
            a = this.getCellByCoordinate(a.x, a.y);
            if (a) {
                this.posInfo = a.x + "," + a.y
            } else {
                this.posInfo = "-1,-1"
            }
        }
    }),
    _onMouseOut: function(a) {
        if (!this.checkRendered(true)) {
            return
        }
    },
    _onScroll: new DNA.engine.Action({
        handle: function(a) {
            if (!this.checkRendered(true)) {
                return
            }
            var b = a.getSrcElement();
            if (b != this.tDiv) {
                return
            }
            this._handleScroll();
            this.fireEvent("currentCellOffsetChanged", [this]);
            this.fireEvent("scrolled", [this])
        }
    }),
    _handleScroll: function() {
        var a = this.tDiv.scrollLeft + "px";
        var b = this.tDiv.scrollTop + "px";
        if (this.hrDiv) {
            this.hrDiv.scrollLeft = this.tDiv.scrollLeft;
            if (!(DNA.engine.Client.isIE() && (!document.documentMode || document.documentMode < 9))) {
                this.hrDiv.style.left = a;
                this.hrDiv.style.top = b
            }
        }
        if (this.hcDiv) {
            this.hcDiv.scrollTop = this.tDiv.scrollTop;
            if (!(DNA.engine.Client.isIE() && (!document.documentMode || document.documentMode < 9))) {
                this.hcDiv.style.left = a;
                this.hcDiv.style.top = b
            }
        }
        if (this.hltDiv && !(DNA.engine.Client.isIE() && (!document.documentMode || document.documentMode < 9))) {
            this.hltDiv.style.left = a;
            this.hltDiv.style.top = b
        }
    },
    _onMousedown: new DNA.engine.Action({
        handle: function(d) {
            if (!this.checkRendered(true)) {
                return
            }
            this.needHandleGlobal = true;
            var n = d.getSrcElement();
            this.mousedownonSelf = true;
            if (d.getButton() == 2) {
                var l = d.getLocation();
                var m = this.getCellByCoordinate(l.x, l.y);
                if (!m) {
                    return
                }
                if (this._cellSelected(m)) {
                    return
                } else {
                    if (this.util.isCellSelectable(m.x, m.y)) {
                        this._clearSelection(true);
                        this.setCurrentCell(m, null , null , null , d.getButton())
                    }
                }
                return
            }
            if (d.getButton() != 0) {
                return
            }
            if (this.getSelectionMode() == DNA.widget.JWTGrid.SELECTION_MODE_ROW) {
                var l = d.getLocation();
                var m = this.getCellByCoordinate(l.x, l.y);
                if (!m) {
                    return
                }
                if (this._cellSelected(m)) {
                    if (this.util.isCellSelectable(m.x, m.y)) {
                        this.setCurrentCell(m, null , null , null , d.getButton())
                    }
                    var a = this.mouseCell;
                    if ((!d.isCtrl() && !d.isShift()) || (d.isCtrl() && d.isShift())) {
                        var h;
                        this.setCurrentCell(a, null , null , null , d.getButton());
                        var g = {
                            x: 1,
                            y: a.y,
                            width: this.columnCount - 1,
                            height: a.y
                        };
                        for (var c = this.selectionAreas.length - 1; c >= 0; c--) {
                            if (this.util.rectEqual(this.selectionAreas[c], g)) {
                                h = this.selectionAreas[c];
                                this.selectionAreas.removeAt(c)
                            }
                        }
                        if (!h) {
                            h = new DNA.widget.GridSelectionArea(this,g,true,null ,false)
                        }
                        this._setSelection(h);
                        this.setCurrentSelection(h)
                    }
                    return
                }
            }
            if (n == this.tDiv) {
                return
            }
            this.updateGridState(d);
            switch (this.gridState) {
            case DNA.widget.JWTGrid.STATE_CELL_OPENEDITOR:
                if (this.currentCell) {
                    var b = new DNA.widget.AbstractGridCell(this,null ,this.currentCell.getColIndex(),this.currentCell.getRowIndex(),false);
                    this.openEditor(b, d, true, DNA.widget.JWTGrid.EDITOPEN_CLICKFACE)
                }
                break;
            case DNA.widget.JWTGrid.STATE_ROW_SELECT:
                this.rowSelectStart(d);
                break;
            case DNA.widget.JWTGrid.STATE_ALL_SELECT:
                this.allSelectStart(d);
                break;
            case DNA.widget.JWTGrid.STATE_COL_SELECT:
                this.colSelectStart(d);
                break;
            case DNA.widget.JWTGrid.STATE_CELL_SELECT:
                this.mouseCellSelectStart(d);
                break
            }
            d._preventDefault()
        }
    }),
    _cellSelected: function(b) {
        for (var c = 0, a = this.selectionAreas.length; c < a; ++c) {
            var d = this.selectionAreas[c];
            if (b.x >= d.x && b.x <= d.width && b.y >= d.y && b.y <= d.height) {
                return true
            }
        }
        return false
    },
    updateGridState: function(c) {
        if (this.columnCount <= 1 || this.rowCount <= 1) {
            this.gridState = DNA.widget.JWTGrid.STATE_OUT;
            return
        }
        var a = c.getLocation();
        if (this.resizeRowIdx) {
            this.gridState = DNA.widget.JWTGrid.STATE_ROW_RESIZE;
            var d = null ;
            if (this.resizeRowIdx >= this.hRowCount) {
                d = this._getCellDom(-1, this.resizeRowIdx, this.hcTable)
            } else {
                d = this._getCellDom(-1, this.resizeRowIdx, this.hrTable)
            }
            this.resizeRowPoint = {
                x: 0,
                y: d.offsetTop
            };
            return
        }
        if (this.resizeColIdx) {
            this.gridState = DNA.widget.JWTGrid.STATE_COL_RESIZE;
            var d = null ;
            if (this.resizeColIdx >= this.hColCount) {
                d = this._getCellDom(this.resizeColIdx, -1, this.hrTable);
                this.resizeColPoint = {
                    x: d.offsetLeft,
                    y: 0
                }
            } else {
                d = this._getCellDom(this.resizeColIdx, -1, this.hcTable);
                this.resizeColPoint = {
                    x: d.offsetLeft + this.tDiv.scrollLeft,
                    y: 0
                }
            }
            return
        }
        var b = this.getCellByCoordinate(a.x, a.y);
        if (!b) {
            this.gridState = DNA.widget.JWTGrid.STATE_OUT;
            return
        }
        this.mouseCell = b;
        this.lastMouseCell = b;
        if (b.x === 0 && b.y === 0) {
            if (this.getSelectionMode() == DNA.widget.JWTGrid.SELECTION_MODE_MULTI) {
                this.gridState = DNA.widget.JWTGrid.STATE_ALL_SELECT
            }
            return
        }
        if (b.x === 0 && b.y > 0) {
            if (this.getRowSelectEnabled() && this.getSelectionMode() == DNA.widget.JWTGrid.SELECTION_MODE_MULTI) {
                this.gridState = DNA.widget.JWTGrid.STATE_ROW_SELECT
            }
            return
        }
        if (b.y === 0 && b.x > 0) {
            if (this.getColSelectEnabled() && this.getSelectionMode() == DNA.widget.JWTGrid.SELECTION_MODE_MULTI) {
                this.gridState = DNA.widget.JWTGrid.STATE_COL_SELECT
            }
            return
        }
        if (b.x > 0 && b.y > 0) {
            if (!this.util.isCellSelectable(b.x, b.y)) {
                this.gridState = DNA.widget.JWTGrid.STATE_NORMAL;
                return
            }
            if (this._clickFaceArea(b, a.x, a.y)) {
                this.gridState = DNA.widget.JWTGrid.STATE_CELL_OPENEDITOR;
                return
            }
            this.gridState = DNA.widget.JWTGrid.STATE_CELL_SELECT
        }
    },
    _clickFaceArea: function(g, c, l) {
        if (!this.curFace) {
            return false
        }
        if (this.currentCell) {
            if ((this.currentCell.getRowIndex() <= g.y && this.currentCell.getColIndex() <= g.x && this.currentCell.getRowIndex() + this.currentCell.td.rowSpan - 1 >= g.y && this.currentCell.getColIndex() + this.currentCell.td.colSpan - 1 >= g.x) ) {
                if (c > this.hcDiv.offsetWidth && this.tDiv.scrollLeft) {
                    c += this.tDiv.scrollLeft
                }
                if (l > this.hrDiv.offsetHeight && this.tDiv.scrollTop) {
                    l += this.tDiv.scrollTop
                }
                var b = this.currentCell.td.offsetLeft;
                var h = this.currentCell.td.offsetTop;
                var d = this.currentCell.td.offsetWidth;
                var a = this.currentCell.td.offsetHeight;
                if (c >= b + d - 18 && c <= b + d && l >= h && l <= h + a) {
                    return true
                }
                return false
            }
        }
        return false
    },
    _onMouseup: function(d) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = d.getSrcElement();
        a.style.cursor = "default";
        var b = d.getLocation();
        var c = this.getCellByCoordinate(b.x, b.y);
        if (!c && this.gridState != DNA.widget.JWTGrid.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid.STATE_ROW_RESIZE) {
            this.gridState = DNA.widget.JWTGrid.STATE_OUT;
            return
        }
        this.mouseCell = c;
        switch (this.gridState) {
        case DNA.widget.JWTGrid.STATE_ROW_SELECT:
            this.rowSelectEnd(d);
            break;
        case DNA.widget.JWTGrid.STATE_COL_SELECT:
            this.colSelectEnd(d);
            break;
        case DNA.widget.JWTGrid.STATE_CELL_SELECT:
            this.mouseCellSelectEnd(d);
            break;
        case DNA.widget.JWTGrid.STATE_ROW_RESIZE:
            this.rowResizeEnd(d);
            break;
        case DNA.widget.JWTGrid.STATE_COL_RESIZE:
            this.colResizeEnd(d);
            break
        }
        this.gridState = DNA.widget.JWTGrid.STATE_NORMAL
    },
    rowSelectEnd: function(a) {
        if (this.currentSelection) {
            this.currentSelection.reBuild(true);
            this._internalDrawTitle(this.currentSelection, false, true);
            this.fireEvent("selection", [this])
        }
    },
    colSelectEnd: function(a) {
        if (this.currentSelection) {
            this.currentSelection.reBuild(true);
            this.fireEvent("selection", [this])
        }
    },
    allSelectEnd: function(a) {
        if (this.currentSelection) {
            this.currentSelection.reBuild(true);
            this.fireEvent("selection", [this])
        }
    },
    rowResizeEnd: function(b) {
        if (this.resizeRowIdx && this.newSize != -1) {
            var a = b.getSrcElement();
            a.style.cursor = "default";
            this.tDiv.style.cursor = "default";
            this.setRowHeight(this.resizeRowIdx, this.newSize);
            this.resizeDiv.style.display = "none";
            this.resizeDiv.style.height = "0px";
            this.fireEvent("rowresize", [this, this.resizeRowIdx]);
            this.resizeRowIdx = 0;
            this.resizeColIdx = 0;
            this.newSize = -1;
            this._reBoundCurCell();
            return
        }
    },
    colResizeEnd: function(b) {
        if (this.resizeColIdx && this.newSize != -1) {
            var a = b.getSrcElement();
            a.style.cursor = "default";
            this.tDiv.style.cursor = "default";
            this.setColumnWidth(this.resizeColIdx, this.newSize);
            this.resizeDiv.style.display = "none";
            this.resizeDiv.style.width = "0px";
            this.fireEvent("columnresize", [this, this.resizeColIdx]);
            this.resizeColIdx = 0;
            this.resizeRowIdx = 0;
            this.newSize = -1;
            this._reBoundCurCell();
            return
        }
    },
    _onMousemove: function(c) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = c.getLocation();
        var b = this.getCellByCoordinate(a.x, a.y);
        if (!b && this.gridState != DNA.widget.JWTGrid.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid.STATE_ROW_RESIZE) {
            this.gridState = DNA.widget.JWTGrid.STATE_OUT;
            return
        }
        this.mouseCell = b;
        switch (this.gridState) {
        case DNA.widget.JWTGrid.STATE_ROW_SELECT:
            this.rowSelecting(c);
            break;
        case DNA.widget.JWTGrid.STATE_COL_SELECT:
            this.colSelecting(c);
            break;
        case DNA.widget.JWTGrid.STATE_CELL_SELECT:
            this.mouseCellSelecting(c);
            break;
        case DNA.widget.JWTGrid.STATE_ROW_RESIZE:
            this.rowResizing(c);
            break;
        case DNA.widget.JWTGrid.STATE_COL_RESIZE:
            this.colResizing(c);
            break
        }
    },
    _onGridMousemove: function(c) {
        var a = c.getLocation();
        var b = this.getCellByCoordinate(a.x, a.y);
        if (!b && this.gridState != DNA.widget.JWTGrid.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid.STATE_ROW_RESIZE) {
            this.gridState = DNA.widget.JWTGrid.STATE_OUT;
            return
        }
        this.mouseCell = b;
        if (this.gridState == DNA.widget.JWTGrid.STATE_NORMAL) {
            this.updateCursor(c)
        }
    },
    rowSelecting: function(c) {
        if (this.lastMouseCell.y != this.mouseCell.y) {
            this.lastMouseCell = this.mouseCell;
            if (this.currentSelection) {
                var d = Math.min(this.currentRow, this.mouseCell.y);
                var b = Math.max(this.currentRow, this.mouseCell.y);
                var a = {
                    x: 1,
                    y: d,
                    width: this.columnCount - 1,
                    height: b
                };
                this.currentSelection._setBound(a);
                this.currentSelection.redraw()
            }
        }
    },
    colSelecting: function(d) {
        if (this.lastMouseCell.x != this.mouseCell.x) {
            this.lastMouseCell = this.mouseCell;
            if (this.currentSelection) {
                var b = Math.min(this.currentCol, this.mouseCell.x);
                var a = Math.max(this.currentCol, this.mouseCell.x);
                var c = {
                    x: b,
                    y: 1,
                    width: a,
                    height: this.rowCount - 1
                };
                this.currentSelection._setBound(c);
                this.currentSelection.redraw()
            }
        }
    },
    rowResizing: function(b) {
        if (this.resizeRowIdx) {
            var a = b.getSrcElement();
            a.style.cursor = "row-resize";
            this._placeResizeDiv(b.getLocation().y)
        }
    },
    colResizing: function(b) {
        if (this.resizeColIdx) {
            var a = b.getSrcElement();
            a.style.cursor = "col-resize";
            this._placeResizeDiv(b.getLocation().x)
        }
    },
    updateCursor: function(h) {
        var b = this.mouseCell;
        var n = h.getSrcElement();
        var m = h.getLocation();
        this.resizeRowIdx = 0;
        var d = this._getCellDom(-1, b.y, this.contentTable);
        var q = d.offsetTop;
        var o = d.offsetHeight;
        if ((m.y + this.tDiv.scrollTop >= q + o - this.resizeCursorBound && m.y + this.tDiv.scrollTop <= q + o) || (m.y + this.tDiv.scrollTop >= q && m.y + this.tDiv.scrollTop <= q + this.resizeCursorBound)) {
            if ((b.x == 0 || this.getRowFreeResizeEnabled()) && b.y > 0 && this.getRowResizeEnable()) {
                if (b.y > this.hRowCount && this.tDiv.scrollTop) {
                    m.y += this.tDiv.scrollTop
                }
                if (b.y == 1) {
                    if (m.y >= q + o - this.resizeCursorBound && m.y <= q + o) {
                        this.resizeRowIdx = 1;
                        n.style.cursor = "row-resize"
                    } else {
                        this.resizeRowIdx = 0;
                        n.style.cursor = "default"
                    }
                } else {
                    if (m.y >= q + o - this.resizeCursorBound && m.y <= q + o) {
                        var g = new DNA.widget.AbstractGridCell(this,this.contentTable,b.x,b.y);
                        if (!(g.getRowSpan() > 1 && b.y < g.getRowIndex() + g.getRowSpan())) {
                            this.resizeRowIdx = this.util.getUpRow(b.y + 1);
                            n.style.cursor = "row-resize"
                        }
                    } else {
                        if (m.y >= q && m.y <= q + this.resizeCursorBound) {
                            var g = new DNA.widget.AbstractGridCell(this,this.contentTable,b.x,b.y);
                            if (g.getRowIndex() == b.y) {
                                this.resizeRowIdx = this.util.getUpRow(b.y);
                                n.style.cursor = "row-resize"
                            }
                        } else {
                            this.resizeRowIdx = 0;
                            n.style.cursor = "default"
                        }
                    }
                }
                return
            }
        }
        d = this._getCellDom(b.x, -1, this.contentTable);
        var c = d.offsetLeft;
        var a = d.offsetWidth;
        var l = 0;
        if (m.x > this.hcDiv.offsetWidth) {
            l = this.tDiv.scrollLeft
        }
        if ((m.x + l >= c + a - this.resizeCursorBound && m.x + l <= c + a) || (m.x + l >= c && m.x + l <= c + this.resizeCursorBound)) {
            if ((b.y == 0 || this.getColFreeResizeEnabled()) && b.x > 0 && this.getColResizeEnable()) {
                if (b.x > this.hColCount && this.tDiv.scrollLeft) {
                    m.x += this.tDiv.scrollLeft
                }
                if (b.x == 1) {
                    if (m.x >= c + a - this.resizeCursorBound && m.x <= c + a) {
                        this.resizeColIdx = 1;
                        n.style.cursor = "col-resize"
                    } else {
                        this.resizeColIdx = 0;
                        n.style.cursor = "default"
                    }
                } else {
                    if (m.x >= c + a - this.resizeCursorBound && m.x <= c + a) {
                        var g = new DNA.widget.AbstractGridCell(this,this.contentTable,b.x,b.y);
                        if (!(g.getColSpan() > 1 && b.x < g.getColIndex() + g.getColSpan())) {
                            this.resizeColIdx = this.util.getLeftCol(b.x + 1);
                            n.style.cursor = "col-resize"
                        }
                    } else {
                        if (m.x >= c && m.x <= c + this.resizeCursorBound) {
                            var g = new DNA.widget.AbstractGridCell(this,this.contentTable,b.x,b.y);
                            if (g.getColIndex() == b.x) {
                                this.resizeColIdx = this.util.getLeftCol(b.x);
                                n.style.cursor = "col-resize"
                            }
                        } else {
                            this.resizeColIdx = 0;
                            n.style.cursor = "default"
                        }
                    }
                }
                return
            }
        }
        this.resizeColIdx = 0;
        this.resizeRowIdx = 0;
        n.style.cursor = "default"
    },
    _onKeyDown: new DNA.engine.Action({
        handle: function(a) {
            if (!this.checkRendered(true)) {
                return
            }
            if (this.currentCol === -1 || this.currentRow === -1) {
                return
            }
            switch (a.getKeyCode()) {
            case DNA.JWTEvent.LEFT:
            case DNA.JWTEvent.RIGHT:
            case DNA.JWTEvent.UP:
            case DNA.JWTEvent.DOWN:
            case DNA.JWTEvent.HOME:
            case DNA.JWTEvent.END:
                this.keydownNavigation(a);
                a._preventDefault();
                break;
            case DNA.JWTEvent.ENTER:
                this.keyEnterDown(a);
                a._preventDefault();
                break;
            case DNA.JWTEvent.DELETE:
                if (this.getEditMode() != DNA.widget.JWTGrid.EDIT_MODE_READONLY) {
                    this.deleteText(DNA.widget.JWTGrid.DATACHANGE_DEL)
                }
                a._preventDefault();
                break;
            case 86:
                if (a.isCtrl()) {
                    if (this.getEditMode() != DNA.widget.JWTGrid.EDIT_MODE_READONLY) {
                        this.pasteText()
                    }
                    a._preventDefault()
                }
                break;
            case 67:
                if (a.isCtrl()) {
                    var b = this.copyText();
                    if (b) {
                        DNA.adapter.ClipboardUtil.copyToClipboard(b)
                    }
                    a._preventDefault()
                }
                break;
            case 88:
                if (a.isCtrl()) {
                    if (this.getEditMode() != DNA.widget.JWTGrid.EDIT_MODE_READONLY) {
                        var b = this.cutText();
                        if (b) {
                            DNA.adapter.ClipboardUtil.copyToClipboard(b)
                        }
                    }
                    a._preventDefault()
                }
                break;
            case 77:
                break;
            case 85:
                break;
            case DNA.JWTEvent.F2:
                this.openCurrentEditor();
                break
            }
        }
    }),
    _onKeyPress: function(b) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = b.getKeyCode();
        if ((a >= 48 && a <= 57) || (a >= 65 && a <= 90) || (a >= 97 && a <= 122)) {
            if (this.currentCell) {
                this.openEditor(this.currentCell, b, false, DNA.widget.JWTGrid.EDITOPEN_INPUT)
            }
        }
    },
    _deleteData: function(a) {},
    _pasteData: function(a) {},
    _copyData: function(a) {},
    _cutData: function(a) {},
    deleteText: function(g) {
        var b = this.selectionAreas.length;
        for (var c = 0; c < b; ++c) {
            this._deleteText(this.selectionAreas[c], g)
        }
        var h = this.getCurrentCell();
        if (h) {
            var a = this.getCell(h.x, h.y);
            if (a.getShowText()) {
                var d = {
                    x: h.x,
                    y: h.y,
                    width: h.x,
                    height: h.y
                };
                this._deleteText(d, g)
            }
        }
    },
    _deleteText: function(g, h) {
        var b = false;
        for (var d = g.y; d <= g.height; ++d) {
            if (this.ignoreHidden && this.getRowHidden(d)) {
                continue
            }
            for (var c = g.x; c <= g.width; ++c) {
                if (this.ignoreHidden && this.getColHidden(c)) {
                    continue
                }
                if (this.util.isCellEditable(c, d)) {
                    var a = this.getCell(c, d);
                    a.setShowText("", true);
                    a.setEditText("", true);
                    b = true
                }
            }
        }
        if (b) {
            this.fireDataChangeEvent(g, h)
        }
    },
    pasteText: function() {
        var b = this.getCurrentCell();
        if (b) {
            var a = {
                x: b.x,
                y: b.y,
                width: 1,
                height: 1
            };
            this._pasteText(a)
        }
    },
    _trimEnd: function(b) {
        if (!b || b.length == 0) {
            return b
        }
        var a = b.length;
        for (var c = a - 1; c >= 0; --c) {
            if (!b[c]) {
                --a
            }
            break
        }
        b.length = a;
        return b
    },
    _pasteText: function(a) {
        var b = this;
        DNA.adapter.ClipboardUtil.getClipboard(function(l) {
            var u = a.x + "," + a.y;
            var B = {
                doit: true
            };
            b.fireEvent("paste", [b, l, u, B]);
            if (!B.doit) {
                return
            }
            var c;
            if (DNA.engine.Client.isFF()) {
                c = l.split("\n")
            } else {
                c = l.split("\r\n")
            }
            c = b._trimEnd(c);
            var n = c.length;
            if (n > 0) {
                var v = Math.min(b.rowCount - 1, a.y + n - 1);
                var s = 0;
                for (var A = 0; A < n; A++) {
                    var h = c[A].split("\t");
                    s = Math.max(s, h.length)
                }
                var g;
                if (s > 0) {
                    g = Math.min(b.columnCount - 1, a.x + s - 1)
                }
                var z = false;
                var m = a.y - 1;
                var t = a.x - 1;
                for (var A = a.y; A <= v; ++A) {
                    var p = c[A - a.y].split("\t");
                    t = a.x - 1;
                    m = b.util.getDownRow(m);
                    for (var w = a.x; w <= g; ++w) {
                        var d = null ;
                        if (!b.ignoreHidden) {
                            d = b.getCell(w, A)
                        } else {
                            t = b.util.getRightCol(t);
                            if (b.util.isDataCell(t, m)) {
                                d = b.getCell(t, m)
                            }
                        }
                        if (d && b.util.isCellEditable(d.getColIndex(), d.getRowIndex())) {
                            var q = p[w - a.x];
                            if (!q) {
                                q = ""
                            }
                            if (q.indexOf("image://") == 0) {
                                d.setShowText("image://", true);
                                d.setEditText(q.substr(8), true)
                            } else {
                                d.setEditText(q, true);
                                var o = b.getFormattedText(d);
                                if (o) {
                                    d.setShowText(o, true)
                                } else {
                                    d.setShowText(q, true)
                                }
                            }
                            z = true
                        }
                    }
                }
                if (z) {
                    var r = {
                        x: a.x,
                        y: a.y,
                        width: g,
                        height: v
                    };
                    b.fireDataChangeEvent(r, DNA.widget.JWTGrid.DATACHANGE_PASTE)
                }
            }
        })
    },
    copyText: function() {
        var a = this.getCurrentSelection();
        var b = null ;
        if (a) {
            b = a
        } else {
            var d = this.getCurrentCell();
            if (d) {
                b = {
                    x: d.x,
                    y: d.y,
                    width: d.x,
                    height: d.y
                }
            }
        }
        if (b) {
            var c = {
                doit: true
            };
            this.fireEvent("copy", [this, {
                x: b.x,
                y: b.y,
                width: b.width,
                height: b.height
            }, c]);
            if (!c.doit) {
                return null 
            }
            return this._copyText(b)
        }
        return null 
    },
    cutText: function() {
        var a = this.getCurrentSelection();
        if (a) {
            var b = this._cutText(a);
            if (b) {
                this.fireDataChangeEvent(a, DNA.widget.JWTGrid.DATACHANGE_CUT);
                return b
            }
        }
        return null 
    },
    _copyText: function(a) {
        return this._getText(a, false)
    },
    _cutText: function(a) {
        return this._getText(a, true)
    },
    _getText: function(h, d) {
        var n = "";
        var a = /\r\n/g;
        for (var c = h.y; c <= h.height; ++c) {
            if (this.ignoreHidden && this.getRowHidden(c)) {
                continue
            }
            for (var b = h.x; b <= h.width; ++b) {
                if (this.ignoreHidden && this.getColHidden(b)) {
                    continue
                }
                var m = this.getCell(b, c);
                var g = m.getShowText();
                if (!g) {
                    g = ""
                }
                g = g.replace(a, "\n");
                n += g;
                if ("image://" == g) {
                    var l = m.getEditText();
                    if (l) {
                        n += l
                    }
                }
                if (b != h.width) {
                    n += "\t"
                }
                if (d && m.getEditable()) {
                    m.setShowText("", true);
                    m.setEditText("", true)
                }
            }
            if (c != h.height) {
                n += "\r\n"
            }
        }
        return n
    },
    toString: function() {
        return "Grid"
    },
    _placeResizeDiv: function(c) {
        if (!this.checkRendered(true)) {
            return
        }
        if (this.resizeRowIdx) {
            if (this.tDiv.scrollTop && this.resizeRowIdx >= this.hRowCount) {
                c += this.tDiv.scrollTop
            }
            this.resizeDiv.style.display = "block";
            this.resizeDiv.style.left = this.resizeRowPoint.x + "px";
            this.resizeDiv.style.top = this.resizeRowPoint.y + "px";
            this.resizeDiv.style.width = this.contentTable.offsetWidth + "px";
            var a = c - this.resizeRowPoint.y;
            if (a <= this.minRowHeight) {
                a = this.minRowHeight
            }
            this.newSize = a;
            this.resizeDiv.style.height = a + "px";
            return
        }
        if (this.resizeColIdx) {
            c += this.tDiv.scrollLeft;
            this.resizeDiv.style.display = "block";
            this.resizeDiv.style.left = this.resizeColPoint.x + "px";
            this.resizeDiv.style.top = this.resizeColPoint.y + "px";
            this.resizeDiv.style.height = this.contentTable.offsetHeight + "px";
            var b = c - this.resizeColPoint.x;
            if (b <= this.minColWidth) {
                b = this.minColWidth
            }
            this.newSize = b;
            this.resizeDiv.style.width = b + "px";
            return
        }
    },
    _getRowDom: function(a, b) {
        if (!this.checkRendered(true)) {
            return
        }
        var d = null ;
        try {
            d = b.rows[a + 1]
        } catch (c) {
            alert("�����ڵ�" + a + "��")
        }
        if (!d) {
            throw "�����ڵ�" + a + "��"
        }
        return d
    },
    _getRowCell: function(d, b, g) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = null ;
        try {
            a = d.cells[b + 1]
        } catch (c) {
            alert("���������Ϊ(" + b + "," + g + ")�ĵ�Ԫ��")
        }
        if (!a) {
            throw "���������Ϊ(" + b + "," + g + ")�ĵ�Ԫ��"
        }
        return a
    },
    _getCellDom: function(b, g, c) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = null ;
        try {
            a = c.rows[g + 1].cells[b + 1]
        } catch (d) {
            alert("���������Ϊ(" + b + "," + g + ")�ĵ�Ԫ��")
        }
        if (!a) {
            throw "���������Ϊ(" + b + "," + g + ")�ĵ�Ԫ��"
        }
        return a
    },
    getCellByCoordinate: function(c, b) {
        if (!this.checkRendered(true)) {
            return
        }
        if (c < 0 || b,
        0) {
            return null 
        }
        var d = this.getBounds();
        if (c > d.width || b > d.height) {
            return null 
        }
        if (c > this.hcDiv.offsetWidth && this.tDiv.scrollLeft) {
            c += this.tDiv.scrollLeft
        }
        if (b > this.hrDiv.offsetHeight && this.tDiv.scrollTop) {
            b += this.tDiv.scrollTop
        }
        var o = {
            x: -1,
            y: -1
        };
        var m = 0;
        var g = this.rowCount;
        var n;
        while (m <= g) {
            n = this._getMidDisplayRow(m, g);
            if (n == -1) {
                o.y = -1;
                break
            }
            var l = this.contentTable.rows[n];
            var q = l.offsetTop;
            var a = l.offsetHeight;
            if (b > q + a) {
                m = n + 1
            } else {
                if (b < q) {
                    g = n - 1
                } else {
                    o.y = n - 1;
                    break
                }
            }
        }
        m = 0;
        g = this.columnCount;
        var l = this.contentTable.rows[0];
        while (m <= g) {
            n = Math.floor((m + g) / 2);
            var p = l.cells[n];
            var r = p.offsetLeft;
            var h = p.offsetWidth;
            if (c > r + h) {
                m = n + 1
            } else {
                if (c < r) {
                    g = n - 1
                } else {
                    o.x = n - 1;
                    break
                }
            }
        }
        if (o.x == -1 || o.y == -1) {
            return null 
        }
        return o
    },
    _getMidDisplayRow: function(d, b) {
        var c = Math.floor((d + b) / 2);
        var g = this.contentTable.rows[c];
        var a = g;
        while (a.style.display == "none" && d < c) {
            c--;
            a = this.contentTable.rows[c]
        }
        if (this.contentTable.rows[c].style.display != "none") {
            return c
        }
        c = Math.floor((d + b) / 2);
        a = g;
        while (a.style.display == "none" && c < b) {
            c++;
            a = this.contentTable.rows[c]
        }
        if (this.contentTable.rows[c].style.display != "none") {
            return c
        }
        return -1
    },
    getCellByPoint: function(l, h) {
        if (!this.checkRendered(true)) {
            return
        }
        var n = {
            x: -1,
            y: -1
        };
        var g = 1;
        var b = this.rowCount;
        var m;
        while (g <= b) {
            m = Math.floor((g + b) / 2);
            var d = this.contentTable.rows[m];
            var p = d.offsetTop;
            var a = d.offsetHeight;
            if (h > p + a) {
                g = m + 1
            } else {
                if (h < p) {
                    b = m - 1
                } else {
                    n.y = m - 1;
                    break
                }
            }
        }
        g = 1;
        b = this.columnCount;
        var d = this.contentTable.rows[0];
        while (g <= b) {
            m = Math.floor((g + b) / 2);
            var o = d.cells[m];
            var q = o.offsetLeft;
            var c = o.offsetWidth;
            if (l > q + c) {
                g = m + 1
            } else {
                if (l < q) {
                    b = m - 1
                } else {
                    n.x = m - 1;
                    break
                }
            }
        }
        if (n.x == -1 || n.y == -1) {
            return null 
        }
        return n
    },
    getCell: function(a, b) {
        if (!this.checkRendered(true)) {
            return
        }
        if (a < 0 || a >= this.columnCount || b < 0 || b >= this.rowCount) {
            return null 
        }
        if (this.operateCell && (a == this.operateCell.getColIndex()) && (b == this.operateCell.getRowIndex())) {
            return this.operateCell
        } else {
            this.operateCell = new DNA.widget.GridCell(this,a,b);
            return this.operateCell
        }
    },
    getGridArea: function(a) {
        if (a.x == this.operateArea.left && a.y == this.operateArea.top && a.width == this.operateArea.right && a.height == this.operateArea.bottom) {
            return this.operateArea
        }
        return new DNA.widget.GridArea(this,a)
    },
    _canMerge: function(m, l, h, b) {
        if (!this.checkRendered(true)) {
            return false
        }
        if (m <= 0 || m > h || h >= this.columnCount) {
            return false
        }
        if (l <= 0 || l > b || b >= this.rowCount) {
            return false
        }
        if (m == h && l == b) {
            return false
        }
        if (m < this.hColCount && h >= this.hColCount) {
            return false
        }
        if (l < this.hRowCount && b >= this.hRowCount) {
            return false
        }
        var d, a;
        for (var g = l; g <= b; ++g) {
            d = this._getCellDom(m, g, this.contentTable);
            a = this._getCellDom(h, g, this.contentTable);
            if (d.isSpan || a.isSpan) {
                return false
            }
        }
        for (var c = m; c <= h; ++c) {
            d = this._getCellDom(c, l, this.contentTable);
            a = this._getCellDom(c, b, this.contentTable);
            if (d.isSpan || a.isSpan) {
                return false
            }
        }
        return true
    },
    merge: function(b, h, l, a) {
        if (!this._canMerge(b, h, l, a)) {
            return false
        }
        this.clearSelection();
        var d = l - b + 1;
        var g = a - h + 1;
        var m = new DNA.widget.AbstractGridCell(this,this.contentTable,b,h,true);
        m.merge(d, g);
        if (b < this.hColCount) {
            m = new DNA.widget.AbstractGridCell(this,this.hcTable,b,h,true);
            m.merge(d, g)
        }
        if (h < this.hRowCount) {
            m = new DNA.widget.AbstractGridCell(this,this.hrTable,b,h,true);
            m.merge(d, g)
        }
        if (b < this.hColCount && h < this.hRowCount) {
            m = new DNA.widget.AbstractGridCell(this,this.hltTab,b,h,true);
            m.merge(d, g)
        }
        this._reBoundCurCell();
        this._reBoundFace();
        var n = true;
        for (var c = 0; c < this.mergeRectCache.length; c++) {
            if (this.mergeRectCache[c].x == b && this.mergeRectCache[c].y == h) {
                n = false
            }
        }
        if (n) {
            this.mergeRectCache.push({
                x: b,
                y: h,
                width: l,
                height: a
            })
        }
        if (!(DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) && m.td.getAttribute("wl")) {
            m.td.firstChild.style.height = (this.util.getWrapTextHeight(b, h) > (m.td.offsetHeight - 1)) ? ((m.td.offsetHeight - 1) + "px") : ""
        }
        return true
    },
    unmerge: function(c, h) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = this._getCellDom(c, h, this.contentTable);
        var b = a.rowSpan ? a.rowSpan : 1;
        var g = a.colSpan ? a.colSpan : 1;
        if (b <= 1 && g <= 1) {
            return
        }
        if (this.util.getStyle(a, "display") == "none") {
            return
        }
        this.clearSelection();
        this._internalUnmergeCell(this.contentTable, c, h);
        if (c < this.hColCount) {
            this._internalUnmergeCell(this.hcTable, c, h)
        }
        if (h < this.hRowCount) {
            this._internalUnmergeCell(this.hrTable, c, h)
        }
        if (c < this.hColCount && h < this.hRowCount) {
            this._internalUnmergeCell(this.hltTab, c, h)
        }
        this._reBoundCurCell();
        this._reBoundFace();
        for (var d = 0; d < this.mergeRectCache.length; d++) {
            if (this.mergeRectCache[d].x == c && this.mergeRectCache[d].y == h) {
                this.mergeRectCache.remove(this.mergeRectCache[d]);
                break
            }
        }
    },
    _internalUnmergeCell: function(s, p, o) {
        var q = this._getCellDom(p, o, s);
        if (this.hiddenRows.contains(o) || this.hiddenCols.contains(p)) {
            this.util.convertCSSFromClass2Style(q);
            q.className = "mgridCell";
            var h = DNA.engine.DomUtil.getInnerText(q);
            if (h) {
                q.setAttribute("st", h);
                DNA.engine.DomUtil.setInnerText(q, "")
            }
        }
        if (q.rrs) {
            delete q.rrs
        }
        var n = q.rowSpan ? q.rowSpan : 1;
        var g = q.colSpan ? q.colSpan : 1;
        var l = Math.min(this.getRowCount(), o + n);
        var r = Math.min(this.getColumnCount(), p + g);
        q.rowSpan = 1;
        q.colSpan = 1;
        for (var d = o; d < l; ++d) {
            var m = this._getRowDom(d, s);
            for (var c = p; c < r; ++c) {
                if (d == o && c == p) {
                    continue
                }
                var b = this._getRowCell(m, c, d);
                this.util.convertCellCSSFromClass2Style(this, c, d);
                b.style.display = "";
                b.rowSpan = 1;
                b.colSpan = 1
            }
        }
        if (!(DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) && q.getAttribute("wl")) {
            var a = parseInt(this.util.getStyle(this._getCellDom(-1, o, s), "height")) - 1;
            q.firstChild.style.height = (this.util.getWrapTextHeight(p, o) > a) ? (a + "px") : ""
        }
    },
    _adjustScroll: function() {
        var g = DNA.engine.DomUtil.getClientSize(this.tDiv);
        var d = this.tDiv.scrollLeft ? this.tDiv.scrollLeft : 0;
        var b = this.tDiv.scrollTop ? this.tDiv.scrollTop : 0;
        var h = DNA.engine.DomUtil.getSize(this.contentTable);
        if (h.width > g.width && g.width + d > h.width) {
            var c = h.width - g.width;
            this.tDiv.scrollLeft = c;
            if (this.hrDiv) {
                this.hrDiv.scrollLeft = this.tDiv.scrollLeft
            }
        }
        if (h.height > g.height && g.height + b > h.height) {
            var a = h.height - g.height;
            this.tDiv.scrollTop = a;
            if (this.hcDiv) {
                this.hcDiv.scrollTop = this.tDiv.scrollTop
            }
        }
    },
    adjustRowHeight: function(c) {
        if (!this.checkRendered(true)) {
            return
        }
        if (!this.util.isDataRow(c)) {
            return
        }
        var b = this._getCellDom(-1, c, this.contentTable);
        if (b.getAttribute("hf")) {
            return
        }
        var a = b.offsetHeight;
        this._getCellDom(-1, c, this.hcTable).style.height = a + "px";
        if (c < this.hRowCount) {
            this._getCellDom(-1, c, this.hltTab).style.height = a + "px";
            this._getCellDom(-1, c, this.hrTable).style.height = a + "px"
        }
        this._ajustLockedSections();
        this._reBoundCurCell();
        this._reComputeSelections(c, -1);
        this._reBoundFace()
    },
    setRowHeight: function(d, a) {
        if (!this.checkRendered(true)) {
            return
        }
        if (!this.util.isDataRow(d)) {
            return
        }
        if (a < this.minRowHeight) {
            return
        }
        var b = this._getCellDom(-1, d, this.contentTable);
        if (b.getAttribute("hf")) {
            return
        }
        var c = parseInt(this.util.getStyle(b, "height"));
        b.style.height = a + "px";
        if (DNA.engine.Client.isIE() && b.offsetHeight != a) {
            b.style.display = "none";
            b.style.display = "block"
        }
        this._getCellDom(-1, d, this.hcTable).style.height = a + "px";
        this._resizeWrapLineDiv(d, [this.contentTable, this.hcTable], a, c);
        if (d < this.hRowCount) {
            this._getCellDom(-1, d, this.hltTab).style.height = a + "px";
            this._getCellDom(-1, d, this.hrTable).style.height = a + "px";
            this._resizeWrapLineDiv(d, [this.hltTab, this.hrTable], a, c)
        }
        this._resizeWraplineDivHeightInMergeCells();
        this._ajustLockedSections();
        this._reBoundCurCell();
        this._reComputeSelections(d, -1);
        this._adjustScroll();
        this._reBoundFace()
    },
    _resizeWrapLineDiv: function(n, a, m, l) {
        if (!(DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict()))) {
            for (var d = 0; d < a.length; d++) {
                var b = a[d];
                if (b.rows && b.rows.length > 0 && b.rows[0].cells && b.rows[0].cells.length > 0) {
                    var h = b.rows[0].cells.length;
                    for (var c = 1; c < h; c++) {
                        var g = this._getCellDom(c - 1, n, b);
                        if (g.getAttribute("wl")) {
                            g.firstChild.style.height = (this.util.getWrapTextHeight(c - 1, n) > (m - 1)) ? ((m - 1) + "px") : ""
                        }
                    }
                }
            }
        }
    },
    _resizeWrapLineDivAfterWidthChange: function(g, l) {
        if (!(DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict()))) {
            for (var d = 0; d < l.length; d++) {
                var h = l[d];
                if (h.rows && h.rows.length > 0) {
                    var c = h.rows.length;
                    for (var m = 1; m < c; m++) {
                        var b = this._getCellDom(g, m - 1, h);
                        if (b.getAttribute("wl")) {
                            var a = parseInt(this.util.getStyle(this._getCellDom(-1, m - 1, h), "height")) - 1;
                            b.firstChild.style.height = (this.util.getWrapTextHeight(g, m - 1) > a) ? (a + "px") : ""
                        }
                    }
                }
            }
        }
    },
    getRowHeight: function(a) {
        if (!this.checkRendered(true)) {
            return 0
        }
        if (a < 0 || a >= this.rowCount) {
            return 0
        }
        return this._getCellDom(-1, a, this.contentTable).offsetHeight
    },
    getRowHeightFromStyle: function(c) {
        if (!this.checkRendered(true)) {
            return 0
        }
        if (c < 0 || c >= this.rowCount) {
            return 0
        }
        var a = 0;
        var b = this._getCellDom(-1, c, this.contentTable);
        if (b) {
            a = parseInt(b.style.height, 10)
        }
        return a
    },
    setColumnWidth: function(a, d) {
        if (!this.checkRendered(true)) {
            return
        }
        if (!this.util.isDataCol(a)) {
            return
        }
        if (d < this.minColWidth) {
            return
        }
        if (a <= 0 || a >= this.columnCount) {
            return
        }
        var c = this._getCellDom(a, -1, this.contentTable);
        if (c.getAttribute("hf")) {
            return
        }
        c.style.width = d + "px";
        if ((DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) && c.offsetWidth != d) {
            c.style.display = "none";
            c.style.display = "block"
        }
        var b = this._getCellDom(a, -1, this.hrTable);
        b.style.width = d + "px";
        if ((DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) && b.offsetWidth != d) {
            b.style.display = "none";
            b.style.display = "block"
        }
        this._resizeWrapLineDivAfterWidthChange(a, [this.contentTable, this.hrTable]);
        if (a < this.hColCount) {
            var b = this._getCellDom(a, -1, this.hltTab);
            b.style.width = d + "px";
            if ((DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) && b.offsetWidth != d) {
                b.style.display = "none";
                b.style.display = "block"
            }
            b = this._getCellDom(a, -1, this.hcTable);
            b.style.width = d + "px";
            if ((DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) && b.offsetWidth != d) {
                b.style.display = "none";
                b.style.display = "block"
            }
            this._resizeWrapLineDivAfterWidthChange(a, [this.hltTab, this.hcTable])
        }
        this._ajustLockedSections();
        this._reBoundCurCell();
        this._reComputeSelections(-1, a);
        this._adjustScroll();
        this._reBoundFace();
        this._resizeWraplineDivHeightInMergeCells()
    },
    getColumnWidth: function(a) {
        if (!this.checkRendered(true)) {
            return 0
        }
        if (a < 0 || a >= this.columnCount) {
            return 0
        }
        return this._getCellDom(a, -1, this.contentTable).offsetWidth
    },
    getColumnWidthFromStyle: function(b) {
        if (!this.checkRendered(true)) {
            return 0
        }
        if (b < 0 || b >= this.columnCount) {
            return 0
        }
        var a = 0;
        var c = this._getCellDom(b, -1, this.contentTable);
        if (c) {
            a = parseInt(c.style.width, 10)
        }
        return a
    },
    insertRows: function(a, b) {
        if (!this.checkRendered(true)) {
            return
        }
        a -= 1;
        if (a < -1 || a >= this.rowCount) {
            return
        }
        var c = this.getCurrentCell();
        if (c && c.y > a) {
            this.setCurrentCellNoFire(null , null , null , null , null , DNA.widget.JWTGrid.SETCURRENTCELLCAUSE_PROGRAM)
        }
        this.operateCell = null ;
        this.operateArea = null ;
        this.closeEditor();
        this.clearSelection();
        if (!this._insertRows(this.contentTable, a, b, a)) {
            return
        }
        this._insertRows(this.hcTable, a, b, a);
        this._changeRowTitle(this.hcTable, a);
        if (this.hRowCount != 0 && a < this.hRowCount) {
            this._insertRows(this.hrTable, a, b, a);
            this._insertRows(this.hltTab, a, b, a);
            this._changeRowTitle(this.hltTab, a);
            this.hRowCount += b
        }
        this._ajustLockedSections();
        if (c && c.y > a) {
            c.y += b;
            this.setCurrentCellNoFire(c, null , null , null , null , DNA.widget.JWTGrid.SETCURRENTCELLCAUSE_PROGRAM)
        }
        this.rowCount += b;
        this._fixIEShowProblem(a);
        this._resizeWraplineDivHeightInMergeCells()
    },
    _changeRowTitle: function(g, c) {
        var a = g.rows.length - 1;
        var h = c > 0 ? c : 0;
        for (var d = h; d < a; ++d) {
            var l = this._getCellDom(0, d, g);
            var b = l.getAttribute("st");
            if (b) {
                DNA.engine.DomUtil.setInnerText(l, b)
            } else {
                DNA.engine.DomUtil.setInnerText(l, d + "")
            }
        }
    },
    _insertRows: function(z, m, n, w) {
        var c;
        var r = z.rows[0].cells.length - 1;
        var t = new Array(r + 1);
        var b = this._getRowDom(m, z);
        var B = null ;
        if (m != w) {
            B = this._getRowDom(w, z)
        }
        var p = z.rows.length - 1;
        if (m == -1) {
            var A = z.ownerDocument.createDocumentFragment();
            var h = z.rows[w + 1].cloneNode(false);
            var d = z.rows[0];
            for (var v = 0; v <= r; v++) {
                c = d.cells[v].cloneNode(false);
                if (v == 0) {
                    c.style.height = this.defRowHeight + "px"
                }
                this.util.convertCSSFromClass2Style(c);
                if (v == 1) {
                    c.className = "titleCell"
                } else {
                    c.className = "gridCell"
                }
                c.removeAttribute("st");
                DNA.engine.DomUtil.setInnerText(c, " ");
                h.appendChild(c)
            }
            for (var v = 0; v < n; ++v) {
                A.appendChild(h.cloneNode(true))
            }
            var o = d.parentNode;
            if (m == (p - 1)) {
                o.appendChild(A)
            } else {
                var a = z.rows[m + 2];
                o.insertBefore(A, a)
            }
            return true
        }
        t[0] = this._getCellDom(-1, w, z).cloneNode(false);
        t[0].removeAttribute("hf");
        for (var v = 0; v < r; v++) {
            c = new DNA.widget.AbstractGridCell(this,z,v,m,false);
            var q = c.getRowIndex();
            var l = c.getRowSpan();
            var s = q + l - 1;
            if (s > m && v == c.getColIndex()) {
                c.td.rowSpan += n;
                if (c.td.rrs) {
                    c.td.rrs += n
                }
                if (m == w) {
                    if (q == m) {
                        t[v + 1] = c.td.cloneNode(false);
                        t[v + 1].style.display = "none";
                        t[v + 1].rowSpan = 1;
                        t[v + 1].colSpan = 1
                    } else {
                        t[v + 1] = this._getRowCell(b, v, m).cloneNode(false)
                    }
                } else {
                    t[v + 1] = this._getRowCell(B, v, w).cloneNode(false);
                    t[v + 1].style.display = "none";
                    t[v + 1].rowSpan = 1;
                    t[v + 1].removeAttribute("colSpan")
                }
                if (c.td.colSpan) {
                    var g = v + c.td.colSpan - 1;
                    for (var u = v + 1; u <= g; ++u) {
                        if (m == w) {
                            t[u + 1] = this._getRowCell(b, u, m).cloneNode(false)
                        } else {
                            t[u + 1] = this._getRowCell(B, u, w).cloneNode(false);
                            t[u + 1].style.display = "none";
                            t[u + 1].rowSpan = 1;
                            t[u + 1].colSpan = 1
                        }
                    }
                    v = g
                }
                continue
            }
            if (m == w) {
                t[v + 1] = this._getRowCell(b, v, m).cloneNode(false);
                this.util.convertCSSFromClass2Style(t[v + 1], this.util.getDocumentOfElement(this.tDiv));
                t[v + 1].style.display = "";
                t[v + 1].rowSpan = 1;
                t[v + 1].colSpan = 1;
                continue
            }
            t[v + 1] = this._getRowCell(B, v, w).cloneNode(false);
            this.util.convertCSSFromClass2Style(t[v + 1], this.util.getDocumentOfElement(this.tDiv));
            t[v + 1].style.display = "";
            t[v + 1].rowSpan = 1;
            t[v + 1].colSpan = 1
        }
        A = z.ownerDocument.createDocumentFragment();
        var h = this._getRowDom(w, z).cloneNode(false);
        h.style.display = "";
        var d = this._getRowDom(m, z);
        for (var v = 0; v <= r; ++v) {
            if (v > 1) {
                t[v].className = t[v].className.replace("titleCell", "gridCell")
            }
            t[v].removeAttribute("st");
            t[v].removeAttribute("et");
            t[v].removeAttribute("rrs");
            t[v].removeAttribute("wl");
            t[v].innerText = " ";
            h.appendChild(t[v])
        }
        for (var v = 0; v < n; v++) {
            A.appendChild(h.cloneNode(true))
        }
        var o = d.parentNode;
        if (m == (p - 1)) {
            o.appendChild(A)
        } else {
            var a = this._getRowDom(m + 1, z);
            o.insertBefore(A, a)
        }
        return true
    },
    deleteRows: function(b, d) {
        if (!this.checkRendered(true)) {
            return
        }
        if (b >= this.rowCount) {
            return
        }
        var a = b + d - 1;
        var g = this.getCurrentCell();
        if (g && g.y >= b) {
            this.setCurrentCell(null , null , null , null , null , DNA.widget.JWTGrid.SETCURRENTCELLCAUSE_PROGRAM)
        }
        if (!this._deleteRows(this.contentTable, b, a)) {
            return
        }
        this.clearSelection();
        this.operateCell = null ;
        this.operateArea = null ;
        this._deleteRows(this.hcTable, b, a);
        this._changeRowTitle(this.hcTable, b);
        if (b < this.hRowCount) {
            this._deleteRows(this.hrTable, b, a);
            this._deleteRows(this.hltTab, b, a);
            this._changeRowTitle(this.hcTable, b);
            var c = (a >= this.hRowCount) ? (this.hRowCount - b) : d;
            this.hRowCount -= c
        }
        this._ajustLockedSections();
        this.rowCount -= d;
        if (g && g.y > a) {
            g.y -= d;
            this.setCurrentCell(g, null , null , null , null , DNA.widget.JWTGrid.SETCURRENTCELLCAUSE_PROGRAM)
        }
        this._adjustScroll();
        if (this.rowCount > b) {
            this._fixIEDeleteProblem(b)
        }
        this._resizeWraplineDivHeightInMergeCells()
    },
    _deleteRows: function(z, d, c) {
        var b = new Array();
        var o = c - d + 1;
        var n, l;
        var g = z.rows.length - 1;
        if (c >= g) {
            c = g - 1
        }
        var m = z.rows[0].cells.length - 1;
        for (var q = 0; q < m; q++) {
            n = new DNA.widget.AbstractGridCell(this,z,q,d,false);
            l = new DNA.widget.AbstractGridCell(this,z,q,c,false);
            var t = n.getRowIndex();
            var w = n.getRowSpan();
            var v = n.getColIndex();
            var r = l.getRowIndex();
            var u = l.getRowSpan();
            var s = l.getColIndex();
            if (w > 1) {
                if (t == r && v == s && v == q) {
                    if (t < d) {
                        if (n.td.rrs) {
                            n.td.rrs -= o
                        } else {
                            n.td.rowSpan -= o
                        }
                    } else {
                        if (t + w > c + 1) {
                            var h = this._getCellDom(q, c + 1, z);
                            h.rowSpan = w - o;
                            if (n.td.colSpan) {
                                h.colSpan = n.td.colSpan
                            }
                            this.util.convertCSSFromClass2Style(h);
                            h.style.display = ""
                        }
                    }
                    q += (n.getColSpan() - 1);
                    continue
                } else {
                    if (t < d && v == q) {
                        b.push(new DNA.widget.Point(v,t))
                    }
                }
            }
            if (u > 1) {
                if (r <= c && s == q && r + u > c + 1) {
                    var h = this._getCellDom(q, c + 1, z);
                    this.util.convertCSSFromClass2Style(h);
                    h.style.display = "";
                    h.rowSpan = (u - c + r - 1);
                    if (l.td.colSpan) {
                        h.colSpan = l.td.colSpan
                    }
                }
            }
        }
        for (var q = 0; q < b.length; q++) {
            var p = b[q];
            var a = this._getCellDom(p.x, p.y, z);
            a.rowSpan = d - p.y
        }
        for (var q = c; q >= d; --q) {
            z.deleteRow(q + 1)
        }
        return true
    },
    insertColumns: function(a, b) {
        if (!this.checkRendered(true)) {
            return
        }
        a -= 1;
        if (a < -1 || a >= this.columnCount) {
            return
        }
        var c = this.getCurrentCell();
        if (c && c.x > a) {
            this.setCurrentCellNoFire(null , null , null , null , null , DNA.widget.JWTGrid.SETCURRENTCELLCAUSE_PROGRAM)
        }
        this.operateCell = null ;
        this.operateArea = null ;
        this.closeEditor();
        this.clearSelection();
        if (!this._insertCols(this.contentTable, a, b, a)) {
            return
        }
        this._insertCols(this.hrTable, a, b, a);
        this._changeColTitle(this.hrTable, a);
        if (this.hColCount != 0 && a < this.hColCount) {
            this._insertCols(this.hcTable, a, b, a);
            this._insertCols(this.hltTab, a, b, a);
            this._changeColTitle(this.hltTab, a);
            this.hColCount += b
        }
        this._ajustLockedSections();
        if (c && c.x > a) {
            c.x += b;
            this.setCurrentCellNoFire(c, null , null , null , null , DNA.widget.JWTGrid.SETCURRENTCELLCAUSE_PROGRAM)
        }
        this.columnCount += b;
        if (a == 0) {
            this.setColumnWidth(1, this.defColWidth)
        }
    },
    _changeColTitle: function(g, b) {
        var h = g.rows[1];
        var d = h.cells.length - 1;
        b = b > 1 ? b : 1;
        for (var c = b; c < d; ++c) {
            var l = this._getRowCell(h, c, 0);
            var a = l.getAttribute("st");
            if (a) {
                DNA.engine.DomUtil.setInnerText(l, a)
            } else {
                DNA.engine.DomUtil.setInnerText(l, this._getDefHeaderColText(c - 1))
            }
        }
    },
    _getDefHeaderColText: function(b) {
        var c = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        if (b < 26) {
            return c.charAt(b)
        }
        var a = "";
        for (; b >= 1; b /= 26) {
            if (b < 26 && b >= 1) {
                a += c.charAt(b % 26 - 1)
            } else {
                a += c.charAt(b % 26)
            }
        }
        return this._reverse(a)
    },
    _reverse: function(a) {
        if (a) {
            return a.split("").reverse().join("")
        }
        return ""
    },
    _insertCols: function(w, h, l, v) {
        var p;
        var a;
        var n;
        var q;
        var o = w.rows.length - 1;
        var r = w.rows[0].cells.length - 1;
        if (h == -1) {
            var A = w.ownerDocument.createDocumentFragment();
            var g = w.rows[0];
            for (var t = 0; t < l; ++t) {
                a = g.cells[v + 1];
                a.style.width = this.defColWidth + "px";
                p = a.cloneNode(true);
                A.append(p);
                if (h == (r - 1)) {
                    g.appendChild(A)
                } else {
                    g.insertBefore(A, g.cells[h + 2])
                }
            }
            for (var u = 1; u <= o; u++) {
                g = w.rows[u];
                a = g.cells[v + 1].cloneNode(false);
                for (var t = 0; t < l; ++t) {
                    p = a.cloneNode(true);
                    this.util.convertCSSFromClass2Style(p);
                    if (t == 0) {
                        p.className = "titleCell"
                    } else {
                        p.className = "gridCell"
                    }
                    A.append(a.cloneNode(true));
                    if (h == (r - 1)) {
                        g.appendChild(A)
                    } else {
                        g.insertBefore(A, g.cells[h + 2])
                    }
                }
            }
            this.contentTable.rows[0].cells[1].width = parseInt(this.rowTitleTab.rows[0].firstChild.width) + "px";
            return true
        }
        var z = w.ownerDocument.createDocumentFragment();
        var d = w.rows[0];
        p = d.cells[v + 1].cloneNode(false);
        for (var t = 0; t < l; t++) {
            z.appendChild(p.cloneNode(true))
        }
        if (h == (r - 1)) {
            d.appendChild(z)
        } else {
            d.insertBefore(z, d.cells[h + 1])
        }
        for (var u = 0; u < o; u++) {
            a = new DNA.widget.AbstractGridCell(this,w,h,u,false);
            n = a.getRowIndex();
            q = a.getColIndex();
            var m = a.getColSpan();
            var b = q + m - 1;
            if ((b > h) && (u == n)) {
                a.td.colSpan += l;
                var g = this._getRowDom(u, w);
                p = this._getRowCell(g, v, u).cloneNode(false);
                this.util.convertCSSFromClass2Style(p);
                p.style.display = "none";
                p.style.backgroundImage = "";
                p.rowSpan = 1;
                p.colSpan = 1;
                if (u > 0) {
                    p.className = "gridCell"
                }
                this._internalInsertCols(g, p, h, l, w);
                if (a.getRowSpan() > 1) {
                    var c = a.getRowSpan();
                    var s = u + c - 1;
                    for (var t = u + 1; t <= s; ++t) {
                        var g = this._getRowDom(t, w);
                        w.rows[t + 1];
                        p = this._getRowCell(g, v, t).cloneNode(false);
                        this.util.convertCSSFromClass2Style(p);
                        p.style.display = "none";
                        p.style.backgroundImage = "";
                        p.rowSpan = 1;
                        p.colSpan = 1;
                        if (u > 0) {
                            p.className = "gridCell"
                        }
                        this._internalInsertCols(g, p, h, l, w)
                    }
                    u = s
                }
            } else {
                var g = this._getRowDom(u, w);
                p = this._getRowCell(g, v, u).cloneNode(false);
                this.util.convertCSSFromClass2Style(p, this.util.getDocumentOfElement(g));
                p.style.display = "";
                p.style.backgroundImage = "";
                p.rowSpan = 1;
                p.colSpan = 1;
                if (u > 0) {
                    p.className = "gridCell"
                }
                this._internalInsertCols(g, p, h, l, w)
            }
        }
        return true
    },
    _internalInsertCols: function(m, l, b, h, g) {
        var d = g.rows[0].cells.length - 1 - h;
        var c = g.ownerDocument.createDocumentFragment();
        l.innerText = " ";
        l.removeAttribute("st");
        l.removeAttribute("et");
        for (var a = 0; a < h; a++) {
            c.appendChild(l.cloneNode(true))
        }
        if (b == (d - 1)) {
            m.appendChild(c)
        } else {
            m.insertBefore(c, m.cells[b + 2])
        }
    },
    deleteColumns: function(b, d) {
        if (!this.checkRendered(true)) {
            return
        }
        if (b >= this.columnCount) {
            return
        }
        var a = b + d - 1;
        var g = this.getCurrentCell();
        if (g && g.x >= b) {
            this.setCurrentCell(null , null , null , null , null , DNA.widget.JWTGrid.SETCURRENTCELLCAUSE_PROGRAM)
        }
        if (!this._deleteCols(this.contentTable, b, a)) {
            return
        }
        this.operateCell = null ;
        this.operateArea = null ;
        this.clearSelection();
        this._deleteCols(this.hrTable, b, a);
        this._changeColTitle(this.hrTable, b);
        if (b < this.hColCount) {
            this._deleteCols(this.hcTable, b, a);
            this._deleteCols(this.hltTab, b, a);
            this._changeColTitle(this.hltTab, b);
            var c = (a >= this.hColCount) ? (this.hColCount - b) : d;
            this.hColCount -= c
        }
        this._ajustLockedSections();
        if (g && g.x > a) {
            g.x -= d;
            this.setCurrentCell(g, null , null , null , null , DNA.widget.JWTGrid.SETCURRENTCELLCAUSE_PROGRAM)
        }
        this.columnCount -= d;
        this._adjustScroll()
    },
    _deleteCols: function(C, g, d) {
        var p, n;
        var h = C.rows.length - 1;
        var o = C.rows[0].cells.length - 1;
        if (d >= o) {
            d = o - 1
        }
        var c = new Array();
        for (var t = 0; t < h; ++t) {
            p = new DNA.widget.AbstractGridCell(this,C,g,t,false);
            n = new DNA.widget.AbstractGridCell(this,C,d,t,false);
            var w = p.getRowIndex();
            var B = p.getRowSpan();
            var A = p.getColIndex();
            var E = p.getColSpan();
            var u = n.getRowIndex();
            var z = n.getRowSpan();
            var v = n.getColIndex();
            var D = n.getColSpan();
            if (E > 1) {
                if (w == u && A == v && w == t) {
                    var l = d - g + 1;
                    if (A < g) {
                        p.td.colSpan = (E - l)
                    } else {
                        var q = A + E;
                        if (q > d + 1) {
                            var m = this._getCellDom(d + 1, t, C);
                            m.rowSpan = B;
                            this.util.convertCSSFromClass2Style(m);
                            m.style.display = "";
                            m.colSpan = q - d - 1
                        }
                    }
                    t += (B - 1);
                    continue
                } else {
                    if (A < g && w == t) {
                        c.push(new DNA.widget.Point(A,w))
                    }
                }
            }
            if ((D > 1) && (u == t)) {
                var q = v + D;
                if (q > d + 1) {
                    var m = this._getCellDom(d + 1, t, C);
                    m.rowSpan = z;
                    this.util.convertCSSFromClass2Style(m);
                    m.style.display = "";
                    m.colSpan = q - d - 1
                }
            }
        }
        for (var t = 0; t < c.length; t++) {
            var r = c[t];
            var b = this._getCellDom(r.x, r.y, C);
            b.colSpan = g - r.x
        }
        for (var t = 0; t <= h; ++t) {
            var a = this._getRowDom(t - 1, C);
            for (var s = d; s >= g; --s) {
                if (DNA.engine.Client.isIE()) {
                    var b = a.cells[s + 1];
                    a.removeChild(b)
                } else {
                    a.deleteCell(s + 1)
                }
            }
        }
        return true
    },
    _focus: function() {
        var a = this.tDiv;
        if (a) {
            DNA.engine.DomUtil.addClass(a, "focus")
        }
    },
    _blur: function() {
        var a = this.tDiv;
        if (a) {
            DNA.engine.DomUtil.removeClass(a, "focus")
        }
    },
    getRowVisible: function(c) {
        var b = this._getRowDom(c, this.contentTable);
        if (!b) {
            return false
        }
        var a = b.cells[0];
        if (a.getAttribute("hf")) {
            return false
        }
        return true
    },
    setRowVisible: function(b, a) {
        this.setRowHidden(b, !a)
    },
    setRowHidden: function(b, a) {
        if (!this.checkRendered(true)) {
            return
        }
        if (b < 0 || b >= this.rowCount) {
            return
        }
        this.clearSelection();
        if (a) {
            this._hideRow(b)
        } else {
            this._displayRow(b)
        }
        this._resizeWraplineDivHeightInMergeCells()
    },
    _fixIEHideProblem: function(a) {
        this._checkForHideRow2(a, this.contentTable, this.columnCount);
        this._checkForHideRow2(a, this.hcTable, this.hColCount);
        if (a < this.hRowCount) {
            this._checkForHideRow2(a, this.hrTable, this.columnCount);
            this._checkForHideRow2(a, this.hltTab, this.hColCount)
        }
    },
    _fixIEDeleteProblem: function(a) {
        this._checkForDeleteRow2(a, this.contentTable, this.columnCount);
        this._checkForDeleteRow2(a, this.hcTable, this.hColCount);
        if (a < this.hRowCount) {
            this._checkForDeleteRow2(a, this.hrTable, this.columnCount);
            this._checkForDeleteRow2(a, this.hltTab, this.hColCount)
        }
    },
    _fixIEShowProblem: function(a) {
        this._checkForShowRow2(a, this.contentTable, this.columnCount);
        this._checkForShowRow2(a, this.hcTable, this.hColCount);
        if (a < this.hRowCount) {
            this._checkForShowRow2(a, this.hrTable, this.columnCount);
            this._checkForShowRow2(a, this.hltTab, this.hColCount)
        }
    },
    _checkForHideRow2: function(c, m, l) {
        var b = m.rows.length - 1;
        for (var d = 1; d < l; ) {
            var a = this._getCellDom(d, c, m);
            if (a.rowSpan && this._getRowRealSpan(a.rowSpan, c) > 1) {
                var h = c + 1;
                if (h < b) {
                    var g = this._getCellDom(d, h, m);
                    this.util.convertCSSFromClass2Style(g);
                    g.style.display = "";
                    g.rowSpan = a.rowSpan - (h - c);
                    if (a.colSpan) {
                        g.colSpan = a.colSpan
                    }
                }
            }
            d += a.colSpan ? a.colSpan : 1
        }
    },
    _checkForDeleteRow2: function(b, g, d) {
        for (var c = 1; c < d; ) {
            var a = this._getCellDom(c, b, g);
            if (a.rowSpan && a.rowSpan > 1) {
                this.util.convertCSSFromClass2Style(a);
                a.style.display = ""
            }
            c += a.colSpan ? a.colSpan : 1
        }
    },
    _checkForShowRow2: function(c, m, l) {
        var b = m.rows.length - 1;
        for (var d = 1; d < l; ) {
            var a = this._getCellDom(d, c, m);
            if (a.rowSpan && a.rowSpan > 1) {
                for (var h = c + 1; c + a.rowSpan > h; h++) {
                    if (h < b) {
                        var g = this._getCellDom(d, h, m);
                        g.removeAttribute("rowSpan");
                        g.removeAttribute("colSpan");
                        g.style.display = "none";
                        g.setAttribute("mg", "1")
                    }
                }
            }
            d += a.colSpan ? a.colSpan : 1
        }
    },
    _checkForHideRow: function(c, l, h) {
        for (var d = 1; d < h; ) {
            var a = new DNA.widget.AbstractGridCell(this,l,d,c,false);
            var m = a.getRowIndex();
            if (m < c) {
                var g = a.getRowSpan();
                var b = this._getRowRealSpan(g, a.getRowIndex());
                if (b != a.td.rowSpan) {
                    if (!a.td.rrs) {
                        a.td.rrs = g
                    }
                    a.td.rowSpan = b
                }
            }
            d += a.getColSpan()
        }
    },
    _getRowRealSpan: function(c, d) {
        var a = c;
        for (var b = d + c - 1; b >= d; --b) {
            if (!this.getRowVisible(b)) {
                a--
            } else {
                break
            }
        }
        return a
    },
    _hideRow: function(h) {
        var g = this._getRowDom(h, this.contentTable);
        var a = g.cells[0];
        if (a.getAttribute("hf")) {
            return
        }
        a.setAttribute("hf", 1);
        if (DNA.engine.Client.isStrict()) {
            for (var b = 1; b < this.getColumnCount(); b++) {
                var d = this._getCellDom(b, h, this.contentTable);
                this.util.convertCSSFromClass2Style(d);
                if (d.style.display == "none") {
                    for (var c = h - 1; c > 0; c--) {
                        if (this._getCellDom(b, c, this.contentTable).rowSpan + c - 1 >= h) {
                            this.getCell(b, c).setRowSpan(Math.max(1, this._getCellDom(b, c, this.contentTable).rowSpan - 1));
                            break
                        }
                    }
                }
            }
        }
        g.style.display = "none";
        this._getRowDom(h, this.hcTable).style.display = "none";
        if (h == 0 || (this.hRowCount != 0 && h < this.hRowCount)) {
            this._getRowDom(h, this.hrTable).style.display = "none";
            this._getRowDom(h, this.hltTab).style.display = "none"
        }
        this._ajustLockedSections();
        this.hiddenRows.push(h);
        this._reBoundCurCell();
        this._adjustScroll();
        this._fixIEHideProblem(h)
    },
    __hideRow: function(c) {
        var b = this._getRowDom(c, this.contentTable);
        var a = b.cells[0];
        if (a.getAttribute("hf")) {
            return
        }
        this._hideRow4Tab(this.contentTable, c);
        this._hideRow4Tab(this.hcTable, c);
        if (c == 0 || (this.hRowCount != 0 && c < this.hRowCount)) {
            this._hideRow4Tab(this.hrTable, c);
            this._hideRow4Tab(this.hltTab, c)
        }
        this._ajustLockedSections();
        this.hiddenRows.push(c);
        this._reBoundCurCell();
        this._adjustScroll()
    },
    _hideRow4Tab: function(h, m) {
        var l = this._getRowDom(m, h);
        var a = l.cells[0];
        if (m === 0) {
            l.style.display = "none";
            a.setAttribute("hf", 1);
            return
        }
        var g = l.cells.length - 1;
        var b = h.rows.length - 1;
        a.setAttribute("hf", 1);
        a.setAttribute("rh", a.style.height);
        a.style.height = "0px";
        for (var c = 1; c <= g; ++c) {
            var a = this._getRowCell(l, c - 1, m);
            if (a.rowSpan && a.rowSpan > 1) {
                continue
            }
            a.setAttribute("rhc", 1);
            this.util.convertCSSFromClass2Style(a);
            if (c == 1) {
                a.className = "mtitleCell"
            } else {
                a.className = "mgridCell"
            }
            var d = DNA.engine.DomUtil.getInnerText(a);
            if (d) {
                a.setAttribute("st", d);
                DNA.engine.DomUtil.setInnerText(a, "")
            }
            if (DNA.engine.Client.isIE()) {
                if (a.style.writingMode = "tb-rl") {
                    this.util.convertCSSFromClass2Style(a);
                    a.style.writingMode = ""
                }
            }
        }
    },
    _displayRow: function(g) {
        var d = this._getRowDom(g, this.contentTable);
        var a = d.cells[0];
        if (!a.getAttribute("hf")) {
            return
        }
        a.removeAttribute("hf");
        if (DNA.engine.Client.isStrict()) {
            for (var b = 1; b < this.getColumnCount(); b++) {
                if (this.util.getStyle(this._getCellDom(b, g, this.contentTable), "display") == "none") {
                    for (var c = g - 1; c > 0; c--) {
                        if (this._getCellDom(b, c, this.contentTable).rowSpan + c - 1 >= g) {
                            this.getCell(b, c).setRowSpan(this._getCellDom(b, c, this.contentTable).rowSpan + 1);
                            break
                        }
                    }
                }
            }
        }
        d.style.display = "";
        this.util.convertCSSFromClass2Style(this._getRowDom(g, this.hcTable));
        this._getRowDom(g, this.hcTable).style.display = "";
        if (g == 0 || (this.hRowCount != 0 && g < this.hRowCount)) {
            this.util.convertCSSFromClass2Style(this._getRowDom(g, this.hrTable));
            this.util.convertCSSFromClass2Style(this._getRowDom(g, this.hltTab));
            this._getRowDom(g, this.hrTable).style.display = "";
            this._getRowDom(g, this.hltTab).style.display = ""
        }
        this._ajustLockedSections();
        this.hiddenRows.remove(g);
        this._reBoundCurCell();
        this._fixIEShowProblem(g)
    },
    __displayRow: function(c) {
        var b = this._getRowDom(c, this.contentTable);
        var a = b.cells[0];
        if (!a.getAttribute("hf")) {
            return
        }
        this._showRow4Tab(this.contentTable, c);
        this._showRow4Tab(this.hcTable, c);
        if (c == 0 || (this.hRowCount != 0 && c < this.hRowCount)) {
            this._showRow4Tab(this.hrTable, c);
            this._showRow4Tab(this.hltTab, c)
        }
        this._ajustLockedSections();
        this.hiddenRows.remove(c);
        this._reBoundCurCell()
    },
    _showRow4Tab: function(m, c) {
        var n = this._getRowDom(c, m);
        var h = n.cells[0];
        if (c === 0) {
            n.style.display = "";
            h.removeAttribute("hf");
            return
        }
        var g = n.cells.length - 1;
        var d = m.rows.length - 1;
        h.removeAttribute("hf");
        var l = h.getAttribute("rh");
        h.style.height = l;
        for (var a = 1; a <= g; ++a) {
            h = this._getRowCell(n, a - 1, c);
            h.removeAttribute("rhc");
            this.util.convertCSSFromClass2Style(h);
            if (a == 1) {
                h.className = "titleCell"
            } else {
                h.className = "gridCell"
            }
            var b = h.getAttribute("st");
            if (b) {
                h.removeAttribute("st");
                DNA.engine.DomUtil.setInnerText(h, b)
            }
        }
    },
    getColVisible: function(b) {
        var a = this._getCellDom(b, -1, this.contentTable);
        if (!a) {
            return false
        }
        if (a.getAttribute("hf")) {
            return false
        }
        return true
    },
    setColVisible: function(a, b) {
        this.setColumnHidden(a, !b)
    },
    setColumnHidden: function(b, a) {
        if (!this.checkRendered(true)) {
            return
        }
        if (b < 0 || b >= this.columnCount) {
            return
        }
        this.clearSelection();
        if (a) {
            this._hideColumn(b)
        } else {
            this._displayColumn(b)
        }
        this._resizeWraplineDivHeightInMergeCells()
    },
    _hideColumn: function(b) {
        var a = this._getCellDom(b, -1, this.contentTable);
        if (a.getAttribute("hf")) {
            return
        }
        this._hideCol4Tab(this.contentTable, b);
        this._hideCol4Tab(this.hrTable, b);
        if (b == 0 || (this.hColCount != 0 && b < this.hColCount)) {
            this._hideCol4Tab(this.hcTable, b);
            this._hideCol4Tab(this.hltTab, b)
        }
        this._ajustLockedSections();
        this.hiddenCols.push(b);
        this._reBoundCurCell();
        this._adjustScroll();
        for (var d = 0; d < this.getRowCount(); d++) {
            var g = this.getCell(b, d);
            if (g && g.td.getAttribute("wl")) {
                g.td.firstChild.style.height = "0px"
            }
        }
    },
    _hideCol4Tab: function(h, c) {
        var a = this._getCellDom(c, -1, h);
        var g = this.util.getStyle(a, "width");
        a.setAttribute("hf", 1);
        a.setAttribute("rw", g);
        a.style.width = "0px";
        var b = h.rows.length - 1;
        for (var d = 1; d <= b; ++d) {
            a = this._getCellDom(c, d - 1, h);
            this.util.convertCSSFromClass2Style(a);
            if (d == 1 || c == 0) {
                a.className = "mtitleCell"
            } else {
                a.className = "mgridCell"
            }
        }
    },
    _displayColumn: function(b) {
        var a = this._getCellDom(b, -1, this.contentTable);
        if (!a.getAttribute("hf")) {
            return
        }
        this._displayCol4Tab(this.contentTable, b);
        this._displayCol4Tab(this.hrTable, b);
        if (b === 0 || (this.hColCount != 0 && b < this.hColCount)) {
            this._displayCol4Tab(this.hcTable, b);
            this._displayCol4Tab(this.hltTab, b)
        }
        this._ajustLockedSections();
        this.hiddenCols.remove(b);
        this._reBoundCurCell();
        for (var d = 0; d < this.getRowCount(); d++) {
            var g = this.getCell(b, d);
            if (g && g.td.getAttribute("wl")) {
                g._resizeWraplineDiv()
            }
        }
    },
    _displayCol4Tab: function(h, c) {
        var a = this._getCellDom(c, -1, h);
        if (!a.getAttribute("hf")) {
            return
        }
        var g = a.getAttribute("rw");
        a.style.width = g;
        a.removeAttribute("hf");
        a.removeAttribute("rw");
        var b = h.rows.length - 1;
        for (var d = 1; d <= b; ++d) {
            a = this._getCellDom(c, d - 1, h);
            this.util.convertCSSFromClass2Style(a);
            if (d == 1 || c == 0) {
                a.className = "titleCell"
            } else {
                a.className = "gridCell"
            }
        }
    },
    getColHidden: function(b) {
        if (!this.checkRendered(true)) {
            return false
        }
        var a = this._getCellDom(b, -1, this.contentTable);
        if (!a.getAttribute("hf")) {
            return false
        }
        return true
    },
    getRowHidden: function(b) {
        if (!this.checkRendered(true)) {
            return false
        }
        var a = this._getCellDom(-1, b, this.contentTable);
        if (!a.getAttribute("hf")) {
            return false
        }
        return true
    },
    setColAutoWidth: function(b, c) {
        if (!this.checkRendered(true)) {
            return false
        }
        var a = this._getCellDom(b, -1, this.contentTable);
        if (c) {
            a.setAttribute("aw", 1)
        } else {
            a.removeAttribute("aw")
        }
    },
    setRowAutoHeight: function(c, b) {
        if (!this.checkRendered(true)) {
            return false
        }
        var a = this._getCellDom(-1, c, this.contentTable);
        if (b) {
            a.setAttribute("aw", 1)
        } else {
            a.removeAttribute("aw")
        }
    },
    setInitProperties: function(m) {
        DNA.widget.CssStyleFinder.updateCss(this);
        this.columnCount = m.colCount;
        this.rowCount = m.rowCount;
        this.hColCount = m.headerColCount;
        this.hRowCount = m.headerRowCount;
        var g = m.currentCell;
        if (g) {
            this.setCurrentCellNoFire(g, null , null , null , null , DNA.widget.JWTGrid.SETCURRENTCELLCAUSE_PROGRAM)
        }
        var c = m.cccf;
        if (c) {
            var b = c.split(",");
            this.currentCellColorFocused = b[0];
            this.currentCellColorUnFocused = b[1]
        } else {
            this.currentCellColorFocused = null ;
            this.currentCellColorUnFocused = null 
        }
        this.updateCurrentCellColor();
        var a = m.selections;
        if (a) {
            this.setSelections(a)
        }
        var l = m.tDivOffset;
        if (l) {
            this.setScrollTop(l.x);
            this.setScrollLeft(l.y);
            this._handleScroll()
        }
        var d = m.currentCellOffset;
        if (d) {
            this._setCurrentCellOffset(d)
        }
        if (m.wrapline) {
            this.hasWrapLineCells = true
        }
        this.replacing = false;
        this.ignoreHidden = m.ignoreHidden ? true : false;
        this.mergeRectCache = m.mergeRects || [];
        if (DNA.engine.Client.isFF()) {
            this._ajustLockedSections();
            this.reCalculateHeaderHeight4FireFoxHavingWrapLine()
        }
        var h = this;
        if (DNA.engine.Client.isIE() && document.documentMode >= 9) {
            setTimeout(function() {
                if (h === DNA.engine.application.getFocused()) {
                    h._focusInputProxy()
                }
            }, 1)
        }
    },
    setGridOption: function(a) {
        this.gridOption = a;
        if ((a & DNA.widget.JWTGrid.EDIT_MODE_MASK) == DNA.widget.JWTGrid.EDIT_MODE_READONLY) {
            this.closeEditor();
            this._hideFace()
        }
    },
    setDefEditor: function(a) {
        this.defEditorId = a
    },
    setColumnCount: function(a) {
        if (a > this.columnCount) {
            this.insertColumns(this.columnCount, a - this.columnCount);
            return
        }
        if (a < this.columnCount) {
            this.deleteColumns(a, this.columnCount - a)
        }
    },
    setRowCount: function(a) {
        if (a > this.rowCount) {
            this.insertRows(this.rowCount, a - this.rowCount);
            return
        }
        if (a < this.rowCount) {
            this.deleteRows(a, this.rowCount - a)
        }
    },
    getColumnCount: function() {
        return this.columnCount
    },
    getRowCount: function() {
        return this.rowCount
    },
    setHeaderColumnCount: function(a) {
        this._buildHeaderCols(a)
    },
    setHeaderRowCount: function(a) {
        this._buildHeaderRows(a)
    },
    getHeaderColumnCount: function() {
        return this.hColCount
    },
    getHeaderRowCount: function() {
        return this.hRowCount
    },
    setEditMode: function(a) {
        this.gridOption &= ~DNA.widget.JWTGrid.EDIT_MODE_MASK;
        this.gridOption |= (a & DNA.widget.JWTGrid.EDIT_MODE_MASK)
    },
    getEditMode: function() {
        return this.gridOption & DNA.widget.JWTGrid.EDIT_MODE_MASK
    },
    setSelectionMode: function(a) {
        var b = this.getSelectionMode();
        if (a != b) {
            this.gridOption &= ~DNA.widget.JWTGrid.SELECTION_MODE_MASK;
            this.gridOption |= (a & DNA.widget.JWTGrid.SELECTION_MODE_MASK);
            this._clearSelection()
        }
    },
    getSelectionMode: function() {
        return this.gridOption & DNA.widget.JWTGrid.SELECTION_MODE_MASK
    },
    setRowResizeEnable: function(a) {
        if (a) {
            this.gridOption |= DNA.widget.JWTGrid.ROW_RESIZE_MASK
        } else {
            this.gridOption &= ~DNA.widget.JWTGrid.ROW_RESIZE_MASK
        }
    },
    getRowResizeEnable: function() {
        return (this.gridOption & DNA.widget.JWTGrid.ROW_RESIZE_MASK) != 0
    },
    setColResizeEnable: function(a) {
        if (a) {
            this.gridOption |= DNA.widget.JWTGrid.COL_RESIZE_MASK
        } else {
            this.gridOption &= ~DNA.widget.JWTGrid.COL_RESIZE_MASK
        }
    },
    getColResizeEnable: function() {
        return (this.gridOption & DNA.widget.JWTGrid.COL_RESIZE_MASK) != 0
    },
    setRowSelectEnabled: function(a) {
        if (a) {
            this.gridOption |= DNA.widget.JWTGrid.ROW_SELECT_MASK
        } else {
            this.gridOption &= ~DNA.widget.JWTGrid.ROW_SELECT_MASK
        }
    },
    setRowFreeResizeEnabled: function(a) {
        if (a) {
            this.gridOption |= DNA.widget.JWTGrid.ROW_FREE_RESIZE_MASK
        } else {
            this.gridOption &= ~DNA.widget.JWTGrid.ROW_FREE_RESIZE_MASK
        }
    },
    getRowFreeResizeEnabled: function() {
        return (this.gridOption & DNA.widget.JWTGrid.ROW_FREE_RESIZE_MASK) != 0
    },
    setColFreeResizeEnabled: function(a) {
        if (a) {
            this.gridOption |= DNA.widget.JWTGrid.COL_FREE_RESIZE_MASK
        } else {
            this.gridOption &= ~DNA.widget.JWTGrid.COL_FREE_RESIZE_MASK
        }
    },
    getColFreeResizeEnabled: function() {
        return (this.gridOption & DNA.widget.JWTGrid.COL_FREE_RESIZE_MASK) != 0
    },
    getRowSelectEnabled: function() {
        return (this.gridOption & DNA.widget.JWTGrid.ROW_SELECT_MASK) != 0
    },
    setColSelectEnabled: function(a) {
        if (a) {
            this.gridOption |= DNA.widget.JWTGrid.COL_SELECT_MASK
        } else {
            this.gridOption &= ~DNA.widget.JWTGrid.COL_SELECT_MASK
        }
    },
    getColSelectEnabled: function() {
        return (this.gridOption & DNA.widget.JWTGrid.COL_SELECT_MASK) != 0
    },
    setEnterNext: function(a) {
        this.gridOption &= ~DNA.widget.JWTGrid.ENTER_NEXT_MASK;
        this.gridOption |= (a & DNA.widget.JWTGrid.ENTER_NEXT_MASK)
    },
    getEnterNext: function() {
        return this.gridOption & DNA.widget.JWTGrid.ENTER_NEXT_MASK
    },
    setMinColWidth: function(a) {
        if (a >= 0) {
            this.minColWidth = a
        } else {
            alert("�е���С��Ȳ���С��0")
        }
    },
    getMinColWidth: function() {
        return this.minColWidth
    },
    setMinRowHeight: function(a) {
        if (height >= 0) {
            this.minRowHeight = a
        } else {
            alert("�е���С�߶Ȳ���С��0")
        }
    },
    getMinRowHeight: function() {
        return this.minRowHeight
    },
    setDefColWidth: function(a) {
        if (a >= 0) {
            this.defColWidth = a
        } else {
            alert("�е�Ĭ�Ͽ�Ȳ���С��0")
        }
    },
    getDefColWidth: function(a) {
        return this.defColWidth = a
    },
    setDefRowHeight: function(a) {
        if (a >= 0) {
            this.defRowHeight = a
        } else {
            alert("�е�Ĭ�ϸ߶Ȳ���С��0")
        }
    },
    getDefRowHeight: function(a) {
        return this.defRowHeight
    },
    _setCurrentCellOffset: function(a) {
        if (!a) {
            return
        }
        var m = this.getCurrentCell();
        if (!m) {
            return
        }
        var d = this._getCellDom(m.x, m.y, this.contentTable);
        var h = d.offsetLeft;
        var g = d.offsetTop;
        this.tDiv.scrollLeft = h - a.x;
        this.tDiv.scrollTop = g - a.y;
        var b = this.tDiv.scrollLeft + "px";
        var c = this.tDiv.scrollTop + "px";
        if (this.hrDiv) {
            this.hrDiv.scrollLeft = this.tDiv.scrollLeft;
            if (DNA.engine.Client.isFF()) {
                this.hrDiv.style.left = b;
                this.hrDiv.style.top = c
            }
        }
        if (this.hcDiv) {
            this.hcDiv.scrollTop = this.tDiv.scrollTop;
            if (DNA.engine.Client.isFF()) {
                this.hcDiv.style.left = b;
                this.hcDiv.style.top = c
            }
        }
        if (this.hltDiv && DNA.engine.Client.isFF()) {
            this.hltDiv.style.left = b;
            this.hltDiv.style.top = c
        }
    },
    setCurrentCell: function(c, b, m, g, d, h) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = null ;
        if (c) {
            if (!this.util.isDataCol(c.x) || !this.util.isDataRow(c.y)) {
                return
            }
            try {
                a = new DNA.widget.AbstractGridCell(this,this.contentTable,c.x,c.y,false)
            } catch (l) {
                a = null 
            }
        }
        this._setCurrentCell(a, null , null , g, d, h);
        this.fireEvent("currentCellOffsetChanged", [this])
    },
    setCurrentCellNoFire: function(c, b, m, g, d, h) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = null ;
        if (c) {
            if (!this.util.isDataCol(c.x) || !this.util.isDataRow(c.y)) {
                return
            }
            try {
                a = new DNA.widget.AbstractGridCell(this,this.contentTable,c.x,c.y,false)
            } catch (l) {
                a = null 
            }
        }
        this._setCurrentCellNoFireChanging(a, null , null , g, d, true, h)
    },
    _setCurrentCell: function(n, l, h, d, a, c) {
        if (!this.checkRendered(true)) {
            return
        }
        this._stopDbClick = false;
        if (!n) {
            this._hideInputProxy();
            if (this.getCurrentCell()) {
                var b = {
                    widget: this,
                    target: null ,
                    lastCurrent: this.getCurrentCell(),
                    doit: true
                };
                this.fireCurrentCellChangingEvent(b);
                if (!b.doit) {
                    this._stopDbClick = true;
                    return
                }
                this.closeEditor(d);
                this._hideFace();
                this._drawCurrentCellBack();
                this.currentCell = null ;
                this.currentCol = -1;
                this.currentRow = -1
            }
            return
        }
        var m = n.getColIndex();
        var g = n.getRowIndex();
        if (this.currentCell) {
            if (this.currentCell.getColIndex() == m && this.currentCell.getRowIndex() == g) {
                this._drawCurrentCellBack();
                this._drawCurrentCell(n);
                return
            }
        }
        var b = {
            widget: this,
            target: new DNA.widget.Point(m,g),
            lastCurrent: this.getCurrentCell(),
            doit: true
        };
        this.fireCurrentCellChangingEvent(b);
        if (!b.doit) {
            this._stopDbClick = true;
            return
        }
        this._setCurrentCellNoFireChanging(n, l, h, d, a, false, c)
    },
    _setCurrentCellNoFireChanging: function(n, l, h, c, a, o, b) {
        if (!n) {
            this._hideInputProxy();
            if (this.getCurrentCell()) {
                this.closeEditor(c);
                this._hideFace();
                this._drawCurrentCellBack();
                this.currentCell = null ;
                this.currentCol = -1;
                this.currentRow = -1
            }
            return
        }
        var m = n.getColIndex();
        var g = n.getRowIndex();
        if (this.currentCell) {
            if (this.currentCell.getColIndex() == m && this.currentCell.getRowIndex() == g) {
                this._drawCurrentCellBack();
                this._drawCurrentCell(n);
                return
            }
        }
        this.closeEditor(c);
        this._hideFace();
        this._drawCurrentCellBack();
        this.currentCell = n;
        if (l) {
            this.currentCol = l
        } else {
            this.currentCol = n.getColIndex()
        }
        if (h) {
            this.currentRow = h
        } else {
            this.currentRow = n.getRowIndex()
        }
        this.focus();
        this._focusInputProxy();
        this._drawCurrentCell(n);
        this._scrollToCol(this.currentCol);
        this._scrollToRow(this.currentRow);
        this.updateCurrentCellColor();
        if ((this.getEditMode() != DNA.widget.JWTGrid.EDIT_MODE_READONLY) && this.util.isCellEditable(m, g)) {
            this._showFace()
        }
        if (o) {
            var d = function(p, q) {
                this.fireEvent("currentCellChangedByServer", [this, p, q])
            }
            ;
            DNA.adapter.browserPage.addFinalTask([d, this, [a, b]])
        } else {
            this.fireEvent("currentCellChanged", [this, a, b])
        }
    },
    _hideFace: function() {
        if (this.curFace) {
            this.tDiv.appendChild(this.curFace);
            this.curFace.style.display = "none";
            this.curFace = null 
        }
    },
    _showFace: function() {
        if (this.currentCell) {
            var b = this.currentCell.getEditorFace();
            if (b == 1) {
                this.curFace = this.btnFace
            } else {
                if (b == 2) {
                    this.curFace = this.listFace
                }
            }
            if (this.curFace) {
                var a = this.currentCell.getColIndex();
                var c = this.currentCell.getRowIndex();
                if (a < this.hColCount && c < this.hRowCount) {
                    this.hltDiv.appendChild(this.curFace)
                } else {
                    if (a < this.hColCount) {
                        this.hcDiv.appendChild(this.curFace)
                    } else {
                        if (c < this.hRowCount) {
                            this.hrDiv.appendChild(this.curFace)
                        } else {
                            this.tDiv.appendChild(this.curFace)
                        }
                    }
                }
                this.curFace.style.display = "";
                this._reBoundFace()
            }
        }
    },
    _reBoundFace: function() {
        if (this.currentCell && this.curFace) {
            var b = this.currentCell.td.offsetLeft;
            var d = this.currentCell.td.offsetTop;
            var c = this.currentCell.td.offsetWidth;
            var a = this.currentCell.td.offsetHeight;
            this.curFace.style.left = b + c - 19 + "px";
            this.curFace.style.top = d + "px";
            this.curFace.style.height = Math.max(0, a - 2) + "px";
            this.curFace.style.display = "none";
            this.curFace.style.display = ""
        }
    },
    _focusInputProxy: function() {
        if (!DNA.engine.Client.isIOS()) {
            if (!this.checkRendered(false)) {
                return
            }
            if (this.util.isCellEditable(this.currentCol, this.currentRow)) {
                this.placeInputProxy()
            } else {
                if (DNA.engine.application.getFocused() == this) {
                    this.getEl().focus()
                }
            }
        }
    },
    _blurInputProxy: function() {
        if (!this.checkRendered(false)) {
            return
        }
        try {
            this.inputProxy.blur()
        } catch (a) {}
    },
    _hideInputProxy: function() {
        DNA.engine.DomUtil.setLeftTop(this.inputProxy, 0, 0);
        this.inputProxy.style.width = "1px"
    },
    _reboundInputProxy: function() {
        if (!this.isVisible()) {
            return
        }
        if (this.currentCell) {
            var c = this.currentCell.td.offsetLeft;
            var b = this.currentCell.td.offsetTop;
            DNA.engine.DomUtil.setLeftTop(this.inputProxy, c, b);
            var a = this.currentCell.td.offsetWidth - 5;
            if (a < 1) {
                a = 1
            }
            this.inputProxy.style.width = a + "px"
        }
    },
    placeInputProxy: function() {
        if (!this.isVisible()) {
            return
        }
        if (this.currentCell) {
            var d = this.currentCell.td.offsetLeft;
            var c = this.currentCell.td.offsetTop;
            if (this.currentCell.getColIndex() < this.getHeaderColumnCount()) {
                d += this.tDiv.scrollLeft
            }
            if (this.currentCell.getRowIndex() < this.getHeaderRowCount()) {
                c += this.tDiv.scrollTop
            }
            DNA.engine.DomUtil.setLeftTop(this.inputProxy, d, c);
            var a = this.currentCell.td.offsetWidth - 5;
            if (a < 1) {
                a = 1
            }
            this.inputProxy.style.width = a + "px";
            try {
                this.inputProxy.focus();
                if (DNA.engine.Client.isIE()) {
                    this.inputProxy.select()
                }
            } catch (b) {}
        }
    },
    _reBoundCurCell: function() {
        if (this.currentCell) {
            var d = this.currentCell.td.offsetTop - 1;
            var c = this.currentCell.td.offsetLeft - 1;
            var b = this.currentCell.td.offsetWidth;
            var a = this.currentCell.td.offsetHeight;
            DNA.engine.DomUtil.setLeftTop(this.curLeft, c, d);
            DNA.engine.DomUtil.setHeight(this.curLeft, a);
            DNA.engine.DomUtil.setLeftTop(this.curTop, c, d);
            DNA.engine.DomUtil.setWidth(this.curTop, b);
            DNA.engine.DomUtil.setLeftTop(this.curRight, c + b, d);
            DNA.engine.DomUtil.setHeight(this.curRight, a);
            DNA.engine.DomUtil.setLeftTop(this.curBottom, c, d + a);
            DNA.engine.DomUtil.setWidth(this.curBottom, b);
            this.reBoundEditor()
        }
        this._reboundInputProxy()
    },
    reBoundEditor: function() {
        if (this.activeEditor) {
            this.activeEditor.reBoundCtr()
        }
    },
    _drawCurrentCell: function(b) {
        if (this.currentCol < this.hColCount && this.currentRow < this.hRowCount) {
            this.curLeft = this.hltDiv.childNodes[1];
            this.curRight = this.hltDiv.childNodes[2];
            this.curTop = this.hltDiv.childNodes[3];
            this.curBottom = this.hltDiv.childNodes[4]
        } else {
            if (this.currentCol < this.hColCount) {
                this.curLeft = this.hcDiv.childNodes[1];
                this.curRight = this.hcDiv.childNodes[2];
                this.curTop = this.hcDiv.childNodes[3];
                this.curBottom = this.hcDiv.childNodes[4]
            } else {
                if (this.currentRow < this.hRowCount) {
                    this.curLeft = this.hrDiv.childNodes[1];
                    this.curRight = this.hrDiv.childNodes[2];
                    this.curTop = this.hrDiv.childNodes[3];
                    this.curBottom = this.hrDiv.childNodes[4]
                } else {
                    this.curLeft = this.mCurLeft;
                    this.curRight = this.mCurRight;
                    this.curTop = this.mCurTop;
                    this.curBottom = this.mCurBottom
                }
            }
        }
        this.curLeft.style.display = "block";
        this.curRight.style.display = "block";
        this.curTop.style.display = "block";
        this.curBottom.style.display = "block";
        var m = b.td.offsetTop - 1;
        var l = b.td.offsetLeft - 1;
        var g = b.td.offsetWidth;
        var a = b.td.offsetHeight;
        if (this.util.getUpRow(b.getRowIndex()) <= this.hRowCount) {
            m += 1;
            a -= 1
        }
        if (this.util.getLeftCol(b.getColIndex()) <= this.hColCount) {
            l += 1;
            g -= 1
        }
        DNA.engine.DomUtil.setLeftTop(this.curLeft, l, m);
        DNA.engine.DomUtil.setHeight(this.curLeft, a);
        DNA.engine.DomUtil.setLeftTop(this.curTop, l, m);
        DNA.engine.DomUtil.setWidth(this.curTop, g);
        DNA.engine.DomUtil.setLeftTop(this.curRight, l + g, m);
        DNA.engine.DomUtil.setHeight(this.curRight, a);
        DNA.engine.DomUtil.setLeftTop(this.curBottom, l, m + a);
        DNA.engine.DomUtil.setWidth(this.curBottom, g);
        var l = b.getColIndex();
        var m = b.getRowIndex();
        var d = l + b.getColSpan() - 1;
        var c = m + b.getRowSpan() - 1;
        var h = {
            x: l,
            y: m,
            width: d,
            height: c
        };
        this._internalDrawTitle(h, false, true)
    },
    _drawCurrentCellBack: function() {
        if (this.currentCell) {
            this.curLeft.style.display = "none";
            this.curRight.style.display = "none";
            this.curTop.style.display = "none";
            this.curBottom.style.display = "none";
            if (!this._currentCellInSelection()) {
                var g = this.currentCell.getColIndex();
                var d = this.currentCell.getRowIndex();
                var b = g + this.currentCell.getColSpan() - 1;
                var a = d + this.currentCell.getRowSpan() - 1;
                var c = {
                    x: g,
                    y: d,
                    width: b,
                    height: a
                };
                this._internalDrawTitle(c, false, false)
            }
        }
    },
    _currentCellInSelection: function() {
        if (!this.currentCell) {
            return false
        }
        if (!this.selectionAreas || this.selectionAreas == 0) {
            return false
        }
        var c = {
            x: this.currentCell.getColIndex(),
            y: this.currentCell.getRowIndex()
        };
        for (var b = 0, a = this.selectionAreas.length; b < a; ++b) {
            if (this._isPointInRect(c, this.selectionAreas[b].getRange())) {
                return true
            }
        }
        return false
    },
    _isPointInRect: function(b, a) {
        if (b.x >= a.x && b.x < a.x + a.width && b.y >= a.y && b.y < a.y + a.height) {
            return true
        }
        return false
    },
    getCurrentCell: function() {
        if (this.currentCol == -1 || this.currentRow == -1) {
            return null 
        }
        return {
            x: this.currentCol,
            y: this.currentRow
        }
    },
    getCurrentCellOffset: function() {
        var l = this.getCurrentCell();
        if (!l) {
            return null 
        }
        var b = this._getCellDom(l.x, l.y, this.contentTable);
        var g = b.offsetLeft;
        var d = b.offsetTop;
        var h = this.tDiv.scrollLeft;
        var c = this.tDiv.scrollTop;
        var a = g - h;
        var m = d - c;
        return {
            x: a,
            y: m
        }
    },
    keyEnterDown: function(c) {
        var b = c.isShift();
        var a;
        switch (this.getEnterNext()) {
        case DNA.widget.JWTGrid.ENTER_NEXT_RIGHT:
            if (b) {
                a = this.util.getLeftCell(this.currentCol, this.currentRow, null , true, true)
            } else {
                a = this.util.getRightCell(this.currentCol, this.currentRow, null , true, true)
            }
            break;
        case DNA.widget.JWTGrid.ENTER_NEXT_DOWN:
            if (b) {
                a = this.util.getUpCell(this.currentCol, this.currentRow, null , true, true)
            } else {
                a = this.util.getDownCell(this.currentCol, this.currentRow, null , true, true)
            }
            break;
        case DNA.widget.JWTGrid.ENTER_NEXT_LEFT:
            if (b) {
                a = this.util.getRightCell(this.currentCol, this.currentRow, null , true, true)
            } else {
                a = this.util.getLeftCell(this.currentCol, this.currentRow, null , true, true)
            }
            break;
        case DNA.widget.JWTGrid.ENTER_NEXT_UP:
            if (b) {
                a = this.util.getDownCell(this.currentCol, this.currentRow, null , true, true)
            } else {
                a = this.util.getUpCell(this.currentCol, this.currentRow, null , true, true)
            }
            break
        }
        if (a) {
            this.selectCell(a.x, a.y)
        }
    },
    keydownNavigation: function(d) {
        var b = d.isShift();
        var c = d.isCtrl();
        var a = d.isAlt();
        if (!a) {
            var g = this.getSelectionMode();
            switch (g) {
            case DNA.widget.JWTGrid.SELECTION_MODE_MULTI:
            case DNA.widget.JWTGrid.SELECTION_MODE_SINGLE:
                if (this.selectionAreas.length === 0) {
                    if (this.getCurrentCell()) {
                        this.keyCellSelect(d)
                    }
                } else {
                    if (g === DNA.widget.JWTGrid.SELECTION_MODE_SINGLE || !b) {
                        this.keyCellSelect(d)
                    } else {
                        if (!c) {
                            this.keyCellSelectWithShift(d)
                        } else {
                            this.keyCellSelectWithCtrlShift(d)
                        }
                    }
                }
                break;
            case DNA.widget.JWTGrid.SELECTION_MODE_ROW:
                this.keyRowSelect(d);
                break
            }
        }
    },
    selectFirstCell: function() {},
    keyCellSelect: function(d) {
        var c = d.isCtrl();
        var b = d.getKeyCode();
        var a;
        if (!c) {
            switch (b) {
            case DNA.JWTEvent.LEFT:
                a = this.util.getLeftCell(this.currentCol, this.currentRow, null , false, false);
                break;
            case DNA.JWTEvent.RIGHT:
                a = this.util.getRightCell(this.currentCol, this.currentRow, null , false, false);
                break;
            case DNA.JWTEvent.UP:
                a = this.util.getUpCell(this.currentCol, this.currentRow, null , false, false);
                break;
            case DNA.JWTEvent.DOWN:
                a = this.util.getDownCell(this.currentCol, this.currentRow, null , false, false);
                break;
            case DNA.JWTEvent.HOME:
                a = this.util.getRowFirstCell(this.currentRow, false, false);
                break;
            case DNA.JWTEvent.END:
                a = this.util.getRowLastCell(this.currentRow, false, false);
                break
            }
        } else {
            switch (b) {
            case DNA.JWTEvent.LEFT:
                a = this.util.getRowFirstCell(this.currentRow, false, false);
                break;
            case DNA.JWTEvent.RIGHT:
                a = this.util.getRowLastCell(this.currentRow, false, false);
                break;
            case DNA.JWTEvent.UP:
                a = this.util.getColFirstCell(this.currentCol, false, false);
                break;
            case DNA.JWTEvent.DOWN:
                a = this.util.getColLastCell(this.currentCol, false, false);
                break;
            case DNA.JWTEvent.HOME:
                a = this.util.getFirstCell(null , false);
                break;
            case DNA.JWTEvent.END:
                a = this.util.getLastCell(null , false);
                break
            }
        }
        if (a) {
            this.selectCell(a.x, a.y)
        }
    },
    selectCell: function(a, c) {
        if (this.util.isDataCell(a, c)) {
            this.setCurrentCell({
                x: a,
                y: c
            }, a, c, null , null , DNA.widget.JWTGrid.SETCURRENTCELLCAUSE_KEY);
            this.clearSelection();
            var b = new DNA.widget.GridSelectionArea(this,{
                x: a,
                y: c,
                width: a,
                height: c
            },true,this.selectionDiv,true);
            this._setSelection(b);
            this.fireEvent("selection", [this]);
            this.setCurrentSelection(b)
        }
    },
    keyCellSelectWithShift: function(g) {
        var q = g.getKeyCode();
        var l = this.getCurrentSelection();
        if (!l) {
            return
        }
        var n = l.getRange();
        switch (q) {
        case DNA.JWTEvent.LEFT:
            var m = this.shrinkCellRect(n, DNA.widget.JWTGrid.LEFT);
            if (this.rectEqual(m, n)) {
                return
            }
            if (m.x == this.currentCol) {
                l._setBound(m);
                l.reBuild(true)
            } else {
                var p = this.util.getLeftCol(m.x);
                if (this.util.isDataCol(p)) {
                    var o = new DNA.widget.Rectangle(p,m.y,l.width,m.height);
                    l._setBound(o);
                    l.reBuild(true)
                }
            }
            break;
        case DNA.JWTEvent.RIGHT:
            if (l.x < this.currentCol) {
                var a = this.util.getRightCol(l.x);
                if (this.util.isDataCol(a)) {
                    var o = new DNA.widget.Rectangle(a,l.y,l.width,l.height);
                    l._setBound(o);
                    l.reBuild(true)
                }
                return
            }
            var b = this.shrinkCellRect(n, DNA.widget.JWTGrid.RIGHT);
            if (!b || this.rectEqual(b, n)) {
                return
            }
            l._setBound(b);
            l.reBuild(true);
            break;
        case DNA.JWTEvent.UP:
            if (l.y < this.currentRow) {
                var h = this.util.getUpRow(l.y);
                if (this.util.isDataRow(h)) {
                    var o = new DNA.widget.Rectangle(l.x,h,l.width,l.height);
                    l._setBound(o);
                    l.reBuild(true)
                }
            } else {
                var r = this.shrinkCellRect(n, DNA.widget.JWTGrid.UP);
                if (this.rectEqual(r, n)) {
                    return
                }
                l._setBound(r);
                l.reBuild(true)
            }
            break;
        case DNA.JWTEvent.DOWN:
            if (l.y < this.currentRow) {
                var c = this.util.getDownRow(l.y);
                if (this.util.isDataRow(c)) {
                    var o = new DNA.widget.Rectangle(l.x,c,l.width,l.height);
                    l._setBound(o);
                    l.reBuild(true)
                }
                return
            }
            var d = this.shrinkCellRect(n, DNA.widget.JWTGrid.DOWN);
            if (!d || this.rectEqual(d, n)) {
                return
            }
            l._setBound(d);
            l.reBuild(true);
            break;
        case DNA.JWTEvent.HOME:
            break;
        case DNA.JWTEvent.END:
            break
        }
        this._internalDrawTitle(l, false, true);
        this.fireEvent("selection", [this])
    },
    keyCellSelectWithCtrlShift: function(a) {},
    keyRowSelect: function(a) {},
    shrinkCellRect: function(p, h) {
        var t;
        var u = new DNA.widget.Rectangle(p);
        switch (h) {
        case DNA.widget.JWTGrid.LEFT:
            var d = p.width - 1;
            u.width--;
            while (d > 0) {
                var g = d;
                for (var l = p.y; l <= p.height; ++l) {
                    t = new DNA.widget.AbstractGridCell(this,this.contentTable,d,l,false);
                    var c = t.getColIndex() + t.getColSpan() - 1;
                    if (t.getColIndex() <= g) {
                        g = t.getColIndex() - 1
                    }
                    if (c > u.width) {
                        u.width = c
                    }
                }
                if (u.width == p.width) {
                    d = g;
                    u.width = g
                } else {
                    break
                }
            }
            break;
        case DNA.widget.JWTGrid.RIGHT:
            var s = this.util.getRightCol(p.width);
            if (!this.util.isDataCol(s)) {
                return null 
            }
            u.width++;
            while (s > 0) {
                var m = s;
                for (var l = p.y; l <= p.height; ++l) {
                    t = new DNA.widget.AbstractGridCell(this,this.contentTable,s,l,false);
                    var c = t.getColIndex() + t.getColSpan() - 1;
                    if (c >= m) {
                        m = c + 1
                    }
                    if (c > u.width) {
                        u.width = c
                    }
                }
                if (u.width == p.width) {
                    s = m;
                    u.width = m
                } else {
                    break
                }
            }
            break;
        case DNA.widget.JWTGrid.UP:
            var o = this.util.getUpRow(p.height);
            u.height--;
            while (o > 0) {
                var v = o;
                for (var l = p.x; l <= p.width; ++l) {
                    t = new DNA.widget.AbstractGridCell(this,this.contentTable,l,o,false);
                    var n = t.getRowIndex() + t.getRowSpan() - 1;
                    if (t.getRowIndex() <= v) {
                        v = t.getRowIndex() - 1
                    }
                    if (n < u.height) {
                        u.height = n
                    }
                }
                if (u.height == p.height) {
                    o = v;
                    u.height = v
                } else {
                    break
                }
            }
            break;
        case DNA.widget.JWTGrid.DOWN:
            var a = this.util.getDownRow(p.height);
            if (!this.util.isDataRow(a)) {
                return null 
            }
            u.height++;
            while (a > 0) {
                var q = a;
                for (var l = p.x; l <= p.width; ++l) {
                    t = new DNA.widget.AbstractGridCell(this,this.contentTable,l,a,false);
                    var n = t.getRowIndex() + t.getRowSpan() - 1;
                    if (n >= q) {
                        q = n + 1
                    }
                    if (n > u.height) {
                        u.height = n
                    }
                }
                if (u.height == p.height) {
                    a = q;
                    u.height = q
                } else {
                    break
                }
            }
            break;
        default:
            break
        }
        return u
    },
    expandCellRect: function(g, c) {
        var b;
        var a = new DNA.widget.Rectangle(g);
        switch (c) {
        case DNA.widget.JWTGrid.LEFT:
        case DNA.widget.JWTGrid.RIGHT:
            var h = g.width - 1;
            a.width--;
            while (h > 0) {
                for (var d = g.y; x <= g.height; ++d) {
                    b = new DNA.widget.AbstractGridCell(this,this.contentTable,h,d,false)
                }
            }
            break;
        case DNA.widget.JWTGrid.UP:
            break;
        case DNA.widget.JWTGrid.DOWN:
            break;
        default:
            break
        }
    },
    rectEqual: function(b, a) {
        if (b.x === a.x && b.width === a.width && b.y === a.y && b.height === a.height) {
            return true
        }
        return false
    },
    _autoScroll: function(d) {
        var p = d.getLocation();
        var b = this.contentTable.offsetHeight;
        var g = this.contentTable.offsetWidth;
        var m = DNA.engine.DomUtil.getClientSize(this.tDiv);
        var o = DNA.engine.DomUtil.getSize(this.hrTable);
        var n = DNA.engine.DomUtil.getSize(this.hcTable);
        var a = 100;
        var l = 20;
        var c = 30;
        var h = 10;
        if (m.width - p.x < a) {
            if (this.tDiv.scrollLeft + m.width + l <= g) {
                this.tDiv.scrollLeft += (l)
            } else {
                this.tDiv.scrollLeft = g - m.width
            }
        }
        if (p.x - n.width < a) {
            if (this.tDiv.scrollLeft - l >= 0) {
                this.tDiv.scrollLeft -= (l)
            } else {
                this.tDiv.scrollLeft = 0
            }
        }
        if (m.height - p.y < c) {
            if (this.tDiv.scrollTop + m.height + h <= b) {
                this.tDiv.scrollTop += (h)
            } else {
                this.tDiv.scrollTop = b - m.height
            }
        }
        if (p.y - o.height < c) {
            if (this.tDiv.scrollTop - h >= 0) {
                this.tDiv.scrollTop -= (h)
            } else {
                this.tDiv.scrollTop = 0
            }
        }
    },
    allSelectStart: function(c) {
        if (!this.checkRendered(true)) {
            return
        }
        var b = {
            x: 1,
            y: 1,
            width: this.columnCount - 1,
            height: this.rowCount - 1
        };
        var a;
        a = new DNA.widget.GridSelectionArea(this,b,false);
        this._setSelection(a);
        this.setCurrentSelection(a)
    },
    rowSelectStart: function(g) {
        if (!this.checkRendered(true)) {
            return
        }
        var n = this.mouseCell.y;
        var h = g.isCtrl();
        var b = g.isShift();
        var a = {
            x: 1,
            y: n,
            width: this.columnCount - 1,
            height: n
        };
        var o;
        if ((!h && !b) || (h && b)) {
            o = new DNA.widget.GridSelectionArea(this,a,false,this.selectionDiv,false);
            var c = this.util.getRowFirstCell(n, false, false);
            this.setCurrentCell(c, c.x, c.y, null , g.getButton());
            this._setSelection(o);
            this.setCurrentSelection(o)
        } else {
            if (h && !b) {
                o = new DNA.widget.GridSelectionArea(this,a,false,this.selectionDiv,false);
                var c = this.util.getRowFirstCell(n, false, false);
                this.setCurrentCell(c, c.x, c.y, null , g.getButton());
                this._addSelection(o);
                this.setCurrentSelection(o)
            } else {
                if (this.currentRow == -1) {
                    this.currentRow = n
                }
                var d = Math.min(this.currentRow, n);
                var l = Math.max(this.currentRow, n);
                var m = {
                    x: 1,
                    y: d,
                    width: this.columnCount - 1,
                    height: l
                };
                if (!this.currentSelection) {
                    o = new DNA.widget.GridSelectionArea(this,m,false,null ,false);
                    var c = this.util.getRowFirstCell(n, false, false);
                    this.setCurrentCell(c, c.x, c.y, null , g.getButton());
                    this._addSelection(o, false);
                    this.setCurrentSelection(o)
                } else {
                    this.currentSelection._setBound(m);
                    this.currentSelection.reBuild(true)
                }
            }
        }
    },
    colSelectStart: function(g) {
        if (!this.checkRendered(true)) {
            return
        }
        var n = this.mouseCell.x;
        var h = g.isCtrl();
        var b = g.isShift();
        var a = {
            x: n,
            y: 1,
            width: n,
            height: this.rowCount - 1
        };
        var m;
        if ((!h && !b) || (h && b)) {
            var c = this.util.getColFirstCell(n, false, false);
            this.setCurrentCell(c, c.x, c.y, null , g.getButton());
            m = new DNA.widget.GridSelectionArea(this,a,false,this.selectionDiv,false);
            this._setSelection(m);
            this.setCurrentSelection(m)
        } else {
            if (h && !b) {
                var c = this.util.getColFirstCell(n, false, false);
                this.setCurrentCell(c, c.x, c.y, null , g.getButton());
                m = new DNA.widget.GridSelectionArea(this,a,false,this.selectionDiv,false);
                this._addSelection(m);
                this.setCurrentSelection(m)
            } else {
                if (this.currentCol == -1) {
                    this.currentCol = n
                }
                var d = Math.min(this.currentCol, n);
                var o = Math.max(this.currentCol, n);
                var l = {
                    x: d,
                    y: 1,
                    width: o,
                    height: this.rowCount - 1
                };
                if (!this.currentSelection) {
                    m = new DNA.widget.GridSelectionArea(this,l,false,null ,false);
                    var c = this.util.getColFirstCell(n, false, false);
                    this.setCurrentCell(c, c.x, c.y, null , g.getButton());
                    this._addSelection(m, false);
                    this.setCurrentSelection(m)
                } else {
                    this.currentSelection._setBound(l);
                    this.currentSelection.reBuild(true)
                }
            }
        }
    },
    checkSelRange: function(a) {
        if (a.x < 1 || a.width >= this.columnCount || a.x > a.width) {
            return false
        }
        if (a.y < 1 || a.height >= this.rowCount || a.y > a.height) {
            return false
        }
        return true
    },
    getSelections: function() {
        var b = this.selectionAreas.length;
        var a = new Array();
        for (var c = 0; c < b; ++c) {
            var d = this.selectionAreas[c];
            a.push({
                x: d.x,
                y: d.y,
                width: d.width - d.x + 1,
                height: d.height - d.y + 1
            })
        }
        return a
    },
    getSelection: function() {
        var a = new DNA.widget.Rectangle();
        if (this.currentSelection) {
            a.x = this.currentSelection.x;
            a.y = this.currentSelection.y;
            a.width = this.currentSelection.width - this.currentSelection.x + 1;
            a.height = this.currentSelection.height - this.currentSelection.y + 1
        }
        return a
    },
    addSelection: function(b) {
        if (!this.checkRendered(true) || !b || !this.checkSelRange(b)) {
            return
        }
        this.selectionDiv.style.width = "0px";
        var a = new DNA.widget.GridSelectionArea(this,b,true,null );
        this._internalDrawTitle(a, true, true);
        this.selectionAreas.push(a)
    },
    setSelection: function(b) {
        if (!this.checkRendered(true)) {
            return
        }
        this.selectionDiv.style.width = "0px";
        this._clearSelection();
        if (!b || !this.checkSelRange(b)) {
            return
        }
        var a = new DNA.widget.GridSelectionArea(this,b,true,null );
        this._internalDrawTitle(a, true, true);
        this.selectionAreas.push(a)
    },
    setSelections: function(b) {
        if (!this.checkRendered(true)) {
            return
        }
        this._clearSelection();
        if (!b) {
            return
        }
        var a = b.length;
        for (var c = 0; c < a; ++c) {
            this.addSelection(b[c])
        }
    },
    _addSelection: function(a) {
        if (!this.checkRendered(true)) {
            return
        }
        this._internalDrawTitle(a, true, true);
        this.selectionAreas.push(a)
    },
    _setSelection: function(a) {
        if (!this.checkRendered(true)) {
            return
        }
        this._clearSelection();
        this._internalDrawTitle(a, true, true);
        this.selectionAreas.push(a)
    },
    _drawTitlesBack: function(g) {
        if (!this.checkRendered(true)) {
            return
        }
        var m = g.x;
        var d = g.width;
        var l = g.y;
        var b = g.height;
        var h = this._getRowDom(0, this.hrTable);
        var a;
        for (var c = m; c <= d; ++c) {
            a = this._getRowCell(h, c, 0);
            this.util.convertCSSFromClass2Style(a);
            a.style.backgroundColor = "";
            a.style.borderColor = "";
            if (c < this.hColCount) {
                a = this._getCellDom(c, 0, this.hltTab);
                this.util.convertCSSFromClass2Style(a);
                a.style.backgroundColor = "";
                a.style.borderColor = ""
            }
        }
        for (var c = l; c <= b; ++c) {
            a = this._getCellDom(0, c, this.hcTable);
            this.util.convertCSSFromClass2Style(a);
            a.style.backgroundColor = "";
            a.style.borderColor = "";
            if (c < this.hRowCount) {
                a = this._getCellDom(0, c, this.hltTab);
                this.util.convertCSSFromClass2Style(a);
                a.style.backgroundColor = "";
                a.style.borderColor = ""
            }
        }
    },
    _colInCurSel: function(b) {
        var a = this.selectionAreas.length;
        for (var c = 0; c < a; ++c) {
            var d = this.selectionAreas[c];
            if ((b >= d.x) && (b <= d.width)) {
                return true
            }
        }
        return false
    },
    _rowInCurSel: function(d) {
        var a = this.selectionAreas.length;
        for (var b = 0; b < a; ++b) {
            var c = this.selectionAreas[b];
            if ((d >= c.y) && (d <= c.height)) {
                return true
            }
        }
        return false
    },
    _clearSelTitle: function() {
        var a = this.selectionAreas.length;
        for (var b = 0; b < a; ++b) {
            var c = this.selectionAreas[b]
        }
    },
    clearSelection: function() {
        this._clearSelection()
    },
    _clearSelection: function(c) {
        this.currentSelection = null ;
        var a = this.selectionAreas.length;
        var d;
        for (var b = (a - 1); b >= 0; --b) {
            d = this.selectionAreas.pop();
            if (d) {
                this._internalDrawTitle(d, true, false);
                d.destroy()
            }
        }
        if (a) {
            this.selectionAreas.length = 0;
            if (c) {
                this.fireSelectionEvent()
            }
        }
    },
    _reComputeSelections: function(g, b) {
        var a = this.selectionAreas.length;
        var d;
        for (var c = 0; c < a; c++) {
            d = this.selectionAreas[c];
            if (d) {
                if (g != -1 && g <= d.height) {
                    d.setDivSize();
                    continue
                }
                if (b != -1 && b <= d.width) {
                    d.setDivSize()
                }
            }
        }
    },
    setCurrentSelection: function(a) {
        if (this.currentSelection) {
            if (!this.currentSelection.isBuild()) {
                this.currentSelection.reBuild(true)
            }
        }
        this.currentSelection = a
    },
    getCurrentSelection: function() {
        if (this.currentSelection) {
            return this.currentSelection
        } else {
            if (this.selectionAreas && this.selectionAreas.length > 0) {
                return this.selectionAreas[0]
            }
        }
    },
    mouseCellSelectStart: function(g) {
        this.selectFinish = false;
        var a = g.isShift();
        var h = g.isCtrl();
        var b = this.mouseCell;
        this.selBeginCell = b;
        switch (this.getSelectionMode()) {
        case DNA.widget.JWTGrid.SELECTION_MODE_MULTI:
            if ((!h && !a) || (h && a)) {
                this.setCurrentCell(b, null , null , null , g.getButton());
                var m = {
                    x: b.x,
                    y: b.y,
                    width: b.x,
                    height: b.y
                };
                var n = new DNA.widget.GridSelectionArea(this,m,true,this.selectionDiv,true);
                this._setSelection(n);
                this.setCurrentSelection(n)
            } else {
                if (h && !a) {
                    this.setCurrentCell(b, null , null , null , g.getButton());
                    var m = {
                        x: b.x,
                        y: b.y,
                        width: b.x,
                        height: b.y
                    };
                    var n = new DNA.widget.GridSelectionArea(this,m,true,this.selectionDiv,true);
                    this._addSelection(n);
                    this.setCurrentSelection(n)
                } else {
                    if (this.selectionAreas.length === 0) {
                        this.setCurrentCell(b, null , null , null , g.getButton());
                        var m = {
                            x: b.x,
                            y: b.y,
                            width: b.x,
                            height: b.y
                        };
                        var n = new DNA.widget.GridSelectionArea(this,m,true,this.selectionDiv,true);
                        this._setSelection(n);
                        this.setCurrentSelection(n)
                    } else {
                        var m = {
                            x: this.currentCol,
                            y: this.currentRow,
                            width: b.x,
                            height: b.y
                        };
                        var n = new DNA.widget.GridSelectionArea(this,m,true,null ,false);
                        this._setSelection(n);
                        this.setCurrentSelection(n)
                    }
                }
            }
            break;
        case DNA.widget.JWTGrid.SELECTION_MODE_ROW:
            var m = {
                x: 1,
                y: b.y,
                width: this.columnCount - 1,
                height: b.y
            };
            if ((!h && !a) || (h && a)) {
                this.setCurrentCell(b, null , null , null , g.getButton());
                var n = new DNA.widget.GridSelectionArea(this,m,false,this.selectionDiv,false);
                this._setSelection(n);
                this.setCurrentSelection(n)
            } else {
                if (h && !a) {
                    this.setCurrentCell({
                        x: this.util.getFirstCol(false),
                        y: b.y
                    }, null , null , null , g.getButton());
                    var n = new DNA.widget.GridSelectionArea(this,m,false,this.selectionDiv,false);
                    this._addSelection(n);
                    this.setCurrentSelection(n)
                } else {
                    if (this.currentCell) {
                        var c = Math.min(this.currentRow, b.y);
                        var l = Math.max(this.currentRow, b.y);
                        for (var d = c + 1; d <= l; ++d) {
                            m = {
                                x: 1,
                                y: d,
                                width: this.columnCount - 1,
                                height: d
                            };
                            var n = new DNA.widget.GridSelectionArea(this,m,false,this.selectionDiv,false);
                            this._addSelection(n)
                        }
                    }
                }
            }
            break;
        case DNA.widget.JWTGrid.SELECTION_MODE_SINGLE:
            this.setCurrentCell(b, null , null , null , g.getButton());
            var m = {
                x: b.x,
                y: b.y,
                width: b.x,
                height: b.y
            };
            var n = new DNA.widget.GridSelectionArea(this,m,false,this.selectionDiv,true);
            this._setSelection(n);
            this.setCurrentSelection(n);
            break
        }
    },
    mouseCellSelecting: function(c) {
        if (!this.currentSelection) {
            return
        }
        var d = this.getSelectionMode();
        if (d == DNA.widget.JWTGrid.SELECTION_MODE_SINGLE || d == DNA.widget.JWTGrid.SELECTION_MODE_ROW) {
            return
        }
        var b = this.mouseCell;
        if (b.x == this.lastMouseCell.x && b.y == this.lastMouseCell.y) {
            return
        }
        if (this.currentRow < this.hRowCount) {
            this.tDiv.scrollTop = "0px"
        }
        this.lastMouseCell = b;
        var a = {
            x: this.currentCol,
            y: this.currentRow,
            width: b.x,
            height: b.y
        };
        this.currentSelection._setBound(a);
        this.currentSelection.reBuild(true)
    },
    mouseCellSelectEnd: function(g) {
        this.selectFinish = true;
        this.selectionDiv.style.width = "0px";
        if (this.currentSelection) {
            if (this.getSelectionMode() != DNA.widget.JWTGrid.SELECTION_MODE_ROW && this.currentCell) {
                var c = this.currentCell.getColIndex();
                var h = this.currentCell.getRowIndex();
                var d = c + this.currentCell.getColSpan();
                var a = h + this.currentCell.getRowSpan();
                if (this.mouseCell && (this.mouseCell.x >= c) && (this.mouseCell.y >= h) && (this.mouseCell.x < d) && (this.mouseCell.y < a)) {
                    this.fireEvent("selection", [this]);
                    return
                }
            }
            this.currentSelection.reBuild(true);
            this._internalDrawTitle(this.currentSelection, false, true);
            this.fireEvent("selection", [this])
        }
    },
    setActiveEditor: function(a) {
        if (this.activeEditor) {
            this.activeEditor.close(true)
        }
        this.activeEditor = a
    },
    openEditor: function(q, m, o, h, g) {
        if (!this.editorProvider) {
            return
        }
        var l = this.editorProvider.getCellEditor(this, q);
        if (!l.control) {
            return
        }
        if (this._eidtorIsOpen(q, l)) {
            return
        }
        this._hideFace();
        var n = DNA.engine.DomUtil.getInnerText(q.td);
        if (!n) {
            n = ""
        }
        q.td.setAttribute("st", n);
        if (!(DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) && q.td.getAttribute("wl")) {
            DNA.engine.DomUtil.setInnerText(q.td.firstChild, "")
        } else {
            DNA.engine.DomUtil.setInnerText(q.td, "")
        }
        this.setActiveEditor(l);
        this.reCalculateHeaderHeight4FireFoxHavingWrapLine(q.rowIndex);
        this.activeEditor.open(o, h, g);
        this.focusable = false;
        var a = {
            grid: this,
            col: this.currentCol,
            row: this.currentRow,
            showText: this.currentCell.getShowText(),
            editText: this.currentCell.getEditText()
        };
        this.fireEvent("beforeedit", [a]);
        if (m && m.getKeyCode()) {
            var b = m.getKeyCode();
            var p = String.fromCharCode(b);
            var d = l.getText();
            var c = d + p;
            l.setText(c)
        }
    },
    _eidtorIsOpen: function(a, b) {
        return a.td.lastChild ? a.td.lastChild == b.control.el : false
    },
    openCurrentEditor: function() {
        if (!this.currentCell) {
            return
        }
        if (this.getEditMode() === DNA.widget.JWTGrid.EDIT_MODE_READONLY) {
            return
        }
        if (!this.util.isCellEditable(this.currentCell.getColIndex(), this.currentCell.getRowIndex())) {
            return
        }
        var a = new DNA.widget.AbstractGridCell(this,null ,this.currentCell.getColIndex(),this.currentCell.getRowIndex(),false);
        this.openEditor(a, null , false, DNA.widget.JWTGrid.EDITOPEN_PROGRAM)
    },
    setCellEditorProvider: function(a) {
        this.editorProvider = a
    },
    closeEditor: function(d) {
        this.focusable = true;
        if (!this.currentCell) {
            this.activeEditor = null 
        }
        if (this.activeEditor) {
            var b = this.activeEditor.getResult(d ? d : 0);
            if (!b) {
                var n = this.currentCell.getShowText();
                this.activeEditor.close();
                this.activeEditor = null ;
                var l = this.getCell(this.currentCell.getColIndex(), this.currentCell.getRowIndex());
                l.setShowText(n, true);
                return
            }
            var h = b.getShowText();
            var c = b.getEditText();
            var g = {
                grid: this,
                col: this.currentCol,
                row: this.currentRow,
                showText: h,
                editText: c
            };
            this.fireEvent("afteredit", [g]);
            this.activeEditor.close();
            var l = this.getCell(this.currentCell.getColIndex(), this.currentCell.getRowIndex());
            l.setEditText(g.editText ? g.editText : "", true);
            if (h == "image://") {
                l.setShowText(g.showText ? g.showText : "", true);
                l.setShowImage(c);
                if (DNA.engine.Client.isIE()) {
                    l.td.innerText = " "
                }
            } else {
                var a = this.getFormattedText(l);
                var m = a ? a : (g.showText ? g.showText : "");
                if (l.isVertText()) {
                    m = m.split("").join("\n")
                }
                l.setShowText(m, true)
            }
            this.fireDataChangeEvent({
                x: this.currentCol,
                y: this.currentRow,
                width: this.currentCol,
                height: this.currentRow
            }, DNA.widget.JWTGrid.DATACHANGE_INPUT);
            this.activeEditor = null ;
            this.reCalculateHeaderHeight4FireFoxHavingWrapLine(this.currentCell.rowIndex)
        }
    },
    getFormattedText: function(a) {
        try {
            var b = this.formatterMgr.getFormatter(a.getFormatter());
            if (b) {
                return b.format(a.getEditText())
            }
        } catch (c) {
            return null 
        }
    },
    ensureEditorClose: function(a, b) {
        if (!this.currentCell && this.activeEditor) {
            this.activeEditor.close();
            this.activeEditor = null ;
            return true
        }
        if (this.activeEditor && this.currentCell) {
            if (a.getRowIndex() == this.currentCell.getRowIndex() && a.getColIndex() == this.currentCell.getColIndex()) {
                if (!this.activeEditor.getCloseFlag()) {
                    if (b) {
                        this.closeEditor()
                    }
                    return false
                }
            }
        }
        return true
    },
    reInitEditor: function(a) {
        if (!this.currentCell) {
            this.activeEditor = null ;
            return
        }
        if (this.activeEditor) {
            if (a.getRowIndex() == this.currentCell.getRowIndex() && a.getColIndex() == this.currentCell.getColIndex()) {
                this.activeEditor.initEditor(-1)
            }
        }
    },
    synchronizeData: function() {
        if (this.activeEditor) {
            var c = this.activeEditor.getResult();
            var b = c.getShowText();
            var d = c.getEditText();
            var a = this.getCell(this.currentCell.getColIndex(), this.currentCell.getRowIndex());
            a.setShowText(b ? b : "", true, true);
            a.setEditText(d ? d : "", true);
            this.fireDataChangeEvent({
                x: this.currentCol,
                y: this.currentRow,
                width: this.currentCol,
                height: this.currentRow
            }, DNA.widget.JWTGrid.DATACHANGE_INPUT)
        }
    },
    synDataNoFire: function() {
        if (this.activeEditor) {
            var c = this.activeEditor.getResult();
            var b = c.getShowText();
            var d = c.getEditText();
            var a = this.getCell(this.currentCell.getColIndex(), this.currentCell.getRowIndex());
            a.setShowText(b ? b : "", true, true);
            a.setEditText(d ? d : "", true);
            this.fireDataChangeEvent({
                x: this.currentCol,
                y: this.currentRow,
                width: this.currentCol,
                height: this.currentRow
            }, DNA.widget.JWTGrid.DATACHANGE_INPUT, true)
        }
    },
    synDataToCellProperty: function() {
        if (this.activeEditor) {
            var c = this.activeEditor.getResult();
            var b = c.getShowText();
            var d = c.getEditText();
            var a = this.getCell(this.currentCell.getColIndex(), this.currentCell.getRowIndex());
            a.setShowText(b ? b : "", true, true);
            a.setEditText(d ? d : "", true)
        }
    },
    _scrollToCol: function(n) {
        if (!this.checkRendered(true)) {
            return
        }
        if (n <= 0 || n >= this.columnCount) {
            return
        }
        if (n < this.hColCount) {
            return
        }
        var h = this.contentTable.rows[0].cells[1].offsetWidth;
        var l = this.hcDiv.offsetWidth;
        var p = h > l ? h : l;
        var m = this.tDiv.clientWidth;
        var o = this.contentTable.rows[0].cells[n + 1];
        var c = o.offsetLeft - p;
        var d = c + o.offsetWidth + p;
        var g = this.tDiv.scrollLeft ? this.tDiv.scrollLeft : 0;
        var a = m + g;
        if (c < g) {
            var b = c;
            this.tDiv.scrollLeft = b > 0 ? b : 0;
            if (this.hrDiv) {
                this.hrDiv.scrollLeft = this.tDiv.scrollLeft
            }
            return
        } else {
            if (d > a) {
                var b = d - m;
                this.tDiv.scrollLeft = b > 0 ? b : 0;
                if (this.hrDiv) {
                    this.hrDiv.scrollLeft = this.tDiv.scrollLeft
                }
            }
        }
    },
    _scrollToRow: function(m) {
        if (!this.checkRendered(true)) {
            return
        }
        if (m <= 0 || m >= this.rowCount) {
            return
        }
        if (m < this.hRowCount) {
            return
        }
        var b = this.contentTable.rows[1].cells[0].offsetHeight;
        var c = this.hrDiv.offsetHeight;
        var n = b > c ? b : c;
        var g = this.tDiv.clientHeight;
        var o = this.contentTable.rows[m + 1].cells[0];
        var p = o.offsetTop - n;
        var h = p + o.offsetHeight + n;
        var d = this.tDiv.scrollTop ? this.tDiv.scrollTop : 0;
        var a = g + d;
        if (p < d) {
            var l = p;
            this.tDiv.scrollTop = l > 0 ? l : 0;
            if (this.hcDiv) {
                this.hcDiv.scrollTop = this.tDiv.scrollTop
            }
            return
        } else {
            if (h > a) {
                var l = h - g;
                this.tDiv.scrollTop = l > 0 ? l : 0;
                if (this.hcDiv) {
                    this.hcDiv.scrollTop = this.tDiv.scrollTop
                }
            }
        }
    },
    insertRowHtml: function(c, a) {
        if (c <= 1 || c > this.rowCount) {
            return
        }
        var b = this.contentTable.rows[c];
        b.insertAdjacentElement("afterEnd", a)
    },
    replaceRowHtml: function(c, a) {
        if (c <= 1 || c >= this.rowCount) {
            return
        }
        var b = this.contentTable.rows[c];
        b.insertAdjacentElement("afterEnd", a);
        b.replaceNode(this.contentTable.rows[c + 1])
    },
    fireDataChangeEvent: function(c, b, a) {
        this.fireEvent("datachange", [this, c, b, a])
    },
    fireSelectionEvent: function() {
        this.fireEvent("selection", [this])
    },
    fireCurrentCellChangedEvent: function() {
        this.fireEvent("currentCellChanged", [this])
    },
    fireCurrentCellChangingEvent: function(a) {
        this.fireEvent("currentCellChanging", [a])
    },
    _internalDrawTitle: function(o, l, b) {
        if (!this.checkRendered(true)) {
            return
        }
        var c = o.x;
        var p = o.width;
        var n = o.y;
        var a = o.height;
        var q;
        var m = this._getRowDom(0, this.hrTable);
        for (var g = c; g <= p; ++g) {
            if (!l || !this._colInCurSel(g)) {
                q = this._getRowCell(m, g, 0);
                this.util.convertCSSFromClass2Style(q);
                if (b) {
                    q.style.backgroundColor = this._selTitleBackColor;
                    q.style.borderColor = this._selTitleBorderColor
                } else {
                    var h = q.getAttribute("bgc");
                    if (!h) {
                        h = ""
                    }
                    var d = q.getAttribute("rbc");
                    if (!d) {
                        d = ""
                    }
                    var r = q.getAttribute("bbc");
                    if (!r) {
                        r = ""
                    }
                    q.style.backgroundColor = h;
                    q.style.borderRightColor = d;
                    q.style.borderBottomColor = r;
                    q.style.borderLeftColor = "";
                    q.style.borderTopColor = ""
                }
                if (g < this.hColCount) {
                    q = this._getCellDom(g, 0, this.hltTab);
                    this.util.convertCSSFromClass2Style(q);
                    if (b) {
                        q.style.backgroundColor = this._selTitleBackColor;
                        q.style.borderColor = this._selTitleBorderColor
                    } else {
                        var h = q.getAttribute("bgc");
                        if (!h) {
                            h = ""
                        }
                        var d = q.getAttribute("rbc");
                        if (!d) {
                            d = ""
                        }
                        var r = q.getAttribute("bbc");
                        if (!r) {
                            r = ""
                        }
                        q.style.backgroundColor = h;
                        q.style.borderRightColor = d;
                        q.style.borderBottomColor = r;
                        q.style.borderLeftColor = "";
                        q.style.borderTopColor = ""
                    }
                }
            }
        }
        for (var g = n; g <= a; ++g) {
            if (!l || !this._rowInCurSel(g)) {
                q = this._getCellDom(0, g, this.hcTable);
                this.util.convertCSSFromClass2Style(q);
                if (b) {
                    q.style.backgroundColor = this._selTitleBackColor;
                    q.style.borderColor = this._selTitleBorderColor
                } else {
                    var h = q.getAttribute("bgc");
                    if (!h) {
                        h = ""
                    }
                    var d = q.getAttribute("rbc");
                    if (!d) {
                        d = ""
                    }
                    var r = q.getAttribute("bbc");
                    if (!r) {
                        r = ""
                    }
                    q.style.backgroundColor = h;
                    q.style.borderRightColor = d;
                    q.style.borderBottomColor = r;
                    q.style.borderLeftColor = "";
                    q.style.borderTopColor = ""
                }
                if (g < this.hRowCount) {
                    q = this._getCellDom(0, g, this.hltTab);
                    this.util.convertCSSFromClass2Style(q);
                    if (b) {
                        q.style.backgroundColor = this._selTitleBackColor;
                        q.style.borderColor = this._selTitleBorderColor
                    } else {
                        var h = q.getAttribute("bgc");
                        if (!h) {
                            h = ""
                        }
                        var d = q.getAttribute("rbc");
                        if (!d) {
                            d = ""
                        }
                        var r = q.getAttribute("bbc");
                        if (!r) {
                            r = ""
                        }
                        q.style.backgroundColor = h;
                        q.style.borderRightColor = d;
                        q.style.borderBottomColor = r;
                        q.style.borderLeftColor = "";
                        q.style.borderTopColor = ""
                    }
                }
            }
        }
    },
    ensureHAndW: function(l) {
        if (!l) {
            return
        }
        var o = l.getRowIndex();
        var c = l.getColIndex();
        var g = this.util.getRowAutoHeight(o);
        var a = this.util.getColAutoWidth(c);
        if (a) {
            var b = 0;
            for (var d = 0; d < this.rowCount; ) {
                var h = new DNA.widget.AbstractGridCell(this,this.contentTable,c,d,false);
                var n = DNA.engine.DomUtil.computeTextSize(l.getShowText(), l.getFont());
                if (n.width > b) {
                    b = n.width
                }
                d += h.getRowSpan()
            }
            this.setColumnWidth(c, b)
        }
        if (g) {
            var m = 0;
            for (var d = 0; d < this.columnCount; ) {
                var h = new DNA.widget.AbstractGridCell(this,this.contentTable,d,o,false);
                var n = DNA.engine.DomUtil.computeTextSize(l.getShowText(), l.getFont());
                if (n.height > m) {
                    m = n.height
                }
                d += h.getColSpan()
            }
            this.setRowHeight(o, m)
        }
    },
    _add: function(b, a) {
        if (a) {
            return this._renderChild(this.getBody(), DNA.JWT.RENDER_POS_TYPE_LAST, a)
        }
    },
    _focusDom: function(a) {
        if (DNA.engine.Client.isIE() && this.tDiv && this.tDiv.ownerDocument.activeElement == this.inputProxy) {
            return
        }
        if (this._isMouseDownonScrollbar(a)) {
            return
        }
        if (a && (a.getSrcElement() == this.tDiv || a.getSrcElement().className == "" || a.getSrcElement().className.indexOf("titleCell") >= 0)) {
            return
        }
        if (this.gridState === DNA.widget.JWTGrid2.STATE_COL_RESIZE || this.gridState === DNA.widget.JWTGrid2.STATE_ROW_RESIZE) {
            return
        }
        if (this.tDiv && DNA.engine.Client.isFF()) {
            this.tDiv.focus()
        }
        this._focusInputProxy()
    },
    reCalculateHeaderHeight4FireFoxHavingWrapLine: function(b) {
        if (!(DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict()))) {
            if (b) {
                this._reCalculateRowHeight4ff(b)
            } else {
                if (this.rowCount && this.rowCount < 100) {
                    for (var a = 0; a < this.rowCount; a++) {
                        this._reCalculateRowHeight4ff(a)
                    }
                }
            }
        }
    },
    _reCalculateRowHeight4ff: function(d) {
        if (this.contentTable && this.contentTable.rows[d].style.display != "none") {
            if (d >= this.contentTable.rows.length - 1) {
                return
            }
            var b = 0;
            var c = this._getCellDom(b, d, this.contentTable);
            if (c) {
                var a = c.offsetHeight;
                c = this._getCellDom(-1, d, this.hcTable);
                if (c) {
                    c.style.height = a + "px"
                }
                if (this.hltTab && this.hltTab.rows && d < this.hltTab.rows.length - 1) {
                    c = this._getCellDom(-1, d, this.hltTab);
                    if (c) {
                        c.style.height = a + "px"
                    }
                }
            }
        }
    },
    getScrollTop: function() {
        return this.tDiv.scrollTop
    },
    getScrollLeft: function() {
        return this.tDiv.scrollLeft
    },
    setScrollTop: function(a) {
        this.tDiv.scrollTop = Math.max(0, a)
    },
    setScrollLeft: function(a) {
        return this.tDiv.scrollLeft = Math.max(0, a)
    },
    getClientHeight: function() {
        return this.tDiv.clientHeight
    },
    setHorizontalPosition: function(a) {
        if (this.tDiv) {
            this.tDiv.scrollLeft = a;
            this._handleScroll()
        }
    },
    setVerticalPosition: function(a) {
        if (this.tDiv) {
            this.tDiv.scrollTop = a;
            this._handleScroll()
        }
    },
    _getScrollElement: function() {
        return this.tDiv
    },
    _resizeWraplineDivHeightInMergeCells: function() {
        if (!(DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict()))) {
            var a;
            var d;
            var b;
            for (var c = this.mergeRectCache.length - 1; c >= 0; c--) {
                a = this.getCell(this.mergeRectCache[c].x, this.mergeRectCache[c].y);
                if (a && a.td.getAttribute("wl")) {
                    a._resizeWraplineDiv()
                }
            }
        }
    },
    fullUpdateNoIframe: function(a) {
        this.tDiv.innerHTML = a;
        this._replaceDom()
    },
    _hasVScroll: function() {
        var b = false
          , l = false;
        var h = 0, d, c;
        var a = this.tDiv.clientWidth
          , g = this.tDiv.clientHeight;
        for (d = 0,
        c = this.getColumnCount(); d < c; d++) {
            if (!this.getColHidden(d)) {
                h += this.getColumnWidth(d)
            }
            if (h > a) {
                b = true;
                break
            }
        }
        h = 0;
        g = b ? g - 17 : g;
        for (d = 0,
        c = this.getRowCount(); d < c; d++) {
            if (!this.getRowHidden(d)) {
                h += this.getRowHeight(d)
            }
            if (h > g) {
                l = true;
                break
            }
        }
        return l
    },
    _hasHScroll: function() {
        var b = false
          , l = false;
        var h = 0, d, c;
        var a = this.tDiv.clientWidth
          , g = this.tDiv.clientHeight;
        for (d = 0,
        c = this.getRowCount(); d < c; d++) {
            if (!this.getRowHidden(d)) {
                h += this.getRowHeight(d)
            }
            if (h > g) {
                l = true;
                break
            }
        }
        h = 0;
        a = l ? a - 17 : a;
        for (d = 0,
        c = this.getColumnCount(); d < c; d++) {
            if (!this.getColHidden(d)) {
                h += this.getColumnWidth(d)
            }
            if (h > a) {
                b = true;
                break
            }
        }
        return b
    },
    _isMouseDownonScrollbar: function(c) {
        if (c) {
            var a = c.getLocation();
            var b = this.getBounds();
            if (this._hasHScroll() && a.y <= b.height && a.y >= b.height - 17) {
                return true
            }
            if (this._hasVScroll() && a.x <= b.width && a.x >= b.width - 17) {
                return true
            }
        }
        return false
    },
    setCurrentCellColor: function(b, a) {
        this.currentCellColorFocused = b;
        this.currentCellColorUnFocused = a;
        this.updateCurrentCellColor()
    },
    updateCurrentCellColor: function() {
        if (this.currentCellColorFocused === null  || this.currentCellColorUnFocused === null ) {
            return
        }
        var a;
        var c = [this.curLeft, this.curRight, this.curBottom, this.curTop];
        if (DNA.engine.DomUtil.hasClass(this.el, "focus")) {
            a = this.currentCellColorFocused
        } else {
            a = this.currentCellColorUnFocused
        }
        for (var b = 0; b < c.length; b++) {
            c[b].style.backgroundColor = a
        }
    }
});
Object.override(DNA.widget.Grid.prototype, {
    jtype: "Grid",
    focusable: true
});
DNA.widget.GridSelectionArea = function(b, d, a, g, c) {
    this.grid = b;
    this.div = null ;
    this._setBound(d);
    this.computeFlag = a;
    this.ranges = new Array();
    this.divs = new Array();
    if (a) {
        this.calculateRange()
    }
    if (g) {
        this.div = g
    } else {
        if (!(this.y == this.height && this.x == this.width)) {
            this.createDiv()
        }
    }
    if (!c) {
        this.setDivSize()
    }
}
;
Object.override(DNA.widget.GridSelectionArea.prototype, {
    getRange: function() {
        return {
            x: this.x,
            y: this.y,
            width: this.width,
            height: this.height
        }
    },
    _setBound: function(a) {
        this.y = a.y <= a.height ? a.y : a.height;
        this.height = a.y <= a.height ? a.height : a.y;
        this.x = a.x <= a.width ? a.x : a.width;
        this.width = a.x <= a.width ? a.width : a.x
    },
    isBuild: function() {
        return this.buildFlag
    },
    createDiv: function() {
        this.buildFlag = true;
        this.div = null ;
        var a = this.grid.hColCount;
        var h = this.grid.hRowCount;
        var n = this.grid.columnCount - 1;
        var m = this.grid.rowCount - 1;
        var l = {
            x: this.x,
            y: this.y,
            width: this.width,
            height: this.height
        };
        var o = "<div class='grid_select_area_div' unselectable='on'></div>";
        if (DNA.engine.Client.isIE() && DNA.engine.Client.getBrowserVersion() < 7) {
            o = "<div class='grid_select_area_div_IE6' unselectable='on'></div>"
        }
        var b = this._getRectIntersection(l, {
            x: a,
            y: h,
            width: n,
            height: m
        });
        if (b) {
            this.ranges.push(b);
            DNA.engine.DomUtil.insertAfter(this.grid.tDiv.firstChild, o);
            this.divs.push(this.grid.tDiv.childNodes[1])
        }
        var c = this._getRectIntersection(l, {
            x: 1,
            y: h,
            width: a - 1,
            height: m
        });
        if (c) {
            this.ranges.push(c);
            DNA.engine.DomUtil.insertAfter(this.grid.hcDiv.lastChild, o);
            this.divs.push(this.grid.hcDiv.lastChild)
        }
        var d = this._getRectIntersection(l, {
            x: a,
            y: 1,
            width: n,
            height: h - 1
        });
        if (d) {
            this.ranges.push(d);
            DNA.engine.DomUtil.insertAfter(this.grid.hrDiv.lastChild, o);
            this.divs.push(this.grid.hrDiv.lastChild)
        }
        var g = this._getRectIntersection(l, {
            x: 1,
            y: 1,
            width: a - 1,
            height: h - 1
        });
        if (g) {
            this.ranges.push(g);
            DNA.engine.DomUtil.insertAfter(this.grid.hltDiv.lastChild, o);
            this.divs.push(this.grid.hltDiv.lastChild)
        }
    },
    _getRectIntersection: function(d, c) {
        if (d.width < c.x || c.width < d.x) {
            return null 
        }
        var b = d.x > c.x ? d.x : c.x;
        var g = d.width > c.width ? c.width : d.width;
        if (d.height < c.y || c.height < d.y) {
            return null 
        }
        var h = d.y > c.y ? d.y : c.y;
        var a = d.height > c.height ? c.height : d.height;
        return {
            x: b,
            y: h,
            width: g,
            height: a
        }
    },
    setDivSize: function() {
        if ((this.x == this.width) && (this.y == this.height)) {
            return
        }
        if (this.div != null ) {
            var o = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,this.x,this.y,!this.computeFlag);
            var c = o.getLeft();
            var m = o.getTop();
            var n = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,this.width,this.height,!this.computeFlag);
            var a = n.getLeft();
            var l = n.getTop();
            var b = a - c + n.getWidth() + 1;
            var p = l - m + n.getHeight() + 1;
            this.setDiv(this.div, c, m, b, p);
            return
        }
        var h = this.ranges.length;
        for (var d = 0; d < h; ++d) {
            var g = this.ranges[d];
            var o = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,g.x,g.y,!this.computeFlag);
            var c = o.getLeft();
            var m = o.getTop();
            var n = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,g.width,g.height,!this.computeFlag);
            var a = n.getLeft();
            var l = n.getTop();
            var b = a - c + n.getWidth();
            var p = l - m + n.getHeight();
            this.setDiv(this.divs[d], c, m, b, p)
        }
    },
    setDiv: function(g, b, d, c, a) {
        DNA.engine.DomUtil.setSize(g, {
            width: c,
            height: a
        });
        DNA.engine.DomUtil.setLeftTop(g, b, d)
    },
    destroy: function() {
        if (this.div != null ) {
            this.div.style.width = "0px";
            this.div = null 
        }
        var a = this.divs.length;
        for (var b = 0; b < a; ++b) {
            var c = this.divs[b];
            c.parentNode.removeChild(c)
        }
        this.ranges.length = 0;
        this.divs.length = 0
    },
    calculateRange: function() {
        var h = this.y;
        var l = this.height;
        var m = this.x;
        var a = this.width;
        var d, b;
        for (var g = h; g <= l; ++g) {
            d = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,m,g,false);
            b = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,a,g,false);
            if (d.getColIndex() < this.x) {
                this.x = d.getColIndex()
            }
            if (b.getColIndex() + b.getColSpan() - 1 > this.width) {
                this.width = b.getColIndex() + b.getColSpan() - 1
            }
        }
        for (var c = m; c <= a; ++c) {
            d = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,c,h,false);
            b = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,c,l,false);
            if (d.getRowIndex() < this.y) {
                this.y = d.getRowIndex()
            }
            if (b.getRowIndex() + b.getRowSpan() - 1 > this.height) {
                this.height = b.getRowIndex() + b.getRowSpan() - 1
            }
        }
    },
    redraw: function() {
        if (this.computeFlag) {
            this.calculateRange()
        }
        this.setDivSize()
    },
    reBuild: function(a) {
        if (a) {
            this.destroy()
        }
        if (this.computeFlag) {
            this.calculateRange()
        }
        if ((this.x == this.width) && (this.y == this.height)) {
            return
        }
        this.createDiv();
        this.setDivSize()
    }
});
DNA.widget.AbstractCellEditor = function() {}
;
DNA.widget.AbstractCellEditor.extend(Object, {
    getAnEditor: function(b, a) {
        this.grid = b;
        this.cell = a;
        this.control = null ;
        this.grid = b;
        this.cell = a;
        this.createEditor();
        return this
    },
    open: function(l, d, c, g) {
        if (this.control) {
            var m = this.cell.td.offsetLeft;
            var h = this.cell.td.offsetTop;
            var b = this.cell.td.offsetWidth;
            var n = this.cell.td.offsetHeight;
            if (this.control.checkRendered(true)) {
                if (!g) {
                    if (this.control.setText4Event) {
                        this.control.setText4Event("")
                    }
                }
                this.control.setVisible(true);
                if (this.control.blur2Text) {
                    this.control.blur2Text(true)
                }
                if (DNA.engine.Client.isFF() && this.cell.td.getAttribute("wl")) {
                    this.cell.td.firstChild.style.display = "none"
                }
                this.cell.td.appendChild(this.control.el);
                this.grid.util.rebuildControl(this.control);
                var a = {
                    x: m,
                    y: h - 1,
                    width: b,
                    height: n + 1
                };
                this._cancelThread();
                this.dbClickFlag = l;
                this.detail = d;
                this.controlBounds = a;
                if (!DNA.engine.Client.isIOS()) {
                    this._thread = new DNA.engine.Thread(1,new DNA.engine.Runnable(this._delayFocus,this,[l, d, a, g]));
                    this._thread.start()
                }
                if (this.control.jtype === "Text") {
                    if (!this.control.hasListener("keydown", this, this._eidtorKeyDown)) {
                        this.control.addListener("keydown", this._eidtorKeyDown, this)
                    }
                }
                if (DNA.engine.Client.isIOS()) {
                    this._delayFocus(l, d, a, g)
                }
            }
            if (!DNA.engine.Client.isIOS()) {
                this.setOpening(true)
            }
        }
    },
    reBoundCtr: function() {
        var b = this.cell.td.offsetLeft;
        var d = this.cell.td.offsetTop;
        var c = this.cell.td.offsetWidth;
        var a = this.cell.td.offsetHeight;
        this.control.setBounds(b, d - 1, c, a + 1)
    },
    _delayFocus: function(l, g, a, m) {
        this._cancelThread();
        this.control.el.style.visibility = "hidden";
        this.control.setBounds(a.x, a.y, a.width, a.height);
        if (!m) {
            this.initEditor(g, this.grid.inputProxy.value)
        }
        this.control.el.style.visibility = "visible";
        this.control.focus();
        this.grid.inputProxy.value = "";
        this.grid.inputProxy.blur();
        if (this.control.jtype === "Text") {
            var n = this.control.getText();
            if (n && n != "") {
                var h = n.length;
                if (l) {
                    this.control.setSelectPoint(0, h)
                } else {
                    this.control.setSelectPoint(h, h)
                }
            }
        }
        this.setOpening(false);
        this.setCloseFlag(false);
        var d = DNA.adapter.adapterFactory.get(this.control.jtype);
        var b = d.getWrapper(this.control);
        if (b._hasEvent(DNA.JWT.CLIENT_EVENT_GRID_EDITOR_OPEN)) {
            var c = new DNA.adapter.ClientEvent();
            b._fireClientEvent(DNA.JWT.CLIENT_EVENT_GRID_EDITOR_OPEN, c)
        }
    },
    _cancelThread: function() {
        if (this._thread) {
            this._thread.stop();
            this._thread = null 
        }
    },
    _editorMouseUp: new DNA.engine.Action({
        handle: function(a) {
            if (!this.control.checkRendered(true)) {
                return
            }
            this.grid.gridState = DNA.widget.JWTGrid.STATE_NORMAL
        }
    }),
    _eidtorKeyDown: new DNA.engine.Action({
        handle: function(c) {
            if (!this.control.checkRendered(true)) {
                return
            }
            switch (c.getKeyCode()) {
            case DNA.JWTEvent.LEFT:
                var b = this.control.getSelectPoint();
                if (b.x != b.y) {
                    break
                }
                if (b.x === 0) {
                    c.setSrcControl(this.grid);
                    this.grid.fireEvent("keydown", [c])
                }
                break;
            case DNA.JWTEvent.RIGHT:
                var b = this.control.getSelectPoint();
                if (b.x != b.y) {
                    break
                }
                var a = this.control.getText().length;
                if (b.y === a) {
                    c.setSrcControl(this.grid);
                    this.grid.fireEvent("keydown", [c])
                }
                break;
            default:
                break
            }
        }
    }),
    createEditor: function() {},
    initEditor: function() {},
    getResult: function() {},
    getText: function() {},
    close: function(a) {
        this._cancelThread();
        if (!a && !this.getCloseFlag()) {
            this.control.setVisible(false);
            if (this.control.clearSelectionVar) {
                this.control.clearSelectionVar()
            }
            if (DNA.engine.Client.isFF() && this.cell.td.getAttribute("wl")) {
                this.cell.td.firstChild.style.display = ""
            }
            this.grid.tDiv.appendChild(this.control.el);
            this.grid.util.rebuildControl(this.control);
            this.control.setBounds(0, 0, 0, 0);
            this.setCloseFlag(true)
        }
    },
    setCloseFlag: function(a) {
        this.closed = a
    },
    getCloseFlag: function() {
        return this.closed
    },
    setOpening: function(a) {
        this.opening = a
    },
    isOpening: function() {
        return this.opening
    },
    setText: function(a) {}
});
DNA.widget.CommonCellEditor = function() {
    DNA.widget.CommonCellEditor.superclass.constructor.call(this)
}
;
DNA.widget.CommonCellEditor.extend(DNA.widget.AbstractCellEditor, {
    createEditor: function() {
        var a = this.cell.td.getAttribute("ei");
        if (!a) {
            a = this.grid.defEditorId
        }
        this.control = DNA.widget.WidgetRegistry.get(a)
    },
    initEditor: function(h, d) {
        var g = DNA.adapter.adapterFactory.get(this.control.jtype);
        var a = g.getWrapper(this.control);
        var m = this.cell.getShowText();
        if (!d) {
            d = this.cell.getEditText()
        }
        this.cell.td.setAttribute("st", m);
        if (a._hasEvent(DNA.JWT.CLIENT_EVENT_GRID_EDITOR_INIT)) {
            var c = new DNA.adapter.ClientGridCellEditorEvent(h);
            c.setShowText(m);
            c.setEditText(d);
            a._fireClientEvent(DNA.JWT.CLIENT_EVENT_GRID_EDITOR_INIT, c)
        } else {
            if (!m || m == " ") {
                m = ""
            }
            if (!d || d == " " || d == "") {
                d = m
            }
            if (this.control.jtype === "Text" || this.control.jtype === "ComboPanel") {
                this.control.setDescription(m);
                this.control.setText(d);
                this.control.processText();
                this.control.fireEvent("document", [this.control])
            } else {
                if (this.control.jtype === "Spinner") {
                    try {
                        var n = parseInt(d);
                        if (!isNaN(n)) {
                            this.control.setSelection(n)
                        } else {
                            this.control.setSelection(this.control.getMinimum())
                        }
                    } catch (l) {
                        this.control.setSelection(this.control.getMinimum())
                    }
                } else {
                    if (this.control.jtype === "DateTime") {
                        var b = new Date();
                        try {
                            b = Date.parse(eidtText, "Y-m-d");
                            this.control.setDate(b.getTime())
                        } catch (l) {
                            this.control.setDate(new Date().getTime())
                        }
                    }
                }
            }
        }
    },
    getText: function() {
        var a = "";
        if (this.control.getText) {
            a = this.control.getText()
        }
        return a
    },
    setText: function(a) {
        if (this.control.setText) {
            this.control.setText(a)
        }
    },
    getResult: function(b) {
        if (this.isOpening()) {
            this._delayFocus(this.dbClickFlag, this.detail, this.controlBounds)
        }
        var h = this.control.getData("wrapper");
        var a = "";
        var d = "";
        if (h._hasEvent(DNA.JWT.CLIENT_EVENT_GRID_EDITOR_GETVALUE)) {
            var g = new DNA.adapter.ClientGridCellEditorEvent(b ? b : 0);
            h._fireClientEvent(DNA.JWT.CLIENT_EVENT_GRID_EDITOR_GETVALUE, g, true);
            if (!g.doit) {
                return null 
            }
            a = g.getShowText();
            d = g.getEditText()
        } else {
            if (this.control.jtype === "Text") {
                d = this.control.getText();
                a = d
            } else {
                if (this.control.jtype === "ComboPanel") {
                    d = this.control.getText();
                    a = this.control.getDescription()
                } else {
                    if (this.control.jtype === "Spinner") {
                        d = this.control.getSelection() + "";
                        a = d
                    } else {
                        if (this.control.jtype === "DateTime") {
                            var c = this.control.getDate();
                            d = c.format("Y-m-d");
                            a = d
                        }
                    }
                }
            }
            if (!a) {
                a = d
            }
        }
        return new DNA.widget.CommonCellContent(a,d)
    }
});
DNA.widget.ICellEditorProvider = function() {}
;
DNA.widget.ICellEditorProvider.extend(Object, {
    getCellEditor: function(b, a) {}
});
DNA.widget.CellEditorProvider = function() {
    DNA.widget.CellEditorProvider.superclass.constructor.call();
    this.gridEditorInstance = new DNA.widget.CommonCellEditor()
}
;
DNA.widget.CellEditorProvider.extend(DNA.widget.ICellEditorProvider, {
    getCellEditor: function(b, a) {
        return this.gridEditorInstance.getAnEditor(b, a)
    }
});
DNA.widget.IGridCell = function(b, a, c) {
    this.grid = b;
    this.x = a;
    this.y = c;
    this.table = null ;
    this.td = null ;
    this.rowIndex = -1;
    this.colIndex = -1;
    this.type = DNA.widget.JWTGrid.CELL_COMMON
}
;
DNA.widget.IGridCell.extend(Object, {
    merge: function(l, p) {
        var q = this.rowIndex;
        var a = this.rowIndex + p;
        if (l > 1 && l >= this.getColSpan()) {
            this.td.colSpan = l
        }
        var h = 1;
        if (p > 1 && p >= this.getRowSpan()) {
            h = this._getRowRealSpan(p);
            if (p > h) {
                this.td.rrs = p;
                this.td.rowSpan = h
            } else {
                this.td.rowSpan = p
            }
        }
        var g = this.colIndex;
        var s = g + l;
        var b = this.rowIndex + h;
        for (var d = q; d < a; ++d) {
            var o = this.table.rows[d + 1];
            for (var c = g; c < s; ++c) {
                if (d == q && c == g) {
                    continue
                }
                var r = o.cells[c + 1];
                r.style.display = "none";
                if (d >= b) {
                    r.rs = 1
                }
            }
        }
    },
    _getRowRealSpan: function(c) {
        var a = c;
        for (var b = this.rowIndex + c - 1; b >= this.rowIndex; --b) {
            if (!this.grid.getRowVisible(b)) {
                a--
            } else {
                if (!DNA.engine.Client.isStrict()) {
                    break
                }
            }
        }
        return a
    },
    getShowText: function() {
        var a = this.getAttribute(this.td, "st");
        if (!a) {
            a = DNA.engine.DomUtil.getInnerText(this.td);
            if (a.length == 1 && (a == " " || a.charCodeAt(0) == 160)) {
                a = ""
            }
        } else {
            try {
                if (a.length == 1 && a.charCodeAt(0) == 160) {
                    a = ""
                }
            } catch (b) {}
        }
        return this.grid.util.getNormalSpaceString(a)
    },
    getEditText: function() {
        var a = this.getAttribute(this.td, "et");
        if (a) {
            a = this.parseHtml(a);
            if (a == " ") {
                a = ""
            }
            return this.grid.util.getNormalSpaceString(a)
        }
        return ""
    },
    getClientData: function() {
        var data = this.getAttribute(this.td, "cd");
        if (data) {
            data = this.parseHtml(data);
            if (data == " ") {
                data = ""
            }
            if (data != "") {
                return eval("(" + data + ")")
            }
        }
        return null 
    },
    getFormatter: function() {
        return this.getAttribute(this.td, "fi")
    },
    getBackground: function() {
        var a = this.grid.util.getStyle(this.td, "backgroundColor");
        return this.parseColor(a)
    },
    parseColor: function(b) {
        if (!b || b == "") {
            return ""
        }
        if (!(b.length == 7 && b.indexOf("#") == 0)) {
            if (DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) {
                if (b.length === 4) {
                    var c = "#";
                    c += b.charAt(1);
                    c += b.charAt(1);
                    c += b.charAt(2);
                    c += b.charAt(2);
                    c += b.charAt(3);
                    c += b.charAt(3);
                    b = c
                }
            } else {
                var d = b.substring(b.indexOf("(") + 1, b.indexOf(")")).split(",");
                var g = (parseInt(d[0]) << 16) + (parseInt(d[1]) << 8) + parseInt(d[2]);
                b = g.toString(16);
                var h = 6 - b.length;
                for (var a = 0; a < h; ++a) {
                    b = "0" + b
                }
                b = "#" + b
            }
        }
        return b
    },
    getShowImage: function() {
        return this.grid.util.getStyle(this.td, "backgroundImage")
    },
    getForeground: function() {
        var a = this.grid.util.getStyle(this.td, "color");
        return this.parseColor(a)
    },
    getEditor: function() {
        return this.getAttribute(this.td, "ei")
    },
    getFont: function() {
        var g = this.grid.util.getStyle(this.td, "fontFamily");
        var c = this.grid.util.getStyle(this.td, "fontSize");
        var d = this.grid.util.getStyle(this.td, "fontStyle");
        var h = this.grid.util.getStyle(this.td, "fontWeight");
        var b = this.grid.util.getStyle(this.td, "textDecoration");
        var l = 0;
        if (d == "normal") {
            l |= DNA.JWT.FONT_STYLE_PLAIN
        } else {
            if (d == "italic") {
                l |= DNA.JWT.FONT_STYLE_ITALIC
            }
        }
        if (h == "bold") {
            l |= DNA.JWT.FONT_STYLE_BOLD
        }
        if (b != "none") {
            if (b == "underline") {
                l |= DNA.JWT.FONT_STYLE_UNDERLINE
            } else {
                if (b == "line-through") {
                    l |= DNA.JWT.FONT_STYLE_INLINE
                } else {
                    if (b && b != "") {
                        l |= DNA.JWT.FONT_STYLE_UNDERLINE;
                        l |= DNA.JWT.FONT_STYLE_INLINE
                    }
                }
            }
        }
        var a = new DNA.widget.Font(g,c,l);
        return a
    },
    getIndent: function() {
        var a = this.grid.util.getStyle(this.td, "textIndent");
        if (a) {
            a = parseInt(a)
        } else {
            a = 0
        }
        return a
    },
    getLeft: function() {
        if (this.td && this.grid.util.getStyle(this.td, "display") != "none") {
            return this.td.offsetLeft
        } else {
            return this.grid._getCellDom(this.colIndex, -1, this.grid.contentTable).offsetLeft
        }
    },
    getTop: function() {
        if (this.td && this.grid.util.getStyle(this.td, "display") != "none") {
            return this.td.offsetTop
        } else {
            return this.grid._getCellDom(-1, this.rowIndex, this.grid.contentTable).offsetTop
        }
    },
    getRelativeLocation: function() {
        return {
            x: this.getLeft() - this.grid.getScrollLeft(),
            y: this.getTop() - this.grid.getScrollTop()
        }
    },
    getHeight: function() {
        if (this.td && this.grid.util.getStyle(this.td, "display") != "none") {
            return this.td.offsetHeight
        } else {
            return this.grid._getCellDom(-1, this.rowIndex, this.grid.contentTable).offsetHeight
        }
    },
    getWidth: function() {
        if (this.td && this.grid.util.getStyle(this.td, "display") != "none") {
            return this.td.offsetWidth
        } else {
            return this.grid._getCellDom(this.colIndex, -1, this.grid.contentTable).offsetWidth
        }
    },
    getComputedWidth: function() {
        var d = this.getColSpan();
        var a = this.getColIndex();
        var c = 0;
        for (var b = 0; b < d; b++) {
            if (!this.grid.getColHidden(a + b)) {
                c += parseInt(this.grid._getCellDom(a + b, -1, this.grid.contentTable).style.width)
            }
        }
        return c
    },
    getComputedHeight: function() {
        var c = this.getRowSpan();
        var d = this.getRowIndex();
        var a = 0;
        for (var b = 0; b < c; b++) {
            if (!this.grid.getRowHidden(d + b)) {
                a += parseInt(this.grid._getCellDom(-1, d + b, this.grid.contentTable).style.height)
            }
        }
        return a
    },
    getRowIndex: function() {
        return this.rowIndex
    },
    getColIndex: function() {
        return this.colIndex
    },
    setRowSpan: function(a) {},
    getRowSpan: function() {
        if (this.td.rrs) {
            return parseInt(this.td.rrs)
        }
        if (this.td.rowSpan) {
            var a = 0;
            if (DNA.engine.Client.isFF()) {
                for (var b = this.getRowIndex() + 1; b < this.getRowIndex() + this.td.rowSpan; b++) {
                    if (this.grid.util.getStyle(this.grid._getRowDom(b, this.td.parentNode.parentNode.parentNode), "display") == "none") {
                        a++
                    }
                }
            }
            return this.td.rowSpan + a
        }
        return 1
    },
    setColSpan: function(a) {},
    getRealRowSpan: function() {
        if (this.td.rowSpan) {
            return this.td.rowSpan
        }
        return 1
    },
    isVertText: function() {
        return !!this.td.getAttribute("vt")
    },
    getColSpan: function() {
        if (this.td.colSpan) {
            return this.td.colSpan
        }
        return 1
    },
    getEditable: function() {
        var b = this.getAttribute(this.td, "ea");
        var a = this.getAttribute(this.td, "ci");
        if (b == 0 || a) {
            return false
        }
        return true
    },
    getSelectable: function(c) {
        if (this.grid.getRowHidden(this.rowIndex) || this.grid.getColHidden(this.colIndex)) {
            return false
        }
        var b = this.getAttribute(this.td, "sa");
        if (b == 0) {
            return false
        }
        return true
    },
    getEditorFace: function() {
        if (!this.getEditable()) {
            return 0
        }
        return this.getAttribute(this.td, "ef")
    },
    setAttribute: function(c, a, b) {
        if (c) {
            c.setAttribute(a, b)
        }
    },
    getAttribute: function(b, a) {
        if (b) {
            return b.getAttribute(a)
        }
        return null 
    },
    removeAttribute: function(b, a) {
        if (b) {
            b.removeAttribute(a)
        }
    },
    setEditorCtr: function(a) {
        this.editorCtr = a
    },
    getEditorCtr: function() {
        return this.editorCtr
    },
    parseHtml: function(a) {
        if (!a || "" == a) {
            return a
        }
        var b = a.replace(/&nbsp;/g, " ").replace(/&#39;/g, "'").replace(/&quot;/g, '"').replace(/<br>/g, "\r\n").replace(/&lt;/g, "<").replace(/&gt;/g, ">").replace(/&amp;/g, "&");
        return b
    },
    parseStr2Html: function(b) {
        if (!b || "" == b) {
            return b
        }
        var a = b.replace(/&/g, "&amp;").replace(/ /g, "&nbsp;").replace(/'/g, "&#39;").replace(/\"/g, "&quot;").replace(/\\r\\n/g, "<br>").replace(/</g, "&lt;").replace(/>/g, "&gt;");
        return a
    }
});
DNA.widget.AbstractGridCell = function(a, n, m, l, b) {
    DNA.widget.AbstractGridCell.superclass.constructor.call(this, a, m, l);
    this.table = n;
    if (!n) {
        if (m < a.hColCount && l < a.hRowCount) {
            this.table = a.hltTab
        } else {
            if (m < a.hColCount) {
                this.table = a.hcTable
            } else {
                if (l < a.hRowCount) {
                    this.table = a.hrTable
                } else {
                    this.table = a.contentTable
                }
            }
        }
    }
    if (b) {
        this.td = this.table.rows[l + 1].cells[m + 1];
        this.colIndex = m;
        this.rowIndex = l
    } else {
        for (var g = m; g >= 0; g--) {
            for (var d = l; d >= 0; d--) {
                var h = this.grid._getCellDom(g, d, this.table);
                if (this.grid.util.getStyle(h, "display") != "none") {
                    var c;
                    if (h.rrs) {
                        c = parseInt(h.rrs)
                    } else {
                        if (h.rowSpan) {
                            c = h.rowSpan
                        } else {
                            c = 1
                        }
                    }
                    var o;
                    if (h.colSpan) {
                        o = h.colSpan
                    } else {
                        o = 1
                    }
                    if (d + c <= l || g + o <= m) {
                        break
                    }
                    this.td = h;
                    this.rowIndex = d;
                    this.colIndex = g
                }
            }
        }
        if (!this.td) {
            this.td = this.table.rows[l + 1].cells[m + 1]
        }
    }
}
;
DNA.widget.AbstractGridCell.extend(DNA.widget.IGridCell, {});
DNA.widget.GridCell = function(b, a, c) {
    DNA.widget.GridCell.superclass.constructor.call(this, b, a, c);
    this.rowIndex = c;
    this.colIndex = a;
    this.table = b.contentTable;
    this.td = this.grid._getCellDom(a, c, this.table);
    this.ensureCellType()
}
;
DNA.widget.GridCell.extend(DNA.widget.IGridCell, {
    ensureCellType: function() {
        if (this.x === 0) {
            this.type = DNA.widget.JWTGrid.CELL_ROWTITLE;
            if (this.y < this.grid.hRowCount) {
                this.isLock = true
            }
            return
        }
        if (this.y === 0) {
            this.type = DNA.widget.JWTGrid.CELL_COLTITLE;
            if (this.x < this.grid.hColCount) {
                this.isLock = true
            }
            return
        }
        if (this.x < this.grid.hColCount && this.y < this.grid.hRowCount) {
            this.type = DNA.widget.JWTGrid.CELL_HEADERLOCK
        } else {
            if (this.x < this.grid.hColCount) {
                this.type = DNA.widget.JWTGrid.CELL_HEADERCOL
            } else {
                if (this.y < this.grid.hRowCount) {
                    this.type = DNA.widget.JWTGrid.CELL_HEADERROW
                }
            }
        }
    },
    setClientData: function(b) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        if (typeof (b) != "string") {
            b = DNA.engine.JsonUtil.encode(b)
        }
        var a = this.parseStr2Html(b);
        this.setAttribute(this.td, "cd", a);
        this.setterHelper(this._setClientData, a)
    },
    _setClientData: function(b, a) {
        this.setAttribute(b, "cd", a)
    },
    setTopBorderStyle: function(a) {},
    setLeftBorderStyle: function(a) {},
    setRightBorderStyle: function(a) {
        if (a === "auto") {
            this.setRightBorderColor("");
            this.setterHelper2(this._setRightBorderStyle, a);
            return
        }
        this._setRightBorderStyle(this.td, a);
        this.setterHelper(this._setRightBorderStyle, a)
    },
    setBottomBorderStyle: function(a) {
        if (a === "auto") {
            this.setBottomBorderColor("");
            this.setterHelper2(this._setBottomBorderStyle, a);
            return
        }
        this._setBottomBorderStyle(this.td, a);
        this.setterHelper(this._setBottomBorderStyle, a)
    },
    _setTopBorderStyle: function(b, a) {},
    _setLeftBorderStyle: function(b, a) {},
    _setRightBorderStyle: function(b, a) {
        if (a === "auto") {
            b.style.borderRightStyle = "";
            return
        }
        b.style.borderRightStyle = a
    },
    _setBottomBorderStyle: function(b, a) {
        if (a === "auto") {
            b.style.borderBottomStyle = "";
            return
        }
        b.style.borderBottomStyle = a
    },
    setTopBorderColor: function(a) {},
    setLeftBorderColor: function(a) {},
    setRightBorderColor: function(a) {
        this._setRightBorderColor(this.td, a);
        this.setterHelper(this._setRightBorderColor, a)
    },
    setBottomBorderColor: function(a) {
        this._setBottomBorderColor(this.td, a);
        this.setterHelper(this._setBottomBorderColor, a)
    },
    _setTopBorderColor: function(b, a) {},
    _setLeftBorderColor: function(b, a) {},
    _setRightBorderColor: function(b, a) {
        if (this.x == 0 || this.y == 0) {
            this.setAttribute(b, "rbc", a)
        }
        b.style.borderRightColor = a
    },
    _setBottomBorderColor: function(b, a) {
        if (this.x == 0 || this.y == 0) {
            this.setAttribute(b, "bbc", a)
        }
        b.style.borderBottomColor = a
    },
    setBorderStyle: function(a) {},
    setBorderColor: function(a) {},
    setVertAlign: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        this._setVertAlign(this.td, a);
        this.setterHelper2(this._setVertAlign, a)
    },
    _setVertAlign: function(b, a) {
        b.style.verticalAlign = a
    },
    setHorzAlign: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        this._setHorzAlign(this.td, a);
        this.setterHelper2(this._setHorzAlign, a)
    },
    _setHorzAlign: function(b, a) {
        b.style.textAlign = a
    },
    setWrapLine: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        if (a) {
            a = "break-word"
        } else {
            a = "normal"
        }
        this._setWrapLine(this.td, a);
        this.setterHelper2(this._setWrapLine, a)
    },
    _setWrapLine: function(g, b) {
        g.style.wordWrap = b;
        if (b === "break-word") {
            g.style.whiteSpace = "normal"
        } else {
            g.style.whiteSpace = "nowrap"
        }
        if (!(DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict()))) {
            if (b === "break-word") {
                if (g.childNodes.length == 1 && g.childNodes[0].nodeType == 3) {
                    g.setAttribute("wl", "1");
                    var d = g.ownerDocument.createElement("div");
                    var c = g.firstChild;
                    d.appendChild(c);
                    var a = this.grid.getRowHeightFromStyle(this.getRowIndex());
                    d.style.height = (this.grid.util.getWrapTextHeight(this.getColIndex(), this.getRowIndex()) > (a - 1)) ? (Math.max((a - 1), 0) + "px") : "";
                    g.appendChild(d)
                }
            } else {
                if (g.getAttribute("wl") == "1") {
                    g.removeAttribute("wl");
                    if (g.firstChild && g.firstChild.firstChild) {
                        g.appendChild(g.firstChild.firstChild)
                    }
                    if (g.firstChild) {
                        g.removeChild(g.firstChild)
                    }
                }
            }
        }
    },
    setVertText: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        if (!DNA.engine.Client.isIE()) {
            return
        }
        this._setVertText(this.td, a);
        this.setterHelper2(this._setVertText, a)
    },
    _setVertText: function(b, a) {
        if (a) {
            b.style.writingMode = "tb-rl"
        } else {
            b.style.writingMode = "lr-tb"
        }
    },
    setSelectable: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        if (a) {
            this.setAttribute(this.td, "sa", 1);
            this.setterHelper2(this._setSelectable, 1)
        } else {
            this.setAttribute(this.td, "sa", 0);
            this.setterHelper2(this._setSelectable, 0)
        }
    },
    _setSelectable: function(b, a) {
        if (a) {
            this.setAttribute(b, "sa", 1)
        } else {
            this.setAttribute(b, "sa", 0)
        }
    },
    setEditable: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        if (a) {
            this.setAttribute(this.td, "ea", 1);
            this._updateEditorFace(true);
            this.setterHelper2(this._setEditable, 1)
        } else {
            this.grid.ensureEditorClose(this, true);
            this.setAttribute(this.td, "ea", 0);
            this._updateEditorFace(false);
            this.setterHelper2(this._setEditable, 0)
        }
    },
    _setEditable: function(b, a) {
        if (a) {
            this.setAttribute(b, "ea", 1)
        } else {
            this.setAttribute(b, "ea", 0)
        }
    },
    _updateEditorFace: function(a) {
        var b = this.grid.getCurrentCell();
        if (b && b.x == this.getColIndex() && b.y == this.getRowIndex()) {
            if (a) {
                if (this.grid.getEditMode() !== DNA.widget.JWTGrid2.EDIT_MODE_READONLY) {
                    this.grid._showFace()
                }
            } else {
                this.grid._hideFace()
            }
        }
    },
    setIndent: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        this._setIndent(this.td, a);
        this.setterHelper2(this._setIndent, a)
    },
    _setIndent: function(b, a) {
        b.style.textIndent = a + "px"
    },
    setFont: function(a) {
        this._setFont(this.td, a);
        this.setterHelper(this._setFont, a)
    },
    setFontStyle: function(a) {
        this._setFontStyle(this.td, a);
        this.setterHelper(this._setFontStyle, a)
    },
    _setFontStyle: function(b, a) {
        if (a.style) {
            b.style.fontStyle = a.style
        } else {
            b.style.fontStyle = ""
        }
        if (a.weight) {
            b.style.fontWeight = a.weight
        } else {
            b.style.fontWeight = ""
        }
        if (a.decoration) {
            b.style.textDecoration = a.decoration
        } else {
            b.style.textDecoration = ""
        }
    },
    _setFont: function(b, a) {
        if (a.family) {
            b.style.fontFamily = a.family
        }
        if (a.size) {
            b.style.fontSize = parseInt(a.size, 10) + "pt"
        }
        if (a.style) {
            b.style.fontStyle = a.style
        } else {
            b.style.fontStyle = ""
        }
        if (a.weight) {
            b.style.fontWeight = a.weight
        } else {
            b.style.fontWeight = ""
        }
        if (a.decoration) {
            b.style.textDecoration = a.decoration
        } else {
            b.style.textDecoration = ""
        }
    },
    setEditor: function(a, b) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        this.setAttribute(this.td, "ei", a);
        if (b) {
            this.setAttribute(this.td, "ef", b)
        }
        this.setterHelper(this._setEditor, a)
    },
    _setEditor: function(b, a) {
        this.setAttribute(b, "ei", a)
    },
    setForeground: function(a) {
        this._setForeground(this.td, a);
        this.setterHelper(this._setForeground, a)
    },
    _setForeground: function(b, a) {
        b.style.color = a
    },
    setShowImage: function(b, a) {
        this.setAttribute(this.td, "st", "image://");
        this.setAttribute(this.td, "et", b);
        if (!a) {
            this.grid.fireDataChangeEvent({
                x: this.x,
                y: this.y,
                width: this.x,
                height: this.y
            }, 0)
        }
        this._setShowImage(this.td, b);
        this.setterHelper(this._setShowImage, b)
    },
    _setShowImage: function(b, a) {
        b.style.backgroundImage = "url(" + DNA.widget.ImageDescriptor.getUrl(a) + ")"
    },
    setHtml: function(a) {
        this._setHtml(this.td, a);
        this.setterHelper(this._setHtml, a)
    },
    _setHtml: function(c, a) {
        var b = c;
        if (!(DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) && c.getAttribute("wl")) {
            b = c.firstChild
        }
        b.innerHTML = a
    },
    setBackground: function(a) {
        this._setBackground(this.td, a);
        this.setterHelper(this._setBackground, a)
    },
    _setBackground: function(b, a) {
        if (this.x == 0 || this.y == 0) {
            this.setAttribute(b, "bgc", a)
        }
        b.style.backgroundColor = a
    },
    setRowSpan: function(a) {
        this._setRowSpan(this.td, a);
        this.setterHelper(this._setRowSpan, a)
    },
    _setRowSpan: function(b, a) {
        b.rowSpan = a
    },
    setColSpan: function(a) {
        this._setColSpan(this.td, a);
        this.setterHelper(this._setColSpan, a)
    },
    _setColSpan: function(b, a) {
        b.colSpan = a
    },
    setSilverHead: function(a) {
        if (a) {
            this.setBackground("#ece9d8")
        } else {
            var b = this.getBackground();
            if (b == "#ece9d8") {
                this.setBackground("")
            }
        }
    },
    setBackStyle: function(a) {
        if (a === "auto") {
            this.setBackground("")
        }
    },
    setEditText: function(c, b, a) {
        if (this.getShowText() === "image://") {
            this.grid.util.convertCellCSSFromClass2Style(this.grid, this.getColIndex(), this.getRowIndex());
            this.setShowImage(c)
        } else {
            if (this.getShowText() === "html://") {
                this.setHtml(c);
                c = "html://"
            }
        }
        c = this.parseStr2Html(c);
        this.setAttribute(this.td, "et", c);
        if (!b) {
            this.grid.fireDataChangeEvent({
                x: this.x,
                y: this.y,
                width: this.x,
                height: this.y
            }, 0)
        }
        this.setterHelper2(this._setEditText, c);
        if (a) {
            this.grid.reInitEditor(this)
        }
    },
    _setEditText: function(c, b, a) {
        this.setAttribute(c, "et", b)
    },
    setFormatter: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        this.setAttribute(this.td, "fi", a);
        this.setterHelper(this._setFormatter, a)
    },
    _setFormatter: function(b, a) {
        this.setAttribute(b, "fi", a)
    },
    setShowText: function(d, c, a) {
        if (d == "image://" || d == "html://") {
            this.setAttribute(this.td, "st", d);
            return
        }
        var b = this.td.style.backgroundColor;
        this.td.style.backgroundColor = "#ff0000";
        this.td.style.backgroundColor = b;
        this.td.style.backgroundImage = "";
        this._setShowText(this.td, d);
        if (!c) {
            this.grid.fireDataChangeEvent({
                x: this.x,
                y: this.y,
                width: this.x,
                height: this.y
            }, 0)
        }
        if (a) {
            this.setterHelper(this._setShowText2, d)
        } else {
            this.setterHelper(this._setShowText, d);
            this.grid.ensureHAndW(this)
        }
    },
    _setShowText2: function(b, a) {
        if (!a || a == "") {
            a = " "
        }
        this.setAttribute(b, "st", a)
    },
    _setShowText: function(c, b) {
        if (!b) {
            b = ""
        }
        if (this.getAttribute(c, "rhc")) {
            this.setAttribute(c, "st", b)
        } else {
            if (this.x === 0 || this.y === 0) {
                this.setAttribute(c, "st", b)
            } else {
                this.removeAttribute(c, "st")
            }
            if (this.grid.ensureEditorClose(this)) {
                var a = c;
                if (!(DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) && c.getAttribute("wl")) {
                    a = c.firstChild
                }
                if (b.indexOf("\n") > 0) {
                    this.setAttribute(c, "st", b);
                    a.innerHTML = b.replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/\n/g, "<br>").replace(/ /g, "&nbsp;")
                } else {
                    if (DNA.engine.Client.isIE()) {
                        DNA.engine.DomUtil.setInnerText(a, b === "" ? " " : b)
                    } else {
                        a.innerHTML = (this.grid.util.getNBSPString(b)).replace(/</g, "&lt;").replace(/>/g, "&gt;")
                    }
                }
            } else {
                if (!b || b == "") {
                    b = " "
                }
                this.setAttribute(c, "st", b)
            }
        }
        if (c.getAttribute("wl") == "1") {
            this.__resizeWraplineDiv(c)
        }
    },
    _resizeWraplineDiv: function() {
        var a = this.__resizeWraplineDiv(this.td);
        this.setterHelper(this.__resizeWraplineDiv, a)
    },
    __resizeWraplineDiv: function(m, a) {
        var g = 0;
        if (a !== undefined) {
            g = a
        } else {
            var c = this.getRowIndex();
            var b = c + parseInt(m.getAttribute("rowSpan"));
            b = isNaN(b) ? c + 1 : b;
            for (var l = c; l < b; l++) {
                var d = this.grid._getCellDom(-1, l, this.grid.contentTable);
                if (d.offsetHeight > 0) {
                    g += parseInt(d.style.height)
                } else {
                    if (b < this.grid.contentTable.rows.length - 1) {
                        ++b
                    }
                }
            }
        }
        if ((g - 1) < this.grid.util.getWrapTextHeight(this.getColIndex(), this.getRowIndex(), this.td.offsetWidth)) {
            m.firstChild.style.height = (g - 1) + "px"
        } else {
            m.firstChild.style.height = ""
        }
        return g
    },
    setterHelper: function(b, c) {
        var a = null ;
        switch (this.type) {
        case DNA.widget.JWTGrid.CELL_HEADERROW:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hrTable);
            b.apply(this, [a, c]);
            break;
        case DNA.widget.JWTGrid.CELL_HEADERCOL:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hcTable);
            b.apply(this, [a, c]);
            break;
        case DNA.widget.JWTGrid.CELL_HEADERLOCK:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hrTable);
            b.apply(this, [a, c]);
            a = this.grid._getCellDom(this.x, this.y, this.grid.hcTable);
            b.apply(this, [a, c]);
            a = this.grid._getCellDom(this.x, this.y, this.grid.hltTab);
            b.apply(this, [a, c]);
            break;
        case DNA.widget.JWTGrid.CELL_ROWTITLE:
            a = this.grid._getCellDom(0, this.y, this.grid.hcTable);
            b.apply(this, [a, c]);
            if (this.isLock) {
                a = this.grid._getCellDom(0, this.y, this.grid.hltTab);
                b.apply(this, [a, c])
            }
            break;
        case DNA.widget.JWTGrid.CELL_COLTITLE:
            a = this.grid._getCellDom(this.x, 0, this.grid.hrTable);
            b.apply(this, [a, c]);
            if (this.isLock) {
                a = this.grid._getCellDom(this.x, 0, this.grid.hltTab);
                b.apply(this, [a, c])
            }
            break;
        default:
            break
        }
    },
    setterHelper2: function(b, c) {
        var a = null ;
        switch (this.type) {
        case DNA.widget.JWTGrid.CELL_HEADERROW:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hrTable);
            b.apply(this, [a, c]);
            break;
        case DNA.widget.JWTGrid.CELL_HEADERCOL:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hcTable);
            b.apply(this, [a, c]);
            break;
        case DNA.widget.JWTGrid.CELL_HEADERLOCK:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hrTable);
            b.apply(this, [a, c]);
            a = this.grid._getCellDom(this.x, this.y, this.grid.hcTable);
            b.apply(this, [a, c]);
            a = this.grid._getCellDom(this.x, this.y, this.grid.hltTab);
            b.apply(this, [a, c]);
            break;
        default:
            break
        }
    }
});
DNA.widget.GridClipboard = {
    copyToClipboard: function(b) {
        try {
            if (DNA.engine.Client.isIE()) {
                window.clipboardData.clearData();
                window.clipboardData.setData("Text", b)
            } else {
                if (navigator.userAgent.indexOf("Opera") != -1) {
                    window.location = b
                } else {
                    if (window.netscape) {
                        try {
                            netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")
                        } catch (h) {
                            alert("����firefox��ȫ�������������м�������������'about:config'��signed.applets.codebase_principal_support'����Ϊtrue'֮������");
                            return false
                        }
                        var d = Components.classes["@mozilla.org/widget/clipboard;1"].createInstance(Components.interfaces.nsIClipboard);
                        if (!d) {
                            return
                        }
                        var c = Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable);
                        if (!c) {
                            return
                        }
                        c.addDataFlavor("text/unicode");
                        var l = new Object();
                        var a = new Object();
                        var l = Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString);
                        var m = b;
                        l.data = m;
                        c.setTransferData("text/unicode", l, m.length * 2);
                        var g = Components.interfaces.nsIClipboard;
                        if (!d) {
                            return false
                        }
                        d.setData(c, null , g.kGlobalClipboard)
                    }
                }
            }
        } catch (h) {}
    },
    getClipboard: function() {
        try {
            var c = this._getClipboard();
            var a = [];
            if (c) {
                for (var g = 0; g < c.length; ) {
                    var b = c.charCodeAt(g);
                    if ((b > 128 && b <= 160) || (b >= 8192 && b < 8448 && this._doNotContains(b))) {
                        if (g > 0) {
                            a.push(c.substring(0, g))
                        }
                        c = c.substring(g + 1, c.length);
                        g = 0
                    } else {
                        g++
                    }
                }
                var d = "";
                for (g = 0; g < a.size(); g++) {
                    d += a[g]
                }
                d += c;
                return d
            } else {
                return null 
            }
        } catch (h) {}
    },
    _getClipboard: function() {
        if (DNA.engine.Client.isIE()) {
            return ( window.clipboardData.getData("text")) 
        } else {
            if (window.netscape) {
                try {
                    netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
                    var c = Components.classes["@mozilla.org/widget/clipboard;1"].createInstance(Components.interfaces.nsIClipboard);
                    if (!c) {
                        return
                    }
                    var b = Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable);
                    if (!b) {
                        return
                    }
                    b.addDataFlavor("text/unicode");
                    c.getData(b, c.kGlobalClipboard);
                    var g = new Object();
                    var a = new Object();
                    b.getTransferData("text/unicode", g, a)
                } catch (d) {
                    alert("����firefox��ȫ�������������м�������������'about:config'��signed.applets.codebase_principal_support'����Ϊtrue'֮�����ԣ����·��Ϊfirefox��Ŀ¼/greprefs/all.js");
                    return null 
                }
                if (g) {
                    if (Components.interfaces.nsISupportsWString) {
                        g = g.value.QueryInterface(Components.interfaces.nsISupportsWString)
                    } else {
                        if (Components.interfaces.nsISupportsString) {
                            g = g.value.QueryInterface(Components.interfaces.nsISupportsString)
                        } else {
                            g = null 
                        }
                    }
                }
                if (g) {
                    return ( g.data.substring(0, a.value / 2)) 
                }
            }
        }
        return null 
    },
    _doNotContains: function(b) {
        var a = [[8220, 8221], [8216, 8217]];
        for (var d = 0; d < a.length; d++) {
            var g = a[d];
            for (var c = 0; c < g.length; c++) {
                if (g[c] == b) {
                    return false
                }
            }
        }
        return true
    }
};
DNA.widget.AbstractCellContent = function() {
    this.cellData = ""
}
;
DNA.widget.AbstractCellContent.extend(Object, {
    setShowText: function(a) {
        this.cellData = a
    },
    getShowText: function() {
        if (!this.cellData) {
            return ""
        }
        return this.cellData
    },
    setEditText: function(a) {
        this.cellData = a
    },
    getEditText: function() {
        if (!this.cellData) {
            return ""
        }
        return this.cellData
    }
});
DNA.widget.CommonCellContent = function(a, b) {
    DNA.widget.CommonCellContent.superclass.constructor.call();
    this.showText = a;
    this.editText = b
}
;
DNA.widget.CommonCellContent.extend(Object, {
    setShowText: function(a) {
        this.showText = a
    },
    getShowText: function() {
        if (!this.showText) {
            return ""
        }
        return this.showText
    },
    setEditText: function(a) {
        this.editText = a
    },
    getEditText: function() {
        if (!this.editText) {
            return ""
        }
        return this.editText
    }
});
DNA.widget.JWTGrid = {
    SELECTION_MODE_MASK: 3,
    SELECTION_MODE_MULTI: 0,
    SELECTION_MODE_SINGLE: 1,
    SELECTION_MODE_ROW: 2,
    EDIT_MODE_MASK: 3 << 2,
    EDIT_MODE_DESIGN: 0 << 2,
    EDIT_MODE_INPUT: 1 << 2,
    EDIT_MODE_READONLY: 2 << 2,
    COL_RESIZE_MASK: 1 << 4,
    ROW_RESIZE_MASK: 1 << 5,
    COL_SELECT_MASK: 1 << 6,
    ROW_SELECT_MASK: 1 << 7,
    ROW_FREE_RESIZE_MASK: 1 << 14,
    COL_FREE_RESIZE_MASK: 1 << 15,
    ENTER_NEXT_MASK: 7 << 9,
    ENTER_NEXT_DOWN: 0 << 9,
    ENTER_NEXT_RIGHT: 1 << 9,
    ENTER_NEXT_UP: 2 << 9,
    ENTER_NEXT_LEFT: 3 << 9,
    ENTER_NEXT_NONE: 4 << 9,
    CA_DEFAULT: 0,
    CA_FORE: 1,
    CA_BACK: 2,
    CA_CENTER: 3,
    CA_SPARSE: 4,
    CA_JUSTIFIED: 5,
    CELL_COMMON: 0,
    CELL_ROWTITLE: 1,
    CELL_COLTITLE: 2,
    CELL_TITLELOCK: 3,
    CELL_HEADERROW: 4,
    CELL_HEADERCOL: 5,
    CELL_HEADERLOCK: 6,
    STATE_NORMAL: 0,
    STATE_CELL_SELECT: 1,
    STATE_ROW_SELECT: 2,
    STATE_COL_SELECT: 3,
    STATE_ROW_RESIZE: 4,
    STATE_COL_RESIZE: 5,
    STATE_OUT: 6,
    STATE_CELL_OPENEDITOR: 7,
    STATE_ALL_SELECT: 8,
    DATACHANGE_INPUT: 0,
    DATACHANGE_PASTE: 1,
    DATACHANGE_CUT: 2,
    DATACHANGE_DEL: 3,
    DATACHANGE_PROGRAM: 4,
    LEFT: 0,
    RIGHT: 1,
    UP: 2,
    DOWN: 3,
    UPDATE_SHOWTEXT: 0,
    UPDATE_EDITTEXT: 1,
    UPDATE_SERVERDATA: 2,
    UPDATE_SERVERDATA: 2,
    EDITOPEN_DBCLICK: 1,
    EDITOPEN_INPUT: 2,
    EDITOPEN_CLICKFACE: 3,
    EDITOPEN_PROGRAM: 4,
    GETRESULT_SERVERCELLCHANGE: 1,
    GETRESULT_SYN: 2,
    GETRESULT_CLIENTCELLCHANGE: 3,
    GETRESULT_CELLCHANGING: 4,
    VERTALIGN_TOP: "t",
    VERTALIGN_BOTTOM: "b",
    VERTALIGN_MIDDLE: "m",
    SETCURRENTCELLCAUSE_PROGRAM: 0,
    SETCURRENTCELLCAUSE_KEY: 1,
    SETCURRENTCELLCAUSE_BUTTON: 2
};
DNA.widget.GridUtil = function(a) {
    this.grid = a
}
;
DNA.widget.GridUtil.extend(Object, {
    getFirstCol: function(a) {
        for (var b = 1; b < this.grid.columnCount; ++b) {
            if (!this.grid.getColHidden(b)) {
                return b
            }
        }
        return -1
    },
    getLastCol: function(a) {
        for (var b = this.grid.columnCount - 1; b > 0; --b) {
            if (!this.grid.getColHidden(b)) {
                return b
            }
        }
        return -1
    },
    getTopRow: function(a) {
        for (var b = 1; b < this.grid.rowCount; ++b) {
            if (!this.grid.getRowHidden(b)) {
                return b
            }
        }
        return -1
    },
    getBottomRow: function(a) {
        for (var b = this.grid.rowCount - 1; b > 0; --b) {
            if (!this.grid.getRowHidden(b)) {
                return b
            }
        }
        return -1
    },
    getScrollFirstVisibleCol: function() {
        return -1
    },
    getScrollFirstVisibleRow: function() {
        return -1
    },
    getFirstCell: function(h, c) {
        if (!h) {
            h = this.getDataCellArea()
        }
        var d = this.getRightCol(h.x - 1);
        var l = this.getDownRow(h.y - 1);
        if (c) {
            d = Math.max(d, this.getScrollFirstVisibleCol());
            l = Math.max(l, this.getScrollFirstVisibleRow())
        }
        var b = new DNA.widget.Point(d,l);
        var a;
        var m;
        var g;
        while (b.y <= h.height) {
            while (b.x <= h.width) {
                a = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,b.x,b.y,false);
                m = a.getColIndex();
                g = a.getRowIndex();
                if (this.isCellSelectable(m, g)) {
                    b.x = m;
                    b.y = g;
                    return b
                }
                b.x = this.getRightCol(m + a.getColSpan() - 1)
            }
            b.x = d;
            b.y = this.getDownRow(b.y)
        }
        return null 
    },
    getLastCell: function(l, d) {
        if (!l) {
            l = this.getDataCellArea()
        }
        var c = this.getLeftCol(l.width + 1);
        var h = this.getUpRow(l.height + 1);
        if (d) {
            c = Math.min(c, this.getScrollLastVisibleCol());
            h = Math.min(h, this.getScrollLastVisibleRow())
        }
        var b = new DNA.widget.Point(c,h);
        var a;
        var m;
        var g;
        while (b.y >= l.y) {
            while (b.x >= l.x) {
                a = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,b.x,b.y,false);
                m = a.getColIndex();
                g = a.getRowIndex();
                if (this.isCellSelectable(m, g)) {
                    b.x = m;
                    b.y = g;
                    return b
                }
                b.x = this.getLeftCol(m)
            }
            b.x = c;
            b.y = this.getUpRow(b.y)
        }
        return null 
    },
    getLeftCell: function(d, m, h, b, c) {
        var n = new DNA.widget.Point(this.getLeftCol(d),m);
        var l;
        var g;
        var a;
        if (!h) {
            h = this.getDataCellArea()
        }
        while (n.y >= h.y) {
            while (n.x >= h.x) {
                l = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,n.x,n.y,false);
                g = l.getColIndex();
                a = l.getRowIndex();
                if (c) {
                    if (this.isCellEditable(g, a)) {
                        n.x = g;
                        return n
                    }
                } else {
                    if (this.isCellSelectable(g, a)) {
                        n.x = g;
                        return n
                    }
                }
                n.x = this.getLeftCol(g)
            }
            if (!b) {
                break
            }
            n.x = h.width;
            n.y = this.getUpRow(n.y)
        }
        return null 
    },
    getRightCell: function(d, m, h, b, c) {
        var n = new DNA.widget.Point(this.getRightCol(d),m);
        var l;
        var g;
        var a;
        if (!h) {
            h = this.getDataCellArea()
        }
        while (n.y <= h.height) {
            while (n.x <= h.width) {
                l = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,n.x,n.y,false);
                g = l.getColIndex();
                a = l.getRowIndex();
                if ((a != m) || (g != d)) {
                    if (c) {
                        if (this.isCellEditable(g, a)) {
                            return n
                        }
                    } else {
                        if (this.isCellSelectable(g, a)) {
                            return n
                        }
                    }
                }
                n.x = this.getRightCol(g + l.getColSpan() - 1)
            }
            if (!b) {
                break
            }
            n.x = h.x;
            n.y = this.getDownRow(n.y)
        }
        return null 
    },
    getUpCell: function(d, m, h, b, c) {
        var n = new DNA.widget.Point(d,this.getUpRow(m));
        var l;
        var g;
        var a;
        if (!h) {
            h = this.getDataCellArea()
        }
        while (n.x >= h.x) {
            while (n.y >= h.y) {
                l = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,n.x,n.y,false);
                g = l.getColIndex();
                a = l.getRowIndex();
                if (c) {
                    if (this.isCellEditable(g, a)) {
                        return n
                    }
                } else {
                    if (this.isCellSelectable(g, a)) {
                        return n
                    }
                }
                n.y = this.getUpRow(a)
            }
            if (!b) {
                break
            }
            n.y = h.height;
            n.x = this.getLeftCol(n.x)
        }
        return null 
    },
    getDownCell: function(d, m, h, b, c) {
        var n = new DNA.widget.Point(d,this.getDownRow(m));
        var l;
        var g;
        var a;
        if (!h) {
            h = this.getDataCellArea()
        }
        while (n.x <= h.width) {
            while (n.y <= h.height) {
                l = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,n.x,n.y,false);
                g = l.getColIndex();
                a = l.getRowIndex();
                if ((a != m) || (g != d)) {
                    if (c) {
                        if (this.isCellEditable(g, a)) {
                            return n
                        }
                    } else {
                        if (this.isCellSelectable(g, a)) {
                            return n
                        }
                    }
                }
                n.y = this.getDownRow(a + l.getRowSpan() - 1)
            }
            if (!b) {
                break
            }
            n.y = h.y;
            n.x = this.getRightCol(n.x)
        }
        return null 
    },
    getLeftCol: function(a) {
        var b = a - 1;
        while (this.isDataCol(b) && this.grid.getColHidden(b)) {
            b--
        }
        return b
    },
    getRightCol: function(a) {
        var b = a + 1;
        while (this.isDataCol(b) && this.grid.getColHidden(b)) {
            b++
        }
        return b
    },
    getUpRow: function(b) {
        var a = b - 1;
        while (this.isDataRow(a) && this.grid.getRowHidden(a)) {
            a--
        }
        return a
    },
    getDownRow: function(b) {
        var a = b + 1;
        while (this.isDataRow(a) && this.grid.getRowHidden(a)) {
            a++
        }
        return a
    },
    getRowFirstCell: function(h, d, m) {
        var c = new DNA.widget.Point(this.getFirstCol(d),h);
        var b = this.getLastCol(d);
        var a;
        var l;
        var g;
        while (c.x <= b) {
            a = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,c.x,c.y,false);
            l = a.getColIndex();
            g = a.getRowIndex();
            if (m) {
                if (this.isCellEditable(l, g)) {
                    return c
                }
            } else {
                if (this.isCellSelectable(l, g)) {
                    return c
                }
            }
            c.x = this.getRightCol(l + a.getColSpan() - 1)
        }
        return null 
    },
    getRowLastCell: function(h, c, m) {
        var b = new DNA.widget.Point(this.getLastCol(c),h);
        var d = this.getFirstCol(c);
        var a;
        var l;
        var g;
        while (b.x >= d) {
            a = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,b.x,b.y,false);
            l = a.getColIndex();
            g = a.getRowIndex();
            if (m) {
                if (this.isCellEditable(l, g)) {
                    return b
                }
            } else {
                if (this.isCellSelectable(l, g)) {
                    return b
                }
            }
            b.x = this.getLeftCol(l)
        }
        return null 
    },
    getColFirstCell: function(d, c, m) {
        var b = new DNA.widget.Point(d,this.getTopRow(c));
        var h = this.getBottomRow(c);
        var a;
        var l;
        var g;
        while (b.y <= h) {
            a = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,b.x,b.y,false);
            l = a.getColIndex();
            g = a.getRowIndex();
            if (m) {
                if (this.isCellEditable(l, g)) {
                    return b
                }
            } else {
                if (this.isCellSelectable(l, g)) {
                    return b
                }
            }
            b.y = this.getDownRow(g + a.getRowSpan() - 1)
        }
        return null 
    },
    getColLastCell: function(d, c, m) {
        var b = new DNA.widget.Point(d,this.getBottomRow(c));
        var h = this.getTopRow(c);
        var a;
        var l;
        var g;
        while (b.y >= h) {
            a = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,b.x,b.y,false);
            l = a.getColIndex();
            g = a.getRowIndex();
            if (m) {
                if (this.isCellEditable(l, g)) {
                    return b
                }
            } else {
                if (this.isCellSelectable(l, g)) {
                    return b
                }
            }
            b.y = this.getUpRow(g)
        }
        return null 
    },
    getDataCellArea: function() {
        return new DNA.widget.Rectangle(1,1,this.grid.columnCount - 1,this.grid.rowCount - 1)
    },
    isCellSelectable: function(b, c) {
        if (this.isDataCell(b, c)) {
            if (this.grid.getEditMode() == DNA.widget.JWTGrid.EDIT_MODE_DESIGN) {
                return true
            } else {
                var a = this.grid.getCell(b, c);
                return a.getSelectable()
            }
        }
        return false
    },
    isCellEditable: function(b, c) {
        if (this.isDataCell(b, c)) {
            var a = this.grid.getCell(b, c);
            if (this.grid.getEditMode() == DNA.widget.JWTGrid.EDIT_MODE_DESIGN) {
                if ("html://" == a.getEditText()) {
                    return false
                }
                return true
            } else {
                return a.getEditable()
            }
        }
        return false
    },
    isDataCell: function(a, b) {
        return this.isDataCol(a) && this.isDataRow(b)
    },
    isDataCol: function(a) {
        return a > 0 && a < this.grid.columnCount
    },
    isDataRow: function(a) {
        return a > 0 && a < this.grid.rowCount
    },
    parseHtml: function(a) {
        if (!a || "" == a) {
            return a
        }
        var b = a.replace(/&nbsp;/g, " ").replace(/&#39;/g, "'").replace(/&quot;/g, '"').replace(/<br>/g, "\r\n").replace(/&lt;/g, "<").replace(/&gt;/g, ">").replace(/&amp;/g, "&");
        return b
    },
    parseStr2Html: function(b) {
        if (!b || "" == b) {
            return b
        }
        var a = b.replace(/ /g, "&nbsp;").replace(/'/g, "&#39;").replace(/\"/g, "&quot;").replace(/\\r\\n/g, "<br>").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/&/g, "&amp;");
        return a
    },
    getRowAutoHeight: function(c) {
        var b = this.grid._getRowDom(c, this.grid.contentTable);
        var a = b.cells[0];
        if (a.getAttribute("ah")) {
            return true
        }
        return false
    },
    getColAutoWidth: function(b) {
        var a = this.grid._getCellDom(b, -1, this.grid.contentTable);
        if (a.getAttribute("aw")) {
            return true
        }
        return false
    },
    getNBSPString: function(a) {
        return a.replace(/ /g, "&nbsp;")
    },
    getNormalSpaceString: function(a) {
        var b = String.fromCharCode(160);
        return a.replace(new RegExp(b,"g"), String.fromCharCode(32))
    },
    getWrapTextHeight: function(c, l, h) {
        var b = this.grid.getCell(c, l);
        var g = h ? h : this.grid.getColumnWidth(c);
        if (g > 5) {
            g -= 5
        }
        var a = b.getFont();
        a.setSize(parseInt(a.getSize(), 10));
        var d = DNA.engine.DomUtil.getFoldedTextInf(b.getShowText(), a, g, DNA.engine.DomUtil.WRAP_CHAR.HTML);
        return d.height
    },
    computeFoldedTextHeight: (function() {
        var a = null ;
        return function(d, b, c) {
            if (a == null ) {
                a = document.createElement("span");
                a.style.whiteSpace = "normal";
                a.style.wordWrap = "break-word";
                a.style.wordBreak = "break-all";
                a.style.display = "block";
                a.style.visibility = "hidden";
                a.style.paddingLeft = "2px";
                a.style.paddingRight = "2px";
                a.style.borderRight = "1px solid white";
                a.style.borderBottom = "1px solid white";
                document.body.appendChild(a)
            }
            a.style.width = c - 5 + "px";
            a.innerHTML = d;
            DNA.engine.DomUtil.setFont(a, b);
            return a.offsetHeight
        }
    })(),
    computeUnfoldedTextSize: (function() {
        var a = null ;
        return function(d, b) {
            if (a == null ) {
                a = document.createElement("span");
                a.style.visibility = "hidden";
                document.body.appendChild(a)
            }
            a.innerHTML = d;
            DNA.engine.DomUtil.setFont(a, b);
            var c = DNA.engine.DomUtil.getSize(a);
            return c
        }
    })(),
    convertCellCSSFromClass2Style: function(d, a, g) {
        var c = [];
        if (d.contentTable) {
            c.push(d.contentTable)
        }
        if (d.hrTable) {
            c.push(d.hrTable)
        }
        if (d.hcTable) {
            c.push(d.hcTable)
        }
        if (d.hltTab) {
            c.push(d.hltTab)
        }
        if (d.frTable) {
            c.push(d.frTable)
        }
        if (d.fcTable) {
            c.push(d.fcTable)
        }
        if (d.frbTab) {
            c.push(d.frbTab)
        }
        if (d.flbTab) {
            c.push(d.flbTab)
        }
        if (d.hrtTab) {
            c.push(d.hrtTab)
        }
        for (var b = 0; b < c.length; b++) {
            this.convertCSSFromClass2Style(this._getCellDomNoAlert(a, g, c[b], d))
        }
    },
    convertCSSFromClass2Style: function(d, p) {
        if (!d) {
            return
        }
        try {
            var a = p ? p : this.getDocumentOfElement(d);
            var q = a.styleSheets;
            for (var h = 0; h < q.length; h++) {
                var o = q[h];
                if (!o.href) {
                    var s = (DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) ? o.rules : o.cssRules;
                    for (var g = 0; g < s.length; g++) {
                        var t = s[g].selectorText;
                        t = t.substring(1, t.length);
                        if (DNA.engine.DomUtil.hasClass(d, t)) {
                            if ((DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) ) {
                                var b = o.cssText;
                                if (b) {
                                    var r = b.substring(b.indexOf(t) + t.length, b.length);
                                    r = r.substring(r.indexOf("{") + 1, r.indexOf("}") - 1);
                                    var n = r.split(";");
                                    for (var c = 0; c < n.length; c++) {
                                        var m = n[c].substring(0, n[c].indexOf(":")).trim();
                                        this._setProperty(d, m, this._getProperty(s[g], m))
                                    }
                                }
                            } else {
                                for (var c = 0; s[g].style[c]; c++) {
                                    var m = s[g].style[c];
                                    this._setProperty(d, m, this._getProperty(s[g], m))
                                }
                            }
                            DNA.engine.DomUtil.removeClass(d, t);
                            break
                        }
                    }
                }
            }
        } catch (l) {}
    },
    _setProperty: function(c, a, b) {
        if ((DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) ) {
            c.style.setAttribute(this._getCamalCase(a), b)
        } else {
            if (a == "border-right-color-value") {
                a = "border-right-color"
            }
            if (a == "border-right-style-value") {
                a = "border-right-style"
            }
            c.style.setProperty(a, b, "")
        }
    },
    _getProperty: function(b, a) {
        if ((DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) ) {
            return b.style.getAttribute(this._getCamalCase(a))
        } else {
            return b.style.getPropertyValue(a)
        }
    },
    _getCamalCase: function(b) {
        var d = b.toLowerCase().split("-");
        for (var c = 1; c < d.length; c++) {
            var a = d[c].charAt(0).toUpperCase();
            d[c] = a + d[c].substring(1, d[c].length)
        }
        return d.join("")
    },
    _getCssRuleText: function(b) {
        var a;
        if ((DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) ) {
            a = b.style.cssText
        } else {
            a = b.cssText;
            a = a.substring(a.indexOf("{") + 1, a.length - 1)
        }
        return a
    },
    getDocumentOfElement: function(a) {
        if (a) {
            if (a.tagName.toLowerCase() == "iframe") {
                return a.contentWindow.document
            } else {
                if (a.tagName.toLowerCase() == "html") {
                    return a.parentNode
                } else {
                    if (a.parentNode) {
                        return this.getDocumentOfElement(a.parentNode)
                    } else {
                        return document
                    }
                }
            }
        }
    },
    getNearestIframeOfDom: function(a) {
        if (a) {
            return a.ownerDocument.ownerIframe
        }
    },
    getStyle: function(a, b) {
        if (a.currentStyle) {
            return a.currentStyle[b]
        } else {
            if (window.getComputedStyle) {
                if (b == "fontSize") {
                    this.grid.util.convertCSSFromClass2Style(a);
                    if (a.style.fontSize) {
                        return a.style.fontSize
                    } else {
                        return document.defaultView.getComputedStyle(a, null )[b]
                    }
                } else {
                    if (DNA.engine.Client.isFF() && DNA.engine.Client.getBrowserVersion() < 4) {
                        this.grid.util.convertCSSFromClass2Style(a)
                    }
                    return document.defaultView.getComputedStyle(a, null )[b]
                }
            }
        }
        return null 
    },
    _getCellDomNoAlert: function(b, g, c, d) {
        if (!d.checkRendered(true)) {
            return
        }
        var a = null ;
        if (c && c.rows && c.rows[g + 1]) {
            a = c.rows[g + 1].cells[b + 1]
        }
        return a
    },
    rectEqual: function(b, a) {
        return ( b.x === a.x && b.y === a.y && b.width === a.width && b.height === a.height) 
    },
    rebuildChildrenElements: function(g) {
        if (g.initFlag) {
            return
        }
        var c = g.getChildren();
        for (var b = 0, a = c.length; b < a; b++) {
            var d = c[b];
            if (d.el) {
                d.fireEvent("elRebuild");
                d.el = d._buildEl()
            }
            if (!d.checkRendered(false)) {
                d.fireEvent("elementsRebuild");
                d._buildElements()
            }
            if (d.getChildren) {
                if (d.getChildren()) {
                    this.rebuildChildrenElements(d)
                }
            }
        }
    },
    rebuildControl: function(g) {
        g._buildElements();
        if (g.getChildren) {
            var d = g.getChildren();
            if (d) {
                var a = d.length;
                for (var b = 0; b < a; b++) {
                    this.rebuildControl(d[b])
                }
            }
        }
    }
});
DNA.widget.CellFormatterMgr = function() {
    this.formatters = null ;
    this.init()
}
;
DNA.widget.CellFormatterMgr.extend(Object, {
    init: function() {
        this.formatters = {}
    },
    getFormatter: function(a) {
        return this.formatters[a]
    },
    addFormatter: function(b, a) {
        this.formatters[b] = a
    },
    removeFormatter: function(a) {
        if (this.formatters[a]) {
            delete this.formatters[a]
        }
    }
});
DNA.widget.GridGC = function(a) {
    DNA.widget.GridGC.superclass.constructor.call(this, a);
    this._doInit();
    this.util = new DNA.widget.GridUtil(this)
}
;
DNA.widget.GridGC.extend(DNA.widget.Composite, {
    autoRender: true,
    _defaultBorder: new DNA.widget.Border(1,"gray","solid"),
    _initFormatter: function() {
        var a = this.getInitData()[DNA.JWTProperty.PROPERTY_FORMATTER];
        this.formatterMgr = new DNA.widget.CellFormatterMgr();
        this._addFormatters(a)
    },
    getBody: function() {
        if (this.checkRendered(true)) {
            return this.tDiv
        }
    },
    _addFormatters: function(c) {
        if (c) {
            var a = c.length;
            for (var b = 0; b < a; ++b) {
                if (c[b]) {
                    this.formatterMgr.addFormatter(c[b].id, this.createFormatter(c[b].script, c[b].opts))
                }
            }
        }
    },
    checkBuild: function(c) {
        var a = this._checkState(DNA.JWT.STATE_RENDERD);
        if (!a && c) {
            return this._buildElements()
        } else {
            return a
        }
    },
    createFormatter: function(scriptStr, opts) {
        var scrts = [];
        scrts[0] = "(function(){return new (function() {";
        scrts[1] = scriptStr;
        scrts[2] = "})();})();";
        try {
            return eval(scrts.join(""))
        } catch (exception) {
            alert("�ͻ������ɸ�ʽ���쳣��" + exception.toString())
        }
    },
    _doInit: function() {
        this.editorProvider = null ;
        this.fireDataChangeBySelf = false;
        this.currentCellChangedOnlyFireClient = false;
        this._eventListenerTable = {}
    },
    init: function() {
        DNA.widget.GridGC.superclass.init.call(this)
    },
    _setDoit: function(a, b) {
        a.result.doit = b ? this.GridCom.RESULT_TRUE : this.GridCom.RESULT_FALSE
    },
    _registGCListener: function() {
        this.gc.addListener("gridClick", this._gcClickListener, this);
        this.gc.addListener("cellMouseOut", this._gcCellMouseOutListener, this);
        this.gc.addListener("cellMouseIn", this._gcCellMouseInListener, this);
        this.gc.addListener("scrolled", this._gcScrolledListener, this);
        this.gc.addListener("selection", this._gcSelectionListener, this);
        this.gc.addListener("rowResize", this._gcRowresizeListener, this);
        this.gc.addListener("colResize", this._gcColresizeListener, this);
        this.gc.addListener("paste", this._gcPasteListener, this);
        this.gc.addListener("pasted", this._gcPastedListener, this);
        this.gc.addListener("copy", this._gcCopyListener, this);
        this.gc.addListener("currentCellChanged", this._gcCurrentCellChangedListener, this);
        this.gc.addListener("currentCellChanging", this._gcCurrentCellChangingListener, this);
        this.gc.addListener("editorOpen", this._gcEditorOpenListener, this);
        this.gc.addListener("editorResize", this._gcEditorResizeListener, this);
        this.gc.addListener("editorShow", this._gcEditorShowListener, this);
        this.gc.addListener("editorHide", this._gcEditorHideListener, this);
        this.gc.addListener("editorClose", this._gcEditorCloseListener, this);
        this.gc.addListener("dataChange", this._gcDataChangeListener, this);
        this.gc.addListener("dataLoadEvent", this._gcDataLoadListener, this)
    },
    _gcClickListener: function(b) {
        var a = b.origin;
        var c = new DNA.JWTEvent(a);
        c.setLocation({
            x: b.x,
            y: b.y
        });
        this.fireEvent("gridClick", [c, this])
    },
    _gcCellMouseOutListener: function(a) {
        this.fireEvent("cellout", [this, {
            x: a.cell.getCol(),
            y: a.cell.getRow()
        }])
    },
    _gcCellMouseInListener: function(a) {
        this.fireEvent("cellin", [this, {
            x: a.cell.getCol(),
            y: a.cell.getRow(),
            width: a.x,
            height: a.y
        }])
    },
    _gcScrolledListener: function(b) {
        var a = DNA.engine.application.getJWTEventMgr();
        a.fireEvent("scroll", [b.origin]);
        this.fireEvent("scrolled", [this])
    },
    _gcSelectionListener: function(a) {
        this.fireEvent("selection", [this])
    },
    _gcRowresizeListener: function(a) {
        this.fireEvent("rowresize", [this, a.row, a.height])
    },
    _gcColresizeListener: function(a) {
        this.fireEvent("colresize", [this, a.col, a.width])
    },
    _gcPasteListener: function(c) {
        var a = c.cbText;
        var d = c.col + "," + c.row;
        var b = {
            doit: true
        };
        this.fireEvent("paste", [this, a, d, b]);
        this._setDoit(c, b.doit)
    },
    _gcPastedListener: function(h) {
        var g = h.rect;
        for (var c = 0; c < g.width; c++) {
            for (var b = 0; b < g.height; b++) {
                var a = this.getCell(c, b);
                var d = this.getFormattedText(a);
                if (d) {
                    a.setShowText(d, true)
                }
            }
        }
    },
    _gcCopyListener: function(b) {
        var a = {
            doit: true
        };
        this.fireEvent("copy", [this, {
            x: b.col,
            y: b.row,
            width: (b.width + b.col - 1),
            height: (b.height + b.row - 1)
        }, a]);
        this._setDoit(b, a.doit)
    },
    _gcCurrentCellChangedListener: function(d) {
        var c = d.cause;
        var b = 0;
        switch (d.button) {
        case 1:
            b = 0;
            break;
        case 2:
            b = 2;
            break;
        case 4:
            b = 1;
            break
        }
        if (this.currentCellChangedOnlyFireClient) {
            var a = function(g, h) {
                this.fireEvent("currentCellChangedByServer", [this, g, h])
            }
            ;
            DNA.adapter.browserPage.addFinalTask([a, this, [b, DNA.widget.JWTGrid.SETCURRENTCELLCAUSE_PROGRAM]])
        } else {
            this.fireEvent("currentCellChanged", [this, b, c])
        }
    },
    fullUpdateSetCurrentCell: function(a) {
        this.currentCellChangedOnlyFireClient = true;
        this.setCurrentCell(a);
        this.currentCellChangedOnlyFireClient = false
    },
    _gcCurrentCellChangingListener: function(b) {
        var a = {
            widget: this,
            target: (b.col == -1 && b.row == -1) ? null  : {
                x: b.col,
                y: b.row
            },
            lastCurrent: this.getCurrentCell(),
            doit: true
        };
        this.fireEvent("currentCellChanging", [a]);
        this._setDoit(b, a.doit)
    },
    _gcDataChangeListener: function(b) {
        if (!this.fireDataChangeBySelf) {
            var a = b.rect;
            this.fireDataChangeEvent({
                x: a.x,
                y: a.y,
                width: a.x + a.width - 1,
                height: a.y + a.height - 1
            }, this._getDataChangeCause(b.cause))
        }
    },
    _getDataChangeCause: function(b) {
        var a = DNA.widget.JWTGrid.DATACHANGE_INPUT;
        if (b) {
            switch (b) {
            case this.GridCom.CAUSE_CALL:
                a = DNA.widget.JWTGrid.DATACHANGE_PROGRAM;
                break;
            case this.GridCom.CAUSE_INPUT:
                a = DNA.widget.JWTGrid.DATACHANGE_INPUT;
                break;
            case this.GridCom.CAUSE_CUT:
                a = DNA.widget.JWTGrid.DATACHANGE_CUT;
                break;
            case this.GridCom.CAUSE_PASTE:
                a = DNA.widget.JWTGrid.DATACHANGE_PASTE;
                break;
            case this.GridCom.CAUSE_DELETE:
                a = DNA.widget.JWTGrid.DATACHANGE_DEL;
                break;
            default:
                a = DNA.widget.JWTGrid.DATACHANGE_INPUT;
                break
            }
        }
        return a
    },
    _gcDataLoadListener: function(a) {
        this.fireEvent("dataLoad", [this, a])
    },
    _gcEditorOpenListener: function(n) {
        var b = n.cell.getEditorId();
        if (!b) {
            b = this.gc.getDefaultEditorId()
        }
        var g = DNA.widget.WidgetRegistry.get(b);
        if (g) {
            g.grid = this;
            g.setVisible(true);
            n.cell.setEditor(g.getEl());
            if (g.jtype === "Text") {
                if (!g.hasListener("keydown", g, this._eidtorKeyDown)) {
                    g.addListener("keydown", this._eidtorKeyDown, g)
                }
            }
            var l = DNA.adapter.adapterFactory.get(g.jtype);
            var a = l.getWrapper(g);
            var o = n.cell.getShowText() || "";
            var h = n.cell.getEditText() || "";
            if (n.cause.type == this.GridCom.CAUSE_KEY) {
                h = n.cause.value
            }
            if (a._hasEvent(DNA.JWT.CLIENT_EVENT_GRID_EDITOR_INIT)) {
                var m = this.convertDetail(n.cause.type);
                var d = new DNA.adapter.ClientGridCellEditorEvent(m);
                d.setShowText(o);
                d.setEditText(h);
                a._fireClientEvent(DNA.JWT.CLIENT_EVENT_GRID_EDITOR_INIT, d)
            } else {
                if (!o || o == " ") {
                    o = ""
                }
                if (!h || h == " " || h == "") {
                    h = o
                }
                if (g.jtype === "Text" || g.jtype === "ComboPanel") {
                    g.setDescription(o);
                    g.setText(h);
                    g.processText();
                    g.fireEvent("document", [g])
                } else {
                    if (g.jtype === "Spinner") {
                        try {
                            var p = parseInt(h);
                            if (!isNaN(p)) {
                                g.setSelection(p)
                            } else {
                                g.setSelection(g.getMinimum())
                            }
                        } catch (n) {
                            g.setSelection(g.getMinimum())
                        }
                    } else {
                        if (g.jtype === "DateTime") {
                            var c = new Date();
                            try {
                                c = Date.parse(eidtText, "Y-m-d");
                                g.setDate(c.getTime())
                            } catch (n) {
                                g.setDate(new Date().getTime())
                            }
                        }
                    }
                }
            }
            this._setDoit(n, false)
        }
    },
    convertDetail: function(a) {
        var b = DNA.widget.JWTGrid.EDITOPEN_DBCLICK;
        switch (a) {
        case this.GridCom.CAUSE_MOUSE:
            b = DNA.widget.JWTGrid.EDITOPEN_DBCLICK;
            break;
        case this.GridCom.CAUSE_KEY:
            b = DNA.widget.JWTGrid.EDITOPEN_INPUT;
            break;
        case this.GridCom.CAUSE_CALL:
            b = DNA.widget.JWTGrid.EDITOPEN_PROGRAM;
            break;
        case this.GridCom.CAUSE_CLICKFACE:
            b = DNA.widget.JWTGrid.EDITOPEN_CLICKFACE;
            break
        }
        return b
    },
    _eidtorKeyDown: new DNA.engine.Action({
        handle: function(c) {
            switch (c.getKeyCode()) {
            case DNA.JWTEvent.LEFT:
                var b = this.getSelectPoint();
                if (b.x != b.y) {
                    break
                }
                if (b.x === 0) {
                    this.grid.gc.keyDirection(this.grid.GridCom.ENTER_NEXT_LEFT)
                }
                break;
            case DNA.JWTEvent.RIGHT:
                var b = this.getSelectPoint();
                if (b.x != b.y) {
                    break
                }
                var a = this.getText().length;
                if (b.y === a) {
                    this.grid.gc.keyDirection(this.grid.GridCom.ENTER_NEXT_RIGHT)
                }
                break;
            default:
                break
            }
        }
    }),
    _gcEditorResizeListener: function(d) {
        var b = d.size;
        var a = d.cell.getEditorId();
        if (!a) {
            a = this.gc.getDefaultEditorId()
        }
        var c = DNA.widget.WidgetRegistry.get(a);
        if (c) {
            c.getEl().style.position = "absolute";
            c.setSize(b.width - 1, b.height - 1);
            this._setDoit(d, false)
        }
    },
    _gcEditorShowListener: function(m) {
        var n = m.cell;
        var c = m.cell.getEditorId();
        if (!c) {
            c = this.gc.getDefaultEditorId()
        }
        this.focusable = false;
        var g = DNA.widget.WidgetRegistry.get(c);
        if (g) {
            this.focus();
            g.focus();
            if (g.jtype === "Text") {
                var o = g.getText();
                if (o && o != "") {
                    var l = o.length;
                    if (m.cause.type == this.GridCom.CAUSE_MOUSE) {
                        g.setSelectPoint(0, l)
                    } else {
                        g.setSelectPoint(l, l)
                    }
                }
            }
        }
        var h = DNA.adapter.adapterFactory.get(g.jtype);
        var b = h.getWrapper(g);
        if (b._hasEvent(DNA.JWT.CLIENT_EVENT_GRID_EDITOR_OPEN)) {
            var d = new DNA.adapter.ClientEvent();
            b._fireClientEvent(DNA.JWT.CLIENT_EVENT_GRID_EDITOR_OPEN, d, true)
        }
        var a = {
            grid: this,
            col: n.getCol(),
            row: n.getRow(),
            showText: n.getShowText(),
            editText: n.getEditText()
        };
        this.fireEvent("beforeedit", [a]);
        this._setDoit(m, false)
    },
    _gcEditorHideListener: function(d) {
        var a = d.cell;
        var b = d.cell.getEditorId();
        if (!b) {
            b = this.gc.getDefaultEditorId()
        }
        var c = DNA.widget.WidgetRegistry.get(b);
        if (c) {
            c.setVisible(false)
        }
        this._setDoit(d, false)
    },
    _gcEditorCloseListener: function(l) {
        this.focusable = true;
        var n = l.cell;
        var d = l.cell.getEditorId();
        if (!d) {
            d = this.gc.getDefaultEditorId()
        }
        var g = DNA.widget.WidgetRegistry.get(d);
        var b = this._editorGetResult(g, this._parseGetResultCause(l));
        if (!b) {
            this.focus();
            this._setDoit(l, false);
            return
        }
        var m = b.getShowText();
        var h = b.getEditText();
        var c = {
            grid: this,
            col: n.getCol(),
            row: n.getRow(),
            showText: m,
            editText: h
        };
        this.fireEvent("afteredit", [c]);
        n.setEditText(c.editText, true);
        var a = this.getFormattedText(n);
        var o = a ? a : c.showText;
        n.setShowText(o, true);
        this.focus();
        this._setDoit(l, false)
    },
    _parseGetResultCause: function(b) {
        var a = 0;
        if (b.cause && b.cause < 0) {
            a = 0 - b.cause
        }
        return a
    },
    getFormattedText: function(a) {
        try {
            var b = this.formatterMgr.getFormatter(a.getClientData().fi);
            if (b) {
                return b.format(a.getEditText())
            }
        } catch (c) {
            return null 
        }
    },
    _editorGetResult: function(g, b) {
        var l = g.getData("wrapper");
        var a = "";
        var d = "";
        if (l._hasEvent(DNA.JWT.CLIENT_EVENT_GRID_EDITOR_GETVALUE)) {
            var h = new DNA.adapter.ClientGridCellEditorEvent(b ? b : 0);
            l._fireClientEvent(DNA.JWT.CLIENT_EVENT_GRID_EDITOR_GETVALUE, h, true);
            if (!h.doit) {
                return null 
            }
            a = h.getShowText();
            d = h.getEditText()
        } else {
            if (g.jtype === "Text") {
                d = g.getText();
                a = d
            } else {
                if (g.jtype === "ComboPanel") {
                    d = g.getText();
                    a = g.getDescription()
                } else {
                    if (g.jtype === "Spinner") {
                        d = g.getSelection() + "";
                        a = d
                    } else {
                        if (g.jtype === "DateTime") {
                            var c = g.getDate();
                            d = c.format("Y-m-d");
                            a = d
                        }
                    }
                }
            }
            if (!a) {
                a = d
            }
        }
        return new DNA.widget.CommonCellContent(a,d)
    },
    openCurrentEditor: function() {
        var a = this.getCurrentCell();
        if (!a) {
            return
        }
        this.gc.openEditor(a.x, a.y)
    },
    computeSize: function(d, b, g) {
        var c = new DNA.widget.Point();
        if (this.checkRendered()) {
            if (d != -1 && b != -1) {
                c.x = d;
                c.y = b
            } else {
                var a = this.getBorderSize();
                c.x += a;
                c.y += a;
                c.x += this.gc.getDataWidth();
                c.y += this.gc.getDataHeight();
                if (d != -1) {
                    if (c.x > d) {
                        c.y += 18
                    }
                    c.x = d
                }
                if (b != -1) {
                    if (c.y > b) {
                        c.x += 18
                    }
                    c.y = b
                }
            }
        } else {
            c.x = 100;
            c.y = 100
        }
        return c
    },
    getScrollPosition: function() {
        var a = this.getBounds().height;
        if (a === 0) {
            return null 
        }
        var b = this.gc.getDataHeight();
        var d = (b - a);
        var c = 2;
        if (b <= a) {
            return null 
        }
        if (this.getScrollTop() <= c) {
            return "top"
        }
        if (this.getScrollTop() + a + c >= b) {
            return "bottom"
        }
        return "middle"
    },
    _doBuildElements: function() {
        this.tDiv = this.el;
        this.gcDiv = this.tDiv.firstChild;
        this.gridOption = this.getInitData().gridOption;
        delete this.getInitData().gridOption;
        var d = DNA.engine.DomUtil.getClientSize(this.tDiv);
        DNA.engine.DomUtil.setSize(this.gcDiv, d);
        this.listFace = this.tDiv.childNodes[1];
        this.btnFace = this.tDiv.childNodes[2];
        this.controlCells = [];
        this.GridCom = COM.widget.Grid;
        var g = DNA.engine.JsonUtil.decode(this.getInitData()["initValue"]);
        delete this.getInitData()["initValue"];
        this.GridCom.deserialize(g);
        var c = {
            eventSource: {
                mousedown: this,
                keydown: this
            }
        };
        this.gc = new COM.widget.Grid(this.gcDiv,g,c);
        if (this.gc.setVisible) {
            this.gc.setVisible(this.isVisible())
        }
        this._registGCListener();
        this.gc.setSize(d.width, d.height);
        this.gc.setCopyFunction(DNA.adapter.ClipboardUtil.copyToClipboard, DNA.adapter.ClipboardUtil);
        this.gc.setPasteFunction(DNA.adapter.ClipboardUtil.getClipboard, DNA.adapter.ClipboardUtil);
        var h = this.getInitData().cccf;
        delete this.getInitData().cccf;
        if (h) {
            var a = h.split(",");
            var l = a[0];
            var m = a[1];
            this.setCurrentCellColor(l, m)
        }
        var b = new this.GridCom.Grid2Adapter();
        b.setFace(1, this.btnFace);
        b.setFace(2, this.listFace);
        b.setGetFaceFun(function(n) {
            return n.getClientData().gcFace
        });
        b.init(this.gc);
        this.setCellEditorProvider(new DNA.widget.CellEditorProvider());
        this._initFormatter();
        if (!this.isEnabled()) {
            this._disableGrid(this)
        }
    },
    _afterGridCreate: function() {
        if (!(this.el.tagName == "IFRAME")) {
            if (this.getInitData().defEditorId) {
                var c = this.getInitData().defEditorId;
                delete this.getInitData().defEditorId;
                var h = DNA.widget.WidgetRegistry.get(c);
                if (h) {
                    this.gc.setDefaultEditor(h.getEl())
                }
            }
            if (this.getInitData().selections) {
                var g = this.getInitData().selections;
                delete this.getInitData().selections;
                this.setSelections(g)
            }
            if (this.getInitData().currentCell) {
                var a = this.getInitData().currentCell;
                delete this.getInitData().currentCell;
                this.setCurrentCell(a)
            }
            if (this.getInitData().open_editor) {
                delete this.getInitData().open_editor;
                this.openCurrentEditor()
            }
            var d = this.getInitData()[DNA.JWTProperty.PROPERTY_HORIZONTAL_POSITION];
            if (d != undefined) {
                delete this.getInitData()[DNA.JWTProperty.PROPERTY_HORIZONTAL_POSITION];
                this.setHorizontalPosition(d)
            }
            var b = this.getInitData()[DNA.JWTProperty.PROPERTY_VERTICAL_POSITION];
            if (b != undefined) {
                delete this.getInitData()[DNA.JWTProperty.PROPERTY_VERTICAL_POSITION];
                this.setVerticalPosition(b)
            }
        }
    },
    setCurrentCellColor: function(a, b) {
        this.gc.setCurrentCellColor(this.getRGBAColor(a));
        this.gc.setBlurCurrentCellColor(this.getRGBAColor(b))
    },
    getRGBAColor: function(a) {
        return "rgba(" + this.getValueFromHexString(a.substring(1, 3)) + "," + this.getValueFromHexString(a.substring(3, 5)) + "," + this.getValueFromHexString(a.substring(5, 7)) + ",1)"
    },
    getValueFromHexString: function(d) {
        var a = "0123456789abcdef";
        var g = 0;
        for (var c = d.length - 1, b = 0; c >= 0; c--,
        b++) {
            g += a.indexOf(d.charAt(b)) << (c * 4)
        }
        return g
    },
    _resizeGridDiv: function() {
        if (this.el.tagName == "IFRAME") {
            this.tDiv = this.el.contentWindow.document.body.firstChild;
            var a = DNA.engine.DomUtil.getClientSize(this.el);
            this.tDiv.style.height = a.height + "px";
            this.tDiv.style.width = a.width + "px";
            this.gc.setSize(a.width, a.height)
        }
    },
    _clearChildrenEl: function(b) {
        var d = b.getChildren();
        for (var c = 0, a = d.length; c < a; c++) {
            var g = d[c];
            if (g.getChildren) {
                if (g.getChildren()) {
                    this._clearChildrenEl(g)
                }
            }
            if (g.el) {
                g.fireEvent("beforeReplace");
                g._unmaskState(DNA.JWT.STATE_RENDERD);
                if (g.el) {
                    g.el = null 
                }
            }
        }
    },
    _isResizeable: function() {
        if (this.getEl()) {
            return true
        }
    },
    doDispose: function() {
        DNA.widget.GridGC.superclass.doDispose.call(this);
        delete this.util;
        this.gc.dispose();
        delete this.gcDiv;
        delete this.listFace;
        delete this.btnFace;
        delete this.controlCells;
        delete this.GridCom;
        delete this.gc;
        delete this._eventListenerTable
    },
    _doAfterParentVisible: function() {
        if (!this.tDiv) {
            return
        }
        if (this.el && this.el.tagName == "IFRAME") {
            var a = DNA.engine.DomUtil.getClientSize(this.el);
            DNA.engine.DomUtil.setSize(this.tDiv, a);
            this.gc.setSize(a.width, a.height)
        }
    },
    _focus: function() {
        this._focusDom()
    },
    _registEvents: function() {
        var a = DNA.engine.application.getJWTEventMgr();
        a.addBubbleListener("keydown", this.onBubbleKeyDown, this);
        this.addListener("mousedown", this._onMousedown);
        this.addListener("keydown", this._onKeyDown);
        this.addListener("dragover", this._doDragOver);
        this.addListener("resize", this._doResize);
        a.addListener(DNA.JWTEvent.POSTVISIBLE, this._doAfterVisible, this);
        a.addListener(DNA.JWTEvent.PREHIDDEN, this._doBeforeHidden, this);
        a.addBubbleListener(DNA.JWTEvent.MOUSEDOWN, this._onMousedown, this);
        this.addListener("focus", this._onFocus);
        this.addListener("blur", this._onBlur);
        a.addListener(DNA.JWTEvent.PRE_DISABLED, this._onDisable, this);
        a.addListener(DNA.JWTEvent.POST_ENABLED, this._onEnable, this)
    },
    _onDisable: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            this._disableGrid(a)
        }
    }),
    _onEnable: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            this._enableGrid(a)
        }
    }),
    _disableGrid: function(a) {
        if (a.isAncestorOf(this)) {
            this.gc.setEnabled(false)
        }
    },
    _enableGrid: function(a) {
        if (a.isAncestorOf(this)) {
            this.gc.setEnabled(true)
        }
    },
    _onFocus: new DNA.engine.Action({
        handle: function(a) {
            if (this.gc.getActiveEditor()) {
                return
            }
            this.gc.focus()
        }
    }),
    _onBlur: new DNA.engine.Action({
        handle: function(a) {
            this.gc.blur()
        }
    }),
    _doAfterVisible: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            if (a.isAncestorOf(this)) {
                this._doResizeGCDiv();
                if (this.gc.setVisible) {
                    this.gc.setVisible(true)
                }
            }
        }
    }),
    _doBeforeHidden: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            if (a.isAncestorOf(this) && this.gc.setVisible) {
                this.gc.setVisible(false)
            }
        }
    }),
    _doDragOver: new DNA.engine.Action({
        handle: function(c) {
            if (!this.checkRendered(true)) {
                return
            }
            if (!this.el) {
                return
            }
            var b = c.getXY();
            var a = DNA.engine.DomUtil.getPageXY(this.el);
            a = {
                x: b.x - a.x,
                y: b.y - a.y
            };
            a = this.getCellByPoint(a.x, a.y);
            if (a) {
                this.posInfo = a.x + "," + a.y
            } else {
                this.posInfo = "-1,-1"
            }
        }
    }),
    setHorizontalPosition: function(a) {
        if (this.tDiv) {
            this.gc.setScrollLeft(a)
        }
    },
    setVerticalPosition: function(a) {
        if (this.tDiv) {
            this.gc.setScrollTop(a)
        }
    },
    onBubbleKeyDown: new DNA.engine.PreventableAction({
        handle: function(a) {
            if (!a.isCtrl() && !a.isAlt() && a.getKeyCode() == DNA.JWTEvent.ENTER) {
                this.focus();
                this.gc.keyEnter();
                a.preventDefault()
            }
        }
    }),
    _onMousedown: new DNA.engine.Action({
        handle: function(a) {
            if (this._eventListenerTable.mousedown) {
                this._eventListenerTable.mousedown.call(this.gc, a._browserEvent)
            }
        }
    }),
    _onKeyDown: new DNA.engine.Action({
        handle: function(a) {
            if (this._eventListenerTable.keydown) {
                this._eventListenerTable.keydown.call(this.gc, a._browserEvent)
            }
        }
    }),
    deleteText: function() {
        var b = this.gc.getSelections().length;
        for (var c = 0; c < b; ++c) {
            this.gc.clearText(this.gc.getSelections()[c])
        }
        var g = this.gc.getCurrentCell();
        if (g) {
            var a = this.gc.getCell(g.x, g.y);
            if (a.getShowText()) {
                var d = {
                    x: g.x,
                    y: g.y,
                    width: g.x,
                    height: g.y
                };
                this.gc.clearText(d)
            }
        }
    },
    pasteText: function(a) {
        if (!a || a.x === undefined || a.y === undefined) {
            var b = this.getCurrentCell();
            if (b) {
                a = {
                    x: b.x,
                    y: b.y,
                    width: -1,
                    height: -1
                }
            }
        }
        this.gc.paste(a)
    },
    copyText: function(b) {
        var a = this.gc.getSelection();
        var b = null ;
        if (a) {
            b = a
        } else {
            var d = this.gc.getCurrentCell();
            if (d) {
                b = {
                    x: d.x,
                    y: d.y,
                    width: d.x,
                    height: d.y
                }
            }
        }
        if (b) {
            var c = {
                doit: true
            };
            this.fireEvent("copy", [this, {
                x: b.x,
                y: b.y,
                width: b.width,
                height: b.height
            }, c]);
            if (!c.doit) {
                return null 
            }
            return this.gc.copy(b)
        }
        return null 
    },
    cutText: function() {
        var a = this.gc.getCurrentSelection();
        if (a) {
            var b = this.gc.cut(a);
            if (b) {
                return b
            }
        }
        return null 
    },
    toString: function() {
        return "GridGC"
    },
    getCellByPoint: function(a, c) {
        if (!this.checkRendered(true)) {
            return
        }
        var b = this.gc.getCellByPoint(a, c);
        return {
            x: b.col,
            y: b.row
        }
    },
    getCell: function(a, b) {
        if (!this.checkRendered(true)) {
            return
        }
        return this.gc.getCell(a, b)
    },
    merge: function(d, c, b, a) {
        return this.gc.mergeCell(d, c, b, a)
    },
    unmerge: function(a, b) {
        this.gc.unMergeCell(a, b)
    },
    setRowHeight: function(b, a) {
        if (!this.checkRendered(true)) {
            return
        }
        this.gc.setRowHeight(b, a)
    },
    getRowHeight: function(a) {
        if (!this.checkRendered(true)) {
            return 0
        }
        return this.getRowHidden(a) ? 0 : this.gc.getRowHeight(a)
    },
    setColumnWidth: function(a, b) {
        if (!this.checkRendered(true)) {
            return
        }
        this.gc.setColWidth(a, b)
    },
    getColumnWidth: function(a) {
        if (!this.checkRendered(true)) {
            return 0
        }
        return this.getColHidden(a) ? 0 : this.gc.getColWidth(a)
    },
    _doResize: new DNA.engine.Action({
        handle: function(a) {
            this._doResizeGCDiv()
        }
    }),
    _doResizeGCDiv: function() {
        if (!this._isResizeable()) {
            return
        }
        if (this.el && this.tDiv && this.gcDiv) {
            var a = DNA.engine.DomUtil.getClientSize(this.el);
            if (this.el.tagName == "IFRAME") {
                DNA.engine.DomUtil.setSize(this.tDiv, a)
            }
            DNA.engine.DomUtil.setSize(this.gcDiv, a);
            if (this.isVisible()) {
                this.gc.setVisible(true)
            }
            this.gc.setSize(a.width, a.height)
        }
    },
    insertRows: function(a, b) {
        if (!this.checkRendered(true)) {
            return
        }
        this.currentCellChangedOnlyFireClient = true;
        this.gc.insertRows(a, b);
        this.currentCellChangedOnlyFireClient = false
    },
    deleteRows: function(a, b) {
        if (!this.checkRendered(true)) {
            return
        }
        this.gc.deleteRows(a, b)
    },
    insertColumns: function(a, b) {
        if (!this.checkRendered(true)) {
            return
        }
        this.currentCellChangedOnlyFireClient = true;
        this.gc.insertCols(a, b);
        this.currentCellChangedOnlyFireClient = false
    },
    _reverse: function(a) {
        if (a) {
            return a.split("").reverse().join("")
        }
        return ""
    },
    deleteColumns: function(a, b) {
        if (!this.checkRendered(true)) {
            return
        }
        this.gc.deleteCols(a, b)
    },
    getRowVisible: function(a) {
        return !this.gc.isRowHidden(a)
    },
    setRowHidden: function(b, a) {
        if (!this.checkRendered(true)) {
            return
        }
        this.gc.setRowVisible(b, !a)
    },
    setColumnHidden: function(b, a) {
        if (!this.checkRendered(true)) {
            return
        }
        this.gc.setColVisible(b, !a)
    },
    getColHidden: function(a) {
        if (!this.checkRendered(true)) {
            return false
        }
        return this.gc.isColHidden(a)
    },
    getRowHidden: function(a) {
        if (!this.checkRendered(true)) {
            return false
        }
        return this.gc.isRowHidden(a)
    },
    setColAutoWidth: function(a, b) {
        if (!this.checkRendered(true)) {
            return false
        }
        this.gc.setColAutoWidth(a, b)
    },
    setRowAutoHeight: function(b, a) {
        if (!this.checkRendered(true)) {
            return false
        }
        this.gc.setRowAutoHeight(b, a)
    },
    setGridOption: function(a) {
        this.gridOption = a;
        this.setEditMode(this.gridOption & DNA.widget.JWTGrid.EDIT_MODE_MASK);
        this.setEnterNext(this.gridOption & DNA.widget.JWTGrid.ENTER_NEXT_MASK);
        this.setSelectionMode(this.gridOption & DNA.widget.JWTGrid.SELECTION_MODE_MASK);
        this.setColSelectEnabled((this.gridOption & DNA.widget.JWTGrid.COL_SELECT_MASK) != 0);
        this.setRowSelectEnabled((this.gridOption & DNA.widget.JWTGrid.ROW_SELECT_MASK) != 0);
        this.setRowResizeEnable((this.gridOption & DNA.widget.JWTGrid.ROW_RESIZE_MASK) != 0);
        this.setColResizeEnable((this.gridOption & DNA.widget.JWTGrid.COL_RESIZE_MASK) != 0);
        this.setRowFreeResizeEnabled((this.gridOption & DNA.widget.JWTGrid.ROW_FREE_RESIZE_MASK) != 0);
        this.setColFreeResizeEnabled((this.gridOption & DNA.widget.JWTGrid.COL_FREE_RESIZE_MASK) != 0)
    },
    setDefEditor: function(a) {
        this.gc.setDefaultEditor(DNA.widget.WidgetRegistry.get(a).getEl())
    },
    setColumnCount: function(a) {
        this.gc.setColCount(a)
    },
    setRowCount: function(a) {
        this.gc.setRowCount(a)
    },
    getColumnCount: function() {
        return this.gc.getColCount()
    },
    getRowCount: function() {
        return this.gc.getRowCount()
    },
    setHeaderColumnCount: function(a) {
        this.gc.setColHeaderCount(a)
    },
    setHeaderRowCount: function(a) {
        this.gc.setRowHeaderCount(a)
    },
    getHeaderColumnCount: function() {
        return this.gc.getColHeaderCount()
    },
    getHeaderRowCount: function() {
        return this.gc.getRowHeaderCount()
    },
    setFooterColumnCount: function(a) {
        this.gc.setColFooterCount(a)
    },
    setFooterRowCount: function(a) {
        this.gc.setRowFooterCount(a)
    },
    getFooterColumnCount: function() {
        return this.gc.getColFooterCount()
    },
    getFooterRowCount: function() {
        return this.gc.getRowFooterCount()
    },
    setEditMode: function(b) {
        var a;
        switch (b) {
        case DNA.widget.JWTGrid.EDIT_MODE_DESIGN:
            a = this.GridCom.EDIT_MODE_EDIT;
            break;
        case DNA.widget.JWTGrid.EDIT_MODE_INPUT:
            a = this.GridCom.EDIT_MODE_INPUT;
            break;
        case DNA.widget.JWTGrid.EDIT_MODE_READONLY:
            a = this.GridCom.EDIT_MODE_READ_ONLY;
            break
        }
        this.gc.setEditMode(a)
    },
    getEditMode: function() {
        var a = this.gc.getEditMode();
        var b;
        switch (a) {
        case this.GridCom.EDIT_MODE_EDIT:
            b = DNA.widget.JWTGrid.EDIT_MODE_DESIGN;
            break;
        case this.GridCom.EDIT_MODE_INPUT:
            b = DNA.widget.JWTGrid.EDIT_MODE_INPUT;
            break;
        case this.GridCom.EDIT_MODE_READONLY:
            b = DNA.widget.JWTGrid.EDIT_MODE_READONLY;
            break
        }
        return b
    },
    setSelectionMode: function(b) {
        var a;
        switch (b) {
        case DNA.widget.JWTGrid.SELECTION_MODE_MULTI:
            a = this.GridCom.SELECTION_MODE_MULTI;
            break;
        case DNA.widget.JWTGrid.SELECTION_MODE_SINGLE:
            a = this.GridCom.SELECTION_MODE_SINGLE;
            break;
        case DNA.widget.JWTGrid.SELECTION_MODE_ROW:
            a = this.GridCom.SELECTION_MODE_ROW;
            break
        }
        this.gc.setSelectionMode(a)
    },
    getSelectionMode: function() {
        var a = this.gc.getSelectionMode();
        var b;
        switch (a) {
        case this.GridCom.SELECTION_MODE_MULTI:
            b = DNA.widget.JWTGrid.SELECTION_MODE_MULTI;
            break;
        case this.GridCom.SELECTION_MODE_SINGLE:
            b = DNA.widget.JWTGrid.SELECTION_MODE_SINGLE;
            break;
        case this.GridCom.SELECTION_MODE_ROW:
            b = DNA.widget.JWTGrid.SELECTION_MODE_ROW;
            break
        }
        return b
    },
    reInitEditor: function() {
        if (this.gc.isEditing()) {
            this._gcEditorOpenListener({
                cell: this.gc.getCurrentCell(),
                result: {},
                cause: {}
            })
        }
    },
    setRowResizeEnable: function(a) {
        this.gc.setRowResizeable(a)
    },
    getRowResizeEnable: function() {
        return this.gc.isRowResizeable()
    },
    setColResizeEnable: function(a) {
        this.gc.setColResizeable(a)
    },
    getColResizeEnable: function() {
        return this.gc.isColResizeable()
    },
    setRowSelectEnabled: function(a) {
        this.gc.setRowSelectable(a)
    },
    getRowSelectEnabled: function() {
        return this.gc.isRowSelectable()
    },
    setRowFreeResizeEnabled: function(a) {
        this.gc.setRowFreeResizeable(a)
    },
    getRowFreeResizeEnabled: function() {
        return this.gc.isRowFreeResizeable()
    },
    setColFreeResizeEnabled: function(a) {
        this.gc.setColFreeResizeable(a)
    },
    getColFreeResizeEnabled: function() {
        return this.gc.isColFreeResizeable()
    },
    setColSelectEnabled: function(a) {
        this.gc.setColSelectable(a)
    },
    getColSelectEnabled: function() {
        return this.gc.isColSelectable()
    },
    setEnterNext: function(b) {
        var a;
        switch (b) {
        case DNA.widget.JWTGrid.ENTER_NEXT_RIGHT:
            a = this.GridCom.ENTER_NEXT_RIGHT;
            break;
        case DNA.widget.JWTGrid.ENTER_NEXT_DOWN:
            a = this.GridCom.ENTER_NEXT_DOWN;
            break;
        case DNA.widget.JWTGrid.ENTER_NEXT_LEFT:
            a = this.GridCom.ENTER_NEXT_LEFT;
            break;
        case DNA.widget.JWTGrid.ENTER_NEXT_UP:
            a = this.GridCom.ENTER_NEXT_UP;
            break
        }
        this.gc.setEnterNext(a)
    },
    getEnterNext: function() {
        var a = this.gc.getEnterNext();
        var b;
        switch (a) {
        case this.GridCom.ENTER_NEXT_RIGHT:
            b = DNA.widget.JWTGrid.ENTER_NEXT_RIGHT;
            break;
        case this.GridCom.ENTER_NEXT_DOWN:
            b = DNA.widget.JWTGrid.ENTER_NEXT_DOWN;
            break;
        case this.GridCom.ENTER_NEXT_LEFT:
            b = DNA.widget.JWTGrid.ENTER_NEXT_LEFT;
            break;
        case this.GridCom.ENTER_NEXT_UP:
            b = DNA.widget.JWTGrid.ENTER_NEXT_UP;
            break
        }
        return b
    },
    setCurrentCell: function(a, b) {
        if (a) {
            this.focus();
            var d = this.getCurrentCell();
            if (d && a && d.x == a.x && d.y == a.y) {
                return
            }
            this.gc.setCurrentCell(a.x, a.y, b)
        } else {
            this.gc.setCurrentCell(-1, -1)
        }
    },
    getCurrentCell: function() {
        var a = this.gc.getCurrentCell();
        if (a) {
            return {
                x: a.getCol(),
                y: a.getRow()
            }
        } else {
            return null 
        }
    },
    getSelections: function() {
        return this.gc.getSelections()
    },
    getSelection: function() {
        return this.gc.getSelection()
    },
    addSelection: function(b, d, c, a) {
        this.gc.addSelection(b, d, c, a)
    },
    setSelection: function(a) {
        this.gc.setSelection(a)
    },
    setSelections: function(a) {
        if (!this.checkRendered(true)) {
            return
        }
        this.gc.setSelections(a)
    },
    clearSelection: function() {
        this.gc.clearSelection()
    },
    setCellEditorProvider: function(a) {
        this.editorProvider = a
    },
    synchronizeData: function(b, g) {
        this.fireDataChangeBySelf = true;
        if (this.gc.getActiveEditor()) {
            var d = this._editorGetResult(DNA.widget.WidgetRegistry.get(this.gc.getActiveEditorId()));
            var c = d.getShowText();
            var h = d.getEditText();
            var a = this.gc.getCurrentCell();
            a.setShowText(c ? c : "");
            a.setEditText(h ? h : "");
            if (!g) {
                this.fireDataChangeEvent({
                    x: a.getCol(),
                    y: a.getRow(),
                    width: a.getCol(),
                    height: a.getRow()
                }, DNA.widget.JWTGrid.DATACHANGE_INPUT, b)
            }
        }
        this.fireDataChangeBySelf = false
    },
    getActiveEditor: function() {
        var a = this.gc.getActiveEditorId();
        if (a) {
            return DNA.widget.WidgetRegistry.get(a)
        }
    },
    fireDataChangeEvent: function(c, b, a) {
        this.fireEvent("datachange", [this, c, b, a])
    },
    fireSelectionEvent: function() {
        this.fireEvent("selection", [this])
    },
    fireCurrentCellChangedEvent: function() {
        this.fireEvent("currentCellChanged", [this])
    },
    fireCurrentCellChangingEvent: function(a) {
        this.fireEvent("currentCellChanging", [a])
    },
    _focusDom: function(a) {
        if (this.gc.getActiveEditor()) {
            return
        }
        if (this.gc && this.gc.focus) {
            this.gc.focus()
        }
    },
    getScrollTop: function() {
        return this.gc.getScrollTop()
    },
    getScrollLeft: function() {
        return this.gc.getScrollLeft()
    },
    setScrollTop: function(a) {
        this.gc.setScrollTop(a)
    },
    setScrollLeft: function(a) {
        this.gc.setScrollLeft(a)
    },
    getClientHeight: function() {
        return this.tDiv.clientHeight
    },
    _getScrollElement: function() {
        return this.tDiv
    },
    _add: function(b, a) {
        if (a) {
            return this._renderChild(this.getBody(), DNA.JWT.RENDER_POS_TYPE_LAST, a)
        }
    },
    fullUpdateNoIframe: function(a) {
        this.tDiv.innerHTML = a;
        this._replaceDom()
    },
    loadData: function(a) {
        this.gc.loadData(DNA.engine.JsonUtil.decode(a))
    },
    canCellEdit: function(b, a) {
        return this.gc.canCellEdit(b, a)
    },
    addEventListener: function(a, b) {
        this._eventListenerTable[a] = b
    },
    isEventReachable: function(b, d, c, a) {
        if (b == DNA.JWTEvent.POSTVISIBLE) {
            return true
        } else {
            return DNA.widget.GridGC.superclass.isEventReachable.call(this)
        }
    }
});
Object.override(DNA.widget.GridGC.prototype, {
    jtype: "GridGC",
    focusable: true
});
DNA.widget.GridAsync = function(a) {
    DNA.widget.GridAsync.superclass.constructor.call(this, a);
    this._doInit();
    this.util = new DNA.widget.GridUtilAsync(this)
}
;
DNA.widget.GridAsync.extend(DNA.widget.Composite, {
    autoRender: true,
    resizeCursorBound: 2,
    _defaultBorder: new DNA.widget.Border(1,"gray","solid"),
    _selTitleBackColor: "#ffe5a0",
    _selTitleBorderColor: "#f9bc54",
    notifyWillRebuild: function(g) {
        if (g.initFlag) {
            return
        }
        var c = g.getChildren();
        for (var b = 0, a = c.length; b < a; b++) {
            var d = c[b];
            if (d.checkRendered(false)) {
                d.fireEvent("willRebuild")
            }
            if (d.getChildren) {
                if (d.getChildren()) {
                    this.notifyWillRebuild(d)
                }
            }
        }
    },
    _initFormatter: function() {
        var a = this.getInitData()[DNA.JWTProperty.PROPERTY_FORMATTER];
        this.formatterMgr = new DNA.widget.CellFormatterMgr();
        this._addFormatters(a)
    },
    _addFormatters: function(c) {
        if (c) {
            var a = c.length;
            for (var b = 0; b < a; ++b) {
                if (c[b]) {
                    this.formatterMgr.addFormatter(c[b].id, this.createFormatter(c[b].script, c[b].opts))
                }
            }
        }
    },
    checkBuild: function(c) {
        var a = this._checkState(DNA.JWT.STATE_RENDERD);
        if (!a && c) {
            return this._buildElements()
        } else {
            return a
        }
    },
    createFormatter: function(scriptStr, opts) {
        var scrts = [];
        scrts[0] = "(function(){return new (function() {";
        scrts[1] = scriptStr;
        scrts[2] = "})();})();";
        try {
            return eval(scrts.join(""))
        } catch (exception) {
            alert("�ͻ������ɸ�ʽ���쳣��" + exception.toString())
        }
    },
    _doInit: function() {
        this.initFlag = this.getInitData().initFlag;
        delete this.getInitData().initFlag;
        this.gridState = DNA.widget.JWTGrid.STATE_NORMAL;
        this.needHandleGlobal = false;
        this.replacing = false;
        this.selectFinish = true;
        this.operateCell = null ;
        this.operateArea = null ;
        this.minColWidth = 1;
        this.minRowHeight = 1;
        this.defColWidth = 100;
        this.defRowHeight = 20;
        this.columnCount = this.getInitData().colCount;
        delete this.getInitData().colCount;
        this.rowCount = this.getInitData().rowCount;
        delete this.getInitData().rowCount;
        this.hColCount = this.getInitData().headerColCount;
        delete this.getInitData().headerColCount;
        this.hRowCount = this.getInitData().headerRowCount;
        delete this.getInitData().headerRowCount;
        this.renderedTop = this.getInitData().renderedTop;
        delete this.getInitData().renderedTop;
        this.renderedCount = this.getInitData().renderedCount;
        delete this.getInitData().renderedCount;
        this.tDiv = null ;
        this.currentCell = null ;
        this.gridOption = this.getInitData().gridOption;
        delete this.getInitData().gridOption;
        this.ignoreHidden = this.getInitData().ignoreHidden ? true : false;
        delete this.getInitData().ignoreHidden;
        this.hrDiv = null ;
        this.hcDiv = null ;
        this.resizeRowIdx = 0;
        this.resizeColIdx = 0;
        this.resizeRowPoint = null ;
        this.resizeColPoint = null ;
        this.resizeDiv = null ;
        this.newSize = 0;
        this.mouseCell = null ;
        this.cellOut = null ;
        this.lastMouseCell = {
            x: -1,
            y: -1
        };
        this.selBeginCell = {
            x: 0,
            y: 0
        };
        this.selectionAreas = new Array();
        this.selectionDiv = null ;
        this.currentRow = -1;
        this.currentCol = -1;
        var b = this.getInitData().cccf;
        delete this.getInitData().cccf;
        if (b) {
            var a = b.split(",");
            this.currentCellColorFocused = a[0];
            this.currentCellColorUnFocused = a[1]
        } else {
            this.currentCellColorFocused = null ;
            this.currentCellColorUnFocused = null 
        }
        this.activeEditor = null ;
        this.editorProvider = null 
    },
    _gridAfterInit: function() {},
    computeSize: function(g, b, h) {
        var d = new DNA.widget.Point();
        if (this.checkRendered()) {
            var a = this.getBorderSize();
            d.x += a;
            d.y += a;
            for (var c = 0; c < this.columnCount; c++) {
                if (this.getColVisible(c)) {
                    d.x += this.getColumnWidthFromStyle(c)
                }
            }
            d.y += this.tDiv.scrollHeight;
            d.y += 1
        } else {
            d.x = this.defColWidth * this.columnCount;
            d.y = this.defRowHeight * this.rowCount
        }
        return d
    },
    _doBuildElements: function() {
        try {
            if (this.getEl().tagName == "IFRAME") {
                if (!this.getEl().contentWindow.document) {
                    return false
                }
                if (!this.getEl().contentWindow.document.body || !this.getEl().contentWindow.document.body.firstChild) {
                    return false
                }
                this.gel = this.getEl().contentWindow.document.body.firstChild;
                var b = DNA.engine.DomUtil.getClientSize(this.getEl());
                this.gel.style.height = b.height + "px";
                this.gel.style.width = b.width + "px"
            } else {
                this.gel = this.getEl()
            }
            this.tDiv = this.gel.firstChild;
            this.cwDiv = this.gel.childNodes[1].firstChild;
            this.hrDiv = this.gel.childNodes[2];
            this.hcDiv = this.gel.childNodes[3];
            this.hccwDiv = this.hcDiv.childNodes[1].firstChild;
            this.hltDiv = this.gel.childNodes[4];
            this.inputProxy = this.hltDiv.lastChild;
            this.hrTable = this.hrDiv.firstChild;
            this.hcTable = this.hcDiv.firstChild;
            this.hltTab = this.hltDiv.firstChild;
            this.selectionDiv = this.gel.childNodes[8];
            this.resizeDiv = this.gel.childNodes[9];
            this.mCurLeft = this.cwDiv.childNodes[1];
            this.mCurRight = this.cwDiv.childNodes[2];
            this.mCurTop = this.cwDiv.childNodes[3];
            this.mCurBottom = this.cwDiv.childNodes[4];
            this.curLeft = this.mCurLeft;
            this.curRight = this.mCurRight;
            this.curTop = this.mCurTop;
            this.curBottom = this.mCurBottom;
            this.listFace = this.gel.childNodes[6];
            this.listFace.style.display = "none";
            this.listFace.style.width = "18px";
            this.listFace.style.position = "absolute";
            this.listFace.style.paddingRight = "1px";
            this.listFace.style.paddingTop = "1px";
            this.listFace.style.paddingBottom = "1px";
            this.btnFace = this.gel.childNodes[7];
            this.btnFace.style.display = "none";
            this.btnFace.style.width = "18px";
            this.btnFace.style.position = "absolute";
            this.btnFace.style.paddingRight = "1px";
            this.btnFace.style.paddingTop = "1px";
            this.btnFace.style.paddingBottom = "1px";
            var c = DNA.engine.application.getJWTEventMgr();
            c.handleSelfEvent(this, "scroll", this.tDiv);
            if (DNA.engine.Client.isIE()) {
                c.handleSelfEvent(this, "propertychange", this.inputProxy)
            } else {
                if (DNA.engine.Client.isFF()) {
                    c.handleSelfEvent(this, "input", this.inputProxy)
                }
            }
            if (DNA.engine.Client.isIE()) {
                c.handleSelfEvent(this, "mousewheel", this.gel)
            } else {
                if (DNA.engine.Client.isFF()) {
                    c.handleSelfEvent(this, "DOMMouseScroll", this.gel)
                }
            }
            this.setCellEditorProvider(new DNA.widget.CellEditorProviderAsync());
            if (this.getInitData().defEditorId) {
                this.defEditorId = this.getInitData().defEditorId;
                delete this.getInitData().defEditorId
            }
            if (this.getInitData().rowHeights) {
                this.rowHeights = this.getInitData().rowHeights;
                delete this.getInitData().rowHeights
            }
            if (this.getInitData().colWidths) {
                this.colWidths = this.getInitData().colWidths;
                delete this.getInitData().colWidths
            }
            if (this.getInitData().rowHiddens) {
                this.rowHiddens = this.getInitData().rowHiddens;
                delete this.getInitData().rowHiddens
            }
            this.hiddenRows = new Array();
            this.hiddenCols = new Array();
            this.updateCurrentCellColor();
            this._initFormatter();
            if (!this.isEnabled()) {
                this._disableGrid(this)
            }
            this.mergeDivs = this._buildMergeDivs();
            this._buildTakenDiv();
            this._resizeTablesNCovers();
            this.parentIframe = this.util.getNearestIframeOfDom(this.getEl());
            this._makeParentIframePaintInIE()
        } catch (a) {
            return false
        }
    },
    _buildMergeDivs: function() {
        var b = [this.hcDiv.childNodes[1].firstChild, this.gel.childNodes[1].firstChild, this.hrDiv, this.hltDiv];
        var a = [];
        for (var g = 0; g < b.length; g++) {
            var h = b[g];
            var d = h.childNodes;
            for (var c = 0; c < d.length; c++) {
                if (d[c].className.indexOf("gridMergeRect") > 0) {
                    a.push(d[c])
                }
            }
        }
        return a
    },
    _buildTakenDiv: function() {
        this.utrs = [this.tDiv.firstChild, this.hcDiv.firstChild.firstChild];
        this.dtrs = [this.tDiv.lastChild, this.hcDiv.firstChild.lastChild]
    },
    _makeParentIframePaintInIE: function() {
        if (DNA.engine.Client.isIE() && this.parentIframe) {
            var a = this.parentIframe.style.display;
            this.parentIframe.style.display = "none";
            this.parentIframe.style.display = a
        }
    },
    _resizeTablesNCovers: function() {
        var a = DNA.engine.DomUtil.getClientSize(this.getEl());
        if (a.width === 0 || a.height === 0) {
            return
        }
        DNA.engine.DomUtil.setSize(this.tDiv, a);
        DNA.engine.DomUtil.setSize(this.cwDiv.parentNode, this._getClientSizeWithoutScrollbar())
    },
    _afterGridCreate: function() {
        if (!(this.getEl().tagName == "IFRAME")) {
            if (this.getInitData().selections) {
                var d = this.getInitData().selections;
                delete this.getInitData().selections;
                var b = d.length;
                for (var c = 0; c < b; ++c) {
                    this.addSelection(d.get(c))
                }
            }
            if (this.getInitData().currentCell) {
                var a = this.getInitData().currentCell;
                delete this.getInitData().currentCell;
                this.setCurrentCell(a)
            }
            if (this.getInitData().open_editor) {
                delete this.getInitData().open_editor;
                this.openCurrentEditor()
            }
            this._placeAllCellHTML()
        }
        this._ajustLockedSections()
    },
    _placeAllCellHTML: function(c, b) {
        if (c && c.length) {
            for (var g = 0; g < c.length; g++) {
                this._placeCellHTML(c[g], b[g])
            }
        } else {
            for (var a = this.renderedTop, h = this.renderedTop + this.renderedCount; a < h; a++) {
                for (var g = 0, d = this.getColumnCount(); g < d; g++) {
                    this._placeCellHTML(this._getCellDom(g, a, this.tDiv), this.cwDiv)
                }
                for (var g = 0, d = this.getHeaderColumnCount(); g < d; g++) {
                    this._placeCellHTML(this._getCellDom(g, a, this.hcTable), this.hccwDiv)
                }
            }
        }
    },
    _placeCellHTML: function(a, c) {
        if (a.html) {
            return
        }
        if (!c) {
            var b = a.parentNode.parentNode;
            if (b === this.hcDiv) {
                c = this.hccwDiv
            } else {
                if (b === this.tDiv) {
                    c = this.cwDiv
                }
            }
        }
        if (a && c && a.getAttribute("html")) {
            var d = a.cloneNode(true);
            c.appendChild(d);
            a.htmlDiv = d;
            d.style.top = a.parentNode.offsetTop + "px"
        }
    },
    _removeAllCellHTML: function(c, b) {
        if (c && c.length) {
            for (var g = 0; g < c.length; g++) {
                this._removeCellHTML(c[g], b[g])
            }
        } else {
            for (var a = this.renderedTop, h = this.renderedTop + this.renderedCount; a < h; a++) {
                for (var g = 0, d = this.getColumnCount(); g < d; g++) {
                    this._removeCellHTML(this._getCellDom(g, a, this.tDiv), this.cwDiv)
                }
                for (var g = 0, d = this.getHeaderColumnCount(); g < d; g++) {
                    this._removeCellHTML(this._getCellDom(g, a, this.hcTable), this.hccwDiv)
                }
            }
        }
    },
    _removeCellHTML: function(a, c) {
        if (!c) {
            var b = a.parentNode.parentNode;
            if (b === this.hcDiv) {
                c = this.hccwDiv
            } else {
                if (b === this.tDiv) {
                    c = this.cwDiv
                }
            }
        }
        if (a && c && a.getAttribute("html")) {
            var d = a.htmlDiv;
            if (d) {
                d.parentNode.removeChild(d)
            }
        }
    },
    _resizeGridDiv: function() {
        if (this.getEl().tagName == "IFRAME") {
            this.gel = this.getEl().contentWindow.document.body.firstChild;
            var a = DNA.engine.DomUtil.getClientSize(this.getEl());
            this.gel.style.height = a.height + "px";
            this.gel.style.width = a.width + "px"
        }
    },
    _resizeChildren: function(b) {
        var d = b.getChildren();
        for (var c = 0, a = d.length; c < a; c++) {
            var g = d[c];
            g.setBounds(0, 0, 0, 0)
        }
    },
    replace2Iframe: function(a) {
        this._replaceDom(a)
    },
    _replaceDom: function(a) {
        this.replacing = true;
        if (this.initFlag) {
            delete this.initFlag
        }
        if (this.tDiv) {
            DNA.engine.application.getJWTEventMgr().deleteSelfEvent(this, "scroll", this.tDiv)
        }
        if (this.inputProxy) {
            if (DNA.engine.Client.isIE()) {
                DNA.engine.application.getJWTEventMgr().deleteSelfEvent(this, "propertychange", this.inputProxy)
            } else {
                if (DNA.engine.Client.isFF()) {
                    DNA.engine.application.getJWTEventMgr().deleteSelfEvent(this, "input", this.inputProxy)
                }
            }
        }
        if (DNA.engine.Client.isIE()) {
            DNA.engine.application.getJWTEventMgr().deleteSelfEvent(this, "mousewheel", this.inputProxy)
        } else {
            if (DNA.engine.Client.isFF()) {
                DNA.engine.application.getJWTEventMgr().deleteSelfEvent(this, "DOMMouseScroll", this.inputProxy)
            }
        }
        this.currentCell = null ;
        this.selectionAreas.length = 0;
        this.hiddenRows.length = 0;
        this.hiddenCols.length = 0;
        this.currentRow = -1;
        this.currentCol = -1;
        this.tDiv = null ;
        this.hrDiv = null ;
        this.hrTable = null ;
        this.hcDiv = null ;
        this.hcTable = null ;
        this.hltDiv = null ;
        this.hltTab = null ;
        this.resizeRowIdx = 0;
        this.resizeColIdx = 0;
        this.resizeRowPoint = null ;
        this.resizeColPoint = null ;
        this.resizeDiv = null ;
        this.newSize = 0;
        this.mouseCell = null ;
        this.lastMouseCell = {
            x: -1,
            y: -1
        };
        this.selBeginCell = {
            x: 0,
            y: 0
        };
        this.selectionDiv = null ;
        this.operateCell = null ;
        this.operateArea = null ;
        this.activeEditor = null ;
        this.curFace = null ;
        this.gridState = DNA.widget.JWTGrid.STATE_NORMAL;
        this._clearChildrenEl(this);
        if (a) {
            DNA.widget.GridAsync.superclass.replace2Iframe.call(this, a)
        }
        this._unmaskState(DNA.JWT.STATE_RENDERD);
        this._makeParentIframePaintInIE()
    },
    _clearChildrenEl: function(b) {
        var d = b.getChildren();
        for (var c = 0, a = d.length; c < a; c++) {
            var g = d[c];
            if (g.getChildren) {
                if (g.getChildren()) {
                    this._clearChildrenEl(g)
                }
            }
            if (g.el) {
                g.fireEvent("beforeReplace");
                g._unmaskState(DNA.JWT.STATE_RENDERD);
                if (g.el) {
                    g.el = null 
                }
            }
        }
    },
    _isResizeable: function() {
        if (this.getEl()) {
            return true
        }
    },
    doDispose: function() {
        DNA.widget.GridAsync.superclass.doDispose.call(this);
        delete this.gel;
        delete this.tDiv;
        delete this.cwDiv;
        delete this.selectionDiv;
        delete this.resizeDiv;
        delete this.curFace;
        delete this.hrDiv;
        delete this.hcDiv;
        delete this.hltDiv;
        delete this.mCurLeft;
        delete this.mCurRight;
        delete this.mCurTop;
        delete this.mCurBottom;
        delete this.curLeft;
        delete this.curRight;
        delete this.curTop;
        delete this.curBottom;
        delete this.currentCell;
        delete this.operateCell;
        delete this.operateArea;
        delete this.selectionAreas
    },
    _ajustLockedSections: function() {
        var a = DNA.engine.DomUtil.getClientSize(this.getEl());
        if (a.width === 0 || a.height === 0) {
            return
        }
        if (this.tDiv) {
            a = this._getClientSizeWithoutScrollbar()
        }
        this._adjustRowDomWidth();
        this._ajustHCSize(a);
        this._ajustHRSize(a);
        this._ajustHLTSize(a)
    },
    _adjustRowDomWidth: function() {
        var c = this.colWidths[0]
          , a = this.colWidths[0];
        for (var d = 1, b = this.getHeaderColumnCount(); d < b; d++) {
            c += this.colWidths[d]
        }
        for (var d = 1, b = this.getColumnCount(); d < b; d++) {
            a += this.colWidths[d]
        }
        this._adjustRowDomWidth2Tables([this.hcTable, this.hltTab], c);
        this._adjustRowDomWidth2Tables([this.tDiv, this.hrTable], a)
    },
    _adjustRowDomWidth2Tables: function(c, d) {
        for (var b = 0; b < c.length; b++) {
            var g = c[b];
            for (var a = 0; a < g.childNodes.length; a++) {
                g.childNodes[a].style.width = d + "px"
            }
        }
    },
    adjustLockDiv: function(b, c) {
        var a = this._computeLockDivSize(b, c);
        DNA.engine.DomUtil.setSize(c, a)
    },
    adjustLockDivWithCover: function(b, c) {
        var a = this._computeLockDivSize(b, c);
        DNA.engine.DomUtil.setSize(c, a);
        DNA.engine.DomUtil.setSize(c.childNodes[1], a)
    },
    _computeLockDivSize: function(c, a) {
        var o = DNA.engine.DomUtil.getClientSize(this.getEl());
        var g = a.scrollWidth;
        var b = c.width;
        var n = a.scrollHeight;
        var l = c.height;
        var m = g <= b ? g : b;
        var d = n <= l ? n : l;
        o.width = m;
        o.height = d;
        return o
    },
    _getClientSizeWithoutScrollbar: function() {
        var a = DNA.engine.DomUtil.getClientSize(this.getEl());
        var b = DNA.engine.DomUtil.getSize(this.getEl());
        if (this.tDiv.scrollHeight > b.height && b.width < a.width + 10) {
            a.width = b.width - 17 - (b.width - a.width)
        }
        if (this.tDiv.scrollWidth > b.width && b.height < a.height + 10) {
            a.height = b.height - 17 - (b.height - a.height)
        }
        if (this.tDiv.scrollWidth < (b.width - 17) && a.height == b.height - 17) {
            a.height = b.height
        }
        if (this.tDiv.scrollHeight < (b.height - 17) && a.width == b.width - 17) {
            a.width = b.width
        }
        return a
    },
    _doAfterParentVisible: function() {
        if (!this.gel) {
            return
        }
        if (this.getEl() && this.getEl().tagName == "IFRAME") {
            var c = DNA.engine.DomUtil.getClientSize(this.getEl());
            var a = this.getEl().contentWindow.document.body;
            if (a.offsetHeight == 0) {
                this.getEl().contentWindow.document.documentElement.id = ""
            }
            DNA.engine.DomUtil.setSize(this.gel, c)
        }
        this._ajustLockedSections()
    },
    _ajustHCSize: function(a) {
        this.adjustLockDivWithCover(a, this.hcDiv)
    },
    _ajustHRSize: function(a) {
        this.adjustLockDiv(a, this.hrDiv)
    },
    _ajustHLTSize: function(a) {
        this.adjustLockDiv(a, this.hltDiv)
    },
    _buildHeaderCols: function(b) {
        if (!this.checkRendered(true)) {
            return
        }
        var c = b.hc;
        var a = b.hlt;
        DNA.engine.DomUtil.insertAfter(this.hcDiv, c);
        this.hcDiv = this.hcDiv.nextSibling;
        this.hccwDiv = this.hcDiv.childNodes[1].firstChild;
        this.hcTable = this.hcDiv.firstChild;
        this.hcDiv.parentNode.removeChild(this.hcDiv.previousSibling);
        DNA.engine.DomUtil.insertAfter(this.hltDiv, a);
        this.hltDiv = this.hltDiv.nextSibling;
        this.hltTab = this.hltDiv.firstChild;
        this.hltDiv.parentNode.removeChild(this.hltDiv.previousSibling);
        this._buildTakenDiv();
        this.operateCell = null ;
        this.hColCount = b.count;
        this._ajustLockedSections();
        if (this.currentCell) {
            this._drawCurrentCellBack();
            this._drawCurrentCell(this.currentCell)
        }
    },
    _buildHeaderRows: function(c) {
        if (!this.checkRendered(true)) {
            return
        }
        var b = c.hr;
        var a = c.hlt;
        DNA.engine.DomUtil.insertAfter(this.hrDiv, b);
        this.hrDiv = this.hrDiv.nextSibling;
        this.hrTable = this.hrDiv.firstChild;
        this.hrDiv.parentNode.removeChild(this.hrDiv.previousSibling);
        DNA.engine.DomUtil.insertAfter(this.hltDiv, a);
        this.hltDiv = this.hltDiv.nextSibling;
        this.hltTab = this.hltDiv.firstChild;
        this.hltDiv.parentNode.removeChild(this.hltDiv.previousSibling);
        this._buildTakenDiv();
        this.operateCell = null ;
        this.hRowCount = c.count;
        this._ajustLockedSections();
        if (this.currentCell) {
            this._drawCurrentCellBack();
            this._drawCurrentCell(this.currentCell)
        }
    },
    _insertRowHelper: function(a, g) {
        var c = a.childNodes;
        var b = c.length;
        for (var d = 1; d < b; ++d) {
            g.appendChild(c[1])
        }
        a.appendChild(g)
    },
    _focus: function() {
        var a = this.getEl();
        if (a) {
            DNA.engine.DomUtil.addClass(a, "focus")
        }
        this._focusDom();
        this.updateCurrentCellColor()
    },
    _blur: function() {
        var a = this.getEl();
        if (a) {
            DNA.engine.DomUtil.removeClass(a, "focus")
        }
        this.updateCurrentCellColor()
    },
    _registEvents: function() {
        var a = DNA.engine.application.getJWTEventMgr();
        a.addListener("mousemove", this._onGlobalMousemove, this);
        a.addListener("mouseup", this._onGlobalMouseup, this);
        a.addListener("scroll", this._onScroll, this);
        a.addBubbleListener("keydown", this.onBubbleKeyDown, this);
        this.addListener("dblclick", this._onDblclick);
        this.addListener("mousedown", this._onMousedown);
        if (DNA.engine.Client.isIE()) {
            this.addListener("propertychange", this._onProxyChange)
        } else {
            if (DNA.engine.Client.isFF()) {
                this.addListener("input", this._onProxyChange)
            }
        }
        if (DNA.engine.Client.isIE()) {
            this.addListener("mousewheel", this._onMousewheel)
        } else {
            if (DNA.engine.Client.isFF()) {
                this.addListener("DOMMouseScroll", this._onMousewheel)
            }
        }
        this.addListener("keydown", this._onKeyDown);
        this.addListener("dragover", this._doDragOver);
        this.addListener("resize", this._doResize);
        a.addListener("predispose", this._doBeforeDispose, this);
        a.addListener(DNA.JWTEvent.POSTVISIBLE, this._doAfterVisible, this);
        this.addListener("focus", this._onFocus);
        this.addListener("blur", this._onBlur);
        a.addListener(DNA.JWTEvent.PRE_DISABLED, this._onDisable, this)
    },
    _onMousewheel: new DNA.engine.Action({
        handle: function(b) {
            var a = b.getOriginalEvent();
            var c = a.detail ? a.detail * (-20) : a.wheelDelta;
            this.tDiv.scrollTop -= c
        }
    }),
    _onDisable: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            this._disableGrid(a)
        }
    }),
    _disableGrid: function(b) {
        try {
            if (b.isAncestorOf(this)) {
                if (this.tDiv) {
                    this.tDiv.scrollTop = 0;
                    this.tDiv.scrollLeft = 0;
                    this._handleScroll()
                }
            }
        } catch (a) {}
    },
    _onFocus: new DNA.engine.Action({
        handle: function(a) {
            try {
                this._focusDom()
            } catch (a) {}
        }
    }),
    onBubbleKeyDown: new DNA.engine.PreventableAction({
        handle: function(a) {
            if (!a.isCtrl() && !a.isAlt() && a.getKeyCode() == DNA.JWTEvent.ENTER) {
                this.keyEnterDown(a);
                a.preventDefault()
            }
        }
    }),
    _onBlur: new DNA.engine.Action({
        handle: function(a) {
            try {
                this._blurInputProxy()
            } catch (a) {}
        }
    }),
    _onProxyChange: new DNA.engine.Action({
        handle: function(g) {
            if (!this.checkRendered(true)) {
                return
            }
            if (!this.currentCell) {
                return
            }
            if (DNA.engine.Client.isIE()) {
                var c = g.getOriginalEvent().propertyName;
                if (c != "value") {
                    return
                }
            }
            var h = this.inputProxy.value;
            if (!h || h == "") {
                return
            }
            if (this.activeEditor) {
                return
            }
            var b = this.currentCell.getColIndex();
            var l = this.currentCell.getRowIndex();
            if ((this.getEditMode() != DNA.widget.JWTGrid.EDIT_MODE_READONLY) && this.util.isCellEditable(b, l)) {
                var a = this.getCell(b, l);
                var d = new DNA.widget.AbstractGridCellAsync(this,null ,b,l,false);
                this.openEditor(d, null , false, DNA.widget.JWTGrid.EDITOPEN_INPUT, h)
            } else {
                this.inputProxy.value = "";
                this.inputProxy.blur()
            }
        }
    }),
    _onGlobalMouseup: new DNA.engine.AppSuspendedAction({
        handle: function(h) {
            if (this.replacing) {
                return
            }
            if (!this.checkRendered(true)) {
                return
            }
            if (!this.isEnabled()) {
                return
            }
            var n = DNA.engine.DomUtil.getSize(this.tDiv);
            if (n.x == 0 || n.y == 0) {
                return
            }
            var m = h.getSrcElement();
            var b = h.getSrcControl();
            if (!this.isDraging()) {
                if (this.mousedownonSelf) {
                    if (b == this) {
                        this.fireEvent("gridClick", [h])
                    }
                    this.mousedownonSelf = false
                }
                return
            }
            var d = h.getXY();
            var g = this._getPageBounds();
            var c = this.getBounds();
            var l = {
                x: d.x - g.x,
                y: d.y - g.y
            };
            h.setSrcControl(this);
            h.setLocation(l);
            var a = this.getCellByCoordinate(l.x, l.y);
            if (!a && !this.isDraging()) {
                this.gridState = DNA.widget.JWTGrid.STATE_OUT;
                return
            }
            this.mouseCell = a;
            switch (this.gridState) {
            case DNA.widget.JWTGrid.STATE_ROW_SELECT:
                this.rowSelectEnd(h);
                break;
            case DNA.widget.JWTGrid.STATE_COL_SELECT:
                this.colSelectEnd(h);
                break;
            case DNA.widget.JWTGrid.STATE_ALL_SELECT:
                this.allSelectEnd(h);
                break;
            case DNA.widget.JWTGrid.STATE_CELL_SELECT:
                this.mouseCellSelectEnd(h);
                break;
            case DNA.widget.JWTGrid.STATE_ROW_RESIZE:
                this.rowResizeEnd(h);
                break;
            case DNA.widget.JWTGrid.STATE_COL_RESIZE:
                this.colResizeEnd(h);
                break
            }
            if (this.gridState != DNA.widget.JWTGrid.STATE_ROW_RESIZE && this.gridState != DNA.widget.JWTGrid.STATE_COL_RESIZE) {
                if (this.mousedownonSelf && b == this) {
                    this.fireEvent("gridClick", [h])
                }
            }
            this.mousedownonSelf = false;
            this.gridState = DNA.widget.JWTGrid.STATE_NORMAL
        }
    }),
    isDraging: function() {
        return !(this.gridState != DNA.widget.JWTGrid.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid.STATE_ROW_RESIZE && this.gridState != DNA.widget.JWTGrid.STATE_CELL_SELECT && this.gridState != DNA.widget.JWTGrid.STATE_ROW_SELECT && this.gridState != DNA.widget.JWTGrid.STATE_COL_SELECT && this.gridState != DNA.widget.JWTGrid.STATE_ALL_SELECT)
    },
    _findEventCtrol: function(b) {
        var c = b;
        while (c && c.nodeType == 1) {
            if (c.id) {
                var a = DNA.widget.WidgetRegistry.get(c.id);
                if (a instanceof DNA.widget.Control) {
                    return a
                }
            }
            c = c.parentNode
        }
        return null 
    },
    _onGlobalMousemove: new DNA.engine.Action({
        handle: function(h) {
            if (this.replacing) {
                return
            }
            if (!this.checkRendered(true)) {
                return
            }
            if (!this.isEnabled()) {
                return
            }
            var m = h.getSrcElement();
            var a = this._findEventCtrol(m);
            if (a != this && this.gridState != DNA.widget.JWTGrid.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid.STATE_ROW_RESIZE) {
                if (this.cellOut) {
                    if (this.cellOut.x != -1) {
                        this.fireEvent("cellout", [this, {
                            x: this.cellOut.x,
                            y: this.cellOut.y
                        }])
                    }
                }
                this.cellOut = null ;
                return
            }
            if (h.getButton() != 0 && !this.selectFinish) {
                this.gridState = DNA.widget.JWTGrid.STATE_NORMAL;
                this.mouseCellSelectEnd(h);
                return
            }
            var n = DNA.engine.DomUtil.getSize(this.tDiv);
            if (n.x == 0 || n.y == 0) {
                return
            }
            if (m == this.tDiv && this.gridState != DNA.widget.JWTGrid.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid.STATE_ROW_RESIZE) {
                return
            }
            var d = h.getXY();
            var g = this._getPageBounds();
            var c = this.getBounds();
            var l = {
                x: d.x - g.x,
                y: d.y - g.y
            };
            h.setSrcControl(this);
            h.setLocation(l);
            var b = this.getCellByCoordinate(l.x, l.y);
            if (!b && this.gridState != DNA.widget.JWTGrid.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid.STATE_ROW_RESIZE) {
                this.gridState = DNA.widget.JWTGrid.STATE_OUT;
                return
            }
            this.mouseCell = b;
            if (b) {
                if (this.cellOut) {
                    if (this.cellOut.x != -1) {
                        if (!(b.x == this.cellOut.x && b.y == this.cellOut.y)) {
                            this.fireEvent("cellout", [this, {
                                x: this.cellOut.x,
                                y: this.cellOut.y
                            }]);
                            this.fireEvent("cellin", [this, {
                                x: this.mouseCell.x,
                                y: this.mouseCell.y,
                                width: l.x,
                                height: l.y
                            }])
                        }
                    }
                } else {
                    this.fireEvent("cellin", [this, {
                        x: this.mouseCell.x,
                        y: this.mouseCell.y,
                        width: l.x,
                        height: l.y
                    }])
                }
            }
            this.cellOut = this.mouseCell;
            switch (this.gridState) {
            case DNA.widget.JWTGrid.STATE_ROW_SELECT:
                this.rowSelecting(h);
                break;
            case DNA.widget.JWTGrid.STATE_COL_SELECT:
                this.colSelecting(h);
                break;
            case DNA.widget.JWTGrid.STATE_CELL_SELECT:
                this.mouseCellSelecting(h);
                this._autoScroll(h);
                break;
            case DNA.widget.JWTGrid.STATE_ROW_RESIZE:
                this.rowResizing(h);
                break;
            case DNA.widget.JWTGrid.STATE_COL_RESIZE:
                this.colResizing(h);
                break;
            default:
                this.updateCursor(h);
                break
            }
        }
    }),
    _onDblclick: new DNA.engine.Action({
        handle: function(g) {
            if (!this.checkRendered(true)) {
                return
            }
            var b = g.getSrcElement();
            this.resizeRowIdx = 0;
            this.resizeColIdx = 0;
            if (this.getEditMode() === DNA.widget.JWTGrid.EDIT_MODE_READONLY) {
                return
            }
            if (b == this.tDiv) {
                return
            }
            var c = g.getLocation();
            var a = this.getCellByCoordinate(c.x, c.y);
            if (!a) {
                return
            }
            if (this.util.isCellSelectable(a.x, a.y)) {
                this.setCurrentCell(a, null , null , null , g.getButton());
                if (!this._stopDbClick) {
                    if (this.currentCell && this.util.isCellEditable(this.currentCell.getColIndex(), this.currentCell.getRowIndex())) {
                        var d = new DNA.widget.AbstractGridCellAsync(this,null ,a.x,a.y,false);
                        this.openEditor(d, g, true, DNA.widget.JWTGrid.EDITOPEN_DBCLICK)
                    }
                }
            }
        }
    }),
    _doBeforeDispose: new DNA.engine.Action({
        handle: function(g) {
            if (g.isAncestorOf(this)) {
                var d = DNA.engine.application.getJWTEventMgr();
                d.deleteSelfEvent(this, "scroll", this.tDiv);
                d.deleteSelfEvent(this, "propertychange", this.inputProxy);
                if (DNA.engine.Client.isIE() && DNA.engine.Client.getBrowserVersion() <= 7) {
                    var h = this.util.getDocumentOfElement(this.tDiv).getElementsByTagName("head")[0];
                    for (var c = 0, b = h.childNodes.length; c < b; c++) {
                        var a = h.childNodes[c].getAttribute("gsid");
                        if (a && a == this._eid) {
                            h.removeChild(h.childNodes[c]);
                            return
                        }
                    }
                }
            }
        }
    }),
    _doAfterVisible: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            if (a.isAncestorOf(this)) {
                this._doAfterParentVisible()
            }
        }
    }),
    _doResize: new DNA.engine.Action({
        handle: function(b) {
            if (!this._isResizeable()) {
                return
            }
            if (this.getEl() && this.tDiv) {
                if (this.getEl().tagName == "IFRAME") {
                    var a = DNA.engine.DomUtil.getClientSize(this.getEl());
                    DNA.engine.DomUtil.setSize(this.tDiv, a)
                }
                this._resizeTablesNCovers();
                this._ajustLockedSections();
                this._adjustScroll()
            }
        }
    }),
    _doDragOver: new DNA.engine.Action({
        handle: function(c) {
            if (!this.checkRendered(true)) {
                return
            }
            if (!this.getEl()) {
                return
            }
            var b = c.getXY();
            var a = DNA.engine.DomUtil.getPageXY(this.getEl());
            a = {
                x: b.x - a.x,
                y: b.y - a.y
            };
            a = this.getCellByCoordinate(a.x, a.y);
            if (a) {
                this.posInfo = a.x + "," + a.y
            } else {
                this.posInfo = "-1,-1"
            }
        }
    }),
    _onMouseOut: new DNA.engine.Action({
        handle: function(a) {
            if (!this.checkRendered(true)) {
                return
            }
        }
    }),
    _onScroll: new DNA.engine.Action({
        handle: function(a) {
            if (!this.checkRendered(true)) {
                return
            }
            var b = a.getSrcElement();
            if (b != this.tDiv) {
                return
            }
            this._handleScroll();
            this._handleLoad();
            this.fireEvent("currentCellOffsetChanged", [this]);
            this.fireEvent("scrolled", [this])
        }
    }),
    _handleLoad: function() {
        var b = (new Date()).getMilliseconds();
        this.loadTimeStamp = b;
        var a = this;
        setTimeout((function() {
            a._handleLoadStuff(b)
        }), 100)
    },
    _handleLoadStuff: function(a) {
        if (this.loadTimeStamp == a) {
            if (this._needLoad()) {
                this.fireEvent("load", [this])
            }
        }
    },
    _needLoad: function() {
        var d = this.getBounds();
        var a = parseInt(this.utrs[0].style.height);
        var g = this.dtrs[0].offsetTop;
        var b = a > 0 && a > this.tDiv.scrollTop;
        var c = this.tDiv.scrollTop + d.height > g;
        return b || c
    },
    _handleScroll: function() {
        if (this.cwDiv) {
            this.cwDiv.parentNode.scrollLeft = this.tDiv.scrollLeft;
            this.cwDiv.parentNode.scrollTop = this.tDiv.scrollTop
        }
        if (this.hrDiv) {
            this.hrDiv.scrollLeft = this.tDiv.scrollLeft
        }
        if (this.hcDiv) {
            this.hcDiv.scrollTop = this.tDiv.scrollTop
        }
    },
    setHorizontalPosition: function(a) {
        if (this.tDiv) {
            this.tDiv.scrollLeft = a;
            this._handleScroll()
        }
    },
    setVerticalPosition: function(a) {
        if (this.tDiv) {
            this.tDiv.scrollTop = a;
            this._handleScroll()
        }
    },
    _onMousedown: new DNA.engine.Action({
        handle: function(d) {
            if (!this.checkRendered(true)) {
                return
            }
            this.needHandleGlobal = true;
            var n = d.getSrcElement();
            this.mousedownonSelf = true;
            if (d.getButton() == 2) {
                var l = d.getLocation();
                var m = this.getCellByCoordinate(l.x, l.y);
                if (!m) {
                    return
                }
                if (this._cellSelected(m)) {
                    return
                } else {
                    if (this.util.isCellSelectable(m.x, m.y)) {
                        this._clearSelection(true);
                        this.setCurrentCell(m, null , null , null , d.getButton())
                    }
                }
                return
            }
            if (d.getButton() != 0) {
                return
            }
            if (this.getSelectionMode() == DNA.widget.JWTGrid.SELECTION_MODE_ROW) {
                var l = d.getLocation();
                var m = this.getCellByCoordinate(l.x, l.y);
                if (!m) {
                    return
                }
                if (this._cellSelected(m)) {
                    if (this.util.isCellSelectable(m.x, m.y)) {
                        this.setCurrentCell(m, null , null , null , d.getButton())
                    }
                    var a = this.mouseCell;
                    if ((!d.isCtrl() && !d.isShift()) || (d.isCtrl() && d.isShift())) {
                        var h;
                        this.setCurrentCell(a, null , null , null , d.getButton());
                        var g = {
                            x: 1,
                            y: a.y,
                            width: this.columnCount - 1,
                            height: a.y
                        };
                        for (var c = this.selectionAreas.length - 1; c >= 0; c--) {
                            if (this.util.rectEqual(this.selectionAreas[c], g)) {
                                h = this.selectionAreas[c];
                                this.selectionAreas.removeAt(c)
                            }
                        }
                        if (!h) {
                            h = new DNA.widget.GridSelectionArea(this,g,true,null ,false)
                        }
                        this._setSelection(h);
                        this.setCurrentSelection(h)
                    }
                    return
                }
            }
            if (n == this.tDiv) {
                return
            }
            this.updateGridState(d);
            switch (this.gridState) {
            case DNA.widget.JWTGrid.STATE_CELL_OPENEDITOR:
                if (this.currentCell) {
                    var b = new DNA.widget.AbstractGridCell(this,null ,this.currentCell.getColIndex(),this.currentCell.getRowIndex(),false);
                    this.openEditor(b, d, true, DNA.widget.JWTGrid.EDITOPEN_CLICKFACE)
                }
                break;
            case DNA.widget.JWTGrid.STATE_ROW_SELECT:
                this.rowSelectStart(d);
                break;
            case DNA.widget.JWTGrid.STATE_ALL_SELECT:
                this.allSelectStart(d);
                break;
            case DNA.widget.JWTGrid.STATE_COL_SELECT:
                this.colSelectStart(d);
                break;
            case DNA.widget.JWTGrid.STATE_CELL_SELECT:
                this.mouseCellSelectStart(d);
                break
            }
            d._preventDefault()
        }
    }),
    _cellSelected: function(b) {
        for (var c = 0, a = this.selectionAreas.length; c < a; ++c) {
            var d = this.selectionAreas[c];
            if (b.x >= d.x && b.x <= d.width && b.y >= d.y && b.y <= d.height) {
                return true
            }
        }
        return false
    },
    updateGridState: function(c) {
        if (this.columnCount <= 1 || this.rowCount <= 1) {
            this.gridState = DNA.widget.JWTGrid.STATE_OUT;
            return
        }
        var a = c.getLocation();
        if (this.resizeRowIdx) {
            this.gridState = DNA.widget.JWTGrid.STATE_ROW_RESIZE;
            var d = null ;
            if (this.resizeRowIdx >= this.hRowCount) {
                d = this._getCellDom(-1, this.resizeRowIdx, this.hcTable)
            } else {
                d = this._getCellDom(this.resizeColIdx, -1, this.hrTable)
            }
            this.resizeRowPoint = {
                x: 0,
                y: d.offsetTop
            };
            return
        }
        if (this.resizeColIdx) {
            this.gridState = DNA.widget.JWTGrid.STATE_COL_RESIZE;
            var d = null ;
            if (this.resizeColIdx >= this.hColCount) {
                d = this._getCellDom(this.resizeColIdx, -1, this.hrTable);
                this.resizeColPoint = {
                    x: d.offsetLeft,
                    y: 0
                }
            } else {
                d = this._getCellDom(this.resizeColIdx, -1, this.hcTable);
                this.resizeColPoint = {
                    x: d.offsetLeft + this.tDiv.scrollLeft,
                    y: 0
                }
            }
            return
        }
        var b = this.getCellByCoordinate(a.x, a.y);
        if (!b) {
            this.gridState = DNA.widget.JWTGrid.STATE_OUT;
            return
        }
        this.mouseCell = b;
        this.lastMouseCell = b;
        if (b.x === 0 && b.y === 0) {
            if (this.getSelectionMode() == DNA.widget.JWTGrid.SELECTION_MODE_MULTI) {
                this.gridState = DNA.widget.JWTGrid.STATE_ALL_SELECT
            }
            return
        }
        if (b.x === 0 && b.y > 0) {
            if (this.getRowSelectEnabled() && this.getSelectionMode() == DNA.widget.JWTGrid.SELECTION_MODE_MULTI) {
                this.gridState = DNA.widget.JWTGrid.STATE_ROW_SELECT
            }
            return
        }
        if (b.y === 0 && b.x > 0) {
            if (this.getColSelectEnabled() && this.getSelectionMode() == DNA.widget.JWTGrid.SELECTION_MODE_MULTI) {
                this.gridState = DNA.widget.JWTGrid.STATE_COL_SELECT
            }
            return
        }
        if (b.x > 0 && b.y > 0) {
            if (!this.util.isCellSelectable(b.x, b.y)) {
                this.gridState = DNA.widget.JWTGrid.STATE_NORMAL;
                return
            }
            if (this._clickFaceArea(b, a.x, a.y)) {
                this.gridState = DNA.widget.JWTGrid.STATE_CELL_OPENEDITOR;
                return
            }
            this.gridState = DNA.widget.JWTGrid.STATE_CELL_SELECT
        }
    },
    _clickFaceArea: function(g, c, l) {
        if (!this.curFace) {
            return false
        }
        if (this.currentCell) {
            if ((this.currentCell.getRowIndex() <= g.y && this.currentCell.getColIndex() <= g.x && this.currentCell.getRowIndex() + this.currentCell.td.rowSpan - 1 >= g.y && this.currentCell.getColIndex() + this.currentCell.td.colSpan - 1 >= g.x) ) {
                if (c > this.hcDiv.offsetWidth && this.tDiv.scrollLeft) {
                    c += this.tDiv.scrollLeft
                }
                if (l > this.hrDiv.offsetHeight && this.tDiv.scrollTop) {
                    l += this.tDiv.scrollTop
                }
                var b = this.currentCell.td.offsetLeft;
                var h = this.currentCell.td.parentNode.offsetTop;
                var d = this.currentCell.td.offsetWidth;
                var a = this.currentCell.td.offsetHeight;
                if (c >= b + d - 18 && c <= b + d && l >= h && l <= h + a) {
                    return true
                }
                return false
            }
        }
        return false
    },
    _onMouseup: function(d) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = d.getSrcElement();
        a.style.cursor = "default";
        var b = d.getLocation();
        var c = this.getCellByCoordinate(b.x, b.y);
        if (!c && this.gridState != DNA.widget.JWTGrid.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid.STATE_ROW_RESIZE) {
            this.gridState = DNA.widget.JWTGrid.STATE_OUT;
            return
        }
        this.mouseCell = c;
        switch (this.gridState) {
        case DNA.widget.JWTGrid.STATE_ROW_SELECT:
            this.rowSelectEnd(d);
            break;
        case DNA.widget.JWTGrid.STATE_COL_SELECT:
            this.colSelectEnd(d);
            break;
        case DNA.widget.JWTGrid.STATE_CELL_SELECT:
            this.mouseCellSelectEnd(d);
            break;
        case DNA.widget.JWTGrid.STATE_ROW_RESIZE:
            this.rowResizeEnd(d);
            break;
        case DNA.widget.JWTGrid.STATE_COL_RESIZE:
            this.colResizeEnd(d);
            break
        }
        this.gridState = DNA.widget.JWTGrid.STATE_NORMAL
    },
    rowSelectEnd: function(a) {
        if (this.currentSelection) {
            this.currentSelection.reBuild(true);
            this._internalDrawTitle(this.currentSelection, false, true);
            this.fireEvent("selection", [this])
        }
    },
    colSelectEnd: function(a) {
        if (this.currentSelection) {
            this.currentSelection.reBuild(true);
            this.fireEvent("selection", [this])
        }
    },
    allSelectEnd: function(a) {
        if (this.currentSelection) {
            this.currentSelection.reBuild(true);
            this.fireEvent("selection", [this])
        }
    },
    rowResizeEnd: function(b) {
        if (this.resizeRowIdx && this.newSize != -1) {
            var a = b.getSrcElement();
            a.style.cursor = "default";
            this.tDiv.style.cursor = "default";
            this.setRowHeight(this.resizeRowIdx, this.newSize);
            this.resizeDiv.style.display = "none";
            this.resizeDiv.style.height = "0px";
            this.fireEvent("rowresize", [this, this.resizeRowIdx]);
            this.resizeRowIdx = 0;
            this.resizeColIdx = 0;
            this.newSize = -1;
            this._reBoundCurCell();
            return
        }
    },
    colResizeEnd: function(b) {
        if (this.resizeColIdx && this.newSize != -1) {
            var a = b.getSrcElement();
            a.style.cursor = "default";
            this.tDiv.style.cursor = "default";
            this.setColumnWidth(this.resizeColIdx, this.newSize);
            this.resizeDiv.style.display = "none";
            this.resizeDiv.style.width = "0px";
            this.fireEvent("columnresize", [this, this.resizeColIdx]);
            this.resizeColIdx = 0;
            this.resizeRowIdx = 0;
            this.newSize = -1;
            this._reBoundCurCell();
            return
        }
    },
    rowSelecting: function(c) {
        if (this.lastMouseCell.y != this.mouseCell.y) {
            this.lastMouseCell = this.mouseCell;
            if (this.currentSelection) {
                var d = Math.min(this.currentRow, this.mouseCell.y);
                var b = Math.max(this.currentRow, this.mouseCell.y);
                var a = {
                    x: 1,
                    y: d,
                    width: this.columnCount - 1,
                    height: b
                };
                this.currentSelection._setBound(a);
                this.currentSelection.redraw()
            }
        }
    },
    colSelecting: function(d) {
        if (this.lastMouseCell.x != this.mouseCell.x) {
            this.lastMouseCell = this.mouseCell;
            if (this.currentSelection) {
                var b = Math.min(this.currentCol, this.mouseCell.x);
                var a = Math.max(this.currentCol, this.mouseCell.x);
                var c = {
                    x: b,
                    y: 1,
                    width: a,
                    height: this.rowCount - 1
                };
                this.currentSelection._setBound(c);
                this.currentSelection.redraw()
            }
        }
    },
    rowResizing: function(b) {
        if (this.resizeRowIdx) {
            var a = b.getSrcElement();
            a.style.cursor = "row-resize";
            this._placeResizeDiv(b.getLocation().y)
        }
    },
    colResizing: function(b) {
        if (this.resizeColIdx) {
            var a = b.getSrcElement();
            a.style.cursor = "col-resize";
            this._placeResizeDiv(b.getLocation().x)
        }
    },
    updateCursor: function(g) {
        var b = this.mouseCell;
        var l = g.getSrcElement();
        var h = g.getLocation();
        this.resizeColIdx = 0;
        this.resizeRowIdx = 0;
        var c = this._getCellDom(-1, b.y, this.tDiv);
        var n = c.parentNode.offsetTop;
        var m = c.offsetHeight;
        if ((h.y + this.tDiv.scrollTop >= n + m - this.resizeCursorBound && h.y + this.tDiv.scrollTop <= n + m) || (h.y + this.tDiv.scrollTop >= n && h.y + this.tDiv.scrollTop <= n + this.resizeCursorBound)) {
            if ((b.x == 0 || this.getRowFreeResizeEnabled()) && b.y > 0 && this.getRowResizeEnable()) {
                if (b.y > this.hRowCount && this.tDiv.scrollTop) {
                    h.y += this.tDiv.scrollTop
                }
                if (b.y == 1) {
                    if (h.y >= n + m - this.resizeCursorBound && h.y <= n + m) {
                        this.resizeRowIdx = 1;
                        l.style.cursor = "row-resize"
                    } else {
                        this.resizeRowIdx = 0;
                        l.style.cursor = "default"
                    }
                } else {
                    if (h.y >= n + m - this.resizeCursorBound && h.y <= n + m) {
                        this.resizeRowIdx = this.util.getUpRow(b.y + 1);
                        l.style.cursor = "row-resize"
                    } else {
                        if (h.y >= n && h.y <= n + this.resizeCursorBound) {
                            this.resizeRowIdx = this.util.getUpRow(b.y);
                            l.style.cursor = "row-resize"
                        }
                    }
                }
                return
            }
        }
        c = this._getHeaderCellDom(b.x, 0);
        var d = c.offsetLeft;
        var a = c.offsetWidth;
        if ((h.x + this.tDiv.scrollLeft >= d + a - this.resizeCursorBound && h.x + this.tDiv.scrollLeft <= d + a) || (h.x + this.tDiv.scrollLeft >= d && h.x + this.tDiv.scrollLeft <= d + this.resizeCursorBound)) {
            if ((b.y == 0 || this.getColFreeResizeEnabled()) && b.x > 0 && this.getColResizeEnable()) {
                if (b.x > this.hColCount && this.tDiv.scrollLeft) {
                    h.x += this.tDiv.scrollLeft
                }
                if (b.x == 1) {
                    if (h.x >= d + a - this.resizeCursorBound && h.x <= d + a) {
                        this.resizeColIdx = 1;
                        l.style.cursor = "col-resize"
                    } else {
                        this.resizeColIdx = 0;
                        l.style.cursor = "default"
                    }
                } else {
                    if (h.x >= d + a - this.resizeCursorBound && h.x <= d + a) {
                        this.resizeColIdx = this.util.getLeftCol(b.x + 1);
                        l.style.cursor = "col-resize"
                    } else {
                        if (h.x >= d && h.x <= d + this.resizeCursorBound) {
                            this.resizeColIdx = this.util.getLeftCol(b.x);
                            l.style.cursor = "col-resize"
                        } else {
                            this.resizeColIdx = 0;
                            l.style.cursor = "default"
                        }
                    }
                }
                return
            }
        }
        l.style.cursor = "default";
        this.resizeColIdx = 0;
        this.resizeRowIdx = 0
    },
    _onKeyDown: new DNA.engine.Action({
        handle: function(a) {
            if (!this.checkRendered(true)) {
                return
            }
            if (this.currentCol === -1 || this.currentRow === -1) {
                return
            }
            switch (a.getKeyCode()) {
            case DNA.JWTEvent.LEFT:
            case DNA.JWTEvent.RIGHT:
            case DNA.JWTEvent.UP:
            case DNA.JWTEvent.DOWN:
            case DNA.JWTEvent.HOME:
            case DNA.JWTEvent.END:
                this.keydownNavigation(a);
                a._preventDefault();
                break;
            case DNA.JWTEvent.ENTER:
                this.keyEnterDown(a);
                a._preventDefault();
                break;
            case DNA.JWTEvent.DELETE:
                if (this.getEditMode() != DNA.widget.JWTGrid.EDIT_MODE_READONLY) {
                    this.deleteText(DNA.widget.JWTGrid.DATACHANGE_DEL)
                }
                a._preventDefault();
                break;
            case 86:
                if (a.isCtrl()) {
                    if (this.getEditMode() != DNA.widget.JWTGrid.EDIT_MODE_READONLY) {
                        this.pasteText()
                    }
                    a._preventDefault()
                }
                break;
            case 67:
                if (a.isCtrl()) {
                    var b = this.copyText();
                    if (b) {
                        DNA.adapter.ClipboardUtil.copyToClipboard(b)
                    }
                    a._preventDefault()
                }
                break;
            case 88:
                if (a.isCtrl()) {
                    if (this.getEditMode() != DNA.widget.JWTGrid.EDIT_MODE_READONLY) {
                        var b = this.cutText();
                        if (b) {
                            DNA.adapter.ClipboardUtil.copyToClipboard(b)
                        }
                    }
                    a._preventDefault()
                }
                break;
            case 77:
                break;
            case 85:
                break;
            case DNA.JWTEvent.F2:
                this.openCurrentEditor();
                break
            }
        }
    }),
    _deleteData: function(a) {},
    _pasteData: function(a) {},
    _copyData: function(a) {},
    _cutData: function(a) {},
    deleteText: function(g) {
        var b = this.selectionAreas.length;
        for (var c = 0; c < b; ++c) {
            this._deleteText(this.selectionAreas[c], g)
        }
        var h = this.getCurrentCell();
        if (h) {
            var a = this.getCell(h.x, h.y);
            if (a.getShowText()) {
                var d = {
                    x: h.x,
                    y: h.y,
                    width: h.x,
                    height: h.y
                };
                this._deleteText(d, g)
            }
        }
    },
    _deleteText: function(g, h) {
        var b = false;
        for (var d = g.y; d <= g.height; ++d) {
            if (this.ignoreHidden && this.getRowHidden(d)) {
                continue
            }
            for (var c = g.x; c <= g.width; ++c) {
                if (this.ignoreHidden && this.getColHidden(c)) {
                    continue
                }
                if (this.util.isCellEditable(c, d)) {
                    var a = this.getCell(c, d);
                    a.setShowText("", true);
                    a.setEditText("", true);
                    b = true
                }
            }
        }
        if (b) {
            this.fireDataChangeEvent(g, h)
        }
    },
    pasteText: function() {
        var b = this.getCurrentCell();
        if (b) {
            var a = {
                x: b.x,
                y: b.y,
                width: 1,
                height: 1
            };
            this._pasteText(a)
        }
    },
    _trimEnd: function(b) {
        if (!b || b.length == 0) {
            return b
        }
        var a = b.length;
        for (var c = a - 1; c >= 0; --c) {
            if (!b[c]) {
                --a
            }
            break
        }
        b.length = a;
        return b
    },
    _pasteText: function(a) {
        var b = this;
        DNA.adapter.ClipboardUtil.getClipboard(function(l) {
            var u = a.x + "," + a.y;
            var B = {
                doit: true
            };
            b.fireEvent("paste", [b, l, u, B]);
            if (!B.doit) {
                return
            }
            var c;
            if (DNA.engine.Client.isFF()) {
                c = l.split("\n")
            } else {
                c = l.split("\r\n")
            }
            c = b._trimEnd(c);
            var n = c.length;
            if (n > 0) {
                var v = Math.min(b.rowCount - 1, a.y + n - 1);
                var s = 0;
                for (var A = 0; A < n; A++) {
                    var h = c[A].split("\t");
                    s = Math.max(s, h.length)
                }
                var g;
                if (s > 0) {
                    g = Math.min(b.columnCount - 1, a.x + s - 1)
                }
                var z = false;
                var m = a.y - 1;
                var t = a.x - 1;
                for (var A = a.y; A <= v; ++A) {
                    var p = c[A - a.y].split("\t");
                    t = a.x - 1;
                    m = b.util.getDownRow(m);
                    for (var w = a.x; w <= g; ++w) {
                        var d = null ;
                        if (!b.ignoreHidden) {
                            d = b.getCell(w, A)
                        } else {
                            t = b.util.getRightCol(t);
                            if (b.util.isDataCell(t, m)) {
                                d = b.getCell(t, m)
                            }
                        }
                        if (d && b.util.isCellEditable(d.getColIndex(), d.getRowIndex())) {
                            var q = p[w - a.x];
                            if (!q) {
                                q = ""
                            }
                            if (q.indexOf("image://") == 0) {
                                d.setShowText("image://", true);
                                d.setEditText(q.substr(8), true)
                            } else {
                                d.setEditText(q, true);
                                var o = b.getFormattedText(d);
                                if (o) {
                                    d.setShowText(o, true)
                                } else {
                                    d.setShowText(q, true)
                                }
                            }
                            z = true
                        }
                    }
                }
                if (z) {
                    var r = {
                        x: a.x,
                        y: a.y,
                        width: g,
                        height: v
                    };
                    b.fireDataChangeEvent(r, DNA.widget.JWTGrid.DATACHANGE_PASTE)
                }
            }
        })
    },
    copyText: function() {
        var a = this.getCurrentSelection();
        var b = null ;
        if (a) {
            b = a
        } else {
            var d = this.getCurrentCell();
            if (d) {
                b = {
                    x: d.x,
                    y: d.y,
                    width: d.x,
                    height: d.y
                }
            }
        }
        if (b) {
            var c = {
                doit: true
            };
            this.fireEvent("copy", [this, {
                x: b.x,
                y: b.y,
                width: b.width,
                height: b.height
            }, c]);
            if (!c.doit) {
                return null 
            }
            return this._copyText(b)
        }
        return null 
    },
    cutText: function() {
        var a = this.getCurrentSelection();
        if (a) {
            var b = this._cutText(a);
            if (b) {
                this.fireDataChangeEvent(a, DNA.widget.JWTGrid.DATACHANGE_CUT);
                return b
            }
        }
        return null 
    },
    _copyText: function(a) {
        return this._getText(a, false)
    },
    _cutText: function(a) {
        return this._getText(a, true)
    },
    _getText: function(h, d) {
        var n = "";
        var a = /\r\n/g;
        for (var c = h.y; c <= h.height; ++c) {
            if (this.ignoreHidden && this.getRowHidden(c)) {
                continue
            }
            for (var b = h.x; b <= h.width; ++b) {
                if (this.ignoreHidden && this.getColHidden(b)) {
                    continue
                }
                var m = this.getCell(b, c);
                var g = m.getShowText();
                if (!g) {
                    g = ""
                }
                g = g.replace(a, "\n");
                n += g;
                if ("image://" == g) {
                    var l = m.getEditText();
                    if (l) {
                        n += l
                    }
                }
                if (b != h.width) {
                    n += "\t"
                }
                if (d && m.getEditable()) {
                    m.setShowText("", true);
                    m.setEditText("", true)
                }
            }
            if (c != h.height) {
                n += "\r\n"
            }
        }
        return n
    },
    toString: function() {
        return "GridAsync"
    },
    _placeResizeDiv: function(c) {
        if (!this.checkRendered(true)) {
            return
        }
        if (this.resizeRowIdx) {
            if (this.tDiv.scrollTop && this.resizeRowIdx >= this.hRowCount) {
                c += this.tDiv.scrollTop
            }
            this.resizeDiv.style.display = "block";
            this.resizeDiv.style.left = this.resizeRowPoint.x + "px";
            this.resizeDiv.style.top = this.resizeRowPoint.y + "px";
            this.resizeDiv.style.width = this.tDiv.offsetWidth + "px";
            var a = c - this.resizeRowPoint.y;
            if (a <= this.minRowHeight) {
                a = this.minRowHeight
            }
            this.newSize = a;
            this.resizeDiv.style.height = a + "px";
            return
        }
        if (this.resizeColIdx) {
            c += this.tDiv.scrollLeft;
            this.resizeDiv.style.display = "block";
            this.resizeDiv.style.left = this.resizeColPoint.x + "px";
            this.resizeDiv.style.top = this.resizeColPoint.y + "px";
            this.resizeDiv.style.height = this.tDiv.offsetHeight + "px";
            var b = c - this.resizeColPoint.x;
            if (b <= this.minColWidth) {
                b = this.minColWidth
            }
            this.newSize = b;
            this.resizeDiv.style.width = b + "px";
            return
        }
    },
    _getRowDom: function(a, b) {
        if (!this.checkRendered(true)) {
            return
        }
        var d = null ;
        try {
            if (b != this.tDiv && b != this.hcTable) {
                d = b.childNodes[a + 2]
            } else {
                if (a >= this.renderedTop && a <= this.renderedTop + this.renderedCount) {
                    d = b.childNodes[a - this.renderedTop + 2]
                }
            }
        } catch (c) {
            alert("�����ڵ�" + a + "��")
        }
        return d
    },
    _getRowCell: function(d, b, g) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = null ;
        try {
            a = d.childNodes[b + 1]
        } catch (c) {
            alert("���������Ϊ(" + b + "," + g + ")�ĵ�Ԫ��")
        }
        if (!a) {
            throw "���������Ϊ(" + b + "," + g + ")�ĵ�Ԫ��"
        }
        return a
    },
    _getCellDom: function(g, d, n, l, a) {
        if (!this.checkRendered(true)) {
            return
        }
        var h = null ;
        if (d == -1) {
            try {
                h = n.childNodes[1].childNodes[g + 1]
            } catch (c) {
                alert("���������Ϊ(" + g + "," + d + ")�ĵ�Ԫ��")
            }
        }
        var b = l ? l : this.renderedTop;
        var m = a ? a : this.renderedTop + this.renderedCount;
        if (d >= b && d <= m) {
            try {
                h = n.childNodes[d - b + 2].childNodes[g + 1]
            } catch (c) {
                alert("���������Ϊ(" + g + "," + d + ")�ĵ�Ԫ��")
            }
        }
        return h
    },
    _getHeaderCellDom: function(b, d) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = null ;
        try {
            a = this.hrTable.childNodes[d + 2].childNodes[b + 1]
        } catch (c) {
            alert("���������Ϊ(" + b + "," + d + ")�ĵ�Ԫ��")
        }
        return a
    },
    getCellByCoordinate: function(b, a) {
        if (!this.checkRendered(true)) {
            return
        }
        if (b < 0 || a,
        0) {
            return null 
        }
        var c = this.getBounds();
        if (b > c.width || a > c.height) {
            return null 
        }
        if (b > this.hcDiv.offsetWidth && this.tDiv.scrollLeft) {
            b += this.tDiv.scrollLeft
        }
        if (a > this.hrDiv.offsetHeight && this.tDiv.scrollTop) {
            a += this.tDiv.scrollTop
        }
        var o = {
            x: -1,
            y: -1
        };
        var l = parseInt(this.utrs[0].style.height, 10);
        for (var h = this.renderedTop; h < this.renderedTop + this.renderedCount; h++) {
            if (!this.getRowHidden(h)) {
                var n = this.rowHeights[h] + l;
                if (a >= l && a < n) {
                    o.y = h;
                    break
                } else {
                    l = n
                }
            }
        }
        var m = 0;
        for (var d = 0; d < this.columnCount; d++) {
            if (!this.getColHidden(d)) {
                var g = this.colWidths[d] + m;
                if (b >= m && b < this.colWidths[d] + m) {
                    o.x = d;
                    break
                } else {
                    m = g
                }
            }
        }
        return o
    },
    _getMidDisplayRow: function(d, b) {
        var c = Math.floor((d + b) / 2);
        var g = this.tDiv.childNodes[c];
        var a = g;
        while (a.style.display == "none" && d < c) {
            c--;
            a = this.tDiv.childNodes[c]
        }
        if (this.tDiv.childNodes[c].style.display != "none") {
            return c
        }
        c = Math.floor((d + b) / 2);
        a = g;
        while (a.style.display == "none" && c < b) {
            c++;
            a = this.tDiv.childNodes[c]
        }
        if (this.tDiv.childNodes[c].style.display != "none") {
            return c
        }
        return -1
    },
    getCellByPoint: function(l, h) {
        if (!this.checkRendered(true)) {
            return
        }
        var n = {
            x: -1,
            y: -1
        };
        var g = 1;
        var b = this.rowCount;
        var m;
        while (g <= b) {
            m = Math.floor((g + b) / 2);
            var d = this.tDiv.childNodes[m];
            var p = d.offsetTop;
            var a = d.offsetHeight;
            if (h > p + a) {
                g = m + 1
            } else {
                if (h < p) {
                    b = m - 1
                } else {
                    n.y = m - 1;
                    break
                }
            }
        }
        g = 1;
        b = this.columnCount;
        var d = this.tDiv.childNodes[0];
        while (g <= b) {
            m = Math.floor((g + b) / 2);
            var o = d.childNodes[m];
            var q = o.offsetLeft;
            var c = o.offsetWidth;
            if (l > q + c) {
                g = m + 1
            } else {
                if (l < q) {
                    b = m - 1
                } else {
                    n.x = m - 1;
                    break
                }
            }
        }
        if (n.x == -1 || n.y == -1) {
            return null 
        }
        return n
    },
    getCell: function(a, b) {
        if (!this.checkRendered(true)) {
            return
        }
        if (a < 0 || a >= this.columnCount || b < 0 || b >= this.rowCount) {
            return null 
        }
        if (this.operateCell && (a == this.operateCell.getColIndex()) && (b == this.operateCell.getRowIndex())) {
            return this.operateCell
        } else {
            this.operateCell = new DNA.widget.GridCellAsync(this,a,b);
            return this.operateCell
        }
    },
    getGridArea: function(a) {
        if (a.x == this.operateArea.left && a.y == this.operateArea.top && a.width == this.operateArea.right && a.height == this.operateArea.bottom) {
            return this.operateArea
        }
        return new DNA.widget.GridArea(this,a)
    },
    _canMerge: function(m, l, h, b) {
        if (!this.checkRendered(true)) {
            return false
        }
        if (m <= 0 || m > h || h >= this.columnCount) {
            return false
        }
        if (l <= 0 || l > b || b >= this.rowCount) {
            return false
        }
        if (m == h && l == b) {
            return false
        }
        if (m < this.hColCount && h >= this.hColCount) {
            return false
        }
        if (l < this.hRowCount && b >= this.hRowCount) {
            return false
        }
        var d, a;
        for (var g = l; g <= b; ++g) {
            d = this._getCellDom(m, g, this.tDiv);
            a = this._getCellDom(h, g, this.tDiv);
            if (d.isSpan || a.isSpan) {
                return false
            }
        }
        for (var c = m; c <= h; ++c) {
            d = this._getCellDom(c, l, this.tDiv);
            a = this._getCellDom(c, b, this.tDiv);
            if (d.isSpan || a.isSpan) {
                return false
            }
        }
        return true
    },
    merge: function(l, h, c, b) {
        if (!this._canMerge(l, h, c, b)) {
            return false
        }
        this.clearSelection();
        var g = c - l + 1;
        var d = b - h + 1;
        var a = new DNA.widget.AbstractGridCellAsync(this,this.tDiv,l,h,true);
        a.merge(g, d, this.cwDiv);
        if (l < this.hColCount) {
            a = new DNA.widget.AbstractGridCellAsync(this,this.hcTable,l,h,true);
            a.merge(g, d, this.hccwDiv)
        }
        if (h < this.hRowCount) {
            a = new DNA.widget.AbstractGridCellAsync(this,this.hrTable,l,h,true);
            a.merge(g, d, this.hrDiv)
        }
        if (l < this.hColCount && h < this.hRowCount) {
            a = new DNA.widget.AbstractGridCellAsync(this,this.hltTab,l,h,true);
            a.merge(g, d, this.hltDiv)
        }
        this._reBoundCurCell();
        this._reBoundFace();
        return true
    },
    unmerge: function(a, c) {
        if (!this.checkRendered(true)) {
            return
        }
        this.clearSelection();
        var b = new DNA.widget.AbstractGridCellAsync(this,this.tDiv,a,c,true);
        b.unmerge(this.cwDiv);
        if (a < this.hColCount) {
            var b = new DNA.widget.AbstractGridCellAsync(this,this.hcTable,a,c,true);
            b.unmerge(this.hccwDiv)
        }
        if (c < this.hRowCount) {
            var b = new DNA.widget.AbstractGridCellAsync(this,this.hrTable,a,c,true);
            b.unmerge(this.hrDiv)
        }
        if (a < this.hColCount && c < this.hRowCount) {
            var b = new DNA.widget.AbstractGridCellAsync(this,this.hltTab,a,c,true);
            b.unmerge(this.hltDiv)
        }
        this._reBoundCurCell();
        this._reBoundFace()
    },
    _adjustScroll: function() {
        var g = DNA.engine.DomUtil.getClientSize(this.gel);
        var d = this.tDiv.scrollLeft ? this.tDiv.scrollLeft : 0;
        var b = this.tDiv.scrollTop ? this.tDiv.scrollTop : 0;
        var h = DNA.engine.DomUtil.getSize(this.tDiv);
        if (h.width > g.width && g.width + d > h.width) {
            var c = h.width - g.width;
            this.tDiv.scrollLeft = c;
            if (this.hrDiv) {
                this.hrDiv.scrollLeft = this.tDiv.scrollLeft
            }
        }
        if (h.height > g.height && g.height + b > h.height) {
            var a = h.height - g.height;
            this.tDiv.scrollTop = a;
            if (this.hcDiv) {
                this.hcDiv.scrollTop = this.tDiv.scrollTop
            }
        }
    },
    adjustRowHeight: function(c) {
        if (!this.checkRendered(true)) {
            return
        }
        if (!this.util.isDataRow(c)) {
            return
        }
        var b = this._getCellDom(-1, c, this.tDiv);
        if (b.getAttribute("hf")) {
            return
        }
        var a = b.offsetHeight;
        this._getCellDom(-1, c, this.hcTable).style.height = this._getPXSize(a);
        if (c < this.hRowCount) {
            this._getCellDom(-1, c, this.hltTab).style.height = this._getPXSize(a);
            this._getCellDom(-1, c, this.hrTable).style.height = this._getPXSize(a)
        }
        this._ajustLockedSections();
        this._reBoundCurCell();
        this._reComputeSelections(c, -1);
        this._reBoundFace()
    },
    setRowHeight: function(o, v) {
        if (!this.checkRendered(true)) {
            return
        }
        if (!this.util.isDataRow(o)) {
            return
        }
        if (v < this.minRowHeight) {
            return
        }
        if (this.getRowHidden(o)) {
            return
        }
        this._resizeRowHeight2Cells(this.tDiv, o, v);
        this._resizeRowHeight2Cells(this.hcTable, o, v);
        if (o < this.hRowCount) {
            this._resizeRowHeight2Cells(this.hltTab, o, v);
            this._resizeRowHeight2Cells(this.hrTable, o, v)
        }
        this._ajustLockedSections();
        this._reBoundCurCell();
        this._reComputeSelections(o, -1);
        this._adjustScroll();
        this._reBoundFace();
        this.rowHeights[o] = v;
        if (o >= this.renderedTop && o < this.renderedTop + this.renderedCount) {
            for (var E = 0, D = this.getColumnCount(); E < D; E++) {
                var H = this.getCell(E, o);
                H.rePositionTextWrapper();
                var b = H.td.htmlDiv;
                if (b) {
                    H._rePositionTextWrapper(b)
                }
            }
        }
        var l = [this.tDiv, this.hcTable];
        for (var w = 0; w < l.length; w++) {
            var F = l[w];
            for (var E = this.renderedTop, D = this.renderedTop + this.renderedCount; E < D; E++) {
                for (var C = 0, B = F.childNodes[1].childNodes.length - 1; C < B; C++) {
                    var h = this._getCellDom(C, E, F);
                    var b = h.htmlDiv;
                    if (b) {
                        b.style.top = h.parentNode.offsetTop + "px"
                    }
                }
            }
        }
        for (var D = 0; D < this.mergeDivs.length; D++) {
            var G = this.mergeDivs[D];
            var u = parseInt(G.getAttribute("ri"));
            var p = parseInt(G.getAttribute("ci"));
            var g = parseInt(G.getAttribute("rs"));
            var d = parseInt(G.getAttribute("cs"));
            var a, r;
            if (u <= o && u + g > o) {
                a = new DNA.widget.IGridCellAsync(this);
                a.td = G;
                r = DNA.engine.DomUtil.getInnerText(G.firstChild);
                var A = 0;
                for (var E = 0; E < d; E++) {
                    var z = p + E;
                    if (!this.getColHidden(z)) {
                        A += this.getColumnWidth(z)
                    }
                }
                var v = 0;
                for (var E = 0; E < g; E++) {
                    var t = u + E;
                    if (!this.getRowHidden(t)) {
                        v += this.getRowHeight(t)
                    }
                }
                var s = this.util.reVertAlignDiv(v, A, a.isWrapLine(), r, a.getFont(), G.firstChild, a.getVertAlign())
            }
        }
        this._resizeNRepositionStaffs4RowChange(o)
    },
    _resizeRowHeight2Cells: function(d, m, b) {
        if (b >= 0) {
            var l = b - this.rowHeights[m];
            var g = d.childNodes[m + 2];
            g.style.height = this._getPXSize(b);
            b -= 1;
            for (var c = 0; c < g.childNodes.length; c++) {
                var a = g.childNodes[c];
                a.style.height = this._getPXSize(b);
                var h = a.htmlDiv;
                if (h) {
                    h.style.height = this._getPXSize(b)
                }
            }
        }
    },
    getRowHeight: function(a) {
        if (!this.checkRendered(true)) {
            return 0
        }
        if (a < 0 || a >= this.rowCount) {
            return 0
        }
        return this.rowHeights[a]
    },
    getRowHeightFromStyle: function(c) {
        if (!this.checkRendered(true)) {
            return 0
        }
        if (c < 0 || c >= this.rowCount) {
            return 0
        }
        var a = 0;
        var b = this._getCellDom(0, c, this.tDiv);
        if (b) {
            a = parseInt(b.style.height, 10)
        }
        return a
    },
    setColumnWidth: function(q, a) {
        if (!this.checkRendered(true)) {
            return
        }
        if (!this.util.isDataCol(q)) {
            return
        }
        if (a < this.minColWidth) {
            return
        }
        if (q <= 0 || q >= this.columnCount) {
            return
        }
        var n = this._getCellDom(q, -1, this.tDiv);
        if (n.getAttribute("hf")) {
            return
        }
        this._resizeColumnWidth2Cells(this.tDiv, q, a);
        this._resizeColumnWidth2Cells(this.hrTable, q, a);
        if (q < this.hColCount) {
            this._resizeColumnWidth2Cells(this.hltTab, q, a);
            this._resizeColumnWidth2Cells(this.hcTable, q, a)
        }
        this._reBoundCurCell();
        this._reComputeSelections(-1, q);
        this._adjustScroll();
        this._reBoundFace();
        this._resizeCoverSizeAfterWidthChange(q, a - this.colWidths[q]);
        this.colWidths[q] = a;
        this._ajustLockedSections();
        for (var g = this.renderedTop, d = this.renderedTop + this.renderedCount; g < d; g++) {
            this.getCell(q, g).rePositionTextWrapper()
        }
        for (var d = 0; d < this.mergeDivs.length; d++) {
            var t = this.mergeDivs[d];
            var o = parseInt(t.getAttribute("ri"));
            var u = parseInt(t.getAttribute("ci"));
            var c = parseInt(t.getAttribute("rs"));
            var h = parseInt(t.getAttribute("cs"));
            var p, s;
            if (u <= q && u + h > q) {
                p = new DNA.widget.IGridCellAsync(this);
                p.td = t;
                s = DNA.engine.DomUtil.getInnerText(t.firstChild);
                var a = 0;
                for (var g = 0; g < h; g++) {
                    var m = u + g;
                    if (!this.getColHidden(m)) {
                        a += this.getColumnWidth(m)
                    }
                }
                var r = 0;
                for (var g = 0; g < c; g++) {
                    var b = o + g;
                    if (!this.getRowHidden(b)) {
                        r += this.getRowHeight(b)
                    }
                }
                var l = this.util.reVertAlignDiv(r, a, p.isWrapLine(), s, p.getFont(), t.firstChild, p.getVertAlign())
            }
        }
        this._resizeNRepositionStaffs4WidthChange(q)
    },
    _resizeColumnWidth2Cells: function(o, m, a) {
        if (a >= 0) {
            var l = a - this.colWidths[m];
            for (var g = 1; g < o.childNodes.length - 1; g++) {
                var p = o.childNodes[g];
                p.style.width = this._getPXSize((parseInt(p.style.width, 10) + l));
                var n = p.childNodes[m + 1];
                n.style.width = this._getPXSize((a - this._getWidthTrim()));
                var h = n.htmlDiv;
                if (h) {
                    h.style.width = n.style.width
                }
                for (var c = m + 2, b = p.childNodes.length; c < b; c++) {
                    var d = p.childNodes[c];
                    d.style.left = (parseInt(d.style.left, 10) + l) + "px";
                    var h = d.htmlDiv;
                    if (h) {
                        h.style.left = d.style.left
                    }
                }
            }
        }
    },
    _resizeCoverSizeAfterWidthChange: function(a, b) {
        this.cwDiv.style.width = this._getPXSize((parseInt(this.cwDiv.style.width, 10) + b));
        if (a < this.getHeaderColumnCount()) {
            this.hccwDiv.style.width = this._getPXSize((parseInt(this.hccwDiv.style.width, 10) + b))
        }
    },
    _resizeCoverSizeAfterHeightChange: function(b, a) {
        this.cwDiv.style.height = this._getPXSize((parseInt(this.cwDiv.style.height, 10) + a));
        this.hccwDiv.style.height = this._getPXSize((parseInt(this.hccwDiv.style.height, 10) + a))
    },
    _getWidthTrim: function() {
        return DNA.engine.Client.isIE() ? 1 : 5
    },
    _resizeNRepositionStaffs4WidthChange: function(b) {
        this._reBoundCurCell();
        if (this.activeEditor) {
            this.activeEditor.reBoundCtr()
        }
        var a = this.selectionAreas;
        var c;
        for (i = 0; i < a.length; i++) {
            c = a[i];
            c.redraw()
        }
        for (i = 0; i < this.mergeDivs.length; i++) {
            mdiv = this.mergeDivs[i];
            this._resizeMergeDiv(mdiv)
        }
    },
    _resizeNRepositionStaffs4RowChange: function(d) {
        this._reBoundCurCell();
        var b = 0;
        if (this.activeEditor) {
            this.activeEditor.reBoundCtr()
        }
        var a = this.selectionAreas;
        var c;
        for (b = 0; b < a.length; b++) {
            c = a[b];
            c.redraw()
        }
        for (b = 0; b < this.mergeDivs.length; b++) {
            mdiv = this.mergeDivs[b];
            this._resizeMergeDiv(mdiv)
        }
    },
    getColumnWidth: function(a) {
        if (!this.checkRendered(true)) {
            return 0
        }
        if (a < 0 || a >= this.columnCount) {
            return 0
        }
        return this.colWidths[a]
    },
    getColumnWidthCount: function(c, d) {
        var b = 0;
        for (var a = c; a < d; a++) {
            if (!this.getColHidden(a)) {
                b += this.colWidths[a]
            }
        }
        return b
    },
    getRowHeightCount: function(a, d) {
        var c = 0;
        for (var b = a; b < d; b++) {
            if (!this.getRowHidden(b)) {
                c += this.rowHeights[b]
            }
        }
        return c
    },
    getColumnWidthFromStyle: function(b) {
        if (!this.checkRendered(true)) {
            return 0
        }
        if (b < 0 || b >= this.columnCount) {
            return 0
        }
        var a = 0;
        var c = this._getCellDom(b, 0, this.tDiv);
        if (c) {
            a = parseInt(c.style.width, 10)
        }
        return a
    },
    insertRows: function(m, l) {
        if (!this.checkRendered(true)) {
            return
        }
        m -= 1;
        if (m < -1 || m >= this.rowCount) {
            return
        }
        var b = m;
        var r = [m + 1, 0];
        var n = m == -1 ? this.defRowHeight : this.rowHeights[b];
        for (var h = 0; h < l; h++) {
            r.push(n)
        }
        Array.prototype.splice.apply(this.rowHeights, r);
        var a = this.getCurrentCell();
        if (a && a.y > m) {
            this.setCurrentCellNoFire(null , null , null , null , null , DNA.widget.JWTGrid.SETCURRENTCELLCAUSE_PROGRAM)
        }
        this.operateCell = null ;
        this.operateArea = null ;
        this.closeEditor();
        this.clearSelection();
        if (m < this.renderedTop) {
            this.setUpTakenRowHeight(this.getUpTakenRowHeight() + this.rowHeights[b] * l)
        } else {
            if (m >= this.renderedTop && m < this.renderedTop + this.renderedCount) {
                if (!this._insertRows(this.tDiv, m, l, b)) {
                    return
                }
                this._insertRows(this.hcTable, m, l, b);
                this._changeRowTitle(this.hcTable, m)
            } else {
                this.setDownTakenRowHeight(this.getDownTakenRowHeight() + this.rowHeights[b] * l)
            }
        }
        var c = [this.cwDiv, this.hccwDiv];
        for (var h = 0; h < c.length; h++) {
            c[h].style.height = this._getPXSize(parseInt(c[h].style.height, 10) + (this.rowHeights[b] * l))
        }
        if (this.hRowCount != 0 && m < this.hRowCount) {
            this._insertRowCells(this.hrTable, m, l, b);
            this._insertRowCells(this.hltTab, m, l, b);
            this._changeRowTitle(this.hltTab, m);
            this.hRowCount += l
        }
        if (m < this.renderedTop) {
            this.renderedTop += l
        } else {
            if (m >= this.renderedTop && m < this.renderedTop + this.renderedCount) {
                this.renderedCount += l
            }
        }
        if (a && a.y > m) {
            a.y += l;
            this.setCurrentCellNoFire(a, null , null , null , null , DNA.widget.JWTGrid.SETCURRENTCELLCAUSE_PROGRAM)
        }
        this.rowCount += l;
        this._ajustLockedSections();
        for (var g = 0; g < this.mergeDivs.length; g++) {
            var o = this.mergeDivs[g];
            var q = parseInt(o.getAttribute("ri"), 10);
            var d = parseInt(o.getAttribute("rs"), 10);
            if (q < m + 1) {
                if (q + d > m + 1) {
                    o.setAttribute("rs", d + l);
                    o.style.height = this._getPXSize((parseInt(o.style.height, 10) + (l * n)))
                }
            } else {
                o.setAttribute("ri", q + l);
                o.style.top = this._getPXSize((parseInt(o.style.top, 10) + (l * n)))
            }
        }
    },
    _changeRowTitle: function(g, c) {
        var a = this.renderedTop + this.renderedCount;
        var h = c > this.renderedTop ? c : this.renderedTop;
        for (var d = h; d < a; ++d) {
            var l = this._getCellDom(0, d, g);
            if (l) {
                var b = l.getAttribute("st");
                if (b) {
                    DNA.engine.DomUtil.setInnerText(l, b)
                } else {
                    DNA.engine.DomUtil.setInnerText(l, d + "")
                }
            }
        }
    },
    _insertRows: function(r, p, o, a) {
        var q = this._insertRowCells(r, p, o, a);
        for (var c = 1, b = r.childNodes[1].childNodes.length - 1; c < b; c++) {
            for (var h = p + o, g = this.renderedTop + this.renderedCount + o; h < g; h++) {
                var d = this._getCellDom(c, h, r, this.renderedTop, this.renderedTop + this.renderedCount + o);
                var l = d.htmlDiv;
                if (l) {
                    l.style.top = d.parentNode.offsetTop + "px"
                }
            }
        }
        return q
    },
    _insertRowCells: function(t, m, l, b) {
        var r;
        var q = t.childNodes[1].childNodes.length - 1;
        var g = new Array(q + 1);
        var c = this._getRowDom(b, t);
        var n = t.childNodes.length - 1;
        if (m == -1) {
            var h = t.ownerDocument.createDocumentFragment();
            var s = t.childNodes[b + 1].cloneNode(false);
            var p = t.childNodes[0];
            for (var d = 0; d <= q; d++) {
                r = p.childNodes[d].cloneNode(false);
                if (d == 0) {
                    r.style.height = this._getPXSize(this.defRowHeight)
                }
                if (d == 1) {
                    r.className = "titleCell"
                } else {
                    r.className = "gridCell"
                }
                r.removeAttribute("st");
                DNA.engine.DomUtil.setInnerText(r, " ");
                s.appendChild(r)
            }
            for (var d = 0; d < l; ++d) {
                h.appendChild(s.cloneNode(true))
            }
            var o = p.parentNode;
            if (m == (n - 1)) {
                o.appendChild(h)
            } else {
                var a = t.childNodes[m + 2];
                o.insertBefore(h, a)
            }
        } else {
            g[0] = this._getCellDom(-1, b, t).cloneNode(false);
            g[0].removeAttribute("hf");
            for (var d = 0; d < q; d++) {
                r = new DNA.widget.AbstractGridCellAsync(this,t,d,m,false);
                g[d + 1] = this._getRowCell(c, d, b).cloneNode(false);
                g[d + 1].style.display = DNA.engine.Client.isIE() ? "inline" : "table-cell"
            }
            h = t.ownerDocument.createDocumentFragment();
            var s = this._getRowDom(b, t).cloneNode(false);
            s.style.display = "";
            var p = this._getRowDom(m, t);
            for (var d = 0; d <= q; ++d) {
                if (d > 1) {
                    g[d].className = g[d].className.replace("titleCellAsync", "gridCellAsync")
                } else {
                    g[d].style.borderColor = "";
                    g[d].style.backgroundColor = ""
                }
                g[d].removeAttribute("st");
                g[d].removeAttribute("et");
                g[d].innerText = " ";
                s.appendChild(g[d])
            }
            for (var d = 0; d < l; d++) {
                h.appendChild(s.cloneNode(true))
            }
            var o = p.parentNode;
            if (m == (n - 1)) {
                o.appendChild(h)
            } else {
                var a = this._getRowDom(m + 1, t);
                o.insertBefore(h, a)
            }
        }
        return true
    },
    deleteRows: function(q, d) {
        if (!this.checkRendered(true)) {
            return
        }
        if (q >= this.rowCount) {
            return
        }
        var b = q + d - 1;
        var t = this.getCurrentCell();
        if (t && t.y >= q) {
            this.setCurrentCell(null , null , null , null , null , DNA.widget.JWTGrid.SETCURRENTCELLCAUSE_PROGRAM)
        }
        var H = this.getRowHeightCount(q, q + d);
        var E = -1
          , A = -1;
        var F = -1
          , B = -1;
        var s = -1
          , o = -1;
        if (q < this.renderedTop) {
            if (b < this.renderedTop) {
                E = q;
                A = b
            } else {
                if (b < this.renderedTop + this.renderedCount) {
                    E = q;
                    A = this.renderedTop - 1;
                    F = A + 1;
                    B = b
                } else {
                    E = q;
                    A = this.renderedTop - 1;
                    F = A + 1;
                    B = this.renderedTop + this.renderedCount - 1;
                    s = B + 1;
                    o = b
                }
            }
        } else {
            if (q < this.renderedTop + this.renderedCount) {
                if (b >= this.renderedTop + this.renderedCount) {
                    F = q;
                    B = this.renderedTop + this.renderedCount - 1;
                    s = B + 1;
                    o = b
                } else {
                    F = q;
                    B = b
                }
            } else {
                s = q;
                o = b
            }
        }
        if (E > -1) {
            this.setUpTakenRowHeight(this.getUpTakenRowHeight() - this.getRowHeightCount(E, A))
        }
        if (F > -1) {
            var a = [];
            for (var w = B, u = this.renderedTop + this.renderedCount; w < u; w++) {
                for (var D = 0, C = this.getColumnCount(); D < C; D++) {
                    a.push(this._getCellDom(D, w, this.tDiv))
                }
                for (var D = 0, C = this.getHeaderColumnCount(); D < C; D++) {
                    a.push(this._getCellDom(D, w, this.hcTable))
                }
            }
            for (var w = F, u = B; w < u; w++) {
                for (var D = 0, C = this.getColumnCount(); D < C; D++) {
                    this._removeCellHTML(this._getCellDom(D, w, this.tDiv), this.cwDiv)
                }
                for (var D = 0, C = this.getHeaderColumnCount(); D < C; D++) {
                    this._removeCellHTML(this._getCellDom(D, w, this.hcTable), this.hccwDiv)
                }
            }
            if (!this._deleteRows(this.tDiv, F, B)) {
                return
            }
            this._deleteRows(this.hcTable, F, B);
            for (var D = 0; D < a.length; D++) {
                var h = a[D];
                var c = h.htmlDiv;
                if (c) {
                    c.style.top = h.parentNode.offsetTop + "px"
                }
            }
        }
        if (s > -1) {
            this.setDownTakenRowHeight(this.getDownTakenRowHeight() - this.getRowHeightCount(s, o))
        }
        if (E > -1) {
            this.renderedTop -= (A - E + 1)
        }
        if (F > -1) {
            this.renderedCount -= (B - F + 1)
        }
        this._changeRowTitle(this.hcTable, q);
        var l = [this.cwDiv, this.hccwDiv];
        for (var D = 0; D < l.length; D++) {
            l[D].style.height = this._getPXSize(parseInt(l[D].style.height, 10) - H)
        }
        this.clearSelection();
        this.operateCell = null ;
        this.operateArea = null ;
        if (q < this.hRowCount) {
            this._deleteRows(this.hrTable, q, b);
            this._deleteRows(this.hltTab, q, b);
            this._changeRowTitle(this.hcTable, q);
            var v = (b >= this.hRowCount) ? (this.hRowCount - q) : d;
            this.hRowCount -= v
        }
        this.rowCount -= d;
        this._ajustLockedSections();
        if (t && t.y > b) {
            t.y -= d;
            this.setCurrentCell(t, null , null , null , null , DNA.widget.JWTGrid.SETCURRENTCELLCAUSE_PROGRAM)
        }
        this._adjustScroll();
        if (this.rowCount > q) {
            this._fixIEDeleteProblem(q)
        }
        for (var z = this.mergeDivs.length - 1; z >= 0; z--) {
            var G = this.mergeDivs[z];
            var r = parseInt(G.getAttribute("ri"), 10);
            var g = parseInt(G.getAttribute("rs"), 10);
            if (r < q) {
                if (r + g >= q) {
                    if (r + g < q + d) {
                        G.setAttribute("rs", q - r);
                        G.style.height = this._getPXSize((parseInt(G.style.height, 10) - this.getRowHeightCount(q, r + g - q)))
                    } else {
                        G.setAttribute("rs", g - d);
                        G.style.height = this._getPXSize((parseInt(G.style.height, 10) - this.getRowHeightCount(q, q + d)))
                    }
                }
            } else {
                if (r >= q && r < q + d) {
                    G.parentNode.removeChild(G);
                    Array.prototype.splice.apply(this.mergeDivs, [z, 1])
                } else {
                    G.setAttribute("ri", r - d);
                    G.style.top = (parseInt(G.style.top, 10) - this.getRowHeightCount(q, q + d)) + "px"
                }
            }
        }
        Array.prototype.splice.apply(this.rowHeights, [q, d])
    },
    _deleteRows: function(d, b, a) {
        for (var c = a; c >= b; --c) {
            var g = this._getRowDom(c, d);
            d.removeChild(g)
        }
        return true
    },
    insertColumns: function(m, l) {
        if (!this.checkRendered(true)) {
            return
        }
        m -= 1;
        var h = [m + 1, 0];
        var b = m == -1 ? this.defColWidth : this.colWidths[m];
        for (var d = 0; d < l; d++) {
            h.push(b)
        }
        Array.prototype.splice.apply(this.colWidths, h);
        if (m < -1 || m >= this.columnCount) {
            return
        }
        var a = this.getCurrentCell();
        if (a && a.x > m) {
            this.setCurrentCellNoFire(null )
        }
        this.operateCell = null ;
        this.operateArea = null ;
        this.closeEditor();
        this.clearSelection();
        if (!this._insertCols(this.tDiv, m, l, m)) {
            return
        }
        this._insertCols(this.hrTable, m, l, m, true);
        this._changeColTitle(this.hrTable, m);
        if (this.hColCount != 0 && m < this.hColCount) {
            this._insertCols(this.hcTable, m, l, m);
            this._insertCols(this.hltTab, m, l, m, true);
            this._changeColTitle(this.hltTab, m);
            this.hColCount += l
        }
        this.columnCount += l;
        this._ajustLockedSections();
        if (a && a.x > m) {
            a.x += l;
            this.setCurrentCellNoFire(a)
        }
        for (var c = 0; c < this.mergeDivs.length; c++) {
            var n = this.mergeDivs[c];
            var o = parseInt(n.getAttribute("ci"), 10);
            var g = parseInt(n.getAttribute("cs"), 10);
            if (o < m + 1) {
                if (o + g > m + 1) {
                    n.setAttribute("cs", g + l);
                    n.style.width = this._getPXSize((parseInt(n.style.width, 10) + (l * b)))
                }
            } else {
                n.setAttribute("ci", o + l);
                n.style.left = this._getPXSize((parseInt(n.style.left, 10) + (l * b)))
            }
        }
    },
    _changeColTitle: function(g, b) {
        var h = g.childNodes[1];
        var d = h.childNodes.length - 1;
        b = b > 1 ? b : 1;
        for (var c = b; c < d; ++c) {
            var l = this._getRowCell(h, c, 0);
            var a = l.getAttribute("st");
            if (a) {
                DNA.engine.DomUtil.setInnerText(l, a)
            } else {
                DNA.engine.DomUtil.setInnerText(l, this._getDefHeaderColText(c - 1))
            }
        }
    },
    _getDefHeaderColText: function(b) {
        var c = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        if (b < 26) {
            return c.charAt(b)
        }
        var a = "";
        for (; b >= 1; b /= 26) {
            if (b < 26 && b >= 1) {
                a += c.charAt(b % 26 - 1)
            } else {
                a += c.charAt(b % 26)
            }
        }
        return this._reverse(a)
    },
    _reverse: function(a) {
        if (a) {
            return a.split("").reverse().join("")
        }
        return ""
    },
    _insertCols: function(w, l, m, v, d) {
        var p;
        var a;
        var n;
        var q;
        var g;
        var o = w.childNodes.length - 3;
        var r = w.childNodes[1].childNodes.length - 1;
        if (l == -1) {
            g = this.defColWidth;
            var B = w.ownerDocument.createDocumentFragment();
            var h = w.childNodes[1];
            for (var t = 0; t < m; ++t) {
                a = h.childNodes[v + 1];
                a.style.width = 0 + "px";
                p = a.cloneNode(true);
                B.append(p);
                if (l == (r - 1)) {
                    h.appendChild(B)
                } else {
                    h.insertBefore(B, h.childNodes[l + 2])
                }
            }
            for (var u = 0; u < o; u++) {
                h = w.childNodes[u + 2];
                a = h.childNodes[v + 1].cloneNode(false);
                for (var t = 0; t < m; ++t) {
                    p = a.cloneNode(true);
                    if (t == 0) {
                        p.className = "titleCellAsync"
                    } else {
                        p.className = "gridCellAsync"
                    }
                    B.append(a.cloneNode(true));
                    if (l == (r - 1)) {
                        h.appendChild(B)
                    } else {
                        h.insertBefore(B, h.childNodes[l + 2])
                    }
                }
            }
        } else {
            g = this.colWidths[v];
            var z = w.ownerDocument.createDocumentFragment();
            var b = w.childNodes[1];
            p = b.childNodes[v + 1].cloneNode(false);
            for (var t = 0; t < m; t++) {
                z.appendChild(p.cloneNode(true))
            }
            if (l == (r - 1)) {
                b.appendChild(z)
            } else {
                b.insertBefore(z, b.childNodes[l + 1])
            }
            for (var u = 2; u < w.childNodes.length - 1; u++) {
                var h = w.childNodes[u];
                p = this._getRowCell(h, v, u).cloneNode(false);
                p.style.display = "";
                p.style.backgroundImage = "";
                if (u > 0) {
                    if (d && u == 2) {
                        p.className = "titleCellAsync"
                    } else {
                        p.className = "gridCellAsync"
                    }
                }
                p.removeAttribute("html");
                this._internalInsertCols(h, p, l, m, w)
            }
        }
        for (u = 0,
        t = w.childNodes.length; u < t; u++) {
            w.childNodes[u].style.width = this._getPXSize((parseInt(w.childNodes[u].style.width, 10) + (m * g)))
        }
        var A = this.getColumnWidthCount(0, l);
        for (u = l + 1,
        t = this.getColumnCount() + m; u < t; u++) {
            A += this.getColumnWidth(u - 1);
            for (k = 1; k < w.childNodes.length - 1; k++) {
                var s = w.childNodes[k].childNodes[u + 1];
                s.style.left = A + "px";
                var c = s.htmlDiv;
                if (c) {
                    c.style.left = s.style.left
                } else {
                    this._placeCellHTML(s)
                }
            }
        }
        if (w == this.tDiv) {
            this.cwDiv.style.width = this._getPXSize((parseInt(this.cwDiv.style.width, 10) + (m * g)))
        } else {
            if (w == this.hcTable) {
                this.hccwDiv.style.width = this._getPXSize((parseInt(this.hccwDiv.style.width, 10) + (m * g)))
            }
        }
        return true
    },
    _internalInsertCols: function(m, l, b, h, g) {
        var d = g.childNodes[1].childNodes.length - 1 - h;
        var c = g.ownerDocument.createDocumentFragment();
        l.innerText = " ";
        l.removeAttribute("st");
        l.removeAttribute("et");
        for (var a = 0; a < h; a++) {
            c.appendChild(l.cloneNode(true))
        }
        if (b == (d - 1)) {
            m.appendChild(c)
        } else {
            m.insertBefore(c, m.childNodes[b + 2])
        }
    },
    deleteColumns: function(l, h) {
        if (!this.checkRendered(true)) {
            return
        }
        if (l >= this.columnCount) {
            return
        }
        var c = l + h - 1;
        var a = this.getCurrentCell();
        if (a && a.x >= l) {
            this.setCurrentCell(null , null , null , null , null , DNA.widget.JWTGrid.SETCURRENTCELLCAUSE_PROGRAM)
        }
        if (!this._deleteCols(this.tDiv, l, c)) {
            return
        }
        this.operateCell = null ;
        this.operateArea = null ;
        this.clearSelection();
        this._deleteCols(this.hrTable, l, c);
        this._changeColTitle(this.hrTable, l);
        if (l < this.hColCount) {
            this._deleteCols(this.hcTable, l, c);
            this._deleteCols(this.hltTab, l, c);
            this._changeColTitle(this.hltTab, l);
            var d = (c >= this.hColCount) ? (this.hColCount - l) : h;
            this.hColCount -= d
        }
        if (a && a.x > c) {
            a.x -= h;
            this.setCurrentCell(a, null , null , null , null , DNA.widget.JWTGrid.SETCURRENTCELLCAUSE_PROGRAM)
        }
        this.columnCount -= h;
        this._ajustLockedSections();
        this._adjustScroll();
        for (var b = this.mergeDivs.length - 1; b >= 0; b--) {
            var m = this.mergeDivs[b];
            var n = parseInt(m.getAttribute("ci"), 10);
            var g = parseInt(m.getAttribute("cs"), 10);
            if (n < l) {
                if (n + g >= l) {
                    if (n + g < l + h) {
                        m.setAttribute("cs", l - n);
                        m.style.width = this._getPXSize(parseInt(m.style.width, 10) - this.getColumnWidthCount(l, n + g - l))
                    } else {
                        m.setAttribute("cs", g - h);
                        m.style.width = this._getPXSize(parseInt(m.style.width, 10) - this.getColumnWidthCount(l, l + h))
                    }
                }
            } else {
                if (n >= l && n < l + h) {
                    m.parentNode.removeChild(m);
                    Array.prototype.splice.apply(this.mergeDivs, [b, 1])
                } else {
                    m.setAttribute("ci", n - h);
                    m.style.left = (parseInt(m.style.left, 10) - this.getColumnWidthCount(l, l + h)) + "px"
                }
            }
        }
        Array.prototype.splice.apply(this.colWidths, [l, h])
    },
    _deleteCols: function(z, q, d) {
        var t, s;
        var r = z.childNodes.length - 3;
        var v = z.childNodes[1].childNodes.length - 1;
        if (d >= v) {
            d = v - 1
        }
        var w = this.getColumnWidthCount(q, d + 1);
        for (h = 0,
        g = z.childNodes.length; h < g; h++) {
            z.childNodes[h].style.width = this._getPXSize(parseInt(z.childNodes[h].style.width, 10) - w)
        }
        for (h = d + 1,
        g = this.getColumnCount() - (d - q); h < g; h++) {
            for (k = 1; k < z.childNodes.length - 1; k++) {
                var l = z.childNodes[k].childNodes[h + 1];
                l.style.left = (parseInt(l.style.left, 10) - w) + "px";
                var o = l.htmlDiv;
                if (o) {
                    o.style.left = l.style.left
                }
            }
        }
        for (var b = 1, a = z.childNodes.length - 1; b < a; b++) {
            var A = z.childNodes[b];
            for (var h = q, g = d; h <= g; h++) {
                var p = A.childNodes[h + 1];
                if (p) {
                    this._removeCellHTML(p)
                }
            }
        }
        if (z == this.tDiv) {
            this.cwDiv.style.width = this._getPXSize(parseInt(this.cwDiv.style.width, 10) - w)
        } else {
            if (z == this.hcTable) {
                this.hccwDiv.style.width = this._getPXSize(parseInt(this.hccwDiv.style.width, 10) - w)
            }
        }
        for (var h = 0; h <= r; ++h) {
            var A = z.childNodes[h + 1];
            for (var g = d; g >= q; --g) {
                var u = A.childNodes[g + 1];
                A.removeChild(u)
            }
        }
        return true
    },
    getRowVisible: function(c) {
        var b = this._getRowDom(c, this.tDiv);
        if (!b) {
            return false
        }
        var a = b.childNodes[0];
        if (a && a.getAttribute("hf")) {
            return false
        }
        return true
    },
    setRowHidden: function(b, a) {
        if (!this.checkRendered(true)) {
            return
        }
        if (b < 0 || b >= this.rowCount) {
            return
        }
        this.clearSelection();
        if (a) {
            this._hideRow(b)
        } else {
            this._displayRow(b)
        }
    },
    _fixIEHideProblem: function(a) {
        this._checkForHideRow2(a, this.tDiv, this.columnCount);
        this._checkForHideRow2(a, this.hcTable, this.hColCount);
        if (a < this.hRowCount) {
            this._checkForHideRow2(a, this.hrTable, this.columnCount);
            this._checkForHideRow2(a, this.hltTab, this.hColCount)
        }
    },
    _fixIEDeleteProblem: function(a) {
        this._checkForDeleteRow2(a, this.tDiv, this.columnCount);
        this._checkForDeleteRow2(a, this.hcTable, this.hColCount);
        if (a < this.hRowCount) {
            this._checkForDeleteRow2(a, this.hrTable, this.columnCount);
            this._checkForDeleteRow2(a, this.hltTab, this.hColCount)
        }
    },
    _fixIEShowProblem: function(a) {
        this._checkForShowRow2(a, this.tDiv, this.columnCount);
        this._checkForShowRow2(a, this.hcTable, this.hColCount);
        if (a < this.hRowCount) {
            this._checkForShowRow2(a, this.hrTable, this.columnCount);
            this._checkForShowRow2(a, this.hltTab, this.hColCount)
        }
    },
    _checkForHideRow2: function(c, m, l) {
        var b = m.childNodes.length - 1;
        for (var d = 1; d < l; ) {
            var a = this._getCellDom(d, c, m);
            if (a.rowSpan && this._getRowRealSpan(a.rowSpan, c) > 1) {
                var h = c + 1;
                if (h < b) {
                    var g = this._getCellDom(d, h, m);
                    g.style.display = DNA.engine.Client.isIE() ? "inline" : "table-cell";
                    g.rowSpan = a.rowSpan - (h - c);
                    if (a.colSpan) {
                        g.colSpan = a.colSpan
                    }
                }
            }
            d += a.colSpan ? a.colSpan : 1
        }
    },
    _checkForDeleteRow2: function(b, g, d) {
        for (var c = 1; c < d; ) {
            var a = this._getCellDom(c, b, g);
            if (a.rowSpan && a.rowSpan > 1) {
                a.style.display = DNA.engine.Client.isIE() ? "inline" : "table-cell"
            }
            c += a.colSpan ? a.colSpan : 1
        }
    },
    _checkForShowRow2: function(c, m, l) {
        var b = m.childNodes.length - 1;
        for (var d = 1; d < l; ) {
            var a = this._getCellDom(d, c, m);
            if (a.rowSpan && a.rowSpan > 1) {
                for (var h = c + 1; c + a.rowSpan > h; h++) {
                    if (h < b) {
                        var g = this._getCellDom(d, h, m);
                        g.removeAttribute("rowSpan");
                        g.removeAttribute("colSpan");
                        g.style.display = "none";
                        g.setAttribute("mg", "1")
                    }
                }
            }
            d += a.colSpan ? a.colSpan : 1
        }
    },
    _checkForHideRow: function(c, l, h) {
        for (var d = 1; d < h; ) {
            var a = new DNA.widget.AbstractGridCellAsync(this,l,d,c,false);
            var m = a.getRowIndex();
            if (m < c) {
                var g = a.getRowSpan();
                var b = this._getRowRealSpan(g, a.getRowIndex());
                if (b != a.td.rowSpan) {
                    if (!a.td.rrs) {
                        a.td.rrs = g
                    }
                    a.td.rowSpan = b
                }
            }
            d += a.getColSpan()
        }
    },
    _getRowRealSpan: function(c, d) {
        var a = c;
        for (var b = d + c - 1; b >= d; --b) {
            if (!this.getRowVisible(b)) {
                a--
            } else {
                break
            }
        }
        return a
    },
    _hideRow: function(a) {
        if (this.getRowHidden(a)) {
            return
        }
        this.rowHiddens[a] = true;
        this._setRowVisible(a, false)
    },
    _displayRow: function(a) {
        if (!this.getRowHidden(a)) {
            return
        }
        this.rowHiddens[a] = false;
        this._setRowVisible(a, true)
    },
    __displayRow: function(c) {
        var b = this._getRowDom(c, this.tDiv);
        var a = b.childNodes[0];
        if (!a.getAttribute("hf")) {
            return
        }
        this._showRow4Tab(this.tDiv, c);
        this._showRow4Tab(this.hcTable, c);
        if (c == 0 || (this.hRowCount != 0 && c < this.hRowCount)) {
            this._showRow4Tab(this.hrTable, c);
            this._showRow4Tab(this.hltTab, c)
        }
        this._ajustLockedSections();
        this.hiddenRows.remove(c);
        this._reBoundCurCell()
    },
    _showRow4Tab: function(m, c) {
        var n = this._getRowDom(c, m);
        var h = n.childNodes[0];
        if (c === 0) {
            n.style.display = "";
            h.removeAttribute("hf");
            return
        }
        var g = n.childNodes.length - 1;
        var d = m.childNodes.length - 1;
        h.removeAttribute("hf");
        var l = h.getAttribute("rh");
        h.style.height = l;
        for (var a = 1; a <= g; ++a) {
            h = this._getRowCell(n, a - 1, c);
            h.removeAttribute("rhc");
            this.util.convertCSSFromClass2Style(h);
            if (a == 1) {
                h.className = "titleCell"
            } else {
                h.className = "gridCell"
            }
            var b = h.getAttribute("st");
            if (b) {
                h.removeAttribute("st");
                DNA.engine.DomUtil.setInnerText(h, b)
            }
        }
    },
    setColumnHidden: function(b, a) {
        if (!this.checkRendered(true)) {
            return
        }
        if (b < 0 || b >= this.columnCount) {
            return
        }
        this.clearSelection();
        if (a) {
            this._hideColumn(b)
        } else {
            this._displayColumn(b)
        }
    },
    _hideColumn: function(b) {
        var a = this._getCellDom(b, -1, this.tDiv);
        if (a.getAttribute("hf")) {
            return
        }
        a.setAttribute("hf", 1);
        this._setColumnVisible(b, false)
    },
    _displayColumn: function(b) {
        var a = this._getCellDom(b, -1, this.tDiv);
        if (!a.getAttribute("hf")) {
            return
        }
        a.removeAttribute("hf");
        this._setColumnVisible(b, true)
    },
    _setColumnVisible: function(p, c) {
        if (!this.checkRendered(true)) {
            return
        }
        if (!this.util.isDataCol(p)) {
            return
        }
        if (p <= 0 || p >= this.columnCount) {
            return
        }
        this._applyColumnVisible2Cells(this.tDiv, p, c);
        this._applyColumnVisible2Cells(this.hrTable, p, c);
        if (p < this.hColCount) {
            this._applyColumnVisible2Cells(this.hltTab, p, c);
            this._applyColumnVisible2Cells(this.hcTable, p, c)
        }
        var r = [this.tDiv];
        if (p < this.hColCount) {
            r.push(this.hcTable)
        }
        for (var a = 0; a < r.length; a++) {
            var s = r[a];
            for (var l = this.renderedTop, h = this.renderedTop + this.renderedCount; l < h; l++) {
                for (var d = p, b = s.childNodes[1].childNodes.length - 1; d < b; d++) {
                    var g = this._getCellDom(d, l, s);
                    var o = g.htmlDiv;
                    if (o) {
                        o.style.left = g.style.left
                    }
                }
            }
        }
        this._ajustLockedSections();
        this.setCurrentCell(null );
        this._reComputeSelections(-1, p);
        this._adjustScroll();
        this._reBoundFace();
        this._resizeCoverSizeAfterWidthChange(p, c ? this.colWidths[p] : 0 - this.colWidths[p]);
        this._resizeNRepositionStaffs4WidthChange(p)
    },
    _applyColumnVisible2Cells: function(p, n, a) {
        var l = a ? "block" : "none";
        var m = a ? this.colWidths[n] : 0 - this.colWidths[n];
        for (var g = 1; g < p.childNodes.length - 1; g++) {
            var q = p.childNodes[g];
            q.style.width = this._getPXSize(parseInt(q.style.width, 10) + m);
            var o = q.childNodes[n + 1];
            o.style.display = l;
            var h = o.htmlDiv;
            if (h) {
                h.style.display = o.style.display
            }
            for (var c = n + 2, b = q.childNodes.length; c < b; c++) {
                var d = q.childNodes[c];
                d.style.left = (parseInt(d.style.left, 10) + m) + "px"
            }
        }
    },
    _setRowVisible: function(p, c) {
        if (!this.checkRendered(true)) {
            return
        }
        if (!this.util.isDataRow(p)) {
            return
        }
        this._appleRowVisible2Cells(this.tDiv, p, c);
        this._appleRowVisible2Cells(this.hcTable, p, c);
        if (p < this.hRowCount) {
            this._appleRowVisible2Cells(this.hltTab, p, c);
            this._appleRowVisible2Cells(this.hrTable, p, c)
        }
        var s = [this.tDiv, this.hcTable];
        for (var a = 0; a < s.length; a++) {
            var t = s[a];
            for (var l = this.renderedTop, h = this.renderedTop + this.renderedCount; l < h; l++) {
                for (var d = 0, b = t.childNodes[1].childNodes.length - 1; d < b; d++) {
                    var g = this._getCellDom(d, l, t);
                    var o = g.htmlDiv;
                    if (o) {
                        o.style.top = g.parentNode.offsetTop + "px"
                    }
                }
            }
        }
        var r = c ? this.rowHeights[p] : 0 - this.rowHeights[p];
        if (p < this.renderedTop) {
            this.setUpTakenRowHeight(this.getUpTakenRowHeight() + r)
        } else {
            if (p >= this.renderedTop + this.renderedCount) {
                this.setDownTakenRowHeight(this.getDownTakenRowHeight() + r)
            }
        }
        this._ajustLockedSections();
        this._reBoundCurCell();
        this._reComputeSelections(p, -1);
        this._adjustScroll();
        this._reBoundFace();
        this._resizeCoverSizeAfterHeightChange(p, r);
        this._resizeNRepositionStaffs4RowChange(p)
    },
    _appleRowVisible2Cells: function(c, m, h) {
        var d = h ? "block" : "none";
        var g = this._getRowDom(m, c);
        if (g != null ) {
            g.style.display = d;
            for (var b = 0; b < g.childNodes.length; b++) {
                var a = g.childNodes[b];
                var l = a.htmlDiv;
                if (l) {
                    l.style.display = d
                }
            }
        }
    },
    getColHidden: function(b) {
        if (!this.checkRendered(true)) {
            return false
        }
        var a = this._getCellDom(b, -1, this.tDiv);
        if (!a.getAttribute("hf")) {
            return false
        }
        return true
    },
    getRowHidden: function(a) {
        if (!this.checkRendered(true)) {
            return false
        }
        return this.rowHiddens[a]
    },
    setColAutoWidth: function(b, c) {
        if (!this.checkRendered(true)) {
            return false
        }
        var a = this._getCellDom(b, -1, this.tDiv);
        if (c) {
            a.setAttribute("aw", 1)
        } else {
            a.removeAttribute("aw")
        }
    },
    setRowAutoHeight: function(c, b) {
        if (!this.checkRendered(true)) {
            return false
        }
        var a = this._getCellDom(-1, c, this.tDiv);
        if (b) {
            a.setAttribute("aw", 1)
        } else {
            a.removeAttribute("aw")
        }
    },
    setInitProperties: function(l) {
        if (!this.checkRendered(true)) {
            return false
        }
        DNA.widget.CssStyleFinder.updateCss(this);
        this.columnCount = l.colCount;
        this.rowCount = l.rowCount;
        this.hColCount = l.headerColCount;
        this.hRowCount = l.headerRowCount;
        this.renderedTop = l.renderedTop;
        this.renderedCount = l.renderedCount;
        this.rowHeights = l.rowHeights;
        this.colWidths = l.colWidths;
        this.rowHiddens = l.rowHiddens;
        var h = l.currentCell;
        if (h) {
            this.setCurrentCellNoFire(h, null , null , null , null , DNA.widget.JWTGrid.SETCURRENTCELLCAUSE_PROGRAM)
        }
        var d = l.cccf;
        if (d) {
            var c = d.split(",");
            this.currentCellColorFocused = c[0];
            this.currentCellColorUnFocused = c[1]
        } else {
            this.currentCellColorFocused = null ;
            this.currentCellColorUnFocused = null 
        }
        this.updateCurrentCellColor();
        var b = l.selections;
        if (b) {
            this.setSelections(b)
        }
        var g = l.currentCellOffset;
        if (g) {
            this._setCurrentCellOffset(g)
        }
        var a = l.formatters;
        if (a) {
            this._addFormatters(a)
        }
        this.replacing = false;
        this.ignoreHidden = l.ignoreHidden ? true : false;
        if (DNA.engine.Client.isFF()) {
            this._ajustLockedSections()
        }
    },
    setGridOption: function(a) {
        this.gridOption = a;
        if ((a & DNA.widget.JWTGrid.EDIT_MODE_MASK) == DNA.widget.JWTGrid.EDIT_MODE_READONLY) {
            this.closeEditor();
            this._hideFace()
        }
    },
    setDefEditor: function(a) {
        this.defEditorId = a
    },
    setColumnCount: function(a) {
        if (a > this.columnCount) {
            this.insertColumns(this.columnCount, a - this.columnCount, this.columnCount - 1);
            return
        }
        if (a < this.columnCount) {
            this.deleteColumns(a, this.columnCount - a)
        }
    },
    setRowCount: function(a) {
        if (a > this.rowCount) {
            this.insertRows(this.rowCount, a - this.rowCount, this.rowCount - 1);
            return
        }
        if (a < this.rowCount) {
            this.deleteRows(a, this.rowCount - a)
        }
    },
    getColumnCount: function() {
        return this.columnCount
    },
    getRowCount: function() {
        return this.rowCount
    },
    setHeaderColumnCount: function(a) {
        this._buildHeaderCols(a)
    },
    setHeaderRowCount: function(a) {
        this._buildHeaderRows(a)
    },
    getHeaderColumnCount: function() {
        return this.hColCount
    },
    getHeaderRowCount: function() {
        return this.hRowCount
    },
    setEditMode: function(a) {
        this.gridOption &= ~DNA.widget.JWTGrid.EDIT_MODE_MASK;
        this.gridOption |= (a & DNA.widget.JWTGrid.EDIT_MODE_MASK)
    },
    getEditMode: function() {
        return this.gridOption & DNA.widget.JWTGrid.EDIT_MODE_MASK
    },
    setSelectionMode: function(a) {
        var b = this.getSelectionMode();
        if (a != b) {
            this.gridOption &= ~DNA.widget.JWTGrid.SELECTION_MODE_MASK;
            this.gridOption |= (a & DNA.widget.JWTGrid.SELECTION_MODE_MASK);
            this._clearSelection()
        }
    },
    getSelectionMode: function() {
        return this.gridOption & DNA.widget.JWTGrid.SELECTION_MODE_MASK
    },
    setRowResizeEnable: function(a) {
        if (a) {
            this.gridOption |= DNA.widget.JWTGrid.ROW_RESIZE_MASK
        } else {
            this.gridOption &= ~DNA.widget.JWTGrid.ROW_RESIZE_MASK
        }
    },
    getRowResizeEnable: function() {
        return (this.gridOption & DNA.widget.JWTGrid.ROW_RESIZE_MASK) != 0
    },
    setColResizeEnable: function(a) {
        if (a) {
            this.gridOption |= DNA.widget.JWTGrid.COL_RESIZE_MASK
        } else {
            this.gridOption &= ~DNA.widget.JWTGrid.COL_RESIZE_MASK
        }
    },
    getColResizeEnable: function() {
        return (this.gridOption & DNA.widget.JWTGrid.COL_RESIZE_MASK) != 0
    },
    setRowSelectEnabled: function(a) {
        if (a) {
            this.gridOption |= DNA.widget.JWTGrid.ROW_SELECT_MASK
        } else {
            this.gridOption &= ~DNA.widget.JWTGrid.ROW_SELECT_MASK
        }
    },
    getRowSelectEnabled: function() {
        return (this.gridOption & DNA.widget.JWTGrid.ROW_SELECT_MASK) != 0
    },
    setRowFreeResizeEnabled: function(a) {
        if (a) {
            this.gridOption |= DNA.widget.JWTGrid.ROW_FREE_RESIZE_MASK
        } else {
            this.gridOption &= ~DNA.widget.JWTGrid.ROW_FREE_RESIZE_MASK
        }
    },
    getRowFreeResizeEnabled: function() {
        return (this.gridOption & DNA.widget.JWTGrid.ROW_FREE_RESIZE_MASK) != 0
    },
    setColFreeResizeEnabled: function(a) {
        if (a) {
            this.gridOption |= DNA.widget.JWTGrid.COL_FREE_RESIZE_MASK
        } else {
            this.gridOption &= ~DNA.widget.JWTGrid.COL_FREE_RESIZE_MASK
        }
    },
    getColFreeResizeEnabled: function() {
        return (this.gridOption & DNA.widget.JWTGrid.COL_FREE_RESIZE_MASK) != 0
    },
    setColSelectEnabled: function(a) {
        if (a) {
            this.gridOption |= DNA.widget.JWTGrid.COL_SELECT_MASK
        } else {
            this.gridOption &= ~DNA.widget.JWTGrid.COL_SELECT_MASK
        }
    },
    getColSelectEnabled: function() {
        return (this.gridOption & DNA.widget.JWTGrid.COL_SELECT_MASK) != 0
    },
    setEnterNext: function(a) {
        this.gridOption &= ~DNA.widget.JWTGrid.ENTER_NEXT_MASK;
        this.gridOption |= (a & DNA.widget.JWTGrid.ENTER_NEXT_MASK)
    },
    getEnterNext: function() {
        return this.gridOption & DNA.widget.JWTGrid.ENTER_NEXT_MASK
    },
    setMinColWidth: function(a) {
        if (a >= 0) {
            this.minColWidth = a
        } else {
            alert("�е���С��Ȳ���С��0")
        }
    },
    getMinColWidth: function() {
        return this.minColWidth
    },
    setMinRowHeight: function(a) {
        if (height >= 0) {
            this.minRowHeight = a
        } else {
            alert("�е���С�߶Ȳ���С��0")
        }
    },
    getMinRowHeight: function() {
        return this.minRowHeight
    },
    setDefColWidth: function(a) {
        if (a >= 0) {
            this.defColWidth = a
        } else {
            alert("�е�Ĭ�Ͽ�Ȳ���С��0")
        }
    },
    getDefColWidth: function(a) {
        return this.defColWidth = a
    },
    setDefRowHeight: function(a) {
        if (a >= 0) {
            this.defRowHeight = a
        } else {
            alert("�е�Ĭ�ϸ߶Ȳ���С��0")
        }
    },
    getDefRowHeight: function(a) {
        return this.defRowHeight
    },
    _setCurrentCellOffset: function(a) {
        if (!a) {
            return
        }
        var g = this.getCurrentCell();
        if (!g) {
            return
        }
        var b = this._getCellDom(g.x, g.y, this.tDiv);
        var d = b.offsetLeft;
        var c = b.offsetTop;
        this.tDiv.scrollLeft = d - a.x;
        this.tDiv.scrollTop = c - a.y;
        this._handleScroll()
    },
    setCurrentCell: function(b, m, l, d, c, g) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = null ;
        if (b) {
            if (b.y < this.renderedTop || b.y >= this.renderedTop + this.renderedCount) {
                return
            }
            if (!this.util.isDataCol(b.x) || !this.util.isDataRow(b.y)) {
                return
            }
            try {
                a = new DNA.widget.AbstractGridCellAsync(this,this.tDiv,b.x,b.y,false)
            } catch (h) {
                a = null 
            }
        }
        this._setCurrentCell(a, null , null , d, c, g);
        this.fireEvent("currentCellOffsetChanged", [this])
    },
    setCurrentCellNoFire: function(b, m, l, d, c, g) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = null ;
        if (b) {
            if (b.y < this.renderedTop || b.y >= this.renderedTop + this.renderedCount) {
                return
            }
            if (!this.util.isDataCol(b.x) || !this.util.isDataRow(b.y)) {
                return
            }
            try {
                a = new DNA.widget.AbstractGridCellAsync(this,this.tDiv,b.x,b.y,false)
            } catch (h) {
                a = null 
            }
        }
        this._setCurrentCellNoFireChanging(a, null , null , d, c, true, g)
    },
    _setCurrentCell: function(n, l, h, d, a, c) {
        if (!this.checkRendered(true)) {
            return
        }
        this._stopDbClick = false;
        if (!n) {
            this._hideInputProxy();
            if (this.getCurrentCell()) {
                var b = {
                    widget: this,
                    target: null ,
                    lastCurrent: this.getCurrentCell(),
                    doit: true
                };
                this.fireCurrentCellChangingEvent(b);
                if (!b.doit) {
                    this._stopDbClick = true;
                    return
                }
                this.closeEditor(d);
                this._hideFace();
                this._drawCurrentCellBack();
                this.currentCell = null ;
                this.currentCol = -1;
                this.currentRow = -1
            }
            return
        }
        var m = n.getColIndex();
        var g = n.getRowIndex();
        if (this.currentCell) {
            if (this.currentCell.getColIndex() == m && this.currentCell.getRowIndex() == g) {
                this._drawCurrentCellBack();
                this._drawCurrentCell(n);
                return
            }
        }
        var b = {
            widget: this,
            target: new DNA.widget.Point(m,g),
            lastCurrent: this.getCurrentCell(),
            doit: true
        };
        this.fireCurrentCellChangingEvent(b);
        if (!b.doit) {
            this._stopDbClick = true;
            return
        }
        this._setCurrentCellNoFireChanging(n, l, h, d, a, false, c)
    },
    _setCurrentCellNoFireChanging: function(n, l, h, c, a, o, b) {
        if (!n) {
            this._hideInputProxy();
            if (this.getCurrentCell()) {
                this.closeEditor(c);
                this._hideFace();
                this._drawCurrentCellBack();
                this.currentCell = null ;
                this.currentCol = -1;
                this.currentRow = -1
            }
            return
        }
        var m = n.getColIndex();
        var g = n.getRowIndex();
        if (this.currentCell) {
            if (this.currentCell.getColIndex() == m && this.currentCell.getRowIndex() == g) {
                this._drawCurrentCellBack();
                this._drawCurrentCell(n);
                return
            }
        }
        this.closeEditor(c);
        this._hideFace();
        this._drawCurrentCellBack();
        this.currentCell = n;
        if (l) {
            this.currentCol = l
        } else {
            this.currentCol = n.getColIndex()
        }
        if (h) {
            this.currentRow = h
        } else {
            this.currentRow = n.getRowIndex()
        }
        this.focus();
        this._focusInputProxy();
        this._scrollToCol(this.currentCol);
        this._scrollToRow(this.currentRow);
        this._drawCurrentCell(n);
        this.updateCurrentCellColor();
        if ((this.getEditMode() != DNA.widget.JWTGrid.EDIT_MODE_READONLY) && this.util.isCellEditable(m, g)) {
            this._showFace()
        }
        if (o) {
            var d = function(p) {
                this.fireEvent("currentCellChangedByServer", [this, p, b])
            }
            ;
            DNA.adapter.browserPage.addFinalTask([d, this, [a, b]])
        } else {
            this.fireEvent("currentCellChanged", [this, a, b])
        }
    },
    _hideFace: function() {
        if (this.curFace) {
            this.gel.appendChild(this.curFace);
            this.curFace.style.display = "none";
            this.curFace = null 
        }
    },
    _showFace: function() {
        if (this.currentCell) {
            var b = this.currentCell.getEditorFace();
            if (b == 1) {
                this.curFace = this.btnFace
            } else {
                if (b == 2) {
                    this.curFace = this.listFace
                }
            }
            if (this.curFace) {
                var a = this.currentCell.getColIndex();
                var c = this.currentCell.getRowIndex();
                if (a < this.hColCount && c < this.hRowCount) {
                    this.hltDiv.appendChild(this.curFace)
                } else {
                    if (a < this.hColCount) {
                        this.hcDiv.childNodes[1].appendChild(this.curFace)
                    } else {
                        if (c < this.hRowCount) {
                            this.hrDiv.appendChild(this.curFace)
                        } else {
                            this.cwDiv.appendChild(this.curFace)
                        }
                    }
                }
                this.curFace.style.display = "";
                this._reBoundFace()
            }
        }
    },
    _reBoundFace: function() {
        if (this.currentCell && this.curFace && this.currentCell.td) {
            var b = this.currentCell.td.offsetLeft;
            var d = this.currentCell.td.parentNode.offsetTop;
            var c = this.currentCell.td.offsetWidth;
            var a = this.currentCell.td.offsetHeight;
            this.curFace.style.left = b + c - 19 + "px";
            this.curFace.style.top = d + "px";
            this.curFace.style.height = Math.max(0, a - 2) + "px";
            this.curFace.style.display = "none";
            this.curFace.style.display = ""
        }
    },
    _focusInputProxy: function() {
        if (!DNA.engine.Client.isIOS()) {
            if (!this.checkRendered(false)) {
                return
            }
            if (this.util.isCellEditable(this.currentCol, this.currentRow)) {
                this.inputProxy.focus()
            }
        }
    },
    _blurInputProxy: function() {
        if (!this.checkRendered(false)) {
            return
        }
        try {
            this.inputProxy.blur()
        } catch (a) {}
    },
    _hideInputProxy: function() {
        DNA.engine.DomUtil.setLeftTop(this.inputProxy, 0, 0);
        this.inputProxy.style.width = "1px"
    },
    _reBoundCurCell: function() {
        if (this.currentCell) {
            var d = this.currentCell.getTop() - 2;
            var c = this.currentCell.getLeft() - 2;
            var b = this.currentCell.getWidth();
            var a = this.currentCell.getHeight();
            DNA.engine.DomUtil.setLeftTop(this.curLeft, c, d);
            DNA.engine.DomUtil.setHeight(this.curLeft, a);
            DNA.engine.DomUtil.setLeftTop(this.curTop, c, d);
            DNA.engine.DomUtil.setWidth(this.curTop, b);
            DNA.engine.DomUtil.setLeftTop(this.curRight, c + b, d);
            DNA.engine.DomUtil.setHeight(this.curRight, a);
            DNA.engine.DomUtil.setLeftTop(this.curBottom, c, d + a);
            DNA.engine.DomUtil.setWidth(this.curBottom, b);
            this.reBoundEditor()
        }
    },
    reBoundEditor: function() {
        if (this.activeEditor) {
            this.activeEditor.reBoundCtr()
        }
    },
    getColVisible: function(b) {
        var a = this._getCellDom(b, -1, this.tDiv);
        if (!a || !a.td) {
            return false
        }
        if (a.getAttribute("hf")) {
            return false
        }
        return true
    },
    _drawCurrentCell: function(l) {
        if (!l.td) {
            return
        }
        if (this.currentCol < this.hColCount && this.currentRow < this.hRowCount) {
            this.curLeft = this.hltDiv.childNodes[1];
            this.curRight = this.hltDiv.childNodes[2];
            this.curTop = this.hltDiv.childNodes[3];
            this.curBottom = this.hltDiv.childNodes[4]
        } else {
            if (this.currentCol < this.hColCount) {
                var n = this.hcDiv.childNodes[1].firstChild;
                this.curLeft = n.childNodes[1];
                this.curRight = n.childNodes[2];
                this.curTop = n.childNodes[3];
                this.curBottom = n.childNodes[4]
            } else {
                if (this.currentRow < this.hRowCount) {
                    this.curLeft = this.hrDiv.childNodes[1];
                    this.curRight = this.hrDiv.childNodes[2];
                    this.curTop = this.hrDiv.childNodes[3];
                    this.curBottom = this.hrDiv.childNodes[4]
                } else {
                    this.curLeft = this.mCurLeft;
                    this.curRight = this.mCurRight;
                    this.curTop = this.mCurTop;
                    this.curBottom = this.mCurBottom
                }
            }
        }
        this.curLeft.style.display = "block";
        this.curRight.style.display = "block";
        this.curTop.style.display = "block";
        this.curBottom.style.display = "block";
        var g = l.td.parentNode.offsetTop - 1;
        var c = l.td.offsetLeft - 1;
        var b = l.getWidth();
        var m = l.getHeight();
        DNA.engine.DomUtil.setLeftTop(this.curLeft, c, g);
        DNA.engine.DomUtil.setHeight(this.curLeft, m);
        DNA.engine.DomUtil.setLeftTop(this.curTop, c, g);
        DNA.engine.DomUtil.setWidth(this.curTop, b);
        DNA.engine.DomUtil.setLeftTop(this.curRight, c + b, g);
        DNA.engine.DomUtil.setHeight(this.curRight, m);
        DNA.engine.DomUtil.setLeftTop(this.curBottom, c, g + m);
        DNA.engine.DomUtil.setWidth(this.curBottom, b);
        var c = l.getColIndex();
        var g = l.getRowIndex();
        var h = c + l.getColSpan() - 1;
        var a = g + l.getRowSpan() - 1;
        var d = {
            x: c,
            y: g,
            width: h,
            height: a
        };
        this._internalDrawTitle(d, false, true)
    },
    _drawCurrentCellBack: function() {
        if (this.currentCell) {
            this.curLeft.style.display = "none";
            this.curRight.style.display = "none";
            this.curTop.style.display = "none";
            this.curBottom.style.display = "none";
            if (!this._currentCellInSelection()) {
                var g = this.currentCell.getColIndex();
                var d = this.currentCell.getRowIndex();
                var b = g + this.currentCell.getColSpan() - 1;
                var a = d + this.currentCell.getRowSpan() - 1;
                var c = {
                    x: g,
                    y: d,
                    width: b,
                    height: a
                };
                this._internalDrawTitle(c, false, false)
            }
        }
    },
    _currentCellInSelection: function() {
        if (!this.currentCell) {
            return false
        }
        if (!this.selectionAreas || this.selectionAreas == 0) {
            return false
        }
        var c = {
            x: this.currentCell.getColIndex(),
            y: this.currentCell.getRowIndex()
        };
        for (var b = 0, a = this.selectionAreas.length; b < a; ++b) {
            if (this._isPointInRect(c, this.selectionAreas[b].getRange())) {
                return true
            }
        }
        return false
    },
    _isPointInRect: function(b, a) {
        if (b.x >= a.x && b.x < a.x + a.width && b.y >= a.y && b.y < a.y + a.height) {
            return true
        }
        return false
    },
    getCurrentCell: function() {
        if (this.currentCol == -1 || this.currentRow == -1) {
            return null 
        }
        return {
            x: this.currentCol,
            y: this.currentRow
        }
    },
    getCurrentCellOffset: function() {
        var h = this.getCurrentCell();
        if (!h) {
            return null 
        }
        var d = this.util.getColOffsetLeft(h.x);
        var c = this.util.getRowOffsetTop(h.y);
        var g = this.tDiv.scrollLeft;
        var b = this.tDiv.scrollTop;
        var a = d - g;
        var l = c - b;
        return {
            x: a,
            y: l
        }
    },
    keyEnterDown: function(c) {
        var b = c.isShift();
        var a;
        switch (this.getEnterNext()) {
        case DNA.widget.JWTGrid.ENTER_NEXT_RIGHT:
            if (b) {
                a = this.util.getLeftCell(this.currentCol, this.currentRow, null , true, true)
            } else {
                a = this.util.getRightCell(this.currentCol, this.currentRow, null , true, true)
            }
            break;
        case DNA.widget.JWTGrid.ENTER_NEXT_DOWN:
            if (b) {
                a = this.util.getUpCell(this.currentCol, this.currentRow, null , true, true)
            } else {
                a = this.util.getDownCell(this.currentCol, this.currentRow, null , true, true)
            }
            break;
        case DNA.widget.JWTGrid.ENTER_NEXT_LEFT:
            if (b) {
                a = this.util.getRightCell(this.currentCol, this.currentRow, null , true, true)
            } else {
                a = this.util.getLeftCell(this.currentCol, this.currentRow, null , true, true)
            }
            break;
        case DNA.widget.JWTGrid.ENTER_NEXT_UP:
            if (b) {
                a = this.util.getDownCell(this.currentCol, this.currentRow, null , true, true)
            } else {
                a = this.util.getUpCell(this.currentCol, this.currentRow, null , true, true)
            }
            break
        }
        if (a) {
            this.selectCell(a.x, a.y)
        }
    },
    keydownNavigation: function(d) {
        var b = d.isShift();
        var c = d.isCtrl();
        var a = d.isAlt();
        if (!a) {
            var g = this.getSelectionMode();
            switch (g) {
            case DNA.widget.JWTGrid.SELECTION_MODE_MULTI:
            case DNA.widget.JWTGrid.SELECTION_MODE_SINGLE:
                if (this.selectionAreas.length === 0) {
                    if (this.getCurrentCell()) {
                        this.keyCellSelect(d)
                    }
                } else {
                    if (g === DNA.widget.JWTGrid.SELECTION_MODE_SINGLE || !b) {
                        this.keyCellSelect(d)
                    } else {
                        if (!c) {
                            this.keyCellSelectWithShift(d)
                        } else {
                            this.keyCellSelectWithCtrlShift(d)
                        }
                    }
                }
                break;
            case DNA.widget.JWTGrid.SELECTION_MODE_ROW:
                this.keyRowSelect(d);
                break
            }
        }
    },
    selectFirstCell: function() {},
    keyCellSelect: function(d) {
        var c = d.isCtrl();
        var b = d.getKeyCode();
        var a;
        if (!c) {
            switch (b) {
            case DNA.JWTEvent.LEFT:
                a = this.util.getLeftCell(this.currentCol, this.currentRow, null , false, false);
                break;
            case DNA.JWTEvent.RIGHT:
                a = this.util.getRightCell(this.currentCol, this.currentRow, null , false, false);
                break;
            case DNA.JWTEvent.UP:
                a = this.util.getUpCell(this.currentCol, this.currentRow, null , false, false);
                break;
            case DNA.JWTEvent.DOWN:
                a = this.util.getDownCell(this.currentCol, this.currentRow, null , false, false);
                break;
            case DNA.JWTEvent.HOME:
                a = this.util.getRowFirstCell(this.currentRow, false, false);
                break;
            case DNA.JWTEvent.END:
                a = this.util.getRowLastCell(this.currentRow, false, false);
                break
            }
        } else {
            switch (b) {
            case DNA.JWTEvent.LEFT:
                a = this.util.getRowFirstCell(this.currentRow, false, false);
                break;
            case DNA.JWTEvent.RIGHT:
                a = this.util.getRowLastCell(this.currentRow, false, false);
                break;
            case DNA.JWTEvent.UP:
                a = this.util.getColFirstCell(this.currentCol, false, false);
                break;
            case DNA.JWTEvent.DOWN:
                a = this.util.getColLastCell(this.currentCol, false, false);
                break;
            case DNA.JWTEvent.HOME:
                a = this.util.getFirstCell(null , false);
                break;
            case DNA.JWTEvent.END:
                a = this.util.getLastCell(null , false);
                break
            }
        }
        if (a) {
            this.selectCell(a.x, a.y)
        }
    },
    selectCell: function(a, c) {
        if (this.util.isDataCell(a, c)) {
            this.setCurrentCell({
                x: a,
                y: c
            }, a, c, null , null , DNA.widget.JWTGrid.SETCURRENTCELLCAUSE_KEY);
            this.clearSelection();
            var b = new DNA.widget.GridSelectionAreaAsync(this,{
                x: a,
                y: c,
                width: a,
                height: c
            },true,this.selectionDiv,true,this.showBorder);
            this._setSelection(b);
            this.fireEvent("selection", [this]);
            this.setCurrentSelection(b)
        }
    },
    keyCellSelectWithShift: function(g) {
        var q = g.getKeyCode();
        var l = this.getCurrentSelection();
        if (!l) {
            return
        }
        var n = l.getRange();
        switch (q) {
        case DNA.JWTEvent.LEFT:
            var m = this.shrinkCellRect(n, DNA.widget.JWTGrid.LEFT);
            if (this.rectEqual(m, n)) {
                return
            }
            if (m.x == this.currentCol) {
                l._setBound(m);
                l.reBuild(true)
            } else {
                var p = this.util.getLeftCol(m.x);
                if (this.util.isDataCol(p)) {
                    var o = new DNA.widget.Rectangle(p,m.y,l.width,m.height);
                    l._setBound(o);
                    l.reBuild(true)
                }
            }
            break;
        case DNA.JWTEvent.RIGHT:
            if (l.x < this.currentCol) {
                var a = this.util.getRightCol(l.x);
                if (this.util.isDataCol(a)) {
                    var o = new DNA.widget.Rectangle(a,l.y,l.width,l.height);
                    l._setBound(o);
                    l.reBuild(true)
                }
                return
            }
            var b = this.shrinkCellRect(n, DNA.widget.JWTGrid.RIGHT);
            if (!b || this.rectEqual(b, n)) {
                return
            }
            l._setBound(b);
            l.reBuild(true);
            break;
        case DNA.JWTEvent.UP:
            if (l.y < this.currentRow) {
                var h = this.util.getUpRow(l.y);
                if (this.util.isDataRow(h)) {
                    var o = new DNA.widget.Rectangle(l.x,h,l.width,l.height);
                    l._setBound(o);
                    l.reBuild(true)
                }
            } else {
                var r = this.shrinkCellRect(n, DNA.widget.JWTGrid.UP);
                if (this.rectEqual(r, n)) {
                    return
                }
                l._setBound(r);
                l.reBuild(true)
            }
            break;
        case DNA.JWTEvent.DOWN:
            if (l.y < this.currentRow) {
                var c = this.util.getDownRow(l.y);
                if (this.util.isDataRow(c)) {
                    var o = new DNA.widget.Rectangle(l.x,c,l.width,l.height);
                    l._setBound(o);
                    l.reBuild(true)
                }
                return
            }
            var d = this.shrinkCellRect(n, DNA.widget.JWTGrid.DOWN);
            if (!d || this.rectEqual(d, n)) {
                return
            }
            l._setBound(d);
            l.reBuild(true);
            break;
        case DNA.JWTEvent.HOME:
            break;
        case DNA.JWTEvent.END:
            break
        }
        this._internalDrawTitle(l, false, true);
        this.fireEvent("selection", [this])
    },
    keyCellSelectWithCtrlShift: function(a) {},
    keyRowSelect: function(a) {},
    shrinkCellRect: function(p, h) {
        var t;
        var u = new DNA.widget.Rectangle(p);
        switch (h) {
        case DNA.widget.JWTGrid.LEFT:
            var d = p.width - 1;
            u.width--;
            while (d > 0) {
                var g = d;
                for (var l = p.y; l <= p.height; ++l) {
                    t = new DNA.widget.AbstractGridCellAsync(this,this.tDiv,d,l,false);
                    var c = t.getColIndex() + t.getColSpan() - 1;
                    if (t.getColIndex() <= g) {
                        g = t.getColIndex() - 1
                    }
                    if (c > u.width) {
                        u.width = c
                    }
                }
                if (u.width == p.width) {
                    d = g;
                    u.width = g
                } else {
                    break
                }
            }
            break;
        case DNA.widget.JWTGrid.RIGHT:
            var s = this.util.getRightCol(p.width);
            if (!this.util.isDataCol(s)) {
                return null 
            }
            u.width++;
            while (s > 0) {
                var m = s;
                for (var l = p.y; l <= p.height; ++l) {
                    t = new DNA.widget.AbstractGridCellAsync(this,this.tDiv,s,l,false);
                    var c = t.getColIndex() + t.getColSpan() - 1;
                    if (c >= m) {
                        m = c + 1
                    }
                    if (c > u.width) {
                        u.width = c
                    }
                }
                if (u.width == p.width) {
                    s = m;
                    u.width = m
                } else {
                    break
                }
            }
            break;
        case DNA.widget.JWTGrid.UP:
            var o = this.util.getUpRow(p.height);
            u.height--;
            while (o > 0) {
                var v = o;
                for (var l = p.x; l <= p.width; ++l) {
                    t = new DNA.widget.AbstractGridCellAsync(this,this.tDiv,l,o,false);
                    var n = t.getRowIndex() + t.getRowSpan() - 1;
                    if (t.getRowIndex() <= v) {
                        v = t.getRowIndex() - 1
                    }
                    if (n < u.height) {
                        u.height = n
                    }
                }
                if (u.height == p.height) {
                    o = v;
                    u.height = v
                } else {
                    break
                }
            }
            break;
        case DNA.widget.JWTGrid.DOWN:
            var a = this.util.getDownRow(p.height);
            if (!this.util.isDataRow(a)) {
                return null 
            }
            u.height++;
            while (a > 0) {
                var q = a;
                for (var l = p.x; l <= p.width; ++l) {
                    t = new DNA.widget.AbstractGridCellAsync(this,this.tDiv,l,a,false);
                    var n = t.getRowIndex() + t.getRowSpan() - 1;
                    if (n >= q) {
                        q = n + 1
                    }
                    if (n > u.height) {
                        u.height = n
                    }
                }
                if (u.height == p.height) {
                    a = q;
                    u.height = q
                } else {
                    break
                }
            }
            break;
        default:
            break
        }
        return u
    },
    expandCellRect: function(g, c) {
        var b;
        var a = new DNA.widget.Rectangle(g);
        switch (c) {
        case DNA.widget.JWTGrid.LEFT:
        case DNA.widget.JWTGrid.RIGHT:
            var h = g.width - 1;
            a.width--;
            while (h > 0) {
                for (var d = g.y; x <= g.height; ++d) {
                    b = new DNA.widget.AbstractGridCellAsync(this,this.tDiv,h,d,false)
                }
            }
            break;
        case DNA.widget.JWTGrid.UP:
            break;
        case DNA.widget.JWTGrid.DOWN:
            break;
        default:
            break
        }
    },
    rectEqual: function(b, a) {
        if (b.x === a.x && b.width === a.width && b.y === a.y && b.height === a.height) {
            return true
        }
        return false
    },
    allSelectStart: function(c) {
        if (!this.checkRendered(true)) {
            return
        }
        var b = {
            x: 1,
            y: 1,
            width: this.columnCount - 1,
            height: this.rowCount - 1
        };
        var a;
        a = new DNA.widget.GridSelectionAreaAsync(this,b,false);
        this._setSelection(a);
        this.setCurrentSelection(a)
    },
    rowSelectStart: function(g) {
        if (!this.checkRendered(true)) {
            return
        }
        var n = this.mouseCell.y;
        var h = g.isCtrl();
        var b = g.isShift();
        var a = {
            x: 1,
            y: n,
            width: this.columnCount - 1,
            height: n
        };
        var o;
        if ((!h && !b) || (h && b)) {
            o = new DNA.widget.GridSelectionAreaAsync(this,a,false,this.selectionDiv,false);
            var c = this.util.getRowFirstCell(n, false, false);
            this.setCurrentCell(c, c.x, c.y, null , g.getButton());
            this._setSelection(o);
            this.setCurrentSelection(o)
        } else {
            if (h && !b) {
                o = new DNA.widget.GridSelectionAreaAsync(this,a,false,this.selectionDiv,false);
                var c = this.util.getRowFirstCell(n, false, false);
                this.setCurrentCell(c, c.x, c.y, null , g.getButton());
                this._addSelection(o);
                this.setCurrentSelection(o)
            } else {
                if (this.currentRow == -1) {
                    this.currentRow = n
                }
                var d = Math.min(this.currentRow, n);
                var l = Math.max(this.currentRow, n);
                var m = {
                    x: 1,
                    y: d,
                    width: this.columnCount - 1,
                    height: l
                };
                if (!this.currentSelection) {
                    o = new DNA.widget.GridSelectionAreaAsync(this,m,false,null ,false);
                    var c = this.util.getRowFirstCell(n, false, false);
                    this.setCurrentCell(c, c.x, c.y, null , g.getButton());
                    this._addSelection(o, false);
                    this.setCurrentSelection(o)
                } else {
                    this.currentSelection._setBound(m);
                    this.currentSelection.reBuild(true)
                }
            }
        }
    },
    colSelectStart: function(g) {
        if (!this.checkRendered(true)) {
            return
        }
        var n = this.mouseCell.x;
        var h = g.isCtrl();
        var b = g.isShift();
        var a = {
            x: n,
            y: 1,
            width: n,
            height: this.rowCount - 1
        };
        var m;
        if ((!h && !b) || (h && b)) {
            var c = this.util.getColFirstCell(n, false, false);
            this.setCurrentCell(c, c.x, c.y, null , g.getButton());
            m = new DNA.widget.GridSelectionAreaAsync(this,a,false,this.selectionDiv,false);
            this._setSelection(m);
            this.setCurrentSelection(m)
        } else {
            if (h && !b) {
                var c = this.util.getColFirstCell(n, false, false);
                this.setCurrentCell(c, c.x, c.y, null , g.getButton());
                m = new DNA.widget.GridSelectionAreaAsync(this,a,false,this.selectionDiv,false);
                this._addSelection(m);
                this.setCurrentSelection(m)
            } else {
                if (this.currentCol == -1) {
                    this.currentCol = n
                }
                var d = Math.min(this.currentCol, n);
                var o = Math.max(this.currentCol, n);
                var l = {
                    x: d,
                    y: 1,
                    width: o,
                    height: this.rowCount - 1
                };
                if (!this.currentSelection) {
                    m = new DNA.widget.GridSelectionAreaAsync(this,l,false,null ,false);
                    var c = this.util.getColFirstCell(n, false, false);
                    this.setCurrentCell(c, c.x, c.y, null , g.getButton());
                    this._addSelection(m, false);
                    this.setCurrentSelection(m)
                } else {
                    this.currentSelection._setBound(l);
                    this.currentSelection.reBuild(true)
                }
            }
        }
    },
    checkSelRange: function(a) {
        if (a.x < 1 || a.width >= this.columnCount || a.x > a.width) {
            return false
        }
        if (a.y < 1 || a.height >= this.rowCount || a.y > a.height) {
            return false
        }
        return true
    },
    getSelections: function() {
        var b = this.selectionAreas.length;
        var a = new Array();
        for (var c = 0; c < b; ++c) {
            var d = this.selectionAreas[c];
            a.push({
                x: d.x,
                y: d.y,
                width: d.width - d.x + 1,
                height: d.height - d.y + 1
            })
        }
        return a
    },
    getSelection: function() {
        var a = new DNA.widget.Rectangle();
        if (this.currentSelection) {
            a.x = this.currentSelection.x;
            a.y = this.currentSelection.y;
            a.width = this.currentSelection.width - this.currentSelection.x + 1;
            a.height = this.currentSelection.height - this.currentSelection.y + 1
        }
        return a
    },
    addSelection: function(b) {
        if (!this.checkRendered(true) || !b || !this.checkSelRange(b)) {
            return
        }
        this.selectionDiv.style.width = "0px";
        var a = new DNA.widget.GridSelectionAreaAsync(this,b,true,null ,false);
        this._internalDrawTitle(a, true, true);
        this.selectionAreas.push(a)
    },
    setSelection: function(b) {
        if (!this.checkRendered(true)) {
            return
        }
        this._clearSelection();
        if (!b || !this.checkSelRange(b)) {
            return
        }
        var a = new DNA.widget.GridSelectionAreaAsync(this,b,true,null ,false);
        this._internalDrawTitle(a, true, true);
        this.selectionAreas.push(a)
    },
    setSelections: function(b) {
        if (!this.checkRendered(true)) {
            return
        }
        this._clearSelection();
        if (!b) {
            return
        }
        var a = b.length;
        for (var c = 0; c < a; ++c) {
            this.addSelection(b[c])
        }
    },
    _addSelection: function(a) {
        if (!this.checkRendered(true)) {
            return
        }
        this._internalDrawTitle(a, true, true);
        this.selectionAreas.push(a)
    },
    _setSelection: function(a) {
        if (!this.checkRendered(true)) {
            return
        }
        this._clearSelection();
        this._internalDrawTitle(a, true, true);
        this.selectionAreas.push(a)
    },
    _drawTitlesBack: function(g) {
        if (!this.checkRendered(true)) {
            return
        }
        var m = g.x;
        var d = g.width;
        var l = g.y;
        var b = g.height;
        var h = this._getRowDom(0, this.hrDiv);
        var a;
        for (var c = m; c <= d; ++c) {
            a = this._getRowCell(h, c, 0);
            a.style.backgroundColor = "";
            a.style.borderColor = "";
            if (c < this.hColCount) {
                a = this._getCellDom(c, 0, this.hltDiv);
                a.style.backgroundColor = "";
                a.style.borderColor = ""
            }
        }
        for (var c = l; c <= b; ++c) {
            a = this._getCellDom(0, c, this.hcDiv);
            a.style.backgroundColor = "";
            a.style.borderColor = "";
            if (c < this.hRowCount) {
                a = this._getCellDom(0, c, this.hltDiv);
                a.style.backgroundColor = "";
                a.style.borderColor = ""
            }
        }
    },
    _colInCurSel: function(b) {
        var a = this.selectionAreas.length;
        for (var c = 0; c < a; ++c) {
            var d = this.selectionAreas[c];
            if ((b >= d.x) && (b <= d.width)) {
                return true
            }
        }
        return false
    },
    _rowInCurSel: function(d) {
        var a = this.selectionAreas.length;
        for (var b = 0; b < a; ++b) {
            var c = this.selectionAreas[b];
            if ((d >= c.y) && (d <= c.height)) {
                return true
            }
        }
        return false
    },
    _clearSelTitle: function() {
        var a = this.selectionAreas.length;
        for (var b = 0; b < a; ++b) {
            var c = this.selectionAreas[b]
        }
    },
    clearSelection: function() {
        this._clearSelection()
    },
    _clearSelection: function(c) {
        this.currentSelection = null ;
        var a = this.selectionAreas.length;
        var d;
        for (var b = (a - 1); b >= 0; --b) {
            d = this.selectionAreas.pop();
            if (d) {
                this._internalDrawTitle(d, true, false);
                d.destroy()
            }
        }
        if (a) {
            this.selectionAreas.length = 0;
            if (c) {
                this.fireSelectionEvent()
            }
        }
    },
    _reComputeSelections: function(g, b) {
        var a = this.selectionAreas.length;
        var d;
        for (var c = 0; c < a; c++) {
            d = this.selectionAreas[c];
            if (d) {
                if (g != -1 && g <= d.height) {
                    d.setDivSize();
                    continue
                }
                if (b != -1 && b <= d.width) {
                    d.setDivSize()
                }
            }
        }
    },
    setCurrentSelection: function(a) {
        if (this.currentSelection) {
            if (!this.currentSelection.isBuild()) {
                this.currentSelection.reBuild(true)
            }
        }
        this.currentSelection = a
    },
    getCurrentSelection: function() {
        if (this.currentSelection) {
            return this.currentSelection
        } else {
            if (this.selectionAreas && this.selectionAreas.length > 0) {
                return this.selectionAreas[0]
            }
        }
    },
    mouseCellSelectStart: function(g) {
        this.selectFinish = false;
        var a = g.isShift();
        var h = g.isCtrl();
        var b = this.mouseCell;
        this.selBeginCell = b;
        switch (this.getSelectionMode()) {
        case DNA.widget.JWTGrid.SELECTION_MODE_MULTI:
            if ((!h && !a) || (h && a)) {
                this.setCurrentCell(b, null , null , null , g.getButton());
                var m = {
                    x: b.x,
                    y: b.y,
                    width: b.x,
                    height: b.y
                };
                var n = new DNA.widget.GridSelectionAreaAsync(this,m,true,this.selectionDiv,true);
                this._setSelection(n);
                this.setCurrentSelection(n)
            } else {
                if (h && !a) {
                    this.setCurrentCell(b, null , null , null , g.getButton());
                    var m = {
                        x: b.x,
                        y: b.y,
                        width: b.x,
                        height: b.y
                    };
                    var n = new DNA.widget.GridSelectionAreaAsync(this,m,true,this.selectionDiv,true);
                    this._addSelection(n);
                    this.setCurrentSelection(n)
                } else {
                    if (this.selectionAreas.length === 0) {
                        this.setCurrentCell(b, null , null , null , g.getButton());
                        var m = {
                            x: b.x,
                            y: b.y,
                            width: b.x,
                            height: b.y
                        };
                        var n = new DNA.widget.GridSelectionAreaAsync(this,m,true,this.selectionDiv,true);
                        this._setSelection(n);
                        this.setCurrentSelection(n)
                    } else {
                        var m = {
                            x: this.currentCol,
                            y: this.currentRow,
                            width: b.x,
                            height: b.y
                        };
                        var n = new DNA.widget.GridSelectionAreaAsync(this,m,true,null ,false);
                        this._setSelection(n);
                        this.setCurrentSelection(n)
                    }
                }
            }
            break;
        case DNA.widget.JWTGrid.SELECTION_MODE_ROW:
            var m = {
                x: 1,
                y: b.y,
                width: this.columnCount - 1,
                height: b.y
            };
            if ((!h && !a) || (h && a)) {
                this.setCurrentCell(b, null , null , null , g.getButton());
                var n;
                for (var d = this.selectionAreas.length - 1; d >= 0; d--) {
                    if (this.util.rectEqual(this.selectionAreas[d], m)) {
                        n = this.selectionAreas[d];
                        this.selectionAreas.removeAt(d)
                    }
                }
                if (!n) {
                    n = new DNA.widget.GridSelectionAreaAsync(this,m,false,this.selectionDiv,false)
                }
                this._setSelection(n);
                this.setCurrentSelection(n)
            } else {
                if (h && !a) {
                    this.setCurrentCell({
                        x: this.util.getFirstCol(false),
                        y: b.y
                    }, null , null , null , g.getButton());
                    var n = new DNA.widget.GridSelectionAreaAsync(this,m,false,this.selectionDiv,false);
                    this._addSelection(n);
                    this.setCurrentSelection(n)
                } else {
                    if (this.currentCell) {
                        var c = Math.min(this.currentRow, b.y);
                        var l = Math.max(this.currentRow, b.y);
                        for (var d = c + 1; d <= l; ++d) {
                            m = {
                                x: 1,
                                y: d,
                                width: this.columnCount - 1,
                                height: d
                            };
                            var n = new DNA.widget.GridSelectionAreaAsync(this,m,false,this.selectionDiv,false);
                            this._addSelection(n)
                        }
                    }
                }
            }
            break;
        case DNA.widget.JWTGrid.SELECTION_MODE_SINGLE:
            this.setCurrentCell(b, null , null , null , g.getButton());
            var m = {
                x: b.x,
                y: b.y,
                width: b.x,
                height: b.y
            };
            var n = new DNA.widget.GridSelectionAreaAsync(this,m,false,this.selectionDiv,true);
            this._setSelection(n);
            this.setCurrentSelection(n);
            break
        }
    },
    mouseCellSelecting: function(c) {
        if (!this.currentSelection) {
            return
        }
        var d = this.getSelectionMode();
        if (d == DNA.widget.JWTGrid.SELECTION_MODE_SINGLE || d == DNA.widget.JWTGrid.SELECTION_MODE_ROW) {
            return
        }
        var b = this.mouseCell;
        if (b.x == this.lastMouseCell.x && b.y == this.lastMouseCell.y) {
            return
        }
        if (this.currentCol < this.hColCount) {
            this.tDiv.scrollLeft = "0px"
        }
        if (this.currentRow < this.hRowCount) {
            this.tDiv.scrollTop = "0px"
        }
        this.lastMouseCell = b;
        var a = {
            x: this.currentCol,
            y: this.currentRow,
            width: b.x,
            height: b.y
        };
        this.currentSelection._setBound(a);
        this.currentSelection.reBuild(true)
    },
    mouseCellSelectEnd: function(g) {
        if (this.selectFinish) {
            return
        }
        this.selectFinish = true;
        this.selectionDiv.style.width = "0px";
        this.selectionDiv.style.borderStyle = "none";
        this.selectionDiv.style.borderWidth = "0px";
        if (this.currentSelection) {
            if (this.getSelectionMode() != DNA.widget.JWTGrid.SELECTION_MODE_ROW && this.currentCell) {
                var c = this.currentCell.getColIndex();
                var h = this.currentCell.getRowIndex();
                var d = c + this.currentCell.getColSpan();
                var a = h + this.currentCell.getRowSpan();
                if (this.mouseCell && (this.mouseCell.x >= c) && (this.mouseCell.y >= h) && (this.mouseCell.x < d) && (this.mouseCell.y < a)) {
                    this.fireEvent("selection", [this]);
                    return
                }
            }
            this.currentSelection.setDivSize();
            this._internalDrawTitle(this.currentSelection, false, true);
            this.fireEvent("selection", [this])
        }
    },
    setActiveEditor: function(a) {
        if (this.activeEditor) {
            this.activeEditor.close()
        }
        this.activeEditor = a
    },
    openEditor: function(q, m, o, h, g) {
        if (!this.editorProvider || !q.td) {
            return
        }
        var l = this.editorProvider.getCellEditor(this, q);
        if (!l.control) {
            return
        }
        if (this._eidtorIsOpen(q, l)) {
            return
        }
        this._hideFace();
        var n = DNA.engine.DomUtil.getInnerText(q.td);
        if (!n) {
            n = ""
        }
        q.td.setAttribute("st", n);
        DNA.engine.DomUtil.setInnerText(q.td.firstChild, "");
        this.setActiveEditor(l);
        this.activeEditor.open(o, h, g);
        this.focusable = false;
        var a = {
            grid: this,
            col: this.currentCol,
            row: this.currentRow,
            showText: this.currentCell.getShowText(),
            editText: this.currentCell.getEditText()
        };
        this.fireEvent("beforeedit", [a]);
        if (m && m.getKeyCode()) {
            var b = m.getKeyCode();
            var p = String.fromCharCode(b);
            var d = l.getText();
            var c = d + p;
            l.setText(c)
        }
    },
    _eidtorIsOpen: function(a, b) {
        return this._getPermanentHolder(a.colIndex, a.rowIndex) == b.control.getEl().parentNode
    },
    setCellEditorProvider: function(a) {
        this.editorProvider = a
    },
    closeEditor: function(h) {
        this.focusable = true;
        if (!this.currentCell) {
            this.activeEditor = null 
        }
        if (this.activeEditor) {
            var d = this.activeEditor.getResult(h ? h : 0);
            if (!d) {
                var c = this.currentCell.getShowText();
                this.activeEditor.close();
                this.activeEditor = null ;
                var a = this.getCell(this.currentCell.getColIndex(), this.currentCell.getRowIndex());
                a.setShowText(c, true);
                return
            }
            var b = d.getShowText();
            var l = d.getEditText();
            var m = {
                grid: this,
                col: this.currentCol,
                row: this.currentRow,
                showText: b,
                editText: l
            };
            this.fireEvent("afteredit", [m]);
            this.activeEditor.close();
            var a = this.getCell(this.currentCell.getColIndex(), this.currentCell.getRowIndex());
            a.setEditText(m.editText ? m.editText : "", true);
            var g = this.getFormattedText(a);
            if (g) {
                a.setShowText(g, true)
            } else {
                a.setShowText(m.showText ? m.showText : "", true)
            }
            this.fireDataChangeEvent({
                x: this.currentCol,
                y: this.currentRow,
                width: this.currentCol,
                height: this.currentRow
            }, DNA.widget.JWTGrid.DATACHANGE_INPUT);
            this.activeEditor = null 
        }
    },
    getFormattedText: function(a) {
        try {
            var b = this.formatterMgr.getFormatter(a.getFormatter());
            if (b) {
                return b.format(a.getEditText())
            }
        } catch (c) {
            return null 
        }
    },
    ensureEditorClose: function(a, b) {
        if (!this.currentCell && this.activeEditor) {
            this.activeEditor.close();
            this.activeEditor = null ;
            return true
        }
        if (this.activeEditor && this.currentCell) {
            if (a.getRowIndex() == this.currentCell.getRowIndex() && a.getColIndex() == this.currentCell.getColIndex()) {
                if (!this.activeEditor.getCloseFlag()) {
                    if (b) {
                        this.closeEditor()
                    }
                    return false
                }
            }
        }
        return true
    },
    reInitEditor: function(a) {
        if (!this.currentCell) {
            this.activeEditor = null ;
            return
        }
        if (this.activeEditor) {
            if (a.getRowIndex() == this.currentCell.getRowIndex() && a.getColIndex() == this.currentCell.getColIndex()) {
                this.activeEditor.initEditor(-1)
            }
        }
    },
    _autoScroll: function(d) {
        var p = d.getLocation();
        var b = this.tDiv.offsetHeight;
        var g = this.tDiv.offsetWidth;
        var m = DNA.engine.DomUtil.getClientSize(this.tDiv);
        var o = DNA.engine.DomUtil.getSize(this.hrTable);
        var n = DNA.engine.DomUtil.getSize(this.hcTable);
        var a = 100;
        var l = 20;
        var c = 30;
        var h = 10;
        if (m.width - p.x < a) {
            if (this.tDiv.scrollLeft + m.width + l <= g) {
                this.tDiv.scrollLeft += (l)
            } else {
                this.tDiv.scrollLeft = g - m.width
            }
        }
        if (p.x - n.width < a) {
            if (this.tDiv.scrollLeft - l >= 0) {
                this.tDiv.scrollLeft -= (l)
            } else {
                this.tDiv.scrollLeft = 0
            }
        }
        if (m.height - p.y < c) {
            if (this.tDiv.scrollTop + m.height + h <= b) {
                this.tDiv.scrollTop += (h)
            } else {
                this.tDiv.scrollTop = b - m.height
            }
        }
        if (p.y - o.height < c) {
            if (this.tDiv.scrollTop - h >= 0) {
                this.tDiv.scrollTop -= (h)
            } else {
                this.tDiv.scrollTop = 0
            }
        }
    },
    synchronizeData: function() {
        if (this.activeEditor) {
            var c = this.activeEditor.getResult();
            var b = c.getShowText();
            var d = c.getEditText();
            var a = this.getCell(this.currentCell.getColIndex(), this.currentCell.getRowIndex());
            a.setShowText(b ? b : "", true, true);
            a.setEditText(d ? d : "", true);
            this.fireDataChangeEvent({
                x: this.currentCol,
                y: this.currentRow,
                width: this.currentCol,
                height: this.currentRow
            }, DNA.widget.JWTGrid.DATACHANGE_INPUT)
        }
    },
    synDataNoFire: function() {
        if (this.activeEditor) {
            var c = this.activeEditor.getResult();
            var b = c.getShowText();
            var d = c.getEditText();
            var a = this.getCell(this.currentCell.getColIndex(), this.currentCell.getRowIndex());
            a.setShowText(b ? b : "", true, true);
            a.setEditText(d ? d : "", true);
            this.fireDataChangeEvent({
                x: this.currentCol,
                y: this.currentRow,
                width: this.currentCol,
                height: this.currentRow
            }, DNA.widget.JWTGrid.DATACHANGE_INPUT, true)
        }
    },
    synDataToCellProperty: function() {
        if (this.activeEditor) {
            var c = this.activeEditor.getResult();
            var b = c.getShowText();
            var d = c.getEditText();
            var a = this.getCell(this.currentCell.getColIndex(), this.currentCell.getRowIndex());
            a.setShowText(b ? b : "", true, true);
            a.setEditText(d ? d : "", true)
        }
    },
    insertRowHtml: function(c, a) {
        if (c <= 1 || c > this.rowCount) {
            return
        }
        var b = this.tDiv.childNodes[c];
        b.insertAdjacentElement("afterEnd", a)
    },
    replaceRowHtml: function(c, a) {
        if (c <= 1 || c >= this.rowCount) {
            return
        }
        var b = this.tDiv.childNodes[c];
        b.insertAdjacentElement("afterEnd", a);
        b.replaceNode(this.tDiv.childNodes[c + 1])
    },
    fireDataChangeEvent: function(c, b, a) {
        this.fireEvent("datachange", [this, c, b, a])
    },
    fireSelectionEvent: function() {
        this.fireEvent("selection", [this])
    },
    fireCurrentCellChangedEvent: function() {
        this.fireEvent("currentCellChanged", [this])
    },
    fireCurrentCellChangingEvent: function(a) {
        this.fireEvent("currentCellChanging", [a])
    },
    _internalDrawTitle: function(o, l, b) {
        if (!this.checkRendered(true)) {
            return
        }
        var c = o.x;
        var p = o.width;
        var n = o.y;
        var a = o.height;
        var q;
        var m = this._getRowDom(0, this.hrTable);
        for (var g = c; g <= p; ++g) {
            if (!l || !this._colInCurSel(g)) {
                q = this._getRowCell(m, g, 0);
                if (q) {
                    if (b) {
                        q.style.backgroundColor = this._selTitleBackColor;
                        q.style.borderColor = this._selTitleBorderColor
                    } else {
                        var h = q.getAttribute("bgc");
                        if (!h) {
                            h = ""
                        }
                        var d = q.getAttribute("rbc");
                        if (!d) {
                            d = ""
                        }
                        var r = q.getAttribute("bbc");
                        if (!r) {
                            r = ""
                        }
                        q.style.backgroundColor = h;
                        q.style.borderRightColor = d;
                        q.style.borderBottomColor = r;
                        q.style.borderLeftColor = "";
                        q.style.borderTopColor = ""
                    }
                }
                if (g < this.hColCount) {
                    q = this._getCellDom(g, 0, this.hltTab);
                    if (q) {
                        if (b) {
                            q.style.backgroundColor = this._selTitleBackColor;
                            q.style.borderColor = this._selTitleBorderColor
                        } else {
                            var h = q.getAttribute("bgc");
                            if (!h) {
                                h = ""
                            }
                            var d = q.getAttribute("rbc");
                            if (!d) {
                                d = ""
                            }
                            var r = q.getAttribute("bbc");
                            if (!r) {
                                r = ""
                            }
                            q.style.backgroundColor = h;
                            q.style.borderRightColor = d;
                            q.style.borderBottomColor = r;
                            q.style.borderLeftColor = "";
                            q.style.borderTopColor = ""
                        }
                    }
                }
            }
        }
        for (var g = n; g <= a; ++g) {
            if (!l || !this._rowInCurSel(g)) {
                q = this._getCellDom(0, g, this.hcTable);
                if (q) {
                    if (b) {
                        q.style.backgroundColor = this._selTitleBackColor;
                        q.style.borderColor = this._selTitleBorderColor
                    } else {
                        var h = q.getAttribute("bgc");
                        if (!h) {
                            h = ""
                        }
                        var d = q.getAttribute("rbc");
                        if (!d) {
                            d = ""
                        }
                        var r = q.getAttribute("bbc");
                        if (!r) {
                            r = ""
                        }
                        q.style.backgroundColor = h;
                        q.style.borderRightColor = d;
                        q.style.borderBottomColor = r;
                        q.style.borderLeftColor = "";
                        q.style.borderTopColor = ""
                    }
                }
                if (g < this.hRowCount) {
                    q = this._getCellDom(0, g, this.hltTab);
                    if (q) {
                        if (b) {
                            q.style.backgroundColor = this._selTitleBackColor;
                            q.style.borderColor = this._selTitleBorderColor
                        } else {
                            var h = q.getAttribute("bgc");
                            if (!h) {
                                h = ""
                            }
                            var d = q.getAttribute("rbc");
                            if (!d) {
                                d = ""
                            }
                            var r = q.getAttribute("bbc");
                            if (!r) {
                                r = ""
                            }
                            q.style.backgroundColor = h;
                            q.style.borderRightColor = d;
                            q.style.borderBottomColor = r;
                            q.style.borderLeftColor = "";
                            q.style.borderTopColor = ""
                        }
                    }
                }
            }
        }
    },
    ensureHAndW: function(h) {
        if (!h) {
            return
        }
        var n = h.getRowIndex();
        var b = h.getColIndex();
        var d = this.util.getRowAutoHeight(n);
        var a = this.util.getColAutoWidth(b);
        if (d) {
            var l = 0;
            for (var c = 0; c < this.columnCount; ) {
                var g = new DNA.widget.AbstractGridCellAsync(this,this.tDiv,c,n,false);
                var m = DNA.engine.DomUtil.computeTextSize(h.getShowText(), h.getFont());
                if (m.height > l) {
                    l = m.height
                }
                c += g.getColSpan()
            }
            this.setRowHeight(n, l)
        }
    },
    _focusDom: function(a) {
        if (DNA.engine.Client.isIE() && this.tDiv && this.tDiv.ownerDocument.activeElement == this.inputProxy) {
            return
        }
        if (this.tDiv && DNA.engine.Client.isFF()) {
            this.tDiv.focus()
        }
        this._focusInputProxy()
    },
    getScrollTop: function() {
        return this.tDiv.scrollTop
    },
    getScrollLeft: function() {
        return this.tDiv.scrollLeft
    },
    setScrollTop: function(a) {
        this.tDiv.scrollTop = Math.max(0, a)
    },
    setScrollLeft: function(a) {
        return this.tDiv.scrollLeft = Math.max(0, a)
    },
    getClientHeight: function() {
        return this.tDiv.clientHeight
    },
    _getScrollElement: function() {
        return this.tDiv
    },
    _showEditor: function() {
        if (this.currentCell) {
            var b = this.currentCell.getColIndex();
            var g = this.currentCell.getRowIndex();
            if (!(this.getEditMode() != DNA.widget.JWTGrid.EDIT_MODE_READONLY) && this.util.isCellEditable(b, g)) {
                return
            }
            var a = new DNA.widget.AbstractGridCellAsync(this,null ,b,g,false);
            if (!this.editorProvider) {
                return
            }
            var c = this.editorProvider.getCellEditor(this, a);
            if (!c.control) {
                return
            }
            if (this._eidtorIsOpen(a, c)) {
                return
            }
            this._hideFace();
            var d = DNA.engine.DomUtil.getInnerText(a.td);
            if (!d) {
                d = ""
            }
            a.td.setAttribute("st", d);
            if (DNA.engine.Client.isFF() && a.td.getAttribute("wl")) {
                DNA.engine.DomUtil.setInnerText(a.td.firstChild, "")
            } else {
                DNA.engine.DomUtil.setInnerText(a.td, "")
            }
            this.setActiveEditor(c);
            this.activeEditor.open(false, null , null , true);
            this.focusable = false
        }
    },
    _hideEditor: function() {
        this.focusable = true;
        if (!this.currentCell) {
            this.activeEditor = null 
        }
        if (this.activeEditor) {
            this.activeEditor.close();
            this.activeEditor = null 
        }
    },
    _scrollToCol: function(b) {
        if (!this.checkRendered(true)) {
            return
        }
        if (b <= 0 || b >= this.columnCount) {
            return
        }
        if (b < this.hColCount) {
            return
        }
        var g = this.tDiv.clientWidth;
        var a = this.hcDiv.clientWidth;
        var d = this.tDiv.scrollLeft;
        var c = this.util.getColOffsetLeft(b);
        if (g + d < c + this.getColumnWidth(b)) {
            this.tDiv.scrollLeft = c - g + this.getColumnWidth(b)
        } else {
            if (d + a > c) {
                this.tDiv.scrollLeft = Math.max(c - a, 0)
            }
        }
    },
    _scrollToRow: function(g) {
        if (!this.checkRendered(true)) {
            return
        }
        if (g <= 0 || g >= this.rowCount) {
            return
        }
        if (g < this.hRowCount) {
            return
        }
        var b = this.tDiv.clientHeight;
        var a = this.hrDiv.clientHeight;
        var d = this.tDiv.scrollTop;
        var c = this.util.getRowOffsetTop(g);
        if (b + d < c + this.getRowHeight(g)) {
            this.tDiv.scrollTop = c - b + this.getRowHeight(g)
        } else {
            if (d + a > c) {
                this.tDiv.scrollTop = Math.max(c - a, 0)
            }
        }
    },
    fullUpdateNoIframe: function(a) {
        this.tDiv.innerHTML = a;
        this._replaceDom()
    },
    setRenderedTop: function(a) {
        this.renderedTop = a
    },
    setRenderedCount: function(a) {
        this.renderedCount = a
    },
    getUpTakenRowHeight: function() {
        return parseInt(this.utrs[1].style.height, 10)
    },
    setUpTakenRowHeight: function(a) {
        this._removeAllCellHTML();
        this._setUpTakenRowHeight(a);
        this._placeAllCellHTML()
    },
    _setUpTakenRowHeight: function(a) {
        for (var b = 0; b < this.utrs.length; b++) {
            if (this.utrs[b]) {
                this.utrs[b].style.height = this._getPXSize(a)
            }
        }
    },
    getDownTakenRowHeight: function() {
        return parseInt(this.dtrs[1].style.height, 10)
    },
    setDownTakenRowHeight: function(a) {
        for (var b = 0; b < this.dtrs.length; b++) {
            if (this.dtrs[b]) {
                this.dtrs[b].style.height = this._getPXSize(a)
            }
        }
    },
    replaceLoadHtml: function(a, b) {
        this._replaceHtml(this.tDiv, b);
        this._replaceHtml(this.hcDiv.firstChild, a);
        this._buildTakenDiv();
        this._adjustRowDomWidth()
    },
    _replaceHtml: function(b, a) {
        var c = document.createElement("div");
        DNA.engine.DomUtil.append(c, b.firstChild.cloneNode(false).outerHTML);
        DNA.engine.DomUtil.append(c, a);
        DNA.engine.DomUtil.append(c, b.lastChild.cloneNode(false).outerHTML);
        b.innerHTML = c.innerHTML;
        b.zoom = 1
    },
    _getPermanentHolder: function(c, a) {
        var b;
        if (c < this.getHeaderColumnCount()) {
            if (a < this.getHeaderRowCount()) {
                b = this.hltDiv
            } else {
                if (a >= this.getHeaderRowCount() && a < this.getRowCount()) {
                    b = this.hrDiv
                }
            }
        } else {
            if (c >= this.getHeaderColumnCount() && c < this.getColumnCount()) {
                if (a < this.getHeaderRowCount()) {
                    b = this.hcDiv.childNodes[1]
                } else {
                    if (a >= this.getHeaderRowCount() && a < this.getRowCount()) {
                        b = this.cwDiv
                    }
                }
            }
        }
        return b
    },
    _hasVScroll: function() {
        var b = false
          , l = false;
        var h = 0, d, c;
        var a = this.tDiv.clientWidth
          , g = this.tDiv.clientHeight;
        for (d = 0,
        c = this.getColumnCount(); d < c; d++) {
            if (!this.getColHidden(d)) {
                h += this.getColumnWidth(d)
            }
            if (h > a) {
                b = true;
                break
            }
        }
        h = 0;
        g = b ? g - 17 : g;
        for (d = 0,
        c = this.getRowCount(); d < c; d++) {
            if (!this.getRowHidden(d)) {
                h += this.getRowHeight(d)
            }
            if (h > g) {
                l = true;
                break
            }
        }
        return l
    },
    _hasHScroll: function() {
        var b = false
          , l = false;
        var h = 0, d, c;
        var a = this.tDiv.clientWidth
          , g = this.tDiv.clientHeight;
        for (d = 0,
        c = this.getRowCount(); d < c; d++) {
            if (!this.getRowHidden(d)) {
                h += this.getRowHeight(d)
            }
            if (h > g) {
                l = true;
                break
            }
        }
        h = 0;
        a = l ? a - 17 : a;
        for (d = 0,
        c = this.getColumnCount(); d < c; d++) {
            if (!this.getColHidden(d)) {
                h += this.getColumnWidth(d)
            }
            if (h > a) {
                b = true;
                break
            }
        }
        return b
    },
    _resizeMergeDiv: function(l) {
        if (l) {
            var a = parseInt(l.getAttribute("ri"), 10);
            var d = parseInt(l.getAttribute("ci"), 10);
            var b = parseInt(l.getAttribute("rs"), 10);
            var g = parseInt(l.getAttribute("cs"), 10);
            var h = DNA.engine.Client.isIE() ? 0 : 5;
            var c = DNA.engine.Client.isIE() ? 0 : 1;
            DNA.engine.DomUtil.setSize(l, {
                width: this.getColumnWidthCount(d, d + g) - h,
                height: this.getRowHeightCount(a, a + b) - c
            });
            DNA.engine.DomUtil.setLeftTop(l, this.getColumnWidthCount(0, d), this.getRowHeightCount(0, a))
        }
    },
    _getPXSize: function(a) {
        return Math.max(a, 0) + "px"
    },
    setCurrentCellColor: function(b, a) {
        this.currentCellColorFocused = b;
        this.currentCellColorUnFocused = a;
        this.updateCurrentCellColor()
    },
    updateCurrentCellColor: function() {
        if (this.currentCellColorFocused === null  || this.currentCellColorUnFocused === null ) {
            return
        }
        var a;
        var c = [this.curLeft, this.curRight, this.curBottom, this.curTop];
        if (DNA.engine.DomUtil.hasClass(this.el, "focus")) {
            a = this.currentCellColorFocused
        } else {
            a = this.currentCellColorUnFocused
        }
        for (var b = 0; b < c.length; b++) {
            c[b].style.backgroundColor = a
        }
    }
});
Object.override(DNA.widget.GridAsync.prototype, {
    jtype: "GridAsync",
    focusable: true
});
DNA.widget.GridSelectionAreaAsync = function(b, d, a, g, c) {
    this.grid = b;
    this.div = null ;
    this._setBound(d);
    this.computeFlag = a;
    this.ranges = new Array();
    this.divs = new Array();
    if (a) {
        this.calculateRange()
    }
    if (g) {
        this.div = g
    } else {
        if (!(this.y == this.height && this.x == this.width)) {
            this.createDiv()
        }
    }
    if (!c) {
        this.setDivSize()
    }
}
;
Object.override(DNA.widget.GridSelectionAreaAsync.prototype, {
    getRange: function() {
        return {
            x: this.x,
            y: this.y,
            width: this.width,
            height: this.height
        }
    },
    _setBound: function(a) {
        this.y = a.y <= a.height ? a.y : a.height;
        this.height = a.y <= a.height ? a.height : a.y;
        this.x = a.x <= a.width ? a.x : a.width;
        this.width = a.x <= a.width ? a.width : a.x
    },
    isBuild: function() {
        return this.buildFlag
    },
    createDiv: function() {
        this.buildFlag = true;
        this.div = null ;
        var a = this.grid.hColCount;
        var h = this.grid.hRowCount;
        var n = this.grid.columnCount - 1;
        var m = this.grid.rowCount - 1;
        var l = {
            x: this.x,
            y: this.y,
            width: this.width,
            height: this.height
        };
        var o = "<div class='grid_select_area_divAsync' unselectable='on'></div>";
        if (DNA.engine.Client.isIE() && DNA.engine.Client.getBrowserVersion() < 7) {
            o = "<div class='grid_select_area_div_IE6Async' unselectable='on'></div>"
        }
        var b = this._getRectIntersection(l, {
            x: a,
            y: h,
            width: n,
            height: m
        });
        if (b) {
            this.ranges.push(b);
            DNA.engine.DomUtil.insertAfter(this.grid.cwDiv.lastChild, o);
            this.divs.push(this.grid.cwDiv.lastChild)
        }
        var c = this._getRectIntersection(l, {
            x: 1,
            y: h,
            width: a - 1,
            height: m
        });
        if (c) {
            this.ranges.push(c);
            DNA.engine.DomUtil.insertAfter(this.grid.hcDiv.childNodes[1].lastChild, o);
            this.divs.push(this.grid.hcDiv.childNodes[1].lastChild)
        }
        var d = this._getRectIntersection(l, {
            x: a,
            y: 1,
            width: n,
            height: h - 1
        });
        if (d) {
            this.ranges.push(d);
            DNA.engine.DomUtil.insertAfter(this.grid.hrDiv.lastChild, o);
            this.divs.push(this.grid.hrDiv.lastChild)
        }
        var g = this._getRectIntersection(l, {
            x: 1,
            y: 1,
            width: a - 1,
            height: h - 1
        });
        if (g) {
            this.ranges.push(g);
            DNA.engine.DomUtil.insertAfter(this.grid.hltDiv.lastChild, o);
            this.divs.push(this.grid.hltDiv.lastChild)
        }
    },
    _getRectIntersection: function(d, c) {
        if (d.width < c.x || c.width < d.x) {
            return null 
        }
        var b = d.x > c.x ? d.x : c.x;
        var g = d.width > c.width ? c.width : d.width;
        if (d.height < c.y || c.height < d.y) {
            return null 
        }
        var h = d.y > c.y ? d.y : c.y;
        var a = d.height > c.height ? c.height : d.height;
        return {
            x: b,
            y: h,
            width: g,
            height: a
        }
    },
    setDivSize: function() {
        if ((this.x == this.width) && (this.y == this.height)) {
            return
        }
        if (this.div != null ) {
            var o = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,this.x,this.y,!this.computeFlag);
            var c = o.getLeft();
            var m = o.getTop();
            var n = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,this.width,this.height,!this.computeFlag);
            var a = n.getLeft();
            var l = n.getTop();
            var b = a - c + n.getWidth() + 1;
            var p = l - m + n.getHeight() + 1;
            this.setDiv(this.div, c, m, b, p);
            return
        }
        var h = this.ranges.length;
        for (var d = 0; d < h; ++d) {
            var g = this.ranges[d];
            var o = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,g.x,g.y,!this.computeFlag);
            var c = o.getLeft();
            var m = o.getTop();
            var n = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,g.width,g.height,!this.computeFlag);
            var a = n.getLeft();
            var l = n.getTop();
            var b = a - c + n.getWidth();
            var p = l - m + n.getHeight();
            this.setDiv(this.divs[d], c, m, b, p)
        }
    },
    setDiv: function(g, b, d, c, a) {
        DNA.engine.DomUtil.setSize(g, {
            width: c,
            height: a
        });
        DNA.engine.DomUtil.setLeftTop(g, b, d)
    },
    destroy: function() {
        if (this.div != null ) {
            this.div.style.width = "0px";
            this.div = null 
        }
        var a = this.divs.length;
        for (var b = 0; b < a; ++b) {
            var c = this.divs[b];
            c.parentNode.removeChild(c)
        }
        this.ranges.length = 0;
        this.divs.length = 0
    },
    calculateRange: function() {
        var h = this.y;
        var l = this.height;
        var m = this.x;
        var a = this.width;
        var d, b;
        for (var g = h; g <= l; ++g) {
            d = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,m,g,false);
            b = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,a,g,false);
            if (d.getColIndex() < this.x) {
                this.x = d.getColIndex()
            }
            if (b.getColIndex() + b.getColSpan() - 1 > this.width) {
                this.width = b.getColIndex() + b.getColSpan() - 1
            }
        }
        for (var c = m; c <= a; ++c) {
            d = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,c,h,false);
            b = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,c,l,false);
            if (d.getRowIndex() < this.y) {
                this.y = d.getRowIndex()
            }
            if (b.getRowIndex() + b.getRowSpan() - 1 > this.height) {
                this.height = b.getRowIndex() + b.getRowSpan() - 1
            }
        }
    },
    redraw: function() {
        if (this.computeFlag) {
            this.calculateRange()
        }
        this.setDivSize()
    },
    reBuild: function(a) {
        if (a) {
            this.destroy()
        }
        if (this.computeFlag) {
            this.calculateRange()
        }
        if ((this.x == this.width) && (this.y == this.height)) {
            return
        }
        this.createDiv();
        this.setDivSize()
    }
});
DNA.widget.AbstractCellEditorAsync = function() {}
;
DNA.widget.AbstractCellEditorAsync.extend(Object, {
    getAnEditor: function(b, a) {
        this.grid = b;
        this.cell = a;
        this.control = null ;
        this.grid = b;
        this.cell = a;
        this.createEditor();
        return this
    },
    open: function(l, d, c, g) {
        if (this.control) {
            var m = this.cell.getLeft();
            var h = this.cell.getTop();
            var b = this.cell.getWidth();
            var n = this.cell.getHeight();
            if (this.control.checkRendered(true)) {
                if (!g) {
                    if (this.control.setText4Event) {
                        this.control.setText4Event("")
                    }
                }
                this.control.setVisible(true);
                this.grid._getPermanentHolder(this.cell.colIndex, this.cell.rowIndex).appendChild(this.control.getEl());
                var a = {
                    x: m,
                    y: h,
                    width: b,
                    height: n
                };
                this._cancelThread();
                this.dbClickFlag = l;
                this.detail = d;
                this.controlBounds = a;
                if (!DNA.engine.Client.isIOS()) {
                    this._thread = new DNA.engine.Thread(1,new DNA.engine.Runnable(this._delayFocus,this,[l, d, a, g]));
                    this._thread.start()
                }
                if (this.control.jtype === "Text") {
                    if (!this.control.hasListener("keydown", this, this._eidtorKeyDown)) {
                        this.control.addListener("keydown", this._eidtorKeyDown, this)
                    }
                }
                if (DNA.engine.Client.isIOS()) {
                    this._delayFocus(l, d, a, g)
                }
            }
            if (!DNA.engine.Client.isIOS()) {
                this.setOpening(true)
            }
        }
    },
    reBoundCtr: function() {
        var b = this.cell.getLeft();
        var d = this.cell.getTop;
        var c = this.cell.getWidth();
        var a = this.cell.getHeight();
        this.control.setBounds(b, d - 1, c, a + 1)
    },
    _delayFocus: function(b, d, g, c) {
        this._cancelThread();
        this.control.getEl().style.visibility = "hidden";
        this.control.setBounds(g.x, g.y, g.width, g.height);
        if (!c) {
            this.initEditor(d, this.grid.inputProxy.value)
        }
        this.control.getEl().style.visibility = "visible";
        this.control.focus();
        this.grid.inputProxy.value = "";
        this.grid.inputProxy.blur();
        if (this.control.jtype === "Text") {
            var h = this.control.getText();
            if (h && h != "") {
                var a = h.length;
                if (b) {
                    this.control.setSelectPoint(0, a)
                } else {
                    this.control.setSelectPoint(a, a)
                }
            }
        }
        this.setOpening(false);
        this.setCloseFlag(false)
    },
    _cancelThread: function() {
        if (this._thread) {
            this._thread.stop();
            this._thread = null 
        }
    },
    _editorMouseUp: new DNA.engine.Action({
        handle: function(a) {
            if (!this.control.checkRendered(true)) {
                return
            }
            this.grid.gridState = DNA.widget.JWTGrid.STATE_NORMAL
        }
    }),
    _eidtorKeyDown: new DNA.engine.Action({
        handle: function(c) {
            if (!this.control.checkRendered(true)) {
                return
            }
            switch (c.getKeyCode()) {
            case DNA.JWTEvent.LEFT:
                var b = this.control.getSelectPoint();
                if (b.x != b.y) {
                    break
                }
                if (b.x === 0) {
                    c.setSrcControl(this.grid);
                    this.grid.fireEvent("keydown", [c])
                }
                break;
            case DNA.JWTEvent.RIGHT:
                var b = this.control.getSelectPoint();
                if (b.x != b.y) {
                    break
                }
                var a = this.control.getText().length;
                if (b.y === a) {
                    c.setSrcControl(this.grid);
                    this.grid.fireEvent("keydown", [c])
                }
                break;
            default:
                break
            }
            if (this.control.setDescription) {
                this.control.setDescription("")
            }
        }
    }),
    createEditor: function() {},
    initEditor: function() {},
    getResult: function() {},
    getText: function() {},
    close: function(a) {
        this._cancelThread();
        if (!a && !this.getCloseFlag()) {
            this.control.setVisible(false);
            if (this.control.clearSelectionVar) {
                this.control.clearSelectionVar()
            }
            this.grid.getEl().appendChild(this.control.getEl());
            this.control.setBounds(0, 0, 0, 0);
            this.setCloseFlag(true)
        }
    },
    setCloseFlag: function(a) {
        this.closed = a
    },
    getCloseFlag: function() {
        return this.closed
    },
    setOpening: function(a) {
        this.opening = a
    },
    isOpening: function() {
        return this.opening
    },
    setText: function(a) {}
});
DNA.widget.CommonCellEditorAsync = function() {
    DNA.widget.CommonCellEditorAsync.superclass.constructor.call(this)
}
;
DNA.widget.CommonCellEditorAsync.extend(DNA.widget.AbstractCellEditorAsync, {
    createEditor: function() {
        if (this.cell.td) {
            var a = this.cell.td.getAttribute("ei");
            if (!a) {
                a = this.grid.defEditorId
            }
            this.control = DNA.widget.WidgetRegistry.get(a)
        }
    },
    initEditor: function(h, d) {
        if (this.cell.td) {
            var g = DNA.adapter.adapterFactory.get(this.control.jtype);
            var a = g.getWrapper(this.control);
            var m = this.cell.getShowText();
            if (!d) {
                d = this.cell.getEditText()
            }
            this.cell.td.setAttribute("st", m);
            if (a._hasEvent(DNA.JWT.CLIENT_EVENT_GRID_EDITOR_INIT)) {
                var c = new DNA.adapter.ClientGridCellEditorEvent(h);
                c.setShowText(m);
                c.setEditText(d);
                a._fireClientEvent(DNA.JWT.CLIENT_EVENT_GRID_EDITOR_INIT, c)
            } else {
                if (!m || m == " ") {
                    m = ""
                }
                if (!d || d == " " || d == "") {
                    d = m
                }
                if (this.control.jtype === "Text" || this.control.jtype === "ComboPanel") {
                    this.control.setDescription(m);
                    this.control.setText(d);
                    this.control.processText();
                    this.control.fireEvent("document", [this.control])
                } else {
                    if (this.control.jtype === "Spinner") {
                        try {
                            var n = parseInt(d);
                            if (!isNaN(n)) {
                                this.control.setSelection(n)
                            } else {
                                this.control.setSelection(this.control.getMinimum())
                            }
                        } catch (l) {
                            this.control.setSelection(this.control.getMinimum())
                        }
                    } else {
                        if (this.control.jtype === "DateTime") {
                            var b = new Date();
                            try {
                                b = Date.parse(eidtText, "Y-m-d");
                                this.control.setDate(b.getTime())
                            } catch (l) {
                                this.control.setDate(new Date().getTime())
                            }
                        }
                    }
                }
            }
        }
    },
    getText: function() {
        var a = "";
        if (this.control.getText) {
            a = this.control.getText()
        }
        return a
    },
    setText: function(a) {
        if (this.control.setText) {
            this.control.setText(a)
        }
    },
    getResult: function(b) {
        if (this.isOpening()) {
            this._delayFocus(this.dbClickFlag, this.detail, this.controlBounds)
        }
        var h = this.control.getData("wrapper");
        var a = "";
        var d = "";
        if (h._hasEvent(DNA.JWT.CLIENT_EVENT_GRID_EDITOR_GETVALUE)) {
            var g = new DNA.adapter.ClientGridCellEditorEvent(b ? b : 0);
            h._fireClientEvent(DNA.JWT.CLIENT_EVENT_GRID_EDITOR_GETVALUE, g, true);
            if (!g.doit) {
                return null 
            }
            a = g.getShowText();
            d = g.getEditText()
        } else {
            if (this.control.jtype === "Text") {
                d = this.control.getText();
                a = d
            } else {
                if (this.control.jtype === "ComboPanel") {
                    d = this.control.getText();
                    a = this.control.getDescription()
                } else {
                    if (this.control.jtype === "Spinner") {
                        d = this.control.getSelection() + "";
                        a = d
                    } else {
                        if (this.control.jtype === "DateTime") {
                            var c = this.control.getDate();
                            d = c.format("Y-m-d");
                            a = d
                        }
                    }
                }
            }
            if (!a) {
                a = d
            }
        }
        return new DNA.widget.CommonCellContent(a,d)
    }
});
DNA.widget.CellEditorProviderAsync = function() {
    DNA.widget.CellEditorProviderAsync.superclass.constructor.call();
    this.gridEditorInstance = new DNA.widget.CommonCellEditorAsync()
}
;
DNA.widget.CellEditorProviderAsync.extend(DNA.widget.ICellEditorProvider, {
    getCellEditor: function(b, a) {
        return this.gridEditorInstance.getAnEditor(b, a)
    }
});
DNA.widget.IGridCellAsync = function(b, a, c) {
    this.grid = b;
    this.x = a;
    this.y = c;
    this.table = null ;
    this.td = null ;
    this.rowIndex = -1;
    this.colIndex = -1;
    this.type = DNA.widget.JWTGrid.CELL_COMMON
}
;
DNA.widget.IGridCellAsync.extend(Object, {
    merge: function(d, g, m) {
        var h = this.rowIndex;
        var b = this.colIndex;
        var n = null ;
        for (var c = 0; c < this.grid.mergeDivs.length; c++) {
            var a = this.grid.mergeDivs[c];
            var l = parseInt(a.getAttribute("ri"), 10);
            var o = parseInt(a.getAttribute("ci"), 10);
            if (l == h && b == o && m == a.parentNode) {
                a.setAttribute("cs", d);
                a.setAttribute("rs", g);
                n = a;
                break
            }
        }
        if (!n) {
            DNA.engine.DomUtil.append(m, this.td.cloneNode(true).outerHTML);
            n = m.lastChild;
            n.className = "gridCellAsync gridMergeRect";
            n.setAttribute("ri", h);
            n.setAttribute("rs", g);
            n.setAttribute("ci", b);
            n.setAttribute("cs", d);
            this.grid.mergeDivs.push(n)
        }
        this.grid._resizeMergeDiv(n);
        this.reVertTextInMergeDiv(n)
    },
    unmerge: function(d) {
        var h = this.rowIndex;
        var g = this.colIndex;
        for (var c = 0; c < this.grid.mergeDivs.length; c++) {
            var l = this.grid.mergeDivs[c];
            var a = parseInt(l.getAttribute("ri"), 10);
            var b = parseInt(l.getAttribute("ci"), 10);
            if (a == h && g == b && d == l.parentNode) {
                Array.prototype.splice.apply(this.grid.mergeDivs, [c, 1]);
                l.parentNode.removeChild(l);
                break
            }
        }
    },
    reVertTextInMergeDiv: function(q) {
        var l = [];
        if (q) {
            l.push(q)
        } else {
            for (var g = 0; g < this.grid.mergeDivs.length; g++) {
                var a = this.grid.mergeDivs[g];
                var n = parseInt(a.getAttribute("ri"), 10);
                var r = parseInt(a.getAttribute("ci"), 10);
                var c = this.getRowIndex();
                var m = this.getColIndex();
                if (n == c && m == r) {
                    l.push(a)
                }
            }
        }
        for (var d = 0; d < l.length; d++) {
            var h = l[d];
            var p = parseInt(h.style.height, 10);
            var b = parseInt(h.style.width, 10);
            var o = DNA.engine.DomUtil.getInnerText(h.firstChild);
            this.grid.util.reVertAlignDiv(p, b, this.isWrapLine(), o, this.getFont(), h.firstChild, this.getVertAlign())
        }
    },
    isWrapLine: function() {
        return !!this.getAttribute(this.td, "wl")
    },
    getVertAlign: function() {
        var a = this.getAttribute(this.td, "va");
        return a ? a : DNA.widget.JWTGrid.VERTALIGN_MIDDLE
    },
    _getRowRealSpan: function(c) {
        var a = c;
        for (var b = this.rowIndex + c - 1; b >= this.rowIndex; --b) {
            if (!this.grid.getRowVisible(b)) {
                a--
            } else {
                break
            }
        }
        return a
    },
    getShowText: function() {
        var a = this.getAttribute(this.td, "st");
        if (!a) {
            a = DNA.engine.DomUtil.getInnerText(this.td.firstChild);
            if (a.length == 1 && (a == " " || a.charCodeAt(0) == 160)) {
                a = ""
            }
        } else {
            try {
                if (a.length == 1 && a.charCodeAt(0) == 160) {
                    a = ""
                }
            } catch (b) {}
        }
        return this.grid.util.getNormalSpaceString(a)
    },
    getEditText: function() {
        var a = this.getAttribute(this.td, "et");
        if (a) {
            a = this.parseHtml(a);
            if (a == " ") {
                a = ""
            }
            return this.grid.util.getNormalSpaceString(a)
        }
        return ""
    },
    getClientData: function() {
        var data = this.getAttribute(this.td, "cd");
        if (data) {
            data = this.parseHtml(data);
            if (data == " ") {
                data = ""
            }
            if (data != "") {
                return eval("(" + data + ")")
            }
        }
        return null 
    },
    getFormatter: function() {
        return this.getAttribute(this.td, "fi")
    },
    getBackground: function() {
        var a = this.grid.util.getStyle(this.td, "backgroundColor");
        return this.parseColor(a)
    },
    parseColor: function(b) {
        if (!b || b == "") {
            return ""
        }
        if (DNA.engine.Client.isIE()) {
            if (b.length === 4) {
                var c = "#";
                c += b.charAt(1);
                c += b.charAt(1);
                c += b.charAt(2);
                c += b.charAt(2);
                c += b.charAt(3);
                c += b.charAt(3);
                b = c
            }
        }
        if (DNA.engine.Client.isFF()) {
            var d = b.substring(b.indexOf("(") + 1, b.indexOf(")")).split(",");
            var g = (parseInt(d[0]) << 16) + (parseInt(d[1]) << 8) + parseInt(d[2]);
            b = g.toString(16);
            var h = 6 - b.length;
            for (var a = 0; a < h; ++a) {
                b = "0" + b
            }
            b = "#" + b
        }
        return b
    },
    getShowImage: function() {
        return this.grid.util.getStyle(this.td, "backgroundImage")
    },
    getForeground: function() {
        var a = this.grid.util.getStyle(this.td, "color");
        return this.parseColor(a)
    },
    getEditor: function() {
        return this.getAttribute(this.td, "ei")
    },
    getFont: function() {
        var g = this.grid.util.getStyle(this.td, "fontFamily");
        var c = this.grid.util.getStyle(this.td, "fontSize");
        var d = this.grid.util.getStyle(this.td, "fontStyle");
        var h = this.grid.util.getStyle(this.td, "fontWeight");
        var b = this.grid.util.getStyle(this.td, "textDecoration");
        var l = 0;
        if (d == "normal") {
            l |= DNA.JWT.FONT_STYLE_PLAIN
        } else {
            if (d == "italic") {
                l |= DNA.JWT.FONT_STYLE_ITALIC
            }
        }
        if (h == "bold") {
            l |= DNA.JWT.FONT_STYLE_BOLD
        }
        if (b == "underline") {
            l |= DNA.JWT.FONT_STYLE_UNDERLINE
        } else {
            if (b == "line-through") {
                l |= DNA.JWT.FONT_STYLE_INLINE
            } else {
                if (b && b != "" && b != "none") {
                    l |= DNA.JWT.FONT_STYLE_UNDERLINE;
                    l |= DNA.JWT.FONT_STYLE_INLINE
                }
            }
        }
        var a = new DNA.widget.Font(g,c,l);
        return a
    },
    getIndent: function() {
        var a = this.grid.util.getStyle(this.td, "textIndent");
        if (a) {
            a = parseInt(a)
        } else {
            a = 0
        }
        return a
    },
    getLeft: function(a) {
        return this.grid.util.getColOffsetLeft(this.colIndex, a)
    },
    getTop: function(a) {
        return this.grid.util.getRowOffsetTop(this.rowIndex, a)
    },
    getHeight: function() {
        var d = this.getRowSpan();
        var a = 0;
        for (var c = 0; c < d; c++) {
            var b = this.rowIndex + c;
            if (!this.grid.getRowHidden(b)) {
                a += this.grid.getRowHeight(b)
            }
        }
        return a
    },
    getWidth: function() {
        var d = this.getColSpan();
        var c = 0;
        for (var b = 0; b < d; b++) {
            var a = this.colIndex + b;
            if (!this.grid.getColHidden(a)) {
                c += this.grid.getColumnWidth(a)
            }
        }
        return c
    },
    getRowIndex: function() {
        return this.rowIndex
    },
    getColIndex: function() {
        return this.colIndex
    },
    setRowSpan: function(g) {
        var h;
        for (var d = 0, b = this.grid.mergeDivs.length; d < b; d++) {
            h = this.grid.mergeDivs[d];
            var a = parseInt(h.getAttribute("ri"));
            var c = parseInt(h.getAttribute("ci"));
            if (c == this.colIndex && a == this.rowIndex) {
                h.setAttribute("rs", g);
                break
            }
        }
    },
    getRowSpan: function() {
        var g = 1;
        var h;
        for (var d = 0, b = this.grid.mergeDivs.length; d < b; d++) {
            h = this.grid.mergeDivs[d];
            var a = parseInt(h.getAttribute("ri"));
            var c = parseInt(h.getAttribute("ci"));
            if (c == this.colIndex && a == this.rowIndex) {
                g = parseInt(h.getAttribute("rs"));
                break
            }
        }
        return g
    },
    setColSpan: function(g) {
        var h;
        for (var d = 0, b = this.grid.mergeDivs.length; d < b; d++) {
            h = this.grid.mergeDivs[d];
            var a = parseInt(h.getAttribute("ri"));
            var c = parseInt(h.getAttribute("ci"));
            if (c == this.colIndex && a == this.rowIndex) {
                h.setAttribute("cs", g);
                break
            }
        }
    },
    getRealRowSpan: function() {
        if (this.td.rowSpan) {
            return this.td.rowSpan
        }
        return 1
    },
    getColSpan: function() {
        var g = 1;
        var h;
        for (var d = 0, b = this.grid.mergeDivs.length; d < b; d++) {
            h = this.grid.mergeDivs[d];
            var a = parseInt(h.getAttribute("ri"));
            var c = parseInt(h.getAttribute("ci"));
            if (c == this.colIndex && a == this.rowIndex) {
                g = parseInt(h.getAttribute("cs"));
                break
            }
        }
        return g
    },
    getEditable: function() {
        var b = this.getAttribute(this.td, "ea");
        var a = this.getAttribute(this.td, "ci");
        if (b == 0 || a) {
            return false
        }
        return true
    },
    isMerged: function() {
        var m;
        var a = false;
        for (var h = 0, d = this.grid.mergeDivs.length; h < d; h++) {
            m = this.grid.mergeDivs[h];
            var b = parseInt(m.getAttribute("ri"));
            var g = parseInt(m.getAttribute("ci"));
            var c = parseInt(m.getAttribute("rs"));
            var l = parseInt(m.getAttribute("cs"));
            if (g == this.colIndex && b == this.rowIndex) {
                break
            } else {
                if (g <= this.colIndex && b <= this.rowIndex && g + l > this.colIndex && b + c > this.rowIndex) {
                    a = true;
                    break
                }
            }
        }
        return a
    },
    getSelectable: function(c) {
        if (this.grid.getRowHidden(this.rowIndex) || this.grid.getColHidden(this.colIndex)) {
            return false
        }
        var b = this.getAttribute(this.td, "sa");
        if (b == 0) {
            return false
        }
        return true
    },
    getEditorFace: function() {
        if (!this.getEditable()) {
            return 0
        }
        return this.getAttribute(this.td, "ef")
    },
    setAttribute: function(c, a, b) {
        if (c) {
            c.setAttribute(a, b)
        }
    },
    getAttribute: function(b, a) {
        if (b) {
            return b.getAttribute(a)
        }
        return null 
    },
    removeAttribute: function(b, a) {
        if (b) {
            b.removeAttribute(a)
        }
    },
    setEditorCtr: function(a) {
        this.editorCtr = a
    },
    getEditorCtr: function() {
        return this.editorCtr
    },
    parseHtml: function(a) {
        if (!a || "" == a) {
            return a
        }
        var b = a.replace(/&nbsp;/g, " ").replace(/&#39;/g, "'").replace(/&quot;/g, '"').replace(/<br>/g, "\r\n").replace(/&lt;/g, "<").replace(/&gt;/g, ">").replace(/&amp;/g, "&");
        return b
    },
    parseStr2Html: function(b) {
        if (!b || "" == b) {
            return b
        }
        var a = b.replace(/&/g, "&amp;").replace(/ /g, "&nbsp;").replace(/'/g, "&#39;").replace(/\"/g, "&quot;").replace(/\\r\\n/g, "<br>").replace(/</g, "&lt;").replace(/>/g, "&gt;");
        return a
    }
});
DNA.widget.AbstractGridCellAsync = function(a, n, m, h, b) {
    DNA.widget.AbstractGridCellAsync.superclass.constructor.call(this, a, m, h);
    this.table = n;
    if (!n) {
        if (m < a.hColCount && h < a.hRowCount) {
            this.table = a.hltTab
        } else {
            if (m < a.hColCount) {
                this.table = a.hcTable
            } else {
                if (h < a.hRowCount) {
                    this.table = a.hrTable
                } else {
                    this.table = a.tDiv
                }
            }
        }
    }
    if (b) {
        this.td = this.grid._getCellDom(m, h, this.table);
        this.colIndex = m;
        this.rowIndex = h
    } else {
        for (var d = 0; d < a.mergeDivs.length; d++) {
            var o = a.mergeDivs[d];
            var l = parseInt(o.getAttribute("ri"));
            var p = parseInt(o.getAttribute("ci"));
            var c = parseInt(o.getAttribute("rs"));
            var g = parseInt(o.getAttribute("cs"));
            if (l <= h && p <= m && l + c > h && p + g > m) {
                this.td = this.grid._getCellDom(p, l, this.table);
                this.rowIndex = l;
                this.colIndex = p
            }
        }
        if (!this.td) {
            this.td = this.grid._getCellDom(m, h, this.table);
            this.rowIndex = h;
            this.colIndex = m
        }
    }
}
;
DNA.widget.AbstractGridCellAsync.extend(DNA.widget.IGridCellAsync, {});
DNA.widget.GridCellAsync = function(b, a, c) {
    DNA.widget.GridCellAsync.superclass.constructor.call(this, b, a, c);
    this.rowIndex = c;
    this.colIndex = a;
    this.table = b.tDiv;
    this.td = this.grid._getCellDom(a, c, this.table);
    this.ensureCellType()
}
;
DNA.widget.GridCellAsync.extend(DNA.widget.IGridCellAsync, {
    ensureCellType: function() {
        if (this.x === 0) {
            this.type = DNA.widget.JWTGrid.CELL_ROWTITLE;
            if (this.y < this.grid.hRowCount) {
                this.isLock = true
            }
            return
        }
        if (this.y === 0) {
            this.type = DNA.widget.JWTGrid.CELL_COLTITLE;
            if (this.x < this.grid.hColCount) {
                this.isLock = true
            }
            return
        }
        if (this.x < this.grid.hColCount && this.y < this.grid.hRowCount) {
            this.type = DNA.widget.JWTGrid.CELL_HEADERLOCK
        } else {
            if (this.x < this.grid.hColCount) {
                this.type = DNA.widget.JWTGrid.CELL_HEADERCOL
            } else {
                if (this.y < this.grid.hRowCount) {
                    this.type = DNA.widget.JWTGrid.CELL_HEADERROW
                }
            }
        }
    },
    rePositionTextWrapper: function() {
        var a = this._rePositionTextWrapper(this.td);
        this.setterHelper(this._rePositionTextWrapper, a)
    },
    _rePositionTextWrapper: function(g, d) {
        if (d !== undefined) {
            g.firstChild.style.top = d + "px"
        } else {
            var d = 0;
            var c = this.grid.getRowHeight(this.getRowIndex());
            var a = this.grid.getColumnWidth(this.getColIndex());
            var b = this.getVertAlign();
            d = this.grid.util.reVertAlignDiv(c, a, this.isWrapLine(), this.getShowText(), this.getFont(), g.firstChild, b)
        }
        return d
    },
    setClientData: function(b) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        if (typeof (b) != "string") {
            b = DNA.engine.JsonUtil.encode(b)
        }
        var a = this.parseStr2Html(b);
        this.setAttribute(this.td, "cd", a);
        this.setterHelper(this._setClientData, a)
    },
    _setClientData: function(b, a) {
        this.setAttribute(b, "cd", a)
    },
    setTopBorderStyle: function(a) {},
    setLeftBorderStyle: function(a) {},
    setRightBorderStyle: function(a) {
        if (a === "auto") {
            this.setRightBorderColor("");
            this.setterHelper2(this._setRightBorderStyle, a);
            return
        }
        this._setRightBorderStyle(this.td, a);
        this.setterHelper(this._setRightBorderStyle, a)
    },
    setBottomBorderStyle: function(a) {
        if (a === "auto") {
            this.setBottomBorderColor("");
            this.setterHelper2(this._setBottomBorderStyle, a);
            return
        }
        this._setBottomBorderStyle(this.td, a);
        this.setterHelper(this._setBottomBorderStyle, a)
    },
    _setTopBorderStyle: function(b, a) {},
    _setLeftBorderStyle: function(b, a) {},
    _setRightBorderStyle: function(b, a) {
        if (a === "auto") {
            b.style.borderRightStyle = "";
            return
        }
        b.style.borderRightStyle = a
    },
    _setBottomBorderStyle: function(b, a) {
        if (a === "auto") {
            b.style.borderBottomStyle = "";
            return
        }
        b.style.borderBottomStyle = a
    },
    setTopBorderColor: function(a) {},
    setLeftBorderColor: function(a) {},
    setRightBorderColor: function(a) {
        this._setRightBorderColor(this.td, a);
        this.setterHelper(this._setRightBorderColor, a)
    },
    setBottomBorderColor: function(a) {
        this._setBottomBorderColor(this.td, a);
        this.setterHelper(this._setBottomBorderColor, a)
    },
    _setTopBorderColor: function(b, a) {},
    _setLeftBorderColor: function(b, a) {},
    _setRightBorderColor: function(b, a) {
        if (this.x == 0 || this.y == 0) {
            this.setAttribute(b, "rbc", a)
        }
        b.style.borderRightColor = a
    },
    _setBottomBorderColor: function(b, a) {
        if (this.x == 0 || this.y == 0) {
            this.setAttribute(b, "bbc", a)
        }
        b.style.borderBottomColor = a
    },
    setBorderStyle: function(a) {},
    setBorderColor: function(a) {},
    setVertAlign: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        this._setVertAlign(this.td, a);
        this.setterHelper2(this._setVertAlign, a)
    },
    _setVertAlign: function(b, a) {
        b.style.verticalAlign = a
    },
    setHorzAlign: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        this._setHorzAlign(this.td, a);
        this.setterHelper2(this._setHorzAlign, a)
    },
    _setHorzAlign: function(b, a) {
        b.style.textAlign = a
    },
    setWrapLine: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        if (a) {
            a = "break-word"
        } else {
            a = "normal"
        }
        this._setWrapLine(this.td, a);
        this.setterHelper2(this._setWrapLine, a)
    },
    _setWrapLine: function(d, a) {
        d.style.wordWrap = a;
        if (a === "break-word") {
            d.style.whiteSpace = "normal"
        } else {
            d.style.whiteSpace = "nowrap"
        }
        if (DNA.engine.Client.isFF()) {
            if (a === "break-word") {
                if (d.childNodes.length == 1 && d.childNodes[0].nodeType == 3) {
                    d.setAttribute("wl", "1");
                    var c = d.ownerDocument.createElement("div");
                    var b = d.firstChild;
                    c.appendChild(b);
                    c.style.height = (d.offsetHeight - 1) + "px";
                    d.appendChild(c)
                }
            } else {
                if (d.getAttribute("wl") == "1") {
                    d.removeAttribute("wl");
                    if (d.firstChild && d.firstChild.firstChild) {
                        d.appendChild(d.firstChild.firstChild)
                    }
                    if (d.firstChild) {
                        d.removeChild(d.firstChild)
                    }
                }
            }
        }
    },
    setVertText: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        if (!DNA.engine.Client.isIE()) {
            return
        }
        this._setVertText(this.td, a);
        this.setterHelper2(this._setVertText, a)
    },
    _setVertText: function(b, a) {
        if (a) {
            b.style.writingMode = "tb-rl"
        } else {
            b.style.writingMode = "lr-tb"
        }
    },
    setSelectable: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        if (a) {
            this.setAttribute(this.td, "sa", 1);
            this.setterHelper2(this._setSelectable, 1)
        } else {
            this.setAttribute(this.td, "sa", 0);
            this.setterHelper2(this._setSelectable, 0)
        }
    },
    _setSelectable: function(b, a) {
        if (a) {
            this.setAttribute(b, "sa", 1)
        } else {
            this.setAttribute(b, "sa", 0)
        }
    },
    setEditable: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        if (a) {
            this.setAttribute(this.td, "ea", 1);
            this._updateEditorFace(true);
            this.setterHelper2(this._setEditable, 1)
        } else {
            this.grid.ensureEditorClose(this, true);
            this.setAttribute(this.td, "ea", 0);
            this._updateEditorFace(false);
            this.setterHelper2(this._setEditable, 0)
        }
    },
    _setEditable: function(b, a) {
        if (a) {
            this.setAttribute(b, "ea", 1)
        } else {
            this.setAttribute(b, "ea", 0)
        }
    },
    _updateEditorFace: function(a) {
        var b = this.grid.getCurrentCell();
        if (b && b.x == this.getColIndex() && b.y == this.getRowIndex()) {
            if (a) {
                if (this.grid.getEditMode() !== DNA.widget.JWTGrid2.EDIT_MODE_READONLY) {
                    this.grid._showFace()
                }
            } else {
                this.grid._hideFace()
            }
        }
    },
    setIndent: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        this._setIndent(this.td, a);
        this.setterHelper2(this._setIndent, a)
    },
    _setIndent: function(b, a) {
        b.style.textIndent = a + "px"
    },
    setFont: function(a) {
        this._setFont(this.td, a);
        this.setterHelper(this._setFont, a)
    },
    setFontStyle: function(a) {
        this._setFontStyle(this.td, a);
        this.setterHelper(this._setFontStyle, a)
    },
    _setFontStyle: function(b, a) {
        if (a.style) {
            b.style.fontStyle = a.style
        } else {
            b.style.fontStyle = ""
        }
        if (a.weight) {
            b.style.fontWeight = a.weight
        } else {
            b.style.fontWeight = ""
        }
        if (a.decoration) {
            b.style.textDecoration = a.decoration
        } else {
            b.style.textDecoration = ""
        }
    },
    _setFont: function(b, a) {
        if (a.family) {
            b.style.fontFamily = a.family
        }
        if (a.size) {
            b.style.fontSize = a.size + "pt"
        }
        if (a.style) {
            b.style.fontStyle = a.style
        } else {
            b.style.fontStyle = ""
        }
        if (a.weight) {
            b.style.fontWeight = a.weight
        } else {
            b.style.fontWeight = ""
        }
        if (a.decoration) {
            b.style.textDecoration = a.decoration
        } else {
            b.style.textDecoration = ""
        }
    },
    setEditor: function(a, b) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        this.setAttribute(this.td, "ei", a);
        if (b) {
            this.setAttribute(this.td, "ef", b)
        }
        this.setterHelper(this._setEditor, a)
    },
    _setEditor: function(b, a) {
        this.setAttribute(b, "ei", a)
    },
    setForeground: function(a) {
        this._setForeground(this.td, a);
        this.setterHelper(this._setForeground, a)
    },
    _setForeground: function(b, a) {
        b.style.color = a
    },
    setShowImage: function(b, a) {
        this.setAttribute(this.td, "st", "image://");
        this.setAttribute(this.td, "et", b);
        if (!a) {
            this.grid.fireDataChangeEvent({
                x: this.x,
                y: this.y,
                width: this.x,
                height: this.y
            }, 0)
        }
        this._setShowImage(this.td, b);
        this.setterHelper(this._setShowImage, b)
    },
    _setShowImage: function(b, a) {
        b.style.backgroundImage = "url(" + DNA.widget.ImageDescriptor.getUrl(a) + ")"
    },
    setHtml: function(a) {
        this._setHtml(this.td, a);
        this.setterHelper(this._setHtml, a)
    },
    _setHtml: function(c, a) {
        var b = c;
        if (DNA.engine.Client.isFF() && c.getAttribute("wl")) {
            b = c.firstChild
        }
        b.innerHTML = a
    },
    setBackground: function(a) {
        this._setBackground(this.td, a);
        this.setterHelper(this._setBackground, a)
    },
    _setBackground: function(b, a) {
        if (this.x == 0 || this.y == 0) {
            this.setAttribute(b, "bgc", a)
        }
        b.style.backgroundColor = a
    },
    setSilverHead: function(a) {
        if (a) {
            this.setBackground("#ece9d8")
        } else {
            var b = this.getBackground();
            if (b == "#ece9d8") {
                this.setBackground("")
            }
        }
    },
    setBackStyle: function(a) {
        if (a === "auto") {
            this.setBackground("")
        }
    },
    setEditText: function(c, b, a) {
        if (this.getShowText() === "image://") {
            this.grid.util.convertCellCSSFromClass2Style(this.grid, this.getColIndex(), this.getRowIndex());
            this.setShowImage(c)
        } else {
            if (this.getShowText() === "html://") {
                this.setHtml(c);
                c = "html://"
            }
        }
        c = this.parseStr2Html(c);
        this.setAttribute(this.td, "et", c);
        if (!b) {
            this.grid.fireDataChangeEvent({
                x: this.x,
                y: this.y,
                width: this.x,
                height: this.y
            }, 0)
        }
        this.setterHelper2(this._setEditText, c);
        if (a) {
            this.grid.reInitEditor(this)
        }
    },
    _setEditText: function(c, b, a) {
        b = this.parseStr2Html(b);
        this.setAttribute(c, "et", b)
    },
    setFormatter: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        this.setAttribute(this.td, "fi", a);
        this.setterHelper(this._setFormatter, a)
    },
    _setFormatter: function(b, a) {
        this.setAttribute(b, "fi", a)
    },
    setShowText: function(c, b, a) {
        if (c == "image://" || c == "html://") {
            this.setAttribute(this.td, "st", c);
            return
        }
        this.td.style.backgroundImage = "";
        this._setShowText(this.td, c);
        if (!b) {
            this.grid.fireDataChangeEvent({
                x: this.x,
                y: this.y,
                width: this.x,
                height: this.y
            }, 0)
        }
        if (a) {
            this.setterHelper(this._setShowText2, c)
        } else {
            this.setterHelper(this._setShowText, c);
            this.grid.ensureHAndW(this)
        }
    },
    _setShowText2: function(b, a) {
        if (!a || a == "") {
            a = " "
        }
        this.setAttribute(b, "st", a)
    },
    _setShowText: function(c, b) {
        if (!b) {
            b = ""
        }
        if (this.getAttribute(c, "rhc")) {
            this.setAttribute(c, "st", b)
        } else {
            if (this.x === 0 || this.y === 0) {
                this.setAttribute(c, "st", b)
            } else {
                this.removeAttribute(c, "st")
            }
            if (this.grid.ensureEditorClose(this)) {
                var a = c;
                if (DNA.engine.Client.isFF() && c.getAttribute("wl")) {
                    a = c.firstChild
                }
                if (DNA.engine.Client.isIE()) {
                    DNA.engine.DomUtil.setInnerText(a, b === "" ? " " : b)
                } else {
                    a.innerHTML = (this.grid.util.getNBSPString(b)).replace(/</g, "&lt;").replace(/>/g, "&gt;")
                }
            } else {
                if (!b || b == "") {
                    b = " "
                }
                this.setAttribute(c, "st", b)
            }
        }
    },
    _resizeWraplineDiv: function() {
        var a = this.__resizeWraplineDiv(this.td);
        this.setterHelper(this.__resizeWraplineDiv, a)
    },
    __resizeWraplineDiv: function(m, a) {
        var g = 0;
        if (a !== undefined) {
            g = a
        } else {
            var c = this.getRowIndex();
            var b = c + parseInt(m.getAttribute("rowSpan"));
            for (var l = c; l < b; l++) {
                var d = this.grid._getCellDom(-1, l, this.grid.contentTable);
                if (d.offsetHeight > 0) {
                    g += parseInt(d.style.height)
                } else {
                    ++b
                }
            }
        }
        if ((g - 1) < this.grid.util.getWrapTextHeight(this.getColIndex(), this.getRowIndex(), this.td.offsetWidth)) {
            m.firstChild.style.height = (g - 1) + "px"
        } else {
            m.firstChild.style.height = ""
        }
        return g
    },
    setterHelper: function(b, c) {
        var a = null ;
        switch (this.type) {
        case DNA.widget.JWTGrid.CELL_HEADERROW:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hrTable);
            b.apply(this, [a, c]);
            break;
        case DNA.widget.JWTGrid.CELL_HEADERCOL:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hcTable);
            b.apply(this, [a, c]);
            break;
        case DNA.widget.JWTGrid.CELL_HEADERLOCK:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hrTable);
            b.apply(this, [a, c]);
            a = this.grid._getCellDom(this.x, this.y, this.grid.hcTable);
            b.apply(this, [a, c]);
            a = this.grid._getCellDom(this.x, this.y, this.grid.hltTab);
            b.apply(this, [a, c]);
            break;
        case DNA.widget.JWTGrid.CELL_ROWTITLE:
            a = this.grid._getCellDom(0, this.y, this.grid.hcTable);
            b.apply(this, [a, c]);
            if (this.isLock) {
                a = this.grid._getCellDom(0, this.y, this.grid.hltTab);
                b.apply(this, [a, c])
            }
            break;
        case DNA.widget.JWTGrid.CELL_COLTITLE:
            a = this.grid._getCellDom(this.x, 0, this.grid.hrTable);
            b.apply(this, [a, c]);
            if (this.isLock) {
                a = this.grid._getCellDom(this.x, 0, this.grid.hltTab);
                b.apply(this, [a, c])
            }
            break;
        default:
            break
        }
    },
    setterHelper2: function(b, c) {
        var a = null ;
        switch (this.type) {
        case DNA.widget.JWTGrid.CELL_HEADERROW:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hrTable);
            b.apply(this, [a, c]);
            break;
        case DNA.widget.JWTGrid.CELL_HEADERCOL:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hcTable);
            b.apply(this, [a, c]);
            break;
        case DNA.widget.JWTGrid.CELL_HEADERLOCK:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hrTable);
            b.apply(this, [a, c]);
            a = this.grid._getCellDom(this.x, this.y, this.grid.hcTable);
            b.apply(this, [a, c]);
            a = this.grid._getCellDom(this.x, this.y, this.grid.hltTab);
            b.apply(this, [a, c]);
            break;
        default:
            break
        }
    }
});
DNA.widget.GridUtilAsync = function(a) {
    this.grid = a
}
;
DNA.widget.GridUtilAsync.extend(Object, {
    getFirstCol: function(a) {
        for (var b = 1; b < this.grid.columnCount; ++b) {
            if (!this.grid.getColHidden(b)) {
                return b
            }
        }
        return -1
    },
    getLastCol: function(a) {
        for (var b = this.grid.columnCount - 1; b > 0; --b) {
            if (!this.grid.getColHidden(b)) {
                return b
            }
        }
        return -1
    },
    getTopRow: function(a) {
        for (var b = 1; b < this.grid.rowCount; ++b) {
            if (!this.grid.getRowHidden(b)) {
                return b
            }
        }
        return -1
    },
    getBottomRow: function(a) {
        for (var b = this.grid.rowCount - 1; b > 0; --b) {
            if (!this.grid.getRowHidden(b)) {
                return b
            }
        }
        return -1
    },
    getScrollFirstVisibleCol: function() {
        return -1
    },
    getScrollFirstVisibleRow: function() {
        return -1
    },
    getFirstCell: function(h, c) {
        if (!h) {
            h = this.getDataCellArea()
        }
        var d = this.getRightCol(h.x - 1);
        var l = this.getDownRow(h.y - 1);
        if (c) {
            d = Math.max(d, this.getScrollFirstVisibleCol());
            l = Math.max(l, this.getScrollFirstVisibleRow())
        }
        var b = new DNA.widget.Point(d,l);
        var a;
        var m;
        var g;
        while (b.y <= h.height) {
            while (b.x <= h.width) {
                a = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,b.x,b.y,false);
                m = a.getColIndex();
                g = a.getRowIndex();
                if (this.isCellSelectable(m, g)) {
                    b.x = m;
                    b.y = g;
                    return b
                }
                b.x = this.getRightCol(m + a.getColSpan() - 1)
            }
            b.x = d;
            b.y = this.getDownRow(b.y)
        }
        return null 
    },
    getLastCell: function(l, d) {
        if (!l) {
            l = this.getDataCellArea()
        }
        var c = this.getLeftCol(l.width + 1);
        var h = this.getUpRow(l.height + 1);
        if (d) {
            c = Math.min(c, this.getScrollLastVisibleCol());
            h = Math.min(h, this.getScrollLastVisibleRow())
        }
        var b = new DNA.widget.Point(c,h);
        var a;
        var m;
        var g;
        while (b.y >= l.y) {
            while (b.x >= l.x) {
                a = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,b.x,b.y,false);
                m = a.getColIndex();
                g = a.getRowIndex();
                if (this.isCellSelectable(m, g)) {
                    b.x = m;
                    b.y = g;
                    return b
                }
                b.x = this.getLeftCol(m)
            }
            b.x = c;
            b.y = this.getUpRow(b.y)
        }
        return null 
    },
    getLeftCell: function(d, m, h, b, c) {
        var n = new DNA.widget.Point(this.getLeftCol(d),m);
        var l;
        var g;
        var a;
        if (!h) {
            h = this.getDataCellArea()
        }
        while (n.y >= h.y) {
            while (n.x >= h.x) {
                l = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,n.x,n.y,false);
                g = l.getColIndex();
                a = l.getRowIndex();
                if (c) {
                    if (this.isCellEditable(g, a)) {
                        n.x = g;
                        return n
                    }
                } else {
                    if (this.isCellSelectable(g, a)) {
                        n.x = g;
                        return n
                    }
                }
                n.x = this.getLeftCol(g)
            }
            if (!b) {
                break
            }
            n.x = h.width;
            n.y = this.getUpRow(n.y)
        }
        return null 
    },
    getRightCell: function(d, m, h, b, c) {
        var n = new DNA.widget.Point(this.getRightCol(d),m);
        var l;
        var g;
        var a;
        if (!h) {
            h = this.getDataCellArea()
        }
        while (n.y <= h.height) {
            while (n.x <= h.width) {
                l = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,n.x,n.y,false);
                g = l.getColIndex();
                a = l.getRowIndex();
                if ((a != m) || (g != d)) {
                    if (c) {
                        if (this.isCellEditable(g, a)) {
                            return n
                        }
                    } else {
                        if (this.isCellSelectable(g, a)) {
                            return n
                        }
                    }
                }
                n.x = this.getRightCol(g + l.getColSpan() - 1)
            }
            if (!b) {
                break
            }
            n.x = h.x;
            n.y = this.getDownRow(n.y)
        }
        return null 
    },
    getUpCell: function(d, m, h, b, c) {
        var n = new DNA.widget.Point(d,this.getUpRow(m));
        var l;
        var g;
        var a;
        if (!h) {
            h = this.getDataCellArea()
        }
        while (n.x >= h.x) {
            while (n.y >= h.y) {
                l = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,n.x,n.y,false);
                g = l.getColIndex();
                a = l.getRowIndex();
                if (c) {
                    if (this.isCellEditable(g, a)) {
                        return n
                    }
                } else {
                    if (this.isCellSelectable(g, a)) {
                        return n
                    }
                }
                n.y = this.getUpRow(a)
            }
            if (!b) {
                break
            }
            n.y = h.height;
            n.x = this.getLeftCol(n.x)
        }
        return null 
    },
    getDownCell: function(d, m, h, b, c) {
        var n = new DNA.widget.Point(d,this.getDownRow(m));
        var l;
        var g;
        var a;
        if (!h) {
            h = this.getDataCellArea()
        }
        while (n.x <= h.width) {
            while (n.y <= h.height) {
                l = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,n.x,n.y,false);
                g = l.getColIndex();
                a = l.getRowIndex();
                if ((a != m) || (g != d)) {
                    if (c) {
                        if (this.isCellEditable(g, a)) {
                            return n
                        }
                    } else {
                        if (this.isCellSelectable(g, a)) {
                            return n
                        }
                    }
                }
                n.y = this.getDownRow(a + l.getRowSpan() - 1)
            }
            if (!b) {
                break
            }
            n.y = h.y;
            n.x = this.getRightCol(n.x)
        }
        return null 
    },
    getLeftCol: function(a) {
        var b = a - 1;
        while (this.isDataCol(b) && this.grid.getColHidden(b)) {
            b--
        }
        return b
    },
    getRightCol: function(a) {
        var b = a + 1;
        while (this.isDataCol(b) && this.grid.getColHidden(b)) {
            b++
        }
        return b
    },
    getUpRow: function(b) {
        var a = b - 1;
        while (this.isDataRow(a) && this.grid.getRowHidden(a)) {
            a--
        }
        return a
    },
    getDownRow: function(b) {
        var a = b + 1;
        while (this.isDataRow(a) && this.grid.getRowHidden(a)) {
            a++
        }
        return a
    },
    getRowFirstCell: function(h, d, m) {
        var c = new DNA.widget.Point(this.getFirstCol(d),h);
        var b = this.getLastCol(d);
        var a;
        var l;
        var g;
        while (c.x <= b) {
            a = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,c.x,c.y,false);
            l = a.getColIndex();
            g = a.getRowIndex();
            if (m) {
                if (this.isCellEditable(l, g)) {
                    return c
                }
            } else {
                if (this.isCellSelectable(l, g)) {
                    return c
                }
            }
            c.x = this.getRightCol(l + a.getColSpan() - 1)
        }
        return null 
    },
    getRowLastCell: function(h, c, m) {
        var b = new DNA.widget.Point(this.getLastCol(c),h);
        var d = this.getFirstCol(c);
        var a;
        var l;
        var g;
        while (b.x >= d) {
            a = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,b.x,b.y,false);
            l = a.getColIndex();
            g = a.getRowIndex();
            if (m) {
                if (this.isCellEditable(l, g)) {
                    return b
                }
            } else {
                if (this.isCellSelectable(l, g)) {
                    return b
                }
            }
            b.x = this.getLeftCol(l)
        }
        return null 
    },
    getColFirstCell: function(d, c, m) {
        var b = new DNA.widget.Point(d,this.getTopRow(c));
        var h = this.getBottomRow(c);
        var a;
        var l;
        var g;
        while (b.y <= h) {
            a = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,b.x,b.y,false);
            l = a.getColIndex();
            g = a.getRowIndex();
            if (m) {
                if (this.isCellEditable(l, g)) {
                    return b
                }
            } else {
                if (this.isCellSelectable(l, g)) {
                    return b
                }
            }
            b.y = this.getDownRow(g + a.getRowSpan() - 1)
        }
        return null 
    },
    getColLastCell: function(d, c, m) {
        var b = new DNA.widget.Point(d,this.getBottomRow(c));
        var h = this.getTopRow(c);
        var a;
        var l;
        var g;
        while (b.y >= h) {
            a = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,b.x,b.y,false);
            l = a.getColIndex();
            g = a.getRowIndex();
            if (m) {
                if (this.isCellEditable(l, g)) {
                    return b
                }
            } else {
                if (this.isCellSelectable(l, g)) {
                    return b
                }
            }
            b.y = this.getUpRow(g)
        }
        return null 
    },
    getDataCellArea: function() {
        return new DNA.widget.Rectangle(1,1,this.grid.columnCount - 1,this.grid.rowCount - 1)
    },
    isCellSelectable: function(b, c) {
        if (this.isDataCell(b, c)) {
            if (this.grid.getEditMode() == DNA.widget.JWTGrid.EDIT_MODE_DESIGN) {
                return true
            } else {
                var a = this.grid.getCell(b, c);
                return a.getSelectable()
            }
        }
        return false
    },
    isCellEditable: function(b, c) {
        if (this.isDataCell(b, c)) {
            var a = this.grid.getCell(b, c);
            if (this.grid.getEditMode() == DNA.widget.JWTGrid.EDIT_MODE_DESIGN) {
                if ("html://" == a.getEditText()) {
                    return false
                }
                return true
            } else {
                return a.getEditable()
            }
        }
        return false
    },
    isDataCell: function(a, b) {
        return this.isDataCol(a) && this.isDataRow(b)
    },
    isDataCol: function(a) {
        return a > 0 && a < this.grid.columnCount
    },
    isDataRow: function(a) {
        return a > 0 && a < this.grid.rowCount
    },
    parseHtml: function(a) {
        if (!a || "" == a) {
            return a
        }
        var b = a.replace(/&nbsp;/g, " ").replace(/&#39;/g, "'").replace(/&quot;/g, '"').replace(/<br>/g, "\r\n").replace(/&lt;/g, "<").replace(/&gt;/g, ">").replace(/&amp;/g, "&");
        return b
    },
    parseStr2Html: function(b) {
        if (!b || "" == b) {
            return b
        }
        var a = b.replace(/ /g, "&nbsp;").replace(/'/g, "&#39;").replace(/\"/g, "&quot;").replace(/\\r\\n/g, "<br>").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/&/g, "&amp;");
        return a
    },
    getRowAutoHeight: function(c) {
        var b = this.grid._getRowDom(c, this.grid.tDiv);
        if (b) {
            var a = b.childNodes[0];
            if (a.getAttribute("ah")) {
                return true
            }
        }
        return false
    },
    getColAutoWidth: function(b) {
        var a = this.grid._getCellDom(b, -1, this.grid.tDiv);
        if (a.getAttribute("aw")) {
            return true
        }
        return false
    },
    getNBSPString: function(a) {
        return a.replace(/ /g, "&nbsp;")
    },
    getNormalSpaceString: function(a) {
        var b = String.fromCharCode(160);
        return a.replace(new RegExp(b,"g"), String.fromCharCode(32))
    },
    getWrapTextHeight: function(c, l, h) {
        var b = this.grid.getCell(c, l);
        var g = h ? h : this.grid.getColumnWidth(c);
        var a = b.getFont();
        a.setSize(parseInt(a.getSize()));
        var d = DNA.engine.DomUtil.getFoldedTextInf(b.getShowText(), a, g, DNA.engine.DomUtil.WRAP_CHAR.HTML);
        return d.height
    },
    getTextHeight: function(d, g) {
        var c = this.grid.getCell(d, g);
        var b = c.getFont();
        b.setSize(parseInt(b.getSize()));
        var a = DNA.engine.DomUtil.getTextHeight(b);
        return a
    },
    reVertAlignDiv: function(c, n, g, m, b, a, d) {
        if (a) {
            var l = 0;
            var h = 0;
            b.setSize(parseInt(b.getSize()));
            if (g || m.indexOf("\n") >= 0) {
                var o = DNA.engine.DomUtil.getFoldedTextInf(m, b, n, DNA.engine.DomUtil.WRAP_CHAR.HTML);
                h = o.height
            } else {
                h = DNA.engine.DomUtil.getTextHeight(b)
            }
            switch (d) {
            case DNA.widget.JWTGrid.VERTALIGN_TOP:
                l = 0;
                break;
            case DNA.widget.JWTGrid.VERTALIGN_BOTTOM:
                l = c - h;
                break;
            default:
                l = Math.max(0, Math.floor((c - h) / 2));
                break
            }
            a.style.top = l + "px";
            return l
        }
    },
    computeFoldedTextHeight: (function() {
        var a = null ;
        return function(d, b, c) {
            if (a == null ) {
                a = document.createElement("span");
                a.style.whiteSpace = "normal";
                a.style.wordWrap = "break-word";
                a.style.wordBreak = "break-all";
                a.style.display = "block";
                a.style.visibility = "hidden";
                a.style.paddingLeft = "2px";
                a.style.paddingRight = "2px";
                a.style.borderRight = "1px solid white";
                a.style.borderBottom = "1px solid white";
                document.body.appendChild(a)
            }
            a.style.width = c - 5 + "px";
            a.innerHTML = d;
            DNA.engine.DomUtil.setFont(a, b);
            return a.offsetHeight
        }
    })(),
    computeUnfoldedTextSize: (function() {
        var a = null ;
        return function(d, b) {
            if (a == null ) {
                a = document.createElement("span");
                a.style.visibility = "hidden";
                document.body.appendChild(a)
            }
            a.innerHTML = d;
            DNA.engine.DomUtil.setFont(a, b);
            var c = DNA.engine.DomUtil.getSize(a);
            return c
        }
    })(),
    convertCellCSSFromClass2Style: function(d, a, g) {
        var c = [];
        if (d.tDiv) {
            c.push(d.tDiv)
        }
        if (d.hrTable) {
            c.push(d.hrTable)
        }
        if (d.hcTable) {
            c.push(d.hcTable)
        }
        if (d.hltTab) {
            c.push(d.hltTab)
        }
        if (d.frTable) {
            c.push(d.frTable)
        }
        if (d.fcTable) {
            c.push(d.fcTable)
        }
        if (d.frbTab) {
            c.push(d.frbTab)
        }
        if (d.flbTab) {
            c.push(d.flbTab)
        }
        if (d.hrtTab) {
            c.push(d.hrtTab)
        }
        for (var b = 0; b < c.length; b++) {
            this.convertCSSFromClass2Style(this._getCellDomNoAlert(a, g, c[b], d))
        }
    },
    convertCSSFromClass2Style: function(d, p) {
        return;
        try {
            var a = p ? p : this.getDocumentOfElement(d);
            var q = a.styleSheets;
            for (var h = 0; h < q.length; h++) {
                var o = q[h];
                if (!o.href) {
                    var s = DNA.engine.Client.isIE() ? o.rules : o.cssRules;
                    for (var g = 0; g < s.length; g++) {
                        var t = s[g].selectorText;
                        t = t.substring(1, t.length);
                        if (DNA.engine.DomUtil.hasClass(d, t)) {
                            if (DNA.engine.Client.isIE()) {
                                var b = o.cssText;
                                if (b) {
                                    var r = b.substring(b.indexOf(t) + t.length, b.length);
                                    r = r.substring(r.indexOf("{") + 1, r.indexOf("}") - 1);
                                    var n = r.split(";");
                                    for (var c = 0; c < n.length; c++) {
                                        var m = n[c].substring(0, n[c].indexOf(":")).trim();
                                        this._setProperty(d, m, this._getProperty(s[g], m))
                                    }
                                }
                            } else {
                                for (var c = 0; s[g].style[c]; c++) {
                                    var m = s[g].style[c];
                                    this._setProperty(d, m, this._getProperty(s[g], m))
                                }
                            }
                            DNA.engine.DomUtil.removeClass(d, t);
                            break
                        }
                    }
                }
            }
        } catch (l) {}
    },
    _setProperty: function(c, a, b) {
        if (DNA.engine.Client.isIE()) {
            c.style.setAttribute(this._getCamalCase(a), b)
        } else {
            c.style.setProperty(a, b, "")
        }
    },
    _getProperty: function(b, a) {
        if (DNA.engine.Client.isIE()) {
            return b.style.getAttribute(this._getCamalCase(a))
        } else {
            return b.style.getPropertyValue(a)
        }
    },
    _getCamalCase: function(b) {
        var d = b.toLowerCase().split("-");
        for (var c = 1; c < d.length; c++) {
            var a = d[c].charAt(0).toUpperCase();
            d[c] = a + d[c].substring(1, d[c].length)
        }
        return d.join("")
    },
    _getCssRuleText: function(b) {
        var a;
        if (DNA.engine.Client.isIE()) {
            a = b.style.cssText
        } else {
            a = b.cssText;
            a = a.substring(a.indexOf("{") + 1, a.length - 1)
        }
        return a
    },
    getDocumentOfElement: function(a) {
        if (a) {
            if (a.tagName.toLowerCase() == "iframe") {
                return a.contentWindow.document
            } else {
                if (a.tagName.toLowerCase() == "html") {
                    return a.parentNode
                } else {
                    if (a.parentNode) {
                        return this.getDocumentOfElement(a.parentNode)
                    } else {
                        return document
                    }
                }
            }
        }
    },
    getNearestIframeOfDom: function(a) {
        if (a) {
            return a.ownerDocument.ownerIframe
        }
    },
    getStyle: function(a, b) {
        if (a.currentStyle) {
            return a.currentStyle[b]
        } else {
            if (window.getComputedStyle) {
                if (b == "fontSize") {
                    this.grid.util.convertCSSFromClass2Style(a);
                    if (a.style.fontSize) {
                        return a.style.fontSize
                    } else {
                        return document.defaultView.getComputedStyle(a, null )[b]
                    }
                } else {
                    if (DNA.engine.Client.isFF() && DNA.engine.Client.getBrowserVersion() < 4) {
                        this.grid.util.convertCSSFromClass2Style(a)
                    }
                    return document.defaultView.getComputedStyle(a, null )[b]
                }
            }
        }
        return null 
    },
    _getCellDomNoAlert: function(b, g, c, d) {
        if (!d.checkRendered(true)) {
            return
        }
        var a = null ;
        if (c && c.rows && c.rows[g + 1]) {
            a = c.rows[g + 1].cells[b + 1]
        }
        return a
    },
    rectEqual: function(b, a) {
        return ( b.x === a.x && b.y === a.y && b.width === a.width && b.height === a.height) 
    },
    getColOffsetLeft: function(a, g) {
        var d = !!g ? g : 0;
        if (a >= this.grid.columnCount) {
            return 0
        }
        var c = 0;
        for (var b = d; b < a; b++) {
            if (!this.grid.getColHidden(b)) {
                c += this.grid.colWidths[b]
            }
        }
        return c
    },
    getRowOffsetTop: function(g, d) {
        var c = !!d ? d : 0;
        if (g >= this.grid.rowCount) {
            return 0
        }
        var b = 0;
        for (var a = c; a < g; a++) {
            if (!this.grid.getRowHidden(a)) {
                b += this.grid.rowHeights[a]
            }
        }
        return b
    },
    rebuildChildrenElements: function(g) {
        if (g.initFlag) {
            return
        }
        var c = g.getChildren();
        for (var b = 0, a = c.length; b < a; b++) {
            var d = c[b];
            if (d.el) {
                d.fireEvent("elRebuild");
                d.el = d._buildEl()
            }
            if (!d.checkRendered(false)) {
                d.fireEvent("elementsRebuild");
                d._buildElements()
            }
            if (d.getChildren) {
                if (d.getChildren()) {
                    this.rebuildChildrenElements(d)
                }
            }
        }
    },
    rebuildControl: function(g) {
        g._buildElements();
        if (g.getChildren) {
            var d = g.getChildren();
            if (d) {
                var a = d.length;
                for (var b = 0; b < a; b++) {
                    this.rebuildControl(d[b])
                }
            }
        }
    }
});
DNA.widget.Grid2 = function(a) {
    DNA.widget.Grid2.superclass.constructor.call(this, a);
    this._doInit();
    this.util = new DNA.widget.GridUtil(this)
}
;
DNA.widget.Grid2.extend(DNA.widget.Composite, {
    autoRender: true,
    resizeCursorBound: 2,
    _defaultBorder: new DNA.widget.Border(1,"gray","solid"),
    _selTitleBackColor: "#ffe5a0",
    _selTitleBorderColor: "#f9bc54",
    FONTSIZEFLOOR: 6,
    _initFormatter: function() {
        var a = this.getInitData()[DNA.JWTProperty.PROPERTY_FORMATTER];
        this.formatterMgr = new DNA.widget.CellFormatterMgr();
        this._addFormatters(a)
    },
    getBody: function() {
        if (this.checkRendered(true)) {
            return this.tDiv
        }
    },
    _addFormatters: function(c) {
        if (c) {
            var a = c.length;
            for (var b = 0; b < a; ++b) {
                if (c[b]) {
                    this.formatterMgr.addFormatter(c[b].id, this.createFormatter(c[b].script, c[b].opts))
                }
            }
        }
    },
    checkBuild: function(c) {
        var a = this._checkState(DNA.JWT.STATE_RENDERD);
        if (!a && c) {
            return this._buildElements()
        } else {
            return a
        }
    },
    createFormatter: function(scriptStr, opts) {
        var scrts = [];
        scrts[0] = "(function(){return new (function() {";
        scrts[1] = scriptStr;
        scrts[2] = "})();})();";
        try {
            return eval(scrts.join(""))
        } catch (exception) {
            alert("�ͻ������ɸ�ʽ���쳣��" + exception.toString())
        }
    },
    _doInit: function() {
        this.initFlag = this.getInitData().initFlag;
        delete this.getInitData().initFlag;
        this.gridState = DNA.widget.JWTGrid2.STATE_NORMAL;
        this.needHandleGlobal = false;
        this.replacing = false;
        this.selectFinish = true;
        this.operateCell = null ;
        this.operateArea = null ;
        this.minColWidth = 1;
        this.minRowHeight = 1;
        this.defColWidth = 100;
        this.defRowHeight = 20;
        this.columnCount = this.getInitData().colCount;
        delete this.getInitData().colCount;
        this.rowCount = this.getInitData().rowCount;
        delete this.getInitData().rowCount;
        this.hColCount = this.getInitData().headerColCount;
        delete this.getInitData().headerColCount;
        this.hRowCount = this.getInitData().headerRowCount;
        delete this.getInitData().headerRowCount;
        this.fColCount = this.getInitData().footerColCount;
        delete this.getInitData().footerColCount;
        this.fRowCount = this.getInitData().footerRowCount;
        delete this.getInitData().footerRowCount;
        this.showBorder = this.getInitData().showBorder;
        delete this.getInitData().showBorder;
        this.rowResizeIndex = this.getInitData().rowResizeIndex;
        delete this.getInitData().rowResizeIndex;
        this.colResizeIndex = this.getInitData().colResizeIndex;
        delete this.getInitData().colResizeIndex;
        this.contentTable = null ;
        this.currentCell = null ;
        this.gridOption = this.getInitData().gridOption;
        delete this.getInitData().gridOption;
        this.ignoreHidden = this.getInitData().ignoreHidden ? true : false;
        delete this.getInitData().ignoreHidden;
        this.hrDiv = null ;
        this.hrTable = null ;
        this.hcDiv = null ;
        this.hcTable = null ;
        this.frDiv = null ;
        this.frTable = null ;
        this.fcDiv = null ;
        this.fcTable = null ;
        this.resizeRowIdx = 0;
        this.resizeColIdx = 0;
        this.resizeRowPoint = null ;
        this.resizeColPoint = null ;
        this.resizeDiv = null ;
        this.newSize = 0;
        this.mouseCell = null ;
        this.cellOut = null ;
        this.lastMouseCell = {
            x: -1,
            y: -1
        };
        this.selBeginCell = {
            x: 0,
            y: 0
        };
        this.selectionAreas = new Array();
        this.selectionDiv = null ;
        this.currentRow = -1;
        this.currentCol = -1;
        var b = this.getInitData().cccf;
        delete this.getInitData().cccf;
        if (b) {
            var a = b.split(",");
            this.currentCellColorFocused = a[0];
            this.currentCellColorUnFocused = a[1]
        } else {
            this.currentCellColorFocused = null ;
            this.currentCellColorUnFocused = null 
        }
        this.activeEditor = null ;
        this.editorProvider = null ;
        this.controlProvider = null ;
        this.setCellControlProvider(new DNA.widget.CellControlProvider());
        this.controlCells = []
    },
    init: function() {
        DNA.widget.Grid2.superclass.init.call(this);
        this.computeColsGrab()
    },
    _doCreateControls: function() {
        if (this.isVisible()) {
            if (this.getInitData().controlCells) {
                this.controlCells = this.getInitData().controlCells;
                delete this.getInitData().controlCells;
                if (this.controlCells) {
                    this._showControls()
                }
            }
            if (this.controlCellsCachedForIframe) {
                this.controlCells = this.controlCellsCachedForIframe;
                this.controlCellsCachedForIframe = null ;
                this._showControls()
            }
        }
    },
    openCurrentEditor: function() {
        if (!this.currentCell) {
            return
        }
        if (this.getEditMode() === DNA.widget.JWTGrid2.EDIT_MODE_READONLY) {
            return
        }
        if (!this.util.isCellEditable(this.currentCell.getColIndex(), this.currentCell.getRowIndex())) {
            return
        }
        var a = new DNA.widget.AbstractGridCell(this,null ,this.currentCell.getColIndex(),this.currentCell.getRowIndex(),false);
        this.openEditor(a, null , false, DNA.widget.JWTGrid2.EDITOPEN_PROGRAM)
    },
    _showControls: function() {
        var a = this.controlCells.length;
        for (var b = 0; b < a; ++b) {
            var d = this.controlCells.get(b);
            var c = new DNA.widget.AbstractGridCell(this,null ,d.x,d.y,false);
            this.openControl(c, true)
        }
    },
    computeSize: function(g, b, h) {
        var d = new DNA.widget.Point();
        if (this.checkRendered()) {
            if (g != -1 && b != -1) {
                d.x = g;
                d.y = b
            } else {
                var a = this.getBorderSize();
                d.x += a;
                d.y += a;
                for (var c = 0; c < this.columnCount; c++) {
                    if (this.getColVisible(c)) {
                        d.x += this.getColumnWidthFromStyle(c)
                    }
                }
                for (c = 0; c < this.rowCount; c++) {
                    if (this.getRowVisible(c)) {
                        d.y += this.getRowHeightFromStyle(c)
                    }
                }
                d.y += 1;
                if (g != -1) {
                    if (d.x > g) {
                        d.y += 18
                    }
                    d.x = g
                }
                if (b != -1) {
                    if (d.y > b) {
                        d.x += 18
                    }
                    d.y = b
                }
            }
        } else {
            d.x = this.defColWidth * this.columnCount;
            d.y = this.defRowHeight * this.rowCount
        }
        return d
    },
    _doBuildElements: function() {
        try {
            if (this.el.tagName == "IFRAME") {
                if (!this.el.contentWindow.document) {
                    return false
                }
                if (!this.el.contentWindow.document.body || !this.el.contentWindow.document.body.firstChild) {
                    return false
                }
                this.tDiv = this.el.contentWindow.document.body.firstChild;
                var b = DNA.engine.DomUtil.getClientSize(this.el);
                this.tDiv.style.height = b.height + "px";
                this.tDiv.style.width = b.width + "px"
            } else {
                this.tDiv = this.el
            }
            this.contentTable = this.tDiv.firstChild;
            this.selectionDiv = this.tDiv.childNodes[1];
            this.resizeDiv = this.tDiv.childNodes[2];
            this.mCurLeft = this.tDiv.childNodes[3];
            this.mCurRight = this.tDiv.childNodes[4];
            this.mCurTop = this.tDiv.childNodes[5];
            this.mCurBottom = this.tDiv.childNodes[6];
            this.curLeft = this.mCurLeft;
            this.curRight = this.mCurRight;
            this.curTop = this.mCurTop;
            this.curBottom = this.mCurBottom;
            this.hrDiv = this.tDiv.childNodes[7];
            if (!this.hrDiv || !this.hrDiv.firstChild) {
                return false
            }
            this.hrTable = this.hrDiv.firstChild;
            this.hcDiv = this.tDiv.childNodes[8];
            this.hcTable = this.hcDiv.firstChild;
            this.hltDiv = this.tDiv.childNodes[9];
            this.hltTab = this.hltDiv.firstChild;
            this.frDiv = this.tDiv.childNodes[10];
            if (!this.frDiv || !this.frDiv.firstChild) {
                return false
            }
            this.frTable = this.frDiv.firstChild;
            this.fcDiv = this.tDiv.childNodes[11];
            this.fcTable = this.fcDiv.firstChild;
            this.frbDiv = this.tDiv.childNodes[12];
            this.frbTab = this.frbDiv.firstChild;
            this.flbDiv = this.tDiv.childNodes[13];
            this.flbTab = this.flbDiv.firstChild;
            this.hrtDiv = this.tDiv.childNodes[14];
            this.hrtTab = this.hrtDiv.firstChild;
            this.inputProxy = this.tDiv.childNodes[15];
            this.listFace = this.tDiv.childNodes[16];
            this.listFace.style.display = "none";
            this.listFace.style.width = "18px";
            this.listFace.style.position = "absolute";
            this.listFace.style.paddingRight = "1px";
            this.listFace.style.paddingTop = "1px";
            this.listFace.style.paddingBottom = "1px";
            this.btnFace = this.tDiv.childNodes[17];
            this.selectionChangeDiv = this.tDiv.childNodes[18];
            this.mDragPointDiv = this.tDiv.childNodes[19];
            this.dragPointDiv = this.mDragPointDiv;
            this.dragPointDiv.style.display = "none";
            this.btnFace.style.display = "none";
            this.btnFace.style.width = "18px";
            this.btnFace.style.position = "absolute";
            this.btnFace.style.paddingRight = "1px";
            this.btnFace.style.paddingTop = "1px";
            this.btnFace.style.paddingBottom = "1px";
            this.mSelBorderLeft = this.tDiv.childNodes[20];
            this.mSelBorderRight = this.tDiv.childNodes[21];
            this.mSelBorderTop = this.tDiv.childNodes[22];
            this.mSelBorderBottom = this.tDiv.childNodes[23];
            this.selBorderLeft = this.mSelBorderLeft;
            this.selBorderRight = this.mSelBorderRight;
            this.selBorderTop = this.mSelBorderTop;
            this.selBorderBottom = this.mSelBorderBottom;
            this.exchangeDiv = this.tDiv.childNodes[24];
            var c = DNA.engine.application.getJWTEventMgr();
            c.handleSelfEvent(this, "scroll", this.tDiv);
            c.handleSelfEvent(this, "mousewheel", this.tDiv);
            if (DNA.engine.Client.isIE()) {
                c.handleSelfEvent(this, "propertychange", this.inputProxy)
            } else {
                if (DNA.engine.Client.isFF()) {
                    c.handleSelfEvent(this, "input", this.inputProxy)
                }
            }
            this._ajustLockedSections();
            this._placeLockSections4FF();
            this.setCellEditorProvider(new DNA.widget.CellEditorProvider());
            if (this.getInitData().defEditorId) {
                this.defEditorId = this.getInitData().defEditorId;
                delete this.getInitData().defEditorId
            }
            this.hiddenRows = new Array();
            this.hiddenCols = new Array();
            this.updateCurrentCellColor();
            this._initFormatter();
            if (!this.isEnabled()) {
                this._disableGrid(this)
            }
            this.headerCursor = DNA.widget.CssStyleFinder._findStyleFromCssSheet("grid2_header_cursor", "cursor");
            this.mergeRectCache = this.getInitData().mergeRects || [];
            delete this.getInitData().mergeRects;
            this.parentIframe = this.util.getNearestIframeOfDom(this.getEl());
            this._makeParentIframePaintInIE()
        } catch (a) {
            return false
        }
    },
    _makeParentIframePaintInIE: function() {
        if (DNA.engine.Client.isIE() && document.documentMode && document.documentMode < 9 && this.parentIframe) {
            var a = this.parentIframe.style.display;
            this.parentIframe.style.display = "none";
            this.parentIframe.style.display = a
        }
    },
    _afterGridCreate: function() {
        if (!(this.el.tagName == "IFRAME")) {
            if (this.getInitData().selections) {
                var d = this.getInitData().selections;
                delete this.getInitData().selections;
                var b = d.length;
                for (var c = 0; c < b; ++c) {
                    this.addSelection(d.get(c))
                }
            }
            if (this.getInitData().currentCell) {
                var a = this.getInitData().currentCell;
                delete this.getInitData().currentCell;
                this.setCurrentCell(a, null , null , null , null , DNA.widget.JWTGrid2.SETCURRENTCELLCAUSE_PROGRAM)
            }
            if (this.getInitData().open_editor) {
                delete this.getInitData().open_editor;
                this.openCurrentEditor()
            }
            this._doCreateControls()
        }
    },
    _resizeChildrenControls: function() {
        var b = this.getChildren();
        for (var a = 0; a < b.length; a++) {
            b[a].setVisible(false)
        }
    },
    _resizeGridDiv: function() {
        if (this.el.tagName == "IFRAME") {
            this.tDiv = this.el.contentWindow.document.body.firstChild;
            var a = DNA.engine.DomUtil.getClientSize(this.el);
            this.tDiv.style.height = a.height + "px";
            this.tDiv.style.width = a.width + "px"
        }
    },
    _resizeChildren: function(b) {
        var d = b.getChildren();
        for (var c = 0, a = d.length; c < a; c++) {
            var g = d[c];
            g.setBounds(0, 0, 0, 0)
        }
    },
    replace2Iframe: function(a) {
        this._replaceDom(a)
    },
    _replaceDom: function(a) {
        this.replacing = true;
        if (this.initFlag) {
            delete this.initFlag
        }
        if (this.tDiv) {
            DNA.engine.application.getJWTEventMgr().deleteSelfEvent(this, "scroll", this.tDiv);
            DNA.engine.application.getJWTEventMgr().deleteSelfEvent(this, "mousewheel", this.tDiv)
        }
        if (this.inputProxy) {
            if (DNA.engine.Client.isIE()) {
                DNA.engine.application.getJWTEventMgr().deleteSelfEvent(this, "propertychange", this.inputProxy)
            } else {
                if (DNA.engine.Client.isFF()) {
                    DNA.engine.application.getJWTEventMgr().deleteSelfEvent(this, "input", this.inputProxy)
                }
            }
        }
        this.currentCell = null ;
        this.clearSelection();
        this.selectionAreas.length = 0;
        this.hiddenRows.length = 0;
        this.hiddenCols.length = 0;
        this.currentRow = -1;
        this.currentCol = -1;
        this.contentTable = null ;
        this.tDiv = null ;
        this.hrDiv = null ;
        this.hrTable = null ;
        this.hcDiv = null ;
        this.hcTable = null ;
        this.hltDiv = null ;
        this.hltTab = null ;
        this.resizeRowIdx = 0;
        this.resizeColIdx = 0;
        this.resizeRowPoint = null ;
        this.resizeColPoint = null ;
        this.resizeDiv = null ;
        this.newSize = 0;
        this.mouseCell = null ;
        this.lastMouseCell = {
            x: -1,
            y: -1
        };
        this.selBeginCell = {
            x: 0,
            y: 0
        };
        this.selectionDiv = null ;
        this.operateCell = null ;
        this.operateArea = null ;
        this.activeEditor = null ;
        this.curFace = null ;
        this.gridState = DNA.widget.JWTGrid2.STATE_NORMAL;
        this._clearChildrenEl(this);
        if (a) {
            DNA.widget.Grid2.superclass.replace2Iframe.call(this, a)
        }
        this._unmaskState(DNA.JWT.STATE_RENDERD);
        this._makeParentIframePaintInIE()
    },
    _clearChildrenEl: function(b) {
        var d = b.getChildren();
        for (var c = 0, a = d.length; c < a; c++) {
            var g = d[c];
            if (g.getChildren) {
                if (g.getChildren()) {
                    this._clearChildrenEl(g)
                }
            }
            if (g.el) {
                g.fireEvent("beforeReplace");
                g._unmaskState(DNA.JWT.STATE_RENDERD);
                if (g.el) {
                    g.el = null 
                }
            }
        }
    },
    _isResizeable: function() {
        if (this.getEl()) {
            return true
        }
    },
    doDispose: function() {
        DNA.widget.Grid2.superclass.doDispose.call(this);
        delete this.util;
        delete this.currentCell;
        delete this.operateCell;
        delete this.operateArea;
        delete this.selectionAreas;
        delete this.contentTable;
        delete this.selectionDiv;
        delete this.resizeDiv;
        delete this.mCurLeft;
        delete this.mCurRight;
        delete this.mCurTop;
        delete this.mCurBottom;
        delete this.curLeft;
        delete this.curRight;
        delete this.curTop;
        delete this.curBottom;
        delete this.hrDiv;
        delete this.hrTable;
        delete this.hcDiv;
        delete this.hcTable;
        delete this.hltDiv;
        delete this.hltTab;
        delete this.frDiv;
        delete this.frTable;
        delete this.fcDiv;
        delete this.fcTable;
        delete this.frbDiv;
        delete this.frbTab;
        delete this.flbDiv;
        delete this.flbTab;
        delete this.hrtDiv;
        delete this.hrtTab;
        delete this.inputProxy;
        delete this.listFace;
        delete this.btnFace;
        delete this.selectionChangeDiv;
        delete this.mDragPointDiv;
        delete this.dragPointDiv;
        delete this.mSelBorderLeft;
        delete this.mSelBorderRight;
        delete this.mSelBorderTop;
        delete this.mSelBorderBottom;
        delete this.selBorderLeft;
        delete this.selBorderRight;
        delete this.selBorderTop;
        delete this.selBorderBottom;
        delete this.exchangeDiv;
        delete this.hiddenRows;
        delete this.hiddenCols;
        delete this.headerCursor;
        delete this.mergeRectCache;
        delete this.parentIframe
    },
    _placeLockSections4FF: function() {
        if (!this.hrDiv) {
            return
        }
        if (!(DNA.engine.Client.isIE() && (!document.documentMode || document.documentMode < 9))) {
            this.hrDiv.style.visibility = "visible";
            this.hcDiv.style.visibility = "visible";
            this.hltDiv.style.visibility = "visible";
            this.frDiv.style.visibility = this.getFooterRowCount() > 0 ? "visible" : "hidden";
            this.fcDiv.style.visibility = this.getFooterColumnCount() > 0 ? "visible" : "hidden";
            this.frbDiv.style.visibility = this.getFooterRowCount() > 0 && this.getFooterColumnCount() > 0 ? "visible" : "hidden";
            this.flbDiv.style.visibility = this.getFooterRowCount() > 0 && this.getHeaderColumnCount() > 0 ? "visible" : "hidden";
            this.hrtDiv.style.visibility = this.getFooterColumnCount() > 0 && this.getHeaderRowCount() > 0 ? "visible" : "hidden"
        }
    },
    _getPageXY: function(d) {
        var m = d.ownerDocument || d;
        var r;
        if (d.getBoundingClientRect) {
            var h = d.getBoundingClientRect();
            r = {
                x: h.left,
                y: h.top
            }
        } else {
            if (d == m.body || d == m || d == m.documentElement) {
                r = {
                    x: 0,
                    y: 0
                }
            } else {
                var l = 0
                  , g = 0;
                var c = d;
                while (c) {
                    if (c == m) {
                        break
                    }
                    var o = c.offsetLeft;
                    var n = c.offsetTop;
                    var a = c.style;
                    l += o;
                    g += n;
                    if (c != d) {
                        l += parseInt(a.borderLeftWidth, 10) || 0;
                        g += parseInt(a.borderTopWidth, 10) || 0;
                        var q = DNA.engine.DomUtil.getScroll(c);
                        l -= q.x;
                        g -= q.y
                    }
                    c = c.offsetParent
                }
                r = {
                    x: l,
                    y: g
                }
            }
        }
        return r
    },
    _ajustFDivHeightOnTime: function(c) {
        var b = 0;
        for (var a = 1; a <= c; a++) {
            b += DNA.engine.DomUtil.getSize(this.contentTable.rows[this.rowCount - a]).height
        }
        return b
    },
    _ajustLockedSections: function() {
        var b = DNA.engine.DomUtil.getClientSize(this.tDiv);
        if (b.width === 0 || b.height === 0) {
            return
        }
        if (this.contentTable) {
            var d = DNA.engine.DomUtil.getSize(this.tDiv);
            if ((this.contentTable.offsetHeight > d.height || this.tDiv.scrollHeight > d.height) && d.width < b.width + 10) {
                b.width = d.width - 17 - (d.width - b.width)
            }
            if ((this.contentTable.offsetWidth > d.width || this.tDiv.scrollWidth > d.width) && d.height < b.height + 10) {
                b.height = d.height - 17 - (d.height - b.height)
            }
            if (this.contentTable.offsetWidth < (d.width - 17) && b.height == d.height - 17) {
                b.height = d.height
            }
            if (this.contentTable.offsetHeight < (d.height - 17) && b.width == d.width - 17) {
                b.width = d.width
            }
        }
        this._ajustHCSize(b);
        this._ajustHRSize(b);
        this._ajustHLTSize(b);
        this._posFooterRight(b);
        this._posFooterBottom(b);
        var a = this.tDiv.scrollLeft + "px";
        var c = this.tDiv.scrollTop + "px";
        if (this.hrDiv) {
            this.hrDiv.scrollLeft = this.tDiv.scrollLeft;
            if (!(DNA.engine.Client.isIE() && (!document.documentMode || document.documentMode < 9))) {
                this.hrDiv.style.left = a;
                this.hrDiv.style.top = c
            }
        }
        if (this.hcDiv) {
            this.hcDiv.scrollTop = this.tDiv.scrollTop;
            if (!(DNA.engine.Client.isIE() && (!document.documentMode || document.documentMode < 9))) {
                this.hcDiv.style.left = a;
                this.hcDiv.style.top = c
            }
        }
        if (this.hltDiv && !(DNA.engine.Client.isIE() && (!document.documentMode || document.documentMode < 9))) {
            this.hltDiv.style.left = a;
            this.hltDiv.style.top = c
        }
        this._ajustFCSize(b);
        this._ajustFRSize(b);
        this._ajustFRBSize(b);
        this._ajustFLBSize(b);
        this._ajustHRTSize(b)
    },
    _doAfterParentVisible: function() {
        if (!this.tDiv) {
            return
        }
        if (this.el && this.el.tagName == "IFRAME") {
            var c = DNA.engine.DomUtil.getClientSize(this.el);
            var a = this.el.contentWindow.document.body;
            if (a.offsetHeight == 0) {
                this.el.contentWindow.document.documentElement.id = ""
            }
            DNA.engine.DomUtil.setSize(this.tDiv, c)
        }
        this._ajustLockedSections();
        this.computeColsGrab()
    },
    _ajustHCSize: function(m) {
        if (!this.hcTable) {
            return
        }
        var d = DNA.engine.DomUtil.getSize(this.hcTable);
        var n = d.width;
        var c = m.width;
        var l = d.height;
        var b = m.height;
        var a = n <= c ? n : c;
        var g = l <= b ? l : b;
        d.width = a;
        d.height = g;
        DNA.engine.DomUtil.setSize(this.hcDiv, d)
    },
    _ajustHRSize: function(m) {
        if (!this.hrTable) {
            return
        }
        var d = DNA.engine.DomUtil.getSize(this.hrTable);
        var n = d.width;
        var c = m.width;
        var l = d.height;
        var b = m.height;
        var a = n <= c ? n : c;
        var g = l <= b ? l : b;
        d.width = a;
        d.height = g;
        DNA.engine.DomUtil.setSize(this.hrDiv, d)
    },
    _ajustHLTSize: function(m) {
        if (!this.hltTab) {
            return
        }
        var d = DNA.engine.DomUtil.getSize(this.hltTab);
        var n = d.width;
        var c = m.width;
        var l = d.height;
        var b = m.height;
        var a = n <= c ? n : c;
        var g = l <= b ? l : b;
        d.width = a;
        d.height = g;
        DNA.engine.DomUtil.setSize(this.hltDiv, d)
    },
    _ajustFCSize: function(m) {
        if (!this.fcTable) {
            return
        }
        var d = DNA.engine.DomUtil.getSize(this.fcTable);
        var n = d.width;
        var c = m.width;
        var l = d.height;
        var b = m.height;
        var a = n <= c ? n : c;
        var g = l <= b ? l : b;
        d.width = a;
        d.height = g;
        DNA.engine.DomUtil.setSize(this.fcDiv, d)
    },
    _ajustFRSize: function(m) {
        if (!this.frTable) {
            return
        }
        var d = DNA.engine.DomUtil.getSize(this.frTable);
        var n = d.width;
        var c = m.width;
        var l = d.height;
        var b = m.height;
        var a = n <= c ? n : c;
        var g = l <= b ? l : b;
        d.width = a;
        d.height = g;
        DNA.engine.DomUtil.setSize(this.frDiv, d)
    },
    _ajustFRBSize: function(m) {
        if (!this.frbTab) {
            return
        }
        var d = DNA.engine.DomUtil.getSize(this.frbTab);
        var n = d.width;
        var c = m.width;
        var l = d.height;
        var b = m.height;
        var a = n <= c ? n : c;
        var g = l <= b ? l : b;
        d.width = a;
        d.height = g;
        DNA.engine.DomUtil.setSize(this.frbDiv, d)
    },
    _ajustFLBSize: function(m) {
        if (!this.flbTab) {
            return
        }
        var d = DNA.engine.DomUtil.getSize(this.flbTab);
        var n = d.width;
        var c = m.width;
        var l = d.height;
        var b = m.height;
        var a = n <= c ? n : c;
        var g = l <= b ? l : b;
        d.width = a;
        d.height = g;
        DNA.engine.DomUtil.setSize(this.flbDiv, d)
    },
    _ajustHRTSize: function(m) {
        if (!this.frbTab) {
            return
        }
        var d = DNA.engine.DomUtil.getSize(this.hrtTab);
        var n = d.width;
        var c = m.width;
        var l = d.height;
        var b = m.height;
        var a = n <= c ? n : c;
        var g = l <= b ? l : b;
        d.width = a;
        d.height = g;
        DNA.engine.DomUtil.setSize(this.hrtDiv, d)
    },
    _posFooterBottom: function(b) {
        if (!b) {
            var b = DNA.engine.DomUtil.getClientSize(this.tDiv)
        }
        var a = DNA.engine.DomUtil.getSize(this.contentTable);
        if (a.height < b.height) {
            if (this.frDiv) {
                var c = DNA.engine.DomUtil.getSize(this.frDiv);
                if (this.fRowCount > 0 && this.rowCount > this.fRowCount && c.height == 0) {
                    c.height = this._ajustFDivHeightOnTime(this.fRowCount)
                }
                this.frDiv.style.top = (a.height - c.height + 1) + "px";
                this.frDiv.style.bottom = ""
            }
            if (this.flbDiv) {
                var c = DNA.engine.DomUtil.getSize(this.frDiv);
                if (this.fRowCount > 0 && this.rowCount > this.fRowCount && c.height == 0) {
                    c.height = this._ajustFDivHeightOnTime(this.fRowCount)
                }
                this.flbDiv.style.top = (a.height - c.height + 1) + "px";
                this.flbDiv.style.bottom = ""
            }
            if (this.frbDiv) {
                var c = DNA.engine.DomUtil.getSize(this.frDiv);
                if (this.fRowCount > 0 && this.rowCount > this.fRowCount && c.height == 0) {
                    c.height = this._ajustFDivHeightOnTime(this.fRowCount)
                }
                this.frbDiv.style.top = (a.height - c.height + 1) + "px";
                this.frbDiv.style.bottom = ""
            }
        } else {
            if (this.frDiv) {
                var c = DNA.engine.DomUtil.getSize(this.frDiv);
                if (this.fRowCount > 0 && this.rowCount > this.fRowCount && c.height == 0) {
                    c.height = this._ajustFDivHeightOnTime(this.fRowCount)
                }
                this.frDiv.style.top = (b.height + this.tDiv.scrollTop - c.height) + "px";
                this.frDiv.style.bottom = ""
            }
            if (this.flbDiv) {
                var c = DNA.engine.DomUtil.getSize(this.flbDiv);
                if (this.fRowCount > 0 && this.rowCount > this.fRowCount && c.height == 0) {
                    c.height = this._ajustFDivHeightOnTime(this.fRowCount)
                }
                this.flbDiv.style.top = (b.height + this.tDiv.scrollTop - c.height) + "px";
                this.flbDiv.style.bottom = ""
            }
            if (this.frbDiv) {
                var c = DNA.engine.DomUtil.getSize(this.frbDiv);
                if (this.fRowCount > 0 && this.rowCount > this.fRowCount && c.height == 0) {
                    c.height = this._ajustFDivHeightOnTime(this.fRowCount)
                }
                this.frbDiv.style.top = (b.height + this.tDiv.scrollTop - c.height) + "px";
                this.frbDiv.style.bottom = ""
            }
        }
        if (this.fRowCount == 0) {
            this.frDiv.style.visibility = "hidden";
            this.flbDiv.style.visibility = "hidden";
            this.frbDiv.style.visibility = "hidden";
            this.frDiv.style.display = "none";
            this.flbDiv.style.display = "none";
            this.frbDiv.style.display = "none"
        } else {
            this.frDiv.style.visibility = "";
            this.flbDiv.style.visibility = "";
            this.frbDiv.style.visibility = "";
            this.frDiv.style.display = "";
            this.flbDiv.style.display = "";
            this.frbDiv.style.display = ""
        }
    },
    _posFooterRight: function(b) {
        if (!b) {
            var b = DNA.engine.DomUtil.getClientSize(this.tDiv)
        }
        var a = DNA.engine.DomUtil.getSize(this.contentTable);
        if (a.width < b.width) {
            if (this.fcDiv) {
                this.fcDiv.style.right = (b.width - a.width) + "px"
            }
            if (this.hrtDiv) {
                this.hrtDiv.style.right = (b.width - a.width) + "px"
            }
            if (this.frbDiv) {
                this.frbDiv.style.right = (b.width - a.width) + "px"
            }
        } else {
            if (this.fcDiv) {
                this.fcDiv.style.right = (0 - this.tDiv.scrollLeft) + "px"
            }
            if (this.hrtDiv) {
                this.hrtDiv.style.right = (0 - this.tDiv.scrollLeft) + "px"
            }
            if (this.frbDiv) {
                this.frbDiv.style.right = (0 - this.tDiv.scrollLeft) + "px"
            }
        }
        if (this.fColCount == 0) {
            this.fcDiv.style.visibility = "hidden";
            this.hrtDiv.style.visibility = "hidden";
            this.frbDiv.style.visibility = "hidden"
        } else {
            this.fcDiv.style.visibility = "";
            this.hrtDiv.style.visibility = "";
            this.frbDiv.style.visibility = ""
        }
    },
    _setHeaderFooterCrossRightTop: function(d, c, b) {
        if (DNA.engine.Client.isFF()) {
            var a;
            if (this.el.tagName == "IFRAME") {
                a = {
                    x: 0,
                    y: 0
                }
            } else {
                a = this._getPageXY(this.el)
            }
            DNA.engine.DomUtil.setLeftTop(d, a.x + c.width - b.width, a.y)
        } else {
            d.style.left = "";
            d.style.right = 0 + "px";
            d.style.top = 0 + "px"
        }
    },
    _setHeaderFooterCrossLeftBottom: function(d, c, b) {
        if (DNA.engine.Client.isFF()) {
            var a;
            if (this.el.tagName == "IFRAME") {
                a = {
                    x: 0,
                    y: 0
                }
            } else {
                a = this._getPageXY(this.el)
            }
            DNA.engine.DomUtil.setLeftTop(d, a.x, a.y + c.height - b.height)
        } else {
            d.style.top = "";
            d.style.bottom = 0 + "px"
        }
    },
    _setFooterRow: function(d, c, b) {
        if (DNA.engine.Client.isFF()) {
            var a;
            if (this.el.tagName == "IFRAME") {
                a = {
                    x: 0,
                    y: 0
                }
            } else {
                a = this._getPageXY(this.el)
            }
            DNA.engine.DomUtil.setLeftTop(d, a.x + c.width - b.width, a.y + c.height - b.height)
        } else {
            d.style.top = "";
            d.style.bottom = 0 + "px"
        }
    },
    _setFooterCol: function(d, c, b) {
        if (DNA.engine.Client.isFF()) {
            var a;
            if (this.el.tagName == "IFRAME") {
                a = {
                    x: 0,
                    y: 0
                }
            } else {
                a = this._getPageXY(this.el)
            }
            DNA.engine.DomUtil.setLeftTop(d, a.x + c.width - b.width, a.y + c.height - b.height)
        } else {
            d.style.left = "";
            d.style.right = 0 + "px"
        }
    },
    _setFooterCrossRightBottom: function(d, c, b) {
        if (DNA.engine.Client.isFF()) {
            var a;
            if (this.el.tagName == "IFRAME") {
                a = {
                    x: 0,
                    y: 0
                }
            } else {
                a = this._getPageXY(this.el)
            }
            DNA.engine.DomUtil.setLeftTop(d, a.x + c.width - b.width, a.y + c.height - b.height)
        } else {
            d.style.left = "";
            d.style.top = "";
            d.style.right = 0 + "px";
            d.style.bottom = 0 + "px"
        }
    },
    _buildHeaderCols: function(n) {
        if (!this.checkRendered(true)) {
            return
        }
        this.operateCell = null ;
        var c = this.hColCount > 1 ? this.hColCount : 1;
        if (c < n) {
            this.closeEditor();
            var m = this.rowCount;
            var b;
            var w;
            var o;
            var h = this.hRowCount > 1 ? this.hRowCount : 1;
            var v = this.fRowCount > 0 ? this.fRowCount : 0;
            var u = this.hColCount > 1 ? this.hColCount : 1;
            for (var s = 0; s <= m; ++s) {
                b = this.hcTable.rows[s];
                w = this.hcTable.ownerDocument.createDocumentFragment();
                var a;
                var m;
                o = this.contentTable.rows[s];
                for (var r = c + 1; r <= n; ++r) {
                    var p = this._getRowCell(o, r - 1, s - 1);
                    a = p.cloneNode(true);
                    var d = a.colSpan ? a.colSpan : 1;
                    if (r + d - 1 > n) {
                        a.colSpan = n - r + 1
                    }
                    if (this.util.getStyle(a, "display") == "none") {
                        var g = new DNA.widget.AbstractGridCell(this,this.contentTable,r - 1,s - 1,false);
                        var q = g.getColIndex();
                        if (q < c && (g.getRowIndex() == (s - 1))) {
                            this._getRowCell(b, q, s - 1).colSpan += 1;
                            this._getCellDom(q, s - 1, this.hltTab).colSpan += 1
                        }
                    }
                    w.appendChild(a)
                }
                if (s <= h) {
                    var t = this.hltTab.ownerDocument.createDocumentFragment();
                    t = w.cloneNode(true);
                    this.hltTab.rows[s].appendChild(t)
                }
                b.appendChild(w)
            }
            for (var s = this.rowCount - v + 1; s <= this.rowCount; ++s) {
                b = this.flbTab.rows[s - (this.rowCount - v + 1)];
                w = this.flbTab.ownerDocument.createDocumentFragment();
                var a;
                var m;
                if (s == this.rowCount - v) {
                    o = this.contentTable.rows[0]
                } else {
                    o = this.contentTable.rows[s]
                }
                for (var r = c + 1; r <= n; ++r) {
                    var p = this._getRowCell(o, r - 1, s - 1);
                    a = p.cloneNode(true);
                    w.appendChild(a)
                }
                b.appendChild(w)
            }
            this._ajustLockedSections();
            this.hColCount = n;
            if (this.currentCell) {
                var q = this.currentCell.getColIndex();
                if (q >= c && q < n) {
                    this._drawCurrentCellBack();
                    this._drawCurrentCell(this.currentCell)
                }
            }
        }
        var l = n > 1 ? n : 1;
        if (c > l) {
            this.closeEditor();
            this._deleteCols(this.hcTable, l, c - 1);
            this._deleteCols(this.hltTab, l, c - 1);
            this._ajustLockedSections();
            this.hColCount = n;
            if (this.currentCell) {
                var q = this.currentCell.getColIndex();
                if (q < c && q >= l) {
                    this._drawCurrentCellBack();
                    this._drawCurrentCell(this.currentCell)
                }
            }
        }
    },
    _buildHeaderRows: function(n) {
        if (!this.checkRendered(true)) {
            return
        }
        this.operateCell = null ;
        var h = this.hRowCount > 1 ? this.hRowCount : 1;
        if (h < n) {
            this.closeEditor();
            var c;
            var A;
            var u = this.hrTable.rows[0].parentNode;
            var w = this.hrTable.ownerDocument.createDocumentFragment();
            var v = this.hltTab.ownerDocument.createDocumentFragment();
            var d = this.hrtTab.ownerDocument.createDocumentFragment();
            var m, p, g;
            var r = this.hColCount > 1 ? this.hColCount : 1;
            var z = this.fColCount > 0 ? this.fColCount : 0;
            for (var s = h + 1; s <= n; ++s) {
                var b = this.contentTable.rows[s];
                m = b.cloneNode(true);
                w.appendChild(m);
                p = b.cloneNode(false);
                g = b.cloneNode(false);
                for (var t = 0; t <= r; ++t) {
                    var q = this._getRowCell(b, t - 1, s - 1);
                    var a = q.cloneNode(true);
                    p.appendChild(a)
                }
                v.appendChild(p);
                for (var t = this.columnCount - z; t <= this.columnCount; ++t) {
                    if (t == this.columnCount - z) {
                        var q = this._getRowCell(b, -1, s - 1)
                    } else {
                        var q = this._getRowCell(b, t - 1, s - 1)
                    }
                    var a = q.cloneNode(true);
                    g.appendChild(a)
                }
                d.appendChild(g)
            }
            this.hltTab.rows[0].parentNode.appendChild(v);
            this.hrtTab.rows[0].parentNode.appendChild(d);
            u.appendChild(w);
            this._ajustLockedSections();
            this.hRowCount = n;
            if (this.currentCell) {
                var o = this.currentCell.getRowIndex();
                if (o >= h && o < n) {
                    this._drawCurrentCellBack();
                    this._drawCurrentCell(this.currentCell)
                }
            }
        }
        var l = n > 1 ? n : 1;
        if (h > l) {
            this.closeEditor();
            this._deleteRowsDirectly(this.hrTable, l, h - 1);
            this._deleteRowsDirectly(this.hltTab, l, h - 1);
            this._ajustLockedSections();
            this.hRowCount = n;
            if (this.currentCell) {
                var o = this.currentCell.getRowIndex();
                if (o < h && o >= l) {
                    this._drawCurrentCellBack();
                    this._drawCurrentCell(this.currentCell)
                }
            }
        }
    },
    _buildFooterCols: function(d) {
        if (!this.checkRendered(true)) {
            return
        }
        var b = this.fColCount > 0 ? this.fColCount : 0;
        if (b < d) {
            var m = this.rowCount;
            var g;
            var B;
            var n;
            var l = this.hRowCount > 1 ? this.hRowCount : 1;
            var A = this.fRowCount > 0 ? this.fRowCount : 0;
            for (var w = 0; w <= m; ++w) {
                g = this.fcTable.rows[w];
                B = this.fcTable.ownerDocument.createDocumentFragment();
                var c;
                var m;
                n = this.contentTable.rows[w];
                for (var v = d; v >= b + 1; --v) {
                    var s = this._getRowCell(n, this.columnCount - v, w - 1);
                    c = s.cloneNode(true);
                    B.appendChild(c)
                }
                if (w <= l) {
                    var z = this.hrtTab.ownerDocument.createDocumentFragment();
                    z = B.cloneNode(true);
                    this._insertRowHelper(this.hrtTab.rows[w], z)
                }
                if (w == this.rowCount - A) {
                    for (var v = 0; v < d - b; ++v) {
                        var h = this.contentTable.rows[0].childNodes[this.columnCount - d + v].cloneNode(true);
                        this.frbTab.rows[w + A - this.rowCount].appendChild(h)
                    }
                }
                if (w > this.rowCount - A) {
                    var p = this.frbTab.ownerDocument.createDocumentFragment();
                    p = B.cloneNode(true);
                    this._insertRowHelper(this.frbTab.rows[w + A - this.rowCount], p)
                }
                var o = this.fcTable.rows[w].childNodes;
                var u = o.length;
                for (var q = 1; q < u; ++q) {
                    B.appendChild(o[1])
                }
                g.appendChild(B)
            }
            this._ajustLockedSections();
            this.fColCount = d;
            if (this.currentCell) {
                var t = this.currentCell.getColIndex();
                if (this.columnCount - t >= b && this.columnCount - t < d) {
                    this._drawCurrentCellBack();
                    this._drawCurrentCell(this.currentCell)
                }
            }
        }
        var a = d > 0 ? d : 0;
        if (b > a) {
            this._deleteCols(this.fcTable, 0, b - a - 1);
            this._deleteCols(this.hrtTab, 0, b - a - 1);
            this._deleteCols(this.frbTab, 0, b - a - 1);
            this._ajustLockedSections();
            this.fColCount = d;
            if (this.currentCell) {
                var t = this.currentCell.getColIndex();
                if (this.columnCount - t < b && this.columnCount - t >= a) {
                    this._drawCurrentCellBack();
                    this._drawCurrentCell(this.currentCell)
                }
            }
        }
    },
    _buildFooterRows: function(z) {
        if (!this.checkRendered(true)) {
            return
        }
        var d = this.fRowCount > 0 ? this.fRowCount : 0;
        if (d < z) {
            var c;
            var A;
            var q = this.frTable.rows[0].parentNode;
            var u = this.frTable.ownerDocument.createDocumentFragment();
            var r = this.flbTab.ownerDocument.createDocumentFragment();
            var g = this.frbTab.ownerDocument.createDocumentFragment();
            var h, t, m;
            var v = this.fColCount > 0 ? this.fColCount : 0;
            var s = this.hColCount > 1 ? this.hColCount : 1;
            for (var o = 1; o <= z - d; ++o) {
                var b = this.contentTable.rows[this.rowCount - z + o];
                h = b.cloneNode(true);
                u.appendChild(h);
                t = b.cloneNode(false);
                m = b.cloneNode(false);
                for (var p = 0; p <= s; ++p) {
                    var n = this._getRowCell(b, p - 1, this.rowCount - z + o);
                    var a = n.cloneNode(true);
                    t.appendChild(a)
                }
                r.appendChild(t);
                for (var p = this.columnCount - v; p <= this.columnCount; ++p) {
                    if (p == this.columnCount - v) {
                        var n = this._getRowCell(b, -1, this.rowCount - z + o)
                    } else {
                        var n = this._getRowCell(b, p - 1, this.rowCount - z + o)
                    }
                    var a = n.cloneNode(true);
                    m.appendChild(a)
                }
                g.appendChild(m)
            }
            this._insertRowHelper(this.flbTab.rows[0].parentNode, r);
            this._insertRowHelper(q, u);
            this._insertRowHelper(this.frbTab.rows[0].parentNode, g);
            this.fRowCount = z;
            this._ajustLockedSections();
            if (this.currentCell) {
                var l = this.currentCell.getRowIndex();
                if (this.rowCount - l >= d && this.rowCount - l < z) {
                    this._drawCurrentCellBack();
                    this._drawCurrentCell(this.currentCell)
                }
            }
        }
        var w = z > 0 ? z : 0;
        if (d > w) {
            this._deleteRows(this.frTable, 0, w - d + 1);
            this._deleteRows(this.flbTab, 0, w - d + 1);
            this._deleteRows(this.frbTab, 0, w - d + 1);
            this.fRowCount = z;
            this._ajustLockedSections();
            if (this.currentCell) {
                var l = this.currentCell.getRowIndex();
                if (this.rowCount - l < d && this.rowCount - l >= w) {
                    this._drawCurrentCellBack();
                    this._drawCurrentCell(this.currentCell)
                }
            }
        }
    },
    _insertRowHelper: function(a, g) {
        var c = a.childNodes;
        var b = c.length;
        for (var d = 1; d < b; ++d) {
            g.appendChild(c[1])
        }
        a.appendChild(g)
    },
    _focus: function() {
        var a = this.tDiv;
        if (a) {
            DNA.engine.DomUtil.addClass(a, "focus")
        }
        this._focusDom()
    },
    _blur: function() {
        var a = this.tDiv;
        if (a) {
            DNA.engine.DomUtil.removeClass(a, "focus")
        }
    },
    _registEvents: function() {
        var a = DNA.engine.application.getJWTEventMgr();
        a.addListener("mousemove", this._onGlobalMousemove, this);
        a.addListener("mouseup", this._onGlobalMouseup, this);
        a.addListener("scroll", this._onScroll, this);
        a.addListener("mousewheel", this._onMousewheel, this);
        a.addBubbleListener("keydown", this.onBubbleKeyDown, this);
        this.addListener("dblclick", this._onDblclick);
        this.addListener("mousedown", this._onMousedown);
        if (DNA.engine.Client.isIE()) {
            this.addListener("propertychange", this._onProxyChange)
        } else {
            if (DNA.engine.Client.isFF()) {
                this.addListener("input", this._onProxyChange)
            }
        }
        this.addListener("keydown", this._onKeyDown);
        this.addListener("dragover", this._doDragOver);
        this.addListener("resize", this._doResize);
        a.addListener("predispose", this._doBeforeDispose, this);
        a.addListener(DNA.JWTEvent.POSTVISIBLE, this._doAfterVisible, this);
        a.addBubbleListener(DNA.JWTEvent.MOUSEDOWN, this._doBubbleMouseDown, this);
        this.addListener("focus", this._onFocus);
        this.addListener("blur", this._onBlur);
        a.addListener(DNA.JWTEvent.PRE_DISABLED, this._onDisable, this);
        a.addListener(DNA.JWTEvent.POST_ENABLED, this._onEnable, this)
    },
    _onDisable: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            this._disableGrid(a)
        }
    }),
    _onEnable: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            this._enableGrid(a)
        }
    }),
    _disableGrid: function(b) {
        try {
            if (b.isAncestorOf(this)) {
                if (this.tDiv) {
                    this.tDiv.scrollTop = 0;
                    this.tDiv.scrollLeft = 0;
                    this._handleScroll()
                }
                this._removeScrollbar()
            }
        } catch (a) {}
    },
    _enableGrid: function(b) {
        try {
            if (b.isAncestorOf(this)) {
                this._restoreScrollbar()
            }
        } catch (a) {}
    },
    onBubbleKeyDown: new DNA.engine.PreventableAction({
        handle: function(a) {
            if (!a.isCtrl() && !a.isAlt() && a.getKeyCode() == DNA.JWTEvent.ENTER) {
                this.keyEnterDown(a);
                a.preventDefault()
            }
        }
    }),
    _onFocus: new DNA.engine.Action({
        handle: function(a) {
            try {} catch (a) {}
            this.updateCurrentCellColor()
        }
    }),
    _onBlur: new DNA.engine.Action({
        handle: function(a) {
            try {
                this._blurInputProxy()
            } catch (a) {}
            this.updateCurrentCellColor()
        }
    }),
    _onProxyChange: new DNA.engine.Action({
        handle: function(g) {
            if (!this.checkRendered(true)) {
                return
            }
            if (!this.currentCell) {
                return
            }
            if (DNA.engine.Client.isIE()) {
                var c = g.getOriginalEvent().propertyName;
                if (c != "value") {
                    return
                }
            }
            var h = this.inputProxy.value;
            if (!h || h == "") {
                return
            }
            if (this.activeEditor) {
                return
            }
            var b = this.currentCell.getColIndex();
            var l = this.currentCell.getRowIndex();
            if ((this.getEditMode() != DNA.widget.JWTGrid2.EDIT_MODE_READONLY) && this.util.isCellEditable(b, l)) {
                var a = this.getCell(b, l);
                var d = new DNA.widget.AbstractGridCell(this,null ,b,l,false);
                this.openEditor(d, null , false, DNA.widget.JWTGrid2.EDITOPEN_INPUT, h)
            } else {
                this.inputProxy.value = "";
                this.inputProxy.blur()
            }
        }
    }),
    _onGlobalMouseup: new DNA.engine.AppSuspendedAction({
        handle: function(h) {
            if (this.replacing) {
                return
            }
            if (!this.checkRendered(true)) {
                return
            }
            if (!this.isEnabled()) {
                return
            }
            var n = DNA.engine.DomUtil.getSize(this.tDiv);
            if (n.x == 0 || n.y == 0) {
                return
            }
            var m = h.getSrcElement();
            var b = h.getSrcControl();
            if (!this.isDraging()) {
                if (this.mousedownonSelf) {
                    if (b == this) {
                        this.fireEvent("gridClick", [h, this])
                    }
                    this.mousedownonSelf = false
                }
                return
            }
            var d = h.getXY();
            var g = this._getPageBounds();
            var c = this.getBounds();
            var l = {
                x: d.x - g.x,
                y: d.y - g.y
            };
            h.setSrcControl(this);
            h.setLocation(l);
            var a = this.getCellByCoordinate(l.x, l.y);
            if (!a && !this.isDraging()) {
                this.gridState = DNA.widget.JWTGrid2.STATE_OUT;
                return
            }
            this.mouseCell = a;
            switch (this.gridState) {
            case DNA.widget.JWTGrid2.STATE_ROW_SELECT:
                this.rowSelectEnd(h);
                break;
            case DNA.widget.JWTGrid2.STATE_COL_SELECT:
                this.colSelectEnd(h);
                break;
            case DNA.widget.JWTGrid2.STATE_ALL_SELECT:
                this.allSelectEnd(h);
                break;
            case DNA.widget.JWTGrid2.STATE_CELL_SELECT:
                this.mouseCellSelectEnd(h);
                break;
            case DNA.widget.JWTGrid2.STATE_SELECTION_CHANGED:
                this.mouseSelectionChangeEnd(h);
                break;
            case DNA.widget.JWTGrid2.STATE_ROW_RESIZE:
                this.rowResizeEnd(h);
                break;
            case DNA.widget.JWTGrid2.STATE_COL_RESIZE:
                this.colResizeEnd(h);
                break;
            case DNA.widget.JWTGrid2.STATE_COL_EXCHANGE:
                this._beExchangeCol = a ? a.x : -1;
                this._colExchangeEnd(h);
                break
            }
            if (this.gridState != DNA.widget.JWTGrid2.STATE_ROW_RESIZE && this.gridState != DNA.widget.JWTGrid2.STATE_COL_RESIZE && (this.gridState != DNA.widget.JWTGrid2.STATE_COL_EXCHANGE || (this.gridState == DNA.widget.JWTGrid2.STATE_COL_EXCHANGE && this.exchangeCol == this._beExchangeCol))) {
                if (this.mousedownonSelf && b == this) {
                    this.fireEvent("gridClick", [h, this])
                }
            }
            this.mousedownonSelf = false;
            this.gridState = DNA.widget.JWTGrid2.STATE_NORMAL
        }
    }),
    isDraging: function() {
        return !(this.gridState != DNA.widget.JWTGrid2.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid2.STATE_ROW_RESIZE && this.gridState != DNA.widget.JWTGrid2.STATE_CELL_SELECT && this.gridState != DNA.widget.JWTGrid2.STATE_ROW_SELECT && this.gridState != DNA.widget.JWTGrid2.STATE_COL_SELECT && this.gridState != DNA.widget.JWTGrid2.STATE_SELECTION_CHANGED && this.gridState != DNA.widget.JWTGrid2.STATE_ALL_SELECT && this.gridState != DNA.widget.JWTGrid2.STATE_COL_EXCHANGE)
    },
    _findEventCtrol: function(b) {
        var c = b;
        while (c && c.nodeType == 1) {
            if (c.id) {
                var a = DNA.widget.WidgetRegistry.get(c.id);
                if (a instanceof DNA.widget.Control) {
                    return a
                }
            }
            c = c.parentNode
        }
        return null 
    },
    _onGlobalMousemove: new DNA.engine.Action({
        handle: function(h) {
            if (this.replacing) {
                return
            }
            if (!this.checkRendered(true)) {
                return
            }
            if (!this.isEnabled()) {
                return
            }
            var n = h.getSrcElement();
            var a = this._findEventCtrol(n);
            if (a != this && this.gridState != DNA.widget.JWTGrid2.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid2.STATE_ROW_RESIZE) {
                var l = false;
                while (n.parentNode) {
                    n = n.parentNode;
                    if (n.className && n.className.indexOf("gridCell") >= 0) {
                        l = true;
                        break
                    }
                }
                if (l) {
                    if (a._eid == this.defEditorId || a._eid == n.getAttribute("ei")) {
                        return
                    }
                    h = this._getRelativeLocationForChildControl(h)
                } else {
                    if (this.cellOut) {
                        if (this.cellOut.x != -1) {
                            this.fireEvent("cellout", [this, {
                                x: this.cellOut.x,
                                y: this.cellOut.y
                            }])
                        }
                    }
                    this.cellOut = null ;
                    return
                }
            }
            if (h.getButton() != 0 && !this.selectFinish && DNA.engine.Client.isIE() && !(DNA.engine.Client.isIE() && DNA.engine.Client.getBrowserVersion() > 9)) {
                this.gridState = DNA.widget.JWTGrid2.STATE_NORMAL;
                this.mouseCellSelectEnd(h);
                return
            }
            var o = DNA.engine.DomUtil.getSize(this.tDiv);
            if (o.x == 0 || o.y == 0) {
                return
            }
            if (n == this.tDiv && this.gridState != DNA.widget.JWTGrid2.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid2.STATE_ROW_RESIZE) {
                return
            }
            var d = h.getXY();
            var g = this._getPageBounds();
            var c = this.getBounds();
            var m = {
                x: d.x - g.x,
                y: d.y - g.y
            };
            h.setSrcControl(this);
            h.setLocation(m);
            var b = this.getCellByCoordinate(m.x, m.y);
            if (!b && this.gridState != DNA.widget.JWTGrid2.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid2.STATE_ROW_RESIZE) {
                if (this.gridState == DNA.widget.JWTGrid2.STATE_COL_EXCHANGE) {
                    this._colExchangeing(h);
                    return
                }
                this.gridState = DNA.widget.JWTGrid2.STATE_OUT;
                return
            }
            this.mouseCell = b;
            if (b) {
                if (this.cellOut) {
                    if (this.cellOut.x != -1) {
                        if (!(b.x == this.cellOut.x && b.y == this.cellOut.y)) {
                            this.fireEvent("cellout", [this, {
                                x: this.cellOut.x,
                                y: this.cellOut.y
                            }]);
                            this.fireEvent("cellin", [this, {
                                x: this.mouseCell.x,
                                y: this.mouseCell.y,
                                width: m.x,
                                height: m.y
                            }])
                        }
                    }
                } else {
                    this.fireEvent("cellin", [this, {
                        x: this.mouseCell.x,
                        y: this.mouseCell.y,
                        width: m.x,
                        height: m.y
                    }])
                }
            }
            this.cellOut = this.mouseCell;
            switch (this.gridState) {
            case DNA.widget.JWTGrid2.STATE_ROW_SELECT:
                this.rowSelecting(h);
                break;
            case DNA.widget.JWTGrid2.STATE_COL_SELECT:
                this.colSelecting(h);
                break;
            case DNA.widget.JWTGrid2.STATE_CELL_SELECT:
                this.mouseCellSelecting(h);
                this._autoScroll(h);
                break;
            case DNA.widget.JWTGrid2.STATE_SELECTION_CHANGED:
                this.mouseSelectionChanging(h);
                this._autoScroll(h);
                break;
            case DNA.widget.JWTGrid2.STATE_ROW_RESIZE:
                this.rowResizing(h);
                break;
            case DNA.widget.JWTGrid2.STATE_COL_RESIZE:
                this.colResizing(h);
                break;
            case DNA.widget.JWTGrid2.STATE_COL_EXCHANGE:
                this._colExchangeing(h);
                break;
            default:
                this.updateCursor(h);
                break
            }
        }
    }),
    _colExchangeStart: function(b) {
        this.exchangeCol = this.mouseCell.x;
        var a = this._getCellDom(this.exchangeCol, 0, this.hrTable);
        this.exchangeDiv.innerHTML = DNA.engine.DomUtil.getInnerText(a);
        this.exchangeDiv.style.width = a.offsetWidth + "px";
        this.exchangeDiv.style.height = a.offsetHeight + "px"
    },
    _colExchangeing: function(a) {
        if (this.exchangeDiv.style.display == "none") {
            this.exchangeDiv.style.display = ""
        }
        this.exchangeDiv.style.top = "" + (a.getLocation().y + 2) + "px";
        this.exchangeDiv.style.left = "" + (a.getLocation().x + 2) + "px"
    },
    _colExchangeEnd: function(a) {
        this.exchangeDiv.style.display = "none";
        if (this._beExchangeCol && this._beExchangeCol != -1 && this.exchangeCol != this._beExchangeCol) {
            var b = {};
            b.doit = true;
            b.col = this.exchangeCol;
            b.tobeExchange = this._beExchangeCol;
            this.fireEvent("colExchange", [this, b]);
            if (b.doit) {
                this.closeEditor();
                this._exchangeCols(this.exchangeCol, this._beExchangeCol, this.contentTable);
                this._exchangeCols(this.exchangeCol, this._beExchangeCol, this.hrTable)
            }
        } else {
            this.exchangeCol = this._beExchangeCol = -1
        }
    },
    _exchangeCols: function(m, l, h) {
        var d, c;
        var b;
        var a = h.rows.length - 1;
        for (var g = -1; g < a; ++g) {
            d = this._getCellDom(m, g, h);
            c = this._getCellDom(l, g, h);
            this._swapNode(d, c)
        }
        if (this.currentCell) {
            if (this.currentCell.colIndex == m) {
                this.currentCell.colIndex == l
            } else {
                if (this.currentCell.colIndex == l) {
                    this.currentCell.colIndex == m
                }
            }
            this._reBoundCurCell()
        }
    },
    _swapNode: function(b, a) {
        if (b.swapNode) {
            b.swapNode(a);
            return
        }
        var d = b.parentNode;
        var g = b.nextSibling;
        var c = a.nextSibling;
        if (g) {
            d.insertBefore(a, g)
        } else {
            d.appendChild(a)
        }
        if (c) {
            d.insertBefore(b, c)
        } else {
            d.appendChild(b)
        }
    },
    _onDblclick: new DNA.engine.Action({
        handle: function(g) {
            if (!this.checkRendered(true)) {
                return
            }
            var b = g.getSrcElement();
            this.resizeRowIdx = 0;
            this.resizeColIdx = 0;
            if (this.getEditMode() === DNA.widget.JWTGrid2.EDIT_MODE_READONLY) {
                return
            }
            if (b == this.tDiv) {
                return
            }
            var c = g.getLocation();
            var a = this.getCellByCoordinate(c.x, c.y);
            if (!a) {
                return
            }
            if (this.util.isCellSelectable(a.x, a.y)) {
                this.setCurrentCell(a, null , null , null , null , DNA.widget.JWTGrid2.SETCURRENTCELLCAUSE_PROGRAM);
                if (!this._stopDbClick) {
                    if (this.currentCell && this.util.isCellEditable(this.currentCell.getColIndex(), this.currentCell.getRowIndex())) {
                        var d = new DNA.widget.AbstractGridCell(this,null ,a.x,a.y,false);
                        this.openEditor(d, g, true, DNA.widget.JWTGrid.EDITOPEN_DBCLICK)
                    }
                }
            }
        }
    }),
    _doBeforeDispose: new DNA.engine.Action({
        handle: function(h) {
            if (h.isAncestorOf(this)) {
                var g = DNA.engine.application.getJWTEventMgr();
                g.deleteSelfEvent(this, "scroll", this.tDiv);
                g.deleteSelfEvent(this, "mousewheel", this.tDiv);
                g.deleteSelfEvent(this, "propertychange", this.inputProxy);
                if (DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) {
                    var b = this.util.getDocumentOfElement(this.tDiv);
                    var l = b.getElementsByTagName("head")[0];
                    for (var d = 0, c = l.childNodes.length; d < c; d++) {
                        var a = l.childNodes[d].getAttribute("gsid");
                        if (a && a == this._eid) {
                            l.removeChild(l.childNodes[d]);
                            if (b.ownerIframe) {
                                b.ownerIframe.style.zoom = "1"
                            }
                            return
                        }
                    }
                }
            }
        }
    }),
    _doAfterVisible: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            if (a.isAncestorOf(this)) {
                this._doCreateControls();
                this.processAddControl();
                this._doAfterParentVisible()
            }
        }
    }),
    _doResize: new DNA.engine.Action({
        handle: function(b) {
            if (!this._isResizeable()) {
                return
            }
            if (this.el && this.tDiv) {
                if (this.el.tagName == "IFRAME") {
                    var a = DNA.engine.DomUtil.getClientSize(this.el);
                    DNA.engine.DomUtil.setSize(this.tDiv, a)
                }
                this._ajustLockedSections();
                this._adjustScroll();
                this.computeColsGrab()
            }
            this._placeLockSections4FF()
        }
    }),
    _doDragOver: new DNA.engine.Action({
        handle: function(c) {
            if (!this.checkRendered(true)) {
                return
            }
            if (!this.el) {
                return
            }
            var b = c.getXY();
            var a = DNA.engine.DomUtil.getPageXY(this.el);
            a = {
                x: b.x - a.x,
                y: b.y - a.y
            };
            a = this.getCellByCoordinate(a.x, a.y);
            if (a) {
                this.posInfo = a.x + "," + a.y
            } else {
                this.posInfo = "-1,-1"
            }
        }
    }),
    _onMouseOut: new DNA.engine.Action({
        handle: function(a) {
            if (!this.checkRendered(true)) {
                return
            }
        }
    }),
    _onScroll: new DNA.engine.Action({
        handle: function(a) {
            if (!this.checkRendered(true)) {
                return
            }
            var b = a.getSrcElement();
            if (b != this.tDiv) {
                return
            }
            this._handleScroll();
            this.fireEvent("currentCellOffsetChanged", [this]);
            this.fireEvent("scrolled", [this])
        }
    }),
    _onMousewheel: new DNA.engine.AppSuspendedAction({
        handle: function(b) {
            var a = b.getOriginalEvent();
            var c = a.detail ? a.detail * (-20) : a.wheelDelta;
            this.fireEvent("mousewheeled", [this, c > 0 ? "up" : "down"])
        }
    }),
    _handleScroll: function() {
        var a = this.tDiv.scrollLeft + "px";
        var b = this.tDiv.scrollTop + "px";
        if (this.hrDiv) {
            this.hrDiv.scrollLeft = this.tDiv.scrollLeft;
            if (!(DNA.engine.Client.isIE() && (!document.documentMode || document.documentMode < 9))) {
                this.hrDiv.style.left = a;
                this.hrDiv.style.top = b
            }
        }
        if (this.hcDiv) {
            this.hcDiv.scrollTop = this.tDiv.scrollTop;
            if (!(DNA.engine.Client.isIE() && (!document.documentMode || document.documentMode < 9))) {
                this.hcDiv.style.left = a;
                this.hcDiv.style.top = b
            }
        }
        if (this.hltDiv && !(DNA.engine.Client.isIE() && (!document.documentMode || document.documentMode < 9))) {
            this.hltDiv.style.left = a;
            this.hltDiv.style.top = b
        }
        this._posFooterRight();
        this._posFooterBottom();
        if (this.frDiv) {
            this.frDiv.scrollLeft = this.tDiv.scrollLeft
        }
        if (this.fcDiv) {
            this.fcDiv.scrollTop = this.tDiv.scrollTop
        }
    },
    setHorizontalPosition: function(a) {
        if (this.tDiv) {
            this.tDiv.scrollLeft = a;
            this._handleScroll()
        }
    },
    setVerticalPosition: function(a) {
        if (this.tDiv) {
            this.tDiv.scrollTop = a;
            this._handleScroll()
        }
    },
    _doBubbleMouseDown: new DNA.engine.Action({
        handle: function(l) {
            var a = l.getSrcElement();
            while (a.className != undefined && a.className.indexOf("gridCell") < 0 && a.parentNode) {
                a = a.parentNode
            }
            if (a.className && a.className.indexOf("gridCell") >= 0) {
                var b = this._getLocationForChildControl(l);
                var h = this.getCellByCoordinate(b.x, b.y);
                var c = this._getRelativeLocationForChildControl(l);
                var g = c.getSrcControl();
                var d = new DNA.widget.AbstractGridCell(this,null ,h.x,h.y,false);
                if (g._eid == this.defEditorId || g._eid == d.td.getAttribute("ei")) {
                    return
                }
                this.__onMousedown(c, a, true)
            }
        }
    }),
    _getRelativeLocationForChildControl: function(c) {
        var a = this._getLocationForChildControl(c);
        var b = new DNA.JWTEvent(c.getOriginalEvent());
        b.setSrcControl(c.getSrcControl());
        b.setLocation(a);
        return b
    },
    _getLocationForChildControl: function(c) {
        var b = c.getXY();
        var d = DNA.engine.DomUtil.getPageXY(this.tDiv);
        var a = {
            x: b.x - d.x,
            y: b.y - d.y
        };
        return a
    },
    _onMousedown: new DNA.engine.Action({
        handle: function(a) {
            this.__onMousedown(a)
        }
    }),
    __onMousedown: function(l, d, g) {
        if (!this.checkRendered(true)) {
            return
        }
        var b;
        this.needHandleGlobal = true;
        if (d) {
            b = d
        } else {
            b = l.getSrcElement();
            this.mousedownonSelf = true
        }
        if (l.getButton() == 2) {
            var c = l.getLocation();
            var a = this.getCellByCoordinate(c.x, c.y);
            if (!a) {
                return
            }
            if (this._cellSelected(a)) {
                return
            } else {
                if (this.util.isCellSelectable(a.x, a.y)) {
                    this._clearSelection(true);
                    this.setCurrentCell(a, null , null , null , l.getButton())
                }
            }
            return
        }
        if (l.getButton() != 0) {
            return
        }
        if (b == this.tDiv) {
            return
        }
        this.updateGridState(l);
        if (this.getSelectionMode() == DNA.widget.JWTGrid2.SELECTION_MODE_ROW) {
            var c = l.getLocation();
            var a = this.getCellByCoordinate(c.x, c.y);
            if (!a) {
                return
            }
            if (this._cellSelected(a)) {
                if (this.util.isCellSelectable(a.x, a.y)) {
                    this.setCurrentCell(a, null , null , null , l.getButton())
                }
                if (this.gridState < DNA.widget.JWTGrid2.STATE_CELL_EXPAND && (l.isCtrl() || l.isShift())) {
                    return
                }
            }
        }
        switch (this.gridState) {
        case DNA.widget.JWTGrid2.STATE_CELL_OPENEDITOR:
            if (this.currentCell) {
                var h = new DNA.widget.AbstractGridCell(this,null ,this.currentCell.getColIndex(),this.currentCell.getRowIndex(),false);
                this.openEditor(h, l, true, DNA.widget.JWTGrid2.EDITOPEN_CLICKFACE)
            }
            break;
        case DNA.widget.JWTGrid2.STATE_ROW_SELECT:
            this.rowSelectStart(l);
            break;
        case DNA.widget.JWTGrid2.STATE_COL_SELECT:
            this.colSelectStart(l);
            break;
        case DNA.widget.JWTGrid2.STATE_ALL_SELECT:
            this.allSelectStart(l);
            break;
        case DNA.widget.JWTGrid2.STATE_CELL_SELECT:
            this.mouseCellSelectStart(l);
            break;
        case DNA.widget.JWTGrid2.STATE_CELL_EXPAND:
            this.mouseCellExpand(l);
            break;
        case DNA.widget.JWTGrid2.STATE_CELL_COLLAPSE:
            this.mouseCellCollapse(l);
            break;
        case DNA.widget.JWTGrid2.STATE_CELL_CHECK:
            this.mouseCellCheck(l, true);
            break;
        case DNA.widget.JWTGrid2.STATE_CELL_UNCHECK:
            this.mouseCellCheck(l, false);
            break;
        case DNA.widget.JWTGrid2.STATE_SELECTION_CHANGED:
            this.mouseSelectionChangeStart(l);
            break;
        case DNA.widget.JWTGrid2.STATE_COL_EXCHANGE:
            this._colExchangeStart(l);
            break
        }
        if (!g) {
            l._preventDefault()
        }
    },
    _cellSelected: function(b) {
        for (var c = 0, a = this.selectionAreas.length; c < a; ++c) {
            var d = this.selectionAreas[c];
            if (b.x >= d.x && b.x <= d.width && b.y >= d.y && b.y <= d.height) {
                return true
            }
        }
        return false
    },
    getColExchangeable: function() {
        return (this.gridOption & DNA.widget.JWTGrid2.COL_EXCHANG_MASK) != 0
    },
    updateGridState: function(d) {
        if (this.columnCount <= 1 || this.rowCount <= 1) {
            this.gridState = DNA.widget.JWTGrid2.STATE_OUT;
            return
        }
        var a = d.getLocation();
        if (this.resizeRowIdx) {
            this.gridState = DNA.widget.JWTGrid2.STATE_ROW_RESIZE;
            var g = null ;
            if (this.resizeRowIdx >= this.hRowCount) {
                g = this._getCellDom(-1, this.resizeRowIdx, this.hcTable)
            } else {
                g = this._getCellDom(-1, this.resizeRowIdx, this.hrTable)
            }
            this.resizeRowPoint = {
                x: 0,
                y: g.offsetTop
            };
            return
        }
        if (this.resizeColIdx) {
            this.gridState = DNA.widget.JWTGrid2.STATE_COL_RESIZE;
            var g = null ;
            if (this.resizeColIdx >= this.hColCount) {
                g = this._getCellDom(this.resizeColIdx, -1, this.hrTable)
            } else {
                g = this._getCellDom(this.resizeColIdx, -1, this.hcTable)
            }
            this.resizeColPoint = {
                x: g.offsetLeft,
                y: 0
            };
            return
        }
        var c = this.getCellByCoordinate(a.x, a.y);
        if (!c) {
            this.gridState = DNA.widget.JWTGrid2.STATE_OUT;
            return
        }
        this.mouseCell = c;
        this.lastMouseCell = c;
        if (c.x === 0 && c.y === 0) {
            if (this.getSelectionMode() == DNA.widget.JWTGrid2.SELECTION_MODE_MULTI) {
                this.gridState = DNA.widget.JWTGrid2.STATE_ALL_SELECT
            }
            return
        }
        if (c.x === 0 && c.y > 0) {
            if (this.getRowSelectEnabled() && this.getSelectionMode() == DNA.widget.JWTGrid2.SELECTION_MODE_MULTI) {
                this.gridState = DNA.widget.JWTGrid2.STATE_ROW_SELECT
            } else {
                this.gridState = DNA.widget.JWTGrid2.STATE_NORMAL
            }
            return
        }
        if (c.y === 0 && c.x > 0) {
            if (this.getColExchangeable()) {
                this.gridState = DNA.widget.JWTGrid2.STATE_COL_EXCHANGE;
                return
            }
            if (this.getColSelectEnabled() && this.getSelectionMode() == DNA.widget.JWTGrid2.SELECTION_MODE_MULTI) {
                this.gridState = DNA.widget.JWTGrid2.STATE_COL_SELECT
            } else {
                this.gridState = DNA.widget.JWTGrid2.STATE_NORMAL
            }
            return
        }
        if (c.x > 0 && c.y > 0) {
            if (!this.util.isCellSelectable(c.x, c.y)) {
                this.gridState = DNA.widget.JWTGrid2.STATE_NORMAL;
                return
            }
            if (this._clickFaceArea(c, a.x, a.y)) {
                this.gridState = DNA.widget.JWTGrid2.STATE_CELL_OPENEDITOR;
                return
            }
            this.gridState = DNA.widget.JWTGrid2.STATE_CELL_SELECT
        }
        var b = d.getSrcElement();
        if (b.className == "select_area_div2") {
            b = this.__findClickDom(c, a)
        }
        if (!b) {
            return
        }
        if (b.className == "expandableCell") {
            this.gridState = DNA.widget.JWTGrid2.STATE_CELL_EXPAND
        } else {
            if (b.className == "checkableCell") {
                this.gridState = DNA.widget.JWTGrid2.STATE_CELL_CHECK
            } else {
                if (b.className == "checkedCell") {
                    this.gridState = DNA.widget.JWTGrid2.STATE_CELL_UNCHECK
                } else {
                    if (b.className == "expandedCell") {
                        this.gridState = DNA.widget.JWTGrid2.STATE_CELL_COLLAPSE
                    } else {
                        if (b.className == "dragPoint") {
                            this.gridState = DNA.widget.JWTGrid2.STATE_SELECTION_CHANGED
                        }
                    }
                }
            }
        }
    },
    __findClickDom: function(a, h) {
        var n = this._getCellDom(a.x, a.y, this.contentTable);
        var m = h.x;
        var l = h.y;
        var c = n.childNodes;
        for (var d = 0, g = c.length; d < g; ++d) {
            var b = c[d];
            if (b.offsetLeft <= m && b.offsetLeft + b.offsetWidth >= m && b.offsetTop <= l && b.offsetTop + b.offsetHeight >= l) {
                return b
            }
        }
        return null 
    },
    _clickFaceArea: function(g, c, l) {
        if (!this.curFace) {
            return false
        }
        if (this.currentCell) {
            if ((this.currentCell.getRowIndex() <= g.y && this.currentCell.getColIndex() <= g.x && this.currentCell.getRowIndex() + this.currentCell.td.rowSpan - 1 >= g.y && this.currentCell.getColIndex() + this.currentCell.td.colSpan - 1 >= g.x) ) {
                if (c > this.hcDiv.offsetWidth && this.tDiv.scrollLeft) {
                    c += this.tDiv.scrollLeft
                }
                if (l > this.hrDiv.offsetHeight && this.tDiv.scrollTop) {
                    l += this.tDiv.scrollTop
                }
                var b = this.currentCell.td.offsetLeft;
                var h = this.currentCell.td.offsetTop;
                var d = this.currentCell.td.offsetWidth;
                var a = this.currentCell.td.offsetHeight;
                if (c >= b + d - 18 && c <= b + d && l >= h && l <= h + a) {
                    return true
                }
                return false
            }
        }
        return false
    },
    _onMouseup: function(d) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = d.getSrcElement();
        a.style.cursor = "default";
        var b = d.getLocation();
        var c = this.getCellByCoordinate(b.x, b.y);
        if (!c && this.gridState != DNA.widget.JWTGrid2.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid2.STATE_ROW_RESIZE) {
            this.gridState = DNA.widget.JWTGrid2.STATE_OUT;
            return
        }
        this.mouseCell = c;
        switch (this.gridState) {
        case DNA.widget.JWTGrid2.STATE_ROW_SELECT:
            this.rowSelectEnd(d);
            break;
        case DNA.widget.JWTGrid2.STATE_COL_SELECT:
            this.colSelectEnd(d);
            break;
        case DNA.widget.JWTGrid2.STATE_CELL_SELECT:
            this.mouseCellSelectEnd(d);
            break;
        case DNA.widget.JWTGrid2.STATE_ROW_RESIZE:
            this.rowResizeEnd(d);
            break;
        case DNA.widget.JWTGrid2.STATE_COL_RESIZE:
            this.colResizeEnd(d);
            break
        }
        this.gridState = DNA.widget.JWTGrid2.STATE_NORMAL
    },
    rowSelectEnd: function(a) {
        this.selectionDiv.style.borderStyle = "none";
        if (this.currentSelection) {
            this.currentSelection.reBuild(true, 100001);
            this._internalDrawTitle(this.currentSelection, false, true);
            this.fireEvent("selection", [this])
        }
    },
    colSelectEnd: function(a) {
        this.selectionDiv.style.borderStyle = "none";
        if (this.currentSelection) {
            this.currentSelection.reBuild(true, 100001);
            this.fireEvent("selection", [this])
        }
    },
    allSelectEnd: function(a) {
        if (this.currentSelection) {
            this.currentSelection.reBuild(true);
            this.fireEvent("selection", [this])
        }
    },
    rowResizeEnd: function(b) {
        if (this.resizeRowIdx && this.newSize != -1) {
            var a = b.getSrcElement();
            a.style.cursor = "default";
            this.tDiv.style.cursor = "default";
            this.setRowHeight(this.resizeRowIdx, this.newSize);
            this.resizeDiv.style.display = "none";
            this.resizeDiv.style.height = "0px";
            this.fireEvent("rowresize", [this, this.resizeRowIdx]);
            this.resizeRowIdx = 0;
            this.resizeColIdx = 0;
            this.newSize = -1;
            this._reBoundCurCell();
            this._refreshControl(0, 0, true);
            if (DNA.engine.Client.isIE()) {
                this._rePositionFooter();
                this._ajustLockedSections()
            }
            return
        }
    },
    colResizeEnd: function(b) {
        if (this.resizeColIdx && this.newSize != -1) {
            var a = b.getSrcElement();
            a.style.cursor = "default";
            this.tDiv.style.cursor = "default";
            this.setColumnWidth(this.resizeColIdx, this.newSize);
            this.resizeDiv.style.display = "none";
            this.resizeDiv.style.width = "0px";
            this.fireEvent("columnresize", [this, this.resizeColIdx]);
            this.resizeColIdx = 0;
            this.resizeRowIdx = 0;
            this.newSize = -1;
            this._reBoundCurCell();
            this._refreshControl(0, 0, true);
            if (DNA.engine.Client.isIE()) {
                this._rePositionFooter();
                this._ajustLockedSections()
            }
            return
        }
    },
    _rePositionFooter: function() {
        if (this.tDiv.scrollTop == 0) {
            this.frDiv.style.bottom = "0px";
            this.flbDiv.style.bottom = "0px";
            this.frbDiv.style.bottom = "0px";
            this.hrtDiv.style.top = "0px"
        } else {
            this.frDiv.style.bottom = "";
            this.flbDiv.style.bottom = "";
            this.frbDiv.style.bottom = "";
            this.hrtDiv.style.top = ""
        }
        this.frDiv.style.top = "";
        this.flbDiv.style.top = "";
        this.frbDiv.style.top = "";
        this.hrtDiv.style.left = "";
        if (this.tDiv.scrollLeft == 0) {
            this.fcDiv.style.right = "0px";
            this.hrtDiv.style.right = "0px";
            this.frbDiv.style.right = "0px"
        } else {
            this.fcDiv.style.right = "";
            this.hrtDiv.style.right = "";
            this.frbDiv.style.right = ""
        }
        this.fcDiv.style.left = "";
        this.hrtDiv.style.left = "";
        this.frbDiv.style.left = ""
    },
    _onMousemove: function(c) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = c.getLocation();
        var b = this.getCellByCoordinate(a.x, a.y);
        if (!b && this.gridState != DNA.widget.JWTGrid2.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid2.STATE_ROW_RESIZE) {
            this.gridState = DNA.widget.JWTGrid2.STATE_OUT;
            return
        }
        this.mouseCell = b;
        switch (this.gridState) {
        case DNA.widget.JWTGrid2.STATE_ROW_SELECT:
            this.rowSelecting(c);
            break;
        case DNA.widget.JWTGrid2.STATE_COL_SELECT:
            this.colSelecting(c);
            break;
        case DNA.widget.JWTGrid2.STATE_CELL_SELECT:
            this.mouseCellSelecting(c);
            break;
        case DNA.widget.JWTGrid2.STATE_ROW_RESIZE:
            this.rowResizing(c);
            break;
        case DNA.widget.JWTGrid2.STATE_COL_RESIZE:
            this.colResizing(c);
            break
        }
    },
    _onGridMousemove: function(c) {
        var a = c.getLocation();
        var b = this.getCellByCoordinate(a.x, a.y);
        if (!b && this.gridState != DNA.widget.JWTGrid2.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid2.STATE_ROW_RESIZE) {
            this.gridState = DNA.widget.JWTGrid2.STATE_OUT;
            return
        }
        this.mouseCell = b;
        if (this.gridState == DNA.widget.JWTGrid2.STATE_NORMAL) {
            this.updateCursor(c)
        }
    },
    rowSelecting: function(c) {
        if (this.lastMouseCell.y != this.mouseCell.y) {
            this.lastMouseCell = this.mouseCell;
            if (this.currentSelection) {
                var d = Math.min(this.currentRow, this.mouseCell.y);
                var b = Math.max(this.currentRow, this.mouseCell.y);
                var a = {
                    x: 1,
                    y: d,
                    width: this.columnCount - 1,
                    height: b
                };
                this.currentSelection._setBound(a);
                this.currentSelection.redraw()
            }
        }
    },
    colSelecting: function(d) {
        if (this.lastMouseCell.x != this.mouseCell.x) {
            this.lastMouseCell = this.mouseCell;
            if (this.currentSelection) {
                var b = Math.min(this.currentCol, this.mouseCell.x);
                var a = Math.max(this.currentCol, this.mouseCell.x);
                var c = {
                    x: b,
                    y: 1,
                    width: a,
                    height: this.rowCount - 1
                };
                this.currentSelection._setBound(c);
                this.currentSelection.redraw()
            }
        }
    },
    rowResizing: function(b) {
        if (this.resizeRowIdx) {
            var a = b.getSrcElement();
            a.style.cursor = "row-resize";
            this._placeResizeDiv(b.getLocation().y)
        }
    },
    colResizing: function(b) {
        if (this.resizeColIdx) {
            var a = b.getSrcElement();
            a.style.cursor = "col-resize";
            this._placeResizeDiv(b.getLocation().x)
        }
    },
    updateCursor: function(g) {
        var b = this.mouseCell;
        var l = g.getSrcElement();
        var h = g.getLocation();
        this.resizeColIdx = 0;
        this.resizeRowIdx = 0;
        if (!(l.className.indexOf("gridCell") > -1 || l.className.indexOf("titleCell") > -1 || l.className == "dragPoint")) {
            return
        }
        var c = this._getCellDom(-1, b.y, this.contentTable);
        var n = c.offsetTop;
        var m = c.offsetHeight;
        if ((h.y + this.tDiv.scrollTop >= n + m - this.resizeCursorBound && h.y + this.tDiv.scrollTop <= n + m) || (h.y + this.tDiv.scrollTop >= n && h.y + this.tDiv.scrollTop <= n + this.resizeCursorBound)) {
            if ((b.x == 0 || b.x < this.getColResizeIndex() || this.getRowFreeResizeEnabled()) && b.y > 0 && this.getRowResizeEnable()) {
                if (b.y > this.hRowCount && this.tDiv.scrollTop) {
                    h.y += this.tDiv.scrollTop
                }
                if (b.y == 1) {
                    if (h.y >= n + m - this.resizeCursorBound && h.y <= n + m) {
                        this.resizeRowIdx = 1;
                        l.style.cursor = "row-resize"
                    } else {
                        this.resizeRowIdx = 0;
                        l.style.cursor = "default"
                    }
                } else {
                    if (h.y >= n + m - this.resizeCursorBound && h.y <= n + m) {
                        this.resizeRowIdx = this.util.getUpRow(b.y + 1);
                        l.style.cursor = "row-resize"
                    } else {
                        if (h.y >= n && h.y <= n + this.resizeCursorBound) {
                            this.resizeRowIdx = this.util.getUpRow(b.y);
                            l.style.cursor = "row-resize"
                        }
                    }
                }
                return
            }
        }
        c = this._getCellDom(b.x, -1, this.contentTable);
        var d = c.offsetLeft;
        var a = c.offsetWidth;
        if ((h.x + this.tDiv.scrollLeft >= d + a - this.resizeCursorBound && h.x + this.tDiv.scrollLeft <= d + a) || (h.x + this.tDiv.scrollLeft >= d && h.x + this.tDiv.scrollLeft <= d + this.resizeCursorBound)) {
            if ((b.y == 0 || b.y < this.getRowResizeIndex() || this.getColFreeResizeEnabled()) && b.x > 0 && this.getColResizeEnable()) {
                if (b.x > this.hColCount && this.tDiv.scrollLeft) {
                    h.x += this.tDiv.scrollLeft
                }
                if (b.x == 1) {
                    if (h.x >= d + a - this.resizeCursorBound && h.x <= d + a) {
                        this.resizeColIdx = 1;
                        l.style.cursor = "col-resize"
                    } else {
                        this.resizeColIdx = 0;
                        l.style.cursor = "default"
                    }
                } else {
                    if (h.x >= d + a - this.resizeCursorBound && h.x <= d + a) {
                        this.resizeColIdx = this.util.getLeftCol(b.x + 1);
                        l.style.cursor = "col-resize"
                    } else {
                        if (h.x >= d && h.x <= d + this.resizeCursorBound) {
                            this.resizeColIdx = this.util.getLeftCol(b.x);
                            l.style.cursor = "col-resize"
                        }
                    }
                }
                return
            }
        }
        l.style.cursor = "default";
        if (this.headerCursor && (b.x == 0 || b.y == 0)) {
            l.style.cursor = this.headerCursor
        }
        if (l.className == "dragPoint") {
            l.style.cursor = "crosshair"
        }
        this.resizeColIdx = 0;
        this.resizeRowIdx = 0
    },
    _onKeyDown: new DNA.engine.Action({
        handle: function(a) {
            if (!this.checkRendered(true)) {
                return
            }
            if (this.currentCol === -1 || this.currentRow === -1) {
                return
            }
            switch (a.getKeyCode()) {
            case DNA.JWTEvent.LEFT:
            case DNA.JWTEvent.RIGHT:
            case DNA.JWTEvent.UP:
            case DNA.JWTEvent.DOWN:
            case DNA.JWTEvent.HOME:
            case DNA.JWTEvent.END:
                this.keydownNavigation(a);
                a._preventDefault();
                break;
            case DNA.JWTEvent.ENTER:
                this.keyEnterDown(a);
                a._preventDefault();
                break;
            case DNA.JWTEvent.DELETE:
                if (this.getEditMode() != DNA.widget.JWTGrid2.EDIT_MODE_READONLY) {
                    this.deleteText(DNA.widget.JWTGrid.DATACHANGE_DEL)
                }
                a._preventDefault();
                break;
            case DNA.JWTEvent.PAGEUP:
            case DNA.JWTEvent.PAGEDOWN:
                this.keydownPage(a);
                a._preventDefault();
                break;
            case 86:
                if (a.isCtrl()) {
                    if (this.getEditMode() != DNA.widget.JWTGrid2.EDIT_MODE_READONLY) {
                        this.pasteText()
                    }
                    a._preventDefault()
                }
                break;
            case 67:
                if (a.isCtrl()) {
                    var b = this.copyText();
                    if (b) {
                        DNA.adapter.ClipboardUtil.copyToClipboard(b)
                    }
                    a._preventDefault()
                }
                break;
            case 88:
                if (a.isCtrl()) {
                    if (this.getEditMode() != DNA.widget.JWTGrid2.EDIT_MODE_READONLY) {
                        var b = this.cutText();
                        if (b) {
                            DNA.adapter.ClipboardUtil.copyToClipboard(b)
                        }
                    }
                    a._preventDefault()
                }
                break;
            case 77:
                break;
            case 85:
                break;
            case DNA.JWTEvent.F2:
                this.openCurrentEditor();
                break
            }
        }
    }),
    _onKeyPress: function(b) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = b.getKeyCode();
        if ((a >= 48 && a <= 57) || (a >= 65 && a <= 90) || (a >= 97 && a <= 122)) {
            if (this.currentCell) {
                this.openEditor(this.currentCell, b, false, DNA.widget.JWTGrid2.EDITOPEN_INPUT)
            }
        }
    },
    _deleteData: function(a) {},
    _pasteData: function(a) {},
    _copyData: function(a) {},
    _cutData: function(a) {},
    deleteText: function(g) {
        var b = this.selectionAreas.length;
        for (var c = 0; c < b; ++c) {
            this._deleteText(this.selectionAreas[c], g)
        }
        var h = this.getCurrentCell();
        if (h) {
            var a = this.getCell(h.x, h.y);
            if (a.getShowText()) {
                var d = {
                    x: h.x,
                    y: h.y,
                    width: h.x,
                    height: h.y
                };
                this._deleteText(d, g)
            }
        }
    },
    _deleteText: function(g, h) {
        var b = false;
        for (var d = g.y; d <= g.height; ++d) {
            if (this.ignoreHidden && this.getRowHidden(d)) {
                continue
            }
            for (var c = g.x; c <= g.width; ++c) {
                if (this.ignoreHidden && this.getColHidden(c)) {
                    continue
                }
                if (this.util.isCellEditable(c, d)) {
                    var a = this.getCell(c, d);
                    a.setShowText("", true);
                    a.setEditText("", true);
                    b = true
                }
            }
        }
        if (b) {
            this.fireDataChangeEvent(g, h)
        }
    },
    pasteText: function() {
        var b = this.getCurrentCell();
        if (b) {
            var a = {
                x: b.x,
                y: b.y,
                width: 1,
                height: 1
            };
            this._pasteText(a)
        }
    },
    _trimEnd: function(b) {
        if (!b || b.length == 0) {
            return b
        }
        var a = b.length;
        for (var c = a - 1; c >= 0; --c) {
            if (!b[c]) {
                --a
            }
            break
        }
        b.length = a;
        return b
    },
    _pasteText: function(a) {
        var b = this;
        DNA.adapter.ClipboardUtil.getClipboard(function(l) {
            var u = a.x + "," + a.y;
            var B = {
                doit: true
            };
            b.fireEvent("paste", [b, l, u, B]);
            if (!B.doit) {
                return
            }
            var c;
            if (DNA.engine.Client.isFF()) {
                c = l.split("\n")
            } else {
                c = l.split("\r\n")
            }
            c = b._trimEnd(c);
            var n = c.length;
            if (n > 0) {
                var v = Math.min(b.rowCount - 1, a.y + n - 1);
                var s = 0;
                for (var A = 0; A < n; A++) {
                    var h = c[A].split("\t");
                    s = Math.max(s, h.length)
                }
                var g;
                if (s > 0) {
                    g = Math.min(b.columnCount - 1, a.x + s - 1)
                }
                var z = false;
                var m = a.y - 1;
                var t = a.x - 1;
                for (var A = a.y; A <= v; ++A) {
                    var p = c[A - a.y].split("\t");
                    t = a.x - 1;
                    m = b.util.getDownRow(m);
                    for (var w = a.x; w <= g; ++w) {
                        var d = null ;
                        if (!b.ignoreHidden) {
                            d = b.getCell(w, A)
                        } else {
                            t = b.util.getRightCol(t);
                            if (b.util.isDataCell(t, m)) {
                                d = b.getCell(t, m)
                            }
                        }
                        if (d && b.util.isCellEditable(d.getColIndex(), d.getRowIndex())) {
                            var q = p[w - a.x];
                            if (!q) {
                                q = ""
                            }
                            if (q.indexOf("image://") == 0) {
                                d.setShowText("image://", true);
                                d.setEditText(q.substr(8), true)
                            } else {
                                d.setEditText(q, true);
                                var o = b.getFormattedText(d);
                                if (o) {
                                    d.setShowText(o, true)
                                } else {
                                    d.setShowText(q, true)
                                }
                            }
                            z = true
                        }
                    }
                }
                if (z) {
                    var r = {
                        x: a.x,
                        y: a.y,
                        width: g,
                        height: v
                    };
                    b.fireDataChangeEvent(r, DNA.widget.JWTGrid2.DATACHANGE_PASTE)
                }
            }
        })
    },
    copyText: function() {
        var a = this.getCurrentSelection();
        var b = null ;
        if (a) {
            b = a
        } else {
            var d = this.getCurrentCell();
            if (d) {
                b = {
                    x: d.x,
                    y: d.y,
                    width: d.x,
                    height: d.y
                }
            }
        }
        if (b) {
            var c = {
                doit: true
            };
            this.fireEvent("copy", [this, {
                x: b.x,
                y: b.y,
                width: b.width,
                height: b.height
            }, c]);
            if (!c.doit) {
                return null 
            }
            return this._copyText(b)
        }
        return null 
    },
    cutText: function() {
        var a = this.getCurrentSelection();
        if (a) {
            var b = this._cutText(a);
            if (b) {
                this.fireDataChangeEvent(a, DNA.widget.JWTGrid2.DATACHANGE_CUT);
                return b
            }
        }
        return null 
    },
    _copyText: function(a) {
        return this._getText(a, false)
    },
    _cutText: function(a) {
        return this._getText(a, true)
    },
    _getText: function(h, d) {
        var n = "";
        var a = /\r\n/g;
        for (var c = h.y; c <= h.height; ++c) {
            if (this.ignoreHidden && this.getRowHidden(c)) {
                continue
            }
            for (var b = h.x; b <= h.width; ++b) {
                if (this.ignoreHidden && this.getColHidden(b)) {
                    continue
                }
                var m = this.getCell(b, c);
                var g = m.getShowText();
                if (!g) {
                    g = ""
                }
                g = g.replace(a, "\n");
                n += g;
                if ("image://" == g) {
                    var l = m.getEditText();
                    if (l) {
                        n += l
                    }
                }
                if (b != h.width) {
                    n += "\t"
                }
                if (d && m.getEditable()) {
                    m.setShowText("", true);
                    m.setEditText("", true)
                }
            }
            if (c != h.height) {
                n += "\r\n"
            }
        }
        return n
    },
    toString: function() {
        return "Grid2"
    },
    _placeResizeDiv: function(c) {
        if (!this.checkRendered(true)) {
            return
        }
        if (this.resizeRowIdx) {
            if (this.tDiv.scrollTop && this.resizeRowIdx >= this.hRowCount) {
                c += this.tDiv.scrollTop
            }
            this.resizeDiv.style.display = "block";
            this.resizeDiv.style.left = this.resizeRowPoint.x + "px";
            this.resizeDiv.style.top = this.resizeRowPoint.y + "px";
            this.resizeDiv.style.width = this.contentTable.offsetWidth + "px";
            var a = c - this.resizeRowPoint.y;
            if (a <= this.minRowHeight) {
                a = this.minRowHeight
            }
            this.newSize = a;
            this.resizeDiv.style.height = a + "px";
            this.resizeDiv.style.borderStyle = "dashed none dashed none";
            this.resizeDiv.style.borderWidth = "1px 0px 1px 0px";
            return
        }
        if (this.resizeColIdx) {
            if (this.tDiv.scrollLeft && this.resizeColIdx >= this.hColCount) {
                c += this.tDiv.scrollLeft
            }
            this.resizeDiv.style.display = "block";
            this.resizeDiv.style.left = this.resizeColPoint.x + "px";
            this.resizeDiv.style.top = this.resizeColPoint.y + "px";
            this.resizeDiv.style.height = this.contentTable.offsetHeight + "px";
            var b = c - this.resizeColPoint.x;
            if (b <= this.minColWidth) {
                b = this.minColWidth
            }
            this.newSize = b;
            this.resizeDiv.style.width = b + "px";
            this.resizeDiv.style.borderStyle = "none dashed none dashed";
            this.resizeDiv.style.borderWidth = "0px 1px 0px 1px";
            return
        }
    },
    _getRowDom: function(a, b) {
        if (!this.checkRendered(true)) {
            return
        }
        var d = null ;
        try {
            d = b.rows[a + 1]
        } catch (c) {
            alert("�����ڵ�" + a + "��")
        }
        if (!d) {
            throw "�����ڵ�" + a + "��"
        }
        return d
    },
    _getRowCell: function(d, b, g) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = null ;
        try {
            a = d.cells[b + 1]
        } catch (c) {
            alert("���������Ϊ(" + b + "," + g + ")�ĵ�Ԫ��")
        }
        if (!a) {
            throw "���������Ϊ(" + b + "," + g + ")�ĵ�Ԫ��"
        }
        return a
    },
    _getCellDom: function(b, g, c) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = null ;
        try {
            a = c.rows[g + 1].cells[b + 1]
        } catch (d) {
            alert("���������Ϊ(" + b + "," + g + ")�ĵ�Ԫ��")
        }
        if (!a) {
            throw "���������Ϊ(" + b + "," + g + ")�ĵ�Ԫ��"
        }
        return a
    },
    getCellByCoordinate: function(c, b) {
        if (!this.checkRendered(true)) {
            return
        }
        if (c < 0 || b,
        0) {
            return null 
        }
        var d = this.getBounds();
        if (c > d.width || b > d.height) {
            return null 
        }
        if (c > this.hcDiv.offsetWidth && this.tDiv.scrollLeft) {
            c += this.tDiv.scrollLeft
        }
        if (b > this.hrDiv.offsetHeight && this.tDiv.scrollTop) {
            b += this.tDiv.scrollTop
        }
        var o = {
            x: -1,
            y: -1
        };
        var m = 0;
        var g = this.rowCount;
        var n;
        while (m <= g) {
            n = this._getMidDisplayRow(m, g);
            if (n == -1) {
                o.y = -1;
                break
            }
            var l = this.contentTable.rows[n];
            var q = l.offsetTop;
            var a = l.offsetHeight;
            if (b > q + a) {
                m = n + 1
            } else {
                if (b < q) {
                    g = n - 1
                } else {
                    o.y = n - 1;
                    break
                }
            }
        }
        m = 0;
        g = this.columnCount;
        var l = this.contentTable.rows[0];
        while (m <= g) {
            n = Math.floor((m + g) / 2);
            var p = l.cells[n];
            var r = p.offsetLeft;
            var h = p.offsetWidth;
            if (c > r + h) {
                m = n + 1
            } else {
                if (c < r) {
                    g = n - 1
                } else {
                    o.x = n - 1;
                    break
                }
            }
        }
        if (o.x == -1 || o.y == -1) {
            return null 
        }
        return o
    },
    _getMidDisplayRow: function(d, b) {
        var c = Math.floor((d + b) / 2);
        var g = this.contentTable.rows[c];
        var a = g;
        while (a.style.display == "none" && d < c) {
            c--;
            a = this.contentTable.rows[c]
        }
        if (this.contentTable.rows[c].style.display != "none") {
            return c
        }
        c = Math.floor((d + b) / 2);
        a = g;
        while (a.style.display == "none" && c < b) {
            c++;
            a = this.contentTable.rows[c]
        }
        if (this.contentTable.rows[c].style.display != "none") {
            return c
        }
        return -1
    },
    getCellByPoint: function(l, h) {
        if (!this.checkRendered(true)) {
            return
        }
        var n = {
            x: -1,
            y: -1
        };
        var g = 1;
        var b = this.rowCount;
        var m;
        while (g <= b) {
            m = Math.floor((g + b) / 2);
            var d = this.contentTable.rows[m];
            var p = d.offsetTop;
            var a = d.offsetHeight;
            if (h > p + a) {
                g = m + 1
            } else {
                if (h < p) {
                    b = m - 1
                } else {
                    n.y = m - 1;
                    break
                }
            }
        }
        g = 1;
        b = this.columnCount;
        var d = this.contentTable.rows[0];
        while (g <= b) {
            m = Math.floor((g + b) / 2);
            var o = d.cells[m];
            var q = o.offsetLeft;
            var c = o.offsetWidth;
            if (l > q + c) {
                g = m + 1
            } else {
                if (l < q) {
                    b = m - 1
                } else {
                    n.x = m - 1;
                    break
                }
            }
        }
        if (n.x == -1 || n.y == -1) {
            return null 
        }
        return n
    },
    getCell: function(a, b) {
        if (!this.checkRendered(true)) {
            return
        }
        if (a < 0 || a >= this.columnCount || b < 0 || b >= this.rowCount) {
            return null 
        }
        if (this.operateCell && (a == this.operateCell.getColIndex()) && (b == this.operateCell.getRowIndex())) {
            return this.operateCell
        } else {
            this.operateCell = new DNA.widget.GridCell2(this,a,b);
            return this.operateCell
        }
    },
    getGridArea: function(a) {
        if (a.x == this.operateArea.left && a.y == this.operateArea.top && a.width == this.operateArea.right && a.height == this.operateArea.bottom) {
            return this.operateArea
        }
        return new DNA.widget.GridArea(this,a)
    },
    _canMerge: function(m, l, h, b) {
        if (!this.checkRendered(true)) {
            return false
        }
        if (m <= 0 || m > h || h >= this.columnCount) {
            return false
        }
        if (l <= 0 || l > b || b >= this.rowCount) {
            return false
        }
        if (m == h && l == b) {
            return false
        }
        if (m < this.hColCount && h >= this.hColCount) {
            return false
        }
        if (l < this.hRowCount && b >= this.hRowCount) {
            return false
        }
        var d, a;
        for (var g = l; g <= b; ++g) {
            d = this._getCellDom(m, g, this.contentTable);
            a = this._getCellDom(h, g, this.contentTable);
            if (d.isSpan || a.isSpan) {
                return false
            }
        }
        for (var c = m; c <= h; ++c) {
            d = this._getCellDom(c, l, this.contentTable);
            a = this._getCellDom(c, b, this.contentTable);
            if (d.isSpan || a.isSpan) {
                return false
            }
        }
        return true
    },
    merge: function(b, h, m, a) {
        if (!this._canMerge(b, h, m, a)) {
            return false
        }
        var l = this.getCell(b, h);
        if (l.getRowSpan() > 1 || l.getColSpan() > 1) {
            this.unmerge(b, h)
        }
        this.clearSelection();
        var d = m - b + 1;
        var g = a - h + 1;
        var n = new DNA.widget.AbstractGridCell(this,this.contentTable,b,h,true);
        n.merge(d, g);
        if (b < this.hColCount) {
            n = new DNA.widget.AbstractGridCell(this,this.hcTable,b,h,true);
            n.merge(d, g);
            this._resizeControl(n)
        }
        if (h < this.hRowCount) {
            n = new DNA.widget.AbstractGridCell(this,this.hrTable,b,h,true);
            n.merge(d, g);
            this._resizeControl(n)
        }
        if (b < this.hColCount && h < this.hRowCount) {
            n = new DNA.widget.AbstractGridCell(this,this.hltTab,b,h,true);
            n.merge(d, g);
            this._resizeControl(n)
        }
        this._resizeControl(n);
        this._reBoundCurCell();
        this._reBoundFace();
        var o = true;
        for (var c = 0; c < this.mergeRectCache.length; c++) {
            if (this.mergeRectCache[c].x == b && this.mergeRectCache[c].y == h) {
                o = false
            }
        }
        if (o) {
            this.mergeRectCache.push({
                x: b,
                y: h,
                width: m,
                height: a
            })
        }
        if (!(DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) && n.td.getAttribute("wl")) {
            n.td.firstChild.style.height = (this.util.getWrapTextHeight(b, h) > (n.td.offsetHeight - 1)) ? ((n.td.offsetHeight - 1) + "px") : ""
        }
        this.getCell(b, h).setFitFontSize();
        return true
    },
    _resizeControl: function(l, c) {
        var m = l.td.offsetHeight;
        var b = l.td.offsetWidth;
        var h = this.controlCells.length;
        for (var g = 0; g < h; ++g) {
            var a = this.controlCells.get(g);
            if (a.y == l.rowIndex && a.x == l.colIndex) {
                var n = l.td.getAttribute("ci");
                var d = DNA.widget.WidgetRegistry.get(n);
                if (d) {
                    if (c) {
                        d.setSize(1, 1)
                    } else {
                        d.setSize(b - 1, m - 1)
                    }
                }
            }
        }
    },
    unmerge: function(c, l) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = this._getCellDom(c, l, this.contentTable);
        var b = a.rowSpan ? a.rowSpan : 1;
        var g = a.colSpan ? a.colSpan : 1;
        if (b <= 1 && g <= 1) {
            return
        }
        if (this.util.getStyle(a, "display") == "none") {
            return
        }
        this.clearSelection();
        var h = new DNA.widget.AbstractGridCell(this,this.contentTable,c,l,true);
        this._resizeControl(h, true);
        this._internalUnmergeCell(this.contentTable, c, l);
        this._resizeControl(h);
        if (c < this.hColCount) {
            var h = new DNA.widget.AbstractGridCell(this,this.hcTable,c,l,true);
            this._internalUnmergeCell(this.hcTable, c, l);
            this._resizeControl(h, true);
            this._resizeControl(h)
        }
        if (l < this.hRowCount) {
            var h = new DNA.widget.AbstractGridCell(this,this.hrTable,c,l,true);
            this._resizeControl(h, true);
            this._internalUnmergeCell(this.hrTable, c, l);
            this._resizeControl(h)
        }
        if (c < this.hColCount && l < this.hRowCount) {
            var h = new DNA.widget.AbstractGridCell(this,this.hltTab,c,l,true);
            this._resizeControl(h, true);
            this._internalUnmergeCell(this.hltTab, c, l);
            this._resizeControl(h)
        }
        this._reBoundCurCell();
        this._reBoundFace();
        for (var d = 0; d < this.mergeRectCache.length; d++) {
            if (this.mergeRectCache[d].x == c && this.mergeRectCache[d].y == l) {
                this.mergeRectCache.remove(this.mergeRectCache[d]);
                break
            }
        }
        this.getCell(c, l).setFitFontSize()
    },
    _internalUnmergeCell: function(s, p, o) {
        var q = this._getCellDom(p, o, s);
        if (this.hiddenRows.contains(o) || this.hiddenCols.contains(p)) {
            this.util.convertCSSFromClass2Style(q);
            q.className = "mgridCell";
            var h = DNA.engine.DomUtil.getInnerText(q);
            if (h) {
                q.setAttribute("st", h);
                DNA.engine.DomUtil.setInnerText(q, "")
            }
        }
        if (q.rrs) {
            delete q.rrs
        }
        var n = q.rowSpan ? q.rowSpan : 1;
        var g = q.colSpan ? q.colSpan : 1;
        var l = o + n;
        var r = p + g;
        q.rowSpan = 1;
        q.colSpan = 1;
        for (var d = o; d < l; ++d) {
            var m = this._getRowDom(d, s);
            for (var c = p; c < r; ++c) {
                if (d == o && c == p) {
                    continue
                }
                var b = this._getRowCell(m, c, d);
                this.util.convertCSSFromClass2Style(b);
                b.style.display = "";
                b.rowSpan = 1;
                b.colSpan = 1
            }
        }
        if (!(DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) && q.getAttribute("wl")) {
            var a = parseInt(this.util.getStyle(this._getCellDom(-1, o, s), "height")) - 1;
            q.firstChild.style.height = (this.util.getWrapTextHeight(p, o) > a) ? (a + "px") : ""
        }
    },
    _adjustScroll: function() {
        var g = DNA.engine.DomUtil.getClientSize(this.tDiv);
        var d = this.tDiv.scrollLeft ? this.tDiv.scrollLeft : 0;
        var b = this.tDiv.scrollTop ? this.tDiv.scrollTop : 0;
        var h = DNA.engine.DomUtil.getSize(this.contentTable);
        if (h.width > g.width && g.width + d > h.width) {
            var c = h.width - g.width;
            this.tDiv.scrollLeft = c;
            if (this.hrDiv) {
                this.hrDiv.scrollLeft = this.tDiv.scrollLeft
            }
        }
        if (h.height > g.height && g.height + b > h.height) {
            var a = h.height - g.height;
            this.tDiv.scrollTop = a;
            if (this.hcDiv) {
                this.hcDiv.scrollTop = this.tDiv.scrollTop
            }
        }
    },
    adjustRowHeight: function(c) {
        if (!this.checkRendered(true)) {
            return
        }
        if (!this.util.isDataRow(c)) {
            return
        }
        var b = this._getCellDom(-1, c, this.contentTable);
        if (b.getAttribute("hf")) {
            return
        }
        var a = b.offsetHeight;
        this._getCellDom(-1, c, this.hcTable).style.height = a + "px";
        if (c < this.hRowCount) {
            this._getCellDom(-1, c, this.hltTab).style.height = a + "px";
            this._getCellDom(-1, c, this.hrTable).style.height = a + "px"
        }
        this._ajustLockedSections();
        this._reBoundCurCell();
        this._reComputeSelections(c, -1);
        this._reBoundFace()
    },
    setRowHeight: function(h, a) {
        if (!this.checkRendered(true)) {
            return
        }
        if (!this.util.isDataRow(h)) {
            return
        }
        if (a < this.minRowHeight) {
            return
        }
        var d = this._getCellDom(-1, h, this.contentTable);
        if (d.getAttribute("hf")) {
            return
        }
        var g = parseInt(this.util.getStyle(d, "height"));
        d.style.height = a + "px";
        this._reSizeControlAfterRowResize(h, a);
        if (DNA.engine.Client.isIE() && d.offsetHeight != a) {
            d.style.display = "none";
            d.style.display = "block"
        }
        this._getCellDom(-1, h, this.hcTable).style.height = a + "px";
        this._getCellDom(-1, h, this.fcTable).style.height = a + "px";
        this._resizeWrapLineDiv(h, [this.contentTable, this.hcTable, this.fcTable], a, g);
        if (h < this.hRowCount) {
            this._getCellDom(-1, h, this.hltTab).style.height = a + "px";
            this._getCellDom(-1, h, this.hrTable).style.height = a + "px";
            this._getCellDom(-1, h, this.hrtTab).style.height = a + "px";
            this._resizeWrapLineDiv(h, [this.hltTab, this.hrTable, this.hrtTab], a, g)
        }
        if (h > this.rowCount - this.fRowCount) {
            this._getCellDom(-1, h, this.flbTab).style.height = a + "px";
            this._getCellDom(-1, h, this.frTable).style.height = a + "px";
            this._getCellDom(-1, h, this.frbTab).style.height = a + "px";
            this._resizeWrapLineDiv(h, [this.flbTab, this.frTable, this.frbTab], a, g)
        }
        for (var c = 0, b = this.getColumnCount(); c < b; c++) {
            this.getCell(c, h).setFitFontSize()
        }
        this._resizeWraplineDivHeightInMergeCells();
        this._ajustLockedSections();
        this._reBoundCurCell();
        this._reComputeSelections(h, -1);
        this._adjustScroll();
        this._reBoundFace()
    },
    _resizeWrapLineDiv: function(n, a, m, l) {
        if (!(DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict()))) {
            for (var d = 0; d < a.length; d++) {
                var b = a[d];
                if (b.rows && b.rows.length > 0 && b.rows[0].cells && b.rows[0].cells.length > 0) {
                    var h = b.rows[0].cells.length;
                    for (var c = 1; c < h; c++) {
                        var g = this._getCellDom(c - 1, n, b);
                        if (g.getAttribute("wl")) {
                            g.firstChild.style.height = (this.util.getWrapTextHeight(c - 1, n) > (m - 1)) ? ((m - 1) + "px") : ""
                        }
                    }
                }
            }
        }
    },
    _resizeWrapLineDivAfterWidthChange: function(g, l) {
        if (!(DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict()))) {
            for (var d = 0; d < l.length; d++) {
                var h = l[d];
                if (h.rows && h.rows.length > 0) {
                    var c = h.rows.length;
                    for (var m = 1; m < c; m++) {
                        var b = this._getCellDom(g, m - 1, h);
                        if (b.getAttribute("wl")) {
                            var a = parseInt(this._getCellDom(-1, m - 1, h).style.height) - 1;
                            b.firstChild.style.height = (this.util.getWrapTextHeight(g, m - 1) > a) ? (a + "px") : ""
                        }
                    }
                }
            }
        }
    },
    _reSizeControlAfterRowResize: function(l, b) {
        var a = this.controlCells.length;
        for (var c = 0; c < a; ++c) {
            var h = this.controlCells.get(c);
            var g = new DNA.widget.AbstractGridCell(this,null ,h.x,h.y,false);
            if (g.getRowIndex() == l || (g.getRowIndex() < l && g.getRowIndex() + g.getRowSpan() >= l)) {
                var d = this.controlProvider.getCellControl(this, g);
                if (d) {
                    d.resizeControl()
                }
            }
        }
    },
    getRowHeight: function(a) {
        if (!this.checkRendered(true)) {
            return 0
        }
        if (a < 0 || a >= this.rowCount) {
            return 0
        }
        return this._getCellDom(-1, a, this.contentTable).offsetHeight
    },
    getRowHeightFromStyle: function(c) {
        if (!this.checkRendered(true)) {
            return 0
        }
        if (c < 0 || c >= this.rowCount) {
            return 0
        }
        var a = 0;
        var b = this._getCellDom(-1, c, this.contentTable);
        if (b) {
            a = parseInt(b.style.height, 10)
        }
        return a
    },
    setColumnWidth: function(b, l) {
        if (!this.checkRendered(true)) {
            return
        }
        if (!this.util.isDataCol(b)) {
            return
        }
        if (l < this.minColWidth) {
            return
        }
        if (b <= 0 || b >= this.columnCount) {
            return
        }
        var h = this._getCellDom(b, -1, this.contentTable);
        if (h.getAttribute("hf")) {
            return
        }
        h.style.width = l + "px";
        if (DNA.engine.Client.isIE() && h.offsetWidth != l) {
            h.style.display = "none";
            h.style.display = "block"
        }
        var g = this._getCellDom(b, -1, this.hrTable);
        g.style.width = l + "px";
        if (DNA.engine.Client.isIE() && g.offsetWidth != l) {
            g.style.display = "none";
            g.style.display = "block"
        }
        var d = this._getCellDom(b, -1, this.frTable);
        d.style.width = l + "px";
        if (DNA.engine.Client.isIE() && d.offsetWidth != l) {
            d.style.display = "none";
            d.style.display = "block"
        }
        this._resizeWrapLineDivAfterWidthChange(b, [this.contentTable, this.hrTable, this.frTable]);
        if (b < this.hColCount) {
            var g = this._getCellDom(b, -1, this.hltTab);
            g.style.width = l + "px";
            if (DNA.engine.Client.isIE() && g.offsetWidth != l) {
                g.style.display = "none";
                g.style.display = "block"
            }
            g = this._getCellDom(b, -1, this.hcTable);
            g.style.width = l + "px";
            if (DNA.engine.Client.isIE() && g.offsetWidth != l) {
                g.style.display = "none";
                g.style.display = "block"
            }
            g = this._getCellDom(b, -1, this.flbTab);
            g.style.width = l + "px";
            if (DNA.engine.Client.isIE() && g.offsetWidth != l) {
                g.style.display = "none";
                g.style.display = "block"
            }
            this._resizeWrapLineDivAfterWidthChange(b, [this.hltTab, this.hcTable, this.flbTab])
        }
        for (var c = 0, a = this.getRowCount(); c < a; c++) {
            this.getCell(b, c).setFitFontSize()
        }
        this._ajustLockedSections();
        this._reBoundCurCell();
        this._reComputeSelections(-1, b);
        this._adjustScroll();
        this._reBoundFace();
        this._reSizeControlAfterColResize(b, l);
        this._resizeWraplineDivHeightInMergeCells()
    },
    _reSizeControlAfterColResize: function(b, d) {
        var a = this.controlCells.length;
        for (var c = 0; c < a; ++c) {
            var l = this.controlCells.get(c);
            var h = new DNA.widget.AbstractGridCell(this,null ,l.x,l.y,false);
            if (h.getColIndex() == b || (h.getColIndex() < b && h.getColIndex() + h.getColSpan() >= b)) {
                var g = this.controlProvider.getCellControl(this, h);
                if (g) {
                    g.resizeControl()
                }
            }
        }
    },
    getColumnWidth: function(a) {
        if (!this.checkRendered(true)) {
            return 0
        }
        if (a < 0 || a >= this.columnCount) {
            return 0
        }
        return this._getCellDom(a, -1, this.contentTable).offsetWidth
    },
    getColumnWidthFromStyle: function(b) {
        if (!this.checkRendered(true)) {
            return 0
        }
        if (b < 0 || b >= this.columnCount) {
            return 0
        }
        var a = 0;
        var c = this._getCellDom(b, -1, this.contentTable);
        if (c) {
            a = parseInt(c.style.width, 10)
        }
        return a
    },
    insertRows: function(a, g, m, d, c, b) {
        if (!this.checkRendered(true)) {
            return
        }
        a -= 1;
        var l = (m == -1) ? a : m;
        if (a < -1 || a >= this.rowCount) {
            return
        }
        var h = this.getCurrentCell();
        if (h && h.y >= a + 1) {
            this.setCurrentCellNoFire(null , null , null , null , null , DNA.widget.JWTGrid2.SETCURRENTCELLCAUSE_PROGRAM)
        }
        this.operateCell = null ;
        this.operateArea = null ;
        this.closeEditor();
        this.clearSelection();
        if (!this._insertRows(this.contentTable, a, g, l, d)) {
            return
        }
        this._insertRows(this.hcTable, a, g, l, d);
        this._insertRows(this.fcTable, a, g, l, d);
        this._changeRowTitle(this.hcTable, a);
        if (this.hRowCount != 0 && a < this.hRowCount) {
            this._insertRows(this.hrTable, a, g, l, d);
            this._insertRows(this.hltTab, a, g, l, d);
            if (this.hrtTab.rows.length > a) {
                this._insertRows(this.hrtTab, a, g, l, d)
            }
            this._changeRowTitle(this.hltTab, a);
            this.hRowCount += g
        }
        if (this.fRowCount != 0 && this.rowCount - a < this.fRowCount) {
            this._insertRows(this.frTable, this.rowCount - a, g, l, d);
            this._insertRows(this.flbTab, this.rowCount - a, g, l, d);
            this._insertRows(this.frbTab, this.rowCount - a, g, l, d);
            this._changeRowTitle(this.flbTab, a);
            this.hRowCount += g
        }
        this._ajustLockedSections();
        if (h && h.y >= a + 1) {
            h.y += g;
            this.setCurrentCellNoFire(h, null , null , null , null , DNA.widget.JWTGrid2.SETCURRENTCELLCAUSE_PROGRAM)
        }
        this.rowCount += g;
        this._fixIEShowProblem(a);
        if (d == 1) {
            this._doExpendIndentation(a, g, c, b);
            this.lastCol = c
        }
        this._resizeWraplineDivHeightInMergeCells();
        this.controlCells = this.updateControlCellListAfterRowChange(this.controlCells, a + 1, g);
        this._refreshControl(0, g, true);
        if (d) {
            this.computeColsGrab()
        }
    },
    _doExpendIndentation: function(h, g, a, d) {
        var o = this._getCellDom(a, h, this.contentTable);
        var c = DNA.engine.DomUtil.findChild(o, "span[class^=check]");
        var m = (c.style.display != "none");
        for (var b = 1; b < g + 1; b += 1) {
            var n = h + b;
            var l = this.getCell(a, n);
            l._doCellExpendIndentation(b, d, g, m)
        }
    },
    _changeRowTitle: function(g, c) {
        var a = g.rows.length - 1;
        var h = c > 0 ? c : 0;
        for (var d = h; d < a; ++d) {
            var l = this._getCellDom(0, d, g);
            var b = l.getAttribute("st");
            if (b) {
                DNA.engine.DomUtil.setInnerText(l, b)
            } else {
                DNA.engine.DomUtil.setInnerText(l, d + "")
            }
        }
    },
    _insertRows: function(B, m, n, A, v) {
        var c;
        var s = B.rows[0].cells.length - 1;
        var u = new Array(s + 1);
        var b = this._getRowDom(m, B);
        var D = null ;
        if (m != A) {
            D = this._getRowDom(A, B)
        }
        var q = B.rows.length - 1;
        if (m == -1) {
            var C = B.ownerDocument.createDocumentFragment();
            var h = B.rows[A + 1].cloneNode(false);
            var d = B.rows[0];
            for (var z = 0; z <= s; z++) {
                c = d.cells[z].cloneNode(false);
                if (z == 0) {
                    c.style.height = this.defRowHeight + "px"
                }
                this.util.convertCSSFromClass2Style(c);
                if (z == 1) {
                    c.className = "titleCell"
                } else {
                    c.className = "gridCell"
                }
                c.removeAttribute("st");
                DNA.engine.DomUtil.setInnerText(c, " ");
                h.appendChild(c)
            }
            for (var z = 0; z < n; ++z) {
                C.appendChild(h.cloneNode(true))
            }
            var o = d.parentNode;
            if (m == (q - 1)) {
                o.appendChild(C)
            } else {
                var a = B.rows[m + 2];
                o.insertBefore(C, a)
            }
            return true
        }
        u[0] = this._getCellDom(-1, A, B).cloneNode(false);
        u[0].removeAttribute("hf");
        for (var z = 0; z < s; z++) {
            c = new DNA.widget.AbstractGridCell(this,B,z,m,false);
            var p = c.getRowIndex();
            var l = c.getRowSpan();
            var t = p + l - 1;
            if (t > m && z == c.getColIndex()) {
                c.td.rowSpan += n;
                if (c.td.rrs) {
                    c.td.rrs += n
                }
                if (m == A) {
                    if (p == m) {
                        u[z + 1] = c.td.cloneNode(false);
                        u[z + 1].style.display = "none";
                        u[z + 1].rowSpan = 1;
                        u[z + 1].colSpan = 1
                    } else {
                        u[z + 1] = this._getRowCell(b, z, m).cloneNode(false)
                    }
                } else {
                    u[z + 1] = this._getRowCell(D, z, A).cloneNode(false);
                    u[z + 1].style.display = "none";
                    u[z + 1].rowSpan = 1;
                    u[z + 1].removeAttribute("colSpan")
                }
                if (c.td.colSpan) {
                    var g = z + c.td.colSpan - 1;
                    for (var w = z + 1; w <= g; ++w) {
                        if (m == A) {
                            u[w + 1] = this._getRowCell(b, w, m).cloneNode(false)
                        } else {
                            u[w + 1] = this._getRowCell(D, w, A).cloneNode(false);
                            u[w + 1].style.display = "none";
                            u[w + 1].rowSpan = 1;
                            u[w + 1].colSpan = 1
                        }
                    }
                    z = g
                }
                continue
            }
            if (m == A) {
                u[z + 1] = this._getRowCell(b, z, m).cloneNode(false);
                this.util.convertCSSFromClass2Style(u[z + 1], this.util.getDocumentOfElement(this.tDiv));
                u[z + 1].style.display = (DNA.engine.Client.isIE() && (!document.documentMode || document.documentMode < 9)) ? "inline" : "table-cell";
                u[z + 1].rowSpan = 1;
                u[z + 1].colSpan = 1;
                continue
            }
            u[z + 1] = this._getRowCell(D, z, A).cloneNode(false);
            this.util.convertCSSFromClass2Style(u[z + 1], this.util.getDocumentOfElement(this.tDiv));
            u[z + 1].style.display = (DNA.engine.Client.isIE() && (!document.documentMode || document.documentMode < 9)) ? "inline" : "table-cell";
            u[z + 1].rowSpan = 1;
            u[z + 1].colSpan = 1
        }
        C = B.ownerDocument.createDocumentFragment();
        var h = this._getRowDom(A, B).cloneNode(false);
        h.style.display = "";
        var d = this._getRowDom(m, B);
        for (var z = 0; z <= s; ++z) {
            this.util.convertCSSFromClass2Style(u[z + 1]);
            if (z > 1) {
                u[z].className = u[z].className.replace("titleCell", "gridCell")
            } else {
                u[z].style.borderColor = "";
                u[z].style.backgroundColor = ""
            }
            u[z].removeAttribute("st");
            u[z].removeAttribute("et");
            u[z].removeAttribute("rrs");
            if (u[z].getAttribute("wl")) {
                var r = u[z].ownerDocument.createElement("div");
                r.style.height = Math.max(0, (u[z].offsetHeight - 1)) + "px";
                u[z].appendChild(r)
            } else {
                if (v) {
                    u[z].innerText = ""
                } else {
                    u[z].innerText = " "
                }
            }
            h.appendChild(u[z])
        }
        for (var z = 0; z < n; z++) {
            C.appendChild(h.cloneNode(true))
        }
        var o = d.parentNode;
        if (m == (q - 1)) {
            o.appendChild(C)
        } else {
            var a = this._getRowDom(m + 1, B);
            o.insertBefore(C, a)
        }
        return true
    },
    deleteRows: function(b, d) {
        if (!this.checkRendered(true)) {
            return
        }
        if (b >= this.rowCount) {
            return
        }
        var a = b + d - 1;
        var l = this.getCurrentCell();
        if (l && l.y >= b) {
            this.setCurrentCell(null , null , null , null , null , DNA.widget.JWTGrid2.SETCURRENTCELLCAUSE_PROGRAM)
        }
        for (i = 0; i < this.controlCells.size(); i++) {
            var m = this.controlCells[i];
            if (m.y >= b && m.y < b + d) {
                var h = new DNA.widget.AbstractGridCell(this,null ,m.x,m.y,false);
                if (!this.controlProvider) {
                    break
                }
                var g = this.controlProvider.getCellControl(this, h);
                if (!g) {
                    continue
                }
                g.close()
            }
        }
        if (!this._deleteRows(this.contentTable, b, a)) {
            return
        }
        this.clearSelection();
        this.operateCell = null ;
        this.operateArea = null ;
        this._deleteRows(this.hcTable, b, a);
        this._deleteRows(this.fcTable, b, a);
        this._changeRowTitle(this.hcTable, b);
        if (b < this.hRowCount) {
            this._deleteRows(this.hrTable, b, a);
            this._deleteRows(this.hltTab, b, a);
            if (this.hrtTab.rows.length > b) {
                this._deleteRows(this.hrtTab, b, a)
            }
            this._changeRowTitle(this.hcTable, b);
            var c = (a >= this.hRowCount) ? (this.hRowCount - b) : d;
            this.hRowCount -= c
        }
        if (this.fRowCount != 0 && this.rowCount - a < this.fRowCount) {
            if ((b + d) == this.rowCount && b <= this.fRowCount) {
                this._deleteRowsDirectly(this.frTable, 0, this.fRowCount - 1);
                this._deleteRowsDirectly(this.flbTab, 0, this.fRowCount - 1);
                this._deleteRowsDirectly(this.frbTab, 0, this.fRowCount - 1);
                this._changeRowTitle(this.flbTab, 0);
                var c = (this.rowCount - b <= this.hRowCount) ? (this.fRowCount - (a - b)) : d;
                this.fRowCount = 0
            } else {
                this._deleteRows(this.frTable, b, a);
                this._deleteRows(this.flbTab, b, a);
                this._deleteRows(this.frbTab, b, a);
                this._changeRowTitle(this.flbTab, b);
                var c = (this.rowCount - b <= this.hRowCount) ? (this.fRowCount - (a - b)) : d;
                this.fRowCount -= d
            }
        }
        this._ajustLockedSections();
        this.rowCount -= d;
        if (l && l.y > a) {
            l.y -= d;
            this.setCurrentCell(l, null , null , null , null , DNA.widget.JWTGrid2.SETCURRENTCELLCAUSE_PROGRAM)
        }
        this._adjustScroll();
        if (this.rowCount > b) {
            this._fixIEDeleteProblem(b)
        }
        this._resizeWraplineDivHeightInMergeCells();
        this.controlCells = this.updateControlCellListAfterRowChange(this.controlCells, b, 0 - d);
        this._refreshControl(0, 0 - d, true)
    },
    _deleteRowsDirectly: function(d, b, a) {
        for (var c = a; c >= b; --c) {
            d.deleteRow(c + 1)
        }
    },
    _deleteRows: function(z, d, c) {
        var b = new Array();
        var o = c - d + 1;
        var n, l;
        var g = z.rows.length - 1;
        if (d >= g) {
            return
        }
        if (c >= g) {
            c = g - 1
        }
        var m = z.rows[0].cells.length - 1;
        for (var q = 0; q < m; q++) {
            n = new DNA.widget.AbstractGridCell(this,z,q,d,false);
            l = new DNA.widget.AbstractGridCell(this,z,q,c,false);
            var t = n.getRowIndex();
            var w = n.getRowSpan();
            var v = n.getColIndex();
            var r = l.getRowIndex();
            var u = l.getRowSpan();
            var s = l.getColIndex();
            if (w > 1) {
                if (t == r && v == s && v == q) {
                    if (t < d) {
                        if (n.td.rrs) {
                            n.td.rrs -= o
                        } else {
                            n.td.rowSpan -= o;
                            this._resizeControl(n)
                        }
                    } else {
                        if (t + w > c + 1) {
                            var h = this._getCellDom(q, c + 1, z);
                            h.rowSpan = w - o;
                            this._resizeControl(new DNA.widget.AbstractGridCell(this,z,q,c + 1,false));
                            if (n.td.colSpan) {
                                h.colSpan = n.td.colSpan
                            }
                            this.util.convertCSSFromClass2Style(h);
                            h.style.display = ""
                        }
                    }
                    q += (n.getColSpan() - 1);
                    continue
                } else {
                    if (t < d && v == q) {
                        b.push(new DNA.widget.Point(v,t))
                    }
                }
            }
            if (u > 1) {
                if (r <= c && s == q && r + u > c + 1) {
                    var h = this._getCellDom(q, c + 1, z);
                    h.style.display = (DNA.engine.Client.isIE() && (!document.documentMode || document.documentMode < 9)) ? "inline" : "table-cell";
                    h.rowSpan = (u - c + r - 1);
                    if (l.td.colSpan) {
                        h.colSpan = l.td.colSpan
                    }
                }
            }
        }
        for (var q = 0; q < b.length; q++) {
            var p = b[q];
            var a = this._getCellDom(p.x, p.y, z);
            a.rowSpan = d - p.y
        }
        for (var q = c; q >= d; --q) {
            z.deleteRow(q + 1)
        }
        return true
    },
    insertColumns: function(a, b, g) {
        if (!this.checkRendered(true)) {
            return
        }
        a -= 1;
        var d = (g == -1) ? a : g;
        if (a < -1 || a >= this.columnCount) {
            return
        }
        var c = this.getCurrentCell();
        if (c && c.x > a) {
            this.setCurrentCellNoFire(null , null , null , null , null , DNA.widget.JWTGrid2.SETCURRENTCELLCAUSE_PROGRAM)
        }
        this.operateCell = null ;
        this.operateArea = null ;
        this.closeEditor();
        this.clearSelection();
        if (!this._insertCols(this.contentTable, a, b, d)) {
            return
        }
        this._insertCols(this.hrTable, a, b, d);
        this._insertCols(this.frTable, a, b, d);
        this._changeColTitle(this.hrTable, a);
        if (this.hColCount != 0 && a < this.hColCount) {
            this._insertCols(this.hcTable, a, b, d);
            this._insertCols(this.hltTab, a, b, d);
            if (this.flbTab.rows && this.flbTab.rows[0].cells.length > a) {
                this._insertCols(this.flbTab, a, b, d)
            }
            this._changeColTitle(this.hltTab, a);
            this.hColCount += b
        }
        if (this.fColCount != 0 && this.colCount - a < this.fColCount) {
            this._insertCols(this.fcTable, a, b, d);
            this._insertCols(this.flbTab, a, b, d);
            this._insertCols(this.frbTab, a, b, d);
            this._changeColTitle(this.flbTab, a);
            this.fColCount += b
        }
        this._ajustLockedSections();
        if (c && c.x > a) {
            c.x += b;
            this.setCurrentCellNoFire(c, null , null , null , null , DNA.widget.JWTGrid2.SETCURRENTCELLCAUSE_PROGRAM)
        }
        this.columnCount += b;
        this.controlCells = this.updateControlCellListAfterColChange(this.controlCells, a + 1, b);
        this._refreshControl(b, 0, true);
        this.computeColsGrab()
    },
    _changeColTitle: function(g, b) {
        var h = g.rows[1];
        var d = h.cells.length - 1;
        b = b > 1 ? b : 1;
        for (var c = b; c < d; ++c) {
            var l = this._getRowCell(h, c, 0);
            var a = l.getAttribute("st");
            if (a) {
                DNA.engine.DomUtil.setInnerText(l, a)
            } else {
                DNA.engine.DomUtil.setInnerText(l, this._getDefHeaderColText(c - 1))
            }
        }
    },
    _getDefHeaderColText: function(b) {
        var c = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        if (b < 26) {
            return c.charAt(b)
        }
        var a = "";
        for (; b >= 1; b /= 26) {
            if (b < 26 && b >= 1) {
                a += c.charAt(b % 26 - 1)
            } else {
                a += c.charAt(b % 26)
            }
        }
        return this._reverse(a)
    },
    _reverse: function(a) {
        if (a) {
            return a.split("").reverse().join("")
        }
        return ""
    },
    _insertCols: function(w, h, l, v) {
        var p;
        var a;
        var n;
        var q;
        var o = w.rows.length - 1;
        var r = w.rows[0].cells.length - 1;
        if (h == -1) {
            var A = w.ownerDocument.createDocumentFragment();
            var g = w.rows[0];
            for (var t = 0; t < l; ++t) {
                a = g.cells[v + 1];
                a.style.width = this.defColWidth + "px";
                p = a.cloneNode(true);
                A.append(p);
                if (h == (r - 1)) {
                    g.appendChild(A)
                } else {
                    g.insertBefore(A, g.cells[h + 2])
                }
            }
            for (var u = 1; u <= o; u++) {
                g = w.rows[u];
                a = g.cells[v + 1].cloneNode(false);
                for (var t = 0; t < l; ++t) {
                    p = a.cloneNode(true);
                    this.util.convertCSSFromClass2Style(p);
                    if (t == 0) {
                        p.className = "titleCell"
                    } else {
                        p.className = "gridCell"
                    }
                    A.append(a.cloneNode(true));
                    if (h == (r - 1)) {
                        g.appendChild(A)
                    } else {
                        g.insertBefore(A, g.cells[h + 2])
                    }
                }
            }
            this.contentTable.rows[0].cells[1].width = parseInt(this.rowTitleTab.rows[0].firstChild.width) + "px";
            return true
        }
        var z = w.ownerDocument.createDocumentFragment();
        var d = w.rows[0];
        p = d.cells[v + 1].cloneNode(false);
        for (var t = 0; t < l; t++) {
            z.appendChild(p.cloneNode(true))
        }
        if (h == (r - 1)) {
            d.appendChild(z)
        } else {
            d.insertBefore(z, d.cells[h + 1])
        }
        for (var u = 0; u < o; u++) {
            a = new DNA.widget.AbstractGridCell(this,w,h,u,false);
            n = a.getRowIndex();
            q = a.getColIndex();
            var m = a.getColSpan();
            var b = q + m - 1;
            if ((b > h) && (u == n)) {
                a.td.colSpan += l;
                var g = this._getRowDom(u, w);
                p = this._getRowCell(g, v, u).cloneNode(false);
                this.util.convertCSSFromClass2Style(p);
                p.style.display = "none";
                p.style.backgroundImage = "";
                p.rowSpan = 1;
                p.colSpan = 1;
                if (u > 0) {
                    p.className = "gridCell"
                }
                this._internalInsertCols(g, p, h, l, w);
                if (a.getRowSpan() > 1) {
                    var c = a.getRowSpan();
                    var s = u + c - 1;
                    for (var t = u + 1; t <= s; ++t) {
                        var g = this._getRowDom(t, w);
                        w.rows[t + 1];
                        p = this._getRowCell(g, v, t).cloneNode(false);
                        this.util.convertCSSFromClass2Style(p);
                        p.style.display = "none";
                        p.style.backgroundImage = "";
                        p.rowSpan = 1;
                        p.colSpan = 1;
                        if (u > 0) {
                            p.className = "gridCell"
                        }
                        this._internalInsertCols(g, p, h, l, w)
                    }
                    u = s
                }
            } else {
                var g = this._getRowDom(u, w);
                p = this._getRowCell(g, v, u).cloneNode(false);
                this.util.convertCSSFromClass2Style(p, this.util.getDocumentOfElement(g));
                p.style.display = "";
                p.style.backgroundImage = "";
                p.rowSpan = 1;
                p.colSpan = 1;
                if (u > 0) {
                    p.className = "gridCell"
                }
                this._internalInsertCols(g, p, h, l, w)
            }
        }
        return true
    },
    _internalInsertCols: function(m, l, b, h, g) {
        var d = g.rows[0].cells.length - 1 - h;
        var c = g.ownerDocument.createDocumentFragment();
        l.innerText = " ";
        l.removeAttribute("st");
        l.removeAttribute("et");
        for (var a = 0; a < h; a++) {
            c.appendChild(l.cloneNode(true))
        }
        if (b == (d - 1)) {
            m.appendChild(c)
        } else {
            m.insertBefore(c, m.cells[b + 2])
        }
    },
    deleteColumns: function(b, d) {
        if (!this.checkRendered(true)) {
            return
        }
        if (b >= this.columnCount) {
            return
        }
        var a = b + d - 1;
        var g = this.getCurrentCell();
        if (g && g.x >= b) {
            this.setCurrentCell(null , null , null , null , null , DNA.widget.JWTGrid2.SETCURRENTCELLCAUSE_PROGRAM)
        }
        if (!this._deleteCols(this.contentTable, b, a)) {
            return
        }
        this.operateCell = null ;
        this.operateArea = null ;
        this.clearSelection();
        this._deleteCols(this.hrTable, b, a);
        this._deleteCols(this.frTable, b, a);
        this._changeColTitle(this.hrTable, b);
        if (b < this.hColCount) {
            this._deleteCols(this.hcTable, b, a);
            this._deleteCols(this.hltTab, b, a);
            if (this.flbTab.rows && this.flbTab.rows[0].cells.length > b) {
                this._deleteCols(this.flbTab, b, a)
            }
            this._changeColTitle(this.hltTab, b);
            var c = (a >= this.hColCount) ? (this.hColCount - b) : d;
            this.hColCount -= c
        }
        this._ajustLockedSections();
        if (g && g.x > a) {
            g.x -= d;
            this.setCurrentCell(g, null , null , null , null , DNA.widget.JWTGrid2.SETCURRENTCELLCAUSE_PROGRAM)
        }
        this.columnCount -= d;
        this._adjustScroll();
        this.controlCells = this.updateControlCellListAfterColChange(this.controlCells, b, 0 - d);
        this._refreshControl(0 - d, 0, true);
        this.computeColsGrab()
    },
    _deleteCols: function(C, g, d) {
        var p, n;
        var h = C.rows.length - 1;
        var o = C.rows[0].cells.length - 1;
        if (d >= o) {
            d = o - 1
        }
        var c = new Array();
        for (var t = 0; t < h; ++t) {
            p = new DNA.widget.AbstractGridCell(this,C,g,t,false);
            n = new DNA.widget.AbstractGridCell(this,C,d,t,false);
            var w = p.getRowIndex();
            var B = p.getRowSpan();
            var A = p.getColIndex();
            var E = p.getColSpan();
            var u = n.getRowIndex();
            var z = n.getRowSpan();
            var v = n.getColIndex();
            var D = n.getColSpan();
            if (E > 1) {
                if (w == u && A == v && w == t) {
                    var l = d - g + 1;
                    if (A < g) {
                        p.td.colSpan = (E - l)
                    } else {
                        var q = A + E;
                        if (q > d + 1) {
                            var m = this._getCellDom(d + 1, t, C);
                            m.rowSpan = B;
                            m.style.display = (DNA.engine.Client.isIE() && (!document.documentMode || document.documentMode < 9)) ? "inline" : "table-cell";
                            m.colSpan = q - d - 1
                        }
                    }
                    t += (B - 1);
                    continue
                } else {
                    if (A < g && w == t) {
                        c.push(new DNA.widget.Point(A,w))
                    }
                }
            }
            if ((D > 1) && (u == t)) {
                var q = v + D;
                if (q > d + 1) {
                    var m = this._getCellDom(d + 1, t, C);
                    m.rowSpan = z;
                    m.style.display = (DNA.engine.Client.isIE() && (!document.documentMode || document.documentMode < 9)) ? "inline" : "table-cell";
                    m.colSpan = q - d - 1
                }
            }
        }
        for (var t = 0; t < c.length; t++) {
            var r = c[t];
            var b = this._getCellDom(r.x, r.y, C);
            b.colSpan = g - r.x
        }
        for (var t = 0; t <= h; ++t) {
            var a = this._getRowDom(t - 1, C);
            for (var s = d; s >= g; --s) {
                if (DNA.engine.Client.isIE()) {
                    var b = a.cells[s + 1];
                    a.removeChild(b)
                } else {
                    a.deleteCell(s + 1)
                }
            }
        }
        return true
    },
    setRowBackImage: function(b, c) {
        var d = this._getRowDom(b + 1, this.contentTable);
        var a = c ? ("url(" + DNA.widget.ImageDescriptor.getUrl(c) + ")") : "";
        d.style.backgroundImage = a;
        d = this._getRowDom(b + 1, this.hcTable);
        d.style.backgroundImage = a;
        if (d < this.headerRowCount) {
            d = this._getRowDom(b + 1, this.hrTable);
            d.style.backgroundImage = a
        }
    },
    setColGrab: function(b, c) {
        var a = this._getCellDom(b, -1, this.contentTable);
        if (c) {
            a.grab = 1
        } else {
            a.grab = 0
        }
    },
    computeColsGrab: function() {
        if (!this.getColGrabEnable()) {
            return
        }
        var p = this.getColumnCount();
        var l = 0;
        var h = this.tDiv.clientWidth;
        if (h <= 0) {
            return
        }
        var o = [];
        for (var d = 0; d < p; ++d) {
            if (!this.getColGarb(d)) {
                l += this.getColumnWidth(d)
            } else {
                l += this.getColGarbOriginalWidth(d);
                o.push(d)
            }
        }
        if (h - l <= 1) {
            return
        }
        var m = o.length;
        if (m > 0) {
            for (var d = 0; d < m; ++d) {
                var q = o[d];
                var c = this.getColGarbOriginalWidth(q);
                this.setColumnWidth(q, c)
            }
            h = this.tDiv.clientWidth;
            var g = 0;
            for (var d = 0; d < m; ++d) {
                g += this.getColGarbOriginalWidth(o[d])
            }
            var a = 0;
            for (d = 0; d < m; ++d) {
                q = o[d];
                c = this.getColGarbOriginalWidth(q);
                var r = Math.floor((c / g) * (h - l));
                var n = c + r;
                a += r;
                this.setColumnWidth(q, n < 0 ? 0 : n)
            }
            var b = h - l - a;
            if (b > 0) {
                var q = o[m - 1];
                this.setColumnWidth(q, this.getColumnWidth(q) + b)
            }
        }
    },
    getColGarb: function(b) {
        var a = this._getCellDom(b, -1, this.contentTable);
        if (a.getAttribute("grab") == "1") {
            return true
        }
        return false
    },
    getColGarbOriginalWidth: function(b) {
        var a = this._getCellDom(b, -1, this.contentTable);
        return ( a.getAttribute("ocw") ? parseInt(a.getAttribute("ocw")) : this.getColumnWidth(b)) 
    },
    getColGrabEnable: function() {
        return (this.gridOption & (1 << 17)) != 0
    },
    getCurBorderHiddden: function() {
        return (this.gridOption & (1 << 16)) != 0
    },
    getRowVisible: function(c) {
        var b = this._getRowDom(c, this.contentTable);
        if (!b) {
            return false
        }
        var a = b.cells[0];
        if (a.getAttribute("hf")) {
            return false
        }
        return true
    },
    setRowHidden: function(c, a) {
        if (!this.checkRendered(true)) {
            return
        }
        if (c < 0 || c >= this.rowCount) {
            return
        }
        if (a) {
            this._hideRow(c)
        } else {
            this._displayRow(c)
        }
        var b = this.getCurrentSelection();
        if (b) {
            b.reBuild(true)
        }
        this._resizeWraplineDivHeightInMergeCells()
    },
    _fixIEHideProblem: function(a) {
        this._checkForHideRow2(a, this.contentTable, this.columnCount);
        this._checkForHideRow2(a, this.hcTable, this.hColCount);
        if (a < this.hRowCount) {
            this._checkForHideRow2(a, this.hrTable, this.columnCount);
            this._checkForHideRow2(a, this.hltTab, this.hColCount)
        }
    },
    _fixIEDeleteProblem: function(a) {
        this._checkForDeleteRow2(a, this.contentTable, this.columnCount);
        this._checkForDeleteRow2(a, this.hcTable, this.hColCount);
        if (a < this.hRowCount) {
            this._checkForDeleteRow2(a, this.hrTable, this.columnCount);
            this._checkForDeleteRow2(a, this.hltTab, this.hColCount)
        }
    },
    _fixIEShowProblem: function(a) {
        this._checkForShowRow2(a, this.contentTable, this.columnCount);
        this._checkForShowRow2(a, this.hcTable, this.hColCount);
        if (a < this.hRowCount) {
            this._checkForShowRow2(a, this.hrTable, this.columnCount);
            this._checkForShowRow2(a, this.hltTab, this.hColCount)
        }
    },
    _checkForHideRow2: function(c, m, l) {
        var b = m.rows.length - 1;
        for (var d = 1; d < l; ) {
            var a = this._getCellDom(d, c, m);
            if (a.rowSpan && this._getRowRealSpan(a.rowSpan, c) > 1) {
                var h = c + 1;
                if (h < b) {
                    var g = this._getCellDom(d, h, m);
                    g.style.display = (DNA.engine.Client.isIE() && (!document.documentMode || document.documentMode < 9)) ? "inline" : "table-cell";
                    g.rowSpan = a.rowSpan - (h - c);
                    if (a.colSpan) {
                        g.colSpan = a.colSpan
                    }
                }
            }
            d += a.colSpan ? a.colSpan : 1
        }
    },
    _checkForDeleteRow2: function(b, g, d) {
        for (var c = 1; c < d; ) {
            var a = this._getCellDom(c, b, g);
            if (a.rowSpan && a.rowSpan > 1) {
                a.style.display = (DNA.engine.Client.isIE() && (!document.documentMode || document.documentMode < 9)) ? "inline" : "table-cell"
            }
            c += a.colSpan ? a.colSpan : 1
        }
    },
    _checkForShowRow2: function(c, m, l) {
        var b = m.rows.length - 1;
        for (var d = 1; d < l; ) {
            var a = this._getCellDom(d, c, m);
            if (a.rowSpan && a.rowSpan > 1) {
                for (var h = c + 1; c + a.rowSpan > h; h++) {
                    if (h < b) {
                        var g = this._getCellDom(d, h, m);
                        g.removeAttribute("rowSpan");
                        g.removeAttribute("colSpan");
                        g.style.display = "none";
                        g.setAttribute("mg", "1")
                    }
                }
            }
            d += a.colSpan ? a.colSpan : 1
        }
    },
    _checkForHideRow: function(c, l, h) {
        for (var d = 1; d < h; ) {
            var a = new DNA.widget.AbstractGridCell(this,l,d,c,false);
            var m = a.getRowIndex();
            if (m < c) {
                var g = a.getRowSpan();
                var b = this._getRowRealSpan(g, a.getRowIndex());
                if (b != a.td.rowSpan) {
                    if (!a.td.rrs) {
                        a.td.rrs = g
                    }
                    a.td.rowSpan = b
                }
            }
            d += a.getColSpan()
        }
    },
    _getRowRealSpan: function(c, d) {
        var a = c;
        for (var b = d + c - 1; b >= d; --b) {
            if (!this.getRowVisible(b)) {
                a--
            } else {
                break
            }
        }
        return a
    },
    _hideRow: function(m) {
        var l = this._getRowDom(m, this.contentTable);
        var a = l.cells[0];
        if (a.getAttribute("hf")) {
            return
        }
        a.setAttribute("hf", 1);
        if (DNA.engine.Client.isStrict()) {
            for (var c = 1; c < this.getColumnCount(); c++) {
                if (this.util.getStyle(this._getCellDom(c, m, this.contentTable), "display") == "none") {
                    for (var d = m - 1; d > 0; d--) {
                        var b = this.getCell(c, d);
                        var g = this._getCellDom(c, d, this.contentTable);
                        var h = g.rrs ? g.rrs : g.rowSpan;
                        if (h + d - 1 >= m) {
                            b.setRowSpan(g.rowSpan - 1);
                            break
                        }
                    }
                }
            }
        }
        l.style.display = "none";
        this._getRowDom(m, this.hcTable).style.display = "none";
        if (m == 0 || (this.hRowCount != 0 && m < this.hRowCount)) {
            this._getRowDom(m, this.hrTable).style.display = "none";
            this._getRowDom(m, this.hltTab).style.display = "none"
        }
        this._ajustLockedSections();
        this.hiddenRows.push(m);
        this._reBoundCurCell();
        this._adjustScroll();
        this._fixIEHideProblem(m)
    },
    __hideRow: function(c) {
        var b = this._getRowDom(c, this.contentTable);
        var a = b.cells[0];
        if (a.getAttribute("hf")) {
            return
        }
        this._hideRow4Tab(this.contentTable, c);
        this._hideRow4Tab(this.hcTable, c);
        if (c == 0 || (this.hRowCount != 0 && c < this.hRowCount)) {
            this._hideRow4Tab(this.hrTable, c);
            this._hideRow4Tab(this.hltTab, c)
        }
        this._ajustLockedSections();
        this.hiddenRows.push(c);
        this._reBoundCurCell();
        this._adjustScroll()
    },
    _hideRow4Tab: function(h, m) {
        var l = this._getRowDom(m, h);
        var a = l.cells[0];
        if (m === 0) {
            l.style.display = "none";
            a.setAttribute("hf", 1);
            return
        }
        var g = l.cells.length - 1;
        var b = h.rows.length - 1;
        a.setAttribute("hf", 1);
        a.setAttribute("rh", this.util.getStyle(a, "height"));
        a.style.height = "0px";
        for (var c = 1; c <= g; ++c) {
            var a = this._getRowCell(l, c - 1, m);
            if (a.rowSpan && a.rowSpan > 1) {
                continue
            }
            a.setAttribute("rhc", 1);
            this.util.convertCSSFromClass2Style(a);
            if (c == 1) {
                a.className = "mtitleCell"
            } else {
                a.className = "mgridCell"
            }
            var d = DNA.engine.DomUtil.getInnerText(a);
            if (d) {
                a.setAttribute("st", d);
                DNA.engine.DomUtil.setInnerText(a, "")
            }
            if (DNA.engine.Client.isIE()) {
                if (a.style.writingMode = "tb-rl") {
                    this.util.convertCSSFromClass2Style(a);
                    a.style.writingMode = ""
                }
            }
        }
    },
    _displayRow: function(m) {
        var l = this._getRowDom(m, this.contentTable);
        var a = l.cells[0];
        if (!a.getAttribute("hf")) {
            return
        }
        a.removeAttribute("hf");
        if (DNA.engine.Client.isStrict()) {
            for (var c = 1; c < this.getColumnCount(); c++) {
                if (this.util.getStyle(this._getCellDom(c, m, this.contentTable), "display") == "none") {
                    for (var d = m - 1; d > 0; d--) {
                        var b = this.getCell(c, d);
                        var g = this._getCellDom(c, d, this.contentTable);
                        var h = g.rrs ? g.rrs : g.rowSpan;
                        if (h + d - 1 >= m) {
                            b.setRowSpan(g.rowSpan + 1);
                            break
                        }
                    }
                }
            }
        }
        l.style.display = "";
        this._getRowDom(m, this.hcTable).style.display = "";
        if (m == 0 || (this.hRowCount != 0 && m < this.hRowCount)) {
            this._getRowDom(m, this.hrTable).style.display = "";
            this._getRowDom(m, this.hltTab).style.display = ""
        }
        this._ajustLockedSections();
        this.hiddenRows.remove(m);
        this._reBoundCurCell();
        this._showControlInRows(m);
        this._fixIEShowProblem(m)
    },
    _showControlInRows: function(g) {
        for (var b = 0; b < this.controlCells.length; b++) {
            if (this.controlCells[b].y == g) {
                var a = this.controlCells[b];
                var d = new DNA.widget.AbstractGridCell(this,null ,a.x,a.y,false);
                if (!this.controlProvider) {
                    return
                }
                var c = this.controlProvider.getCellControl(this, d);
                if (!c) {
                    return
                }
                c.resizeControl()
            }
        }
    },
    __displayRow: function(c) {
        var b = this._getRowDom(c, this.contentTable);
        var a = b.cells[0];
        if (!a.getAttribute("hf")) {
            return
        }
        this._showRow4Tab(this.contentTable, c);
        this._showRow4Tab(this.hcTable, c);
        if (c == 0 || (this.hRowCount != 0 && c < this.hRowCount)) {
            this._showRow4Tab(this.hrTable, c);
            this._showRow4Tab(this.hltTab, c)
        }
        this._ajustLockedSections();
        this.hiddenRows.remove(c);
        this._reBoundCurCell()
    },
    _showRow4Tab: function(m, c) {
        var n = this._getRowDom(c, m);
        var h = n.cells[0];
        if (c === 0) {
            n.style.display = "";
            h.removeAttribute("hf");
            return
        }
        var g = n.cells.length - 1;
        var d = m.rows.length - 1;
        h.removeAttribute("hf");
        var l = h.getAttribute("rh");
        h.style.height = l;
        for (var a = 1; a <= g; ++a) {
            h = this._getRowCell(n, a - 1, c);
            h.removeAttribute("rhc");
            this.util.convertCSSFromClass2Style(h);
            if (a == 1) {
                h.className = "titleCell"
            } else {
                h.className = "gridCell"
            }
            var b = h.getAttribute("st");
            if (b) {
                h.removeAttribute("st");
                DNA.engine.DomUtil.setInnerText(h, b)
            }
        }
    },
    setColumnHidden: function(c, a) {
        if (!this.checkRendered(true)) {
            return
        }
        if (c < 0 || c >= this.columnCount) {
            return
        }
        if (a) {
            this._hideColumn(c)
        } else {
            this._displayColumn(c)
        }
        var b = this.getCurrentSelection();
        if (b) {
            b.reBuild(true)
        }
        this._resizeWraplineDivHeightInMergeCells()
    },
    _hideColumn: function(b) {
        var a = this._getCellDom(b, -1, this.contentTable);
        if (a.getAttribute("hf")) {
            return
        }
        this._hideCol4Tab(this.contentTable, b);
        this._hideCol4Tab(this.hrTable, b);
        if (b == 0 || (this.hColCount != 0 && b < this.hColCount)) {
            this._hideCol4Tab(this.hcTable, b);
            this._hideCol4Tab(this.hltTab, b)
        }
        this._ajustLockedSections();
        this.hiddenCols.push(b);
        this._reBoundCurCell();
        this._adjustScroll();
        for (var d = 0; d < this.getRowCount(); d++) {
            var g = this.getCell(b, d);
            if (g && g.td.getAttribute("wl")) {
                g.td.firstChild.style.height = "0px"
            }
        }
    },
    _hideCol4Tab: function(h, c) {
        var a = this._getCellDom(c, -1, h);
        var g = this.util.getStyle(a, "width");
        a.setAttribute("hf", 1);
        a.setAttribute("rw", g);
        a.style.width = "0px";
        var b = h.rows.length - 1;
        for (var d = 1; d <= b; ++d) {
            a = this._getCellDom(c, d - 1, h);
            this.util.convertCSSFromClass2Style(a);
            if (d == 1 || c == 0) {
                a.className = "mtitleCell"
            } else {
                a.className = "mgridCell"
            }
        }
    },
    _displayColumn: function(b) {
        var a = this._getCellDom(b, -1, this.contentTable);
        if (!a.getAttribute("hf")) {
            return
        }
        this._displayCol4Tab(this.contentTable, b);
        this._displayCol4Tab(this.hrTable, b);
        if (b === 0 || (this.hColCount != 0 && b < this.hColCount)) {
            this._displayCol4Tab(this.hcTable, b);
            this._displayCol4Tab(this.hltTab, b)
        }
        this._ajustLockedSections();
        this.hiddenCols.remove(b);
        this._reBoundCurCell();
        for (var d = 0; d < this.getRowCount(); d++) {
            var g = this.getCell(b, d);
            if (g && g.td.getAttribute("wl")) {
                g._resizeWraplineDiv()
            }
        }
    },
    _displayCol4Tab: function(h, c) {
        var a = this._getCellDom(c, -1, h);
        if (!a.getAttribute("hf")) {
            return
        }
        var g = a.getAttribute("rw");
        a.style.width = g;
        a.removeAttribute("hf");
        a.removeAttribute("rw");
        var b = h.rows.length - 1;
        for (var d = 1; d <= b; ++d) {
            a = this._getCellDom(c, d - 1, h);
            this.util.convertCSSFromClass2Style(a);
            if (d == 1 || c == 0) {
                a.className = "titleCell"
            } else {
                a.className = "gridCell"
            }
        }
    },
    getColHidden: function(b) {
        if (!this.checkRendered(true)) {
            return false
        }
        var a = this._getCellDom(b, -1, this.contentTable);
        if (!a.getAttribute("hf")) {
            return false
        }
        return true
    },
    getRowHidden: function(b) {
        if (!this.checkRendered(true)) {
            return false
        }
        var a = this._getCellDom(-1, b, this.contentTable);
        if (!a.getAttribute("hf")) {
            return false
        }
        return true
    },
    setColAutoWidth: function(b, c) {
        if (!this.checkRendered(true)) {
            return false
        }
        var a = this._getCellDom(b, -1, this.contentTable);
        if (c) {
            a.setAttribute("aw", 1)
        } else {
            a.removeAttribute("aw")
        }
    },
    setRowAutoHeight: function(c, b) {
        if (!this.checkRendered(true)) {
            return false
        }
        var a = this._getCellDom(-1, c, this.contentTable);
        if (b) {
            a.setAttribute("aw", 1)
        } else {
            a.removeAttribute("aw")
        }
    },
    setInitProperties: function(m) {
        if (!this.checkRendered(true)) {
            return false
        }
        DNA.widget.CssStyleFinder.updateCss(this);
        this.columnCount = m.colCount;
        this.rowCount = m.rowCount;
        this.hColCount = m.headerColCount;
        this.hRowCount = m.headerRowCount;
        var h = m.currentCell;
        if (h) {
            this.setCurrentCellNoFire(h, null , null , null , null , DNA.widget.JWTGrid2.SETCURRENTCELLCAUSE_PROGRAM)
        }
        var d = m.cccf;
        if (d) {
            var c = d.split(",");
            this.currentCellColorFocused = c[0];
            this.currentCellColorUnFocused = c[1]
        } else {
            this.currentCellColorFocused = null ;
            this.currentCellColorUnFocused = null 
        }
        this.updateCurrentCellColor();
        var b = m.selections;
        if (b) {
            this.setSelections(b)
        }
        var l = m.tDivOffset;
        if (l) {
            this.setScrollTop(l.x);
            this.setScrollLeft(l.y);
            this._handleScroll()
        }
        var g = m.currentCellOffset;
        if (g) {
            this._setCurrentCellOffset(g)
        }
        var a = m.formatters;
        if (a) {
            this._addFormatters(a)
        }
        this.replacing = false;
        this.ignoreHidden = m.ignoreHidden ? true : false;
        this.mergeRectCache = m.mergeRects || [];
        if (DNA.engine.Client.isFF()) {
            this._ajustLockedSections()
        }
        this.computeColsGrab()
    },
    rebuildCellControls: function(a) {
        if (!this.checkRendered(true)) {
            return false
        }
        if (a.controlCells) {
            if (this.isVisible()) {
                this.controlCells = a.controlCells;
                this._showControls()
            } else {
                this.controlCellsCachedForIframe = a.controlCells;
                if (this.getInitData().controlCells) {
                    delete this.getInitData().controlCells
                }
                if (this.getData("add_control")) {
                    this.removeData("add_control")
                }
            }
        }
    },
    setGridOption: function(a) {
        this.gridOption = a;
        if ((a & DNA.widget.JWTGrid.EDIT_MODE_MASK) == DNA.widget.JWTGrid.EDIT_MODE_READONLY) {
            this.closeEditor();
            this._hideFace()
        }
    },
    setDefEditor: function(a) {
        this.defEditorId = a
    },
    setColumnCount: function(a) {
        if (a > this.columnCount) {
            this.insertColumns(this.columnCount, a - this.columnCount, this.columnCount - 1);
            return
        }
        if (a < this.columnCount) {
            this.deleteColumns(a, this.columnCount - a)
        }
    },
    setRowCount: function(a) {
        if (a > this.rowCount) {
            this.insertRows(this.rowCount, a - this.rowCount, this.rowCount - 1);
            return
        }
        if (a < this.rowCount) {
            this.deleteRows(a, this.rowCount - a)
        }
    },
    getColumnCount: function() {
        return this.columnCount
    },
    getRowCount: function() {
        return this.rowCount
    },
    setHeaderColumnCount: function(a) {
        this._buildHeaderCols(a)
    },
    setHeaderRowCount: function(a) {
        this._buildHeaderRows(a)
    },
    getHeaderColumnCount: function() {
        return this.hColCount
    },
    getHeaderRowCount: function() {
        return this.hRowCount
    },
    setFooterColumnCount: function(a) {
        this._buildFooterCols(a)
    },
    setFooterRowCount: function(a) {
        this._buildFooterRows(a)
    },
    getFooterColumnCount: function() {
        return this.fColCount
    },
    getFooterRowCount: function() {
        return this.fRowCount
    },
    setEditMode: function(a) {
        this.gridOption &= ~DNA.widget.JWTGrid2.EDIT_MODE_MASK;
        this.gridOption |= (a & DNA.widget.JWTGrid2.EDIT_MODE_MASK)
    },
    getEditMode: function() {
        return this.gridOption & DNA.widget.JWTGrid2.EDIT_MODE_MASK
    },
    setSelectionMode: function(a) {
        var b = this.getSelectionMode();
        if (a != b) {
            this.gridOption &= ~DNA.widget.JWTGrid2.SELECTION_MODE_MASK;
            this.gridOption |= (a & DNA.widget.JWTGrid2.SELECTION_MODE_MASK);
            this._clearSelection()
        }
    },
    getSelectionMode: function() {
        return this.gridOption & DNA.widget.JWTGrid2.SELECTION_MODE_MASK
    },
    setRowResizeEnable: function(a) {
        if (a) {
            this.gridOption |= DNA.widget.JWTGrid2.ROW_RESIZE_MASK
        } else {
            this.gridOption &= ~DNA.widget.JWTGrid2.ROW_RESIZE_MASK
        }
    },
    getRowResizeEnable: function() {
        return (this.gridOption & DNA.widget.JWTGrid2.ROW_RESIZE_MASK) != 0
    },
    setColResizeEnable: function(a) {
        if (a) {
            this.gridOption |= DNA.widget.JWTGrid2.COL_RESIZE_MASK
        } else {
            this.gridOption &= ~DNA.widget.JWTGrid2.COL_RESIZE_MASK
        }
    },
    getColResizeEnable: function() {
        return (this.gridOption & DNA.widget.JWTGrid2.COL_RESIZE_MASK) != 0
    },
    setRowSelectEnabled: function(a) {
        if (a) {
            this.gridOption |= DNA.widget.JWTGrid2.ROW_SELECT_MASK
        } else {
            this.gridOption &= ~DNA.widget.JWTGrid2.ROW_SELECT_MASK
        }
    },
    getRowSelectEnabled: function() {
        return (this.gridOption & DNA.widget.JWTGrid2.ROW_SELECT_MASK) != 0
    },
    setRowFreeResizeEnabled: function(a) {
        if (a) {
            this.gridOption |= DNA.widget.JWTGrid2.ROW_FREE_RESIZE_MASK
        } else {
            this.gridOption &= ~DNA.widget.JWTGrid2.ROW_FREE_RESIZE_MASK
        }
    },
    getRowFreeResizeEnabled: function() {
        return (this.gridOption & DNA.widget.JWTGrid2.ROW_FREE_RESIZE_MASK) != 0
    },
    setColFreeResizeEnabled: function(a) {
        if (a) {
            this.gridOption |= DNA.widget.JWTGrid2.COL_FREE_RESIZE_MASK
        } else {
            this.gridOption &= ~DNA.widget.JWTGrid2.COL_FREE_RESIZE_MASK
        }
    },
    getColFreeResizeEnabled: function() {
        return (this.gridOption & DNA.widget.JWTGrid2.COL_FREE_RESIZE_MASK) != 0
    },
    setColSelectEnabled: function(a) {
        if (a) {
            this.gridOption |= DNA.widget.JWTGrid2.COL_SELECT_MASK
        } else {
            this.gridOption &= ~DNA.widget.JWTGrid2.COL_SELECT_MASK
        }
    },
    getColSelectEnabled: function() {
        return (this.gridOption & DNA.widget.JWTGrid2.COL_SELECT_MASK) != 0
    },
    setEnterNext: function(a) {
        this.gridOption &= ~DNA.widget.JWTGrid2.ENTER_NEXT_MASK;
        this.gridOption |= (a & DNA.widget.JWTGrid2.ENTER_NEXT_MASK)
    },
    getEnterNext: function() {
        return this.gridOption & DNA.widget.JWTGrid2.ENTER_NEXT_MASK
    },
    getRowResizeIndex: function() {
        return this.rowResizeIndex
    },
    getColResizeIndex: function() {
        return this.colResizeIndex
    },
    setMinColWidth: function(a) {
        if (a >= 0) {
            this.minColWidth = a
        } else {
            alert("�е���С��Ȳ���С��0")
        }
    },
    getMinColWidth: function() {
        return this.minColWidth
    },
    setMinRowHeight: function(a) {
        if (height >= 0) {
            this.minRowHeight = a
        } else {
            alert("�е���С�߶Ȳ���С��0")
        }
    },
    getMinRowHeight: function() {
        return this.minRowHeight
    },
    setDefColWidth: function(a) {
        if (a >= 0) {
            this.defColWidth = a
        } else {
            alert("�е�Ĭ�Ͽ�Ȳ���С��0")
        }
    },
    getDefColWidth: function(a) {
        return this.defColWidth = a
    },
    setDefRowHeight: function(a) {
        if (a >= 0) {
            this.defRowHeight = a
        } else {
            alert("�е�Ĭ�ϸ߶Ȳ���С��0")
        }
    },
    getDefRowHeight: function(a) {
        return this.defRowHeight
    },
    setRowBackground: function(b, a) {
        if (b < this.hRowCount) {
            this.hrTable.rows[b + 1].bgColor = a;
            this.hrtTab.rows[b + 1].bgColor = a;
            this.hltTab.rows[b + 1].bgColor = a
        } else {
            if (this.rowCount - b < this.fRowCount) {
                this.frTable.rows[b + 1].bgColor = a;
                this.frbTab.rows[b + 1].bgColor = a;
                this.flbTab.rows[b + 1].bgColor = a
            } else {
                this.contentTable.rows[b + 1].bgColor = a;
                this.fcTable.rows[b + 1].bgColor = a;
                this.hcTable.rows[b + 1].bgColor = a
            }
        }
    },
    _setCurrentCellOffset: function(a) {
        if (!a) {
            return
        }
        var g = this.getCurrentCell();
        if (!g) {
            return
        }
        var b = this._getCellDom(g.x, g.y, this.contentTable);
        var d = b.offsetLeft;
        var c = b.offsetTop;
        this.tDiv.scrollLeft = d - a.x;
        this.tDiv.scrollTop = c - a.y;
        this._handleScroll()
    },
    setCurrentCell: function(c, b, m, g, d, h) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = null ;
        if (c) {
            if (!this.util.isDataCol(c.x) || !this.util.isDataRow(c.y)) {
                return
            }
            try {
                a = new DNA.widget.AbstractGridCell(this,this.contentTable,c.x,c.y,false)
            } catch (l) {
                a = null 
            }
        }
        this._setCurrentCell(a, null , null , g, d, h);
        this.fireEvent("currentCellOffsetChanged", [this])
    },
    setCurrentCellNoFire: function(c, b, m, g, d, h) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = null ;
        if (c) {
            if (!this.util.isDataCol(c.x) || !this.util.isDataRow(c.y)) {
                return
            }
            try {
                a = new DNA.widget.AbstractGridCell(this,this.contentTable,c.x,c.y,false)
            } catch (l) {
                a = null 
            }
        }
        this._setCurrentCellNoFireChanging(a, null , null , g, d, true, h)
    },
    _setCurrentCell: function(n, l, h, d, a, c) {
        if (!this.checkRendered(true)) {
            return
        }
        this._stopDbClick = false;
        if (!n) {
            this._hideInputProxy();
            if (this.getCurrentCell()) {
                var b = {
                    widget: this,
                    target: null ,
                    lastCurrent: this.getCurrentCell(),
                    doit: true
                };
                this.fireCurrentCellChangingEvent(b);
                if (!b.doit) {
                    this._stopDbClick = true;
                    return
                }
                this.closeEditor(d);
                this._hideFace();
                this._drawCurrentCellBack();
                this.currentCell = null ;
                this.currentCol = -1;
                this.currentRow = -1
            }
            return
        }
        var m = n.getColIndex();
        var g = n.getRowIndex();
        if (this.currentCell) {
            if (this.currentCell.getColIndex() == m && this.currentCell.getRowIndex() == g) {
                this._drawCurrentCellBack();
                this._drawCurrentCell(n);
                return
            }
        }
        var b = {
            widget: this,
            target: new DNA.widget.Point(m,g),
            lastCurrent: this.getCurrentCell(),
            doit: true
        };
        this.fireCurrentCellChangingEvent(b);
        if (!b.doit) {
            this._stopDbClick = true;
            return
        }
        this._setCurrentCellNoFireChanging(n, l, h, d, a, false, c)
    },
    _setCurrentCellNoFireChanging: function(n, l, h, c, a, o, b) {
        if (!n) {
            this._hideInputProxy();
            if (this.getCurrentCell()) {
                this.closeEditor(c);
                this._hideFace();
                this._drawCurrentCellBack();
                this.currentCell = null ;
                this.currentCol = -1;
                this.currentRow = -1
            }
            return
        }
        var m = n.getColIndex();
        var g = n.getRowIndex();
        if (this.currentCell) {
            if (this.currentCell.getColIndex() == m && this.currentCell.getRowIndex() == g) {
                this._drawCurrentCellBack();
                this._drawCurrentCell(n);
                return
            }
        }
        this.closeEditor(c);
        this._hideFace();
        this._drawCurrentCellBack();
        this.currentCell = n;
        if (l) {
            this.currentCol = l
        } else {
            this.currentCol = n.getColIndex()
        }
        if (h) {
            this.currentRow = h
        } else {
            this.currentRow = n.getRowIndex()
        }
        this.focus();
        this._focusInputProxy();
        this._drawCurrentCell(n);
        this._scrollToCol(this.currentCol);
        this._scrollToRow(this.currentRow);
        this.updateCurrentCellColor();
        if ((this.getEditMode() != DNA.widget.JWTGrid.EDIT_MODE_READONLY) && this.util.isCellEditable(m, g)) {
            this._showFace()
        }
        if (o) {
            var d = function(p, q) {
                this.fireEvent("currentCellChangedByServer", [this, p, q])
            }
            ;
            DNA.adapter.browserPage.addFinalTask([d, this, [a, b]])
        } else {
            this.fireEvent("currentCellChanged", [this, a, b])
        }
    },
    _hideFace: function() {
        if (this.curFace) {
            this.tDiv.appendChild(this.curFace);
            this.curFace.style.display = "none";
            this.curFace = null 
        }
    },
    _showFace: function() {
        if (this.currentCell) {
            var b = this.currentCell.getEditorFace();
            if (b == 1) {
                this.curFace = this.btnFace
            } else {
                if (b == 2) {
                    this.curFace = this.listFace
                }
            }
            if (this.curFace) {
                var a = this.currentCell.getColIndex();
                var c = this.currentCell.getRowIndex();
                if (a < this.hColCount && c < this.hRowCount) {
                    this.hltDiv.appendChild(this.curFace)
                } else {
                    if (a < this.hColCount) {
                        this.hcDiv.appendChild(this.curFace)
                    } else {
                        if (c < this.hRowCount) {
                            this.hrDiv.appendChild(this.curFace)
                        } else {
                            this.tDiv.appendChild(this.curFace)
                        }
                    }
                }
                this.curFace.style.display = "";
                this._reBoundFace()
            }
        }
    },
    _reBoundFace: function() {
        if (this.currentCell && this.curFace) {
            var b = this.currentCell.td.offsetLeft;
            var d = this.currentCell.td.offsetTop;
            var c = this.currentCell.td.offsetWidth;
            var a = this.currentCell.td.offsetHeight;
            this.curFace.style.left = b + c - 19 + "px";
            this.curFace.style.top = d + "px";
            this.curFace.style.height = Math.max(0, a - 2) + "px";
            this.curFace.style.display = "none";
            this.curFace.style.display = ""
        }
    },
    _focusInputProxy: function() {
        if (!DNA.engine.Client.isIOS()) {
            if (!this.checkRendered(false)) {
                return
            }
            if (this.util.isCellEditable(this.currentCol, this.currentRow)) {
                this.placeInputProxy()
            } else {
                DNA.engine.DomUtil.setLeftTop(this.inputProxy, 0, 0)
            }
        }
    },
    _blurInputProxy: function() {
        if (!this.checkRendered(false)) {
            return
        }
        try {
            this.inputProxy.blur()
        } catch (a) {}
    },
    _hideInputProxy: function() {
        DNA.engine.DomUtil.setLeftTop(this.inputProxy, 0, 0);
        this.inputProxy.style.width = "1px"
    },
    _reboundInputProxy: function() {
        if (!this.isVisible()) {
            return
        }
        if (this.currentCell) {
            var c = this.currentCell.td.offsetLeft;
            var b = this.currentCell.td.offsetTop;
            DNA.engine.DomUtil.setLeftTop(this.inputProxy, c, b);
            var a = this.currentCell.td.offsetWidth - 5;
            if (a < 1) {
                a = 1
            }
            this.inputProxy.style.width = a + "px"
        }
    },
    placeInputProxy: function() {
        if (!this.isVisible()) {
            return
        }
        if (this.currentCell) {
            var d = this.currentCell.td.offsetLeft;
            var c = this.currentCell.td.offsetTop;
            if (this.currentCell.getColIndex() < this.getHeaderColumnCount()) {
                d += this.tDiv.scrollLeft
            }
            if (this.currentCell.getRowIndex() < this.getHeaderRowCount()) {
                c += this.tDiv.scrollTop
            }
            DNA.engine.DomUtil.setLeftTop(this.inputProxy, d, c);
            var a = this.currentCell.td.offsetWidth - 5;
            if (a < 1) {
                a = 1
            }
            this.inputProxy.style.width = a + "px";
            try {
                this.inputProxy.focus();
                if (DNA.engine.Client.isIE()) {
                    this.inputProxy.select()
                }
            } catch (b) {}
        }
    },
    _reBoundCurCell: function() {
        if (this.currentCell) {
            var g = this.currentCell.td.offsetTop - 1;
            var d = this.currentCell.td.offsetLeft - 1;
            var b = this.currentCell.td.offsetWidth;
            var a = this.currentCell.td.offsetHeight;
            DNA.engine.DomUtil.setLeftTop(this.curLeft, d, g);
            DNA.engine.DomUtil.setHeight(this.curLeft, a);
            DNA.engine.DomUtil.setLeftTop(this.curTop, d, g);
            DNA.engine.DomUtil.setWidth(this.curTop, b);
            DNA.engine.DomUtil.setLeftTop(this.curRight, d + b, g);
            DNA.engine.DomUtil.setHeight(this.curRight, a);
            DNA.engine.DomUtil.setLeftTop(this.curBottom, d, g + a);
            DNA.engine.DomUtil.setWidth(this.curBottom, b);
            this.reBoundEditor();
            if (this.showBorder) {
                var h = d + b - 2;
                var c = g + a - 2;
                if (DNA.engine.Client.isIE() && !DNA.engine.Client.isStrict()) {
                    h -= 2;
                    c -= 2
                }
                DNA.engine.DomUtil.setLeftTop(this.dragPointDiv, h, c);
                DNA.engine.DomUtil.setLeftTop(this.selBorderLeft, d, g);
                DNA.engine.DomUtil.setHeight(this.selBorderLeft, a);
                DNA.engine.DomUtil.setLeftTop(this.selBorderTop, d, g);
                DNA.engine.DomUtil.setWidth(this.selBorderTop, b);
                DNA.engine.DomUtil.setLeftTop(this.selBorderRight, d + b, g);
                DNA.engine.DomUtil.setHeight(this.selBorderRight, a);
                DNA.engine.DomUtil.setLeftTop(this.selBorderBottom, d, g + a);
                DNA.engine.DomUtil.setWidth(this.selBorderBottom, b)
            }
        }
        this._reboundInputProxy()
    },
    reBoundEditor: function() {
        if (this.activeEditor) {
            this.activeEditor.reBoundCtr()
        }
    },
    getColVisible: function(b) {
        var a = this._getCellDom(b, -1, this.contentTable);
        if (!a) {
            return false
        }
        if (a.getAttribute("hf")) {
            return false
        }
        return true
    },
    _drawCurrentCell: function(n) {
        if (this.getCurBorderHiddden()) {
            return
        }
        if (this.currentCol < this.hColCount && this.currentRow < this.hRowCount) {
            this.curLeft = this.hltDiv.childNodes[1];
            this.curRight = this.hltDiv.childNodes[2];
            this.curTop = this.hltDiv.childNodes[3];
            this.curBottom = this.hltDiv.childNodes[4];
            this.dragPointDiv = this.hltDiv.childNodes[5];
            this.selBorderLeft = this.hltDiv.childNodes[6];
            this.selBorderRight = this.hltDiv.childNodes[7];
            this.selBorderTop = this.hltDiv.childNodes[8];
            this.selBorderBottom = this.hltDiv.childNodes[9]
        } else {
            if (this.currentCol < this.hColCount && this.fRowCount > 0 && this.currentRow > (this.rowCount - this.fRowCount - 1)) {
                this.curLeft = this.flbDiv.childNodes[1];
                this.curRight = this.flbDiv.childNodes[2];
                this.curTop = this.flbDiv.childNodes[3];
                this.curBottom = this.flbDiv.childNodes[4];
                this.dragPointDiv = this.flbDiv.childNodes[5];
                this.selBorderLeft = this.flbDiv.childNodes[6];
                this.selBorderRight = this.flbDiv.childNodes[7];
                this.selBorderTop = this.flbDiv.childNodes[8];
                this.selBorderBottom = this.flbDiv.childNodes[9]
            } else {
                if (this.currentCol < this.hColCount) {
                    this.curLeft = this.hcDiv.childNodes[1];
                    this.curRight = this.hcDiv.childNodes[2];
                    this.curTop = this.hcDiv.childNodes[3];
                    this.curBottom = this.hcDiv.childNodes[4];
                    this.dragPointDiv = this.hcDiv.childNodes[5];
                    this.selBorderLeft = this.hcDiv.childNodes[6];
                    this.selBorderRight = this.hcDiv.childNodes[7];
                    this.selBorderTop = this.hcDiv.childNodes[8];
                    this.selBorderBottom = this.hcDiv.childNodes[9]
                } else {
                    if (this.fRowCount > 0 && this.currentRow > (this.rowCount - this.fRowCount - 1)) {
                        this.curLeft = this.frDiv.childNodes[1];
                        this.curRight = this.frDiv.childNodes[2];
                        this.curTop = this.frDiv.childNodes[3];
                        this.curBottom = this.frDiv.childNodes[4];
                        this.dragPointDiv = this.frDiv.childNodes[5];
                        this.selBorderLeft = this.frDiv.childNodes[6];
                        this.selBorderRight = this.frDiv.childNodes[7];
                        this.selBorderTop = this.frDiv.childNodes[8];
                        this.selBorderBottom = this.frDiv.childNodes[9]
                    } else {
                        if (this.currentRow < this.hRowCount) {
                            this.curLeft = this.hrDiv.childNodes[1];
                            this.curRight = this.hrDiv.childNodes[2];
                            this.curTop = this.hrDiv.childNodes[3];
                            this.curBottom = this.hrDiv.childNodes[4];
                            this.dragPointDiv = this.hrDiv.childNodes[5];
                            this.selBorderLeft = this.hrDiv.childNodes[6];
                            this.selBorderRight = this.hrDiv.childNodes[7];
                            this.selBorderTop = this.hrDiv.childNodes[8];
                            this.selBorderBottom = this.hrDiv.childNodes[9]
                        } else {
                            this.curLeft = this.mCurLeft;
                            this.curRight = this.mCurRight;
                            this.curTop = this.mCurTop;
                            this.curBottom = this.mCurBottom;
                            this.dragPointDiv = this.mDragPointDiv;
                            this.selBorderLeft = this.mSelBorderLeft;
                            this.selBorderRight = this.mSelBorderRight;
                            this.selBorderTop = this.mSelBorderTop;
                            this.selBorderBottom = this.mSelBorderBottom
                        }
                    }
                }
            }
        }
        this.curLeft.style.display = "block";
        this.curRight.style.display = "block";
        this.curTop.style.display = "block";
        this.curBottom.style.display = "block";
        if (this.showBorder) {
            this.selBorderLeft.style.display = "block";
            this.selBorderRight.style.display = "block";
            this.selBorderTop.style.display = "block";
            this.selBorderBottom.style.display = "block";
            this.dragPointDiv.style.display = "block";
            this.dragPointDiv.style.position = "absolute"
        }
        var l = n.td.offsetTop - 1;
        var o = n.td.offsetHeight;
        if (this.fRowCount > 0 && this.currentRow > (this.rowCount - this.fRowCount - 1)) {
            l = l - this.frDiv.offsetTop + 1;
            o -= 1
        }
        var d = n.td.offsetLeft - 1;
        var b = n.td.offsetWidth;
        if (this.util.getUpRow(n.getRowIndex()) <= this.hRowCount) {
            l += 1;
            o -= 1
        }
        if (this.util.getLeftCol(n.getColIndex()) <= this.hColCount) {
            d += 1;
            b -= 1
        }
        DNA.engine.DomUtil.setLeftTop(this.curLeft, d, l);
        DNA.engine.DomUtil.setHeight(this.curLeft, o);
        DNA.engine.DomUtil.setLeftTop(this.curTop, d, l);
        DNA.engine.DomUtil.setWidth(this.curTop, b);
        DNA.engine.DomUtil.setLeftTop(this.curRight, d + b, l);
        DNA.engine.DomUtil.setHeight(this.curRight, o);
        DNA.engine.DomUtil.setLeftTop(this.curBottom, d, l + o);
        DNA.engine.DomUtil.setWidth(this.curBottom, b);
        if (this.fRowCount > 0 && this.currentRow > (this.rowCount - this.fRowCount - 1)) {
            DNA.engine.DomUtil.setLeftTop(this.curLeft, d, l + 1);
            DNA.engine.DomUtil.setLeftTop(this.curTop, d, l + 1);
            DNA.engine.DomUtil.setLeftTop(this.curRight, d + b, l + 1);
            DNA.engine.DomUtil.setLeftTop(this.curBottom, d, l + o + 1)
        } else {
            DNA.engine.DomUtil.setLeftTop(this.curLeft, d, l);
            DNA.engine.DomUtil.setLeftTop(this.curTop, d, l);
            DNA.engine.DomUtil.setLeftTop(this.curRight, d + b, l);
            DNA.engine.DomUtil.setLeftTop(this.curBottom, d, l + o)
        }
        if (this.showBorder) {
            var c = d + b - 2;
            var g = l + o - 2;
            DNA.engine.DomUtil.setLeftTop(this.dragPointDiv, c, g);
            DNA.engine.DomUtil.setLeftTop(this.selBorderLeft, d, l);
            DNA.engine.DomUtil.setHeight(this.selBorderLeft, o);
            DNA.engine.DomUtil.setLeftTop(this.selBorderTop, d, l);
            DNA.engine.DomUtil.setWidth(this.selBorderTop, b);
            DNA.engine.DomUtil.setLeftTop(this.selBorderRight, d + b, l);
            DNA.engine.DomUtil.setHeight(this.selBorderRight, o);
            DNA.engine.DomUtil.setLeftTop(this.selBorderBottom, d, l + o);
            DNA.engine.DomUtil.setWidth(this.selBorderBottom, b)
        }
        var d = n.getColIndex();
        var l = n.getRowIndex();
        var m = d + n.getColSpan() - 1;
        var a = l + n.getRowSpan() - 1;
        var h = {
            x: d,
            y: l,
            width: m,
            height: a
        };
        this._internalDrawTitle(h, false, true)
    },
    _drawCurrentCellBack: function() {
        if (this.getCurBorderHiddden()) {
            return
        }
        if (this.currentCell) {
            this.curLeft.style.display = "none";
            this.curRight.style.display = "none";
            this.curTop.style.display = "none";
            this.curBottom.style.display = "none";
            this.dragPointDiv.style.display = "none";
            if (this.showBorder) {
                this._hideSelectionBorder()
            }
            if (!this._currentCellInSelection()) {
                var g = this.currentCell.getColIndex();
                var d = this.currentCell.getRowIndex();
                var b = g + this.currentCell.getColSpan() - 1;
                var a = d + this.currentCell.getRowSpan() - 1;
                var c = {
                    x: g,
                    y: d,
                    width: b,
                    height: a
                };
                this._internalDrawTitle(c, false, false)
            } else {
                if (this.selectionAreas[0]) {
                    this.selectionAreas[0].hideSelectionBorders()
                }
            }
        }
    },
    _currentCellInSelection: function() {
        if (!this.currentCell) {
            return false
        }
        if (!this.selectionAreas || this.selectionAreas == 0) {
            return false
        }
        var c = {
            x: this.currentCell.getColIndex(),
            y: this.currentCell.getRowIndex()
        };
        for (var b = 0, a = this.selectionAreas.length; b < a; ++b) {
            if (this._isPointInRect(c, this.selectionAreas[b].getRange())) {
                return true
            }
        }
        return false
    },
    _isPointInRect: function(b, a) {
        if (b.x >= a.x && b.x < a.x + a.width && b.y >= a.y && b.y < a.y + a.height) {
            return true
        }
        return false
    },
    _hideSelectionBorder: function() {
        this.selBorderLeft.style.display = "none";
        this.selBorderRight.style.display = "none";
        this.selBorderTop.style.display = "none";
        this.selBorderBottom.style.display = "none";
        this.dragPointDiv.style.display = "none"
    },
    _showSelectionBorder: function() {
        if (this.showBorder) {
            this.selBorderLeft.style.display = "block";
            this.selBorderRight.style.display = "block";
            this.selBorderTop.style.display = "block";
            this.selBorderBottom.style.display = "block";
            this.dragPointDiv.style.display = "block"
        }
    },
    getCurrentCell: function() {
        if (this.currentCol == -1 || this.currentRow == -1) {
            return null 
        }
        return {
            x: this.currentCol,
            y: this.currentRow
        }
    },
    getCurrentCellOffset: function() {
        var l = this.getCurrentCell();
        if (!l) {
            return null 
        }
        var b = this._getCellDom(l.x, l.y, this.contentTable);
        var g = b.offsetLeft;
        var d = b.offsetTop;
        var h = this.tDiv.scrollLeft;
        var c = this.tDiv.scrollTop;
        var a = g - h;
        var m = d - c;
        return {
            x: a,
            y: m
        }
    },
    keyEnterDown: function(c) {
        var b = c.isShift();
        var a;
        switch (this.getEnterNext()) {
        case DNA.widget.JWTGrid2.ENTER_NEXT_RIGHT:
            if (b) {
                a = this.util.getLeftCell(this.currentCol, this.currentRow, null , true, true)
            } else {
                a = this.util.getRightCell(this.currentCol, this.currentRow, null , true, true)
            }
            break;
        case DNA.widget.JWTGrid2.ENTER_NEXT_DOWN:
            if (b) {
                a = this.util.getUpCell(this.currentCol, this.currentRow, null , true, true)
            } else {
                a = this.util.getDownCell(this.currentCol, this.currentRow, null , true, true)
            }
            break;
        case DNA.widget.JWTGrid2.ENTER_NEXT_LEFT:
            if (b) {
                a = this.util.getRightCell(this.currentCol, this.currentRow, null , true, true)
            } else {
                a = this.util.getLeftCell(this.currentCol, this.currentRow, null , true, true)
            }
            break;
        case DNA.widget.JWTGrid2.ENTER_NEXT_UP:
            if (b) {
                a = this.util.getDownCell(this.currentCol, this.currentRow, null , true, true)
            } else {
                a = this.util.getUpCell(this.currentCol, this.currentRow, null , true, true)
            }
            break
        }
        if (a) {
            this.selectCell(a.x, a.y)
        }
    },
    keydownNavigation: function(d) {
        var b = d.isShift();
        var c = d.isCtrl();
        var a = d.isAlt();
        if (!a) {
            var g = this.getSelectionMode();
            switch (g) {
            case DNA.widget.JWTGrid2.SELECTION_MODE_MULTI:
            case DNA.widget.JWTGrid2.SELECTION_MODE_SINGLE:
                if (this.selectionAreas.length === 0) {
                    if (this.getCurrentCell()) {
                        this.keyCellSelect(d)
                    }
                } else {
                    if (g === DNA.widget.JWTGrid2.SELECTION_MODE_SINGLE || !b) {
                        this.keyCellSelect(d)
                    } else {
                        if (!c) {
                            this.keyCellSelectWithShift(d)
                        } else {
                            this.keyCellSelectWithCtrlShift(d)
                        }
                    }
                }
                break;
            case DNA.widget.JWTGrid2.SELECTION_MODE_ROW:
                this.keyRowSelect(d);
                break
            }
        }
    },
    keydownPage: function(g) {
        var c = this.contentTable.offsetHeight;
        var b = DNA.engine.DomUtil.getClientSize(this.tDiv);
        var h = DNA.engine.DomUtil.getSize(this.frTable);
        var a = DNA.engine.DomUtil.getSize(this.hrTable);
        var d = {
            widget: this,
            srcEvent: g,
            doit: true
        };
        switch (g.getKeyCode()) {
        case DNA.JWTEvent.PAGEUP:
            this.firePagingEvent(d);
            if (!d.doit) {
                return
            }
            if (this.tDiv.scrollTop - b.height >= 0) {
                this.tDiv.scrollTop -= (b.height + a.height)
            } else {
                this.tDiv.scrollTop = 0
            }
            break;
        case DNA.JWTEvent.PAGEDOWN:
            this.firePagingEvent(d);
            if (!d.doit) {
                return
            }
            if (this.tDiv.scrollTop + b.height + b.height <= c) {
                this.tDiv.scrollTop += (b.height - h.height - 20)
            } else {
                this.tDiv.scrollTop = c - b.height
            }
            break
        }
    },
    selectFirstCell: function() {},
    keyCellSelect: function(d) {
        var c = d.isCtrl();
        var b = d.getKeyCode();
        var a;
        if (!c) {
            switch (b) {
            case DNA.JWTEvent.LEFT:
                a = this.util.getLeftCell(this.currentCol, this.currentRow, null , false, false);
                break;
            case DNA.JWTEvent.RIGHT:
                a = this.util.getRightCell(this.currentCol, this.currentRow, null , false, false);
                break;
            case DNA.JWTEvent.UP:
                a = this.util.getUpCell(this.currentCol, this.currentRow, null , false, false);
                break;
            case DNA.JWTEvent.DOWN:
                a = this.util.getDownCell(this.currentCol, this.currentRow, null , false, false);
                break;
            case DNA.JWTEvent.HOME:
                a = this.util.getRowFirstCell(this.currentRow, false, false);
                break;
            case DNA.JWTEvent.END:
                a = this.util.getRowLastCell(this.currentRow, false, false);
                break
            }
        } else {
            switch (b) {
            case DNA.JWTEvent.LEFT:
                a = this.util.getRowFirstCell(this.currentRow, false, false);
                break;
            case DNA.JWTEvent.RIGHT:
                a = this.util.getRowLastCell(this.currentRow, false, false);
                break;
            case DNA.JWTEvent.UP:
                a = this.util.getColFirstCell(this.currentCol, false, false);
                break;
            case DNA.JWTEvent.DOWN:
                a = this.util.getColLastCell(this.currentCol, false, false);
                break;
            case DNA.JWTEvent.HOME:
                a = this.util.getFirstCell(null , false);
                break;
            case DNA.JWTEvent.END:
                a = this.util.getLastCell(null , false);
                break
            }
        }
        if (a) {
            this.selectCell(a.x, a.y)
        }
    },
    selectCell: function(a, c) {
        if (this.util.isDataCell(a, c)) {
            this.setCurrentCell({
                x: a,
                y: c
            }, a, c, null , null , DNA.widget.JWTGrid2.SETCURRENTCELLCAUSE_KEY);
            this.clearSelection();
            var b = new DNA.widget.Grid2SelectionArea(this,{
                x: a,
                y: c,
                width: a,
                height: c
            },true,this.selectionDiv,true,this.showBorder);
            this._setSelection(b);
            this.fireEvent("selection", [this]);
            this.setCurrentSelection(b);
            this._showSelectionBorder()
        }
    },
    keyCellSelectWithShift: function(g) {
        var q = g.getKeyCode();
        var l = this.getCurrentSelection();
        if (!l) {
            return
        }
        var n = l.getRange();
        switch (q) {
        case DNA.JWTEvent.LEFT:
            var m = this.shrinkCellRect(n, DNA.widget.JWTGrid2.LEFT);
            if (this.rectEqual(m, n)) {
                return
            }
            if (m.x == this.currentCol) {
                l._setBound(m);
                l.reBuild(true)
            } else {
                var p = this.util.getLeftCol(m.x);
                if (this.util.isDataCol(p)) {
                    var o = new DNA.widget.Rectangle(p,m.y,l.width,m.height);
                    l._setBound(o);
                    l.reBuild(true)
                }
            }
            break;
        case DNA.JWTEvent.RIGHT:
            if (l.x < this.currentCol) {
                var a = this.util.getRightCol(l.x);
                if (this.util.isDataCol(a)) {
                    var o = new DNA.widget.Rectangle(a,l.y,l.width,l.height);
                    l._setBound(o);
                    l.reBuild(true)
                }
                return
            }
            var b = this.shrinkCellRect(n, DNA.widget.JWTGrid2.RIGHT);
            if (!b || this.rectEqual(b, n)) {
                return
            }
            l._setBound(b);
            l.reBuild(true);
            break;
        case DNA.JWTEvent.UP:
            if (l.y < this.currentRow) {
                var h = this.util.getUpRow(l.y);
                if (this.util.isDataRow(h)) {
                    var o = new DNA.widget.Rectangle(l.x,h,l.width,l.height);
                    l._setBound(o);
                    l.reBuild(true)
                }
            } else {
                var r = this.shrinkCellRect(n, DNA.widget.JWTGrid2.UP);
                if (this.rectEqual(r, n)) {
                    return
                }
                l._setBound(r);
                l.reBuild(true)
            }
            break;
        case DNA.JWTEvent.DOWN:
            if (l.y < this.currentRow) {
                var c = this.util.getDownRow(l.y);
                if (this.util.isDataRow(c)) {
                    var o = new DNA.widget.Rectangle(l.x,c,l.width,l.height);
                    l._setBound(o);
                    l.reBuild(true)
                }
                return
            }
            var d = this.shrinkCellRect(n, DNA.widget.JWTGrid2.DOWN);
            if (!d || this.rectEqual(d, n)) {
                return
            }
            l._setBound(d);
            l.reBuild(true);
            break;
        case DNA.JWTEvent.HOME:
            break;
        case DNA.JWTEvent.END:
            break
        }
        this._internalDrawTitle(l, false, true);
        this.fireEvent("selection", [this])
    },
    keyCellSelectWithCtrlShift: function(a) {},
    keyRowSelect: function(h) {
        var g = h.isCtrl();
        var d = h.getKeyCode();
        var a;
        if (!g) {
            switch (d) {
            case DNA.JWTEvent.LEFT:
                a = this.util.getLeftCell(this.currentCol, this.currentRow, null , false, false);
                break;
            case DNA.JWTEvent.RIGHT:
                a = this.util.getRightCell(this.currentCol, this.currentRow, null , false, false);
                break;
            case DNA.JWTEvent.UP:
                a = this.util.getUpCell(this.currentCol, this.currentRow, null , false, false);
                break;
            case DNA.JWTEvent.DOWN:
                a = this.util.getDownCell(this.currentCol, this.currentRow, null , false, false);
                break;
            case DNA.JWTEvent.HOME:
                a = this.util.getRowFirstCell(this.currentRow, false, false);
                break;
            case DNA.JWTEvent.END:
                a = this.util.getRowLastCell(this.currentRow, false, false);
                break
            }
        } else {
            switch (d) {
            case DNA.JWTEvent.LEFT:
                a = this.util.getRowFirstCell(this.currentRow, false, false);
                break;
            case DNA.JWTEvent.RIGHT:
                a = this.util.getRowLastCell(this.currentRow, false, false);
                break;
            case DNA.JWTEvent.UP:
                a = this.util.getColFirstCell(this.currentCol, false, false);
                break;
            case DNA.JWTEvent.DOWN:
                a = this.util.getColLastCell(this.currentCol, false, false);
                break;
            case DNA.JWTEvent.HOME:
                a = this.util.getFirstCell(null , false);
                break;
            case DNA.JWTEvent.END:
                a = this.util.getLastCell(null , false);
                break
            }
        }
        if (a) {
            if (d != DNA.JWTEvent.LEFT && d != DNA.JWTEvent.RIGHT) {
                this.clearSelection();
                var c = {
                    x: 1,
                    y: a.y,
                    width: this.columnCount - 1,
                    height: a.y
                };
                var b = new DNA.widget.Grid2SelectionArea(this,c,false,this.selectionDiv,false,this.showBorder);
                this._setSelection(b);
                this.fireEvent("selection", [this]);
                this.setCurrentSelection(b)
            }
            this.setCurrentCell(a, null , null , null , null , DNA.widget.JWTGrid2.SETCURRENTCELLCAUSE_KEY)
        }
    },
    shrinkCellRect: function(p, h) {
        var t;
        var u = new DNA.widget.Rectangle(p);
        switch (h) {
        case DNA.widget.JWTGrid2.LEFT:
            var d = p.width - 1;
            u.width--;
            while (d > 0) {
                var g = d;
                for (var l = p.y; l <= p.height; ++l) {
                    t = new DNA.widget.AbstractGridCell(this,this.contentTable,d,l,false);
                    var c = t.getColIndex() + t.getColSpan() - 1;
                    if (t.getColIndex() <= g) {
                        g = t.getColIndex() - 1
                    }
                    if (c > u.width) {
                        u.width = c
                    }
                }
                if (u.width == p.width) {
                    d = g;
                    u.width = g
                } else {
                    break
                }
            }
            break;
        case DNA.widget.JWTGrid2.RIGHT:
            var s = this.util.getRightCol(p.width);
            if (!this.util.isDataCol(s)) {
                return null 
            }
            u.width++;
            while (s > 0) {
                var m = s;
                for (var l = p.y; l <= p.height; ++l) {
                    t = new DNA.widget.AbstractGridCell(this,this.contentTable,s,l,false);
                    var c = t.getColIndex() + t.getColSpan() - 1;
                    if (c >= m) {
                        m = c + 1
                    }
                    if (c > u.width) {
                        u.width = c
                    }
                }
                if (u.width == p.width) {
                    s = m;
                    u.width = m
                } else {
                    break
                }
            }
            break;
        case DNA.widget.JWTGrid2.UP:
            var o = this.util.getUpRow(p.height);
            u.height--;
            while (o > 0) {
                var v = o;
                for (var l = p.x; l <= p.width; ++l) {
                    t = new DNA.widget.AbstractGridCell(this,this.contentTable,l,o,false);
                    var n = t.getRowIndex() + t.getRowSpan() - 1;
                    if (t.getRowIndex() <= v) {
                        v = t.getRowIndex() - 1
                    }
                    if (n < u.height) {
                        u.height = n
                    }
                }
                if (u.height == p.height) {
                    o = v;
                    u.height = v
                } else {
                    break
                }
            }
            break;
        case DNA.widget.JWTGrid2.DOWN:
            var a = this.util.getDownRow(p.height);
            if (!this.util.isDataRow(a)) {
                return null 
            }
            u.height++;
            while (a > 0) {
                var q = a;
                for (var l = p.x; l <= p.width; ++l) {
                    t = new DNA.widget.AbstractGridCell(this,this.contentTable,l,a,false);
                    var n = t.getRowIndex() + t.getRowSpan() - 1;
                    if (n >= q) {
                        q = n + 1
                    }
                    if (n > u.height) {
                        u.height = n
                    }
                }
                if (u.height == p.height) {
                    a = q;
                    u.height = q
                } else {
                    break
                }
            }
            break;
        default:
            break
        }
        return u
    },
    expandCellRect: function(g, c) {
        var b;
        var a = new DNA.widget.Rectangle(g);
        switch (c) {
        case DNA.widget.JWTGrid2.LEFT:
        case DNA.widget.JWTGrid2.RIGHT:
            var h = g.width - 1;
            a.width--;
            while (h > 0) {
                for (var d = g.y; x <= g.height; ++d) {
                    b = new DNA.widget.AbstractGridCell(this,this.contentTable,h,d,false)
                }
            }
            break;
        case DNA.widget.JWTGrid2.UP:
            break;
        case DNA.widget.JWTGrid2.DOWN:
            break;
        default:
            break
        }
    },
    rectEqual: function(b, a) {
        if (b.x === a.x && b.width === a.width && b.y === a.y && b.height === a.height) {
            return true
        }
        return false
    },
    allSelectStart: function(c) {
        if (!this.checkRendered(true)) {
            return
        }
        var b = {
            x: 1,
            y: 1,
            width: this.columnCount - 1,
            height: this.rowCount - 1
        };
        var a;
        a = new DNA.widget.Grid2SelectionArea(this,b,false);
        this._setSelection(a);
        this.setCurrentSelection(a)
    },
    rowSelectStart: function(g) {
        if (!this.checkRendered(true)) {
            return
        }
        this.selectionDiv.style.borderStyle = "none";
        var n = this.mouseCell.y;
        var h = g.isCtrl();
        var b = g.isShift();
        var a = {
            x: 1,
            y: n,
            width: this.columnCount - 1,
            height: n
        };
        var o;
        if ((!h && !b) || (h && b)) {
            o = new DNA.widget.Grid2SelectionArea(this,a,false,this.selectionDiv,false,this.showBorder);
            var c = this.util.getRowFirstCell(n, false, false);
            this.setCurrentCell(c, c.x, c.y, null , g.getButton());
            this._setSelection(o);
            this.setCurrentSelection(o)
        } else {
            if (h && !b) {
                o = new DNA.widget.Grid2SelectionArea(this,a,false,this.selectionDiv,false,this.showBorder);
                var c = this.util.getRowFirstCell(n, false, false);
                this.setCurrentCell(c, c.x, c.y, null , g.getButton());
                this._addSelection(o);
                this.setCurrentSelection(o)
            } else {
                if (this.currentRow == -1) {
                    this.currentRow = n
                }
                var d = Math.min(this.currentRow, n);
                var l = Math.max(this.currentRow, n);
                var m = {
                    x: 1,
                    y: d,
                    width: this.columnCount - 1,
                    height: l
                };
                if (!this.currentSelection) {
                    o = new DNA.widget.Grid2SelectionArea(this,m,false,null ,false,this.showBorder);
                    var c = this.util.getRowFirstCell(n, false, false);
                    this.setCurrentCell(c, c.x, c.y, null , g.getButton());
                    this._addSelection(o, false);
                    this.setCurrentSelection(o)
                } else {
                    this.currentSelection._setBound(m);
                    this.currentSelection.reBuild(true)
                }
            }
        }
    },
    colSelectStart: function(g) {
        if (!this.checkRendered(true)) {
            return
        }
        this.selectionDiv.style.borderStyle = "none";
        var n = this.mouseCell.x;
        var h = g.isCtrl();
        var b = g.isShift();
        var a = {
            x: n,
            y: 1,
            width: n,
            height: this.rowCount - 1
        };
        var m;
        if ((!h && !b) || (h && b)) {
            var c = this.util.getColFirstCell(n, false, false);
            this.setCurrentCell(c, c.x, c.y, null , g.getButton());
            m = new DNA.widget.Grid2SelectionArea(this,a,false,this.selectionDiv,false,this.showBorder);
            this._setSelection(m);
            this.setCurrentSelection(m)
        } else {
            if (h && !b) {
                var c = this.util.getColFirstCell(n, false, false);
                this.setCurrentCell(c, c.x, c.y, null , g.getButton());
                m = new DNA.widget.Grid2SelectionArea(this,a,false,this.selectionDiv,false,this.showBorder);
                this._addSelection(m);
                this.setCurrentSelection(m)
            } else {
                if (this.currentCol == -1) {
                    this.currentCol = n
                }
                var d = Math.min(this.currentCol, n);
                var o = Math.max(this.currentCol, n);
                var l = {
                    x: d,
                    y: 1,
                    width: o,
                    height: this.rowCount - 1
                };
                if (!this.currentSelection) {
                    m = new DNA.widget.Grid2SelectionArea(this,l,false,null ,false,this.showBorder);
                    var c = this.util.getColFirstCell(n, false, false);
                    this.setCurrentCell(c, c.x, c.y, null , g.getButton());
                    this._addSelection(m, false);
                    this.setCurrentSelection(m)
                } else {
                    this.currentSelection._setBound(l);
                    this.currentSelection.reBuild(true)
                }
            }
        }
    },
    checkSelRange: function(a) {
        if (a.x < 1 || a.width >= this.columnCount || a.x > a.width) {
            return false
        }
        if (a.y < 1 || a.height >= this.rowCount || a.y > a.height) {
            return false
        }
        return true
    },
    getSelections: function() {
        var b = this.selectionAreas.length;
        var a = new Array();
        for (var c = 0; c < b; ++c) {
            var d = this.selectionAreas[c];
            a.push({
                x: d.x,
                y: d.y,
                width: d.width - d.x + 1,
                height: d.height - d.y + 1
            })
        }
        return a
    },
    getSelection: function() {
        var a = new DNA.widget.Rectangle();
        if (this.currentSelection) {
            a.x = this.currentSelection.x;
            a.y = this.currentSelection.y;
            a.width = this.currentSelection.width - this.currentSelection.x + 1;
            a.height = this.currentSelection.height - this.currentSelection.y + 1
        }
        return a
    },
    addSelection: function(b) {
        if (!this.checkRendered(true) || !b || !this.checkSelRange(b)) {
            return
        }
        this.selectionDiv.style.width = "0px";
        var a = new DNA.widget.Grid2SelectionArea(this,b,true,null ,false,this.showBorder);
        this._internalDrawTitle(a, true, true);
        this.selectionAreas.push(a)
    },
    rebuildSelections: function() {
        for (var a = 0; a < this.selectionAreas.length; a++) {
            this.selectionAreas[a].reBuild(true)
        }
    },
    setSelection: function(b) {
        if (!this.checkRendered(true)) {
            return
        }
        this._clearSelection();
        if (!b || !this.checkSelRange(b)) {
            return
        }
        var a = new DNA.widget.Grid2SelectionArea(this,b,true,null ,false,this.showBorder);
        this._internalDrawTitle(a, true, true);
        this.selectionAreas.push(a)
    },
    setSelections: function(b) {
        if (!this.checkRendered(true)) {
            return
        }
        this._clearSelection();
        if (!b) {
            return
        }
        var a = b.length;
        for (var c = 0; c < a; ++c) {
            this.addSelection(b[c])
        }
    },
    _addSelection: function(a) {
        if (!this.checkRendered(true)) {
            return
        }
        this._internalDrawTitle(a, true, true);
        this.selectionAreas.push(a)
    },
    _setSelection: function(a) {
        if (!this.checkRendered(true)) {
            return
        }
        this._clearSelection();
        this._clearSelectionChangeArea();
        this.selectionDiv.style.borderStyle = "none";
        this._internalDrawTitle(a, true, true);
        this.selectionAreas.push(a)
    },
    _drawTitlesBack: function(g) {
        if (!this.checkRendered(true)) {
            return
        }
        var m = g.x;
        var d = g.width;
        var l = g.y;
        var b = g.height;
        var h = this._getRowDom(0, this.hrTable);
        var a;
        for (var c = m; c <= d; ++c) {
            a = this._getRowCell(h, c, 0);
            this.util.convertCSSFromClass2Style(a);
            a.style.backgroundColor = "";
            a.style.borderColor = "";
            if (c < this.hColCount) {
                a = this._getCellDom(c, 0, this.hltTab);
                this.util.convertCSSFromClass2Style(a);
                a.style.backgroundColor = "";
                a.style.borderColor = ""
            }
        }
        for (var c = l; c <= b; ++c) {
            a = this._getCellDom(0, c, this.hcTable);
            this.util.convertCSSFromClass2Style(a);
            a.style.backgroundColor = "";
            a.style.borderColor = "";
            if (c < this.hRowCount) {
                a = this._getCellDom(0, c, this.hltTab);
                this.util.convertCSSFromClass2Style(a);
                a.style.backgroundColor = "";
                a.style.borderColor = ""
            }
        }
    },
    _colInCurSel: function(b) {
        var a = this.selectionAreas.length;
        for (var c = 0; c < a; ++c) {
            var d = this.selectionAreas[c];
            if ((b >= d.x) && (b <= d.width)) {
                return true
            }
        }
        return false
    },
    _rowInCurSel: function(d) {
        var a = this.selectionAreas.length;
        for (var b = 0; b < a; ++b) {
            var c = this.selectionAreas[b];
            if ((d >= c.y) && (d <= c.height)) {
                return true
            }
        }
        return false
    },
    _clearSelTitle: function() {
        var a = this.selectionAreas.length;
        for (var b = 0; b < a; ++b) {
            var c = this.selectionAreas[b]
        }
    },
    clearSelection: function() {
        this._clearSelection()
    },
    _clearSelection: function(c) {
        this.currentSelection = null ;
        var a = this.selectionAreas.length;
        var d;
        for (var b = (a - 1); b >= 0; --b) {
            d = this.selectionAreas.pop();
            if (d) {
                this._internalDrawTitle(d, true, false);
                d.destroy()
            }
        }
        if (a) {
            this.selectionAreas.length = 0;
            if (c) {
                this.fireSelectionEvent()
            }
        }
    },
    _clearSelectionChangeArea: function() {
        if (this.selectionChangeArea) {
            this.selectionChangeArea.destroy();
            this.selectionChangeArea = null 
        }
    },
    _reComputeSelections: function(g, b) {
        var a = this.selectionAreas.length;
        var d;
        for (var c = 0; c < a; c++) {
            d = this.selectionAreas[c];
            if (d) {
                if (g != -1 && g <= d.height) {
                    d.setDivSize();
                    continue
                }
                if (b != -1 && b <= d.width) {
                    d.setDivSize()
                }
            }
        }
    },
    setCurrentSelection: function(a) {
        if (this.currentSelection) {
            if (!this.currentSelection.isBuild()) {
                this.currentSelection.reBuild(true)
            }
        }
        this.currentSelection = a
    },
    getCurrentSelection: function() {
        if (this.currentSelection) {
            return this.currentSelection
        } else {
            if (this.selectionAreas && this.selectionAreas.length > 0) {
                return this.selectionAreas[0]
            }
        }
    },
    mouseCellExpand: function(d) {
        var c = this.mouseCell;
        this.setCurrentCell(c, null , null , null , d.getButton());
        var b = {
            x: c.x,
            y: c.y,
            width: c.x,
            height: c.y
        };
        var a = new DNA.widget.Grid2SelectionArea(this,b,true,this.selectionDiv,true,this.showBorder);
        this._setSelection(a);
        this.setCurrentSelection(a);
        this._mouseCellExpand(d, c);
        this.fireEvent("selection", [this])
    },
    _mouseCellExpand: function(c, b) {
        var a = {
            widget: this,
            target: new DNA.widget.Point(b.x,b.y),
            lastCurrent: this.getCurrentCell()
        };
        this.fireCellExpandEvent(a)
    },
    mouseCellCheck: function(c, a) {
        var b = this.mouseCell;
        this.setCurrentCell(b, null , null , null , c.getButton());
        this.getCell(b.x, b.y).setChecked(a);
        c.widget = this;
        c.target = new DNA.widget.Point(b.x,b.y);
        c.checked = a;
        this.fireEvent("cellCheck", [c])
    },
    mouseCellCollapse: function(d) {
        var c = this.mouseCell;
        this.setCurrentCell(c, null , null , null , d.getButton());
        var b = {
            x: c.x,
            y: c.y,
            width: c.x,
            height: c.y
        };
        var a = new DNA.widget.Grid2SelectionArea(this,b,true,this.selectionDiv,true,this.showBorder);
        this._setSelection(a);
        this.setCurrentSelection(a);
        this._mouseCellCollapse(d, c);
        this.fireEvent("selection", [this])
    },
    _mouseCellCollapse: function(c, b) {
        var a = {
            widget: this,
            target: new DNA.widget.Point(b.x,b.y),
            lastCurrent: this.getCurrentCell()
        };
        this.fireCellCollapseEvent(a)
    },
    mouseCellSelectStart: function(g) {
        this.selectFinish = false;
        var a = g.isShift();
        var h = g.isCtrl();
        var b = this.mouseCell;
        this.selBeginCell = b;
        switch (this.getSelectionMode()) {
        case DNA.widget.JWTGrid2.SELECTION_MODE_MULTI:
            if ((!h && !a) || (h && a)) {
                this.setCurrentCell(b, null , null , null , g.getButton());
                var m = {
                    x: b.x,
                    y: b.y,
                    width: b.x,
                    height: b.y
                };
                var n = new DNA.widget.Grid2SelectionArea(this,m,true,this.selectionDiv,true,this.showBorder);
                this._setSelection(n);
                this.setCurrentSelection(n);
                if (this.activeEditor && this.activeEditor.control && this.activeEditor.control.isVisible()) {
                    this._hideSelectionBorder()
                } else {
                    this._showSelectionBorder()
                }
            } else {
                if (h && !a) {
                    this.setCurrentCell(b, null , null , null , g.getButton());
                    var m = {
                        x: b.x,
                        y: b.y,
                        width: b.x,
                        height: b.y
                    };
                    var n = new DNA.widget.Grid2SelectionArea(this,m,true,this.selectionDiv,true,this.showBorder);
                    this._addSelection(n);
                    this.setCurrentSelection(n);
                    if (this.selectionAreas.length > 1) {
                        this._hideSelectionBorder()
                    }
                } else {
                    if (this.selectionAreas.length === 0) {
                        this.setCurrentCell(b, null , null , null , g.getButton());
                        var m = {
                            x: b.x,
                            y: b.y,
                            width: b.x,
                            height: b.y
                        };
                        var n = new DNA.widget.Grid2SelectionArea(this,m,true,this.selectionDiv,true,this.showBorder);
                        this._setSelection(n);
                        this.setCurrentSelection(n)
                    } else {
                        var m = {
                            x: this.currentCol,
                            y: this.currentRow,
                            width: b.x,
                            height: b.y
                        };
                        var n = new DNA.widget.Grid2SelectionArea(this,m,true,null ,false,this.showBorder);
                        this._setSelection(n);
                        this.setCurrentSelection(n);
                        if (this.selectionAreas.length > 1) {
                            this._hideSelectionBorder()
                        }
                    }
                }
            }
            break;
        case DNA.widget.JWTGrid2.SELECTION_MODE_ROW:
            var m = {
                x: 1,
                y: b.y,
                width: this.columnCount - 1,
                height: b.y
            };
            if ((!h && !a) || (h && a)) {
                this.setCurrentCell(b, null , null , null , g.getButton());
                var n;
                for (var d = this.selectionAreas.length - 1; d >= 0; d--) {
                    if (this.util.rectEqual(this.selectionAreas[d], m)) {
                        n = this.selectionAreas[d];
                        this.selectionAreas.removeAt(d)
                    }
                }
                if (!n) {
                    n = new DNA.widget.Grid2SelectionArea(this,m,false,this.selectionDiv,false,this.showBorder)
                }
                this._setSelection(n);
                this.setCurrentSelection(n)
            } else {
                if (h && !a) {
                    this.setCurrentCell(b, null , null , null , g.getButton());
                    var n = new DNA.widget.Grid2SelectionArea(this,m,false,this.selectionDiv,false,this.showBorder);
                    this._addSelection(n);
                    this.setCurrentSelection(n)
                } else {
                    if (this.currentCell) {
                        var c = Math.min(this.currentRow, b.y);
                        var l = Math.max(this.currentRow, b.y);
                        for (var d = c + 1; d <= l; ++d) {
                            m = {
                                x: 1,
                                y: d,
                                width: this.columnCount - 1,
                                height: d
                            };
                            var n = new DNA.widget.Grid2SelectionArea(this,m,false,this.selectionDiv,false,this.showBorder);
                            this._addSelection(n)
                        }
                    }
                }
            }
            break;
        case DNA.widget.JWTGrid2.SELECTION_MODE_SINGLE:
            this.setCurrentCell(b, null , null , null , g.getButton());
            var m = {
                x: b.x,
                y: b.y,
                width: b.x,
                height: b.y
            };
            var n = new DNA.widget.Grid2SelectionArea(this,m,false,this.selectionDiv,true,this.showBorder);
            this._setSelection(n);
            this.setCurrentSelection(n);
            break
        }
    },
    mouseCellSelecting: function(c) {
        if (!this.currentSelection) {
            return
        }
        var d = this.getSelectionMode();
        if (d == DNA.widget.JWTGrid2.SELECTION_MODE_SINGLE || d == DNA.widget.JWTGrid2.SELECTION_MODE_ROW) {
            return
        }
        var b = this.mouseCell;
        if (b.x == this.lastMouseCell.x && b.y == this.lastMouseCell.y) {
            return
        }
        if (this.currentCol < this.hColCount) {
            this.tDiv.scrollLeft = "0px"
        }
        if (this.currentRow < this.hRowCount) {
            this.tDiv.scrollTop = "0px"
        }
        this.lastMouseCell = b;
        var a = {
            x: this.currentCol,
            y: this.currentRow,
            width: b.x,
            height: b.y
        };
        this.currentSelection._setBound(a);
        this.currentSelection.reBuild(true)
    },
    mouseCellSelectEnd: function(g) {
        if (this.selectFinish) {
            return
        }
        this.selectFinish = true;
        this.selectionDiv.style.width = "0px";
        this.selectionDiv.style.borderStyle = "none";
        this.selectionDiv.style.borderWidth = "0px";
        if (this.currentSelection) {
            if (this.getSelectionMode() != DNA.widget.JWTGrid2.SELECTION_MODE_ROW && this.currentCell) {
                var c = this.currentCell.getColIndex();
                var h = this.currentCell.getRowIndex();
                var d = c + this.currentCell.getColSpan();
                var a = h + this.currentCell.getRowSpan();
                if (this.mouseCell && (this.mouseCell.x >= c) && (this.mouseCell.y >= h) && (this.mouseCell.x < d) && (this.mouseCell.y < a)) {
                    this.fireEvent("selection", [this]);
                    return
                }
            }
            this.currentSelection.setDivSize();
            this._internalDrawTitle(this.currentSelection, false, true);
            this.fireEvent("selection", [this])
        }
    },
    mouseSelectionChangeStart: function(c) {
        var b = this.currentSelection;
        var a = new DNA.widget.Grid2SelectionChangeArea(this,b,this.selectionChangeDiv,true);
        this.selectionChangeArea = a
    },
    mouseSelectionChanging: function(d) {
        if (!this.selectionChangeArea) {
            return
        }
        var c = this.mouseCell;
        if (this.currentCol < this.hColCount) {
            this.tDiv.scrollLeft = "0px"
        }
        if (this.currentRow < this.hRowCount) {
            this.tDiv.scrollTop = "0px"
        }
        this.lastMouseCell = c;
        var b = {
            x: c.x,
            y: c.y
        };
        var a = {
            x: d.getLocation().x + this.tDiv.scrollLeft,
            y: d.getLocation().y + this.tDiv.scrollTop
        };
        this.selectionChangeArea._setBound(b, this.currentSelection, a);
        this.selectionChangeArea.redraw("dotted");
        this.dragPointDiv.style.display = "none"
    },
    mouseSelectionChangeEnd: function(d) {
        this.selectionChangeArea.destroy();
        if (this.currentSelection) {
            var c = this.currentSelection;
            var a = this.selectionChangeArea;
            var b = {
                x: a.cellX,
                y: a.cellY,
                width: a.cellWidth,
                height: a.cellHeight
            };
            b.x = (b.x == 0 ? 1 : b.x);
            b.y = (b.y == 0 ? 1 : b.y);
            b.width = (b.width == 0 ? 1 : b.width);
            b.height = (b.height == 0 ? 1 : b.height);
            this.fireEvent("selectionChange", [this, {
                x: c.x,
                y: c.y,
                width: c.width,
                height: c.height
            }, b]);
            this.currentSelection._setBound(b);
            this.currentSelection.reBuild(true);
            this.mouseCellSelectEnd()
        }
    },
    setActiveEditor: function(a) {
        if (this.activeEditor) {
            this.activeEditor.close()
        }
        this.activeEditor = a
    },
    openEditor: function(q, m, o, h, g) {
        if (!this.editorProvider) {
            return
        }
        var l = this.editorProvider.getCellEditor(this, q);
        if (!l.control) {
            return
        }
        if (this._eidtorIsOpen(q, l)) {
            return
        }
        this._hideFace();
        this._hideSelectionBorder();
        var n = DNA.engine.DomUtil.getInnerText(q.td);
        if (!n) {
            n = ""
        }
        q.td.setAttribute("st", n);
        if (!(DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) && q.td.getAttribute("wl")) {
            DNA.engine.DomUtil.setInnerText(q.td.firstChild, "")
        } else {
            DNA.engine.DomUtil.setInnerText(q.td, "")
        }
        this.setActiveEditor(l);
        this.activeEditor.open(o, h, g);
        this.focusable = false;
        var a = {
            grid: this,
            col: this.currentCol,
            row: this.currentRow,
            showText: this.currentCell.getShowText(),
            editText: this.currentCell.getEditText()
        };
        this.fireEvent("beforeedit", [a]);
        if (m && m.getKeyCode()) {
            var b = m.getKeyCode();
            var p = String.fromCharCode(b);
            var d = l.getText();
            var c = d + p;
            l.setText(c)
        }
    },
    _eidtorIsOpen: function(a, b) {
        return a.td.lastChild ? a.td.lastChild == b.control.el : false
    },
    openControl: function(a, c) {
        if (!this.controlProvider) {
            return
        }
        var b = this.controlProvider.getCellControl(this, a);
        if (!b) {
            return
        }
        if (c) {
            if (a.td.children && a.td.children[0] && b.control && a.td.children[0].id == b.control._eid) {
                return
            }
            this._clearCellText(a)
        }
        b.open()
    },
    _clearCellText: function(a) {
        var b = DNA.engine.DomUtil.getInnerText(a.td);
        if (!b) {
            b = ""
        }
        a.td.setAttribute("st", b);
        if (!(DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) && a.td.getAttribute("wl")) {
            DNA.engine.DomUtil.setInnerText(a.td.firstChild, "")
        } else {
            DNA.engine.DomUtil.setInnerText(a.td, "")
        }
    },
    openControlByCellPosition: function(a) {
        var c = new DNA.widget.AbstractGridCell(this,null ,a.x,a.y,false);
        var b = c.td.getAttribute("ci");
        this.removeControl(a.x, a.y);
        c.td.setAttribute("ci", b);
        this._clearCellText(c);
        this.openControl(c)
    },
    setCellEditorProvider: function(a) {
        this.editorProvider = a
    },
    setCellControlProvider: function(a) {
        this.controlProvider = a
    },
    closeEditor: function(d) {
        this.focusable = true;
        if (!this.currentCell) {
            this.activeEditor = null 
        }
        if (this.activeEditor) {
            var b = this.activeEditor.getResult(d ? d : 0);
            if (!b) {
                var n = this.currentCell.getShowText();
                this.activeEditor.close();
                this.activeEditor = null ;
                var l = this.getCell(this.currentCell.getColIndex(), this.currentCell.getRowIndex());
                l.setShowText(n, true);
                return
            }
            var h = b.getShowText();
            var c = b.getEditText();
            var g = {
                grid: this,
                col: this.currentCol,
                row: this.currentRow,
                showText: h,
                editText: c
            };
            this.fireEvent("afteredit", [g]);
            this.activeEditor.close();
            var l = this.getCell(this.currentCell.getColIndex(), this.currentCell.getRowIndex());
            l.setEditText(g.editText ? g.editText : "", true);
            var a = this.getFormattedText(l);
            var m = a ? a : (g.showText ? g.showText : "");
            if (l.isVertText()) {
                m = m.split("").join("\n")
            }
            l.setShowText(m, true);
            l.setFitFontSize();
            this.fireDataChangeEvent({
                x: this.currentCol,
                y: this.currentRow,
                width: this.currentCol,
                height: this.currentRow
            }, DNA.widget.JWTGrid2.DATACHANGE_INPUT);
            this.activeEditor = null 
        }
    },
    getFormattedText: function(a) {
        try {
            var b = this.formatterMgr.getFormatter(a.getFormatter());
            if (b) {
                return b.format(a.getEditText())
            }
        } catch (c) {
            return null 
        }
    },
    ensureEditorClose: function(a, b) {
        if (!this.currentCell && this.activeEditor) {
            this.activeEditor.close();
            this.activeEditor = null ;
            return true
        }
        if (this.activeEditor && this.currentCell) {
            if (a.getRowIndex() == this.currentCell.getRowIndex() && a.getColIndex() == this.currentCell.getColIndex()) {
                if (!this.activeEditor.getCloseFlag()) {
                    if (b) {
                        this.closeEditor()
                    }
                    return false
                }
            }
        }
        return true
    },
    reInitEditor: function(a) {
        if (!this.currentCell) {
            this.activeEditor = null ;
            return
        }
        if (this.activeEditor) {
            if (a.getRowIndex() == this.currentCell.getRowIndex() && a.getColIndex() == this.currentCell.getColIndex()) {
                this.activeEditor.initEditor(-1)
            }
        }
    },
    processAddControl: function() {
        if (this.getData("add_control")) {
            var b = this.getData("add_control");
            if (b) {
                for (var a = 0; a < b.length; a++) {
                    this.openControlByCellPosition(b[a])
                }
            }
            this.removeData("add_control")
        }
    },
    _refreshControl: function(c, b, a) {},
    addControl: function(b, d, a) {
        this.controlCells.push({
            x: b,
            y: d
        });
        var c = new DNA.widget.AbstractGridCell(this,null ,b,d,false);
        c.td.setAttribute("ci", a)
    },
    removeControl: function(b, g, a) {
        var d = new DNA.widget.AbstractGridCell(this,null ,b,g,false);
        var c = DNA.widget.WidgetRegistry.get(d.td.getAttribute("ci"));
        if (c) {
            c.setBounds(0, 0, 0, 0);
            c.getEl().style.position = "absolute";
            this.tDiv.appendChild(c.getEl());
            d.td.removeAttribute("ci")
        }
    },
    _autoScroll: function(g) {
        var r = g.getLocation();
        var b = this.contentTable.offsetHeight;
        var h = this.contentTable.offsetWidth;
        var n = DNA.engine.DomUtil.getClientSize(this.tDiv);
        var p = DNA.engine.DomUtil.getSize(this.frTable);
        var q = DNA.engine.DomUtil.getSize(this.hrTable);
        var c = DNA.engine.DomUtil.getSize(this.fcTable);
        var o = DNA.engine.DomUtil.getSize(this.hcTable);
        var a = 100;
        var m = 80;
        var d = 30;
        var l = 30;
        if (n.width - c.width - r.x < a) {
            if (this.tDiv.scrollLeft + n.width + m <= h) {
                this.tDiv.scrollLeft += (m)
            } else {
                this.tDiv.scrollLeft = h - n.width
            }
        }
        if (r.x - o.width < a) {
            if (this.tDiv.scrollLeft - m >= 0) {
                this.tDiv.scrollLeft -= (m)
            } else {
                this.tDiv.scrollLeft = 0
            }
        }
        if (n.height - p.height - r.y < d) {
            if (this.tDiv.scrollTop + n.height + l <= b) {
                this.tDiv.scrollTop += (l)
            } else {
                this.tDiv.scrollTop = b - n.height
            }
        }
        if (r.y - q.height < d) {
            if (this.tDiv.scrollTop - l >= 0) {
                this.tDiv.scrollTop -= (l)
            } else {
                this.tDiv.scrollTop = 0
            }
        }
    },
    setShowSelectingBorder: function(a) {
        this.showBorder = a;
        if (!a) {
            this._hideSelectionBorder()
        }
    },
    synchronizeData: function() {
        if (this.activeEditor) {
            var c = this.activeEditor.getResult();
            var b = c.getShowText();
            var d = c.getEditText();
            var a = this.getCell(this.currentCell.getColIndex(), this.currentCell.getRowIndex());
            a.setShowText(b ? b : "", true, true);
            a.setEditText(d ? d : "", true);
            this.fireDataChangeEvent({
                x: this.currentCol,
                y: this.currentRow,
                width: this.currentCol,
                height: this.currentRow
            }, DNA.widget.JWTGrid2.DATACHANGE_INPUT)
        }
    },
    synDataNoFire: function() {
        if (this.activeEditor) {
            var c = this.activeEditor.getResult();
            var b = c.getShowText();
            var d = c.getEditText();
            var a = this.getCell(this.currentCell.getColIndex(), this.currentCell.getRowIndex());
            a.setShowText(b ? b : "", true, true);
            a.setEditText(d ? d : "", true);
            this.fireDataChangeEvent({
                x: this.currentCol,
                y: this.currentRow,
                width: this.currentCol,
                height: this.currentRow
            }, DNA.widget.JWTGrid2.DATACHANGE_INPUT, true)
        }
    },
    synDataToCellProperty: function() {
        if (this.activeEditor) {
            var c = this.activeEditor.getResult();
            var b = c.getShowText();
            var d = c.getEditText();
            var a = this.getCell(this.currentCell.getColIndex(), this.currentCell.getRowIndex());
            a.setShowText(b ? b : "", true, true);
            a.setEditText(d ? d : "", true)
        }
    },
    _scrollToCol: function(n) {
        if (!this.checkRendered(true)) {
            return
        }
        if (n <= 0 || n >= this.columnCount) {
            return
        }
        if (n < this.hColCount) {
            return
        }
        var h = this.contentTable.rows[0].cells[1].offsetWidth;
        var l = this.hcDiv.offsetWidth;
        var p = h > l ? h : l;
        var m = this.tDiv.clientWidth;
        var o = this.contentTable.rows[0].cells[n + 1];
        var c = o.offsetLeft - p;
        var d = c + o.offsetWidth + p;
        var g = this.tDiv.scrollLeft ? this.tDiv.scrollLeft : 0;
        var a = m + g;
        if (c < g) {
            var b = c;
            this.tDiv.scrollLeft = b > 0 ? b : 0;
            if (this.hrDiv) {
                this.hrDiv.scrollLeft = this.tDiv.scrollLeft
            }
            return
        } else {
            if (d > a) {
                var b = d - m;
                this.tDiv.scrollLeft = b > 0 ? b : 0;
                if (this.hrDiv) {
                    this.hrDiv.scrollLeft = this.tDiv.scrollLeft
                }
            }
        }
    },
    _scrollToRow: function(m) {
        if (!this.checkRendered(true)) {
            return
        }
        if (m <= 0 || m >= this.rowCount) {
            return
        }
        if (m < this.hRowCount) {
            return
        }
        var b = this.contentTable.rows[1].cells[0].offsetHeight;
        var c = this.hrDiv.offsetHeight;
        var n = b > c ? b : c;
        var g = this.tDiv.clientHeight;
        var o = this.contentTable.rows[m + 1].cells[0];
        var p = o.offsetTop - n;
        var h = p + o.offsetHeight + n;
        var d = this.tDiv.scrollTop ? this.tDiv.scrollTop : 0;
        var a = g + d;
        if (p < d) {
            var l = p;
            this.tDiv.scrollTop = l > 0 ? l : 0;
            if (this.hcDiv) {
                this.hcDiv.scrollTop = this.tDiv.scrollTop
            }
            return
        } else {
            if (h > a) {
                var l = h - g;
                this.tDiv.scrollTop = l > 0 ? l : 0;
                if (this.hcDiv) {
                    this.hcDiv.scrollTop = this.tDiv.scrollTop
                }
            }
        }
    },
    insertRowHtml: function(c, a) {
        if (c <= 1 || c > this.rowCount) {
            return
        }
        var b = this.contentTable.rows[c];
        b.insertAdjacentElement("afterEnd", a)
    },
    replaceRowHtml: function(c, a) {
        if (c <= 1 || c >= this.rowCount) {
            return
        }
        var b = this.contentTable.rows[c];
        b.insertAdjacentElement("afterEnd", a);
        b.replaceNode(this.contentTable.rows[c + 1])
    },
    fireDataChangeEvent: function(c, b, a) {
        this.fireEvent("datachange", [this, c, b, a])
    },
    fireSelectionEvent: function() {
        this.fireEvent("selection", [this])
    },
    fireCurrentCellChangedEvent: function() {
        this.fireEvent("currentCellChanged", [this])
    },
    fireCurrentCellChangingEvent: function(a) {
        this.fireEvent("currentCellChanging", [a])
    },
    fireCellExpandEvent: function(a) {
        this.fireEvent("cellExpand", [a])
    },
    fireCellCollapseEvent: function(a) {
        this.fireEvent("cellCollapse", [a])
    },
    firePagingEvent: function(a) {
        this.fireEvent("paging", [a])
    },
    _internalDrawTitle: function(o, l, b) {
        if (!this.checkRendered(true)) {
            return
        }
        var c = o.x;
        var p = o.width;
        var n = o.y;
        var a = o.height;
        var q;
        var m = this._getRowDom(0, this.hrTable);
        for (var g = c; g <= p; ++g) {
            if (!l || !this._colInCurSel(g)) {
                q = this._getRowCell(m, g, 0);
                this.util.convertCSSFromClass2Style(q);
                if (b) {
                    q.style.backgroundColor = this._selTitleBackColor;
                    q.style.borderColor = this._selTitleBorderColor
                } else {
                    var h = q.getAttribute("bgc");
                    if (!h) {
                        h = ""
                    }
                    var d = q.getAttribute("rbc");
                    if (!d) {
                        d = ""
                    }
                    var r = q.getAttribute("bbc");
                    if (!r) {
                        r = ""
                    }
                    q.style.backgroundColor = h;
                    q.style.borderRightColor = d;
                    q.style.borderBottomColor = r;
                    q.style.borderLeftColor = "";
                    q.style.borderTopColor = ""
                }
                if (g < this.hColCount) {
                    q = this._getCellDom(g, 0, this.hltTab);
                    this.util.convertCSSFromClass2Style(q);
                    if (b) {
                        q.style.backgroundColor = this._selTitleBackColor;
                        q.style.borderColor = this._selTitleBorderColor
                    } else {
                        var h = q.getAttribute("bgc");
                        if (!h) {
                            h = ""
                        }
                        var d = q.getAttribute("rbc");
                        if (!d) {
                            d = ""
                        }
                        var r = q.getAttribute("bbc");
                        if (!r) {
                            r = ""
                        }
                        q.style.backgroundColor = h;
                        q.style.borderRightColor = d;
                        q.style.borderBottomColor = r;
                        q.style.borderLeftColor = "";
                        q.style.borderTopColor = ""
                    }
                }
            }
        }
        for (var g = n; g <= a; ++g) {
            if (!l || !this._rowInCurSel(g)) {
                q = this._getCellDom(0, g, this.hcTable);
                this.util.convertCSSFromClass2Style(q);
                if (b) {
                    q.style.backgroundColor = this._selTitleBackColor;
                    q.style.borderColor = this._selTitleBorderColor
                } else {
                    var h = q.getAttribute("bgc");
                    if (!h) {
                        h = ""
                    }
                    var d = q.getAttribute("rbc");
                    if (!d) {
                        d = ""
                    }
                    var r = q.getAttribute("bbc");
                    if (!r) {
                        r = ""
                    }
                    q.style.backgroundColor = h;
                    q.style.borderRightColor = d;
                    q.style.borderBottomColor = r;
                    q.style.borderLeftColor = "";
                    q.style.borderTopColor = ""
                }
                if (g < this.hRowCount) {
                    q = this._getCellDom(0, g, this.hltTab);
                    this.util.convertCSSFromClass2Style(q);
                    if (b) {
                        q.style.backgroundColor = this._selTitleBackColor;
                        q.style.borderColor = this._selTitleBorderColor
                    } else {
                        var h = q.getAttribute("bgc");
                        if (!h) {
                            h = ""
                        }
                        var d = q.getAttribute("rbc");
                        if (!d) {
                            d = ""
                        }
                        var r = q.getAttribute("bbc");
                        if (!r) {
                            r = ""
                        }
                        q.style.backgroundColor = h;
                        q.style.borderRightColor = d;
                        q.style.borderBottomColor = r;
                        q.style.borderLeftColor = "";
                        q.style.borderTopColor = ""
                    }
                }
            }
        }
    },
    ensureHAndW: function(l) {
        if (!l) {
            return
        }
        var o = l.getRowIndex();
        var c = l.getColIndex();
        var g = this.util.getRowAutoHeight(o);
        var a = this.util.getColAutoWidth(c);
        if (a) {
            var b = 0;
            for (var d = 0; d < this.rowCount; ) {
                var h = new DNA.widget.AbstractGridCell(this,this.contentTable,c,d,false);
                var n = DNA.engine.DomUtil.computeTextSize(l.getShowText(), l.getFont());
                if (n.width > b) {
                    b = n.width
                }
                d += h.getRowSpan()
            }
            this.setColumnWidth(c, b)
        }
        if (g) {
            var m = 0;
            for (var d = 0; d < this.columnCount; ) {
                var h = new DNA.widget.AbstractGridCell(this,this.contentTable,d,o,false);
                var n = DNA.engine.DomUtil.computeTextSize(l.getShowText(), l.getFont());
                if (n.height > m) {
                    m = n.height
                }
                d += h.getColSpan()
            }
            this.setRowHeight(o, m)
        }
    },
    _add: function(b, a) {
        if (a) {
            return this._renderChild(this.getBody(), DNA.JWT.RENDER_POS_TYPE_LAST, a)
        }
    },
    _focusDom: function(a) {
        if (DNA.engine.Client.isIE() && this.tDiv && this.tDiv.ownerDocument.activeElement == this.inputProxy) {
            return
        }
        if (this._isMouseDownonScrollbar(a)) {
            return
        }
        if (a && (a.getSrcElement() == this.tDiv || a.getSrcElement().className.indexOf("titleCell") >= 0)) {
            return
        }
        if (this.gridState === DNA.widget.JWTGrid2.STATE_COL_RESIZE || this.gridState === DNA.widget.JWTGrid2.STATE_ROW_RESIZE) {
            return
        }
        if (this.tDiv && DNA.engine.Client.isFF()) {
            this.tDiv.focus()
        }
        this._focusInputProxy()
    },
    getScrollTop: function() {
        return this.tDiv.scrollTop
    },
    getScrollLeft: function() {
        return this.tDiv.scrollLeft
    },
    setScrollTop: function(a) {
        this.tDiv.scrollTop = Math.max(0, a)
    },
    setScrollLeft: function(a) {
        return this.tDiv.scrollLeft = Math.max(0, a)
    },
    getClientHeight: function() {
        return this.tDiv.clientHeight
    },
    updateControlCellListAfterRowChange: function(b, a, d) {
        var h;
        var g;
        if (b != null  && b.size() > 0) {
            if (d > 0) {
                for (var c = 0; c < b.size(); c++) {
                    if (b[c].y >= a) {
                        b[c].y += d
                    }
                }
            } else {
                if (d < 0) {
                    h = [];
                    for (c = 0; c < b.size(); c++) {
                        g = b[c];
                        if (g.y >= a) {
                            if (g.y >= a - d) {
                                g.y += d;
                                h.push(g)
                            }
                        } else {
                            h.push(g)
                        }
                    }
                    b = h
                }
            }
        }
        return b
    },
    updateControlCellListAfterColChange: function(b, a, d) {
        var h;
        var g;
        if (b != null  && b.size() > 0) {
            if (d > 0) {
                for (var c = 0; c < b.size(); c++) {
                    if (b[c].x >= a) {
                        b[c].x += d
                    }
                }
            } else {
                if (d < 0) {
                    h = [];
                    for (c = 0; c < b.size(); c++) {
                        g = b[c];
                        if (g.x >= a) {
                            if (g.x >= a - d) {
                                g.x += d;
                                h.push(g)
                            }
                        } else {
                            h.push(g)
                        }
                    }
                    b = h
                }
            }
        }
        return b
    },
    _getScrollElement: function() {
        return this.tDiv
    },
    _resizeWraplineDivHeightInMergeCells: function() {
        if (!(DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict()))) {
            var a;
            var d;
            var b;
            for (var c = this.mergeRectCache.length - 1; c >= 0; c--) {
                a = this.getCell(this.mergeRectCache[c].x, this.mergeRectCache[c].y);
                if (a && a.td.getAttribute("wl")) {
                    a._resizeWraplineDiv()
                }
            }
        }
    },
    _showEditor: function() {
        if (this.currentCell) {
            var b = this.currentCell.getColIndex();
            var g = this.currentCell.getRowIndex();
            if (!(this.getEditMode() != DNA.widget.JWTGrid2.EDIT_MODE_READONLY) && this.util.isCellEditable(b, g)) {
                return
            }
            var a = new DNA.widget.AbstractGridCell(this,null ,b,g,false);
            if (!this.editorProvider) {
                return
            }
            var c = this.editorProvider.getCellEditor(this, a);
            if (!c.control) {
                return
            }
            if (this._eidtorIsOpen(a, c)) {
                return
            }
            this._hideFace();
            this._hideSelectionBorder();
            var d = DNA.engine.DomUtil.getInnerText(a.td);
            if (!d) {
                d = ""
            }
            a.td.setAttribute("st", d);
            if (!(DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) && a.td.getAttribute("wl")) {
                DNA.engine.DomUtil.setInnerText(a.td.firstChild, "")
            } else {
                DNA.engine.DomUtil.setInnerText(a.td, "")
            }
            this.setActiveEditor(c);
            this.activeEditor.open(false, null , null , true);
            this.focusable = false
        }
    },
    _hideEditor: function() {
        this.focusable = true;
        if (!this.currentCell) {
            this.activeEditor = null 
        }
        if (this.activeEditor) {
            this.activeEditor.close();
            this.activeEditor = null 
        }
    },
    fullUpdateNoIframe: function(a) {
        this.tDiv.innerHTML = a;
        this._replaceDom()
    },
    _hasVScroll: function() {
        var b = false
          , l = false;
        var h = 0, d, c;
        var a = this.tDiv.clientWidth
          , g = this.tDiv.clientHeight;
        for (d = 0,
        c = this.getColumnCount(); d < c; d++) {
            if (!this.getColHidden(d)) {
                h += this.getColumnWidth(d)
            }
            if (h > a) {
                b = true;
                break
            }
        }
        h = 0;
        g = b ? g - 17 : g;
        for (d = 0,
        c = this.getRowCount(); d < c; d++) {
            if (!this.getRowHidden(d)) {
                h += this.getRowHeight(d)
            }
            if (h > g) {
                l = true;
                break
            }
        }
        return l
    },
    _hasHScroll: function() {
        var b = false
          , l = false;
        var h = 0, d, c;
        var a = this.tDiv.clientWidth
          , g = this.tDiv.clientHeight;
        for (d = 0,
        c = this.getRowCount(); d < c; d++) {
            if (!this.getRowHidden(d)) {
                h += this.getRowHeight(d)
            }
            if (h > g) {
                l = true;
                break
            }
        }
        h = 0;
        a = l ? a - 17 : a;
        for (d = 0,
        c = this.getColumnCount(); d < c; d++) {
            if (!this.getColHidden(d)) {
                h += this.getColumnWidth(d)
            }
            if (h > a) {
                b = true;
                break
            }
        }
        return b
    },
    _isMouseDownonScrollbar: function(c) {
        if (c) {
            var a = c.getLocation();
            var b = this.getBounds();
            if (this._hasHScroll() && a.y <= b.height && a.y >= b.height - 17) {
                return true
            }
            if (this._hasVScroll() && a.x <= b.width && a.x >= b.width - 17) {
                return true
            }
        }
        return false
    },
    setCurrentCellColor: function(b, a) {
        this.currentCellColorFocused = b;
        this.currentCellColorUnFocused = a;
        this.updateCurrentCellColor()
    },
    updateCurrentCellColor: function() {
        if (this.currentCellColorFocused === null  || this.currentCellColorUnFocused === null ) {
            return
        }
        var a;
        var c = [this.curLeft, this.curRight, this.curBottom, this.curTop];
        if (DNA.engine.DomUtil.hasClass(this.el, "focus")) {
            a = this.currentCellColorFocused
        } else {
            a = this.currentCellColorUnFocused
        }
        for (var b = 0; b < c.length; b++) {
            c[b].style.backgroundColor = a
        }
    }
});
Object.override(DNA.widget.Grid2.prototype, {
    jtype: "Grid2",
    focusable: true
});
DNA.widget.Grid2SelectionArea = function(c, g, b, h, d, a) {
    this.grid = c;
    this.div = null ;
    this._setBound(g);
    this.computeFlag = b;
    this.showBorder = a;
    this.ranges = new Array();
    this.divs = new Array();
    this.marks = new Array();
    this.gridDivs = [this.grid.hltDiv, this.grid.hcDiv, this.grid.hrDiv];
    this.markType = {
        LT: 0,
        T: 1,
        L: 2,
        M: 3
    };
    if (b) {
        this.calculateRange()
    }
    if (h) {
        this.div = h
    } else {
        if (!(this.y == this.height && this.x == this.width)) {
            this.createDiv()
        }
    }
    if (!d) {
        this.setDivSize()
    }
}
;
Object.override(DNA.widget.Grid2SelectionArea.prototype, {
    getRange: function() {
        return {
            x: this.x,
            y: this.y,
            width: this.width,
            height: this.height
        }
    },
    _setBound: function(a) {
        this.y = a.y <= a.height ? a.y : a.height;
        this.height = a.y <= a.height ? a.height : a.y;
        this.x = a.x <= a.width ? a.x : a.width;
        this.width = a.x <= a.width ? a.width : a.x
    },
    isBuild: function() {
        return this.buildFlag
    },
    createDiv: function() {
        this.buildFlag = true;
        this.div = null ;
        this.dragPoint = null ;
        var a = this.grid.hColCount;
        var h = this.grid.hRowCount;
        var o = this.grid.columnCount - 1;
        var m = this.grid.rowCount - 1;
        var l = {
            x: this.x,
            y: this.y,
            width: this.width,
            height: this.height
        };
        var q = "1px";
        var n = "1px";
        if (DNA.engine.Client.isIE() && !DNA.engine.Client.isStrict()) {
            q = "5px";
            n = "5px"
        }
        var p = "<div class='select_area_div2' unselectable='on' >";
        p += "</div>";
        if (DNA.engine.Client.isIE() && DNA.engine.Client.getBrowserVersion() < 7) {
            p = "<div class='select_area_div2_IE6' unselectable='on'></div>"
        }
        var b = this._getRectIntersection(l, {
            x: a,
            y: h,
            width: o,
            height: m
        });
        if (b) {
            this.ranges.push(b);
            this.marks.push(this.markType.M);
            this.dragPoint = DNA.engine.DomUtil.insertAfter(this.grid.tDiv.firstChild, p);
            this.divs.push(this.grid.tDiv.childNodes[1])
        }
        var c = this._getRectIntersection(l, {
            x: 1,
            y: h,
            width: a - 1,
            height: m
        });
        if (c) {
            this.ranges.push(c);
            this.marks.push(this.markType.L);
            this.dragPoint = DNA.engine.DomUtil.insertAfter(this.grid.hcDiv.lastChild, p);
            this.divs.push(this.grid.hcDiv.lastChild)
        }
        var d = this._getRectIntersection(l, {
            x: a,
            y: 1,
            width: o,
            height: h - 1
        });
        if (d) {
            this.ranges.push(d);
            this.marks.push(this.markType.T);
            this.dragPoint = DNA.engine.DomUtil.insertAfter(this.grid.hrDiv.lastChild, p);
            this.divs.push(this.grid.hrDiv.lastChild)
        }
        var g = this._getRectIntersection(l, {
            x: 1,
            y: 1,
            width: a - 1,
            height: h - 1
        });
        if (g) {
            this.ranges.push(g);
            this.marks.push(this.markType.LT);
            this.dragPoint = DNA.engine.DomUtil.insertAfter(this.grid.hltDiv.lastChild, p);
            this.divs.push(this.grid.hltDiv.lastChild)
        }
    },
    _getRectIntersection: function(d, c) {
        if (d.width < c.x || c.width < d.x) {
            return null 
        }
        var b = d.x > c.x ? d.x : c.x;
        var g = d.width > c.width ? c.width : d.width;
        if (d.height < c.y || c.height < d.y) {
            return null 
        }
        var h = d.y > c.y ? d.y : c.y;
        var a = d.height > c.height ? c.height : d.height;
        return {
            x: b,
            y: h,
            width: g,
            height: a
        }
    },
    setDivSize: function(B) {
        if ((this.x == this.width) && (this.y == this.height)) {
            return
        }
        if (this.div != null ) {
            var z = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,this.x,this.y,!this.computeFlag);
            var L = z.getLeft();
            var c = z.getTop();
            var u = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,this.width,this.height,!this.computeFlag);
            var K = u.getLeft();
            var b = u.getTop();
            var C = K - L + u.getWidth();
            var v = b - c + u.getHeight();
            this.setDiv(this.div, L, c, C, v);
            return
        }
        var J = this.ranges.length;
        for (var H = 0; H < J; ++H) {
            var s = this.ranges[H];
            var d = s.y;
            var A = s.height;
            var g = s.x;
            var m = s.width;
            for (var G = s.y; G < s.height; G++) {
                if (this.grid.getRowHidden(G)) {
                    d = G + 1
                } else {
                    break
                }
            }
            for (var G = s.height; G > s.y; G--) {
                if (this.grid.getRowHidden(G)) {
                    A = G - 1
                } else {
                    break
                }
            }
            for (var G = s.x; G < s.width; G++) {
                if (this.grid.getColHidden(G)) {
                    g = G + 1
                } else {
                    break
                }
            }
            for (var G = s.width; G > s.x; G--) {
                if (this.grid.getColHidden(G)) {
                    m = G - 1
                } else {
                    break
                }
            }
            var z = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,g,d,!this.computeFlag);
            var L = z.getLeft();
            var c = z.getTop();
            var u = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,m,A,!this.computeFlag);
            var K = u.getLeft();
            var b = u.getTop();
            var C = K - L + u.getWidth();
            var v = b - c + u.getHeight();
            if (B) {
                this.divs[H].style.zIndex = B
            }
            this.setDiv(this.divs[H], L, c, C, v, this.marks[H], s)
        }
        if (this.showBorder && (this.grid.selectionAreas.length === 1)) {
            var n = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,this.x,this.y,!this.computeFlag);
            var D = n.getLeft();
            var r = n.getTop();
            var F = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,this.width,this.height,!this.computeFlag);
            var E = F.getLeft();
            var p = F.getTop();
            var q = E - D + F.getWidth();
            var I = p - r + F.getHeight();
            var o = D + q - 4;
            var a = r + I - 4;
            var M = this._getDragPointDiv();
            M.style.display = "block";
            DNA.engine.DomUtil.setLeftTop(M, o, a)
        }
    },
    setDiv: function(a, n, m, b, p, h, d) {
        var o = ((DNA.engine.Client.isIE() && !DNA.engine.Client.isStrict()) ? b : b - 2);
        var g = ((DNA.engine.Client.isIE() && !DNA.engine.Client.isStrict()) ? p : p - 2);
        DNA.engine.DomUtil.setSize(a, {
            width: o,
            height: g
        });
        DNA.engine.DomUtil.setLeftTop(a, n, m);
        if (this.showBorder && (this.grid.selectionAreas.length === 1)) {
            var l = m - 1;
            var c = n - 1;
            if (h == this.markType.LT) {
                this.selBorderLeft = this.grid.hltDiv.childNodes[6];
                this.selBorderRight = this.grid.hltDiv.childNodes[7];
                this.selBorderTop = this.grid.hltDiv.childNodes[8];
                this.selBorderBottom = this.grid.hltDiv.childNodes[9];
                this.selBorderLeft.style.display = "block";
                this.selBorderTop.style.display = "block";
                this.selBorderRight.style.display = "none";
                this.selBorderBottom.style.display = "none";
                DNA.engine.DomUtil.setLeftTop(this.selBorderLeft, c, l);
                DNA.engine.DomUtil.setHeight(this.selBorderLeft, p);
                DNA.engine.DomUtil.setLeftTop(this.selBorderTop, c, l);
                DNA.engine.DomUtil.setWidth(this.selBorderTop, b);
                if (d.width < this.grid.hColCount - 1 || d.width == this.width) {
                    this.selBorderRight.style.display = "block";
                    DNA.engine.DomUtil.setLeftTop(this.selBorderRight, c + b - 1, l);
                    DNA.engine.DomUtil.setHeight(this.selBorderRight, p)
                }
                if (d.height < this.grid.hRowCount - 1 || d.height == this.height) {
                    this.selBorderBottom.style.display = "block";
                    DNA.engine.DomUtil.setLeftTop(this.selBorderBottom, c, l + p - 1);
                    DNA.engine.DomUtil.setWidth(this.selBorderBottom, b)
                }
            } else {
                if (h == this.markType.L) {
                    this.selBorderLeft = this.grid.hcDiv.childNodes[6];
                    this.selBorderRight = this.grid.hcDiv.childNodes[7];
                    this.selBorderTop = this.grid.hcDiv.childNodes[8];
                    this.selBorderBottom = this.grid.hcDiv.childNodes[9];
                    this.selBorderLeft.style.display = "block";
                    this.selBorderBottom.style.display = "block";
                    this.selBorderRight.style.display = "none";
                    this.selBorderTop.style.display = "none";
                    DNA.engine.DomUtil.setLeftTop(this.selBorderLeft, c, l);
                    DNA.engine.DomUtil.setHeight(this.selBorderLeft, p);
                    DNA.engine.DomUtil.setLeftTop(this.selBorderBottom, c, l + p - 1);
                    DNA.engine.DomUtil.setWidth(this.selBorderBottom, b);
                    if (d.width < this.grid.hColCount - 1 || d.width == this.width) {
                        this.selBorderRight.style.display = "block";
                        DNA.engine.DomUtil.setLeftTop(this.selBorderRight, c + b - 1, l);
                        DNA.engine.DomUtil.setHeight(this.selBorderRight, p)
                    }
                    if (d.y > this.grid.hRowCount || d.y == this.y) {
                        this.selBorderTop.style.display = "block";
                        DNA.engine.DomUtil.setLeftTop(this.selBorderTop, c, l);
                        DNA.engine.DomUtil.setWidth(this.selBorderTop, b)
                    }
                } else {
                    if (h == this.markType.T) {
                        this.selBorderLeft = this.grid.hrDiv.childNodes[6];
                        this.selBorderRight = this.grid.hrDiv.childNodes[7];
                        this.selBorderTop = this.grid.hrDiv.childNodes[8];
                        this.selBorderBottom = this.grid.hrDiv.childNodes[9];
                        this.selBorderRight.style.display = "block";
                        this.selBorderTop.style.display = "block";
                        this.selBorderBottom.style.display = "none";
                        this.selBorderLeft.style.display = "none";
                        DNA.engine.DomUtil.setLeftTop(this.selBorderTop, c, l);
                        DNA.engine.DomUtil.setWidth(this.selBorderTop, b);
                        DNA.engine.DomUtil.setLeftTop(this.selBorderRight, c + b - 1, l);
                        DNA.engine.DomUtil.setHeight(this.selBorderRight, p);
                        if (d.height < this.grid.hRowCount - 1 || d.height == this.height) {
                            this.selBorderBottom.style.display = "block";
                            DNA.engine.DomUtil.setLeftTop(this.selBorderBottom, c, l + p - 1);
                            DNA.engine.DomUtil.setWidth(this.selBorderBottom, b)
                        }
                        if (d.x > this.grid.hColCount || d.x == this.x) {
                            this.selBorderLeft.style.display = "block";
                            DNA.engine.DomUtil.setLeftTop(this.selBorderLeft, c, l);
                            DNA.engine.DomUtil.setHeight(this.selBorderLeft, p)
                        }
                    } else {
                        this.selBorderLeft = this.grid.mSelBorderLeft;
                        this.selBorderRight = this.grid.mSelBorderRight;
                        this.selBorderTop = this.grid.mSelBorderTop;
                        this.selBorderBottom = this.grid.mSelBorderBottom;
                        this.selBorderRight.style.display = "block";
                        this.selBorderBottom.style.display = "block";
                        this.selBorderLeft.style.display = "none";
                        this.selBorderTop.style.display = "none";
                        DNA.engine.DomUtil.setLeftTop(this.selBorderRight, c + b - 1, l);
                        DNA.engine.DomUtil.setHeight(this.selBorderRight, p);
                        DNA.engine.DomUtil.setLeftTop(this.selBorderBottom, c, l + p - 1);
                        DNA.engine.DomUtil.setWidth(this.selBorderBottom, b);
                        if (!d || d.x > this.grid.hColCount || d.x == this.x) {
                            this.selBorderLeft.style.display = "block";
                            DNA.engine.DomUtil.setLeftTop(this.selBorderLeft, c, l);
                            DNA.engine.DomUtil.setHeight(this.selBorderLeft, p)
                        }
                        if (!d || d.y > this.grid.hRowCount || d.y == this.y) {
                            this.selBorderTop.style.display = "block";
                            DNA.engine.DomUtil.setLeftTop(this.selBorderTop, c, l);
                            DNA.engine.DomUtil.setWidth(this.selBorderTop, b)
                        }
                    }
                }
            }
        }
    },
    _getDragPointDiv: function() {
        var c = {
            width: 0,
            height: 0
        };
        var b = this.markType.M;
        for (var a = 0; a < this.divs.length; a++) {
            if ((this.ranges[a].width + this.ranges[a].height) > (c.width + c.height)) {
                c = this.ranges[a];
                b = this.marks[a]
            }
        }
        if (b == this.markType.LT) {
            return this.grid.hltDiv.childNodes[5]
        } else {
            if (b == this.markType.L) {
                return this.grid.hcDiv.childNodes[5]
            } else {
                if (b == this.markType.T) {
                    return this.grid.hrDiv.childNodes[5]
                } else {
                    return this.grid.mDragPointDiv
                }
            }
        }
    },
    destroy: function() {
        if (this.div != null ) {
            this.div.style.width = "0px";
            this.div = null 
        }
        var a = this.divs.length;
        for (var b = 0; b < a; ++b) {
            var c = this.divs[b];
            c.parentNode.removeChild(c)
        }
        this.ranges.length = 0;
        this.marks.length = 0;
        this.divs.length = 0;
        this.hideSelectionBorders()
    },
    calculateRange: function() {
        var h = this.y;
        var l = this.height;
        var m = this.x;
        var a = this.width;
        var d, b;
        for (var g = h; g <= l; ++g) {
            d = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,m,g,false);
            b = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,a,g,false);
            if (d.getColIndex() < this.x) {
                this.x = d.getColIndex()
            }
            if (b.getColIndex() + b.getColSpan() - 1 > this.width) {
                this.width = b.getColIndex() + b.getColSpan() - 1
            }
        }
        for (var c = m; c <= a; ++c) {
            d = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,c,h,false);
            b = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,c,l,false);
            if (d.getRowIndex() < this.y) {
                this.y = d.getRowIndex()
            }
            if (b.getRowIndex() + b.getRowSpan() - 1 > this.height) {
                this.height = b.getRowIndex() + b.getRowSpan() - 1
            }
        }
    },
    redraw: function() {
        if (this.computeFlag) {
            this.calculateRange()
        }
        this.setDivSize()
    },
    reBuild: function(a, b) {
        if (a) {
            this.destroy()
        }
        if (this.computeFlag) {
            this.calculateRange()
        }
        if ((this.x == this.width) && (this.y == this.height)) {
            if (this.grid.currentCell) {
                this.grid._drawCurrentCell(this.grid.currentCell)
            }
            return
        }
        this.createDiv();
        this.setDivSize(b)
    },
    hideSelectionBorders: function() {
        for (var a = 0; a < this.gridDivs.length; a++) {
            var b = this.gridDivs[a];
            b.childNodes[5].style.display = "none";
            b.childNodes[6].style.display = "none";
            b.childNodes[7].style.display = "none";
            b.childNodes[8].style.display = "none";
            b.childNodes[9].style.display = "none"
        }
        this.grid.mSelBorderLeft.style.display = "none";
        this.grid.mSelBorderRight.style.display = "none";
        this.grid.mSelBorderTop.style.display = "none";
        this.grid.mSelBorderBottom.style.display = "none";
        this.grid.mDragPointDiv.style.display = "none"
    }
});
DNA.widget.GridCell2 = function(b, a, c) {
    DNA.widget.GridCell2.superclass.constructor.call(this, b, a, c);
    this.rowIndex = c;
    this.colIndex = a;
    this.table = b.contentTable;
    this.td = this.grid._getCellDom(a, c, this.table);
    this.ensureCellType()
}
;
DNA.widget.GridCell2.extend(DNA.widget.IGridCell, {
    ensureCellType: function() {
        if (this.x === 0) {
            this.type = DNA.widget.JWTGrid2.CELL_ROWTITLE;
            if (this.y < this.grid.hRowCount) {
                this.isLock = true
            }
            return
        }
        if (this.y === 0) {
            this.type = DNA.widget.JWTGrid2.CELL_COLTITLE;
            if (this.x < this.grid.hColCount) {
                this.isLock = true
            }
            return
        }
        if (this.x < this.grid.hColCount) {
            if (this.y < this.grid.hRowCount) {
                this.type = DNA.widget.JWTGrid2.CELL_HEADERLOCK
            } else {
                if (this.y < this.grid.rowCount - this.grid.fRowCount) {
                    this.type = DNA.widget.JWTGrid2.CELL_HEADERCOL
                } else {
                    this.type = DNA.widget.JWTGrid2.CELL_LEFTBOTTOMLOCK
                }
            }
        } else {
            if (this.x >= this.grid.hColCount && this.x < this.grid.columnCount - this.grid.fColCount) {
                if (this.y < this.grid.hRowCount) {
                    this.type = DNA.widget.JWTGrid2.CELL_HEADERROW
                } else {
                    if (this.y < this.grid.rowCount - this.grid.fRowCount) {
                        this.type = DNA.widget.JWTGrid2.CELL_COMMON
                    } else {
                        this.type = DNA.widget.JWTGrid2.CELL_FOOTERROW
                    }
                }
            } else {
                if (this.y < this.grid.hRowCount) {
                    this.type = DNA.widget.JWTGrid2.CELL_RIGHTTOPLOCK
                } else {
                    if (this.y < this.grid.rowCount - this.grid.fRowCount) {
                        this.type = DNA.widget.JWTGrid2.CELL_FOOTERCOL
                    } else {
                        this.type = DNA.widget.JWTGrid2.CELL_RIGHTBOTTOMLOCK
                    }
                }
            }
        }
    },
    setClientData: function(b) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        if (typeof (b) != "string") {
            b = DNA.engine.JsonUtil.encode(b)
        }
        var a = this.parseStr2Html(b);
        this.setAttribute(this.td, "cd", a);
        this.setterHelper(this._setClientData, a)
    },
    _setClientData: function(b, a) {
        this.setAttribute(b, "cd", a)
    },
    setTopBorderStyle: function(a) {},
    setLeftBorderStyle: function(a) {},
    setRightBorderStyle: function(a) {
        if (a === "auto") {
            this.setRightBorderColor("");
            this.setterHelper2(this._setRightBorderStyle, a);
            return
        }
        this._setRightBorderStyle(this.td, a);
        this.setterHelper(this._setRightBorderStyle, a)
    },
    setBottomBorderStyle: function(a) {
        if (a === "auto") {
            this.setBottomBorderColor("");
            this.setterHelper2(this._setBottomBorderStyle, a);
            return
        }
        this._setBottomBorderStyle(this.td, a);
        this.setterHelper(this._setBottomBorderStyle, a)
    },
    _setTopBorderStyle: function(b, a) {},
    _setLeftBorderStyle: function(b, a) {},
    _setRightBorderStyle: function(b, a) {
        if (a === "auto") {
            b.style.borderRightStyle = "";
            return
        }
        b.style.borderRightStyle = a
    },
    _setBottomBorderStyle: function(b, a) {
        if (a === "auto") {
            b.style.borderBottomStyle = "";
            return
        }
        b.style.borderBottomStyle = a
    },
    setTopBorderColor: function(a) {},
    setLeftBorderColor: function(a) {},
    setRightBorderColor: function(a) {
        this._setRightBorderColor(this.td, a);
        this.setterHelper(this._setRightBorderColor, a)
    },
    setBottomBorderColor: function(a) {
        this._setBottomBorderColor(this.td, a);
        this.setterHelper(this._setBottomBorderColor, a)
    },
    _setTopBorderColor: function(b, a) {},
    _setLeftBorderColor: function(b, a) {},
    _setRightBorderColor: function(b, a) {
        if (this.x == 0 || this.y == 0) {
            this.setAttribute(b, "rbc", a)
        }
        b.style.borderRightColor = a
    },
    _setBottomBorderColor: function(b, a) {
        if (this.x == 0 || this.y == 0) {
            this.setAttribute(b, "bbc", a)
        }
        b.style.borderBottomColor = a
    },
    setBorderStyle: function(a) {},
    setBorderColor: function(a) {},
    setVertAlign: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        this._setVertAlign(this.td, a);
        this.setterHelper2(this._setVertAlign, a)
    },
    _setVertAlign: function(b, a) {
        b.style.verticalAlign = a
    },
    setRowSpan: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        this._setRowSpan(this.td, a);
        this.setterHelper(this._setRowSpan, a)
    },
    _setRowSpan: function(b, a) {
        b.rowSpan = a
    },
    setHorzAlign: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        this._setHorzAlign(this.td, a);
        this.setterHelper2(this._setHorzAlign, a)
    },
    _setHorzAlign: function(b, a) {
        b.style.textAlign = a
    },
    setWrapLine: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        if (a) {
            a = "break-word"
        } else {
            a = "normal"
        }
        this._setWrapLine(this.td, a);
        this.setterHelper2(this._setWrapLine, a)
    },
    _setWrapLine: function(g, b) {
        g.style.wordWrap = b;
        if (b === "break-word") {
            g.style.whiteSpace = "normal"
        } else {
            g.style.whiteSpace = "nowrap"
        }
        if (!(DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict()))) {
            if (b === "break-word") {
                if (g.childNodes.length == 1 && g.childNodes[0].nodeType == 3) {
                    g.setAttribute("wl", "1");
                    var d = g.ownerDocument.createElement("div");
                    var c = g.firstChild;
                    d.appendChild(c);
                    var a = this.grid.getRowHeightFromStyle(this.getRowIndex());
                    d.style.height = (this.grid.util.getWrapTextHeight(this.getColIndex(), this.getRowIndex()) > (a - 1)) ? (Math.max((a - 1), 0) + "px") : "";
                    g.appendChild(d)
                }
            } else {
                if (g.getAttribute("wl") == "1") {
                    g.removeAttribute("wl");
                    if (g.firstChild && g.firstChild.firstChild) {
                        g.appendChild(g.firstChild.firstChild)
                    }
                    if (g.firstChild) {
                        g.removeChild(g.firstChild)
                    }
                }
            }
        }
    },
    _isWrapline: function() {
        return this.grid.util.getStyle(this.td, "wordWrap") === "break-word"
    },
    setVertText: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        if (!DNA.engine.Client.isIE()) {
            return
        }
        this._setVertText(this.td, a);
        this.setterHelper2(this._setVertText, a)
    },
    _setVertText: function(b, a) {
        if (a) {
            b.style.writingMode = "tb-rl"
        } else {
            b.style.writingMode = "lr-tb"
        }
    },
    setSelectable: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        if (a) {
            this.setAttribute(this.td, "sa", 1);
            this.setterHelper2(this._setSelectable, 1)
        } else {
            this.setAttribute(this.td, "sa", 0);
            this.setterHelper2(this._setSelectable, 0)
        }
    },
    _setSelectable: function(b, a) {
        if (a) {
            this.setAttribute(b, "sa", 1)
        } else {
            this.setAttribute(b, "sa", 0)
        }
    },
    setEditable: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        if (a) {
            this.setAttribute(this.td, "ea", 1);
            this._updateEditorFace(true);
            this.setterHelper2(this._setEditable, 1)
        } else {
            this.grid.ensureEditorClose(this, true);
            this.setAttribute(this.td, "ea", 0);
            this._updateEditorFace(false);
            this.setterHelper2(this._setEditable, 0)
        }
    },
    _setEditable: function(b, a) {
        if (a) {
            this.setAttribute(b, "ea", 1)
        } else {
            this.setAttribute(b, "ea", 0)
        }
    },
    _updateEditorFace: function(a) {
        var b = this.grid.getCurrentCell();
        if (b && b.x == this.getColIndex() && b.y == this.getRowIndex()) {
            if (a) {
                if (this.grid.getEditMode() !== DNA.widget.JWTGrid2.EDIT_MODE_READONLY) {
                    this.grid._showFace()
                }
            } else {
                this.grid._hideFace()
            }
        }
    },
    setIndent: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        this._setIndent(this.td, a);
        this.setterHelper2(this._setIndent, a)
    },
    _setIndent: function(b, a) {
        b.style.textIndent = a + "px"
    },
    setFont: function(a) {
        this._setFont(this.td, a);
        this.setterHelper(this._setFont, a)
    },
    setFontStyle: function(a) {
        this._setFontStyle(this.td, a);
        this.setterHelper(this._setFontStyle, a)
    },
    _setFontStyle: function(b, a) {
        if (a.style) {
            b.style.fontStyle = a.style
        } else {
            b.style.fontStyle = ""
        }
        if (a.weight) {
            b.style.fontWeight = a.weight
        } else {
            b.style.fontWeight = ""
        }
        if (a.decoration) {
            b.style.textDecoration = a.decoration
        } else {
            b.style.textDecoration = ""
        }
    },
    _setFont: function(b, a) {
        if (a.family) {
            b.style.fontFamily = a.family
        }
        if (a.size) {
            b.style.fontSize = parseInt(a.size, 10) + "pt"
        }
        if (a.style) {
            b.style.fontStyle = a.style
        } else {
            b.style.fontStyle = ""
        }
        if (a.weight) {
            b.style.fontWeight = a.weight
        } else {
            b.style.fontWeight = ""
        }
        if (a.decoration) {
            b.style.textDecoration = a.decoration
        } else {
            b.style.textDecoration = ""
        }
    },
    setEditor: function(a, c) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        this.setAttribute(this.td, "ei", a);
        if (c) {
            this.setAttribute(this.td, "ef", c)
        }
        this.setterHelper(this._setEditor, a);
        var b = DNA.widget.WidgetRegistry.get(a);
        if (b && !(this.grid.activeEditor && this.grid.activeEditor.control == b)) {
            b.setVisible(false)
        }
    },
    _setEditor: function(b, a) {
        this.setAttribute(b, "ei", a)
    },
    setForeground: function(a) {
        this._setForeground(this.td, a);
        this.setterHelper(this._setForeground, a)
    },
    _setForeground: function(b, a) {
        b.style.color = a
    },
    setGradientBackground: function(d, b, a) {
        if (DNA.engine.Client.isIE()) {
            this._setIEGradientBackground(this.td, d, b, a)
        } else {
            if (DNA.engine.Client.isFF()) {
                var c = d == 0 ? "top" : "left";
                this._setFFGradientBackground(this.td, c, b, a)
            } else {
                if (DNA.engine.Client.isChrome()) {
                    var c = d == 0 ? "left top,left bottom" : "left top,right top";
                    this._setWebketGradientBackground(this.td, c, b, a)
                }
            }
        }
    },
    _setIEGradientBackground: function(d, c, b, a) {
        d.style.filter = "progid:DXImageTransform.Microsoft.Gradient(gradientType=" + c + ",startColorStr=" + b + ",endColorStr=" + a + ");"
    },
    _setFFGradientBackground: function(g, c, b, a) {
        var d = "-moz-linear-gradient(" + c + ", " + b + "," + a + ")";
        g.style.backgroundImage = d
    },
    _setWebketGradientBackground: function(g, c, b, a) {
        var d = "-webkit-gradient(linear," + c + ", from(" + b + "),to(" + a + "))";
        g.style.backgroundImage = d
    },
    setShowImage: function(b, a) {
        this.setAttribute(this.td, "et", b);
        if (!a) {
            this.grid.fireDataChangeEvent({
                x: this.x,
                y: this.y,
                width: this.x,
                height: this.y
            }, 0)
        }
        this._setShowImage(this.td, b);
        this.setterHelper(this._setShowImage, b)
    },
    _setShowImage: function(c, a, b) {
        if (DNA.engine.Client.isIE() && c.style.filter) {
            c.style.backgroundImage = "";
            c.style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(src= " + DNA.widget.ImageDescriptor.getUrl(a) + ", sizingMethod=scale)"
        } else {
            c.style.backgroundImage = "url(" + DNA.widget.ImageDescriptor.getUrl(a) + ")"
        }
        if (b === true) {
            if (c.style.backgroundPosition == "") {
                c.style.backgroundPosition = "left top"
            }
        }
    },
    clientSetShowImage: function(c, a, b) {
        this._setShowImage(c, a, b);
        this.setterHelper(this._setShowImage, a)
    },
    setBackImage: function(b) {
        if (b == "clear") {
            this._clearImage(this.td);
            this.setterHelper(this._clearImage)
        } else {
            var a = b.split(",");
            this._setBackImage(this.td, a[0], a[1]);
            this.setterHelper(this._setBackImage, a[0], a[1])
        }
    },
    _clearImage: function(a) {
        a.style.backgroundImage = "";
        if (DNA.engine.Client.isIE()) {
            a.style.filter = ""
        }
    },
    _setBackImage: function(d, c, a) {
        d.style.backgroundImage = "url(" + c + ")";
        this.backImageStyle = d.style.backgroundImage;
        var b;
        switch (a) {
        case "0":
            b = "no-repeat";
            break;
        case "1":
            b = "repeat";
            break;
        case "2":
            if (DNA.engine.Client.isFF()) {
                d.style.MozBackgroundSize = "100% 100%"
            } else {
                if (DNA.engine.Client.isIE()) {
                    d.style.backgroundImage = "";
                    d.style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(src= " + c + ", sizingMethod=scale)"
                }
            }
            break
        }
        if (b) {
            d.style.backgroundRepeat = b;
            if (d.style.backgroundPosition == "") {
                d.style.backgroundPosition = "left top"
            }
        }
    },
    setBackgroundPosition: function(b) {
        if (!this.backImageStyle) {
            return
        }
        var a = b.split(",");
        this._setBackgroundPosition(this.td, a[0], a[1]);
        this.setterHelper(this._setBackgroundPosition, a[0], a[1])
    },
    _setBackgroundPosition: function(c, a, b) {
        c.style.backgroundImage = this.backImageStyle;
        c.style.backgroundRepeat = "";
        c.style.MozBackgroundSize = "";
        c.style.filter = "";
        c.style.backgroundPosition = a + " " + b
    },
    setHtml: function(a) {
        this._setHtml(this.td, a);
        this.setterHelper(this._setHtml, a)
    },
    _setHtml: function(c, a) {
        var b = c;
        if (!(DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) && c.getAttribute("wl")) {
            b = c.firstChild
        }
        b.innerHTML = a
    },
    setBackground: function(a) {
        this._setBackground(this.td, a);
        this.setterHelper(this._setBackground, a)
    },
    _setBackground: function(b, a) {
        if (this.x == 0 || this.y == 0) {
            this.setAttribute(b, "bgc", a)
        }
        b.style.backgroundColor = a
    },
    setSilverHead: function(a) {
        if (a) {
            this.setBackground("#ece9d8")
        } else {
            var b = this.getBackground();
            if (b == "#ece9d8") {
                this.setBackground("")
            }
        }
    },
    setBackStyle: function(a) {
        if (a === "auto") {
            this.setBackground("")
        }
    },
    setEditText: function(c, b, a) {
        if (this.getShowText() === "image://") {
            this.setShowImage(c)
        } else {
            if (this.getShowText() === "html://") {
                this.setHtml(c);
                c = "html://"
            }
        }
        c = this.parseStr2Html(c);
        this.setAttribute(this.td, "et", c);
        if (!b) {
            this.grid.fireDataChangeEvent({
                x: this.x,
                y: this.y,
                width: this.x,
                height: this.y
            }, 0)
        }
        this.setterHelper2(this._setEditText, c);
        if (a) {
            this.grid.reInitEditor(this)
        }
    },
    _setEditText: function(c, b, a) {
        this.setAttribute(c, "et", b)
    },
    setTitle: function(b) {
        var a = (b === undefined || b === null ) ? "" : b;
        this.setAttribute(this.td, "title", a);
        this.setterHelper2(this._setTitle, a)
    },
    _setTitle: function(b, a) {
        this.setAttribute(b, "title", a)
    },
    setFormatter: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        this.setAttribute(this.td, "fi", a);
        this.setterHelper(this._setFormatter, a)
    },
    _setFormatter: function(b, a) {
        this.setAttribute(b, "fi", a)
    },
    setChecked: function(b) {
        var a = DNA.engine.DomUtil.findChild(this.td, "span[class^=check]");
        if (a) {
            if (b) {
                a.className = "checkedCell"
            } else {
                a.className = "checkableCell"
            }
        }
    },
    setTreeStyle: function(a) {
        if (a & DNA.JWT.CHECK) {
            var b = DNA.engine.DomUtil.findChild(this.td, "span[class^=check]");
            if (b) {
                b.style.display = ""
            }
        }
        if (a & DNA.JWT.LEAF) {
            var b = DNA.engine.DomUtil.findChild(this.td, "span[class^=expand]");
            if (b) {
                b.style.visibility = "hidden"
            }
        }
    },
    setTreeImage: function(a) {
        var b = DNA.engine.DomUtil.findChild(this.td, "span[class^=treeImage]");
        if (b) {
            if (a && a != "clear") {
                b.style.display = "";
                b.style.backgroundImage = "url(" + DNA.widget.ImageDescriptor.getUrl(a) + ")"
            } else {
                b.style.display = "none"
            }
        }
    },
    setFitFontSizeStyle: function(a) {
        this._setFitFontSizeStyle(this.td, a);
        this.setterHelper(this._setFitFontSizeStyle, a);
        this.setFitFontSize()
    },
    _setFitFontSizeStyle: function(g, d) {
        if (d) {
            g.setAttribute("ffs", "1");
            g.setAttribute("ofs", this.getFont().size)
        } else {
            g.removeAttribute("ffs");
            var c = g.getAttribute("ofs");
            if (c) {
                var b = parseInt(c, 10);
                var a = this.getFont();
                a.setSize(b);
                this._setFont(g, a)
            }
            g.removeAttribute("ofs")
        }
    },
    setFitFontSize: function() {
        if (this.td.getAttribute("ffs")) {
            var a = this.getFont();
            a.setSize(this._computeFitFontSize());
            this.setFont(a)
        }
    },
    _computeFitFontSize: function() {
        var c = this.getFont();
        var m = this.getShowText();
        var l = parseInt(this.td.getAttribute("ofs"), 10);
        var d = this.getRowSpan();
        var h = this.getColSpan();
        var a = 0
          , n = 0;
        for (var g = 0; g < h; g++) {
            a += this.grid.getColumnWidth(this.getColIndex() + g)
        }
        for (var g = 0; g < d; g++) {
            n += this.grid.getRowHeight(this.getRowIndex() + g)
        }
        if (this._isWrapline()) {
            for (var g = this.grid.FONTSIZEFLOOR + 1; g <= l; g++) {
                c.setSize(g);
                var b = this.grid.util.computeFoldedTextHeight(m, c, a);
                if (b > n) {
                    c.setSize(g - 1);
                    break
                }
            }
        } else {
            if (m.indexOf("\n") >= 0) {
                for (var g = this.grid.FONTSIZEFLOOR + 1; g <= l; g++) {
                    c.setSize(g);
                    var b = this.grid.util.computeFoldedTextHeight(m.replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/\n/g, "<br>").replace(/ /g, "&nbsp;"), c, a);
                    if (b > n) {
                        c.setSize(g - 1);
                        break
                    }
                }
            } else {
                for (var g = this.grid.FONTSIZEFLOOR + 1; g <= l; g++) {
                    c.setSize(g);
                    var o = this.grid.util.computeUnfoldedTextSize(m, c);
                    if (o.height > n || o.width > a) {
                        c.setSize(g - 1);
                        break
                    }
                }
            }
        }
        return c.getSize()
    },
    setExpandable: function(a, c) {
        var b = this.grid._getCellDom(a, c, this.table);
        this._setExpandable(b);
        this.setterHelper(this._setExpandable)
    },
    _setExpandable: function(b) {
        b.setAttribute("ea", 0);
        this._ensureTreeCell(b);
        var a = b.childNodes;
        if (a[a.length - 4].className == "endCellHoriLine") {
            DNA.engine.DomUtil.dispose(a[a.length - 4])
        }
        a[a.length - 4].className = "expandableCell";
        b.setAttribute("ea", 0)
    },
    clearExpandable: function(a, c) {
        var b = this.grid._getCellDom(a, c, this.table);
        this._clearExpandable(b);
        this.setterHelper(this._clearExpandable)
    },
    _clearExpandable: function(b) {
        var a = this.getShowText();
        b.innerHTML = " ";
        this._setShowText(b, a)
    },
    _ensureTreeCell: function(c) {
        if (!(c.childNodes.length > 0 && c.childNodes[0].tagName == "SPAN")) {
            var a = "";
            a += "<span class='emptyCell'></span>";
            a += "<span class='endCellHoriLine'></span>";
            a += "<span class='checkableCell' style='display:none;'></span>";
            a += "<span class='treeImageCell' style='display:none;'></span>";
            var b = this.getShowText();
            if (!b) {
                b = ""
            }
            a += "<span class='expandCellText'>" + b + "</span>";
            c.innerHTML = a
        }
    },
    setExpanded: function(a) {
        var b = this.grid._getCellDom(this.x, this.y, this.table);
        this._setExpanded(b, a);
        this.setterHelper(this._setExpanded, a)
    },
    _setExpanded: function(d, b) {
        var c = "expandableCell";
        if (b == "true") {
            c = "expandedCell"
        }
        var a = DNA.engine.DomUtil.findChild(d, "span[class^=expand]");
        if (a) {
            a.className = c
        }
    },
    _doCellExpendIndentation: function(d, b, c, a) {
        this.__doCellExpendIndentation(this.td, d, b, c, a);
        this.setterHelper(this.__doCellExpendIndentation, d, b, c, a)
    },
    __doCellExpendIndentation: function(l, h, d, g, c) {
        var a = "";
        a += "<span class='emptyCell'></span>";
        for (var b = 1; b < d; b++) {
            a += "<span class='vertLine'></span>"
        }
        if (h == g) {
            a += "<span class='bottomCell'></span>"
        } else {
            a += "<span class='endCellVertLine'></span>";
            a += "<span class='endCellHoriLine'></span>"
        }
        if (c) {
            a += "<span class='checkableCell'></span>"
        } else {
            a += "<span class='checkableCell' style='display:none;'></span>"
        }
        a += "<span class='treeImageCell' style='display:none;'></span>";
        DNA.engine.DomUtil.insertFirst(l, a)
    },
    setShowText: function(c, b, a) {
        if (c == "image://" || c == "html://") {
            this.setAttribute(this.td, "st", c);
            return
        }
        this._setShowText(this.td, c);
        if (!b) {
            this.grid.fireDataChangeEvent({
                x: this.x,
                y: this.y,
                width: this.x,
                height: this.y
            }, 0)
        }
        if (a) {
            this.setterHelper(this._setShowText2, c)
        } else {
            this.setterHelper(this._setShowText, c);
            this.grid.ensureHAndW(this)
        }
    },
    _setShowText2: function(b, a) {
        if (!a || a == "") {
            a = " "
        }
        this.setAttribute(b, "st", a)
    },
    _setShowText: function(g, d) {
        if (!d) {
            d = ""
        }
        if (this.getAttribute(g, "rhc")) {
            this.setAttribute(g, "st", d)
        } else {
            if (this.x === 0 || this.y === 0) {
                this.setAttribute(g, "st", d)
            } else {
                this.removeAttribute(g, "st")
            }
            if (this.grid.ensureEditorClose(this)) {
                if (g.childNodes.length > 0 && (g.childNodes[0].nodeName == "SPAN")) {
                    this.setAttribute(g, "st", d);
                    var b = g.childNodes[g.childNodes.length - 1];
                    if (b.className && b.className != "expandCellText") {
                        DNA.engine.DomUtil.insertAfter(b, '<span class="expandCellText"></span>')
                    }
                    DNA.engine.DomUtil.setInnerText(g.childNodes[g.childNodes.length - 1], d === "" ? " " : d)
                } else {
                    var c = g;
                    if (!(DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) && g.getAttribute("wl")) {
                        c = g.firstChild
                    }
                    if (d.indexOf("\n") > 0) {
                        this.setAttribute(g, "st", d);
                        c.innerHTML = d.replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/\n/g, "<br>").replace(/ /g, "&nbsp;")
                    } else {
                        if (DNA.engine.Client.isIE()) {
                            DNA.engine.DomUtil.setInnerText(c, d === "" ? " " : d)
                        } else {
                            c.innerHTML = (this.grid.util.getNBSPString(d)).replace(/</g, "&lt;").replace(/>/g, "&gt;")
                        }
                    }
                    if (!(DNA.engine.Client.isIE() && (!DNA.engine.Client.isStrict())) && g.getAttribute("wl")) {
                        var a = this.grid.getRowHeightFromStyle(this.getRowIndex());
                        c.style.height = (this.grid.util.getWrapTextHeight(this.getColIndex(), this.getRowIndex()) > (a - 1)) ? (Math.max((a - 1), 0) + "px") : ""
                    }
                }
            } else {
                if (!d || d == "") {
                    d = " "
                }
                this.setAttribute(g, "st", d)
            }
        }
        this.setFitFontSize()
    },
    _resizeWraplineDiv: function() {
        var a = this.__resizeWraplineDiv(this.td);
        this.setterHelper(this.__resizeWraplineDiv, a)
    },
    __resizeWraplineDiv: function(n, a) {
        var l = 0;
        if (a !== undefined) {
            l = a
        } else {
            var d = this.getRowIndex();
            var b = d + parseInt(n.getAttribute("rowSpan"));
            var c = parseInt(n.getAttribute("rowSpan"));
            if (n.rrs) {
                c = n.rrs
            }
            var b = d + c;
            for (var m = d; m < b; m++) {
                var g = this.grid._getCellDom(-1, m, this.grid.contentTable);
                if (g.offsetHeight > 0) {
                    l += parseInt(g.style.height)
                }
            }
        }
        if ((l - 1) < this.grid.util.getWrapTextHeight(this.getColIndex(), this.getRowIndex(), this.td.offsetWidth)) {
            n.firstChild.style.height = (l - 1) + "px"
        } else {
            n.firstChild.style.height = ""
        }
        return l
    },
    setterHelper: function(b, d, c) {
        var a = null ;
        switch (this.type) {
        case DNA.widget.JWTGrid2.CELL_HEADERROW:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hrTable);
            b.apply(this, [a, d, c]);
            break;
        case DNA.widget.JWTGrid2.CELL_HEADERCOL:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hcTable);
            b.apply(this, [a, d, c]);
            break;
        case DNA.widget.JWTGrid2.CELL_HEADERLOCK:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hrTable);
            b.apply(this, [a, d, c]);
            a = this.grid._getCellDom(this.x, this.y, this.grid.hcTable);
            b.apply(this, [a, d, c]);
            a = this.grid._getCellDom(this.x, this.y, this.grid.hltTab);
            b.apply(this, [a, d, c]);
            break;
        case DNA.widget.JWTGrid2.CELL_ROWTITLE:
            a = this.grid._getCellDom(0, this.y, this.grid.hcTable);
            b.apply(this, [a, d, c]);
            if (this.isLock) {
                a = this.grid._getCellDom(0, this.y, this.grid.hltTab);
                b.apply(this, [a, d, c])
            }
            break;
        case DNA.widget.JWTGrid2.CELL_COLTITLE:
            a = this.grid._getCellDom(this.x, 0, this.grid.hrTable);
            b.apply(this, [a, d, c]);
            if (this.isLock) {
                a = this.grid._getCellDom(this.x, 0, this.grid.hltTab);
                b.apply(this, [a, d, c])
            }
            break;
        case DNA.widget.JWTGrid2.CELL_LEFTBOTTOMLOCK:
            a = this.grid._getCellDom(0, this.y, this.grid.hcTable);
            b.apply(this, [a, d, c]);
            a = this.grid._getCellDom(0, this.y - this.grid.rowCount + this.grid.fRowCount, this.grid.frTable);
            b.apply(this, [a, d, c]);
            a = this.grid._getCellDom(0, this.y - this.grid.rowCount + this.grid.fRowCount, this.grid.flbTab);
            b.apply(this, [a, d, c]);
            break;
        case DNA.widget.JWTGrid2.CELL_FOOTERROW:
            a = this.grid._getCellDom(this.x, this.y - this.grid.rowCount + this.grid.fRowCount, this.grid.frTable);
            b.apply(this, [a, d, c]);
            break;
        case DNA.widget.JWTGrid2.CELL_FOOTERCOL:
            a = this.grid._getCellDom(this.x - this.grid.columnCount + this.grid.fColCount, this.y, this.grid.fcTable);
            b.apply(this, [a, d, c]);
            break;
        case DNA.widget.JWTGrid2.CELL_RIGHTBOTTOMLOCK:
            a = this.grid._getCellDom(this.x, this.y - this.grid.rowCount + this.grid.fRowCount, this.grid.frTable);
            b.apply(this, [a, d, c]);
            a = this.grid._getCellDom(this.x - this.grid.columnCount + this.grid.fColCount, this.y, this.grid.fcTable);
            b.apply(this, [a, d, c]);
            a = this.grid._getCellDom(this.x - this.grid.columnCount + this.grid.fColCount, this.y - this.grid.rowCount + this.grid.fRowCount, this.grid.frbTab);
            b.apply(this, [a, d, c]);
            break;
        case DNA.widget.JWTGrid2.CELL_RIGHTTOPLOCK:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hrTable);
            b.apply(this, [a, d, c]);
            a = this.grid._getCellDom(this.x - this.grid.columnCount + this.grid.fColCount, this.y, this.grid.fcTable);
            b.apply(this, [a, d, c]);
            a = this.grid._getCellDom(this.x - this.grid.columnCount + this.grid.fColCount, this.y, this.grid.hrtTab);
            b.apply(this, [a, d, c]);
            break;
        default:
            break
        }
    },
    setterHelper2: function(b, c) {
        var a = null ;
        switch (this.type) {
        case DNA.widget.JWTGrid2.CELL_HEADERROW:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hrTable);
            b.apply(this, [a, c]);
            break;
        case DNA.widget.JWTGrid2.CELL_HEADERCOL:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hcTable);
            b.apply(this, [a, c]);
            break;
        case DNA.widget.JWTGrid2.CELL_HEADERLOCK:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hrTable);
            b.apply(this, [a, c]);
            a = this.grid._getCellDom(this.x, this.y, this.grid.hcTable);
            b.apply(this, [a, c]);
            a = this.grid._getCellDom(this.x, this.y, this.grid.hltTab);
            b.apply(this, [a, c]);
            break;
        default:
            break
        }
    }
});
DNA.widget.JWTGrid2 = {
    SELECTION_MODE_MASK: 3,
    SELECTION_MODE_MULTI: 0,
    SELECTION_MODE_SINGLE: 1,
    SELECTION_MODE_ROW: 2,
    EDIT_MODE_MASK: 3 << 2,
    EDIT_MODE_DESIGN: 0 << 2,
    EDIT_MODE_INPUT: 1 << 2,
    EDIT_MODE_READONLY: 2 << 2,
    COL_RESIZE_MASK: 1 << 4,
    ROW_RESIZE_MASK: 1 << 5,
    COL_SELECT_MASK: 1 << 6,
    ROW_SELECT_MASK: 1 << 7,
    ROW_FREE_RESIZE_MASK: 1 << 14,
    COL_FREE_RESIZE_MASK: 1 << 15,
    COL_EXCHANG_MASK: 1 << 18,
    ENTER_NEXT_MASK: 7 << 9,
    ENTER_NEXT_DOWN: 0 << 9,
    ENTER_NEXT_RIGHT: 1 << 9,
    ENTER_NEXT_UP: 2 << 9,
    ENTER_NEXT_LEFT: 3 << 9,
    ENTER_NEXT_NONE: 4 << 9,
    CA_DEFAULT: 0,
    CA_FORE: 1,
    CA_BACK: 2,
    CA_CENTER: 3,
    CA_SPARSE: 4,
    CA_JUSTIFIED: 5,
    CELL_COMMON: 0,
    CELL_ROWTITLE: 1,
    CELL_COLTITLE: 2,
    CELL_TITLELOCK: 3,
    CELL_HEADERROW: 4,
    CELL_HEADERCOL: 5,
    CELL_HEADERLOCK: 6,
    CELL_LEFTBOTTOMLOCK: 7,
    CELL_FOOTERROW: 8,
    CELL_FOOTERCOL: 9,
    CELL_RIGHTBOTTOMLOCK: 10,
    CELL_RIGHTTOPLOCK: 11,
    STATE_NORMAL: 0,
    STATE_CELL_SELECT: 1,
    STATE_ROW_SELECT: 2,
    STATE_COL_SELECT: 3,
    STATE_ROW_RESIZE: 4,
    STATE_COL_RESIZE: 5,
    STATE_OUT: 6,
    STATE_CELL_OPENEDITOR: 7,
    STATE_COL_EXCHANGE: 8,
    STATE_CELL_EXPAND: 9,
    STATE_CELL_COLLAPSE: 10,
    STATE_SELECTION_CHANGED: 11,
    STATE_ALL_SELECT: 12,
    STATE_CELL_CHECK: 13,
    STATE_CELL_UNCHECK: 14,
    DATACHANGE_INPUT: 0,
    DATACHANGE_PASTE: 1,
    DATACHANGE_CUT: 2,
    DATACHANGE_DEL: 3,
    DATACHANGE_PROGRAM: 4,
    LEFT: 0,
    RIGHT: 1,
    UP: 2,
    DOWN: 3,
    UPDATE_SHOWTEXT: 0,
    UPDATE_EDITTEXT: 1,
    UPDATE_SERVERDATA: 2,
    UPDATE_SERVERDATA: 2,
    EDITOPEN_DBCLICK: 1,
    EDITOPEN_INPUT: 2,
    EDITOPEN_CLICKFACE: 3,
    EDITOPEN_PROGRAM: 4,
    GETRESULT_SERVERCELLCHANGE: 1,
    GETRESULT_SYN: 2,
    GETRESULT_CLIENTCELLCHANGE: 3,
    GETRESULT_CELLCHANGING: 4,
    SETCURRENTCELLCAUSE_PROGRAM: 0,
    SETCURRENTCELLCAUSE_KEY: 1,
    SETCURRENTCELLCAUSE_BUTTON: 2
};
DNA.widget.Grid2SelectionChangeArea = function(a, c, d, b) {
    this.grid = a;
    this.div = d;
    if (!b) {
        this.setDivSize(null )
    }
    this.x = 0;
    this.y = 0;
    this.width = 0;
    this.height = 0;
    this.cellX = null ;
    this.cellY = null ;
    this.cellWidth = null ;
    this.cellHeight = null 
}
;
Object.override(DNA.widget.Grid2SelectionChangeArea.prototype, {
    _setBound: function(b, h, a) {
        var c = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,b.x,b.y,false);
        var l = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,h.x,h.y,false);
        var m = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,h.width,h.y,false);
        var d = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,h.x,h.height,false);
        var g = new DNA.widget.AbstractGridCell(this.grid,this.grid.contentTable,h.width,h.height,false);
        this.positionLT = {
            x: l.getLeft(),
            y: l.getTop()
        };
        this.positionRT = {
            x: m.getLeft() + m.getWidth(),
            y: m.getTop()
        };
        this.positionLB = {
            x: d.getLeft(),
            y: d.getTop() + d.getHeight()
        };
        this.positionRB = {
            x: g.getLeft() + g.getWidth(),
            y: g.getTop() + g.getHeight()
        };
        if (a.x > this.positionRB.x) {
            if ((a.y - this.positionRB.y) > 0 && (a.y - this.positionRB.y) > (a.x - this.positionRB.x)) {
                this.x = this.positionLT.x;
                this.y = this.positionLT.y;
                this.width = this.positionRT.x - this.positionLT.x;
                this.height = this.positionRB.y - this.positionRT.y + c.getTop() - this.positionRB.y + c.getHeight();
                this.cellX = h.x;
                this.cellY = h.y;
                this.cellWidth = h.width;
                this.cellHeight = b.y
            } else {
                if ((a.y - this.positionRT.y) < 0 && (this.positionRT.y - a.y) > (a.x - this.positionRT.x)) {
                    this.x = this.positionLT.x;
                    this.y = c.getTop();
                    this.width = this.positionRT.x - this.positionLT.x;
                    this.height = this.positionRB.y - c.getTop();
                    this.cellX = h.x;
                    this.cellY = b.y;
                    this.cellWidth = h.width;
                    this.cellHeight = h.height
                } else {
                    this.x = this.positionLT.x;
                    this.y = this.positionLT.y;
                    this.width = this.positionRT.x - this.positionLT.x + c.getLeft() - this.positionRB.x + c.getWidth();
                    this.height = this.positionRB.y - this.positionRT.y;
                    this.cellX = h.x;
                    this.cellY = h.y;
                    this.cellWidth = b.x;
                    this.cellHeight = h.height
                }
            }
            return
        }
        if (a.x < this.positionLB.x) {
            if ((a.y - this.positionRB.y) > 0 && (a.y - this.positionRB.y) > (this.positionLB.x - a.x)) {
                this.x = this.positionLT.x;
                this.y = this.positionLT.y;
                this.width = this.positionRT.x - this.positionLT.x;
                this.height = this.positionRB.y - this.positionRT.y + c.getTop() - this.positionRB.y + c.getHeight();
                this.cellX = h.x;
                this.cellY = h.y;
                this.cellWidth = h.width;
                this.cellHeight = b.y
            } else {
                if ((a.y - this.positionRT.y) < 0 && (this.positionLT.y - a.y) > (this.positionLT.x - a.x)) {
                    this.x = this.positionLT.x;
                    this.y = c.getTop();
                    this.width = this.positionRT.x - this.positionLT.x;
                    this.height = this.positionRB.y - c.getTop();
                    this.cellX = h.x;
                    this.cellY = b.y;
                    this.cellWidth = h.width;
                    this.cellHeight = h.height
                } else {
                    this.x = c.getLeft();
                    this.y = this.positionLT.y;
                    this.width = this.positionRT.x - c.getLeft();
                    this.height = this.positionRB.y - this.positionRT.y;
                    this.cellX = b.x;
                    this.cellY = h.y;
                    this.cellWidth = h.width;
                    this.cellHeight = h.height
                }
            }
            return
        }
        if (a.y < this.positionLT.y) {
            this.x = this.positionLT.x;
            this.y = c.getTop();
            this.width = this.positionRT.x - this.positionLT.x;
            this.height = this.positionRB.y - c.getTop();
            this.cellX = h.x;
            this.cellY = b.y;
            this.cellWidth = h.width;
            this.cellHeight = h.height;
            return
        }
        if (a.y > this.positionLB.y) {
            this.x = this.positionLT.x;
            this.y = this.positionLT.y;
            this.width = this.positionRT.x - this.positionLT.x;
            this.height = c.getTop() - this.positionRT.y + c.getHeight();
            this.cellX = h.x;
            this.cellY = h.y;
            this.cellWidth = h.width;
            this.cellHeight = b.y;
            return
        }
    },
    setDiv: function(h, b, g, d, a, c) {
        DNA.engine.DomUtil.setSize(h, {
            width: d,
            height: a
        });
        DNA.engine.DomUtil.setLeftTop(h, b, g);
        h.style.borderStyle = c;
        h.style.borderWidth = "2px"
    },
    destroy: function() {
        if (this.div != null ) {
            this.div.style.width = "0px";
            this.div.style.borderWidth = "0px";
            this.div.style.borderStyle = "none";
            this.div = null 
        }
    },
    redraw: function(a) {
        this.setDiv(this.div, this.x, this.y, this.width, this.height, a)
    }
});
DNA.widget.AbstractCellControl = function(b, a) {
    this.grid = b;
    this.cell = a;
    this.control = null ;
    this.grid = b;
    this.cell = a;
    this.createControl()
}
;
DNA.widget.AbstractCellControl.extend(Object, {
    open: function() {
        if (this.control) {
            if (this.control.checkRendered(true)) {
                this.resizeControl();
                this.control.el.style.position = "relative";
                this.cell.td.appendChild(this.control.el);
                this.grid.util.rebuildControl(this.control);
                if (DNA.engine.Client.isIE() && !this.control.el.style.textAlign) {
                    this.control.el.style.textAlign = "left"
                }
                if (DNA.engine.Client.isFF() && this.cell.td.getAttribute("wl")) {
                    this.cell.td.firstChild.style.display = "none"
                }
            }
        }
    },
    resizeControl: function() {
        var b = this._getWH();
        var c = b.w;
        var a = b.h;
        this.control.setVisible(true);
        var h = -2;
        var d = DNA.engine.DomUtil.getStyle(this.cell.td, "paddingTop");
        var g = d ? 0 - parseInt(d) : 0;
        this.control.setBounds(0, 0, 0, 0);
        a -= 1;
        this.control.setBounds(h, g, c - 1, a)
    },
    _getWH: function() {
        return {
            w: this.cell.getComputedWidth(),
            h: this.cell.getComputedHeight()
        }
    },
    reBoundCtr: function() {
        var b = this.cell.td.offsetLeft;
        var d = this.cell.td.offsetTop;
        var c = this.cell.td.offsetWidth;
        var a = this.cell.td.offsetHeight;
        this.control.setBounds(b, d - 1, c, a + 1)
    },
    _ControlMouseUp: function() {
        if (!this.control.checkRendered(true)) {
            return
        }
        this.grid.gridState = DNA.widget.JWTGrid2.STATE_NORMAL
    },
    createControl: function() {
        var a = this.cell.td.getAttribute("ci");
        if (!a) {
            a = this.grid.defEditorId
        }
        this.control = DNA.widget.WidgetRegistry.get(a)
    },
    close: function(a) {
        if (!a && !this.getCloseFlag()) {
            this.control.removeListener(this, "keydown");
            var b = this.control.getEl();
            if (b && b.parentNode != this.grid.tDiv) {
                this.grid.tDiv.appendChild(b);
                this.grid.util.rebuildControl(this.control)
            }
            this.control.setVisible(false);
            if (DNA.engine.Client.isFF() && this.cell.td.getAttribute("wl")) {
                this.cell.td.firstChild.style.display = ""
            }
            this.setCloseFlag(true)
        }
    },
    setCloseFlag: function(a) {
        this.closed = a
    },
    getCloseFlag: function() {
        return this.closed
    }
});
DNA.widget.ICellControlProvider = function() {}
;
DNA.widget.ICellControlProvider.extend(Object, {
    getCellControl: function(b, a) {}
});
DNA.widget.CellControlProvider = function() {
    DNA.widget.CellControlProvider.superclass.constructor.call()
}
;
DNA.widget.CellControlProvider.extend(DNA.widget.ICellControlProvider, {
    getCellControl: function(c, a) {
        var b = a.td.getAttribute("ci");
        if (b) {
            return new DNA.widget.AbstractCellControl(c,a)
        } else {
            return null 
        }
    }
});
DNA.widget.Grid2GC = function(a) {
    DNA.widget.Grid2GC.superclass.constructor.call(this, a);
    this._doInit();
    this.util = new DNA.widget.GridUtil(this)
}
;
DNA.widget.Grid2GC.extend(DNA.widget.Composite, {
    autoRender: true,
    _defaultBorder: new DNA.widget.Border(1,"gray","solid"),
    _initFormatter: function() {
        var a = this.getInitData()[DNA.JWTProperty.PROPERTY_FORMATTER];
        this.formatterMgr = new DNA.widget.CellFormatterMgr();
        this._addFormatters(a)
    },
    getBody: function() {
        if (this.checkRendered(true)) {
            return this.tDiv
        }
    },
    _addFormatters: function(c) {
        if (c) {
            var a = c.length;
            for (var b = 0; b < a; ++b) {
                if (c[b]) {
                    this.formatterMgr.addFormatter(c[b].id, this.createFormatter(c[b].script, c[b].opts))
                }
            }
        }
    },
    checkBuild: function(c) {
        var a = this._checkState(DNA.JWT.STATE_RENDERD);
        if (!a && c) {
            return this._buildElements()
        } else {
            return a
        }
    },
    createFormatter: function(scriptStr, opts) {
        var scrts = [];
        scrts[0] = "(function(){return new (function() {";
        scrts[1] = scriptStr;
        scrts[2] = "})();})();";
        try {
            return eval(scrts.join(""))
        } catch (exception) {
            alert("�ͻ������ɸ�ʽ���쳣��" + exception.toString())
        }
    },
    _doInit: function() {
        this.editorProvider = null ;
        this.controlProvider = null ;
        this.setCellControlProvider(new DNA.widget.CellControlProvider());
        this.fireDataChangeBySelf = false;
        this.currentCellChangedOnlyFireClient = false;
        this._eventListenerTable = {}
    },
    init: function() {
        DNA.widget.Grid2GC.superclass.init.call(this)
    },
    _setDoit: function(a, b) {
        a.result.doit = b ? this.GridCom.RESULT_TRUE : this.GridCom.RESULT_FALSE
    },
    _registGCListener: function() {
        this.gc.addListener("gridClick", this._gcClickListener, this);
        this.gc.addListener("cellMouseOut", this._gcCellMouseOutListener, this);
        this.gc.addListener("cellMouseIn", this._gcCellMouseInListener, this);
        this.gc.addListener("colExchange", this._gcColExchangeListener, this);
        this.gc.addListener("scrolled", this._gcScrolledListener, this);
        this.gc.addListener("selection", this._gcSelectionListener, this);
        this.gc.addListener("rowResize", this._gcRowresizeListener, this);
        this.gc.addListener("colResize", this._gcColresizeListener, this);
        this.gc.addListener("paste", this._gcPasteListener, this);
        this.gc.addListener("pasted", this._gcPastedListener, this);
        this.gc.addListener("copy", this._gcCopyListener, this);
        this.gc.addListener("currentCellChanged", this._gcCurrentCellChangedListener, this);
        this.gc.addListener("currentCellChanging", this._gcCurrentCellChangingListener, this);
        this.gc.addListener("paging", this._gcPagingListener, this);
        this.gc.addListener("cellChecked", this._gcCellCheckedListener, this);
        this.gc.addListener("cellExpand", this._gcCellExpandListener, this);
        this.gc.addListener("cellCollapse", this._gcCellCollapseListener, this);
        this.gc.addListener("selectionChange", this._gcSelectionChangeListener, this);
        this.gc.addListener("editorOpen", this._gcEditorOpenListener, this);
        this.gc.addListener("editorResize", this._gcEditorResizeListener, this);
        this.gc.addListener("editorShow", this._gcEditorShowListener, this);
        this.gc.addListener("editorHide", this._gcEditorHideListener, this);
        this.gc.addListener("editorClose", this._gcEditorCloseListener, this);
        this.gc.addListener("dataChange", this._gcDataChangeListener, this);
        this.gc.addListener("controlResize", this._gcControlResizeListener, this);
        this.gc.addListener("controlArrived", this._gcControlArrivedListener, this);
        this.gc.addListener("dataLoadEvent", this._gcDataLoadListener, this);
        this.gc.addListener("dataLoaded", this._gcDataLoadedListener, this);
        this.gc.addListener("mousewheel", this._gcMouseWheelListener, this)
    },
    _gcClickListener: function(b) {
        var a = b.origin;
        var c = new DNA.JWTEvent(a);
        c.setLocation({
            x: b.x,
            y: b.y
        });
        this.fireEvent("gridClick", [c, this])
    },
    _gcCellMouseOutListener: function(a) {
        this.fireEvent("cellout", [this, {
            x: a.cell.getCol(),
            y: a.cell.getRow()
        }])
    },
    _gcCellMouseInListener: function(a) {
        this.fireEvent("cellin", [this, {
            x: a.cell.getCol(),
            y: a.cell.getRow(),
            width: a.x,
            height: a.y
        }])
    },
    _gcMouseWheelListener: function(a) {
        this.fireEvent("mousewheel", [this, a.direction])
    },
    _gcColExchangeListener: function(a) {
        var b = {};
        b.doit = true;
        b.col = a.col1;
        b.tobeExchange = a.col2;
        this.fireEvent("colExchange", [this, b]);
        this._setDoit(a, b.doit)
    },
    _gcScrolledListener: function(b) {
        var a = DNA.engine.application.getJWTEventMgr();
        a.fireEvent("scroll", [b.origin]);
        this.fireEvent("scrolled", [this])
    },
    _gcSelectionListener: function(a) {
        this.fireEvent("selection", [this])
    },
    _gcRowresizeListener: function(a) {
        this.fireEvent("rowresize", [this, a.row, a.height])
    },
    _gcColresizeListener: function(a) {
        this.fireEvent("colresize", [this, a.col, a.width])
    },
    _gcPasteListener: function(c) {
        var a = c.cbText;
        var d = c.col + "," + c.row;
        var b = {
            doit: true
        };
        this.fireEvent("paste", [this, a, d, b]);
        this._setDoit(c, b.doit)
    },
    _gcPastedListener: function(h) {
        var g = h.rect;
        for (var c = 0; c < g.width; c++) {
            for (var b = 0; b < g.height; b++) {
                var a = this.getCell(c, b);
                var d = this.getFormattedText(a);
                if (d) {
                    a.setShowText(d, true)
                }
            }
        }
    },
    _gcCopyListener: function(b) {
        var a = {
            doit: true
        };
        this.fireEvent("copy", [this, {
            x: b.col,
            y: b.row,
            width: (b.width + b.col - 1),
            height: (b.height + b.row - 1)
        }, a]);
        this._setDoit(b, a.doit)
    },
    _gcPagingListener: function(b) {
        var a = {
            widget: this,
            srcEvent: new DNA.JWTEvent(b.origin),
            doit: true
        };
        this.fireEvent("paging", [a]);
        this._setDoit(b, a.doit)
    },
    _gcCellCheckedListener: function(b) {
        var a = b.origin;
        a.widget = this;
        var c = b.cell;
        a.cell = {
            x: c.getCol(),
            y: c.getRow()
        };
        a.isCtrl = function() {
            return a.ctrlKey
        }
        ;
        a.isAlt = function() {
            return a.altKey
        }
        ;
        a.isShift = function() {
            return a.shiftKey
        }
        ;
        a.checked = b.checked;
        this.fireEvent("cellCheck", [a])
    },
    _gcCellExpandListener: function(b) {
        var a = {
            widget: this,
            target: this.getCurrentCell()
        };
        this.fireCellExpandEvent(a)
    },
    _gcCellCollapseListener: function(b) {
        var a = {
            widget: this,
            target: this.getCurrentCell()
        };
        this.fireCellCollapseEvent(a)
    },
    _gcCurrentCellChangedListener: function(d) {
        var c = d.cause;
        var b = 0;
        switch (d.button) {
        case 1:
            b = 0;
            break;
        case 2:
            b = 2;
            break;
        case 4:
            b = 1;
            break
        }
        if (this.currentCellChangedOnlyFireClient) {
            var a = function(g, h) {
                this.fireEvent("currentCellChangedByServer", [this, g, h])
            }
            ;
            DNA.adapter.browserPage.addFinalTask([a, this, [b, DNA.widget.JWTGrid2.SETCURRENTCELLCAUSE_PROGRAM]])
        } else {
            this.fireEvent("currentCellChanged", [this, b, c])
        }
    },
    fullUpdateSetCurrentCell: function(a) {
        this.currentCellChangedOnlyFireClient = true;
        this.setCurrentCell(a);
        this.currentCellChangedOnlyFireClient = false
    },
    _gcCurrentCellChangingListener: function(b) {
        var a = {
            widget: this,
            target: (b.col == -1 && b.row == -1) ? null  : {
                x: b.col,
                y: b.row
            },
            lastCurrent: this.getCurrentCell(),
            doit: true
        };
        this.fireEvent("currentCellChanging", [a]);
        this._setDoit(b, a.doit)
    },
    _gcSelectionChangeListener: function(c) {
        var b = {
            x: c.oldSelection.x,
            y: c.oldSelection.y,
            width: c.oldSelection.width,
            height: c.oldSelection.height
        };
        var a = {
            x: c.newSelection.x,
            y: c.newSelection.y,
            width: c.newSelection.width,
            height: c.newSelection.height
        };
        this.fireEvent("selectionChange", [this, b, a])
    },
    _gcDataChangeListener: function(b) {
        if (!this.fireDataChangeBySelf) {
            var a = b.rect;
            this.fireDataChangeEvent({
                x: a.x,
                y: a.y,
                width: a.x + a.width - 1,
                height: a.y + a.height - 1
            }, this._getDataChangeCause(b.cause))
        }
    },
    _getDataChangeCause: function(b) {
        var a = DNA.widget.JWTGrid2.DATACHANGE_INPUT;
        if (b) {
            switch (b) {
            case this.GridCom.CAUSE_CALL:
                a = DNA.widget.JWTGrid2.DATACHANGE_PROGRAM;
                break;
            case this.GridCom.CAUSE_INPUT:
                a = DNA.widget.JWTGrid2.DATACHANGE_INPUT;
                break;
            case this.GridCom.CAUSE_CUT:
                a = DNA.widget.JWTGrid2.DATACHANGE_CUT;
                break;
            case this.GridCom.CAUSE_PASTE:
                a = DNA.widget.JWTGrid2.DATACHANGE_PASTE;
                break;
            case this.GridCom.CAUSE_DELETE:
                a = DNA.widget.JWTGrid2.DATACHANGE_DEL;
                break;
            default:
                a = DNA.widget.JWTGrid2.DATACHANGE_INPUT;
                break
            }
        }
        return a
    },
    _gcDataLoadListener: function(a) {
        this.fireEvent("dataLoad", [this, a])
    },
    _gcDataLoadedListener: function(g) {
        for (var d = 0; d < g.list.length; d++) {
            var b = g.list[d];
            b.begin + "," + b.end + ";";
            for (var c = 0; c < this.controlCells.length; c++) {
                var a = this.controlCells[c];
                if (a.y >= b.begin && a.y <= b.end) {
                    this.addControl(a.x, a.y, a.eid);
                    this.openControlByCellPosition(a)
                }
            }
        }
    },
    reInitEditor: function() {
        if (this.gc.isEditing()) {
            this._gcEditorOpenListener({
                cell: this.gc.getCurrentCell(),
                result: {},
                cause: {}
            })
        }
    },
    _gcEditorOpenListener: function(n) {
        var b = n.cell.getEditorId();
        if (!b) {
            b = this.gc.getDefaultEditorId()
        }
        var g = DNA.widget.WidgetRegistry.get(b);
        if (g) {
            g.grid = this;
            g.setVisible(true);
            n.cell.setEditor(g.getEl());
            if (g.jtype === "Text") {
                if (!g.hasListener("keydown", g, this._eidtorKeyDown)) {
                    g.addListener("keydown", this._eidtorKeyDown, g)
                }
            }
            var l = DNA.adapter.adapterFactory.get(g.jtype);
            var a = l.getWrapper(g);
            var o = n.cell.getShowText() || "";
            var h = n.cell.getEditText() || "";
            if (n.cause.type == this.GridCom.CAUSE_KEY) {
                h = n.cause.value
            }
            if (a._hasEvent(DNA.JWT.CLIENT_EVENT_GRID_EDITOR_INIT)) {
                var m = this.convertDetail(n.cause.type);
                var d = new DNA.adapter.ClientGridCellEditorEvent(m);
                d.setShowText(o);
                d.setEditText(h);
                a._fireClientEvent(DNA.JWT.CLIENT_EVENT_GRID_EDITOR_INIT, d)
            } else {
                if (!o || o == " ") {
                    o = ""
                }
                if (!h || h == " " || h == "") {
                    h = o
                }
                if (g.jtype === "Text" || g.jtype === "ComboPanel") {
                    g.setDescription(o);
                    g.setText(h);
                    g.processText();
                    g.fireEvent("document", [g])
                } else {
                    if (g.jtype === "Spinner") {
                        try {
                            var p = parseInt(h);
                            if (!isNaN(p)) {
                                g.setSelection(p)
                            } else {
                                g.setSelection(g.getMinimum())
                            }
                        } catch (n) {
                            g.setSelection(g.getMinimum())
                        }
                    } else {
                        if (g.jtype === "DateTime") {
                            var c = new Date();
                            try {
                                c = Date.parse(eidtText, "Y-m-d");
                                g.setDate(c.getTime())
                            } catch (n) {
                                g.setDate(new Date().getTime())
                            }
                        }
                    }
                }
            }
            this._setDoit(n, false)
        }
    },
    convertDetail: function(a) {
        var b = DNA.widget.JWTGrid2.EDITOPEN_DBCLICK;
        switch (a) {
        case this.GridCom.CAUSE_MOUSE:
            b = DNA.widget.JWTGrid2.EDITOPEN_DBCLICK;
            break;
        case this.GridCom.CAUSE_KEY:
            b = DNA.widget.JWTGrid2.EDITOPEN_INPUT;
            break;
        case this.GridCom.CAUSE_CALL:
            b = DNA.widget.JWTGrid2.EDITOPEN_PROGRAM;
            break;
        case this.GridCom.CAUSE_CLICKFACE:
            b = DNA.widget.JWTGrid2.EDITOPEN_CLICKFACE;
            break
        }
        return b
    },
    _eidtorKeyDown: new DNA.engine.Action({
        handle: function(c) {
            switch (c.getKeyCode()) {
            case DNA.JWTEvent.LEFT:
                var b = this.getSelectPoint();
                if (b.x != b.y) {
                    break
                }
                if (b.x === 0) {
                    this.grid.gc.keyDirection(this.grid.GridCom.ENTER_NEXT_LEFT)
                }
                break;
            case DNA.JWTEvent.RIGHT:
                var b = this.getSelectPoint();
                if (b.x != b.y) {
                    break
                }
                var a = this.getText().length;
                if (b.y === a) {
                    this.grid.gc.keyDirection(this.grid.GridCom.ENTER_NEXT_RIGHT)
                }
                break;
            default:
                break
            }
        }
    }),
    _gcEditorResizeListener: function(d) {
        var b = d.size;
        var a = d.cell.getEditorId();
        if (!a) {
            a = this.gc.getDefaultEditorId()
        }
        var c = DNA.widget.WidgetRegistry.get(a);
        if (c) {
            c.getEl().style.position = "absolute";
            c.setSize(b.width - 1, b.height - 1);
            this._setDoit(d, false)
        }
    },
    _gcControlResizeListener: function(d) {
        var b = d.size;
        var a = d.cell.getClientData().ei;
        var c = DNA.widget.WidgetRegistry.get(a);
        if (c) {
            c.getEl().style.position = "absolute";
            c.setSize(b.width, b.height)
        }
        this._setDoit(d, false)
    },
    _gcControlArrivedListener: function(c) {
        var a = c.cell.getClientData().ei;
        var b = DNA.widget.WidgetRegistry.get(a);
        if (b) {
            this.util.rebuildControl(b)
        }
    },
    _gcEditorShowListener: function(g) {
        var h = this;
        this.focusable = false;
        var a = g.cell;
        var b = g.cell.getEditorId();
        if (!b) {
            b = this.gc.getDefaultEditorId()
        }
        var d = DNA.widget.WidgetRegistry.get(b);
        this.editorShowTimeout = setTimeout(function() {
            h.editorShowTimeout = null ;
            if (d) {
                h.focus();
                d.focus();
                if (d.jtype === "Text") {
                    var n = d.getText();
                    if (n && n != "") {
                        var l = n.length;
                        if (g.cause.type == h.GridCom.CAUSE_MOUSE) {
                            d.setSelectPoint(0, l)
                        } else {
                            d.setSelectPoint(l, l)
                        }
                    }
                }
            }
            var m = DNA.adapter.adapterFactory.get(d.jtype);
            var p = m.getWrapper(d);
            if (p._hasEvent(DNA.JWT.CLIENT_EVENT_GRID_EDITOR_OPEN)) {
                var o = new DNA.adapter.ClientEvent();
                p._fireClientEvent(DNA.JWT.CLIENT_EVENT_GRID_EDITOR_OPEN, o, true)
            }
        }, 1);
        var c = {
            grid: this,
            col: a.getCol(),
            row: a.getRow(),
            showText: a.getShowText(),
            editText: a.getEditText()
        };
        this.fireEvent("beforeedit", [c]);
        this._setDoit(g, false)
    },
    _gcEditorHideListener: function(d) {
        var a = d.cell;
        var b = d.cell.getEditorId();
        if (!b) {
            b = this.gc.getDefaultEditorId()
        }
        var c = DNA.widget.WidgetRegistry.get(b);
        if (c) {
            c.setVisible(false)
        }
        this._setDoit(d, false)
    },
    _gcEditorCloseListener: function(l) {
        if (this.editorShowTimeout) {
            clearTimeout(this.editorShowTimeout);
            this.editorShowTimeout = null 
        }
        this.focusable = true;
        var n = l.cell;
        var d = l.cell.getEditorId();
        if (!d) {
            d = this.gc.getDefaultEditorId()
        }
        var g = DNA.widget.WidgetRegistry.get(d);
        var b = this._editorGetResult(g, this._parseGetResultCause(l));
        if (!b) {
            this.focus();
            this._setDoit(l, false);
            return
        }
        var m = b.getShowText();
        var h = b.getEditText();
        var c = {
            grid: this,
            col: n.getCol(),
            row: n.getRow(),
            showText: m,
            editText: h
        };
        this.fireEvent("afteredit", [c]);
        n.setEditText(c.editText, true);
        var a = this.getFormattedText(n);
        var o = a ? a : c.showText;
        n.setShowText(o, true);
        this.focus();
        this._setDoit(l, false)
    },
    _parseGetResultCause: function(b) {
        var a = 0;
        if (b.cause && b.cause < 0) {
            a = 0 - b.cause
        }
        return a
    },
    getFormattedText: function(a) {
        try {
            var b = this.formatterMgr.getFormatter(a.getClientData().fi);
            if (b) {
                return b.format(a.getEditText())
            }
        } catch (c) {
            return null 
        }
    },
    _editorGetResult: function(g, b) {
        var l = g.getData("wrapper");
        var a = "";
        var d = "";
        if (l._hasEvent(DNA.JWT.CLIENT_EVENT_GRID_EDITOR_GETVALUE)) {
            var h = new DNA.adapter.ClientGridCellEditorEvent(b ? b : 0);
            l._fireClientEvent(DNA.JWT.CLIENT_EVENT_GRID_EDITOR_GETVALUE, h, true);
            if (!h.doit) {
                return null 
            }
            a = h.getShowText();
            d = h.getEditText()
        } else {
            if (g.jtype === "Text") {
                d = g.getText();
                a = d
            } else {
                if (g.jtype === "ComboPanel") {
                    d = g.getText();
                    a = g.getDescription()
                } else {
                    if (g.jtype === "Spinner") {
                        d = g.getSelection() + "";
                        a = d
                    } else {
                        if (g.jtype === "DateTime") {
                            var c = g.getDate();
                            d = c.format("Y-m-d");
                            a = d
                        }
                    }
                }
            }
            if (!a) {
                a = d
            }
        }
        return new DNA.widget.CommonCellContent(a,d)
    },
    openCurrentEditor: function() {
        var a = this.getCurrentCell();
        if (!a) {
            return
        }
        this.gc.openEditor(a.x, a.y)
    },
    computeSize: function(d, b, g) {
        var c = new DNA.widget.Point();
        if (this.checkRendered()) {
            if (d != -1 && b != -1) {
                c.x = d;
                c.y = b
            } else {
                var a = this.getBorderSize();
                c.x += a;
                c.y += a;
                c.x += this.gc.getDataWidth();
                c.y += this.gc.getDataHeight();
                if (d != -1) {
                    if (c.x > d) {
                        c.y += 18
                    }
                    c.x = d
                }
                if (b != -1) {
                    if (c.y > b) {
                        c.x += 18
                    }
                    c.y = b
                }
            }
        } else {
            c.x = 100;
            c.y = 100
        }
        return c
    },
    getScrollPosition: function() {
        var a = this.getBounds().height;
        if (a === 0) {
            return null 
        }
        var b = this.gc.getDataHeight();
        var d = (b - a);
        var c = 2;
        if (b <= a) {
            return null 
        }
        if (this.getScrollTop() <= c) {
            return "top"
        }
        if (this.getScrollTop() + a + c >= b) {
            return "bottom"
        }
        return "middle"
    },
    _doBuildElements: function() {
        this.tDiv = this.el;
        this.gcDiv = this.tDiv.firstChild;
        this.gridOption = this.getInitData().gridOption;
        delete this.getInitData().gridOption;
        var n = DNA.engine.DomUtil.getClientSize(this.tDiv);
        DNA.engine.DomUtil.setSize(this.gcDiv, n);
        this.listFace = this.tDiv.childNodes[1];
        this.btnFace = this.tDiv.childNodes[2];
        this.controlCells = [];
        this.GridCom = COM.widget.Grid;
        var g = DNA.engine.JsonUtil.decode(this.getInitData()["initValue"]);
        delete this.getInitData()["initValue"];
        this.GridCom.deserialize(g);
        var a = {
            eventSource: {
                mousedown: this,
                keydown: this
            }
        };
        this.gc = new COM.widget.Grid(this.gcDiv,g,a);
        if (this.gc.setVisible) {
            this.gc.setVisible(this.isVisible())
        }
        this._registGCListener();
        this.gc.setSize(n.width, n.height);
        this.gc.setCopyFunction(DNA.adapter.ClipboardUtil.copyToClipboard, DNA.adapter.ClipboardUtil);
        this.gc.setPasteFunction(DNA.adapter.ClipboardUtil.getClipboard, DNA.adapter.ClipboardUtil);
        var l = this.getInitData().cccf;
        delete this.getInitData().cccf;
        if (l) {
            var d = l.split(",");
            var m = d[0];
            var b = d[1];
            this.setCurrentCellColor(m, b)
        }
        var h = new this.GridCom.Grid2Adapter();
        h.setFace(1, this.btnFace);
        h.setFace(2, this.listFace);
        h.setGetFaceFun(function(o) {
            return o.getClientData().gcFace
        });
        h.init(this.gc);
        this.setCellEditorProvider(new DNA.widget.CellEditorProvider());
        this._initFormatter();
        if (!this.isEnabled()) {
            this._disableGrid(this)
        }
        var c = DNA.widget.CssStyleFinder._findStyleFromCssSheet("grid2_header_cursor", "cursor");
        if (c) {
            this.gc.setColHeadCursor(c);
            this.gc.setRowHeadCursor(c)
        }
    },
    _afterGridCreate: function() {
        if (!(this.el.tagName == "IFRAME")) {
            if (this.getInitData().defEditorId) {
                var c = this.getInitData().defEditorId;
                delete this.getInitData().defEditorId;
                var h = DNA.widget.WidgetRegistry.get(c);
                if (h) {
                    this.gc.setDefaultEditor(h.getEl())
                }
            }
            if (this.getInitData().selections) {
                var g = this.getInitData().selections;
                delete this.getInitData().selections;
                this.setSelections(g)
            }
            if (this.getInitData().currentCell) {
                var a = this.getInitData().currentCell;
                delete this.getInitData().currentCell;
                this.setCurrentCell(a)
            }
            if (this.getInitData().open_editor) {
                delete this.getInitData().open_editor;
                this.openCurrentEditor()
            }
            var d = this.getInitData()[DNA.JWTProperty.PROPERTY_HORIZONTAL_POSITION];
            if (d != undefined) {
                delete this.getInitData()[DNA.JWTProperty.PROPERTY_HORIZONTAL_POSITION];
                this.setHorizontalPosition(d)
            }
            var b = this.getInitData()[DNA.JWTProperty.PROPERTY_VERTICAL_POSITION];
            if (b != undefined) {
                delete this.getInitData()[DNA.JWTProperty.PROPERTY_VERTICAL_POSITION];
                this.setVerticalPosition(b)
            }
            this._doCreateControls()
        }
    },
    setCurrentCellColor: function(a, b) {
        this.gc.setCurrentCellColor(this.getRGBAColor(a));
        this.gc.setBlurCurrentCellColor(this.getRGBAColor(b))
    },
    getRGBAColor: function(a) {
        return "rgba(" + this.getValueFromHexString(a.substring(1, 3)) + "," + this.getValueFromHexString(a.substring(3, 5)) + "," + this.getValueFromHexString(a.substring(5, 7)) + ",1)"
    },
    getValueFromHexString: function(d) {
        var a = "0123456789abcdef";
        var g = 0;
        for (var c = d.length - 1, b = 0; c >= 0; c--,
        b++) {
            g += a.indexOf(d.charAt(b)) << (c * 4)
        }
        return g
    },
    _doCreateControls: function() {
        if (this.isVisible()) {
            if (this.getInitData().controlCells) {
                this.controlCells = this.getInitData().controlCells;
                delete this.getInitData().controlCells;
                this._createControls()
            }
        }
    },
    _createControls: function() {
        if (this.controlCells && (this.getStyle() & DNA.JWT.ASYNC) === 0) {
            for (var b = 0; b < this.controlCells.length; b++) {
                var a = this.controlCells[b];
                this.addControl(a.x, a.y, a.eid);
                this.openControlByCellPosition(a)
            }
        }
    },
    _resizeGridDiv: function() {
        if (this.el.tagName == "IFRAME") {
            this.tDiv = this.el.contentWindow.document.body.firstChild;
            var a = DNA.engine.DomUtil.getClientSize(this.el);
            this.tDiv.style.height = a.height + "px";
            this.tDiv.style.width = a.width + "px";
            this.gc.setSize(a.width, a.height)
        }
    },
    _clearChildrenEl: function(b) {
        var d = b.getChildren();
        for (var c = 0, a = d.length; c < a; c++) {
            var g = d[c];
            if (g.getChildren) {
                if (g.getChildren()) {
                    this._clearChildrenEl(g)
                }
            }
            if (g.el) {
                g.fireEvent("beforeReplace");
                g._unmaskState(DNA.JWT.STATE_RENDERD);
                if (g.el) {
                    g.el = null 
                }
            }
        }
    },
    _isResizeable: function() {
        if (this.getEl()) {
            return true
        }
    },
    doDispose: function() {
        DNA.widget.Grid2GC.superclass.doDispose.call(this);
        delete this.util;
        this.gc.dispose();
        delete this.gcDiv;
        delete this.listFace;
        delete this.btnFace;
        delete this.controlCells;
        delete this.GridCom;
        delete this.gc;
        delete this._eventListenerTable
    },
    _doAfterParentVisible: function() {
        if (!this.tDiv) {
            return
        }
        if (this.el && this.el.tagName == "IFRAME") {
            var a = DNA.engine.DomUtil.getClientSize(this.el);
            DNA.engine.DomUtil.setSize(this.tDiv, a);
            this.gc.setSize(a.width, a.height)
        }
    },
    _focus: function() {
        this._focusDom()
    },
    _registEvents: function() {
        var a = DNA.engine.application.getJWTEventMgr();
        a.addBubbleListener("keydown", this.onBubbleKeyDown, this);
        this.addListener("mousedown", this._onMousedown);
        this.addListener("keydown", this._onKeyDown);
        this.addListener("dragover", this._doDragOver);
        this.addListener("resize", this._doResize);
        a.addListener(DNA.JWTEvent.POSTVISIBLE, this._doAfterVisible, this);
        a.addListener(DNA.JWTEvent.PREHIDDEN, this._doBeforeHidden, this);
        a.addBubbleListener(DNA.JWTEvent.MOUSEDOWN, this._onMousedown, this);
        this.addListener("focus", this._onFocus);
        this.addListener("blur", this._onBlur);
        a.addListener(DNA.JWTEvent.PRE_DISABLED, this._onDisable, this);
        a.addListener(DNA.JWTEvent.POST_ENABLED, this._onEnable, this)
    },
    _disable: function() {
        this._disableGrid(this);
        DNA.widget.Grid2GC.superclass._disable.call(this)
    },
    _onDisable: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            this._disableGrid(a)
        }
    }),
    _onEnable: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            this._enableGrid(a)
        }
    }),
    _disableGrid: function(a) {
        if (a.isAncestorOf(this)) {
            this.gc.setEnabled(false)
        }
    },
    _enableGrid: function(a) {
        if (a.isAncestorOf(this)) {
            this.gc.setEnabled(true)
        }
    },
    _onFocus: new DNA.engine.Action({
        handle: function(a) {
            if (this.gc.getActiveEditor()) {
                return
            }
            this.gc.focus()
        }
    }),
    _onBlur: new DNA.engine.Action({
        handle: function(a) {
            this.gc.blur()
        }
    }),
    _doAfterVisible: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            if (a.isAncestorOf(this)) {
                this._doCreateControls();
                this.processAddControl();
                this._doResizeGCDiv();
                if (this.gc.setVisible) {
                    this.gc.setVisible(true)
                }
            }
        }
    }),
    _doBeforeHidden: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            if (a.isAncestorOf(this) && this.gc.setVisible) {
                this.gc.setVisible(false)
            }
        }
    }),
    _doDragOver: new DNA.engine.Action({
        handle: function(c) {
            if (!this.checkRendered(true)) {
                return
            }
            if (!this.el) {
                return
            }
            var b = c.getXY();
            var a = DNA.engine.DomUtil.getPageXY(this.el);
            a = {
                x: b.x - a.x,
                y: b.y - a.y
            };
            a = this.getCellByPoint(a.x, a.y);
            if (a) {
                this.posInfo = a.x + "," + a.y
            } else {
                this.posInfo = "-1,-1"
            }
        }
    }),
    setHorizontalPosition: function(a) {
        if (this.tDiv) {
            this.gc.setScrollLeft(a)
        }
    },
    setVerticalPosition: function(a) {
        if (this.tDiv) {
            this.gc.setScrollTop(a)
        }
    },
    _doBubbleMouseDown: new DNA.engine.Action({
        handle: function(a) {}
    }),
    onBubbleKeyDown: new DNA.engine.PreventableAction({
        handle: function(a) {
            if (!a.isCtrl() && !a.isAlt() && a.getKeyCode() == DNA.JWTEvent.ENTER) {
                this.focus();
                this.gc.keyEnter();
                a.preventDefault()
            }
        }
    }),
    _onGlobalMousemove: new DNA.engine.Action({
        handle: function(a) {}
    }),
    _onMousedown: new DNA.engine.Action({
        handle: function(a) {
            if (this._eventListenerTable.mousedown) {
                this._eventListenerTable.mousedown.call(this.gc, a._browserEvent)
            }
        }
    }),
    _onKeyDown: new DNA.engine.Action({
        handle: function(a) {
            if (this._eventListenerTable.keydown) {
                this._eventListenerTable.keydown.call(this.gc, a._browserEvent)
            }
        }
    }),
    deleteText: function() {
        var b = this.gc.getSelections().length;
        for (var c = 0; c < b; ++c) {
            this.gc.clearText(this.gc.getSelections()[c])
        }
        var g = this.gc.getCurrentCell();
        if (g) {
            var a = this.gc.getCell(g.x, g.y);
            if (a.getShowText()) {
                var d = {
                    x: g.x,
                    y: g.y,
                    width: 1,
                    height: 1
                };
                this.gc.clearText(d)
            }
        }
    },
    pasteText: function(a) {
        if (!a || a.x === undefined || a.y === undefined) {
            var b = this.getCurrentCell();
            if (b) {
                a = {
                    x: b.x,
                    y: b.y,
                    width: -1,
                    height: -1
                }
            }
        }
        this.gc.paste(a)
    },
    copyText: function(c) {
        var b = null ;
        var a = this.gc.getSelection();
        if (c) {
            b = {
                x: c.x,
                y: c.y,
                width: (c.width - c.x + 1),
                height: (c.height - c.y + 1)
            }
        } else {
            if (a) {
                b = a
            } else {
                var g = this.gc.getCurrentCell();
                if (g) {
                    b = {
                        x: g.x,
                        y: g.y,
                        width: 1,
                        height: 1
                    }
                }
            }
        }
        if (b) {
            var d = {
                doit: true
            };
            this.fireEvent("copy", [this, {
                x: b.x,
                y: b.y,
                width: b.width,
                height: b.height
            }, d]);
            if (!d.doit) {
                return null 
            }
            return this.gc.copy(b)
        }
        return null 
    },
    cutText: function() {
        var a = this.gc.getCurrentSelection();
        if (a) {
            var b = this.gc.cut(a);
            if (b) {
                return b
            }
        }
        return null 
    },
    toString: function() {
        return "Grid2GC"
    },
    getCellByPoint: function(a, c) {
        if (!this.checkRendered(true)) {
            return
        }
        var b = this.gc.getCellByPoint(a, c);
        return {
            x: b.col,
            y: b.row
        }
    },
    getCell: function(a, b) {
        if (!this.checkRendered(true)) {
            return
        }
        return this.gc.getCell(a, b)
    },
    merge: function(d, c, b, a) {
        return this.gc.mergeCell(d, c, b, a)
    },
    unmerge: function(a, b) {
        this.gc.unMergeCell(a, b)
    },
    setRowHeight: function(b, a) {
        if (!this.checkRendered(true)) {
            return
        }
        this.gc.setRowHeight(b, a)
    },
    getRowHeight: function(a) {
        if (!this.checkRendered(true)) {
            return 0
        }
        return this.getRowHidden(a) ? 0 : this.gc.getRowHeight(a)
    },
    setColumnWidth: function(a, b) {
        if (!this.checkRendered(true)) {
            return
        }
        this.gc.setColWidth(a, b)
    },
    getColumnWidth: function(a) {
        if (!this.checkRendered(true)) {
            return 0
        }
        return this.getColHidden(a) ? 0 : this.gc.getColWidth(a)
    },
    _doResize: new DNA.engine.Action({
        handle: function(a) {
            this._doResizeGCDiv()
        }
    }),
    _doResizeGCDiv: function() {
        if (!this._isResizeable()) {
            return
        }
        if (this.el && this.tDiv && this.gcDiv) {
            var a = DNA.engine.DomUtil.getClientSize(this.el);
            if (this.el.tagName == "IFRAME") {
                DNA.engine.DomUtil.setSize(this.tDiv, a)
            }
            DNA.engine.DomUtil.setSize(this.gcDiv, a);
            if (this.isVisible()) {
                this.gc.setVisible(true)
            }
            this.gc.setSize(a.width, a.height)
        }
    },
    insertRows: function(a, g, h, d, c, b) {
        if (!this.checkRendered(true)) {
            return
        }
        this.currentCellChangedOnlyFireClient = true;
        this.gc.insertRows(a, g, h);
        this.currentCellChangedOnlyFireClient = false;
        if (d) {
            this._doExpendIndentation(a, g, c, b)
        }
    },
    _doExpendIndentation: function(h, g, b, d) {
        var n = this.getCell(b, h - 1);
        var a = n.getCheckable();
        for (var c = 0; c < g; c += 1) {
            var m = h + c;
            var l = this.getCell(b, m);
            l.setDepth(d);
            l.setCheckable(a)
        }
    },
    deleteRows: function(a, b) {
        if (!this.checkRendered(true)) {
            return
        }
        this.gc.deleteRows(a, b)
    },
    insertColumns: function(a, b, c) {
        if (!this.checkRendered(true)) {
            return
        }
        this.currentCellChangedOnlyFireClient = true;
        this.gc.insertCols(a, b, c);
        this.currentCellChangedOnlyFireClient = false
    },
    _reverse: function(a) {
        if (a) {
            return a.split("").reverse().join("")
        }
        return ""
    },
    deleteColumns: function(a, b) {
        if (!this.checkRendered(true)) {
            return
        }
        this.gc.deleteCols(a, b)
    },
    setColGrab: function(a, b) {
        this.gc.setColGrab(a, b)
    },
    getColGarb: function(a) {
        return this.gc.isColGrab(a)
    },
    getColGrabEnable: function() {
        return this.gc.isColGrabable()
    },
    getCurBorderHiddden: function() {
        return this.gc.isCurrenCellBorderHidden()
    },
    getRowVisible: function(a) {
        return !this.gc.isRowHidden(a)
    },
    setRowHidden: function(b, a) {
        if (!this.checkRendered(true)) {
            return
        }
        this.gc.setRowVisible(b, !a)
    },
    setColumnHidden: function(b, a) {
        if (!this.checkRendered(true)) {
            return
        }
        this.gc.setColVisible(b, !a)
    },
    getColHidden: function(a) {
        if (!this.checkRendered(true)) {
            return false
        }
        return this.gc.isColHidden(a)
    },
    getRowHidden: function(a) {
        if (!this.checkRendered(true)) {
            return false
        }
        return this.gc.isRowHidden(a)
    },
    setColAutoWidth: function(a, b) {
        if (!this.checkRendered(true)) {
            return false
        }
        this.gc.setColAutoWidth(a, b)
    },
    setRowAutoHeight: function(b, a) {
        if (!this.checkRendered(true)) {
            return false
        }
        this.gc.setRowAutoHeight(b, a)
    },
    setGridOption: function(a) {
        this.gridOption = a;
        this.setEditMode(this.gridOption & DNA.widget.JWTGrid2.EDIT_MODE_MASK);
        this.setEnterNext(this.gridOption & DNA.widget.JWTGrid2.ENTER_NEXT_MASK);
        this.setSelectionMode(this.gridOption & DNA.widget.JWTGrid2.SELECTION_MODE_MASK);
        this.gc.setColExchangeable((this.gridOption & DNA.widget.JWTGrid2.COL_EXCHANG_MASK) != 0);
        this.gc.setColGrabable((this.gridOption & (1 << 17)) != 0);
        this.gc.setCurrenCellBorderHidden((this.gridOption & (1 << 16)) != 0);
        this.setColSelectEnabled((this.gridOption & DNA.widget.JWTGrid2.COL_SELECT_MASK) != 0);
        this.setRowSelectEnabled((this.gridOption & DNA.widget.JWTGrid2.ROW_SELECT_MASK) != 0);
        this.setRowResizeEnable((this.gridOption & DNA.widget.JWTGrid2.ROW_RESIZE_MASK) != 0);
        this.setColResizeEnable((this.gridOption & DNA.widget.JWTGrid2.COL_RESIZE_MASK) != 0);
        this.setRowFreeResizeEnabled((this.gridOption & DNA.widget.JWTGrid2.ROW_FREE_RESIZE_MASK) != 0);
        this.setColFreeResizeEnabled((this.gridOption & DNA.widget.JWTGrid2.COL_FREE_RESIZE_MASK) != 0)
    },
    setDefEditor: function(a) {
        this.gc.setDefaultEditor(DNA.widget.WidgetRegistry.get(a).getEl())
    },
    setColumnCount: function(a) {
        this.gc.setColCount(a)
    },
    setRowCount: function(a) {
        this.gc.setRowCount(a)
    },
    getColumnCount: function() {
        return this.gc.getColCount()
    },
    getRowCount: function() {
        return this.gc.getRowCount()
    },
    setHeaderColumnCount: function(a) {
        this.gc.setColHeaderCount(a)
    },
    setHeaderRowCount: function(a) {
        this.gc.setRowHeaderCount(a)
    },
    getHeaderColumnCount: function() {
        return this.gc.getColHeaderCount()
    },
    getHeaderRowCount: function() {
        return this.gc.getRowHeaderCount()
    },
    setFooterColumnCount: function(a) {
        this.gc.setColFooterCount(a)
    },
    setFooterRowCount: function(a) {
        this.gc.setRowFooterCount(a)
    },
    getFooterColumnCount: function() {
        return this.gc.getColFooterCount()
    },
    getFooterRowCount: function() {
        return this.gc.getRowFooterCount()
    },
    setEditMode: function(b) {
        var a;
        switch (b) {
        case DNA.widget.JWTGrid2.EDIT_MODE_DESIGN:
            a = this.GridCom.EDIT_MODE_EDIT;
            break;
        case DNA.widget.JWTGrid2.EDIT_MODE_INPUT:
            a = this.GridCom.EDIT_MODE_INPUT;
            break;
        case DNA.widget.JWTGrid2.EDIT_MODE_READONLY:
            a = this.GridCom.EDIT_MODE_READ_ONLY;
            break
        }
        this.gc.setEditMode(a)
    },
    getEditMode: function() {
        var a = this.gc.getEditMode();
        var b;
        switch (a) {
        case this.GridCom.EDIT_MODE_EDIT:
            b = DNA.widget.JWTGrid2.EDIT_MODE_DESIGN;
            break;
        case this.GridCom.EDIT_MODE_INPUT:
            b = DNA.widget.JWTGrid2.EDIT_MODE_INPUT;
            break;
        case this.GridCom.EDIT_MODE_READONLY:
            b = DNA.widget.JWTGrid2.EDIT_MODE_READONLY;
            break
        }
        return b
    },
    setSelectionMode: function(b) {
        var a;
        switch (b) {
        case DNA.widget.JWTGrid2.SELECTION_MODE_MULTI:
            a = this.GridCom.SELECTION_MODE_MULTI;
            break;
        case DNA.widget.JWTGrid2.SELECTION_MODE_SINGLE:
            a = this.GridCom.SELECTION_MODE_SINGLE;
            break;
        case DNA.widget.JWTGrid2.SELECTION_MODE_ROW:
            a = this.GridCom.SELECTION_MODE_ROW;
            break
        }
        this.gc.setSelectionMode(a)
    },
    getSelectionMode: function() {
        var a = this.gc.getSelectionMode();
        var b;
        switch (a) {
        case this.GridCom.SELECTION_MODE_MULTI:
            b = DNA.widget.JWTGrid2.SELECTION_MODE_MULTI;
            break;
        case this.GridCom.SELECTION_MODE_SINGLE:
            b = DNA.widget.JWTGrid2.SELECTION_MODE_SINGLE;
            break;
        case this.GridCom.SELECTION_MODE_ROW:
            b = DNA.widget.JWTGrid2.SELECTION_MODE_ROW;
            break
        }
        return b
    },
    setRowResizeEnable: function(a) {
        this.gc.setRowResizeable(a)
    },
    getRowResizeEnable: function() {
        return this.gc.isRowResizeable()
    },
    setColResizeEnable: function(a) {
        this.gc.setColResizeable(a)
    },
    getColResizeEnable: function() {
        return this.gc.isColResizeable()
    },
    setRowSelectEnabled: function(a) {
        this.gc.setRowSelectable(a)
    },
    getRowSelectEnabled: function() {
        return this.gc.isRowSelectable()
    },
    setRowFreeResizeEnabled: function(a) {
        this.gc.setRowFreeResizeable(a)
    },
    getRowFreeResizeEnabled: function() {
        return this.gc.isRowFreeResizeable()
    },
    setColFreeResizeEnabled: function(a) {
        this.gc.setColFreeResizeable(a)
    },
    getColFreeResizeEnabled: function() {
        return this.gc.isColFreeResizeable()
    },
    setColSelectEnabled: function(a) {
        this.gc.setColSelectable(a)
    },
    getColSelectEnabled: function() {
        return this.gc.isColSelectable()
    },
    setEnterNext: function(b) {
        var a;
        switch (b) {
        case DNA.widget.JWTGrid2.ENTER_NEXT_RIGHT:
            a = this.GridCom.ENTER_NEXT_RIGHT;
            break;
        case DNA.widget.JWTGrid2.ENTER_NEXT_DOWN:
            a = this.GridCom.ENTER_NEXT_DOWN;
            break;
        case DNA.widget.JWTGrid2.ENTER_NEXT_LEFT:
            a = this.GridCom.ENTER_NEXT_LEFT;
            break;
        case DNA.widget.JWTGrid2.ENTER_NEXT_UP:
            a = this.GridCom.ENTER_NEXT_UP;
            break
        }
        this.gc.setEnterNext(a)
    },
    getEnterNext: function() {
        var a = this.gc.getEnterNext();
        var b;
        switch (a) {
        case this.GridCom.ENTER_NEXT_RIGHT:
            b = DNA.widget.JWTGrid2.ENTER_NEXT_RIGHT;
            break;
        case this.GridCom.ENTER_NEXT_DOWN:
            b = DNA.widget.JWTGrid2.ENTER_NEXT_DOWN;
            break;
        case this.GridCom.ENTER_NEXT_LEFT:
            b = DNA.widget.JWTGrid2.ENTER_NEXT_LEFT;
            break;
        case this.GridCom.ENTER_NEXT_UP:
            b = DNA.widget.JWTGrid2.ENTER_NEXT_UP;
            break
        }
        return b
    },
    setRowBackground: function(b, a) {
        this.gc.setRowBackgroundColor(b, a)
    },
    setCurrentCell: function(a, b) {
        if (a) {
            this.focus();
            var d = this.getCurrentCell();
            if (d && a && d.x == a.x && d.y == a.y) {
                return
            }
            this.gc.setCurrentCell(a.x, a.y, b)
        } else {
            this.gc.setCurrentCell(-1, -1)
        }
    },
    _currentCellInSelection: function() {
        if (!this.currentCell) {
            return false
        }
        if (!this.selectionAreas || this.selectionAreas == 0) {
            return false
        }
        var c = {
            x: this.currentCell.getColIndex(),
            y: this.currentCell.getRowIndex()
        };
        for (var b = 0, a = this.selectionAreas.length; b < a; ++b) {
            if (this._isPointInRect(c, this.selectionAreas[b].getRange())) {
                return true
            }
        }
        return false
    },
    _isPointInRect: function(b, a) {
        if (b.x >= a.x && b.x < a.x + a.width && b.y >= a.y && b.y < a.y + a.height) {
            return true
        }
        return false
    },
    getCurrentCell: function() {
        var a = this.gc.getCurrentCell();
        if (a) {
            return {
                x: a.getCol(),
                y: a.getRow()
            }
        } else {
            return null 
        }
    },
    getSelections: function() {
        return this.gc.getSelections()
    },
    getSelection: function() {
        return this.gc.getSelection()
    },
    addSelection: function(b, d, c, a) {
        this.gc.addSelection(b, d, c, a)
    },
    setSelection: function(a) {
        this.gc.setSelection(a)
    },
    setSelections: function(a) {
        if (!this.checkRendered(true)) {
            return
        }
        this.gc.setSelections(a)
    },
    clearSelection: function() {
        this.gc.clearSelection()
    },
    setCellEditorProvider: function(a) {
        this.editorProvider = a
    },
    setCellControlProvider: function(a) {
        this.controlProvider = a
    },
    processAddControl: function() {
        if (this.getData("add_control")) {
            var b = this.getData("add_control");
            if (b) {
                for (var a = 0; a < b.length; a++) {
                    this.openControlByCellPosition(b[a])
                }
            }
            this.removeData("add_control")
        }
    },
    openControlByCellPosition: function(b) {
        var a = this.getCell(b.x, b.y);
        var c = a.getClientData().ei;
        if (c) {
            var d = DNA.widget.WidgetRegistry.get(c);
            if (d) {
                a.setControl(d.getEl())
            }
        }
    },
    addControl: function(b, c, a) {
        this.getCell(b, c).getClientData().ei = a
    },
    removeControl: function(c, d, b) {
        var a = this.getCell(c, d);
        if (a.getControl()) {
            DNA.widget.WidgetRegistry.get(b).setSize(0, 0);
            this.el.appendChild(a.getControl())
        }
        a.reomveControl()
    },
    setShowSelectingBorder: function(a) {
        this.gc.setShowSelectionBorder(a)
    },
    synchronizeData: function(b, g) {
        this.fireDataChangeBySelf = true;
        if (this.gc.getActiveEditor()) {
            var d = this._editorGetResult(DNA.widget.WidgetRegistry.get(this.gc.getActiveEditorId()));
            var c = d.getShowText();
            var h = d.getEditText();
            var a = this.gc.getCurrentCell();
            a.setShowText(c ? c : "");
            a.setEditText(h ? h : "");
            if (!g) {
                this.fireDataChangeEvent({
                    x: a.getCol(),
                    y: a.getRow(),
                    width: a.getCol(),
                    height: a.getRow()
                }, DNA.widget.JWTGrid2.DATACHANGE_INPUT, b)
            }
        }
        this.fireDataChangeBySelf = false
    },
    getActiveEditor: function() {
        var a = this.gc.getActiveEditorId();
        if (a) {
            return DNA.widget.WidgetRegistry.get(a)
        }
    },
    fireDataChangeEvent: function(c, b, a) {
        this.fireEvent("datachange", [this, c, b, a])
    },
    fireSelectionEvent: function() {
        this.fireEvent("selection", [this])
    },
    fireCurrentCellChangedEvent: function() {
        this.fireEvent("currentCellChanged", [this])
    },
    fireCurrentCellChangingEvent: function(a) {
        this.fireEvent("currentCellChanging", [a])
    },
    fireCellExpandEvent: function(a) {
        this.fireEvent("cellExpand", [a])
    },
    fireCellCollapseEvent: function(a) {
        this.fireEvent("cellCollapse", [a])
    },
    firePagingEvent: function(a) {
        this.fireEvent("paging", [a])
    },
    _focusDom: function(a) {
        if (this.gc.getActiveEditor()) {
            return
        }
        if (this.gc && this.gc.focus) {
            this.gc.focus()
        }
    },
    getScrollTop: function() {
        return this.gc.getScrollTop()
    },
    getScrollLeft: function() {
        return this.gc.getScrollLeft()
    },
    setScrollTop: function(a) {
        this.gc.setScrollTop(a)
    },
    setScrollLeft: function(a) {
        this.gc.setScrollLeft(a)
    },
    getClientHeight: function() {
        return this.tDiv.clientHeight
    },
    canCellEdit: function(b, a) {
        return this.gc.canCellEdit(b, a)
    },
    _getScrollElement: function() {
        return this.tDiv
    },
    _add: function(b, a) {
        if (a) {
            return this._renderChild(this.getBody(), DNA.JWT.RENDER_POS_TYPE_LAST, a)
        }
    },
    fullUpdateNoIframe: function(a) {
        this.tDiv.innerHTML = a;
        this._replaceDom()
    },
    loadData: function(a) {
        this.gc.loadData(DNA.engine.JsonUtil.decode(a))
    },
    addEventListener: function(a, b) {
        this._eventListenerTable[a] = b
    },
    isEventReachable: function(b, d, c, a) {
        if (!this.isDisposed() && b == DNA.JWTEvent.POSTVISIBLE) {
            return true
        } else {
            return DNA.widget.Grid2GC.superclass.isEventReachable.call(this)
        }
    },
    closeEditor: function() {
        this.gc.closeActiveEditor()
    }
});
Object.override(DNA.widget.Grid2GC.prototype, {
    jtype: "Grid2GC",
    focusable: true
});
DNA.widget.Grid2Async = function(a) {
    DNA.widget.Grid2Async.superclass.constructor.call(this, a);
    this._doInit();
    this.util = new DNA.widget.GridUtilAsync(this)
}
;
DNA.widget.Grid2Async.extend(DNA.widget.Composite, {
    autoRender: true,
    resizeCursorBound: 1,
    _defaultBorder: new DNA.widget.Border(1,"gray","solid"),
    _selTitleBackColor: "#ffe5a0",
    _selTitleBorderColor: "#f9bc54",
    FONTSIZEFLOOR: 6,
    _initFormatter: function() {
        var a = this.getInitData()[DNA.JWTProperty.PROPERTY_FORMATTER];
        this.formatterMgr = new DNA.widget.CellFormatterMgr();
        this._addFormatters(a)
    },
    _addFormatters: function(c) {
        if (c) {
            var a = c.length;
            for (var b = 0; b < a; ++b) {
                if (c[b]) {
                    this.formatterMgr.addFormatter(c[b].id, this.createFormatter(c[b].script, c[b].opts))
                }
            }
        }
    },
    checkBuild: function(c) {
        var a = this._checkState(DNA.JWT.STATE_RENDERD);
        if (!a && c) {
            return this._buildElements()
        } else {
            return a
        }
    },
    createFormatter: function(scriptStr, opts) {
        var scrts = [];
        scrts[0] = "(function(){return new (function() {";
        scrts[1] = scriptStr;
        scrts[2] = "})();})();";
        try {
            return eval(scrts.join(""))
        } catch (exception) {
            alert("�ͻ������ɸ�ʽ���쳣��" + exception.toString())
        }
    },
    _doInit: function() {
        this.initFlag = this.getInitData().initFlag;
        delete this.getInitData().initFlag;
        this.gridState = DNA.widget.JWTGrid2.STATE_NORMAL;
        this.needHandleGlobal = false;
        this.replacing = false;
        this.selectFinish = true;
        this.operateCell = null ;
        this.operateArea = null ;
        this.minColWidth = 0;
        this.minRowHeight = 0;
        this.defColWidth = 100;
        this.defRowHeight = 20;
        this.columnCount = this.getInitData().colCount;
        delete this.getInitData().colCount;
        this.rowCount = this.getInitData().rowCount;
        delete this.getInitData().rowCount;
        this.hColCount = this.getInitData().headerColCount;
        delete this.getInitData().headerColCount;
        this.hRowCount = this.getInitData().headerRowCount;
        delete this.getInitData().headerRowCount;
        this.fColCount = this.getInitData().footerColCount;
        delete this.getInitData().footerColCount;
        this.fRowCount = this.getInitData().footerRowCount;
        delete this.getInitData().footerRowCount;
        this.showBorder = this.getInitData().showBorder;
        delete this.getInitData().showBorder;
        this.renderedTop = this.getInitData().renderedTop;
        delete this.getInitData().renderedTop;
        this.renderedCount = this.getInitData().renderedCount;
        delete this.getInitData().renderedCount;
        this.tDiv = null ;
        this.currentCell = null ;
        this.gridOption = this.getInitData().gridOption;
        delete this.getInitData().gridOption;
        this.ignoreHidden = this.getInitData().ignoreHidden ? true : false;
        delete this.getInitData().ignoreHidden;
        this.hrDiv = null ;
        this.hcDiv = null ;
        this.frDiv = null ;
        this.fcDiv = null ;
        this.resizeRowIdx = 0;
        this.resizeColIdx = 0;
        this.resizeRowPoint = null ;
        this.resizeColPoint = null ;
        this.resizeDiv = null ;
        this.newSize = 0;
        this.mouseCell = null ;
        this.cellOut = null ;
        this.lastMouseCell = {
            x: -1,
            y: -1
        };
        this.selBeginCell = {
            x: 0,
            y: 0
        };
        this.selectionAreas = new Array();
        this.selectionDiv = null ;
        this.currentRow = -1;
        this.currentCol = -1;
        var b = this.getInitData().cccf;
        delete this.getInitData().cccf;
        if (b) {
            var a = b.split(",");
            this.currentCellColorFocused = a[0];
            this.currentCellColorUnFocused = a[1]
        } else {
            this.currentCellColorFocused = null ;
            this.currentCellColorUnFocused = null 
        }
        this.activeEditor = null ;
        this.editorProvider = null ;
        this.controlProvider = null ;
        this.setCellControlProvider(new DNA.widget.CellControlProviderAsync());
        this.controlCells = []
    },
    init: function() {
        DNA.widget.Grid2Async.superclass.init.call(this)
    },
    _doCreateControls: function() {
        if (this.isVisible()) {
            if (this.getInitData().controlCellObjs) {
                this.controlCells = this.getInitData().controlCellObjs;
                delete this.getInitData().controlCellObjs;
                if (this.controlCells) {
                    this._showControls()
                }
            }
            if (this.controlCellsCachedForIframe) {
                this.controlCells = this.controlCellsCachedForIframe;
                this.controlCellsCachedForIframe = null ;
                this._showControls()
            }
        }
    },
    _showControls: function() {
        var a = this.controlCells.length;
        for (var b = 0; b < a; ++b) {
            var d = this.controlCells.get(b);
            var c = new DNA.widget.AbstractGridCellAsync(this,null ,d.x,d.y,true);
            this.openControl(c, true, d.eid)
        }
    },
    openCurrentEditor: function() {
        if (!this.currentCell) {
            return
        }
        if (this.getEditMode() === DNA.widget.JWTGrid2.EDIT_MODE_READONLY) {
            return
        }
        if (!this.util.isCellEditable(this.currentCell.getColIndex(), this.currentCell.getRowIndex())) {
            return
        }
        var a = new DNA.widget.AbstractGridCellAsync(this,null ,this.currentCell.getColIndex(),this.currentCell.getRowIndex(),false);
        this.openEditor(a, null , false, DNA.widget.JWTGrid2.EDITOPEN_PROGRAM)
    },
    computeSize: function(g, b, h) {
        var d = new DNA.widget.Point();
        if (this.checkRendered()) {
            var a = this.getBorderSize();
            d.x += a;
            d.y += a;
            for (var c = 0; c < this.columnCount; c++) {
                if (this.getColVisible(c)) {
                    d.x += this.getColumnWidthFromStyle(c)
                }
            }
            d.y += this.tDiv.scrollHeight;
            d.y += 1
        } else {
            d.x = this.defColWidth * this.columnCount;
            d.y = this.defRowHeight * this.rowCount
        }
        return d
    },
    _doBuildElements: function() {
        try {
            if (this.getEl().tagName == "IFRAME") {
                if (!this.getEl().contentWindow.document) {
                    return false
                }
                if (!this.getEl().contentWindow.document.body || !this.getEl().contentWindow.document.body.firstChild) {
                    return false
                }
                this.gel = this.getEl().contentWindow.document.body.firstChild;
                var b = DNA.engine.DomUtil.getClientSize(this.getEl());
                this.gel.style.height = b.height + "px";
                this.gel.style.width = b.width + "px"
            } else {
                this.gel = this.getEl()
            }
            this.tDiv = this.gel.firstChild;
            this.cwDiv = this.gel.childNodes[1].firstChild;
            this.hrDiv = this.gel.childNodes[2];
            this.hcDiv = this.gel.childNodes[3];
            this.hccwDiv = this.hcDiv.childNodes[1].firstChild;
            this.hltDiv = this.gel.childNodes[4];
            this.frDiv = this.gel.childNodes[5];
            this.fcDiv = this.gel.childNodes[6];
            this.fccwDiv = this.fcDiv.childNodes[1].firstChild;
            this.frbDiv = this.gel.childNodes[7];
            this.flbDiv = this.gel.childNodes[8];
            this.hrtDiv = this.gel.childNodes[9];
            this.inputProxy = this.hltDiv.lastChild;
            this.hrTable = this.hrDiv.firstChild;
            this.hcTable = this.hcDiv.firstChild;
            this.hltTab = this.hltDiv.firstChild;
            this.frTable = this.frDiv.firstChild;
            this.fcTable = this.fcDiv.firstChild;
            this.frbTab = this.frbDiv.firstChild;
            this.flbTab = this.flbDiv.firstChild;
            this.hrtTab = this.hrtDiv.firstChild;
            this.selectionDiv = this.gel.childNodes[14];
            this.resizeDiv = this.gel.childNodes[15];
            this.selectionChangeDiv = this.gel.childNodes[16];
            this.mCurLeft = this.cwDiv.childNodes[1];
            this.mCurRight = this.cwDiv.childNodes[2];
            this.mCurTop = this.cwDiv.childNodes[3];
            this.mCurBottom = this.cwDiv.childNodes[4];
            this.curLeft = this.mCurLeft;
            this.curRight = this.mCurRight;
            this.curTop = this.mCurTop;
            this.curBottom = this.mCurBottom;
            this.mDragPointDiv = this.cwDiv.childNodes[5];
            this.dragPointDiv = this.mDragPointDiv;
            this.dragPointDiv.style.display = "none";
            this.mSelBorderLeft = this.cwDiv.childNodes[6];
            this.mSelBorderRight = this.cwDiv.childNodes[7];
            this.mSelBorderTop = this.cwDiv.childNodes[8];
            this.mSelBorderBottom = this.cwDiv.childNodes[9];
            this.selBorderLeft = this.mSelBorderLeft;
            this.selBorderRight = this.mSelBorderRight;
            this.selBorderTop = this.mSelBorderTop;
            this.selBorderBottom = this.mSelBorderBottom;
            this.exchangeDiv = this.gel.childNodes[11];
            this.listFace = this.gel.childNodes[12];
            this.listFace.style.display = "none";
            this.listFace.style.width = "18px";
            this.listFace.style.position = "absolute";
            this.listFace.style.paddingRight = "1px";
            this.listFace.style.paddingTop = "1px";
            this.listFace.style.paddingBottom = "1px";
            this.btnFace = this.gel.childNodes[13];
            this.btnFace.style.display = "none";
            this.btnFace.style.width = "18px";
            this.btnFace.style.position = "absolute";
            this.btnFace.style.paddingRight = "1px";
            this.btnFace.style.paddingTop = "1px";
            this.btnFace.style.paddingBottom = "1px";
            var c = DNA.engine.application.getJWTEventMgr();
            c.handleSelfEvent(this, "scroll", this.tDiv);
            if (DNA.engine.Client.isIE()) {
                c.handleSelfEvent(this, "propertychange", this.inputProxy)
            } else {
                if (DNA.engine.Client.isFF()) {
                    c.handleSelfEvent(this, "input", this.inputProxy)
                }
            }
            if (DNA.engine.Client.isIE()) {
                c.handleSelfEvent(this, "mousewheel", this.gel)
            } else {
                if (DNA.engine.Client.isFF()) {
                    c.handleSelfEvent(this, "DOMMouseScroll", this.gel)
                }
            }
            this.setCellEditorProvider(new DNA.widget.CellEditorProviderAsync());
            if (this.getInitData().defEditorId) {
                this.defEditorId = this.getInitData().defEditorId;
                delete this.getInitData().defEditorId
            }
            if (this.getInitData().rowHeights) {
                this.rowHeights = this.getInitData().rowHeights;
                delete this.getInitData().rowHeights
            }
            if (this.getInitData().colWidths) {
                this.colWidths = this.getInitData().colWidths;
                delete this.getInitData().colWidths
            }
            if (this.getInitData().rowHiddens) {
                this.rowHiddens = this.getInitData().rowHiddens;
                delete this.getInitData().rowHiddens
            }
            this.hiddenRows = new Array();
            this.hiddenCols = new Array();
            this.updateCurrentCellColor();
            this._initFormatter();
            if (!this.isEnabled()) {
                this._disableGrid(this)
            }
            this.headerCursor = DNA.widget.CssStyleFinder._findStyleFromCssSheet("grid2_header_cursor", "cursor");
            this.mergeDivs = this._buildMergeDivs();
            this._buildTakenDiv();
            this._resizeTablesNCovers();
            this.parentIframe = this.util.getNearestIframeOfDom(this.getEl());
            this._makeParentIframePaintInIE()
        } catch (a) {
            return false
        }
    },
    _buildMergeDivs: function() {
        var b = [this.hcDiv.childNodes[1].firstChild, this.gel.childNodes[1].firstChild, this.fcDiv.childNodes[1].firstChild, this.hrDiv, this.hltDiv, this.frDiv, this.hrtDiv, this.flbDiv, this.frbDiv];
        var a = [];
        for (var g = 0; g < b.length; g++) {
            var h = b[g];
            var d = h.childNodes;
            for (var c = 0; c < d.length; c++) {
                if (d[c].className.indexOf("gridMergeRect") > 0) {
                    a.push(d[c])
                }
            }
        }
        return a
    },
    _buildTakenDiv: function() {
        this.utrs = [this.tDiv.firstChild, this.hcDiv.firstChild.firstChild, this.fcDiv.firstChild.firstChild];
        this.dtrs = [this.tDiv.lastChild, this.hcDiv.firstChild.lastChild, this.fcDiv.firstChild.lastChild]
    },
    _makeParentIframePaintInIE: function() {
        if (DNA.engine.Client.isIE() && this.parentIframe) {
            var a = this.parentIframe.style.display;
            this.parentIframe.style.display = "none";
            this.parentIframe.style.display = a
        }
    },
    _resizeTablesNCovers: function() {
        var a = DNA.engine.DomUtil.getClientSize(this.getEl());
        if (a.width === 0 || a.height === 0) {
            return
        }
        DNA.engine.DomUtil.setSize(this.tDiv, a);
        DNA.engine.DomUtil.setSize(this.cwDiv.parentNode, this._getClientSizeWithoutScrollbar())
    },
    _afterGridCreate: function() {
        if (!(this.getEl().tagName == "IFRAME")) {
            if (this.getInitData().selections) {
                var d = this.getInitData().selections;
                delete this.getInitData().selections;
                var b = d.length;
                for (var c = 0; c < b; ++c) {
                    this.addSelection(d.get(c))
                }
            }
            if (this.getInitData().currentCell) {
                var a = this.getInitData().currentCell;
                delete this.getInitData().currentCell;
                this.setCurrentCell(a)
            }
            if (this.getInitData().open_editor) {
                delete this.getInitData().open_editor;
                this.openCurrentEditor()
            }
            this._doCreateControls();
            this._placeAllCellHTML()
        }
        this._ajustLockedSections()
    },
    _placeAllCellHTML: function(c, b) {
        if (c && c.length) {
            for (var g = 0; g < c.length; g++) {
                this._placeCellHTML(c[g], b[g])
            }
        } else {
            for (var a = this.renderedTop, h = this.renderedTop + this.renderedCount; a < h; a++) {
                for (var g = 0, d = this.getColumnCount(); g < d; g++) {
                    this._placeCellHTML(this._getCellDom(g, a, this.tDiv), this.cwDiv)
                }
                for (var g = 0, d = this.getHeaderColumnCount(); g < d; g++) {
                    this._placeCellHTML(this._getCellDom(g, a, this.hcTable), this.hccwDiv)
                }
                for (var g = 0, d = this.getFooterColumnCount(); g < d; g++) {
                    this._placeCellHTML(this._getCellDom(g, a, this.fcTable), this.fccwDiv)
                }
            }
        }
    },
    _placeCellHTML: function(a, c) {
        if (a.html) {
            return
        }
        if (!c) {
            var b = a.parentNode.parentNode;
            if (b === this.hcDiv) {
                c = this.hccwDiv
            } else {
                if (b === this.tDiv) {
                    c = this.cwDiv
                } else {
                    if (b === this.fcDiv) {
                        c = this.fccwDiv
                    }
                }
            }
        }
        if (a && c && a.getAttribute("html")) {
            var d = a.cloneNode(true);
            c.appendChild(d);
            a.htmlDiv = d;
            d.style.top = a.parentNode.offsetTop + "px"
        }
    },
    _removeAllCellHTML: function(c, b) {
        if (c && c.length) {
            for (var g = 0; g < c.length; g++) {
                this._removeCellHTML(c[g], b[g])
            }
        } else {
            for (var a = this.renderedTop, h = this.renderedTop + this.renderedCount; a < h; a++) {
                for (var g = 0, d = this.getColumnCount(); g < d; g++) {
                    this._removeCellHTML(this._getCellDom(g, a, this.tDiv), this.cwDiv)
                }
                for (var g = 0, d = this.getHeaderColumnCount(); g < d; g++) {
                    this._removeCellHTML(this._getCellDom(g, a, this.hcTable), this.hccwDiv)
                }
                for (var g = 0, d = this.getFooterColumnCount(); g < d; g++) {
                    this._removeCellHTML(this._getCellDom(g, a, this.fcTable), this.fccwDiv)
                }
            }
        }
    },
    _removeCellHTML: function(a, c) {
        if (!c) {
            var b = a.parentNode.parentNode;
            if (b === this.hcDiv) {
                c = this.hccwDiv
            } else {
                if (b === this.tDiv) {
                    c = this.cwDiv
                } else {
                    if (b === this.fcDiv) {
                        c = this.fccwDiv
                    }
                }
            }
        }
        if (a && c && a.getAttribute("html")) {
            var d = a.htmlDiv;
            if (d) {
                d.parentNode.removeChild(d)
            }
        }
    },
    _resizeGridDiv: function() {
        if (this.getEl().tagName == "IFRAME") {
            this.gel = this.getEl().contentWindow.document.body.firstChild;
            var a = DNA.engine.DomUtil.getClientSize(this.getEl());
            this.gel.style.height = a.height + "px";
            this.gel.style.width = a.width + "px"
        }
    },
    _resizeChildren: function(b) {
        var d = b.getChildren();
        for (var c = 0, a = d.length; c < a; c++) {
            var g = d[c];
            g.setBounds(0, 0, 0, 0)
        }
    },
    replace2Iframe: function(a) {
        this._replaceDom(a)
    },
    _replaceDom: function(a) {
        this.replacing = true;
        if (this.initFlag) {
            delete this.initFlag
        }
        if (this.tDiv) {
            DNA.engine.application.getJWTEventMgr().deleteSelfEvent(this, "scroll", this.tDiv)
        }
        if (this.inputProxy) {
            if (DNA.engine.Client.isIE()) {
                DNA.engine.application.getJWTEventMgr().deleteSelfEvent(this, "propertychange", this.inputProxy)
            } else {
                if (DNA.engine.Client.isFF()) {
                    DNA.engine.application.getJWTEventMgr().deleteSelfEvent(this, "input", this.inputProxy)
                }
            }
        }
        if (DNA.engine.Client.isIE()) {
            DNA.engine.application.getJWTEventMgr().deleteSelfEvent(this, "mousewheel", this.inputProxy)
        } else {
            if (DNA.engine.Client.isFF()) {
                DNA.engine.application.getJWTEventMgr().deleteSelfEvent(this, "DOMMouseScroll", this.inputProxy)
            }
        }
        this.currentCell = null ;
        this.selectionAreas.length = 0;
        this.hiddenRows.length = 0;
        this.hiddenCols.length = 0;
        this.currentRow = -1;
        this.currentCol = -1;
        this.tDiv = null ;
        this.hrDiv = null ;
        this.hrTable = null ;
        this.hcDiv = null ;
        this.hcTable = null ;
        this.hltDiv = null ;
        this.hltTab = null ;
        this.resizeRowIdx = 0;
        this.resizeColIdx = 0;
        this.resizeRowPoint = null ;
        this.resizeColPoint = null ;
        this.resizeDiv = null ;
        this.newSize = 0;
        this.mouseCell = null ;
        this.lastMouseCell = {
            x: -1,
            y: -1
        };
        this.selBeginCell = {
            x: 0,
            y: 0
        };
        this.selectionDiv = null ;
        this.operateCell = null ;
        this.operateArea = null ;
        this.activeEditor = null ;
        this.curFace = null ;
        this.gridState = DNA.widget.JWTGrid2.STATE_NORMAL;
        this._clearChildrenEl(this);
        if (a) {
            DNA.widget.Grid2Async.superclass.replace2Iframe.call(this, a)
        }
        this._unmaskState(DNA.JWT.STATE_RENDERD);
        this._makeParentIframePaintInIE()
    },
    _clearChildrenEl: function(b) {
        var d = b.getChildren();
        for (var c = 0, a = d.length; c < a; c++) {
            var g = d[c];
            if (g.getChildren) {
                if (g.getChildren()) {
                    this._clearChildrenEl(g)
                }
            }
            if (g.el) {
                g.fireEvent("beforeReplace");
                g._unmaskState(DNA.JWT.STATE_RENDERD);
                if (g.el) {
                    g.el = null 
                }
            }
        }
    },
    _isResizeable: function() {
        if (this.getEl()) {
            return true
        }
    },
    doDispose: function() {
        DNA.widget.Grid2Async.superclass.doDispose.call(this);
        delete this.gel;
        delete this.tDiv;
        delete this.cwDiv;
        delete this.selectionDiv;
        delete this.resizeDiv;
        delete this.curFace;
        delete this.hrDiv;
        delete this.hcDiv;
        delete this.hltDiv;
        delete this.hrtDiv;
        delete this.fcDiv;
        delete this.flbDiv;
        delete this.frbDiv;
        delete this.frDiv;
        delete this.mCurLeft;
        delete this.mCurRight;
        delete this.mCurTop;
        delete this.mCurBottom;
        delete this.mDragPointDiv;
        delete this.mSelBorderLeft;
        delete this.mSelBorderRight;
        delete this.mSelBorderTop;
        delete this.mSelBorderBottom;
        delete this.curLeft;
        delete this.curRight;
        delete this.curTop;
        delete this.curBottom;
        delete this.currentCell;
        delete this.operateCell;
        delete this.operateArea;
        delete this.selectionAreas
    },
    _ajustLockedSections: function() {
        var a = DNA.engine.DomUtil.getClientSize(this.getEl());
        if (this.fRowCount == 0) {
            this.frDiv.style.visibility = "hidden";
            this.flbDiv.style.visibility = "hidden";
            this.frbDiv.style.visibility = "hidden"
        } else {
            this.frDiv.style.visibility = "";
            this.flbDiv.style.visibility = "";
            this.frbDiv.style.visibility = ""
        }
        if (this.fColCount == 0) {
            this.fcDiv.style.visibility = "hidden";
            this.hrtDiv.style.visibility = "hidden";
            this.frbDiv.style.visibility = "hidden"
        } else {
            this.fcDiv.style.visibility = "";
            this.hrtDiv.style.visibility = "";
            this.frbDiv.style.visibility = ""
        }
        if (a.width === 0 || a.height === 0) {
            return
        }
        if (this.tDiv) {
            a = this._getClientSizeWithoutScrollbar()
        }
        this._adjustRowDomWidth();
        this._ajustHCSize(a);
        this._ajustHRSize(a);
        this._ajustHLTSize(a);
        this._ajustFCSize(a);
        this._ajustFRSize(a);
        this._ajustFRBSize(a);
        this._ajustFLBSize(a);
        this._ajustHRTSize(a);
        this._handleScroll()
    },
    _adjustRowDomWidth: function() {
        var d = 0
          , b = 0
          , a = 0;
        for (var g = 0, c = this.getHeaderColumnCount(); g < c; g++) {
            if (!this.getColHidden(g)) {
                d += this.colWidths[g]
            }
        }
        for (var g = this.getColumnCount() - this.getFooterColumnCount(), c = this.getColumnCount(); g < c; g++) {
            if (!this.getColHidden(g)) {
                a += this.colWidths[g]
            }
        }
        for (var g = 0, c = this.getColumnCount(); g < c; g++) {
            if (!this.getColHidden(g)) {
                b += this.colWidths[g]
            }
        }
        this._adjustRowDomWidth2Tables([this.hcTable, this.hltTab, this.flbTab], d);
        this._adjustRowDomWidth2Tables([this.tDiv, this.frTable, this.hrTable], b);
        this._adjustRowDomWidth2Tables([this.fcTable, this.frbTab, this.hrtTab], a)
    },
    _adjustRowDomWidth2Tables: function(c, d) {
        for (var b = 0; b < c.length; b++) {
            var g = c[b];
            for (var a = 0; a < g.childNodes.length; a++) {
                g.childNodes[a].style.width = d + "px"
            }
        }
    },
    adjustLockDiv: function(b, c) {
        var a = this._computeLockDivSize(b, c);
        DNA.engine.DomUtil.setSize(c, a)
    },
    adjustLockDivWithCover: function(b, c) {
        var a = this._computeLockDivSize(b, c);
        DNA.engine.DomUtil.setSize(c, a);
        DNA.engine.DomUtil.setSize(c.childNodes[1], a)
    },
    _computeLockDivSize: function(c, a) {
        var o = DNA.engine.DomUtil.getClientSize(this.getEl());
        var g = a.scrollWidth;
        var b = c.width;
        var n = a.scrollHeight;
        var l = c.height;
        var m = g <= b ? g : b;
        var d = n <= l ? n : l;
        o.width = m;
        o.height = d;
        return o
    },
    _getClientSizeWithoutScrollbar: function() {
        var a = DNA.engine.DomUtil.getClientSize(this.getEl());
        var b = DNA.engine.DomUtil.getSize(this.getEl());
        if (this.tDiv.scrollHeight > b.height && b.width < a.width + 10) {
            a.width = b.width - 17 - (b.width - a.width)
        }
        if (this.tDiv.scrollWidth > b.width && b.height < a.height + 10) {
            a.height = b.height - 17 - (b.height - a.height)
        }
        if (this.tDiv.scrollWidth < (b.width - 17) && a.height == b.height - 17) {
            a.height = b.height
        }
        if (this.tDiv.scrollHeight < (b.height - 17) && a.width == b.width - 17) {
            a.width = b.width
        }
        return a
    },
    _doAfterParentVisible: function() {
        if (!this.gel) {
            return
        }
        if (this.getEl() && this.getEl().tagName == "IFRAME") {
            var c = DNA.engine.DomUtil.getClientSize(this.getEl());
            var a = this.getEl().contentWindow.document.body;
            if (a.offsetHeight == 0) {
                this.getEl().contentWindow.document.documentElement.id = ""
            }
            DNA.engine.DomUtil.setSize(this.gel, c)
        }
        this._ajustLockedSections();
        this.computeColsGrab();
        this.gel.style.zoom = "";
        this.gel.style.zoom = "1"
    },
    _ajustHCSize: function(a) {
        this.adjustLockDivWithCover(a, this.hcDiv)
    },
    _ajustHRSize: function(a) {
        this.adjustLockDiv(a, this.hrDiv)
    },
    _ajustHLTSize: function(a) {
        this.adjustLockDiv(a, this.hltDiv)
    },
    _ajustFCSize: function(a) {
        this.adjustLockDiv(a, this.fcDiv);
        var b;
        if (this._hasHScroll()) {
            b = a.width - this.fcDiv.clientWidth
        } else {
            b = this.util.getColOffsetLeft(this.getColumnCount() - this.getFooterColumnCount())
        }
        DNA.engine.DomUtil.setLeftTop(this.fcDiv, b, 0)
    },
    _ajustFRSize: function(a) {
        this.adjustLockDiv(a, this.frDiv);
        DNA.engine.DomUtil.setLeftTop(this.frDiv, 0, a.height - this.frDiv.clientHeight)
    },
    _ajustFRBSize: function(a) {
        this.adjustLockDiv(a, this.frbDiv);
        var b;
        if (this._hasHScroll()) {
            b = a.width - this.frbDiv.clientWidth
        } else {
            b = this.util.getColOffsetLeft(this.getColumnCount() - this.getFooterColumnCount())
        }
        DNA.engine.DomUtil.setLeftTop(this.frbDiv, b, a.height - this.frbDiv.clientHeight)
    },
    _ajustFLBSize: function(a) {
        this.adjustLockDiv(a, this.flbDiv);
        DNA.engine.DomUtil.setLeftTop(this.flbDiv, 0, a.height - this.flbDiv.clientHeight)
    },
    _ajustHRTSize: function(a) {
        this.adjustLockDiv(a, this.hrtDiv);
        var b;
        if (this._hasHScroll()) {
            b = a.width - this.hrtDiv.clientWidth
        } else {
            b = this.util.getColOffsetLeft(this.getColumnCount() - this.getFooterColumnCount())
        }
        DNA.engine.DomUtil.setLeftTop(this.hrtDiv, b, 0)
    },
    _buildHeaderCols: function(c) {
        if (!this.checkRendered(true)) {
            return
        }
        var d = c.hc;
        var a = c.hlt;
        var b = c.flb;
        DNA.engine.DomUtil.insertAfter(this.hcDiv, d);
        this.hcDiv = this.hcDiv.nextSibling;
        this.hccwDiv = this.hcDiv.childNodes[1].firstChild;
        this.hcTable = this.hcDiv.firstChild;
        this.hcDiv.parentNode.removeChild(this.hcDiv.previousSibling);
        DNA.engine.DomUtil.insertAfter(this.hltDiv, a);
        this.hltDiv = this.hltDiv.nextSibling;
        this.hltTab = this.hltDiv.firstChild;
        this.hltDiv.parentNode.removeChild(this.hltDiv.previousSibling);
        DNA.engine.DomUtil.insertAfter(this.flbDiv, b);
        this.flbDiv = this.flbDiv.nextSibling;
        this.flbTab = this.flbDiv.firstChild;
        this.flbDiv.parentNode.removeChild(this.flbDiv.previousSibling);
        this._buildTakenDiv();
        this.operateCell = null ;
        this.hColCount = c.count;
        this._ajustLockedSections();
        if (this.currentCell) {
            this._drawCurrentCellBack();
            this._drawCurrentCell(this.currentCell)
        }
    },
    _buildHeaderRows: function(d) {
        if (!this.checkRendered(true)) {
            return
        }
        var c = d.hr;
        var a = d.hlt;
        var b = d.hrt;
        DNA.engine.DomUtil.insertAfter(this.hrDiv, c);
        this.hrDiv = this.hrDiv.nextSibling;
        this.hrTable = this.hrDiv.firstChild;
        this.hrDiv.parentNode.removeChild(this.hrDiv.previousSibling);
        DNA.engine.DomUtil.insertAfter(this.hltDiv, a);
        this.hltDiv = this.hltDiv.nextSibling;
        this.hltTab = this.hltDiv.firstChild;
        this.hltDiv.parentNode.removeChild(this.hltDiv.previousSibling);
        DNA.engine.DomUtil.insertAfter(this.hrtDiv, b);
        this.hrtDiv = this.hrtDiv.nextSibling;
        this.hrtTab = this.hrtDiv.firstChild;
        this.hrtDiv.parentNode.removeChild(this.hrtDiv.previousSibling);
        this._buildTakenDiv();
        this.operateCell = null ;
        this.hRowCount = d.count;
        this._ajustLockedSections();
        if (this.currentCell) {
            if (this.currentCell.td && this.currentCell.td.parentNode) {
                this._drawCurrentCellBack();
                this._drawCurrentCell(this.currentCell)
            }
        }
    },
    _buildFooterCols: function(d) {
        if (!this.checkRendered(true)) {
            return
        }
        var b = d.fc;
        var a = d.hrt;
        var c = d.frb;
        DNA.engine.DomUtil.insertAfter(this.fcDiv, b);
        this.fcDiv = this.fcDiv.nextSibling;
        this.fccwDiv = this.fcDiv.childNodes[1].firstChild;
        this.fcTable = this.fcDiv.firstChild;
        this.fcDiv.parentNode.removeChild(this.fcDiv.previousSibling);
        DNA.engine.DomUtil.insertAfter(this.hrtDiv, a);
        this.hrtDiv = this.hrtDiv.nextSibling;
        this.hrtTab = this.hrtDiv.firstChild;
        this.hrtDiv.parentNode.removeChild(this.hrtDiv.previousSibling);
        DNA.engine.DomUtil.insertAfter(this.frbDiv, c);
        this.frbDiv = this.frbDiv.nextSibling;
        this.frbTab = this.frbDiv.firstChild;
        this.frbDiv.parentNode.removeChild(this.frbDiv.previousSibling);
        this._buildTakenDiv();
        this.operateCell = null ;
        this.fColCount = d.count;
        this._ajustLockedSections();
        if (this.currentCell) {
            this._drawCurrentCellBack();
            this._drawCurrentCell(this.currentCell)
        }
    },
    _buildFooterRows: function(d) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = d.fr;
        var b = d.flb;
        var c = d.frb;
        DNA.engine.DomUtil.insertAfter(this.frDiv, a);
        this.frDiv = this.frDiv.nextSibling;
        this.frTable = this.frDiv.firstChild;
        this.frDiv.parentNode.removeChild(this.frDiv.previousSibling);
        DNA.engine.DomUtil.insertAfter(this.flbDiv, b);
        this.flbDiv = this.flbDiv.nextSibling;
        this.flbTab = this.flbDiv.firstChild;
        this.flbDiv.parentNode.removeChild(this.flbDiv.previousSibling);
        DNA.engine.DomUtil.insertAfter(this.frbDiv, c);
        this.frbDiv = this.frbDiv.nextSibling;
        this.frbTab = this.frbDiv.firstChild;
        this.frbDiv.parentNode.removeChild(this.frbDiv.previousSibling);
        this._buildTakenDiv();
        this.operateCell = null ;
        this.fRowCount = d.count;
        this._ajustLockedSections();
        if (this.currentCell) {
            this._drawCurrentCellBack();
            this._drawCurrentCell(this.currentCell)
        }
    },
    _insertRowHelper: function(a, g) {
        var c = a.childNodes;
        var b = c.length;
        for (var d = 1; d < b; ++d) {
            g.appendChild(c[1])
        }
        a.appendChild(g)
    },
    _focus: function() {
        var a = this.getEl();
        if (a) {
            DNA.engine.DomUtil.addClass(a, "focus")
        }
        this._focusDom();
        this.updateCurrentCellColor()
    },
    _blur: function() {
        var a = this.getEl();
        if (a) {
            DNA.engine.DomUtil.removeClass(a, "focus")
        }
        this.updateCurrentCellColor()
    },
    _registEvents: function() {
        var a = DNA.engine.application.getJWTEventMgr();
        a.addListener("mousemove", this._onGlobalMousemove, this);
        a.addListener("mouseup", this._onGlobalMouseup, this);
        a.addListener("scroll", this._onScroll, this);
        a.addBubbleListener("keydown", this.onBubbleKeyDown, this);
        this.addListener("dblclick", this._onDblclick);
        this.addListener("mousedown", this._onMousedown);
        if (DNA.engine.Client.isIE()) {
            this.addListener("propertychange", this._onProxyChange)
        } else {
            if (DNA.engine.Client.isFF()) {
                this.addListener("input", this._onProxyChange)
            }
        }
        if (DNA.engine.Client.isIE()) {
            this.addListener("mousewheel", this._onMousewheel)
        } else {
            if (DNA.engine.Client.isFF()) {
                this.addListener("DOMMouseScroll", this._onMousewheel)
            }
        }
        this.addListener("keydown", this._onKeyDown);
        this.addListener("dragover", this._doDragOver);
        this.addListener("resize", this._doResize);
        a.addListener("predispose", this._doBeforeDispose, this);
        a.addListener(DNA.JWTEvent.POSTVISIBLE, this._doAfterVisible, this);
        a.addBubbleListener(DNA.JWTEvent.MOUSEDOWN, this._doBubbleMouseDown, this);
        this.addListener("blur", this._onBlur);
        a.addListener(DNA.JWTEvent.PRE_DISABLED, this._onDisable, this)
    },
    _onMousewheel: new DNA.engine.Action({
        handle: function(b) {
            var a = b.getOriginalEvent();
            var c = a.detail ? a.detail * (-20) : a.wheelDelta;
            this.tDiv.scrollTop -= c
        }
    }),
    _onDisable: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            this._disableGrid(a)
        }
    }),
    _disableGrid: function(b) {
        try {
            if (b.isAncestorOf(this)) {
                if (this.tDiv) {
                    this.tDiv.scrollTop = 0;
                    this.tDiv.scrollLeft = 0;
                    this._handleScroll()
                }
            }
        } catch (a) {}
    },
    onBubbleKeyDown: new DNA.engine.PreventableAction({
        handle: function(a) {
            if (!a.isCtrl() && !a.isAlt() && a.getKeyCode() == DNA.JWTEvent.ENTER) {
                this.keyEnterDown(a);
                a.preventDefault()
            }
        }
    }),
    _onBlur: new DNA.engine.Action({
        handle: function(a) {
            try {
                this._blurInputProxy()
            } catch (a) {}
            this.updateCurrentCellColor()
        }
    }),
    _onProxyChange: new DNA.engine.Action({
        handle: function(g) {
            if (!this.checkRendered(true)) {
                return
            }
            if (!this.currentCell) {
                return
            }
            if (DNA.engine.Client.isIE()) {
                var c = g.getOriginalEvent().propertyName;
                if (c != "value") {
                    return
                }
            }
            var h = this.inputProxy.value;
            if (!h || h == "") {
                return
            }
            if (this.activeEditor) {
                return
            }
            var b = this.currentCell.getColIndex();
            var l = this.currentCell.getRowIndex();
            if ((this.getEditMode() != DNA.widget.JWTGrid2.EDIT_MODE_READONLY) && this.util.isCellEditable(b, l)) {
                var a = this.getCell(b, l);
                var d = new DNA.widget.AbstractGridCellAsync(this,null ,b,l,false);
                this.openEditor(d, null , false, DNA.widget.JWTGrid2.EDITOPEN_INPUT, h)
            } else {
                this.inputProxy.value = "";
                this.inputProxy.blur()
            }
        }
    }),
    _onGlobalMouseup: new DNA.engine.AppSuspendedAction({
        handle: function(h) {
            if (this.replacing) {
                return
            }
            if (!this.checkRendered(true)) {
                return
            }
            if (!this.isEnabled()) {
                return
            }
            var n = DNA.engine.DomUtil.getSize(this.tDiv);
            if (n.x == 0 || n.y == 0) {
                return
            }
            var m = h.getSrcElement();
            var b = h.getSrcControl();
            if (!this.isDraging()) {
                if (this.mousedownonSelf) {
                    if (b == this) {
                        this.fireEvent("gridClick", [h, this])
                    }
                    this.mousedownonSelf = false
                }
                return
            }
            var d = h.getXY();
            var g = this._getPageBounds();
            var c = this.getBounds();
            var l = {
                x: d.x - g.x,
                y: d.y - g.y
            };
            h.setSrcControl(this);
            h.setLocation(l);
            var a = this.getCellByCoordinate(l.x, l.y);
            if (!a && !this.isDraging()) {
                this.gridState = DNA.widget.JWTGrid2.STATE_OUT;
                return
            }
            this.mouseCell = a;
            switch (this.gridState) {
            case DNA.widget.JWTGrid2.STATE_ROW_SELECT:
                this.rowSelectEnd(h);
                break;
            case DNA.widget.JWTGrid2.STATE_COL_SELECT:
                this.colSelectEnd(h);
                break;
            case DNA.widget.JWTGrid2.STATE_ALL_SELECT:
                this.allSelectEnd(h);
                break;
            case DNA.widget.JWTGrid2.STATE_CELL_SELECT:
                this.mouseCellSelectEnd(h);
                break;
            case DNA.widget.JWTGrid2.STATE_SELECTION_CHANGED:
                this.mouseSelectionChangeEnd(h);
                break;
            case DNA.widget.JWTGrid2.STATE_ROW_RESIZE:
                this.rowResizeEnd(h);
                break;
            case DNA.widget.JWTGrid2.STATE_COL_RESIZE:
                this.colResizeEnd(h);
                break;
            case DNA.widget.JWTGrid2.STATE_COL_EXCHANGE:
                this._beExchangeCol = a ? a.x : -1;
                this._colExchangeEnd(h);
                break
            }
            if (this.gridState != DNA.widget.JWTGrid2.STATE_ROW_RESIZE && this.gridState != DNA.widget.JWTGrid2.STATE_COL_RESIZE && (this.gridState != DNA.widget.JWTGrid2.STATE_COL_EXCHANGE || (this.gridState == DNA.widget.JWTGrid2.STATE_COL_EXCHANGE && this.exchangeCol == this._beExchangeCol))) {
                if (this.mousedownonSelf && b == this) {
                    this.fireEvent("gridClick", [h, this])
                }
            }
            this.mousedownonSelf = false;
            this.gridState = DNA.widget.JWTGrid2.STATE_NORMAL
        }
    }),
    isDraging: function() {
        return !(this.gridState != DNA.widget.JWTGrid2.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid2.STATE_ROW_RESIZE && this.gridState != DNA.widget.JWTGrid2.STATE_CELL_SELECT && this.gridState != DNA.widget.JWTGrid2.STATE_ROW_SELECT && this.gridState != DNA.widget.JWTGrid2.STATE_COL_SELECT && this.gridState != DNA.widget.JWTGrid2.STATE_SELECTION_CHANGED && this.gridState != DNA.widget.JWTGrid2.STATE_ALL_SELECT && this.gridState != DNA.widget.JWTGrid2.STATE_COL_EXCHANGE)
    },
    _findEventCtrol: function(b) {
        var c = b;
        while (c && c.nodeType == 1) {
            if (c.id) {
                var a = DNA.widget.WidgetRegistry.get(c.id);
                if (a instanceof DNA.widget.Control) {
                    return a
                }
            }
            c = c.parentNode
        }
        return null 
    },
    _onGlobalMousemove: new DNA.engine.Action({
        handle: function(h) {
            if (this.replacing) {
                return
            }
            if (!this.checkRendered(true)) {
                return
            }
            if (!this.isEnabled()) {
                return
            }
            var n = h.getSrcElement();
            var a = this._findEventCtrol(n);
            if (a != this && this.gridState != DNA.widget.JWTGrid2.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid2.STATE_ROW_RESIZE) {
                var l = false;
                while (n.parentNode) {
                    n = n.parentNode;
                    if (n.className && n.className.indexOf("gridCell") >= 0) {
                        l = true;
                        break
                    }
                }
                if (l) {
                    if (a._eid == this.defEditorId || a._eid == n.getAttribute("ei")) {
                        return
                    }
                    h = this._getRelativeLocationForChildControl(h)
                } else {
                    if (this.cellOut) {
                        if (this.cellOut.x != -1) {
                            this.fireEvent("cellout", [this, {
                                x: this.cellOut.x,
                                y: this.cellOut.y
                            }])
                        }
                    }
                    this.cellOut = null ;
                    return
                }
            }
            if (h.getButton() != 0 && !this.selectFinish) {
                this.gridState = DNA.widget.JWTGrid2.STATE_NORMAL;
                this.mouseCellSelectEnd(h);
                return
            }
            var o = DNA.engine.DomUtil.getSize(this.tDiv);
            if (o.x == 0 || o.y == 0) {
                return
            }
            if (n == this.tDiv && this.gridState != DNA.widget.JWTGrid2.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid2.STATE_ROW_RESIZE) {
                return
            }
            var d = h.getXY();
            var g = this._getPageBounds();
            var c = this.getBounds();
            var m = {
                x: d.x - g.x,
                y: d.y - g.y
            };
            h.setSrcControl(this);
            h.setLocation(m);
            var b = this.getCellByCoordinate(m.x, m.y);
            if (!b && this.gridState != DNA.widget.JWTGrid2.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid2.STATE_ROW_RESIZE) {
                if (this.gridState == DNA.widget.JWTGrid2.STATE_COL_EXCHANGE) {
                    this._colExchangeing(h);
                    return
                }
                this.gridState = DNA.widget.JWTGrid2.STATE_OUT;
                return
            }
            this.mouseCell = b;
            if (b) {
                if (this.cellOut) {
                    if (this.cellOut.x != -1) {
                        if (!(b.x == this.cellOut.x && b.y == this.cellOut.y)) {
                            this.fireEvent("cellout", [this, {
                                x: this.cellOut.x,
                                y: this.cellOut.y
                            }]);
                            this.fireEvent("cellin", [this, {
                                x: this.mouseCell.x,
                                y: this.mouseCell.y,
                                width: m.x,
                                height: m.y
                            }])
                        }
                    }
                } else {
                    this.fireEvent("cellin", [this, {
                        x: this.mouseCell.x,
                        y: this.mouseCell.y,
                        width: m.x,
                        height: m.y
                    }])
                }
            }
            this.cellOut = this.mouseCell;
            switch (this.gridState) {
            case DNA.widget.JWTGrid2.STATE_ROW_SELECT:
                this.rowSelecting(h);
                break;
            case DNA.widget.JWTGrid2.STATE_COL_SELECT:
                this.colSelecting(h);
                break;
            case DNA.widget.JWTGrid2.STATE_CELL_SELECT:
                this.mouseCellSelecting(h);
                this._autoScroll(h);
                break;
            case DNA.widget.JWTGrid2.STATE_SELECTION_CHANGED:
                this.mouseSelectionChanging(h);
                this._autoScroll(h);
                break;
            case DNA.widget.JWTGrid2.STATE_ROW_RESIZE:
                this.rowResizing(h);
                break;
            case DNA.widget.JWTGrid2.STATE_COL_RESIZE:
                this.colResizing(h);
                break;
            case DNA.widget.JWTGrid2.STATE_COL_EXCHANGE:
                this._colExchangeing(h);
                break;
            default:
                this.updateCursor(h);
                break
            }
        }
    }),
    _colExchangeStart: function(b) {
        this.exchangeCol = this.mouseCell.x;
        var a = this._getCellDom(this.exchangeCol, 0, this.hrTable);
        this.exchangeDiv.innerHTML = DNA.engine.DomUtil.getInnerText(a);
        this.exchangeDiv.style.width = a.offsetWidth + "px";
        this.exchangeDiv.style.height = a.offsetHeight + "px"
    },
    _colExchangeing: function(a) {
        if (this.exchangeDiv.style.display == "none") {
            this.exchangeDiv.style.display = ""
        }
        this.exchangeDiv.style.top = "" + (a.getLocation().y + 2) + "px";
        this.exchangeDiv.style.left = "" + (a.getLocation().x + 2) + "px"
    },
    _colExchangeEnd: function(g) {
        this.exchangeDiv.style.display = "none";
        if (this._beExchangeCol && this._beExchangeCol != -1 && this.exchangeCol != this._beExchangeCol) {
            var h = {};
            h.doit = true;
            h.col = this.exchangeCol;
            h.tobeExchange = this._beExchangeCol;
            this.fireEvent("colExchange", [this, h]);
            if (h.doit) {
                this.closeEditor();
                var b = this.colWidths[this._beExchangeCol];
                this.colWidths[this._beExchangeCol] = this.colWidths[this.exchangeCol];
                this.colWidths[this.exchangeCol] = b;
                this._exchangeCols(this.exchangeCol, this._beExchangeCol, this.tDiv);
                this._exchangeCols(this.exchangeCol, this._beExchangeCol, this.hrTable);
                this._exchangeCols(this.exchangeCol, this._beExchangeCol, this.frTable)
            }
            var a = this.controlCells.length;
            for (var c = 0; c < a; ++c) {
                var d = this.controlCells.get(c);
                if (d.x == this.exchangeCol) {
                    d.x = this._beExchangeCol
                } else {
                    if (d.x == this._beExchangeCol) {
                        d.x = this.exchangeCol
                    }
                }
            }
            this._resizeNRepositionStaffs4WidthChange(Math.min(this.exchangeCol, this._beExchangeCol))
        } else {
            this.exchangeCol = this._beExchangeCol = -1
        }
    },
    _exchangeCols: function(l, h, q) {
        var p, o;
        var n = Math.max(l, h);
        var b = Math.min(l, h);
        l = b;
        h = n;
        var m = q.childNodes.length - 1;
        for (var d = -1; d < m - 2; ++d) {
            p = this._getCellDom(l, d, q);
            o = this._getCellDom(h, d, q);
            this._swapNode(p, o, l, h)
        }
        if (this.currentCell) {
            if (this.currentCell.colIndex == l) {
                this.currentCell.colIndex == h
            } else {
                if (this.currentCell.colIndex == h) {
                    this.currentCell.colIndex == l
                }
            }
            this._reBoundCurCell()
        }
        var a = this.getColumnWidthCount(0, l);
        for (d = l + 1,
        j = h; d < j; d++) {
            a += this.getColumnWidth(d - 1);
            for (k = 1; k < q.childNodes.length - 1; k++) {
                var c = q.childNodes[k].childNodes[d + 1];
                c.style.left = a + "px";
                var g = c.htmlDiv;
                if (g) {
                    g.style.left = c.style.left
                } else {
                    this._placeCellHTML(c)
                }
            }
        }
    },
    _swapNode: function(b, a, l, h) {
        if (b.swapNode) {
            b.swapNode(a)
        } else {
            var d = b.parentNode;
            var g = b.nextSibling;
            var c = a.nextSibling;
            if (g) {
                d.insertBefore(a, g)
            } else {
                d.appendChild(a)
            }
            if (c) {
                d.insertBefore(b, c)
            } else {
                d.appendChild(b)
            }
        }
        b.style.left = this.getColumnWidthCount(0, h) + "px";
        a.style.left = this.getColumnWidthCount(0, l) + "px"
    },
    _onDblclick: new DNA.engine.Action({
        handle: function(g) {
            if (!this.checkRendered(true)) {
                return
            }
            var b = g.getSrcElement();
            this.resizeRowIdx = 0;
            this.resizeColIdx = 0;
            if (this.getEditMode() === DNA.widget.JWTGrid2.EDIT_MODE_READONLY) {
                return
            }
            if (b == this.tDiv) {
                return
            }
            var c = g.getLocation();
            var a = this.getCellByCoordinate(c.x, c.y);
            if (!a) {
                return
            }
            if (this.util.isCellSelectable(a.x, a.y)) {
                this.setCurrentCell(a);
                if (!this._stopDbClick) {
                    if (this.currentCell && this.util.isCellEditable(this.currentCell.getColIndex(), this.currentCell.getRowIndex())) {
                        var d = new DNA.widget.AbstractGridCellAsync(this,null ,a.x,a.y,false);
                        this.openEditor(d, g, true, DNA.widget.JWTGrid.EDITOPEN_DBCLICK)
                    }
                }
            }
        }
    }),
    _doBeforeDispose: new DNA.engine.Action({
        handle: function(b) {
            if (b.isAncestorOf(this)) {
                var a = DNA.engine.application.getJWTEventMgr();
                a.deleteSelfEvent(this, "scroll", this.tDiv);
                a.deleteSelfEvent(this, "propertychange", this.inputProxy)
            }
        }
    }),
    _doAfterVisible: new DNA.engine.AppSuspendedAction({
        handle: function(a) {
            if (a.isAncestorOf(this)) {
                this._doCreateControls();
                this.processAddControl();
                this._doAfterParentVisible()
            }
        }
    }),
    _doResize: new DNA.engine.Action({
        handle: function(b) {
            if (!this._isResizeable()) {
                return
            }
            if (this.getEl() && this.tDiv) {
                if (this.getEl().tagName == "IFRAME") {
                    var a = DNA.engine.DomUtil.getClientSize(this.getEl());
                    DNA.engine.DomUtil.setSize(this.tDiv, a)
                }
                this._resizeTablesNCovers();
                this._ajustLockedSections();
                this._adjustScroll();
                this.computeColsGrab()
            }
        }
    }),
    _doDragOver: new DNA.engine.Action({
        handle: function(c) {
            if (!this.checkRendered(true)) {
                return
            }
            if (!this.getEl()) {
                return
            }
            var b = c.getXY();
            var a = DNA.engine.DomUtil.getPageXY(this.getEl());
            a = {
                x: b.x - a.x,
                y: b.y - a.y
            };
            a = this.getCellByCoordinate(a.x, a.y);
            if (a) {
                this.posInfo = a.x + "," + a.y
            } else {
                this.posInfo = "-1,-1"
            }
        }
    }),
    _onMouseOut: new DNA.engine.Action({
        handle: function(a) {
            if (!this.checkRendered(true)) {
                return
            }
        }
    }),
    _onScroll: new DNA.engine.Action({
        handle: function(a) {
            if (!this.checkRendered(true)) {
                return
            }
            var b = a.getSrcElement();
            if (b != this.tDiv) {
                return
            }
            this._handleScroll();
            this._handleLoad();
            this.fireEvent("currentCellOffsetChanged", [this]);
            this.fireEvent("scrolled", [this])
        }
    }),
    _handleLoad: function() {
        var b = (new Date()).getMilliseconds();
        this.loadTimeStamp = b;
        var a = this;
        setTimeout((function() {
            a._handleLoadStuff(b)
        }), 100)
    },
    _handleLoadStuff: function(a) {
        if (this.loadTimeStamp == a) {
            if (this._needLoad()) {
                this.fireEvent("load", [this]);
                this.operateCell = null 
            }
        }
    },
    _needLoad: function() {
        var d = this.getBounds();
        var a = parseInt(this.utrs[0].style.height);
        var g = this.dtrs[0].offsetTop;
        var b = a > 0 && a > this.tDiv.scrollTop;
        var c = this.tDiv.scrollTop + d.height > g;
        return b || c
    },
    _handleScroll: function() {
        if (this.cwDiv) {
            this.cwDiv.parentNode.scrollLeft = this.tDiv.scrollLeft;
            this.cwDiv.parentNode.scrollTop = this.tDiv.scrollTop
        }
        if (this.hrDiv) {
            this.hrDiv.scrollLeft = this.tDiv.scrollLeft
        }
        if (this.hcDiv) {
            this.hcDiv.scrollTop = this.tDiv.scrollTop
        }
        if (this.frDiv) {
            this.frDiv.scrollLeft = this.tDiv.scrollLeft
        }
        if (this.fcDiv) {
            this.fcDiv.scrollTop = this.tDiv.scrollTop
        }
    },
    setHorizontalPosition: function(a) {
        if (this.tDiv) {
            this.tDiv.scrollLeft = a;
            this._handleScroll()
        }
    },
    setVerticalPosition: function(a) {
        if (this.tDiv) {
            this.tDiv.scrollTop = a;
            this._handleScroll()
        }
    },
    _doBubbleMouseDown: new DNA.engine.Action({
        handle: function(l) {
            var a = l.getSrcElement();
            while (a.className != undefined && a.className.indexOf("Grid2Async") < 0 && a.parentNode) {
                a = a.parentNode
            }
            if (a.className && a.className.indexOf("Grid2Async") >= 0) {
                var b = this._getLocationForChildControl(l);
                var h = this.getCellByCoordinate(b.x, b.y);
                var c = this._getRelativeLocationForChildControl(l);
                var g = c.getSrcControl();
                var d = new DNA.widget.AbstractGridCellAsync(this,null ,h.x,h.y,false);
                if (g._eid == this.defEditorId || g._eid == d.td.getAttribute("ei")) {
                    return
                }
                this.__onMousedown(c, a, true)
            }
        }
    }),
    _getRelativeLocationForChildControl: function(c) {
        var a = this._getLocationForChildControl(c);
        var b = new DNA.JWTEvent(c.getOriginalEvent());
        b.setSrcControl(c.getSrcControl());
        b.setLocation(a);
        return b
    },
    _getLocationForChildControl: function(c) {
        var b = c.getXY();
        var d = DNA.engine.DomUtil.getPageXY(this.tDiv);
        var a = {
            x: b.x - d.x,
            y: b.y - d.y
        };
        return a
    },
    _onMousedown: new DNA.engine.Action({
        handle: function(a) {
            this.__onMousedown(a)
        }
    }),
    __onMousedown: function(l, d, g) {
        if (!this.checkRendered(true)) {
            return
        }
        var b;
        this.needHandleGlobal = true;
        if (d) {
            b = d
        } else {
            b = l.getSrcElement();
            this.mousedownonSelf = true
        }
        if (l.getButton() == 2) {
            var c = l.getLocation();
            var a = this.getCellByCoordinate(c.x, c.y);
            if (!a) {
                return
            }
            if (this._cellSelected(a)) {
                return
            } else {
                if (this.util.isCellSelectable(a.x, a.y)) {
                    this._clearSelection(true);
                    this.setCurrentCell(a, null , null , null , l.getButton())
                }
            }
            return
        }
        if (l.getButton() != 0) {
            return
        }
        if (b == this.tDiv) {
            return
        }
        this.updateGridState(l);
        if (this.getSelectionMode() == DNA.widget.JWTGrid2.SELECTION_MODE_ROW) {
            var c = l.getLocation();
            var a = this.getCellByCoordinate(c.x, c.y);
            if (!a) {
                return
            }
            if (this._cellSelected(a)) {
                if (this.util.isCellSelectable(a.x, a.y)) {
                    this.setCurrentCell(a, null , null , null , l.getButton())
                }
                if (this.gridState < DNA.widget.JWTGrid2.STATE_CELL_EXPAND && (l.isCtrl() || l.isShift())) {
                    return
                }
            }
        }
        switch (this.gridState) {
        case DNA.widget.JWTGrid2.STATE_CELL_OPENEDITOR:
            if (this.currentCell) {
                var h = new DNA.widget.AbstractGridCellAsync(this,null ,this.currentCell.getColIndex(),this.currentCell.getRowIndex(),false);
                this.openEditor(h, l, true, DNA.widget.JWTGrid2.EDITOPEN_CLICKFACE)
            }
            break;
        case DNA.widget.JWTGrid2.STATE_ROW_SELECT:
            this.rowSelectStart(l);
            break;
        case DNA.widget.JWTGrid2.STATE_COL_SELECT:
            this.colSelectStart(l);
            break;
        case DNA.widget.JWTGrid2.STATE_ALL_SELECT:
            this.allSelectStart(l);
            break;
        case DNA.widget.JWTGrid2.STATE_CELL_SELECT:
            this.mouseCellSelectStart(l);
            break;
        case DNA.widget.JWTGrid2.STATE_CELL_EXPAND:
            this.mouseCellExpand(l);
            break;
        case DNA.widget.JWTGrid2.STATE_CELL_COLLAPSE:
            this.mouseCellCollapse(l);
            break;
        case DNA.widget.JWTGrid2.STATE_CELL_CHECK:
            this.mouseCellCheck(l, true);
            break;
        case DNA.widget.JWTGrid2.STATE_CELL_UNCHECK:
            this.mouseCellCheck(l, false);
            break;
        case DNA.widget.JWTGrid2.STATE_SELECTION_CHANGED:
            this.mouseSelectionChangeStart(l);
            break;
        case DNA.widget.JWTGrid2.STATE_COL_EXCHANGE:
            this._colExchangeStart(l);
            break
        }
        if (!g) {
            l._preventDefault()
        }
    },
    _cellSelected: function(b) {
        for (var c = 0, a = this.selectionAreas.length; c < a; ++c) {
            var d = this.selectionAreas[c];
            if (b.x >= d.x && b.x <= d.width && b.y >= d.y && b.y <= d.height) {
                return true
            }
        }
        return false
    },
    getColExchangeable: function() {
        return (this.gridOption & DNA.widget.JWTGrid2.COL_EXCHANG_MASK) != 0
    },
    updateGridState: function(d) {
        if (this.columnCount <= 1 || this.rowCount <= 1) {
            this.gridState = DNA.widget.JWTGrid2.STATE_OUT;
            return
        }
        var a = d.getLocation();
        if (this.resizeRowIdx) {
            this.gridState = DNA.widget.JWTGrid2.STATE_ROW_RESIZE;
            var g = null ;
            if (this.resizeRowIdx >= this.hRowCount) {
                g = this._getCellDom(-1, this.resizeRowIdx, this.hcTable)
            } else {
                g = this._getCellDom(this.resizeColIdx, -1, this.hrTable)
            }
            this.resizeRowPoint = {
                x: 0,
                y: g.parentNode.offsetTop
            };
            return
        }
        if (this.resizeColIdx) {
            this.gridState = DNA.widget.JWTGrid2.STATE_COL_RESIZE;
            var g = null ;
            if (this.resizeColIdx >= this.hColCount) {
                g = this._getCellDom(this.resizeColIdx, -1, this.hrTable)
            } else {
                g = this._getCellDom(this.resizeColIdx, -1, this.hcTable)
            }
            this.resizeColPoint = {
                x: g.offsetLeft,
                y: 0
            };
            return
        }
        var c = this.getCellByCoordinate(a.x, a.y);
        if (!c) {
            this.gridState = DNA.widget.JWTGrid2.STATE_OUT;
            return
        }
        this.mouseCell = c;
        this.lastMouseCell = c;
        if (c.x === 0 && c.y === 0) {
            if (this.getSelectionMode() == DNA.widget.JWTGrid2.SELECTION_MODE_MULTI) {
                this.gridState = DNA.widget.JWTGrid2.STATE_ALL_SELECT
            }
            return
        }
        if (c.x === 0 && c.y > 0) {
            if (this.getRowSelectEnabled() && this.getSelectionMode() == DNA.widget.JWTGrid2.SELECTION_MODE_MULTI) {
                this.gridState = DNA.widget.JWTGrid2.STATE_ROW_SELECT
            } else {
                this.gridState = DNA.widget.JWTGrid2.STATE_NORMAL
            }
            return
        }
        if (c.y === 0 && c.x > 0) {
            if (this.getColExchangeable()) {
                this.gridState = DNA.widget.JWTGrid2.STATE_COL_EXCHANGE;
                return
            }
            if (this.getColSelectEnabled() && this.getSelectionMode() == DNA.widget.JWTGrid2.SELECTION_MODE_MULTI) {
                this.gridState = DNA.widget.JWTGrid2.STATE_COL_SELECT
            } else {
                this.gridState = DNA.widget.JWTGrid2.STATE_NORMAL
            }
            return
        }
        if (c.x > 0 && c.y > 0) {
            if (!this.util.isCellSelectable(c.x, c.y)) {
                this.gridState = DNA.widget.JWTGrid2.STATE_NORMAL;
                return
            }
            if (this._clickFaceArea(c, a.x, a.y)) {
                this.gridState = DNA.widget.JWTGrid2.STATE_CELL_OPENEDITOR;
                return
            }
            this.gridState = DNA.widget.JWTGrid2.STATE_CELL_SELECT
        }
        var b = d.getSrcElement();
        if (b.className == "select_area_div2Async" || b.className == "gridCover") {
            b = this.__findClickDom(c, a)
        }
        if (!b) {
            return
        }
        if (b.className == "expandableCellAsync") {
            this.gridState = DNA.widget.JWTGrid2.STATE_CELL_EXPAND
        } else {
            if (b.className == "checkableCellAsync") {
                this.gridState = DNA.widget.JWTGrid2.STATE_CELL_CHECK
            } else {
                if (b.className == "checkedCellAsync") {
                    this.gridState = DNA.widget.JWTGrid2.STATE_CELL_UNCHECK
                } else {
                    if (b.className == "expandedCellAsync") {
                        this.gridState = DNA.widget.JWTGrid2.STATE_CELL_COLLAPSE
                    } else {
                        if (b.className == "dragPointAsync") {
                            this.gridState = DNA.widget.JWTGrid2.STATE_SELECTION_CHANGED
                        }
                    }
                }
            }
        }
    },
    __findClickDom: function(a, l) {
        var q = this._getCellDom(a.x, a.y, this.tDiv);
        var n = l.x;
        var m = l.y;
        var o = parseInt(q.style.left, 10);
        o += q.firstChild.offsetLeft;
        var d = q.parentNode.offsetTop;
        d += q.firstChild.offsetTop;
        var c = q.childNodes[0].childNodes;
        for (var g = 0, h = c.length; g < h; ++g) {
            var b = c[g];
            if (b.offsetLeft <= n - o && b.offsetLeft + b.offsetWidth >= n - o && b.offsetTop <= m - d && b.offsetTop + b.offsetHeight >= m - d) {
                return b
            }
        }
        return null 
    },
    _clickFaceArea: function(g, c, l) {
        if (!this.curFace) {
            return false
        }
        if (this.currentCell) {
            if ((this.currentCell.getRowIndex() <= g.y && this.currentCell.getColIndex() <= g.x && this.currentCell.getRowIndex() + this.currentCell.td.rowSpan - 1 >= g.y && this.currentCell.getColIndex() + this.currentCell.td.colSpan - 1 >= g.x) ) {
                if (c > this.hcDiv.offsetWidth && this.tDiv.scrollLeft) {
                    c += this.tDiv.scrollLeft
                }
                if (l > this.hrDiv.offsetHeight && this.tDiv.scrollTop) {
                    l += this.tDiv.scrollTop
                }
                var b = this.currentCell.td.offsetLeft;
                var h = this.currentCell.td.parentNode.offsetTop;
                var d = this.currentCell.td.offsetWidth;
                var a = this.currentCell.td.offsetHeight;
                if (c >= b + d - 18 && c <= b + d && l >= h && l <= h + a) {
                    return true
                }
                return false
            }
        }
        return false
    },
    _onMouseup: function(d) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = d.getSrcElement();
        a.style.cursor = "default";
        var b = d.getLocation();
        var c = this.getCellByCoordinate(b.x, b.y);
        if (!c && this.gridState != DNA.widget.JWTGrid2.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid2.STATE_ROW_RESIZE) {
            this.gridState = DNA.widget.JWTGrid2.STATE_OUT;
            return
        }
        this.mouseCell = c;
        switch (this.gridState) {
        case DNA.widget.JWTGrid2.STATE_ROW_SELECT:
            this.rowSelectEnd(d);
            break;
        case DNA.widget.JWTGrid2.STATE_COL_SELECT:
            this.colSelectEnd(d);
            break;
        case DNA.widget.JWTGrid2.STATE_CELL_SELECT:
            this.mouseCellSelectEnd(d);
            break;
        case DNA.widget.JWTGrid2.STATE_ROW_RESIZE:
            this.rowResizeEnd(d);
            break;
        case DNA.widget.JWTGrid2.STATE_COL_RESIZE:
            this.colResizeEnd(d);
            break
        }
        this.gridState = DNA.widget.JWTGrid2.STATE_NORMAL
    },
    rowSelectEnd: function(a) {
        this.selectionDiv.style.borderStyle = "none";
        if (this.currentSelection) {
            this.currentSelection.reBuild(true, 100001);
            this._internalDrawTitle(this.currentSelection, false, true);
            this.fireEvent("selection", [this])
        }
    },
    colSelectEnd: function(a) {
        this.selectionDiv.style.borderStyle = "none";
        if (this.currentSelection) {
            this.currentSelection.reBuild(true, 100001);
            this.fireEvent("selection", [this])
        }
    },
    allSelectEnd: function(a) {
        if (this.currentSelection) {
            this.currentSelection.reBuild(true);
            this.fireEvent("selection", [this])
        }
    },
    rowResizeEnd: function(b) {
        if (this.resizeRowIdx && this.newSize != -1) {
            var a = b.getSrcElement();
            a.style.cursor = "default";
            this.tDiv.style.cursor = "default";
            this.setRowHeight(this.resizeRowIdx, this.newSize);
            this.resizeDiv.style.display = "none";
            this.resizeDiv.style.height = "0px";
            this.fireEvent("rowresize", [this, this.resizeRowIdx]);
            this.resizeRowIdx = 0;
            this.resizeColIdx = 0;
            this.newSize = -1;
            this._reBoundCurCell();
            if (DNA.engine.Client.isIE()) {
                this._rePositionFooter()
            }
            return
        }
    },
    colResizeEnd: function(b) {
        if (this.resizeColIdx && this.newSize != -1) {
            var a = b.getSrcElement();
            a.style.cursor = "default";
            this.tDiv.style.cursor = "default";
            this.setColumnWidth(this.resizeColIdx, this.newSize);
            this.resizeDiv.style.display = "none";
            this.resizeDiv.style.width = "0px";
            this.fireEvent("columnresize", [this, this.resizeColIdx]);
            this.resizeColIdx = 0;
            this.resizeRowIdx = 0;
            this.newSize = -1;
            this._reBoundCurCell();
            if (DNA.engine.Client.isIE()) {
                this._rePositionFooter()
            }
            return
        }
    },
    _rePositionFooter: function() {
        if (this.tDiv.scrollTop == 0) {
            this.frDiv.style.bottom = "0px";
            this.flbDiv.style.bottom = "0px";
            this.frbDiv.style.bottom = "0px";
            this.hrtDiv.style.top = "0px"
        } else {
            this.frDiv.style.bottom = "";
            this.flbDiv.style.bottom = "";
            this.frbDiv.style.bottom = "";
            this.hrtDiv.style.top = ""
        }
        this.frDiv.style.top = "";
        this.flbDiv.style.top = "";
        this.frbDiv.style.top = "";
        this.hrtDiv.style.left = "";
        if (this.tDiv.scrollLeft == 0) {
            this.fcDiv.style.right = "0px";
            this.hrtDiv.style.right = "0px";
            this.frbDiv.style.right = "0px"
        } else {
            this.fcDiv.style.right = "";
            this.hrtDiv.style.right = "";
            this.frbDiv.style.right = ""
        }
        this.fcDiv.style.left = "";
        this.hrtDiv.style.left = "";
        this.frbDiv.style.left = ""
    },
    _onGridMousemove: function(c) {
        var a = c.getLocation();
        var b = this.getCellByCoordinate(a.x, a.y);
        if (!b && this.gridState != DNA.widget.JWTGrid2.STATE_COL_RESIZE && this.gridState != DNA.widget.JWTGrid2.STATE_ROW_RESIZE) {
            this.gridState = DNA.widget.JWTGrid2.STATE_OUT;
            return
        }
        this.mouseCell = b;
        if (this.gridState == DNA.widget.JWTGrid2.STATE_NORMAL) {
            this.updateCursor(c)
        }
    },
    rowSelecting: function(c) {
        if (this.lastMouseCell.y != this.mouseCell.y) {
            this.lastMouseCell = this.mouseCell;
            if (this.currentSelection) {
                var d = Math.min(this.currentRow, this.mouseCell.y);
                var b = Math.max(this.currentRow, this.mouseCell.y);
                var a = {
                    x: 1,
                    y: d,
                    width: this.columnCount - 1,
                    height: b
                };
                this.currentSelection._setBound(a);
                this.currentSelection.redraw()
            }
        }
    },
    colSelecting: function(d) {
        if (this.lastMouseCell.x != this.mouseCell.x) {
            this.lastMouseCell = this.mouseCell;
            if (this.currentSelection) {
                var b = Math.min(this.currentCol, this.mouseCell.x);
                var a = Math.max(this.currentCol, this.mouseCell.x);
                var c = {
                    x: b,
                    y: 1,
                    width: a,
                    height: this.rowCount - 1
                };
                this.currentSelection._setBound(c);
                this.currentSelection.redraw()
            }
        }
    },
    rowResizing: function(b) {
        if (this.resizeRowIdx) {
            var a = b.getSrcElement();
            a.style.cursor = "row-resize";
            this._placeResizeDiv(b.getLocation().y)
        }
    },
    colResizing: function(b) {
        if (this.resizeColIdx) {
            var a = b.getSrcElement();
            a.style.cursor = "col-resize";
            this._placeResizeDiv(b.getLocation().x)
        }
    },
    updateCursor: function(g) {
        var b = this.mouseCell;
        var l = g.getSrcElement();
        var h = g.getLocation();
        this.resizeColIdx = 0;
        this.resizeRowIdx = 0;
        if (!(l.className.indexOf("gridCell") > -1 || l.className.indexOf("titleCell") > -1 || l.className == "dragPointAsync" || l.className == "gridCover")) {
            return
        }
        var c = this._getCellDom(-1, b.y, this.tDiv);
        var n = c.parentNode.offsetTop;
        var m = c.offsetHeight;
        if ((h.y + this.tDiv.scrollTop >= n + m - this.resizeCursorBound && h.y + this.tDiv.scrollTop <= n + m) || (h.y + this.tDiv.scrollTop >= n && h.y + this.tDiv.scrollTop <= n + this.resizeCursorBound)) {
            if ((b.x == 0 || this.getRowFreeResizeEnabled()) && b.y > 0 && this.getRowResizeEnable()) {
                if (b.y > this.hRowCount && this.tDiv.scrollTop) {
                    h.y += this.tDiv.scrollTop
                }
                if (b.y == 1) {
                    if (h.y >= n + m - this.resizeCursorBound && h.y <= n + m) {
                        this.resizeRowIdx = 1;
                        l.style.cursor = "row-resize"
                    } else {
                        this.resizeRowIdx = 0;
                        l.style.cursor = "default"
                    }
                } else {
                    if (h.y >= n + m - this.resizeCursorBound && h.y <= n + m) {
                        this.resizeRowIdx = this.util.getUpRow(b.y + 1);
                        l.style.cursor = "row-resize"
                    } else {
                        if (h.y >= n && h.y <= n + this.resizeCursorBound) {
                            this.resizeRowIdx = this.util.getUpRow(b.y);
                            l.style.cursor = "row-resize"
                        }
                    }
                }
                return
            }
        }
        c = this._getHeaderCellDom(b.x, 0);
        var d = c.offsetLeft;
        var a = c.offsetWidth;
        if ((h.x + this.tDiv.scrollLeft >= d + a - this.resizeCursorBound && h.x + this.tDiv.scrollLeft <= d + a) || (h.x + this.tDiv.scrollLeft >= d && h.x + this.tDiv.scrollLeft <= d + this.resizeCursorBound)) {
            if ((b.y == 0 || this.getColFreeResizeEnabled()) && b.x > 0 && this.getColResizeEnable()) {
                if (b.x > this.hColCount && this.tDiv.scrollLeft) {
                    h.x += this.tDiv.scrollLeft
                }
                if (b.x == 1) {
                    if (h.x >= d + a - this.resizeCursorBound && h.x <= d + a) {
                        this.resizeColIdx = 1;
                        l.style.cursor = "col-resize"
                    } else {
                        this.resizeColIdx = 0;
                        l.style.cursor = "default"
                    }
                } else {
                    if (h.x >= d + a - this.resizeCursorBound && h.x <= d + a) {
                        this.resizeColIdx = this.util.getLeftCol(b.x + 1);
                        l.style.cursor = "col-resize"
                    } else {
                        if (h.x >= d && h.x <= d + this.resizeCursorBound) {
                            this.resizeColIdx = this.util.getLeftCol(b.x);
                            l.style.cursor = "col-resize"
                        }
                    }
                }
                return
            }
        }
        l.style.cursor = "default";
        if (this.headerCursor && (b.x == 0 || b.y == 0)) {
            l.style.cursor = this.headerCursor
        }
        if (l.className == "dragPointAsync") {
            l.style.cursor = "crosshair"
        }
        this.resizeColIdx = 0;
        this.resizeRowIdx = 0
    },
    _onKeyDown: new DNA.engine.Action({
        handle: function(a) {
            if (!this.checkRendered(true)) {
                return
            }
            if (this.currentCol === -1 || this.currentRow === -1) {
                return
            }
            switch (a.getKeyCode()) {
            case DNA.JWTEvent.LEFT:
            case DNA.JWTEvent.RIGHT:
            case DNA.JWTEvent.UP:
            case DNA.JWTEvent.DOWN:
            case DNA.JWTEvent.HOME:
            case DNA.JWTEvent.END:
                this.keydownNavigation(a);
                a._preventDefault();
                break;
            case DNA.JWTEvent.ENTER:
                this.keyEnterDown(a);
                a._preventDefault();
                break;
            case DNA.JWTEvent.DELETE:
                if (this.getEditMode() != DNA.widget.JWTGrid2.EDIT_MODE_READONLY) {
                    this.deleteText(DNA.widget.JWTGrid.DATACHANGE_DEL)
                }
                a._preventDefault();
                break;
            case DNA.JWTEvent.PAGEUP:
            case DNA.JWTEvent.PAGEDOWN:
                this.keydownPage(a);
                a._preventDefault();
                break;
            case 86:
                if (a.isCtrl()) {
                    if (this.getEditMode() != DNA.widget.JWTGrid2.EDIT_MODE_READONLY) {
                        this.pasteText()
                    }
                    a._preventDefault()
                }
                break;
            case 67:
                if (a.isCtrl()) {
                    var b = this.copyText();
                    if (b) {
                        DNA.adapter.ClipboardUtil.copyToClipboard(b)
                    }
                    a._preventDefault()
                }
                break;
            case 88:
                if (a.isCtrl()) {
                    if (this.getEditMode() != DNA.widget.JWTGrid2.EDIT_MODE_READONLY) {
                        var b = this.cutText();
                        if (b) {
                            DNA.adapter.ClipboardUtil.copyToClipboard(b)
                        }
                    }
                    a._preventDefault()
                }
                break;
            case 77:
                break;
            case 85:
                break;
            case DNA.JWTEvent.F2:
                this.openCurrentEditor();
                break
            }
        }
    }),
    _onKeyPress: function(b) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = b.getKeyCode();
        if ((a >= 48 && a <= 57) || (a >= 65 && a <= 90) || (a >= 97 && a <= 122)) {
            if (this.currentCell) {
                this.openEditor(this.currentCell, b, false, DNA.widget.JWTGrid2.EDITOPEN_INPUT)
            }
        }
    },
    _deleteData: function(a) {},
    _pasteData: function(a) {},
    _copyData: function(a) {},
    _cutData: function(a) {},
    deleteText: function(g) {
        var b = this.selectionAreas.length;
        for (var c = 0; c < b; ++c) {
            this._deleteText(this.selectionAreas[c], g)
        }
        var h = this.getCurrentCell();
        if (h) {
            var a = this.getCell(h.x, h.y);
            if (a.getShowText()) {
                var d = {
                    x: h.x,
                    y: h.y,
                    width: h.x,
                    height: h.y
                };
                this._deleteText(d, g)
            }
        }
    },
    _deleteText: function(g, h) {
        var b = false;
        for (var d = g.y; d <= g.height; ++d) {
            if (this.ignoreHidden && this.getRowHidden(d)) {
                continue
            }
            for (var c = g.x; c <= g.width; ++c) {
                if (this.ignoreHidden && this.getColHidden(c)) {
                    continue
                }
                if (this.util.isCellEditable(c, d)) {
                    var a = this.getCell(c, d);
                    a.setShowText("", true);
                    a.setEditText("", true);
                    b = true
                }
            }
        }
        if (b) {
            this.fireDataChangeEvent(g, h)
        }
    },
    pasteText: function() {
        var b = this.getCurrentCell();
        if (b) {
            var a = {
                x: b.x,
                y: b.y,
                width: 1,
                height: 1
            };
            this._pasteText(a)
        }
    },
    _trimEnd: function(b) {
        if (!b || b.length == 0) {
            return b
        }
        var a = b.length;
        for (var c = a - 1; c >= 0; --c) {
            if (!b[c]) {
                --a
            }
            break
        }
        b.length = a;
        return b
    },
    _pasteText: function(a) {
        var b = this;
        DNA.adapter.ClipboardUtil.getClipboard(function(l) {
            var u = a.x + "," + a.y;
            var B = {
                doit: true
            };
            b.fireEvent("paste", [b, l, u, B]);
            if (!B.doit) {
                return
            }
            var c;
            if (DNA.engine.Client.isFF()) {
                c = l.split("\n")
            } else {
                c = l.split("\r\n")
            }
            c = b._trimEnd(c);
            var n = c.length;
            if (n > 0) {
                var v = Math.min(b.rowCount - 1, a.y + n - 1);
                var s = 0;
                for (var A = 0; A < n; A++) {
                    var h = c[A].split("\t");
                    s = Math.max(s, h.length)
                }
                var g;
                if (s > 0) {
                    g = Math.min(b.columnCount - 1, a.x + s - 1)
                }
                var z = false;
                var m = a.y - 1;
                var t = a.x - 1;
                for (var A = a.y; A <= v; ++A) {
                    var p = c[A - a.y].split("\t");
                    t = a.x - 1;
                    m = b.util.getDownRow(m);
                    for (var w = a.x; w <= g; ++w) {
                        var d = null ;
                        if (!b.ignoreHidden) {
                            d = b.getCell(w, A)
                        } else {
                            t = b.util.getRightCol(t);
                            if (b.util.isDataCell(t, m)) {
                                d = b.getCell(t, m)
                            }
                        }
                        if (d && b.util.isCellEditable(d.getColIndex(), d.getRowIndex())) {
                            var q = p[w - a.x];
                            if (!q) {
                                q = ""
                            }
                            if (q.indexOf("image://") == 0) {
                                d.setShowText("image://", true);
                                d.setEditText(q.substr(8), true)
                            } else {
                                d.setEditText(q, true);
                                var o = b.getFormattedText(d);
                                if (o) {
                                    d.setShowText(o, true)
                                } else {
                                    d.setShowText(q, true)
                                }
                            }
                            z = true
                        }
                    }
                }
                if (z) {
                    var r = {
                        x: a.x,
                        y: a.y,
                        width: g,
                        height: v
                    };
                    b.fireDataChangeEvent(r, DNA.widget.JWTGrid2.DATACHANGE_PASTE)
                }
            }
        })
    },
    copyText: function() {
        var a = this.getCurrentSelection();
        var b = null ;
        if (a) {
            b = a
        } else {
            var d = this.getCurrentCell();
            if (d) {
                b = {
                    x: d.x,
                    y: d.y,
                    width: d.x,
                    height: d.y
                }
            }
        }
        if (b) {
            var c = {
                doit: true
            };
            this.fireEvent("copy", [this, {
                x: b.x,
                y: b.y,
                width: b.width,
                height: b.height
            }, c]);
            if (!c.doit) {
                return null 
            }
            return this._copyText(b)
        }
        return null 
    },
    cutText: function() {
        var a = this.getCurrentSelection();
        if (a) {
            var b = this._cutText(a);
            if (b) {
                this.fireDataChangeEvent(a, DNA.widget.JWTGrid2.DATACHANGE_CUT);
                return b
            }
        }
        return null 
    },
    _copyText: function(a) {
        return this._getText(a, false)
    },
    _cutText: function(a) {
        return this._getText(a, true)
    },
    _getText: function(h, d) {
        var n = "";
        var a = /\r\n/g;
        for (var c = h.y; c <= h.height; ++c) {
            if (this.ignoreHidden && this.getRowHidden(c)) {
                continue
            }
            for (var b = h.x; b <= h.width; ++b) {
                if (this.ignoreHidden && this.getColHidden(b)) {
                    continue
                }
                var m = this.getCell(b, c);
                var g = m.getShowText();
                if (!g) {
                    g = ""
                }
                g = g.replace(a, "\n");
                n += g;
                if ("image://" == g) {
                    var l = m.getEditText();
                    if (l) {
                        n += l
                    }
                }
                if (b != h.width) {
                    n += "\t"
                }
                if (d && m.getEditable()) {
                    m.setShowText("", true);
                    m.setEditText("", true)
                }
            }
            if (c != h.height) {
                n += "\r\n"
            }
        }
        return n
    },
    toString: function() {
        return "Grid2Async"
    },
    _placeResizeDiv: function(c) {
        if (!this.checkRendered(true)) {
            return
        }
        if (this.resizeRowIdx) {
            if (this.tDiv.scrollTop && this.resizeRowIdx >= this.hRowCount) {
                c += this.tDiv.scrollTop
            }
            this.resizeDiv.style.display = "block";
            this.resizeDiv.style.left = (this.resizeRowPoint.x - this.tDiv.scrollLeft) + "px";
            this.resizeDiv.style.top = (this.resizeRowPoint.y - this.tDiv.scrollTop) + "px";
            this.resizeDiv.style.width = this.tDiv.offsetWidth + "px";
            var a = c - this.resizeRowPoint.y;
            if (a <= this.minRowHeight) {
                a = this.minRowHeight
            }
            this.newSize = a;
            this.resizeDiv.style.height = a + "px";
            this.resizeDiv.style.borderStyle = "dashed none dashed none";
            this.resizeDiv.style.borderWidth = "1px 0px 1px 0px";
            return
        }
        if (this.resizeColIdx) {
            if (this.tDiv.scrollLeft && this.resizeColIdx >= this.hColCount) {
                c += this.tDiv.scrollLeft
            }
            this.resizeDiv.style.display = "block";
            this.resizeDiv.style.left = (this.resizeColPoint.x - this.tDiv.scrollLeft) + "px";
            this.resizeDiv.style.top = (this.resizeColPoint.y - this.tDiv.scrollTop) + "px";
            this.resizeDiv.style.height = this.tDiv.offsetHeight + "px";
            var b = c - this.resizeColPoint.x;
            if (b <= this.minColWidth) {
                b = this.minColWidth
            }
            this.newSize = b;
            this.resizeDiv.style.width = b + "px";
            this.resizeDiv.style.borderStyle = "none dashed none dashed";
            this.resizeDiv.style.borderWidth = "0px 1px 0px 1px";
            return
        }
    },
    _getRowDom: function(a, b) {
        if (!this.checkRendered(true)) {
            return
        }
        var d = null ;
        try {
            if (b != this.tDiv && b != this.hcTable && b != this.fcTable) {
                d = b.childNodes[a + 2]
            } else {
                if (a >= this.renderedTop && a <= this.renderedTop + this.renderedCount) {
                    d = b.childNodes[a - this.renderedTop + 2]
                }
            }
        } catch (c) {
            alert("�����ڵ�" + a + "��")
        }
        return d
    },
    _getRowCell: function(d, b, g) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = null ;
        try {
            a = d.childNodes[b + 1]
        } catch (c) {
            alert("���������Ϊ(" + b + "," + g + ")�ĵ�Ԫ��")
        }
        if (!a) {
            throw "���������Ϊ(" + b + "," + g + ")�ĵ�Ԫ��"
        }
        return a
    },
    _getCellDom: function(g, d, n, l, a) {
        if (!this.checkRendered(true)) {
            return
        }
        var h = null ;
        if (d == -1) {
            try {
                h = n.childNodes[1].childNodes[g + 1]
            } catch (c) {
                alert("���������Ϊ(" + g + "," + d + ")�ĵ�Ԫ��")
            }
        }
        var b = l ? l : this.renderedTop;
        var m = a ? a : this.renderedTop + this.renderedCount;
        if (d >= b && d <= m) {
            try {
                h = n.childNodes[d - b + 2].childNodes[g + 1]
            } catch (c) {
                alert("���������Ϊ(" + g + "," + d + ")�ĵ�Ԫ��")
            }
        }
        return h
    },
    _getHeaderCellDom: function(b, d) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = null ;
        try {
            a = this.hrTable.childNodes[d + 2].childNodes[b + 1]
        } catch (c) {
            alert("���������Ϊ(" + b + "," + d + ")�ĵ�Ԫ��")
        }
        return a
    },
    getCellByCoordinate: function(b, a) {
        if (!this.checkRendered(true)) {
            return
        }
        if (b < 0 || a,
        0) {
            return null 
        }
        var c = this.getBounds();
        if (b > c.width || a > c.height) {
            return null 
        }
        if (b > this.hcDiv.offsetWidth && this.tDiv.scrollLeft) {
            b += this.tDiv.scrollLeft
        }
        if (a > this.hrDiv.offsetHeight && this.tDiv.scrollTop) {
            a += this.tDiv.scrollTop
        }
        var o = {
            x: -1,
            y: -1
        };
        var l = parseInt(this.utrs[0].style.height, 10);
        for (var h = this.renderedTop; h < this.renderedTop + this.renderedCount; h++) {
            if (!this.getRowHidden(h)) {
                var n = this.rowHeights[h] + l;
                if (a >= l && a < n) {
                    o.y = h;
                    break
                } else {
                    l = n
                }
            }
        }
        var m = 0;
        for (var d = 0; d < this.columnCount; d++) {
            if (!this.getColHidden(d)) {
                var g = this.colWidths[d] + m;
                if (b >= m && b < this.colWidths[d] + m) {
                    o.x = d;
                    break
                } else {
                    m = g
                }
            }
        }
        return o
    },
    _getMidDisplayRow: function(d, b) {
        var c = Math.floor((d + b) / 2);
        var g = this.tDiv.childNodes[c];
        var a = g;
        while (a.style.display == "none" && d < c) {
            c--;
            a = this.tDiv.childNodes[c]
        }
        if (this.tDiv.childNodes[c].style.display != "none") {
            return c
        }
        c = Math.floor((d + b) / 2);
        a = g;
        while (a.style.display == "none" && c < b) {
            c++;
            a = this.tDiv.childNodes[c]
        }
        if (this.tDiv.childNodes[c].style.display != "none") {
            return c
        }
        return -1
    },
    getCellByPoint: function(l, h) {
        if (!this.checkRendered(true)) {
            return
        }
        var n = {
            x: -1,
            y: -1
        };
        var g = 1;
        var b = this.rowCount;
        var m;
        while (g <= b) {
            m = Math.floor((g + b) / 2);
            var d = this.tDiv.childNodes[m];
            var p = d.offsetTop;
            var a = d.offsetHeight;
            if (h > p + a) {
                g = m + 1
            } else {
                if (h < p) {
                    b = m - 1
                } else {
                    n.y = m - 1;
                    break
                }
            }
        }
        g = 1;
        b = this.columnCount;
        var d = this.tDiv.childNodes[0];
        while (g <= b) {
            m = Math.floor((g + b) / 2);
            var o = d.childNodes[m];
            var q = o.offsetLeft;
            var c = o.offsetWidth;
            if (l > q + c) {
                g = m + 1
            } else {
                if (l < q) {
                    b = m - 1
                } else {
                    n.x = m - 1;
                    break
                }
            }
        }
        if (n.x == -1 || n.y == -1) {
            return null 
        }
        return n
    },
    getCell: function(a, b) {
        if (!this.checkRendered(true)) {
            return
        }
        if (a < 0 || a >= this.columnCount || b < 0 || b >= this.rowCount) {
            return null 
        }
        if (this.operateCell && (a == this.operateCell.getColIndex()) && (b == this.operateCell.getRowIndex())) {
            return this.operateCell
        } else {
            this.operateCell = new DNA.widget.GridCell2Async(this,a,b);
            return this.operateCell
        }
    },
    getGridArea: function(a) {
        if (a.x == this.operateArea.left && a.y == this.operateArea.top && a.width == this.operateArea.right && a.height == this.operateArea.bottom) {
            return this.operateArea
        }
        return new DNA.widget.GridArea(this,a)
    },
    _canMerge: function(m, l, h, b) {
        if (!this.checkRendered(true)) {
            return false
        }
        if (m <= 0 || m > h || h >= this.columnCount) {
            return false
        }
        if (l <= 0 || l > b || b >= this.rowCount) {
            return false
        }
        if (m == h && l == b) {
            return false
        }
        if (m < this.hColCount && h >= this.hColCount) {
            return false
        }
        if (l < this.hRowCount && b >= this.hRowCount) {
            return false
        }
        var d, a;
        for (var g = l; g <= b; ++g) {
            d = this._getCellDom(m, g, this.tDiv);
            a = this._getCellDom(h, g, this.tDiv);
            if (d.isSpan || a.isSpan) {
                return false
            }
        }
        for (var c = m; c <= h; ++c) {
            d = this._getCellDom(c, l, this.tDiv);
            a = this._getCellDom(c, b, this.tDiv);
            if (d.isSpan || a.isSpan) {
                return false
            }
        }
        return true
    },
    merge: function(l, h, c, b) {
        if (!this._canMerge(l, h, c, b)) {
            return false
        }
        this.clearSelection();
        var g = c - l + 1;
        var d = b - h + 1;
        var a = new DNA.widget.AbstractGridCellAsync(this,this.tDiv,l,h,true);
        a.merge(g, d, this.cwDiv);
        if (l < this.hColCount) {
            a = new DNA.widget.AbstractGridCellAsync(this,this.hcTable,l,h,true);
            a.merge(g, d, this.hccwDiv)
        }
        if (h < this.hRowCount) {
            a = new DNA.widget.AbstractGridCellAsync(this,this.hrTable,l,h,true);
            a.merge(g, d, this.hrDiv)
        }
        if (l < this.hColCount && h < this.hRowCount) {
            a = new DNA.widget.AbstractGridCellAsync(this,this.hltTab,l,h,true);
            a.merge(g, d, this.hltDiv)
        }
        this._resizeControl(a);
        this._reBoundCurCell();
        this._reBoundFace();
        this.getCell(l, h).setFitFontSize();
        return true
    },
    _resizeControl: function(l, c) {
        var m = l.td.offsetHeight;
        var b = l.td.offsetWidth;
        var h = this.controlCells.length;
        for (var g = 0; g < h; ++g) {
            var a = this.controlCells.get(g);
            if (a.y == l.rowIndex && a.x == l.colIndex) {
                var n = a.eid;
                var d = DNA.widget.WidgetRegistry.get(n);
                if (d) {
                    if (c) {
                        d.setSize(1, 1)
                    } else {
                        d.setSize(b - 1, m - 1)
                    }
                }
            }
        }
    },
    unmerge: function(a, c) {
        if (!this.checkRendered(true)) {
            return
        }
        this.clearSelection();
        var b = new DNA.widget.AbstractGridCellAsync(this,this.tDiv,a,c,true);
        b.unmerge(this.cwDiv);
        if (a < this.hColCount) {
            var b = new DNA.widget.AbstractGridCellAsync(this,this.hcTable,a,c,true);
            b.unmerge(this.hccwDiv)
        }
        if (c < this.hRowCount) {
            var b = new DNA.widget.AbstractGridCellAsync(this,this.hrTable,a,c,true);
            b.unmerge(this.hrDiv)
        }
        if (a < this.hColCount && c < this.hRowCount) {
            var b = new DNA.widget.AbstractGridCellAsync(this,this.hltTab,a,c,true);
            b.unmerge(this.hltDiv)
        }
        this._resizeControl(b);
        this._reBoundCurCell();
        this._reBoundFace();
        this.getCell(a, c).setFitFontSize()
    },
    _adjustScroll: function() {
        var g = DNA.engine.DomUtil.getClientSize(this.gel);
        var d = this.tDiv.scrollLeft ? this.tDiv.scrollLeft : 0;
        var b = this.tDiv.scrollTop ? this.tDiv.scrollTop : 0;
        var h = DNA.engine.DomUtil.getSize(this.tDiv);
        if (h.width > g.width && g.width + d > h.width) {
            var c = h.width - g.width;
            this.tDiv.scrollLeft = c;
            if (this.hrDiv) {
                this.hrDiv.scrollLeft = this.tDiv.scrollLeft
            }
        }
        if (h.height > g.height && g.height + b > h.height) {
            var a = h.height - g.height;
            this.tDiv.scrollTop = a;
            if (this.hcDiv) {
                this.hcDiv.scrollTop = this.tDiv.scrollTop
            }
        }
    },
    adjustRowHeight: function(c) {
        if (!this.checkRendered(true)) {
            return
        }
        if (!this.util.isDataRow(c)) {
            return
        }
        var b = this._getCellDom(-1, c, this.tDiv);
        if (b.getAttribute("hf")) {
            return
        }
        var a = b.offsetHeight;
        this._getCellDom(-1, c, this.hcTable).style.height = this._getPXSize(a);
        if (c < this.hRowCount) {
            this._getCellDom(-1, c, this.hltTab).style.height = this._getPXSize(a);
            this._getCellDom(-1, c, this.hrTable).style.height = this._getPXSize(a)
        }
        this._ajustLockedSections();
        this._reBoundCurCell();
        this._reComputeSelections(c, -1);
        this._reBoundFace()
    },
    setRowHeight: function(o, v) {
        if (!this.checkRendered(true)) {
            return
        }
        if (!this.util.isDataRow(o)) {
            return
        }
        if (v < this.minRowHeight) {
            return
        }
        if (this.getRowHidden(o)) {
            return
        }
        this._resizeRowHeight2Cells(this.tDiv, o, v);
        this._resizeRowHeight2Cells(this.hcTable, o, v);
        this._resizeRowHeight2Cells(this.fcTable, o, v);
        if (o < this.hRowCount) {
            this._resizeRowHeight2Cells(this.hltTab, o, v);
            this._resizeRowHeight2Cells(this.hrTable, o, v);
            this._resizeRowHeight2Cells(this.hrtTab, o, v)
        }
        if (o > this.rowCount - this.fRowCount) {
            this._resizeRowHeight2Cells(this.flbTab, o, v);
            this._resizeRowHeight2Cells(this.frTable, o, v);
            this._resizeRowHeight2Cells(this.frbTab, o, v)
        }
        for (var E = 0, D = this.getColumnCount(); E < D; E++) {
            this.getCell(E, o).setFitFontSize()
        }
        this._ajustLockedSections();
        this._reBoundCurCell();
        this._reComputeSelections(o, -1);
        this._adjustScroll();
        this._reBoundFace();
        var I = v - this.rowHeights[o];
        this.rowHeights[o] = v;
        if (o >= this.renderedTop && o < this.renderedTop + this.renderedCount) {
            for (var E = 0, D = this.getColumnCount(); E < D; E++) {
                var H = this.getCell(E, o);
                H.rePositionTextWrapper();
                var b = H.td.htmlDiv;
                if (b) {
                    H._rePositionTextWrapper(b)
                }
            }
        }
        var l = [this.tDiv, this.hcTable, this.fcTable];
        for (var w = 0; w < l.length; w++) {
            var F = l[w];
            for (var E = this.renderedTop, D = this.renderedTop + this.renderedCount; E < D; E++) {
                for (var C = 0, B = F.childNodes[1].childNodes.length - 1; C < B; C++) {
                    var h = this._getCellDom(C, E, F);
                    var b = h.htmlDiv;
                    if (b) {
                        b.style.top = h.parentNode.offsetTop + "px"
                    }
                }
            }
        }
        for (var D = 0; D < this.mergeDivs.length; D++) {
            var G = this.mergeDivs[D];
            var u = parseInt(G.getAttribute("ri"));
            var p = parseInt(G.getAttribute("ci"));
            var g = parseInt(G.getAttribute("rs"));
            var d = parseInt(G.getAttribute("cs"));
            var a, r;
            if (u <= o && u + g > o) {
                a = new DNA.widget.IGridCellAsync(this);
                a.td = G;
                r = DNA.engine.DomUtil.getInnerText(G.firstChild);
                var A = 0;
                for (var E = 0; E < d; E++) {
                    var z = p + E;
                    if (!this.getColHidden(z)) {
                        A += this.getColumnWidth(z)
                    }
                }
                var v = 0;
                for (var E = 0; E < g; E++) {
                    var t = u + E;
                    if (!this.getRowHidden(t)) {
                        v += this.getRowHeight(t)
                    }
                }
                var s = this.util.reVertAlignDiv(v, A, a.isWrapLine(), r, a.getFont(), G.firstChild, a.getVertAlign())
            }
        }
        this._resizeCoverSizeAfterHeightChange(o, I);
        this._resizeNRepositionStaffs4RowChange(o)
    },
    _resizeRowHeight2Cells: function(d, m, b) {
        if (b >= 0) {
            var l = b - this.rowHeights[m];
            var g = d.childNodes[m + 2 - this.renderedTop];
            g.style.height = this._getPXSize(b);
            b -= 1;
            for (var c = 0; c < g.childNodes.length; c++) {
                var a = g.childNodes[c];
                a.style.height = this._getPXSize(b);
                var h = a.htmlDiv;
                if (h) {
                    h.style.height = this._getPXSize(b)
                }
            }
        }
    },
    getRowHeight: function(a) {
        if (!this.checkRendered(true)) {
            return 0
        }
        if (a < 0 || a >= this.rowCount) {
            return 0
        }
        return this.rowHeights[a]
    },
    getRowHeightFromStyle: function(c) {
        if (!this.checkRendered(true)) {
            return 0
        }
        if (c < 0 || c >= this.rowCount) {
            return 0
        }
        var a = 0;
        var b = this._getCellDom(0, c, this.tDiv);
        if (b) {
            a = parseInt(b.style.height, 10)
        }
        return a
    },
    setColumnWidth: function(p, r) {
        if (!this.checkRendered(true)) {
            return
        }
        if (!this.util.isDataCol(p)) {
            return
        }
        if (r < this.minColWidth) {
            return
        }
        if (p <= 0 || p >= this.columnCount) {
            return
        }
        var s = this._getCellDom(p, -1, this.tDiv);
        if (s.getAttribute("hf")) {
            return
        }
        this._resizeColumnWidth2Cells(this.tDiv, p, r);
        this._resizeColumnWidth2Cells(this.hrTable, p, r);
        this._resizeColumnWidth2Cells(this.frTable, p, r);
        if (p < this.hColCount) {
            this._resizeColumnWidth2Cells(this.hltTab, p, r);
            this._resizeColumnWidth2Cells(this.hcTable, p, r);
            this._resizeColumnWidth2Cells(this.flbTab, p, r)
        }
        this._reBoundCurCell();
        this._reComputeSelections(-1, p);
        this._adjustScroll();
        this._reBoundFace();
        this._resizeCoverSizeAfterWidthChange(p, r - this.colWidths[p]);
        var w = r - this.colWidths[p];
        this.colWidths[p] = r;
        this._ajustLockedSections();
        for (var u = this.renderedTop, t = this.renderedTop + this.renderedCount; u < t; u++) {
            this.getCell(p, u).setFitFontSize();
            this.getCell(p, u).rePositionTextWrapper()
        }
        for (var t = 0; t < this.mergeDivs.length; t++) {
            var v = this.mergeDivs[t];
            var m = parseInt(v.getAttribute("ri"));
            var g = parseInt(v.getAttribute("ci"));
            var d = parseInt(v.getAttribute("rs"));
            var c = parseInt(v.getAttribute("cs"));
            var a, h;
            if (g <= p && g + c > p) {
                a = new DNA.widget.IGridCellAsync(this);
                a.td = v;
                h = DNA.engine.DomUtil.getInnerText(v.firstChild);
                var b = 0;
                for (var u = 0; u < c; u++) {
                    var q = g + u;
                    if (!this.getColHidden(q)) {
                        b += this.getColumnWidth(q)
                    }
                }
                var o = 0;
                for (var u = 0; u < d; u++) {
                    var n = m + u;
                    if (!this.getRowHidden(n)) {
                        o += this.getRowHeight(n)
                    }
                }
                var l = this.util.reVertAlignDiv(o, b, a.isWrapLine(), h, a.getFont(), v.firstChild, a.getVertAlign())
            }
        }
        this._resizeCoverSizeAfterWidthChange(p, w);
        this._resizeNRepositionStaffs4WidthChange(p);
        this.fireEvent("columnWidthChanged", [this, p, r])
    },
    _resizeColumnWidth2Cells: function(o, m, a) {
        if (a >= 0) {
            var l = a - this.colWidths[m];
            for (var g = 1; g < o.childNodes.length - 1; g++) {
                var p = o.childNodes[g];
                p.style.width = this._getPXSize((parseInt(p.style.width, 10) + l));
                var n = p.childNodes[m + 1];
                n.style.width = this._getPXSize((a - this._getWidthTrim()));
                var h = n.htmlDiv;
                if (h) {
                    h.style.width = n.style.width
                }
                for (var c = m + 2, b = p.childNodes.length; c < b; c++) {
                    var d = p.childNodes[c];
                    d.style.left = (parseInt(d.style.left, 10) + l) + "px";
                    var h = d.htmlDiv;
                    if (h) {
                        h.style.left = d.style.left
                    }
                }
            }
        }
    },
    _resizeCoverSizeAfterWidthChange: function(a, b) {
        this.cwDiv.style.width = this._getPXSize((parseInt(this.cwDiv.style.width, 10) + b));
        if (a < this.getHeaderColumnCount()) {
            this.hccwDiv.style.width = this._getPXSize((parseInt(this.hccwDiv.style.width, 10) + b))
        }
        if (a >= this.getColumnCount() - this.getFooterColumnCount()) {
            this.fccwDiv.style.width = this._getPXSize((parseInt(this.fccwDiv.style.width, 10) + b))
        }
    },
    _resizeCoverSizeAfterHeightChange: function(b, a) {
        this.cwDiv.style.height = this._getPXSize((parseInt(this.cwDiv.style.height, 10) + a));
        this.hccwDiv.style.height = this._getPXSize((parseInt(this.hccwDiv.style.height, 10) + a));
        this.fccwDiv.style.height = this._getPXSize((parseInt(this.fccwDiv.style.height, 10) + a))
    },
    _getWidthTrim: function() {
        return DNA.engine.Client.isIE() ? 1 : 5
    },
    _resizeNRepositionStaffs4WidthChange: function(d) {
        this._reBoundCurCell();
        for (var g = 0; g < this.controlCells.length; g++) {
            var m = this.controlCells[g];
            var b = new DNA.widget.AbstractGridCellAsync(this,null ,m.x,m.y,false);
            if (!(m.x < d && b.getColSpan() + m.x - 1 < d)) {
                var l = this.controlProvider.getCellControl(this, b, m.eid);
                if (l) {
                    l.resizeControl()
                }
            }
        }
        if (this.activeEditor) {
            this.activeEditor.reBoundCtr()
        }
        var a = this.selectionAreas;
        var h;
        for (g = 0; g < a.length; g++) {
            h = a[g];
            h.redraw()
        }
        for (g = 0; g < this.mergeDivs.length; g++) {
            mdiv = this.mergeDivs[g];
            this._resizeMergeDiv(mdiv)
        }
    },
    _resizeNRepositionStaffs4RowChange: function(m) {
        this._reBoundCurCell();
        var d = 0;
        for (d = 0; d < this.controlCells.length; d++) {
            var l = this.controlCells[d];
            var b = new DNA.widget.AbstractGridCellAsync(this,null ,l.x,l.y,false);
            if (!(l.y < m && b.getRowSpan() + l.y - 1 < m)) {
                var h = this.controlProvider.getCellControl(this, b, l.eid);
                if (h) {
                    h.resizeControl()
                }
                if (l.y == m) {
                    if (this.getRowHidden(m)) {
                        h.control.setVisible(false)
                    } else {
                        h.control.setVisible(true)
                    }
                }
            }
        }
        if (this.activeEditor) {
            this.activeEditor.reBoundCtr()
        }
        var a = this.selectionAreas;
        var g;
        for (d = 0; d < a.length; d++) {
            g = a[d];
            g.redraw()
        }
        for (d = 0; d < this.mergeDivs.length; d++) {
            mdiv = this.mergeDivs[d];
            this._resizeMergeDiv(mdiv)
        }
    },
    getColumnWidth: function(a) {
        if (!this.checkRendered(true)) {
            return 0
        }
        if (a < 0 || a >= this.columnCount) {
            return 0
        }
        return this.colWidths[a]
    },
    getColumnWidthCount: function(d, g, b) {
        var c = 0;
        for (var a = d; a < g; a++) {
            if (!this.getColHidden(a, b)) {
                c += this.colWidths[a]
            }
        }
        return c
    },
    getRowHeightCount: function(a, d) {
        var c = 0;
        for (var b = a; b < d; b++) {
            if (!this.getRowHidden(b)) {
                c += this.rowHeights[b]
            }
        }
        return c
    },
    getColumnWidthFromStyle: function(b) {
        if (!this.checkRendered(true)) {
            return 0
        }
        if (b < 0 || b >= this.columnCount) {
            return 0
        }
        var a = 0;
        var c = this._getCellDom(b, 0, this.tDiv);
        if (c) {
            a = parseInt(c.style.width, 10)
        }
        return a
    },
    insertRows: function(b, d, w, s, m, C) {
        if (!this.checkRendered(true)) {
            return
        }
        b -= 1;
        var h = (w == -1 || w < this.renderedTop || w >= this.renderedTop + this.renderedCount) ? b : w;
        if (b < -1 || b >= this.rowCount) {
            return
        }
        var n = [b + 1, 0];
        var a = b == -1 ? this.defRowHeight : this.rowHeights[h];
        for (var u = 0; u < d; u++) {
            n.push(a)
        }
        Array.prototype.splice.apply(this.rowHeights, n);
        var q = this.getCurrentCell();
        if (q && q.y > b + 1) {
            this.setCurrentCellNoFire(null )
        }
        this.operateCell = null ;
        this.operateArea = null ;
        this.closeEditor();
        this.clearSelection();
        var v = [];
        if (b < this.renderedTop) {
            this.setUpTakenRowHeight(this.getUpTakenRowHeight() + this.rowHeights[h] * d)
        } else {
            if (b >= this.renderedTop && b < this.renderedTop + this.renderedCount) {
                if (!this._insertRows(this.tDiv, b, d, h, s)) {
                    return
                }
                this._insertRows(this.hcTable, b, d, h, s);
                this._insertRows(this.fcTable, b, d, h, s);
                v.push(this.hcTable)
            } else {
                this.setDownTakenRowHeight(this.getDownTakenRowHeight() + this.rowHeights[h] * d)
            }
        }
        var l = [this.cwDiv, this.hccwDiv, this.fccwDiv];
        for (var u = 0; u < l.length; u++) {
            l[u].style.height = this._getPXSize(parseInt(l[u].style.height, 10) + (this.rowHeights[h] * d))
        }
        if (this.hRowCount != 0 && b < this.hRowCount) {
            this._insertRowCells(this.hrTable, b, d, h, s);
            this._insertRowCells(this.hltTab, b, d, h, s);
            if (this.hrtTab.childNodes.length > b) {
                this._insertRowCells(this.hrtTab, b, d, h, s)
            }
            v.push(this.hltTab);
            this.hRowCount += d
        }
        if (this.fRowCount != 0 && this.rowCount - b < this.fRowCount) {
            this._insertRowCells(this.frTable, this.rowCount - b, d, h, s);
            this._insertRowCells(this.flbTab, this.rowCount - b, d, h, s);
            this._insertRowCells(this.frbTab, this.rowCount - b, d, h, s);
            v.push(this.flbTab);
            this.hRowCount += d
        }
        if (b < this.renderedTop) {
            this.renderedTop += d
        } else {
            if (b >= this.renderedTop && b < this.renderedTop + this.renderedCount) {
                this.renderedCount += d
            }
        }
        if (q && q.y > b + 1) {
            q.y += d;
            this.setCurrentCellNoFire(q)
        }
        this.rowCount += d;
        this._ajustLockedSections();
        if (s == 1) {
            this._doExpendIndentation(b, d, m, C);
            this.lastCol = m
        }
        this.controlCells = this.updateControlCellListAfterRowChange(this.controlCells, b + 1, d);
        if (s) {
            this.computeColsGrab()
        }
        for (var t = 0; t < this.mergeDivs.length; t++) {
            var B = this.mergeDivs[t];
            var o = parseInt(B.getAttribute("ri"), 10);
            var g = parseInt(B.getAttribute("rs"), 10);
            if (o < b + 1) {
                if (o + g > b + 1) {
                    B.setAttribute("rs", g + d);
                    B.style.height = this._getPXSize((parseInt(B.style.height, 10) + (d * a)))
                }
            } else {
                B.setAttribute("ri", o + d);
                B.style.top = this._getPXSize((parseInt(B.style.top, 10) + (d * a)))
            }
        }
        for (var u = 0; u < this.controlCells.length; u++) {
            var A = this.controlCells[u];
            if (A.y >= b + 1) {
                this.controlCells[u] = {
                    y: A.y + d,
                    x: A.x,
                    eid: A.eid
                };
                var r = DNA.widget.WidgetRegistry.get(A.eid);
                if (r) {
                    var z = r.getBounds();
                    r.setLocation(z.x, z.y + (d * a))
                }
            }
        }
        for (var u = 0; u < v.length; u++) {
            this._changeRowTitle(v[u], b)
        }
        this._reRenderMergeDivs()
    },
    _doExpendIndentation: function(h, g, a, d) {
        var o = this._getCellDom(a, h, this.tDiv);
        var c = DNA.engine.DomUtil.findChild(o.firstChild, "span[class^=check]");
        var m = (c.style.display != "none");
        for (var b = 1; b < g + 1; b += 1) {
            var n = h + b;
            var l = this.getCell(a, n);
            l._doCellExpendIndentation(b, d, g, m)
        }
    },
    _changeRowTitle: function(h, d) {
        var b = this.renderedTop + this.renderedCount;
        var l = d > this.renderedTop ? d : this.renderedTop;
        for (var g = l; g < b; ++g) {
            var a = this.getCell(0, g);
            if (a.td) {
                var c = a.td.getAttribute("st");
                if (c) {
                    a.setShowText(c)
                } else {
                    a.setShowText(g + "")
                }
            }
        }
    },
    _insertRows: function(s, q, p, a, l) {
        var r = this._insertRowCells(s, q, p, a, l);
        for (var c = 1, b = s.childNodes[1].childNodes.length - 1; c < b; c++) {
            for (var h = q + p, g = this.renderedTop + this.renderedCount + p; h < g; h++) {
                var d = this._getCellDom(c, h, s, this.renderedTop, this.renderedTop + this.renderedCount + p);
                var o = d.htmlDiv;
                if (o) {
                    o.style.top = d.parentNode.offsetTop + "px"
                }
            }
        }
        return r
    },
    _insertRowCells: function(u, n, m, b, g) {
        var s;
        var r = u.childNodes[1].childNodes.length - 1;
        var h = new Array(r + 1);
        var c = this._getRowDom(b, u);
        var o = u.childNodes.length - 1;
        if (n == -1) {
            var l = u.ownerDocument.createDocumentFragment();
            var t = u.childNodes[b + 1].cloneNode(false);
            var q = u.childNodes[0];
            for (var d = 0; d <= r; d++) {
                s = q.childNodes[d].cloneNode(false);
                if (d == 0) {
                    s.style.height = this._getPXSize(this.defRowHeight)
                }
                this.util.convertCSSFromClass2Style(s);
                if (d == 1) {
                    s.className = "titleCell"
                } else {
                    s.className = "gridCell"
                }
                s.removeAttribute("st");
                DNA.engine.DomUtil.setInnerText(s, " ");
                t.appendChild(s)
            }
            for (var d = 0; d < m; ++d) {
                l.appendChild(t.cloneNode(true))
            }
            var p = q.parentNode;
            if (n == (o - 1)) {
                p.appendChild(l)
            } else {
                var a = u.childNodes[n + 2];
                p.insertBefore(l, a)
            }
        } else {
            h[0] = this._getCellDom(-1, b, u).cloneNode(false);
            h[0].removeAttribute("hf");
            for (var d = 0; d < r; d++) {
                s = new DNA.widget.AbstractGridCellAsync(this,u,d,n,false);
                h[d + 1] = this._getRowCell(c, d, b).cloneNode(false);
                h[d + 1].style.display = DNA.engine.Client.isIE() ? "inline" : "table-cell"
            }
            l = u.ownerDocument.createDocumentFragment();
            var t = this._getRowDom(b, u).cloneNode(false);
            t.style.display = "";
            var q = this._getRowDom(n, u);
            for (var d = 0; d <= r; ++d) {
                if (d > 1) {
                    h[d].className = h[d].className.replace("titleCellAsync", "gridCellAsync")
                } else {
                    h[d].style.borderColor = "";
                    h[d].style.backgroundColor = ""
                }
                h[d].removeAttribute("st");
                h[d].removeAttribute("et");
                h[d].innerHTML = "<div class='textWrapperAsync'></div>";
                t.appendChild(h[d])
            }
            for (var d = 0; d < m; d++) {
                l.appendChild(t.cloneNode(true))
            }
            var p = q.parentNode;
            if (n == (o - 1)) {
                p.appendChild(l)
            } else {
                var a = this._getRowDom(n + 1, u);
                p.insertBefore(l, a)
            }
        }
        return true
    },
    deleteRows: function(s, h) {
        if (!this.checkRendered(true)) {
            return
        }
        if (s >= this.rowCount) {
            return
        }
        var d = s + h - 1;
        var B = this.getCurrentCell();
        if (B && B.y >= s) {
            this.setCurrentCell(null )
        }
        var R = this.getRowHeightCount(s, s + h);
        var O = -1
          , H = -1;
        var P = -1
          , I = -1;
        var A = -1
          , r = -1;
        if (s < this.renderedTop) {
            if (d < this.renderedTop) {
                O = s;
                H = d
            } else {
                if (d < this.renderedTop + this.renderedCount) {
                    O = s;
                    H = this.renderedTop - 1;
                    P = H + 1;
                    I = d
                } else {
                    O = s;
                    H = this.renderedTop - 1;
                    P = H + 1;
                    I = this.renderedTop + this.renderedCount - 1;
                    A = I + 1;
                    r = d
                }
            }
        } else {
            if (s < this.renderedTop + this.renderedCount) {
                if (d >= this.renderedTop + this.renderedCount) {
                    P = s;
                    I = this.renderedTop + this.renderedCount - 1;
                    A = I + 1;
                    r = d
                } else {
                    P = s;
                    I = d
                }
            } else {
                A = s;
                r = d
            }
        }
        if (O > -1) {
            this.setUpTakenRowHeight(this.getUpTakenRowHeight() - this.getRowHeightCount(O, H))
        }
        if (P > -1) {
            var b = [];
            for (var E = I, C = this.renderedTop + this.renderedCount; E < C; E++) {
                for (var K = 0, J = this.getColumnCount(); K < J; K++) {
                    b.push(this._getCellDom(K, E, this.tDiv))
                }
                for (var K = 0, J = this.getHeaderColumnCount(); K < J; K++) {
                    b.push(this._getCellDom(K, E, this.hcTable))
                }
                for (var K = 0, J = this.getFooterColumnCount(); K < J; K++) {
                    b.push(this._getCellDom(K, E, this.fcTable))
                }
            }
            for (var E = P, C = I; E < C; E++) {
                for (var K = 0, J = this.getColumnCount(); K < J; K++) {
                    this._removeCellHTML(this._getCellDom(K, E, this.tDiv), this.cwDiv)
                }
                for (var K = 0, J = this.getHeaderColumnCount(); K < J; K++) {
                    this._removeCellHTML(this._getCellDom(K, E, this.hcTable), this.hccwDiv)
                }
                for (var K = 0, J = this.getFooterColumnCount(); K < J; K++) {
                    this._removeCellHTML(this._getCellDom(K, E, this.fcTable), this.fccwDiv)
                }
            }
            if (!this._deleteRows(this.tDiv, P, I)) {
                return
            }
            this._deleteRows(this.hcTable, P, I);
            this._deleteRows(this.fcTable, P, I);
            for (var K = 0; K < b.length; K++) {
                var o = b[K];
                var g = o.htmlDiv;
                if (g) {
                    g.style.top = o.parentNode.offsetTop + "px"
                }
            }
        }
        if (A > -1) {
            this.setDownTakenRowHeight(this.getDownTakenRowHeight() - this.getRowHeightCount(A, r))
        }
        if (O > -1) {
            this.renderedTop -= (H - O + 1)
        }
        if (P > -1) {
            this.renderedCount -= (I - P + 1)
        }
        this._changeRowTitle(this.hcTable, s);
        var q = [this.cwDiv, this.hccwDiv, this.fccwDiv];
        for (var K = 0; K < q.length; K++) {
            q[K].style.height = this._getPXSize(parseInt(q[K].style.height, 10) - R)
        }
        this.clearSelection();
        this.operateCell = null ;
        this.operateArea = null ;
        if (s < this.hRowCount) {
            this._deleteRows(this.hrTable, s, d);
            this._deleteRows(this.hltTab, s, d);
            if (this.hrtTab.childNodes.length > s) {
                this._deleteRows(this.hrtTab, s, d)
            }
            this._changeRowTitle(this.hcTable, s);
            var D = (d >= this.hRowCount) ? (this.hRowCount - s) : h;
            this.hRowCount -= D
        }
        if (this.fRowCount != 0 && this.rowCount - d < this.fRowCount) {
            this._deleteRows(this.frTable, s, d);
            this._deleteRows(this.flbTab, s, d);
            this._deleteRows(this.frbTab, s, d);
            this._changeRowTitle(this.flbTab, s);
            var D = (this.rowCount - s <= this.hRowCount) ? (this.fRowCount - (d - s)) : h;
            this.fRowCount -= h
        }
        this.rowCount -= h;
        this._ajustLockedSections();
        if (B && B.y > d) {
            B.y -= h;
            this.setCurrentCell(B)
        }
        this._adjustScroll();
        if (this.rowCount > s) {
            this._fixIEDeleteProblem(s)
        }
        for (var G = this.mergeDivs.length - 1; G >= 0; G--) {
            var Q = this.mergeDivs[G];
            var w = parseInt(Q.getAttribute("ri"), 10);
            var l = parseInt(Q.getAttribute("rs"), 10);
            if (w < s) {
                if (w + l >= s) {
                    if (w + l < s + h) {
                        Q.setAttribute("rs", s - w);
                        Q.style.height = this._getPXSize((parseInt(Q.style.height, 10) - this.getRowHeightCount(s, w + l - s)))
                    } else {
                        Q.setAttribute("rs", l - h);
                        Q.style.height = this._getPXSize((parseInt(Q.style.height, 10) - this.getRowHeightCount(s, s + h)))
                    }
                }
            } else {
                if (w == s && l > h) {
                    Q.setAttribute("rs", l - h);
                    var u = Q.style.left;
                    var z = Q.style.width;
                    var a = Q.style.top;
                    var v = this._getPXSize(parseInt(Q.style.height, 10) - this.getRowHeightCount(s, s + h));
                    var t = parseInt(Q.getAttribute("ci"), 10);
                    var N = this.getCell(t, w);
                    Q.setAttribute("style", N.td.getAttribute("style"));
                    Q.style.height = v;
                    Q.style.left = u;
                    Q.style.width = z;
                    Q.style.top = a;
                    Q.innerHTML = N.td.innerHTML;
                    N.reVertTextInMergeDiv(Q)
                } else {
                    if (w >= s && w < s + h) {
                        if (w + l <= s + h) {
                            Q.parentNode.removeChild(Q);
                            Array.prototype.splice.apply(this.mergeDivs, [G, 1])
                        } else {
                            var t = parseInt(Q.getAttribute("ci"), 10);
                            var N = this.getCell(t, s);
                            Q.setAttribute("rs", (w + l) - (s + h));
                            Q.setAttribute("ri", s);
                            var u = Q.style.left;
                            var z = Q.style.width;
                            var a = N.getTop() + "px";
                            var v = this._getPXSize(parseInt(Q.style.height, 10) - this.getRowHeightCount(w, s + h));
                            Q.setAttribute("style", N.td.getAttribute("style"));
                            Q.style.height = v;
                            Q.style.left = u;
                            Q.style.width = z;
                            Q.style.top = a;
                            Q.innerHTML = N.td.innerHTML;
                            N.reVertTextInMergeDiv(Q)
                        }
                    } else {
                        Q.setAttribute("ri", w - h);
                        Q.style.top = (parseInt(Q.style.top, 10) - this.getRowHeightCount(s, s + h)) + "px"
                    }
                }
            }
        }
        for (var K = this.controlCells.length - 1; K >= 0; K--) {
            var M = this.controlCells[K];
            if (M.y >= s && M.y < s + h) {
                var F = DNA.widget.WidgetRegistry.get(M.eid);
                if (F) {
                    F.setBounds(0, 0, 0, 0);
                    this.getEl().appendChild(F.getEl())
                }
                Array.prototype.splice.apply(this.controlCells, [K, 1])
            } else {
                if (M.y >= s + h) {
                    this.controlCells[K] = {
                        x: M.x,
                        y: M.y - h,
                        eid: M.eid
                    };
                    var F = DNA.widget.WidgetRegistry.get(M.eid);
                    if (F) {
                        var L = F.getBounds();
                        F.setLocation(L.x, L.y - this.getRowHeightCount(s, s + h))
                    }
                }
            }
        }
        this.controlCells = this.updateControlCellListAfterRowChange(this.controlCells, s, 0 - h);
        this._reRenderMergeDivs();
        Array.prototype.splice.apply(this.rowHeights, [s, h])
    },
    _deleteRows: function(d, b, a) {
        for (var c = a; c >= b; --c) {
            var g = this._getRowDom(c, d);
            d.removeChild(g)
        }
        return true
    },
    insertColumns: function(s, r, a) {
        if (!this.checkRendered(true)) {
            return
        }
        s -= 1;
        var g = (a == -1) ? s : a;
        var q = [s + 1, 0];
        var d = s == -1 ? this.defColWidth : this.colWidths[g];
        for (var l = 0; l < r; l++) {
            q.push(d)
        }
        Array.prototype.splice.apply(this.colWidths, q);
        if (s < -1 || s >= this.columnCount) {
            return
        }
        var b = this.getCurrentCell();
        if (b && b.x > s) {
            this.setCurrentCellNoFire(null )
        }
        this.operateCell = null ;
        this.operateArea = null ;
        this.closeEditor();
        this.clearSelection();
        if (!this._insertCols(this.tDiv, s, r, g)) {
            return
        }
        this._insertCols(this.hrTable, s, r, g, true);
        this._insertCols(this.frTable, s, r, g);
        this._changeColTitle(this.hrTable, s);
        if (this.hColCount != 0 && s < this.hColCount) {
            this._insertCols(this.hcTable, s, r, g);
            this._insertCols(this.hltTab, s, r, g, true);
            if (this.flbTab.childNodes && this.flbTab.childNodes[0].childNodes.length > s) {
                this._insertCols(this.flbTab, s, r, g)
            }
            this._changeColTitle(this.hltTab, s);
            this.hColCount += r
        }
        if (this.fColCount != 0 && this.colCount - s < this.fColCount) {
            this._insertCols(this.fcTable, s, r, g);
            this._insertCols(this.hrtTab, s, r, g, true);
            this._insertCols(this.frbTab, s, r, g);
            this._changeColTitle(this.flbTab, s);
            this.fColCount += r
        }
        this.columnCount += r;
        this._ajustLockedSections();
        if (b && b.x > s) {
            b.x += r;
            this.setCurrentCellNoFire(b)
        }
        this.computeColsGrab();
        for (var h = 0; h < this.mergeDivs.length; h++) {
            var u = this.mergeDivs[h];
            var v = parseInt(u.getAttribute("ci"), 10);
            var o = parseInt(u.getAttribute("cs"), 10);
            if (v < s + 1) {
                if (v + o > s + 1) {
                    u.setAttribute("cs", o + r);
                    u.style.width = this._getPXSize((parseInt(u.style.width, 10) + (r * d)))
                }
            } else {
                u.setAttribute("ci", v + r);
                u.style.left = this._getPXSize((parseInt(u.style.left, 10) + (r * d)))
            }
        }
        for (var l = 0; l < this.controlCells.length; l++) {
            var t = this.controlCells[l];
            if (t.x >= s + 1) {
                this.controlCells[l] = {
                    x: t.x + r,
                    y: t.y,
                    eid: t.eid
                };
                var n = DNA.widget.WidgetRegistry.get(t.eid);
                if (n) {
                    var m = n.getBounds();
                    n.setLocation(m.x + (r * d), m.y)
                }
            }
        }
    },
    _changeColTitle: function(g, b) {
        var h = g.childNodes[2];
        var d = h.childNodes.length - 1;
        b = b > 1 ? b : 1;
        for (var c = b; c < d; ++c) {
            var l = this._getRowCell(h, c, 0);
            var a = l.getAttribute("st");
            if (a) {
                DNA.engine.DomUtil.setInnerText(l, a)
            } else {
                DNA.engine.DomUtil.setInnerText(l, this._getDefHeaderColText(c - 1))
            }
        }
    },
    _getDefHeaderColText: function(b) {
        var c = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        if (b < 26) {
            return c.charAt(b)
        }
        var a = "";
        for (; b >= 1; b /= 26) {
            if (b < 26 && b >= 1) {
                a += c.charAt(b % 26 - 1)
            } else {
                a += c.charAt(b % 26)
            }
        }
        return this._reverse(a)
    },
    _reverse: function(a) {
        if (a) {
            return a.split("").reverse().join("")
        }
        return ""
    },
    _insertCols: function(w, l, m, v, d) {
        var p;
        var a;
        var n;
        var q;
        var g;
        var o = w.childNodes.length - 3;
        var r = w.childNodes[1].childNodes.length - 1;
        if (l == -1) {
            g = this.defColWidth;
            var B = w.ownerDocument.createDocumentFragment();
            var h = w.childNodes[1];
            for (var t = 0; t < m; ++t) {
                a = h.childNodes[v + 1];
                a.style.width = 0 + "px";
                p = a.cloneNode(true);
                B.append(p);
                if (l == (r - 1)) {
                    h.appendChild(B)
                } else {
                    h.insertBefore(B, h.childNodes[l + 2])
                }
            }
            for (var u = 0; u < o; u++) {
                h = w.childNodes[u + 2];
                a = h.childNodes[v + 1].cloneNode(false);
                for (var t = 0; t < m; ++t) {
                    p = a.cloneNode(true);
                    if (t == 0) {
                        p.className = "titleCellAsync"
                    } else {
                        p.className = "gridCellAsync"
                    }
                    B.append(a.cloneNode(true));
                    if (l == (r - 1)) {
                        h.appendChild(B)
                    } else {
                        h.insertBefore(B, h.childNodes[l + 2])
                    }
                }
            }
        } else {
            g = this.colWidths[v];
            var z = w.ownerDocument.createDocumentFragment();
            var b = w.childNodes[1];
            p = b.childNodes[v + 1].cloneNode(false);
            for (var t = 0; t < m; t++) {
                z.appendChild(p.cloneNode(true))
            }
            if (l == (r - 1)) {
                b.appendChild(z)
            } else {
                b.insertBefore(z, b.childNodes[l + 1])
            }
            for (var u = 2; u < w.childNodes.length - 1; u++) {
                var h = w.childNodes[u];
                p = this._getRowCell(h, v, u).cloneNode(false);
                p.style.display = "";
                p.style.backgroundImage = "";
                if (u > 0) {
                    if (d && u == 2) {
                        p.className = "titleCellAsync"
                    } else {
                        p.className = "gridCellAsync"
                    }
                }
                p.removeAttribute("html");
                this._internalInsertCols(h, p, l, m, w)
            }
        }
        for (u = 0,
        t = w.childNodes.length; u < t; u++) {
            w.childNodes[u].style.width = this._getPXSize((parseInt(w.childNodes[u].style.width, 10) + (m * g)))
        }
        var A = this.getColumnWidthCount(0, l);
        for (u = l + 1,
        t = this.getColumnCount() + m; u < t; u++) {
            A += this.getColumnWidth(u - 1);
            for (k = 1; k < w.childNodes.length - 1; k++) {
                var s = w.childNodes[k].childNodes[u + 1];
                s.style.left = A + "px";
                var c = s.htmlDiv;
                if (c) {
                    c.style.left = s.style.left
                } else {
                    this._placeCellHTML(s)
                }
            }
        }
        if (w == this.tDiv) {
            this.cwDiv.style.width = this._getPXSize((parseInt(this.cwDiv.style.width, 10) + (m * g)))
        } else {
            if (w == this.hcTable) {
                this.hccwDiv.style.width = this._getPXSize((parseInt(this.hccwDiv.style.width, 10) + (m * g)))
            } else {
                if (w == this.fcTable) {
                    this.fccwDiv.style.width = this._getPXSize((parseInt(this.fccwDiv.style.width, 10) + (m * g)))
                }
            }
        }
        return true
    },
    _internalInsertCols: function(n, d, h, g, m) {
        var l = m.childNodes[1].childNodes.length - 1 - g;
        var a = m.ownerDocument.createDocumentFragment();
        d.innerText = " ";
        d.removeAttribute("st");
        d.removeAttribute("et");
        for (var c = 0; c < g; c++) {
            var b = d.cloneNode(true);
            b.innerHTML = "<div class='textWrapperAsync'></div>";
            a.appendChild(b)
        }
        if (h == (l - 1)) {
            n.appendChild(a)
        } else {
            n.insertBefore(a, n.childNodes[h + 2])
        }
    },
    deleteColumns: function(h, g) {
        if (!this.checkRendered(true)) {
            return
        }
        if (h >= this.columnCount) {
            return
        }
        var b = h + g - 1;
        var r = this.getCurrentCell();
        if (r && r.x >= h) {
            this.setCurrentCell(null )
        }
        for (var u = this.mergeDivs.length - 1; u >= 0; u--) {
            var C = this.mergeDivs[u];
            var l = parseInt(C.getAttribute("ci"), 10);
            var d = parseInt(C.getAttribute("cs"), 10);
            var w = DNA.engine.Client.isIE() && !DNA.engine.Client.isStrict() ? 0 : 5;
            if (l < h) {
                if (l + d >= h) {
                    if (l + d < h + g) {
                        C.setAttribute("cs", h - l);
                        C.style.width = this._getPXSize(this.getColumnWidthCount(l, h) - w)
                    } else {
                        C.setAttribute("cs", d - g);
                        C.style.width = this._getPXSize(parseInt(C.style.width, 10) - this.getColumnWidthCount(h, h + g))
                    }
                }
            } else {
                if (l == h && d > g) {
                    C.setAttribute("cs", d - g);
                    var m = C.style.left;
                    var q = this._getPXSize(parseInt(C.style.width, 10) - this.getColumnWidthCount(h, h + g));
                    var a = C.style.top;
                    var n = C.style.height;
                    var o = parseInt(C.getAttribute("ri"), 10);
                    var A = this.getCell(l, o);
                    C.setAttribute("style", A.td.getAttribute("style"));
                    C.style.height = n;
                    C.style.left = m;
                    C.style.width = q;
                    C.style.top = a;
                    C.innerHTML = A.td.innerHTML;
                    A.reVertTextInMergeDiv(C)
                } else {
                    if (l >= h && l < h + g) {
                        C.parentNode.removeChild(C);
                        Array.prototype.splice.apply(this.mergeDivs, [u, 1])
                    } else {
                        C.setAttribute("ci", l - g);
                        C.style.left = (parseInt(C.style.left, 10) - this.getColumnWidthCount(h, h + g)) + "px"
                    }
                }
            }
        }
        for (var v = this.controlCells.length - 1; v >= 0; v--) {
            var B = this.controlCells[v];
            if (B.x >= h && B.x < h + g) {
                var t = DNA.widget.WidgetRegistry.get(B.eid);
                if (t) {
                    t.setBounds(0, 0, 0, 0);
                    this.getEl().appendChild(t.getEl())
                }
                Array.prototype.splice.apply(this.controlCells, [v, 1])
            } else {
                if (B.x >= h + g) {
                    this.controlCells[v] = {
                        x: B.x - g,
                        y: B.y,
                        eid: B.eid
                    };
                    var t = DNA.widget.WidgetRegistry.get(B.eid);
                    if (t) {
                        var z = t.getBounds();
                        t.setLocation(z.x - this.getColumnWidthCount(h, h + g), z.y)
                    }
                }
            }
        }
        if (!this._deleteCols(this.tDiv, h, b)) {
            return
        }
        this.operateCell = null ;
        this.operateArea = null ;
        this.clearSelection();
        this._deleteCols(this.hrTable, h, b);
        this._deleteCols(this.frTable, h, b);
        this._changeColTitle(this.hrTable, h);
        if (h < this.hColCount) {
            this._deleteCols(this.hcTable, h, b);
            this._deleteCols(this.hltTab, h, b);
            if (this.flbTab.childNodes && this.flbTab.childNodes[0].childNodes.length > h) {
                this._deleteCols(this.flbTab, h, b)
            }
            this._changeColTitle(this.hltTab, h);
            var s = (b >= this.hColCount) ? (this.hColCount - h) : g;
            this.hColCount -= s
        }
        if (r && r.x > b) {
            r.x -= g;
            this.setCurrentCell(r)
        }
        this.columnCount -= g;
        this._ajustLockedSections();
        this._adjustScroll();
        this.computeColsGrab();
        Array.prototype.splice.apply(this.colWidths, [h, g])
    },
    _deleteCols: function(z, q, d) {
        var t, s;
        var r = z.childNodes.length - 3;
        var v = z.childNodes[1].childNodes.length - 1;
        if (d >= v) {
            d = v - 1
        }
        var w = this.getColumnWidthCount(q, d + 1, z);
        for (h = 0,
        g = z.childNodes.length; h < g; h++) {
            z.childNodes[h].style.width = this._getPXSize(parseInt(z.childNodes[h].style.width, 10) - w)
        }
        for (h = d + 1,
        g = this.getColumnCount(); h < g; h++) {
            for (k = 1; k < z.childNodes.length - 1; k++) {
                var l = z.childNodes[k].childNodes[h + 1];
                l.style.left = (parseInt(l.style.left, 10) - w) + "px";
                var o = l.htmlDiv;
                if (o) {
                    o.style.left = l.style.left
                }
            }
        }
        for (var b = 1, a = z.childNodes.length - 1; b < a; b++) {
            var A = z.childNodes[b];
            for (var h = q, g = d; h <= g; h++) {
                var p = A.childNodes[h + 1];
                if (p) {
                    this._removeCellHTML(p)
                }
            }
        }
        if (z == this.tDiv) {
            this.cwDiv.style.width = this._getPXSize(parseInt(this.cwDiv.style.width, 10) - w)
        } else {
            if (z == this.hcTable) {
                this.hccwDiv.style.width = this._getPXSize(parseInt(this.hccwDiv.style.width, 10) - w)
            } else {
                if (z == this.fcTable) {
                    this.fccwDiv.style.width = this._getPXSize(parseInt(this.fccwDiv.style.width, 10) - w)
                }
            }
        }
        for (var h = 0; h <= r; ++h) {
            var A = z.childNodes[h + 1];
            for (var g = d; g >= q; --g) {
                var u = A.childNodes[g + 1];
                A.removeChild(u)
            }
        }
        return true
    },
    setRowBackImage: function(b, c) {
        var d = this._getRowDom(b + 1, this.tDiv);
        var a = c ? ("url(" + DNA.widget.ImageDescriptor.getUrl(c) + ")") : "";
        d.style.backgroundImage = a;
        d = this._getRowDom(b + 1, this.hcTable);
        d.style.backgroundImage = a;
        if (d < this.headerRowCount) {
            d = this._getRowDom(b + 1, this.hrTable);
            d.style.backgroundImage = a
        }
    },
    setColGrab: function(b, c) {
        var a = this._getCellDom(b, -1, this.tDiv);
        if (c) {
            a.grab = 1
        } else {
            a.grab = 0
        }
    },
    computeColsGrab: function() {
        if (!this.getColGrabEnable()) {
            return
        }
        var p = this.getColumnCount();
        var l = 0;
        var h = this.gel.clientWidth;
        if (h <= 0) {
            return
        }
        var o = [];
        for (var d = 0; d < p; ++d) {
            if (!this.getColGarb(d)) {
                l += this.getColumnWidth(d)
            } else {
                l += this.getColGarbOriginalWidth(d);
                o.push(d)
            }
        }
        if (h - l <= 1) {
            return
        }
        var m = o.length;
        if (m > 0) {
            for (var d = 0; d < m; ++d) {
                var q = o[d];
                var c = this.getColGarbOriginalWidth(q);
                this.setColumnWidth(q, c)
            }
            h = this.tDiv.clientWidth;
            var g = 0;
            for (var d = 0; d < m; ++d) {
                g += this.getColGarbOriginalWidth(o[d])
            }
            var a = 0;
            for (d = 0; d < m; ++d) {
                q = o[d];
                c = this.getColGarbOriginalWidth(q);
                var r = Math.floor((c / g) * (h - l));
                var n = c + r;
                a += r;
                this.setColumnWidth(q, n < 0 ? 0 : n)
            }
            var b = h - l - a;
            if (b > 0) {
                var q = o[m - 1];
                this.setColumnWidth(q, this.getColumnWidth(q) + b)
            }
        }
    },
    getColGarb: function(b) {
        var a = this._getCellDom(b, -1, this.tDiv);
        if (a.getAttribute("grab") == "1") {
            return true
        }
        return false
    },
    getColGarbOriginalWidth: function(b) {
        var a = this._getCellDom(b, -1, this.tDiv);
        return ( a.getAttribute("ocw") ? parseInt(a.getAttribute("ocw")) : this.getColumnWidth(b)) 
    },
    getColGrabEnable: function() {
        return (this.gridOption & (1 << 17)) != 0
    },
    getCurBorderHiddden: function() {
        return (this.gridOption & (1 << 16)) != 0
    },
    getRowVisible: function(c) {
        var b = this._getRowDom(c, this.tDiv);
        if (!b) {
            return false
        }
        var a = b.childNodes[0];
        if (a && a.getAttribute("hf")) {
            return false
        }
        return true
    },
    setRowHidden: function(c, a) {
        if (!this.checkRendered(true)) {
            return
        }
        if (c < 0 || c >= this.rowCount) {
            return
        }
        if (a) {
            this._hideRow(c)
        } else {
            this._displayRow(c)
        }
        this._reRenderMergeDivs();
        var b = this.getCurrentSelection();
        if (b) {
            b.reBuild(true)
        }
    },
    _fixIEHideProblem: function(a) {
        this._checkForHideRow2(a, this.tDiv, this.columnCount);
        this._checkForHideRow2(a, this.hcTable, this.hColCount);
        if (a < this.hRowCount) {
            this._checkForHideRow2(a, this.hrTable, this.columnCount);
            this._checkForHideRow2(a, this.hltTab, this.hColCount)
        }
    },
    _fixIEDeleteProblem: function(a) {
        this._checkForDeleteRow2(a, this.tDiv, this.columnCount);
        this._checkForDeleteRow2(a, this.hcTable, this.hColCount);
        if (a < this.hRowCount) {
            this._checkForDeleteRow2(a, this.hrTable, this.columnCount);
            this._checkForDeleteRow2(a, this.hltTab, this.hColCount)
        }
    },
    _fixIEShowProblem: function(a) {
        this._checkForShowRow2(a, this.tDiv, this.columnCount);
        this._checkForShowRow2(a, this.hcTable, this.hColCount);
        if (a < this.hRowCount) {
            this._checkForShowRow2(a, this.hrTable, this.columnCount);
            this._checkForShowRow2(a, this.hltTab, this.hColCount)
        }
    },
    _checkForHideRow2: function(c, m, l) {
        var b = m.childNodes.length - 1;
        for (var d = 1; d < l; ) {
            var a = this._getCellDom(d, c, m);
            if (a.rowSpan && this._getRowRealSpan(a.rowSpan, c) > 1) {
                var h = c + 1;
                if (h < b) {
                    var g = this._getCellDom(d, h, m);
                    g.style.display = DNA.engine.Client.isIE() ? "inline" : "table-cell";
                    g.rowSpan = a.rowSpan - (h - c);
                    if (a.colSpan) {
                        g.colSpan = a.colSpan
                    }
                }
            }
            d += a.colSpan ? a.colSpan : 1
        }
    },
    _checkForDeleteRow2: function(b, g, d) {
        for (var c = 1; c < d; ) {
            var a = this._getCellDom(c, b, g);
            if (a.rowSpan && a.rowSpan > 1) {
                a.style.display = DNA.engine.Client.isIE() ? "inline" : "table-cell"
            }
            c += a.colSpan ? a.colSpan : 1
        }
    },
    _checkForShowRow2: function(c, m, l) {
        var b = m.childNodes.length - 1;
        for (var d = 1; d < l; ) {
            var a = this._getCellDom(d, c, m);
            if (a.rowSpan && a.rowSpan > 1) {
                for (var h = c + 1; c + a.rowSpan > h; h++) {
                    if (h < b) {
                        var g = this._getCellDom(d, h, m);
                        g.removeAttribute("rowSpan");
                        g.removeAttribute("colSpan");
                        g.style.display = "none";
                        g.setAttribute("mg", "1")
                    }
                }
            }
            d += a.colSpan ? a.colSpan : 1
        }
    },
    _checkForHideRow: function(c, l, h) {
        for (var d = 1; d < h; ) {
            var a = new DNA.widget.AbstractGridCellAsync(this,l,d,c,false);
            var m = a.getRowIndex();
            if (m < c) {
                var g = a.getRowSpan();
                var b = this._getRowRealSpan(g, a.getRowIndex());
                if (b != a.td.rowSpan) {
                    if (!a.td.rrs) {
                        a.td.rrs = g
                    }
                    a.td.rowSpan = b
                }
            }
            d += a.getColSpan()
        }
    },
    _getRowRealSpan: function(c, d) {
        var a = c;
        for (var b = d + c - 1; b >= d; --b) {
            if (!this.getRowVisible(b)) {
                a--
            } else {
                break
            }
        }
        return a
    },
    _hideRow: function(a) {
        if (this.getRowHidden(a)) {
            return
        }
        this.rowHiddens[a] = true;
        this._setRowVisible(a, false)
    },
    _displayRow: function(a) {
        if (!this.getRowHidden(a)) {
            return
        }
        this.rowHiddens[a] = false;
        this._setRowVisible(a, true)
    },
    _showControlInRows: function(g) {
        for (var b = 0; b < this.controlCells.length; b++) {
            if (this.controlCells[b].y == g) {
                var a = this.controlCells[b];
                var d = new DNA.widget.AbstractGridCellAsync(this,null ,a.x,a.y,false);
                if (!this.controlProvider) {
                    return
                }
                var c = this.controlProvider.getCellControl(this, d, a.eid);
                if (!c) {
                    return
                }
                c.resizeControl()
            }
        }
    },
    __displayRow: function(c) {
        var b = this._getRowDom(c, this.tDiv);
        var a = b.childNodes[0];
        if (!a.getAttribute("hf")) {
            return
        }
        this._showRow4Tab(this.tDiv, c);
        this._showRow4Tab(this.hcTable, c);
        if (c == 0 || (this.hRowCount != 0 && c < this.hRowCount)) {
            this._showRow4Tab(this.hrTable, c);
            this._showRow4Tab(this.hltTab, c)
        }
        this._ajustLockedSections();
        this.hiddenRows.remove(c);
        this._reBoundCurCell()
    },
    _showRow4Tab: function(m, c) {
        var n = this._getRowDom(c, m);
        var h = n.childNodes[0];
        if (c === 0) {
            n.style.display = "";
            h.removeAttribute("hf");
            return
        }
        var g = n.childNodes.length - 1;
        var d = m.childNodes.length - 1;
        h.removeAttribute("hf");
        var l = h.getAttribute("rh");
        h.style.height = l;
        for (var a = 1; a <= g; ++a) {
            h = this._getRowCell(n, a - 1, c);
            h.removeAttribute("rhc");
            this.util.convertCSSFromClass2Style(h);
            if (a == 1) {
                h.className = "titleCell"
            } else {
                h.className = "gridCell"
            }
            var b = h.getAttribute("st");
            if (b) {
                h.removeAttribute("st");
                DNA.engine.DomUtil.setInnerText(h, b)
            }
        }
    },
    setColumnHidden: function(c, a) {
        if (!this.checkRendered(true)) {
            return
        }
        if (c < 0 || c >= this.columnCount) {
            return
        }
        if (a) {
            this._hideColumn(c)
        } else {
            this._displayColumn(c)
        }
        var b = this.getCurrentSelection();
        if (b) {
            b.reBuild(true)
        }
    },
    _hideColumn: function(b) {
        var a = this._getCellDom(b, -1, this.tDiv);
        if (a.getAttribute("hf")) {
            return
        }
        a.setAttribute("hf", 1);
        this._setColumnVisible(b, false)
    },
    _displayColumn: function(b) {
        var a = this._getCellDom(b, -1, this.tDiv);
        if (!a.getAttribute("hf")) {
            return
        }
        a.removeAttribute("hf");
        this._setColumnVisible(b, true)
    },
    _setColumnVisible: function(p, c) {
        if (!this.checkRendered(true)) {
            return
        }
        if (!this.util.isDataCol(p)) {
            return
        }
        if (p <= 0 || p >= this.columnCount) {
            return
        }
        this._applyColumnVisible2Cells(this.tDiv, p, c);
        this._applyColumnVisible2Cells(this.hrTable, p, c);
        this._applyColumnVisible2Cells(this.frTable, p, c);
        if (p < this.hColCount) {
            this._applyColumnVisible2Cells(this.hltTab, p, c);
            this._applyColumnVisible2Cells(this.hcTable, p, c);
            this._applyColumnVisible2Cells(this.flbTab, p, c)
        }
        var r = [this.tDiv];
        if (p < this.hColCount) {
            r.push(this.hcTable)
        }
        for (var a = 0; a < r.length; a++) {
            var s = r[a];
            for (var l = this.renderedTop, h = this.renderedTop + this.renderedCount; l < h; l++) {
                for (var d = p, b = s.childNodes[1].childNodes.length - 1; d < b; d++) {
                    var g = this._getCellDom(d, l, s);
                    var o = g.htmlDiv;
                    if (o) {
                        o.style.left = g.style.left
                    }
                }
            }
        }
        this._ajustLockedSections();
        this.setCurrentCell(null );
        this._reComputeSelections(-1, p);
        this._adjustScroll();
        this._reBoundFace();
        this._resizeCoverSizeAfterWidthChange(p, c ? this.colWidths[p] : 0 - this.colWidths[p]);
        this._resizeNRepositionStaffs4WidthChange(p)
    },
    _applyColumnVisible2Cells: function(p, n, a) {
        var l = a ? "block" : "none";
        var m = a ? this.colWidths[n] : 0 - this.colWidths[n];
        for (var g = 1; g < p.childNodes.length - 1; g++) {
            var q = p.childNodes[g];
            q.style.width = this._getPXSize(parseInt(q.style.width, 10) + m);
            var o = q.childNodes[n + 1];
            o.style.display = l;
            var h = o.htmlDiv;
            if (h) {
                h.style.display = o.style.display
            }
            for (var c = n + 2, b = q.childNodes.length; c < b; c++) {
                var d = q.childNodes[c];
                d.style.left = (parseInt(d.style.left, 10) + m) + "px"
            }
        }
    },
    _setRowVisible: function(p, c) {
        if (!this.checkRendered(true)) {
            return
        }
        if (!this.util.isDataRow(p)) {
            return
        }
        this._appleRowVisible2Cells(this.tDiv, p, c);
        this._appleRowVisible2Cells(this.hcTable, p, c);
        this._appleRowVisible2Cells(this.fcTable, p, c);
        if (p < this.hRowCount) {
            this._appleRowVisible2Cells(this.hltTab, p, c);
            this._appleRowVisible2Cells(this.hrTable, p, c);
            this._appleRowVisible2Cells(this.hrtTab, p, c)
        }
        if (p > this.rowCount - this.fRowCount) {
            this._appleRowVisible2Cells(this.flbTab, p, c);
            this._appleRowVisible2Cells(this.frTable, p, c);
            this._appleRowVisible2Cells(this.frbTab, p, c)
        }
        var s = [this.tDiv, this.hcTable, this.fcTable];
        for (var a = 0; a < s.length; a++) {
            var t = s[a];
            for (var l = this.renderedTop, h = this.renderedTop + this.renderedCount; l < h; l++) {
                for (var d = 0, b = t.childNodes[1].childNodes.length - 1; d < b; d++) {
                    var g = this._getCellDom(d, l, t);
                    var o = g.htmlDiv;
                    if (o) {
                        o.style.top = g.parentNode.offsetTop + "px"
                    }
                }
            }
        }
        var r = c ? this.rowHeights[p] : 0 - this.rowHeights[p];
        if (p < this.renderedTop) {
            this.setUpTakenRowHeight(this.getUpTakenRowHeight() + r)
        } else {
            if (p >= this.renderedTop + this.renderedCount) {
                this.setDownTakenRowHeight(this.getDownTakenRowHeight() + r)
            }
        }
        this._ajustLockedSections();
        this._reBoundCurCell();
        this._reComputeSelections(p, -1);
        this._adjustScroll();
        this._reBoundFace();
        this._resizeCoverSizeAfterHeightChange(p, r);
        this._resizeNRepositionStaffs4RowChange(p)
    },
    _appleRowVisible2Cells: function(c, m, h) {
        var d = h ? "block" : "none";
        var g = this._getRowDom(m, c);
        if (g != null ) {
            g.style.display = d;
            for (var b = 0; b < g.childNodes.length; b++) {
                var a = g.childNodes[b];
                var l = a.htmlDiv;
                if (l) {
                    l.style.display = d
                }
            }
        }
    },
    getColHidden: function(b, d) {
        if (!this.checkRendered(true)) {
            return false
        }
        var c = d || this.tDiv;
        var a = this._getCellDom(b, -1, c);
        if (!a.getAttribute("hf")) {
            return false
        }
        return true
    },
    getRowHidden: function(a) {
        if (!this.checkRendered(true)) {
            return false
        }
        return this.rowHiddens[a]
    },
    setColAutoWidth: function(b, c) {
        if (!this.checkRendered(true)) {
            return false
        }
        var a = this._getCellDom(b, -1, this.tDiv);
        if (c) {
            a.setAttribute("aw", 1)
        } else {
            a.removeAttribute("aw")
        }
    },
    setRowAutoHeight: function(c, b) {
        if (!this.checkRendered(true)) {
            return false
        }
        var a = this._getCellDom(-1, c, this.tDiv);
        if (b) {
            a.setAttribute("aw", 1)
        } else {
            a.removeAttribute("aw")
        }
    },
    setInitProperties: function(l) {
        if (!this.checkRendered(true)) {
            return false
        }
        DNA.widget.CssStyleFinder.updateCss(this);
        this.columnCount = l.colCount;
        this.rowCount = l.rowCount;
        this.hColCount = l.headerColCount;
        this.hRowCount = l.headerRowCount;
        this.renderedTop = l.renderedTop;
        this.renderedCount = l.renderedCount;
        this.rowHeights = l.rowHeights;
        this.colWidths = l.colWidths;
        this.rowHiddens = l.rowHiddens;
        var h = l.currentCell;
        if (h) {
            this.setCurrentCellNoFire(h)
        }
        var d = l.cccf;
        if (d) {
            var c = d.split(",");
            this.currentCellColorFocused = c[0];
            this.currentCellColorUnFocused = c[1]
        } else {
            this.currentCellColorFocused = null ;
            this.currentCellColorUnFocused = null 
        }
        this.updateCurrentCellColor();
        var b = l.selections;
        if (b) {
            this.setSelections(b)
        }
        var g = l.currentCellOffset;
        if (g) {
            this._setCurrentCellOffset(g)
        }
        var a = l.formatters;
        if (a) {
            this._addFormatters(a)
        }
        this.replacing = false;
        this.ignoreHidden = l.ignoreHidden ? true : false;
        if (DNA.engine.Client.isFF()) {
            this._ajustLockedSections()
        }
        this.computeColsGrab()
    },
    rebuildCellControls: function(a) {
        if (!this.checkRendered(true)) {
            return false
        }
        if (a.controlCellObjs) {
            if (this.isVisible()) {
                this.controlCells = a.controlCellObjs;
                this._showControls()
            } else {
                this.controlCellsCachedForIframe = a.controlCellObjs;
                if (this.getInitData().controlCellObjs) {
                    delete this.getInitData().controlCellObjs
                }
                if (this.getData("add_control")) {
                    this.removeData("add_control")
                }
            }
        }
    },
    setGridOption: function(a) {
        this.gridOption = a;
        if ((a & DNA.widget.JWTGrid.EDIT_MODE_MASK) == DNA.widget.JWTGrid.EDIT_MODE_READONLY) {
            this.closeEditor();
            this._hideFace()
        }
    },
    setDefEditor: function(a) {
        this.defEditorId = a
    },
    setColumnCount: function(a) {
        if (a > this.columnCount) {
            this.insertColumns(this.columnCount, a - this.columnCount, this.columnCount - 1);
            return
        }
        if (a < this.columnCount) {
            this.deleteColumns(a, this.columnCount - a)
        }
    },
    setRowCount: function(a) {
        if (a > this.rowCount) {
            this.insertRows(this.rowCount, a - this.rowCount, this.rowCount - 1);
            return
        }
        if (a < this.rowCount) {
            this.deleteRows(a, this.rowCount - a)
        }
    },
    getColumnCount: function() {
        return this.columnCount
    },
    getRowCount: function() {
        return this.rowCount
    },
    setHeaderColumnCount: function(a) {
        this._buildHeaderCols(a)
    },
    setHeaderRowCount: function(a) {
        this._buildHeaderRows(a)
    },
    getHeaderColumnCount: function() {
        return this.hColCount
    },
    getHeaderRowCount: function() {
        return this.hRowCount
    },
    setFooterColumnCount: function(a) {
        this._buildFooterCols(a)
    },
    setFooterRowCount: function(a) {
        this._buildFooterRows(a)
    },
    getFooterColumnCount: function() {
        return this.fColCount
    },
    getFooterRowCount: function() {
        return this.fRowCount
    },
    setEditMode: function(a) {
        this.gridOption &= ~DNA.widget.JWTGrid2.EDIT_MODE_MASK;
        this.gridOption |= (a & DNA.widget.JWTGrid2.EDIT_MODE_MASK)
    },
    getEditMode: function() {
        return this.gridOption & DNA.widget.JWTGrid2.EDIT_MODE_MASK
    },
    setSelectionMode: function(a) {
        var b = this.getSelectionMode();
        if (a != b) {
            this.gridOption &= ~DNA.widget.JWTGrid2.SELECTION_MODE_MASK;
            this.gridOption |= (a & DNA.widget.JWTGrid2.SELECTION_MODE_MASK);
            this._clearSelection()
        }
    },
    getSelectionMode: function() {
        return this.gridOption & DNA.widget.JWTGrid2.SELECTION_MODE_MASK
    },
    setRowResizeEnable: function(a) {
        if (a) {
            this.gridOption |= DNA.widget.JWTGrid2.ROW_RESIZE_MASK
        } else {
            this.gridOption &= ~DNA.widget.JWTGrid2.ROW_RESIZE_MASK
        }
    },
    getRowResizeEnable: function() {
        return (this.gridOption & DNA.widget.JWTGrid2.ROW_RESIZE_MASK) != 0
    },
    setColResizeEnable: function(a) {
        if (a) {
            this.gridOption |= DNA.widget.JWTGrid2.COL_RESIZE_MASK
        } else {
            this.gridOption &= ~DNA.widget.JWTGrid2.COL_RESIZE_MASK
        }
    },
    getColResizeEnable: function() {
        return (this.gridOption & DNA.widget.JWTGrid2.COL_RESIZE_MASK) != 0
    },
    setRowSelectEnabled: function(a) {
        if (a) {
            this.gridOption |= DNA.widget.JWTGrid2.ROW_SELECT_MASK
        } else {
            this.gridOption &= ~DNA.widget.JWTGrid2.ROW_SELECT_MASK
        }
    },
    getRowSelectEnabled: function() {
        return (this.gridOption & DNA.widget.JWTGrid2.ROW_SELECT_MASK) != 0
    },
    setRowFreeResizeEnabled: function(a) {
        if (a) {
            this.gridOption |= DNA.widget.JWTGrid2.ROW_FREE_RESIZE_MASK
        } else {
            this.gridOption &= ~DNA.widget.JWTGrid2.ROW_FREE_RESIZE_MASK
        }
    },
    getRowFreeResizeEnabled: function() {
        return (this.gridOption & DNA.widget.JWTGrid2.ROW_FREE_RESIZE_MASK) != 0
    },
    setColFreeResizeEnabled: function(a) {
        if (a) {
            this.gridOption |= DNA.widget.JWTGrid2.COL_FREE_RESIZE_MASK
        } else {
            this.gridOption &= ~DNA.widget.JWTGrid2.COL_FREE_RESIZE_MASK
        }
    },
    getColFreeResizeEnabled: function() {
        return (this.gridOption & DNA.widget.JWTGrid2.COL_FREE_RESIZE_MASK) != 0
    },
    setColSelectEnabled: function(a) {
        if (a) {
            this.gridOption |= DNA.widget.JWTGrid2.COL_SELECT_MASK
        } else {
            this.gridOption &= ~DNA.widget.JWTGrid2.COL_SELECT_MASK
        }
    },
    getColSelectEnabled: function() {
        return (this.gridOption & DNA.widget.JWTGrid2.COL_SELECT_MASK) != 0
    },
    setEnterNext: function(a) {
        this.gridOption &= ~DNA.widget.JWTGrid2.ENTER_NEXT_MASK;
        this.gridOption |= (a & DNA.widget.JWTGrid2.ENTER_NEXT_MASK)
    },
    getEnterNext: function() {
        return this.gridOption & DNA.widget.JWTGrid2.ENTER_NEXT_MASK
    },
    setMinColWidth: function(a) {
        if (a >= 0) {
            this.minColWidth = a
        } else {
            alert("�е���С��Ȳ���С��0")
        }
    },
    getMinColWidth: function() {
        return this.minColWidth
    },
    setMinRowHeight: function(a) {
        if (height >= 0) {
            this.minRowHeight = a
        } else {
            alert("�е���С�߶Ȳ���С��0")
        }
    },
    getMinRowHeight: function() {
        return this.minRowHeight
    },
    setDefColWidth: function(a) {
        if (a >= 0) {
            this.defColWidth = a
        } else {
            alert("�е�Ĭ�Ͽ�Ȳ���С��0")
        }
    },
    getDefColWidth: function(a) {
        return this.defColWidth = a
    },
    setDefRowHeight: function(a) {
        if (a >= 0) {
            this.defRowHeight = a
        } else {
            alert("�е�Ĭ�ϸ߶Ȳ���С��0")
        }
    },
    getDefRowHeight: function(a) {
        return this.defRowHeight
    },
    setRowBackground: function(b, a) {
        if (b < this.hRowCount) {
            this._applyRowBackground2Tables(b, a, [this.hrTable, this.hrtTab, this.hltTab])
        } else {
            if (this.rowCount - b < this.fRowCount) {
                this._applyRowBackground2Tables(b, a, [this.frTable, this.frbTab, this.flbTab])
            } else {
                this._applyRowBackground2Tables(b, a, [this.tDiv, this.fcTable, this.hcTable])
            }
        }
        this._reRenderMergeDivs()
    },
    _applyRowBackground2Tables: function(b, a, d) {
        if (d && d.length) {
            for (var c = 0; c < d.length; c++) {
                var g = d[c];
                var h = this._getRowDom(b, g);
                if (h) {
                    h.style.backgroundColor = a
                }
            }
        }
    },
    _getRowBackground: function(a) {
        var b = this._getRowDom(a, this.tDiv);
        if (b) {
            return b.style.backgroundColor
        }
    },
    _setCurrentCellOffset: function(a) {
        if (!a) {
            return
        }
        var g = this.getCurrentCell();
        if (!g) {
            return
        }
        var b = this._getCellDom(g.x, g.y, this.tDiv);
        var d = b.offsetLeft;
        var c = b.offsetTop;
        this.tDiv.scrollLeft = d - a.x;
        this.tDiv.scrollTop = c - a.y;
        this._handleScroll()
    },
    setCurrentCell: function(b, l, h, d, c) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = null ;
        if (b) {
            if (b.y < this.renderedTop || b.y >= this.renderedTop + this.renderedCount) {
                return
            }
            if (!this.util.isDataCol(b.x) || !this.util.isDataRow(b.y)) {
                return
            }
            try {
                a = new DNA.widget.AbstractGridCellAsync(this,this.tDiv,b.x,b.y,false)
            } catch (g) {
                a = null 
            }
        }
        this._setCurrentCell(a, null , null , d, c);
        this.fireEvent("currentCellOffsetChanged", [this])
    },
    setCurrentCellNoFire: function(b, l, h, d, c) {
        if (!this.checkRendered(true)) {
            return
        }
        var a = null ;
        if (b) {
            if (b.y < this.renderedTop || b.y >= this.renderedTop + this.renderedCount) {
                return
            }
            if (!this.util.isDataCol(b.x) || !this.util.isDataRow(b.y)) {
                return
            }
            try {
                a = new DNA.widget.AbstractGridCellAsync(this,this.tDiv,b.x,b.y,false)
            } catch (g) {
                a = null 
            }
        }
        this._setCurrentCellNoFireChanging(a, null , null , d, c, true)
    },
    _setCurrentCell: function(b, a, m, g, d) {
        if (!this.checkRendered(true)) {
            return
        }
        this._stopDbClick = false;
        if (!b) {
            this._hideInputProxy();
            if (this.getCurrentCell()) {
                var h = {
                    widget: this,
                    target: null ,
                    lastCurrent: this.getCurrentCell(),
                    doit: true
                };
                this.fireCurrentCellChangingEvent(h);
                if (!h.doit) {
                    this._stopDbClick = true;
                    return
                }
                this.closeEditor(g);
                this._hideFace();
                this._drawCurrentCellBack();
                this.currentCell = null ;
                this.currentCol = -1;
                this.currentRow = -1
            }
            return
        }
        var c = b.getColIndex();
        var l = b.getRowIndex();
        if (this.currentCell) {
            if (this.currentCell.getColIndex() == c && this.currentCell.getRowIndex() == l) {
                this._drawCurrentCellBack();
                this._drawCurrentCell(b);
                return
            }
        }
        var h = {
            widget: this,
            target: new DNA.widget.Point(c,l),
            lastCurrent: this.getCurrentCell(),
            doit: true
        };
        this.fireCurrentCellChangingEvent(h);
        if (!h.doit) {
            this._stopDbClick = true;
            return
        }
        this._setCurrentCellNoFireChanging(b, a, m, g, d)
    },
    _setCurrentCellNoFireChanging: function(m, h, d, b, a, n) {
        if (!m) {
            this._hideInputProxy();
            if (this.getCurrentCell()) {
                this.closeEditor(b);
                this._hideFace();
                this._drawCurrentCellBack();
                this.currentCell = null ;
                this.currentCol = -1;
                this.currentRow = -1
            }
            return
        }
        var l = m.getColIndex();
        var g = m.getRowIndex();
        if (this.currentCell) {
            if (this.currentCell.getColIndex() == l && this.currentCell.getRowIndex() == g) {
                this._drawCurrentCellBack();
                this._drawCurrentCell(m);
                return
            }
        }
        this.closeEditor(b);
        this._hideFace();
        this._drawCurrentCellBack();
        this.currentCell = m;
        if (h) {
            this.currentCol = h
        } else {
            this.currentCol = m.getColIndex()
        }
        if (d) {
            this.currentRow = d
        } else {
            this.currentRow = m.getRowIndex()
        }
        this.focus();
        this._focusInputProxy();
        this._scrollToCol(this.currentCol);
        this._scrollToRow(this.currentRow);
        this._drawCurrentCell(m);
        this.updateCurrentCellColor();
        if ((this.getEditMode() != DNA.widget.JWTGrid.EDIT_MODE_READONLY) && this.util.isCellEditable(l, g)) {
            this._showFace()
        }
        if (n) {
            var c = function(o) {
                this.fireEvent("currentCellChangedByServer", [this, o])
            }
            ;
            DNA.adapter.browserPage.addFinalTask([c, this, [a]])
        } else {
            this.fireEvent("currentCellChanged", [this, a])
        }
    },
    _hideFace: function() {
        if (this.curFace) {
            this.gel.appendChild(this.curFace);
            this.curFace.style.display = "none";
            this.curFace = null 
        }
    },
    _showFace: function() {
        if (this.currentCell) {
            var b = this.currentCell.getEditorFace();
            if (b == 1) {
                this.curFace = this.btnFace
            } else {
                if (b == 2) {
                    this.curFace = this.listFace
                }
            }
            if (this.curFace) {
                var a = this.currentCell.getColIndex();
                var c = this.currentCell.getRowIndex();
                if (a < this.hColCount && c < this.hRowCount) {
                    this.hltDiv.appendChild(this.curFace)
                } else {
                    if (a < this.hColCount) {
                        this.hcDiv.childNodes[1].appendChild(this.curFace)
                    } else {
                        if (c < this.hRowCount) {
                            this.hrDiv.appendChild(this.curFace)
                        } else {
                            this.cwDiv.appendChild(this.curFace)
                        }
                    }
                }
                this.curFace.style.display = "";
                this._reBoundFace()
            }
        }
    },
    _reBoundFace: function() {
        if (this.currentCell && this.curFace && this.currentCell.td) {
            var b = this.currentCell.td.offsetLeft;
            var d = this.currentCell.td.parentNode.offsetTop;
            var c = this.currentCell.td.offsetWidth;
            var a = this.currentCell.td.offsetHeight;
            this.curFace.style.left = b + c - 19 + "px";
            this.curFace.style.top = d + "px";
            this.curFace.style.height = Math.max(0, a - 2) + "px";
            this.curFace.style.display = "none";
            this.curFace.style.display = ""
        }
    },
    _focusInputProxy: function() {
        if (!DNA.engine.Client.isIOS()) {
            if (!this.checkRendered(false)) {
                return
            }
            if (this.util.isCellEditable(this.currentCol, this.currentRow)) {
                this.inputProxy.focus()
            }
        }
    },
    _blurInputProxy: function() {
        if (!this.checkRendered(false)) {
            return
        }
        try {
            this.inputProxy.blur()
        } catch (a) {}
    },
    _hideInputProxy: function() {
        DNA.engine.DomUtil.setLeftTop(this.inputProxy, 0, 0);
        this.inputProxy.style.width = "1px"
    },
    _reBoundCurCell: function() {
        if (this.currentCell) {
            var g = this.currentCell.getTop() - 2;
            var d = this.currentCell.getLeft() - 2;
            var b = this.currentCell.getWidth();
            var a = this.currentCell.getHeight();
            DNA.engine.DomUtil.setLeftTop(this.curLeft, d, g);
            DNA.engine.DomUtil.setHeight(this.curLeft, a);
            DNA.engine.DomUtil.setLeftTop(this.curTop, d, g);
            DNA.engine.DomUtil.setWidth(this.curTop, b);
            DNA.engine.DomUtil.setLeftTop(this.curRight, d + b, g);
            DNA.engine.DomUtil.setHeight(this.curRight, a);
            DNA.engine.DomUtil.setLeftTop(this.curBottom, d, g + a);
            DNA.engine.DomUtil.setWidth(this.curBottom, b);
            this.reBoundEditor();
            if (this.showBorder) {
                var h = d + b - 2;
                var c = g + a - 2;
                if (DNA.engine.Client.isIE() && !DNA.engine.Client.isStrict()) {
                    h -= 2;
                    c -= 2
                }
                DNA.engine.DomUtil.setLeftTop(this.dragPointDiv, h, c);
                DNA.engine.DomUtil.setLeftTop(this.selBorderLeft, d, g);
                DNA.engine.DomUtil.setHeight(this.selBorderLeft, a);
                DNA.engine.DomUtil.setLeftTop(this.selBorderTop, d, g);
                DNA.engine.DomUtil.setWidth(this.selBorderTop, b);
                DNA.engine.DomUtil.setLeftTop(this.selBorderRight, d + b, g);
                DNA.engine.DomUtil.setHeight(this.selBorderRight, a);
                DNA.engine.DomUtil.setLeftTop(this.selBorderBottom, d, g + a);
                DNA.engine.DomUtil.setWidth(this.selBorderBottom, b)
            }
        }
    },
    reBoundEditor: function() {
        if (this.activeEditor) {
            this.activeEditor.reBoundCtr()
        }
    },
    getColVisible: function(b) {
        var a = this._getCellDom(b, -1, this.tDiv);
        if (!a || !a.td) {
            return false
        }
        if (a.getAttribute("hf")) {
            return false
        }
        return true
    },
    _drawCurrentCell: function(n) {
        if (this.getCurBorderHiddden() || !n.td || !n.td.parentNode) {
            return
        }
        if (this.currentCol < this.hColCount && this.currentRow < this.hRowCount) {
            this.curLeft = this.hltDiv.childNodes[1];
            this.curRight = this.hltDiv.childNodes[2];
            this.curTop = this.hltDiv.childNodes[3];
            this.curBottom = this.hltDiv.childNodes[4];
            this.dragPointDiv = this.hltDiv.childNodes[5];
            this.selBorderLeft = this.hltDiv.childNodes[6];
            this.selBorderRight = this.hltDiv.childNodes[7];
            this.selBorderTop = this.hltDiv.childNodes[8];
            this.selBorderBottom = this.hltDiv.childNodes[9]
        } else {
            if (this.currentCol < this.hColCount) {
                var p = this.hcDiv.childNodes[1].firstChild;
                this.curLeft = p.childNodes[1];
                this.curRight = p.childNodes[2];
                this.curTop = p.childNodes[3];
                this.curBottom = p.childNodes[4];
                this.dragPointDiv = p.childNodes[5];
                this.selBorderLeft = p.childNodes[6];
                this.selBorderRight = p.childNodes[7];
                this.selBorderTop = p.childNodes[8];
                this.selBorderBottom = p.childNodes[9]
            } else {
                if (this.currentRow < this.hRowCount) {
                    this.curLeft = this.hrDiv.childNodes[1];
                    this.curRight = this.hrDiv.childNodes[2];
                    this.curTop = this.hrDiv.childNodes[3];
                    this.curBottom = this.hrDiv.childNodes[4];
                    this.dragPointDiv = this.hrDiv.childNodes[5];
                    this.selBorderLeft = this.hrDiv.childNodes[6];
                    this.selBorderRight = this.hrDiv.childNodes[7];
                    this.selBorderTop = this.hrDiv.childNodes[8];
                    this.selBorderBottom = this.hrDiv.childNodes[9]
                } else {
                    this.curLeft = this.mCurLeft;
                    this.curRight = this.mCurRight;
                    this.curTop = this.mCurTop;
                    this.curBottom = this.mCurBottom;
                    this.dragPointDiv = this.mDragPointDiv;
                    this.selBorderLeft = this.mSelBorderLeft;
                    this.selBorderRight = this.mSelBorderRight;
                    this.selBorderTop = this.mSelBorderTop;
                    this.selBorderBottom = this.mSelBorderBottom
                }
            }
        }
        this.curLeft.style.display = "block";
        this.curRight.style.display = "block";
        this.curTop.style.display = "block";
        this.curBottom.style.display = "block";
        if (this.showBorder) {
            this.selBorderLeft.style.display = "block";
            this.selBorderRight.style.display = "block";
            this.selBorderTop.style.display = "block";
            this.selBorderBottom.style.display = "block";
            this.dragPointDiv.style.display = "block";
            this.dragPointDiv.style.position = "absolute"
        }
        var l = n.td.parentNode.offsetTop - 1;
        var d = n.td.offsetLeft - 1;
        var b = n.getWidth();
        var o = n.getHeight();
        DNA.engine.DomUtil.setLeftTop(this.curLeft, d, l);
        DNA.engine.DomUtil.setHeight(this.curLeft, o);
        DNA.engine.DomUtil.setLeftTop(this.curTop, d, l);
        DNA.engine.DomUtil.setWidth(this.curTop, b);
        DNA.engine.DomUtil.setLeftTop(this.curRight, d + b, l);
        DNA.engine.DomUtil.setHeight(this.curRight, o);
        DNA.engine.DomUtil.setLeftTop(this.curBottom, d, l + o);
        DNA.engine.DomUtil.setWidth(this.curBottom, b);
        if (this.showBorder) {
            var c = d + b - 2;
            var g = l + o - 2;
            DNA.engine.DomUtil.setLeftTop(this.dragPointDiv, c, g);
            DNA.engine.DomUtil.setLeftTop(this.selBorderLeft, d, l);
            DNA.engine.DomUtil.setHeight(this.selBorderLeft, o);
            DNA.engine.DomUtil.setLeftTop(this.selBorderTop, d, l);
            DNA.engine.DomUtil.setWidth(this.selBorderTop, b);
            DNA.engine.DomUtil.setLeftTop(this.selBorderRight, d + b, l);
            DNA.engine.DomUtil.setHeight(this.selBorderRight, o);
            DNA.engine.DomUtil.setLeftTop(this.selBorderBottom, d, l + o);
            DNA.engine.DomUtil.setWidth(this.selBorderBottom, b)
        }
        var d = n.getColIndex();
        var l = n.getRowIndex();
        var m = d + n.getColSpan() - 1;
        var a = l + n.getRowSpan() - 1;
        var h = {
            x: d,
            y: l,
            width: m,
            height: a
        };
        this._internalDrawTitle(h, false, true)
    },
    _drawCurrentCellBack: function() {
        if (this.getCurBorderHiddden()) {
            return
        }
        if (this.currentCell) {
            this.curLeft.style.display = "none";
            this.curRight.style.display = "none";
            this.curTop.style.display = "none";
            this.curBottom.style.display = "none";
            this.dragPointDiv.style.display = "none";
            if (this.showBorder) {
                this._hideSelectionBorder()
            }
            if (!this._currentCellInSelection()) {
                var g = this.currentCell.getColIndex();
                var d = this.currentCell.getRowIndex();
                var b = g + this.currentCell.getColSpan() - 1;
                var a = d + this.currentCell.getRowSpan() - 1;
                var c = {
                    x: g,
                    y: d,
                    width: b,
                    height: a
                };
                this._internalDrawTitle(c, false, false)
            } else {
                if (this.selectionAreas[0]) {
                    this.selectionAreas[0].hideSelectionBorders()
                }
            }
        }
    },
    _currentCellInSelection: function() {
        if (!this.currentCell) {
            return false
        }
        if (!this.selectionAreas || this.selectionAreas == 0) {
            return false
        }
        var c = {
            x: this.currentCell.getColIndex(),
            y: this.currentCell.getRowIndex()
        };
        for (var b = 0, a = this.selectionAreas.length; b < a; ++b) {
            if (this._isPointInRect(c, this.selectionAreas[b].getRange())) {
                return true
            }
        }
        return false
    },
    _isPointInRect: function(b, a) {
        if (b.x >= a.x && b.x < a.x + a.width && b.y >= a.y && b.y < a.y + a.height) {
            return true
        }
        return false
    },
    _hideSelectionBorder: function() {
        this.selBorderLeft.style.display = "none";
        this.selBorderRight.style.display = "none";
        this.selBorderTop.style.display = "none";
        this.selBorderBottom.style.display = "none";
        this.dragPointDiv.style.display = "none"
    },
    _showSelectionBorder: function() {
        if (this.showBorder) {
            this.selBorderLeft.style.display = "block";
            this.selBorderRight.style.display = "block";
            this.selBorderTop.style.display = "block";
            this.selBorderBottom.style.display = "block";
            this.dragPointDiv.style.display = "block"
        }
    },
    getCurrentCell: function() {
        if (this.currentCol == -1 || this.currentRow == -1) {
            return null 
        }
        return {
            x: this.currentCol,
            y: this.currentRow
        }
    },
    getCurrentCellOffset: function() {
        var h = this.getCurrentCell();
        if (!h) {
            return null 
        }
        var d = this.util.getColOffsetLeft(h.x);
        var c = this.util.getRowOffsetTop(h.y);
        var g = this.tDiv.scrollLeft;
        var b = this.tDiv.scrollTop;
        var a = d - g;
        var l = c - b;
        return {
            x: a,
            y: l
        }
    },
    keyEnterDown: function(c) {
        var b = c.isShift();
        var a;
        switch (this.getEnterNext()) {
        case DNA.widget.JWTGrid2.ENTER_NEXT_RIGHT:
            if (b) {
                a = this.util.getLeftCell(this.currentCol, this.currentRow, null , true, true)
            } else {
                a = this.util.getRightCell(this.currentCol, this.currentRow, null , true, true)
            }
            break;
        case DNA.widget.JWTGrid2.ENTER_NEXT_DOWN:
            if (b) {
                a = this.util.getUpCell(this.currentCol, this.currentRow, null , true, true)
            } else {
                a = this.util.getDownCell(this.currentCol, this.currentRow, null , true, true)
            }
            break;
        case DNA.widget.JWTGrid2.ENTER_NEXT_LEFT:
            if (b) {
                a = this.util.getRightCell(this.currentCol, this.currentRow, null , true, true)
            } else {
                a = this.util.getLeftCell(this.currentCol, this.currentRow, null , true, true)
            }
            break;
        case DNA.widget.JWTGrid2.ENTER_NEXT_UP:
            if (b) {
                a = this.util.getDownCell(this.currentCol, this.currentRow, null , true, true)
            } else {
                a = this.util.getUpCell(this.currentCol, this.currentRow, null , true, true)
            }
            break
        }
        if (a) {
            this.selectCell(a.x, a.y)
        }
    },
    keydownNavigation: function(d) {
        var b = d.isShift();
        var c = d.isCtrl();
        var a = d.isAlt();
        if (!a) {
            var g = this.getSelectionMode();
            switch (g) {
            case DNA.widget.JWTGrid2.SELECTION_MODE_MULTI:
            case DNA.widget.JWTGrid2.SELECTION_MODE_SINGLE:
                if (this.selectionAreas.length === 0) {
                    if (this.getCurrentCell()) {
                        this.keyCellSelect(d)
                    }
                } else {
                    if (g === DNA.widget.JWTGrid2.SELECTION_MODE_SINGLE || !b) {
                        this.keyCellSelect(d)
                    } else {
                        if (!c) {
                            this.keyCellSelectWithShift(d)
                        } else {
                            this.keyCellSelectWithCtrlShift(d)
                        }
                    }
                }
                break;
            case DNA.widget.JWTGrid2.SELECTION_MODE_ROW:
                this.keyRowSelect(d);
                break
            }
        }
    },
    keydownPage: function(g) {
        var c = this.tDiv.offsetHeight;
        var b = DNA.engine.DomUtil.getClientSize(this.tDiv);
        var h = DNA.engine.DomUtil.getSize(this.frTable);
        var a = DNA.engine.DomUtil.getSize(this.hrTable);
        var d = {
            widget: this,
            srcEvent: g,
            doit: true
        };
        switch (g.getKeyCode()) {
        case DNA.JWTEvent.PAGEUP:
            this.firePagingEvent(d);
            if (!d.doit) {
                return
            }
            if (this.tDiv.scrollTop - b.height >= 0) {
                this.tDiv.scrollTop -= (b.height + a.height)
            } else {
                this.tDiv.scrollTop = 0
            }
            break;
        case DNA.JWTEvent.PAGEDOWN:
            this.firePagingEvent(d);
            if (!d.doit) {
                return
            }
            if (this.tDiv.scrollTop + b.height + b.height <= c) {
                this.tDiv.scrollTop += (b.height - h.height - 20)
            } else {
                this.tDiv.scrollTop = c - b.height
            }
            break
        }
    },
    selectFirstCell: function() {},
    keyCellSelect: function(d) {
        var c = d.isCtrl();
        var b = d.getKeyCode();
        var a;
        if (!c) {
            switch (b) {
            case DNA.JWTEvent.LEFT:
                a = this.util.getLeftCell(this.currentCol, this.currentRow, null , false, false);
                break;
            case DNA.JWTEvent.RIGHT:
                a = this.util.getRightCell(this.currentCol, this.currentRow, null , false, false);
                break;
            case DNA.JWTEvent.UP:
                a = this.util.getUpCell(this.currentCol, this.currentRow, null , false, false);
                break;
            case DNA.JWTEvent.DOWN:
                a = this.util.getDownCell(this.currentCol, this.currentRow, null , false, false);
                break;
            case DNA.JWTEvent.HOME:
                a = this.util.getRowFirstCell(this.currentRow, false, false);
                break;
            case DNA.JWTEvent.END:
                a = this.util.getRowLastCell(this.currentRow, false, false);
                break
            }
        } else {
            switch (b) {
            case DNA.JWTEvent.LEFT:
                a = this.util.getRowFirstCell(this.currentRow, false, false);
                break;
            case DNA.JWTEvent.RIGHT:
                a = this.util.getRowLastCell(this.currentRow, false, false);
                break;
            case DNA.JWTEvent.UP:
                a = this.util.getColFirstCell(this.currentCol, false, false);
                break;
            case DNA.JWTEvent.DOWN:
                a = this.util.getColLastCell(this.currentCol, false, false);
                break;
            case DNA.JWTEvent.HOME:
                a = this.util.getFirstCell(null , false);
                break;
            case DNA.JWTEvent.END:
                a = this.util.getLastCell(null , false);
                break
            }
        }
        if (a) {
            this.selectCell(a.x, a.y)
        }
    },
    selectCell: function(a, c) {
        if (this.util.isDataCell(a, c)) {
            this.setCurrentCell({
                x: a,
                y: c
            }, a, c);
            this.clearSelection();
            var b = new DNA.widget.Grid2SelectionAreaAsync(this,{
                x: a,
                y: c,
                width: a,
                height: c
            },true,this.selectionDiv,true,this.showBorder);
            this._setSelection(b);
            this.fireEvent("selection", [this]);
            this.setCurrentSelection(b)
        }
    },
    keyCellSelectWithShift: function(g) {
        var q = g.getKeyCode();
        var l = this.getCurrentSelection();
        if (!l) {
            return
        }
        var n = l.getRange();
        switch (q) {
        case DNA.JWTEvent.LEFT:
            var m = this.shrinkCellRect(n, DNA.widget.JWTGrid2.LEFT);
            if (this.rectEqual(m, n)) {
                return
            }
            if (m.x == this.currentCol) {
                l._setBound(m);
                l.reBuild(true)
            } else {
                var p = this.util.getLeftCol(m.x);
                if (this.util.isDataCol(p)) {
                    var o = new DNA.widget.Rectangle(p,m.y,l.width,m.height);
                    l._setBound(o);
                    l.reBuild(true)
                }
            }
            break;
        case DNA.JWTEvent.RIGHT:
            if (l.x < this.currentCol) {
                var a = this.util.getRightCol(l.x);
                if (this.util.isDataCol(a)) {
                    var o = new DNA.widget.Rectangle(a,l.y,l.width,l.height);
                    l._setBound(o);
                    l.reBuild(true)
                }
                return
            }
            var b = this.shrinkCellRect(n, DNA.widget.JWTGrid2.RIGHT);
            if (!b || this.rectEqual(b, n)) {
                return
            }
            l._setBound(b);
            l.reBuild(true);
            break;
        case DNA.JWTEvent.UP:
            if (l.y < this.currentRow) {
                var h = this.util.getUpRow(l.y);
                if (this.util.isDataRow(h)) {
                    var o = new DNA.widget.Rectangle(l.x,h,l.width,l.height);
                    l._setBound(o);
                    l.reBuild(true)
                }
            } else {
                var r = this.shrinkCellRect(n, DNA.widget.JWTGrid2.UP);
                if (this.rectEqual(r, n)) {
                    return
                }
                l._setBound(r);
                l.reBuild(true)
            }
            break;
        case DNA.JWTEvent.DOWN:
            if (l.y < this.currentRow) {
                var c = this.util.getDownRow(l.y);
                if (this.util.isDataRow(c)) {
                    var o = new DNA.widget.Rectangle(l.x,c,l.width,l.height);
                    l._setBound(o);
                    l.reBuild(true)
                }
                return
            }
            var d = this.shrinkCellRect(n, DNA.widget.JWTGrid2.DOWN);
            if (!d || this.rectEqual(d, n)) {
                return
            }
            l._setBound(d);
            l.reBuild(true);
            break;
        case DNA.JWTEvent.HOME:
            break;
        case DNA.JWTEvent.END:
            break
        }
        this._internalDrawTitle(l, false, true);
        this.fireEvent("selection", [this])
    },
    keyCellSelectWithCtrlShift: function(a) {},
    keyRowSelect: function(h) {
        var g = h.isCtrl();
        var d = h.getKeyCode();
        var a;
        if (!g) {
            switch (d) {
            case DNA.JWTEvent.LEFT:
                a = this.util.getLeftCell(this.currentCol, this.currentRow, null , false, false);
                break;
            case DNA.JWTEvent.RIGHT:
                a = this.util.getRightCell(this.currentCol, this.currentRow, null , false, false);
                break;
            case DNA.JWTEvent.UP:
                a = this.util.getUpCell(this.currentCol, this.currentRow, null , false, false);
                break;
            case DNA.JWTEvent.DOWN:
                a = this.util.getDownCell(this.currentCol, this.currentRow, null , false, false);
                break;
            case DNA.JWTEvent.HOME:
                a = this.util.getRowFirstCell(this.currentRow, false, false);
                break;
            case DNA.JWTEvent.END:
                a = this.util.getRowLastCell(this.currentRow, false, false);
                break
            }
        } else {
            switch (d) {
            case DNA.JWTEvent.LEFT:
                a = this.util.getRowFirstCell(this.currentRow, false, false);
                break;
            case DNA.JWTEvent.RIGHT:
                a = this.util.getRowLastCell(this.currentRow, false, false);
                break;
            case DNA.JWTEvent.UP:
                a = this.util.getColFirstCell(this.currentCol, false, false);
                break;
            case DNA.JWTEvent.DOWN:
                a = this.util.getColLastCell(this.currentCol, false, false);
                break;
            case DNA.JWTEvent.HOME:
                a = this.util.getFirstCell(null , false);
                break;
            case DNA.JWTEvent.END:
                a = this.util.getLastCell(null , false);
                break
            }
        }
        if (a) {
            if (d != DNA.JWTEvent.LEFT && d != DNA.JWTEvent.RIGHT) {
                this.clearSelection();
                var c = {
                    x: 1,
                    y: a.y,
                    width: this.columnCount - 1,
                    height: a.y
                };
                var b = new DNA.widget.Grid2SelectionAreaAsync(this,c,false,this.selectionDiv,false,this.showBorder);
                this._setSelection(b);
                this.fireEvent("selection", [this]);
                this.setCurrentSelection(b)
            }
            this.setCurrentCell(a)
        }
    },
    shrinkCellRect: function(p, h) {
        var t;
        var u = new DNA.widget.Rectangle(p);
        switch (h) {
        case DNA.widget.JWTGrid2.LEFT:
            var d = p.width - 1;
            u.width--;
            while (d > 0) {
                var g = d;
                for (var l = p.y; l <= p.height; ++l) {
                    t = new DNA.widget.AbstractGridCellAsync(this,this.tDiv,d,l,false);
                    var c = t.getColIndex() + t.getColSpan() - 1;
                    if (t.getColIndex() <= g) {
                        g = t.getColIndex() - 1
                    }
                    if (c > u.width) {
                        u.width = c
                    }
                }
                if (u.width == p.width) {
                    d = g;
                    u.width = g
                } else {
                    break
                }
            }
            break;
        case DNA.widget.JWTGrid2.RIGHT:
            var s = this.util.getRightCol(p.width);
            if (!this.util.isDataCol(s)) {
                return null 
            }
            u.width++;
            while (s > 0) {
                var m = s;
                for (var l = p.y; l <= p.height; ++l) {
                    t = new DNA.widget.AbstractGridCellAsync(this,this.tDiv,s,l,false);
                    var c = t.getColIndex() + t.getColSpan() - 1;
                    if (c >= m) {
                        m = c + 1
                    }
                    if (c > u.width) {
                        u.width = c
                    }
                }
                if (u.width == p.width) {
                    s = m;
                    u.width = m
                } else {
                    break
                }
            }
            break;
        case DNA.widget.JWTGrid2.UP:
            var o = this.util.getUpRow(p.height);
            u.height--;
            while (o > 0) {
                var v = o;
                for (var l = p.x; l <= p.width; ++l) {
                    t = new DNA.widget.AbstractGridCellAsync(this,this.tDiv,l,o,false);
                    var n = t.getRowIndex() + t.getRowSpan() - 1;
                    if (t.getRowIndex() <= v) {
                        v = t.getRowIndex() - 1
                    }
                    if (n < u.height) {
                        u.height = n
                    }
                }
                if (u.height == p.height) {
                    o = v;
                    u.height = v
                } else {
                    break
                }
            }
            break;
        case DNA.widget.JWTGrid2.DOWN:
            var a = this.util.getDownRow(p.height);
            if (!this.util.isDataRow(a)) {
                return null 
            }
            u.height++;
            while (a > 0) {
                var q = a;
                for (var l = p.x; l <= p.width; ++l) {
                    t = new DNA.widget.AbstractGridCellAsync(this,this.tDiv,l,a,false);
                    var n = t.getRowIndex() + t.getRowSpan() - 1;
                    if (n >= q) {
                        q = n + 1
                    }
                    if (n > u.height) {
                        u.height = n
                    }
                }
                if (u.height == p.height) {
                    a = q;
                    u.height = q
                } else {
                    break
                }
            }
            break;
        default:
            break
        }
        return u
    },
    expandCellRect: function(g, c) {
        var b;
        var a = new DNA.widget.Rectangle(g);
        switch (c) {
        case DNA.widget.JWTGrid2.LEFT:
        case DNA.widget.JWTGrid2.RIGHT:
            var h = g.width - 1;
            a.width--;
            while (h > 0) {
                for (var d = g.y; x <= g.height; ++d) {
                    b = new DNA.widget.AbstractGridCellAsync(this,this.tDiv,h,d,false)
                }
            }
            break;
        case DNA.widget.JWTGrid2.UP:
            break;
        case DNA.widget.JWTGrid2.DOWN:
            break;
        default:
            break
        }
    },
    rectEqual: function(b, a) {
        if (b.x === a.x && b.width === a.width && b.y === a.y && b.height === a.height) {
            return true
        }
        return false
    },
    allSelectStart: function(c) {
        if (!this.checkRendered(true)) {
            return
        }
        var b = {
            x: 1,
            y: 1,
            width: this.columnCount - 1,
            height: this.rowCount - 1
        };
        var a;
        a = new DNA.widget.Grid2SelectionAreaAsync(this,b,false);
        this._setSelection(a);
        this.setCurrentSelection(a)
    },
    rowSelectStart: function(g) {
        if (!this.checkRendered(true)) {
            return
        }
        this.selectionDiv.style.borderStyle = "none";
        var n = this.mouseCell.y;
        var h = g.isCtrl();
        var b = g.isShift();
        var a = {
            x: 1,
            y: n,
            width: this.columnCount - 1,
            height: n
        };
        var o;
        if ((!h && !b) || (h && b)) {
            o = new DNA.widget.Grid2SelectionAreaAsync(this,a,false,this.selectionDiv,false,this.showBorder);
            var c = this.util.getRowFirstCell(n, false, false);
            this.setCurrentCell(c, c.x, c.y, null , g.getButton());
            this._setSelection(o);
            this.setCurrentSelection(o)
        } else {
            if (h && !b) {
                o = new DNA.widget.Grid2SelectionAreaAsync(this,a,false,this.selectionDiv,false,this.showBorder);
                var c = this.util.getRowFirstCell(n, false, false);
                this.setCurrentCell(c, c.x, c.y, null , g.getButton());
                this._addSelection(o);
                this.setCurrentSelection(o)
            } else {
                if (this.currentRow == -1) {
                    this.currentRow = n
                }
                var d = Math.min(this.currentRow, n);
                var l = Math.max(this.currentRow, n);
                var m = {
                    x: 1,
                    y: d,
                    width: this.columnCount - 1,
                    height: l
                };
                if (!this.currentSelection) {
                    o = new DNA.widget.Grid2SelectionAreaAsync(this,m,false,null ,false,this.showBorder);
                    var c = this.util.getRowFirstCell(n, false, false);
                    this.setCurrentCell(c, c.x, c.y, null , g.getButton());
                    this._addSelection(o, false);
                    this.setCurrentSelection(o)
                } else {
                    this.currentSelection._setBound(m);
                    this.currentSelection.reBuild(true)
                }
            }
        }
    },
    colSelectStart: function(g) {
        if (!this.checkRendered(true)) {
            return
        }
        this.selectionDiv.style.borderStyle = "none";
        var n = this.mouseCell.x;
        var h = g.isCtrl();
        var b = g.isShift();
        var a = {
            x: n,
            y: 1,
            width: n,
            height: this.rowCount - 1
        };
        var m;
        if ((!h && !b) || (h && b)) {
            var c = this.util.getColFirstCell(n, false, false);
            this.setCurrentCell(c, c.x, c.y, null , g.getButton());
            m = new DNA.widget.Grid2SelectionAreaAsync(this,a,false,this.selectionDiv,false,this.showBorder);
            this._setSelection(m);
            this.setCurrentSelection(m)
        } else {
            if (h && !b) {
                var c = this.util.getColFirstCell(n, false, false);
                this.setCurrentCell(c, c.x, c.y, null , g.getButton());
                m = new DNA.widget.Grid2SelectionAreaAsync(this,a,false,this.selectionDiv,false,this.showBorder);
                this._addSelection(m);
                this.setCurrentSelection(m)
            } else {
                if (this.currentCol == -1) {
                    this.currentCol = n
                }
                var d = Math.min(this.currentCol, n);
                var o = Math.max(this.currentCol, n);
                var l = {
                    x: d,
                    y: 1,
                    width: o,
                    height: this.rowCount - 1
                };
                if (!this.currentSelection) {
                    m = new DNA.widget.Grid2SelectionAreaAsync(this,l,false,null ,false,this.showBorder);
                    var c = this.util.getColFirstCell(n, false, false);
                    this.setCurrentCell(c, c.x, c.y, null , g.getButton());
                    this._addSelection(m, false);
                    this.setCurrentSelection(m)
                } else {
                    this.currentSelection._setBound(l);
                    this.currentSelection.reBuild(true)
                }
            }
        }
    },
    checkSelRange: function(a) {
        if (a.x < 1 || a.width >= this.columnCount || a.x > a.width) {
            return false
        }
        if (a.y < 1 || a.height >= this.rowCount || a.y > a.height) {
            return false
        }
        return true
    },
    getSelections: function() {
        var b = this.selectionAreas.length;
        var a = new Array();
        for (var c = 0; c < b; ++c) {
            var d = this.selectionAreas[c];
            a.push({
                x: d.x,
                y: d.y,
                width: d.width - d.x + 1,
                height: d.height - d.y + 1
            })
        }
        return a
    },
    getSelection: function() {
        var a = new DNA.widget.Rectangle();
        if (this.currentSelection) {
            a.x = this.currentSelection.x;
            a.y = this.currentSelection.y;
            a.width = this.currentSelection.width - this.currentSelection.x + 1;
            a.height = this.currentSelection.height - this.currentSelection.y + 1
        }
        return a
    },
    addSelection: function(b) {
        if (!this.checkRendered(true) || !b || !this.checkSelRange(b)) {
            return
        }
        this.selectionDiv.style.width = "0px";
        var a = new DNA.widget.Grid2SelectionAreaAsync(this,b,true,null ,false,this.showBorder);
        this._internalDrawTitle(a, true, true);
        this.selectionAreas.push(a)
    },
    setSelection: function(b) {
        if (!this.checkRendered(true)) {
            return
        }
        this._clearSelection();
        if (!b || !this.checkSelRange(b)) {
            return
        }
        var a = new DNA.widget.Grid2SelectionAreaAsync(this,b,true,null ,false,this.showBorder);
        this._internalDrawTitle(a, true, true);
        this.selectionAreas.push(a)
    },
    setSelections: function(b) {
        if (!this.checkRendered(true)) {
            return
        }
        this._clearSelection();
        if (!b) {
            return
        }
        var a = b.length;
        for (var c = 0; c < a; ++c) {
            this.addSelection(b[c])
        }
    },
    _addSelection: function(a) {
        if (!this.checkRendered(true)) {
            return
        }
        this._internalDrawTitle(a, true, true);
        this.selectionAreas.push(a)
    },
    _setSelection: function(a) {
        if (!this.checkRendered(true)) {
            return
        }
        this._clearSelection();
        this._clearSelectionChangeArea();
        this.selectionDiv.style.borderStyle = "none";
        this._internalDrawTitle(a, true, true);
        this.selectionAreas.push(a)
    },
    _drawTitlesBack: function(g) {
        if (!this.checkRendered(true)) {
            return
        }
        var m = g.x;
        var d = g.width;
        var l = g.y;
        var b = g.height;
        var h = this._getRowDom(0, this.hrDiv);
        var a;
        for (var c = m; c <= d; ++c) {
            a = this._getRowCell(h, c, 0);
            a.style.backgroundColor = "";
            a.style.borderColor = "";
            if (c < this.hColCount) {
                a = this._getCellDom(c, 0, this.hltDiv);
                a.style.backgroundColor = "";
                a.style.borderColor = ""
            }
        }
        for (var c = l; c <= b; ++c) {
            a = this._getCellDom(0, c, this.hcDiv);
            a.style.backgroundColor = "";
            a.style.borderColor = "";
            if (c < this.hRowCount) {
                a = this._getCellDom(0, c, this.hltDiv);
                a.style.backgroundColor = "";
                a.style.borderColor = ""
            }
        }
    },
    _colInCurSel: function(b) {
        var a = this.selectionAreas.length;
        for (var c = 0; c < a; ++c) {
            var d = this.selectionAreas[c];
            if ((b >= d.x) && (b <= d.width)) {
                return true
            }
        }
        return false
    },
    _rowInCurSel: function(d) {
        var a = this.selectionAreas.length;
        for (var b = 0; b < a; ++b) {
            var c = this.selectionAreas[b];
            if ((d >= c.y) && (d <= c.height)) {
                return true
            }
        }
        return false
    },
    _clearSelTitle: function() {
        var a = this.selectionAreas.length;
        for (var b = 0; b < a; ++b) {
            var c = this.selectionAreas[b]
        }
    },
    clearSelection: function() {
        this._clearSelection()
    },
    _clearSelection: function(c) {
        this.currentSelection = null ;
        var a = this.selectionAreas.length;
        var d;
        for (var b = (a - 1); b >= 0; --b) {
            d = this.selectionAreas.pop();
            if (d) {
                this._internalDrawTitle(d, true, false);
                d.destroy()
            }
        }
        if (a) {
            this.selectionAreas.length = 0;
            if (c) {
                this.fireSelectionEvent()
            }
        }
    },
    _clearSelectionChangeArea: function() {
        if (this.selectionChangeArea) {
            this.selectionChangeArea.destroy();
            this.selectionChangeArea = null 
        }
    },
    _reComputeSelections: function(g, b) {
        var a = this.selectionAreas.length;
        var d;
        for (var c = 0; c < a; c++) {
            d = this.selectionAreas[c];
            if (d) {
                if (g != -1 && g <= d.height) {
                    d.setDivSize();
                    continue
                }
                if (b != -1 && b <= d.width) {
                    d.setDivSize()
                }
            }
        }
    },
    setCurrentSelection: function(a) {
        if (this.currentSelection) {
            if (!this.currentSelection.isBuild()) {
                this.currentSelection.reBuild(true)
            }
        }
        this.currentSelection = a
    },
    getCurrentSelection: function() {
        if (this.currentSelection) {
            return this.currentSelection
        } else {
            if (this.selectionAreas && this.selectionAreas.length > 0) {
                return this.selectionAreas[0]
            }
        }
    },
    mouseCellExpand: function(d) {
        var c = this.mouseCell;
        this.setCurrentCell(c, null , null , null , d.getButton());
        var b = {
            x: c.x,
            y: c.y,
            width: c.x,
            height: c.y
        };
        var a = new DNA.widget.Grid2SelectionAreaAsync(this,b,true,this.selectionDiv,true,this.showBorder);
        this._setSelection(a);
        this.setCurrentSelection(a);
        this._mouseCellExpand(d, c);
        this.fireEvent("selection", [this])
    },
    _mouseCellExpand: function(c, b) {
        var a = {
            widget: this,
            target: new DNA.widget.Point(b.x,b.y),
            lastCurrent: this.getCurrentCell()
        };
        this.fireCellExpandEvent(a)
    },
    mouseCellCheck: function(c, a) {
        var b = this.mouseCell;
        this.setCurrentCell(b, null , null , null , c.getButton());
        this.getCell(b.x, b.y).setChecked(a);
        c.widget = this;
        c.target = new DNA.widget.Point(b.x,b.y);
        c.checked = a;
        this.fireEvent("cellCheck", [c])
    },
    mouseCellCollapse: function(d) {
        var c = this.mouseCell;
        this.setCurrentCell(c, null , null , null , d.getButton());
        var b = {
            x: c.x,
            y: c.y,
            width: c.x,
            height: c.y
        };
        var a = new DNA.widget.Grid2SelectionAreaAsync(this,b,true,this.selectionDiv,true,this.showBorder);
        this._setSelection(a);
        this.setCurrentSelection(a);
        this._mouseCellCollapse(d, c);
        this.fireEvent("selection", [this])
    },
    _mouseCellCollapse: function(c, b) {
        var a = {
            widget: this,
            target: new DNA.widget.Point(b.x,b.y),
            lastCurrent: this.getCurrentCell()
        };
        this.fireCellCollapseEvent(a)
    },
    mouseCellSelectStart: function(g) {
        this.selectFinish = false;
        var a = g.isShift();
        var h = g.isCtrl();
        var b = this.mouseCell;
        this.selBeginCell = b;
        switch (this.getSelectionMode()) {
        case DNA.widget.JWTGrid2.SELECTION_MODE_MULTI:
            if ((!h && !a) || (h && a)) {
                this.setCurrentCell(b, null , null , null , g.getButton());
                var m = {
                    x: b.x,
                    y: b.y,
                    width: b.x,
                    height: b.y
                };
                var n = new DNA.widget.Grid2SelectionAreaAsync(this,m,true,this.selectionDiv,true,this.showBorder);
                this._setSelection(n);
                this.setCurrentSelection(n);
                if (this.activeEditor && this.activeEditor.control && this.activeEditor.control.isVisible()) {
                    this._hideSelectionBorder()
                } else {
                    this._showSelectionBorder()
                }
            } else {
                if (h && !a) {
                    this.setCurrentCell(b, null , null , null , g.getButton());
                    var m = {
                        x: b.x,
                        y: b.y,
                        width: b.x,
                        height: b.y
                    };
                    var n = new DNA.widget.Grid2SelectionAreaAsync(this,m,true,this.selectionDiv,true,this.showBorder);
                    this._addSelection(n);
                    this.setCurrentSelection(n);
                    if (this.selectionAreas.length > 1) {
                        this._hideSelectionBorder()
                    }
                } else {
                    if (this.selectionAreas.length === 0) {
                        this.setCurrentCell(b, null , null , null , g.getButton());
                        var m = {
                            x: b.x,
                            y: b.y,
                            width: b.x,
                            height: b.y
                        };
                        var n = new DNA.widget.Grid2SelectionAreaAsync(this,m,true,this.selectionDiv,true,this.showBorder);
                        this._setSelection(n);
                        this.setCurrentSelection(n)
                    } else {
                        var m = {
                            x: this.currentCol,
                            y: this.currentRow,
                            width: b.x,
                            height: b.y
                        };
                        var n = new DNA.widget.Grid2SelectionAreaAsync(this,m,true,null ,false,this.showBorder);
                        this._setSelection(n);
                        this.setCurrentSelection(n);
                        if (this.selectionAreas.length > 1) {
                            this._hideSelectionBorder()
                        }
                    }
                }
            }
            break;
        case DNA.widget.JWTGrid2.SELECTION_MODE_ROW:
            var m = {
                x: 1,
                y: b.y,
                width: this.columnCount - 1,
                height: b.y
            };
            if ((!h && !a) || (h && a)) {
                this.setCurrentCell(b, null , null , null , g.getButton());
                var n;
                for (var d = this.selectionAreas.length - 1; d >= 0; d--) {
                    if (this.util.rectEqual(this.selectionAreas[d], m)) {
                        n = this.selectionAreas[d];
                        this.selectionAreas.removeAt(d)
                    }
                }
                if (!n) {
                    n = new DNA.widget.Grid2SelectionAreaAsync(this,m,false,this.selectionDiv,false,this.showBorder)
                }
                this._setSelection(n);
                this.setCurrentSelection(n)
            } else {
                if (h && !a) {
                    this.setCurrentCell(b, null , null , null , g.getButton());
                    var n = new DNA.widget.Grid2SelectionAreaAsync(this,m,false,this.selectionDiv,false,this.showBorder);
                    this._addSelection(n);
                    this.setCurrentSelection(n)
                } else {
                    if (this.currentCell) {
                        var c = Math.min(this.currentRow, b.y);
                        var l = Math.max(this.currentRow, b.y);
                        for (var d = c + 1; d <= l; ++d) {
                            m = {
                                x: 1,
                                y: d,
                                width: this.columnCount - 1,
                                height: d
                            };
                            var n = new DNA.widget.Grid2SelectionAreaAsync(this,m,false,this.selectionDiv,false,this.showBorder);
                            this._addSelection(n)
                        }
                    }
                }
            }
            break;
        case DNA.widget.JWTGrid2.SELECTION_MODE_SINGLE:
            this.setCurrentCell(b, null , null , null , g.getButton());
            var m = {
                x: b.x,
                y: b.y,
                width: b.x,
                height: b.y
            };
            var n = new DNA.widget.Grid2SelectionAreaAsync(this,m,false,this.selectionDiv,true,this.showBorder);
            this._setSelection(n);
            this.setCurrentSelection(n);
            break
        }
    },
    mouseCellSelecting: function(c) {
        if (!this.currentSelection) {
            return
        }
        var d = this.getSelectionMode();
        if (d == DNA.widget.JWTGrid2.SELECTION_MODE_SINGLE || d == DNA.widget.JWTGrid2.SELECTION_MODE_ROW) {
            return
        }
        var b = this.mouseCell;
        if (b.x == this.lastMouseCell.x && b.y == this.lastMouseCell.y) {
            return
        }
        if (this.currentCol < this.hColCount) {
            this.tDiv.scrollLeft = "0px"
        }
        if (this.currentRow < this.hRowCount) {
            this.tDiv.scrollTop = "0px"
        }
        this.lastMouseCell = b;
        var a = {
            x: this.currentCol,
            y: this.currentRow,
            width: b.x,
            height: b.y
        };
        this.currentSelection._setBound(a);
        this.currentSelection.reBuild(true)
    },
    mouseCellSelectEnd: function(g) {
        if (this.selectFinish) {
            return
        }
        this.selectFinish = true;
        this.selectionDiv.style.width = "0px";
        this.selectionDiv.style.borderStyle = "none";
        this.selectionDiv.style.borderWidth = "0px";
        if (this.currentSelection) {
            if (this.getSelectionMode() != DNA.widget.JWTGrid2.SELECTION_MODE_ROW && this.currentCell) {
                var c = this.currentCell.getColIndex();
                var h = this.currentCell.getRowIndex();
                var d = c + this.currentCell.getColSpan();
                var a = h + this.currentCell.getRowSpan();
                if (this.mouseCell && (this.mouseCell.x >= c) && (this.mouseCell.y >= h) && (this.mouseCell.x < d) && (this.mouseCell.y < a)) {
                    this.fireEvent("selection", [this]);
                    return
                }
            }
            this.currentSelection.setDivSize();
            this._internalDrawTitle(this.currentSelection, false, true);
            this.fireEvent("selection", [this])
        }
    },
    mouseSelectionChangeStart: function(c) {
        var b = this.currentSelection;
        var a = new DNA.widget.Grid2SelectionChangeAreaAsync(this,b,this.selectionChangeDiv,true);
        this.selectionChangeArea = a
    },
    mouseSelectionChanging: function(d) {
        if (!this.selectionChangeArea) {
            return
        }
        var c = this.mouseCell;
        if (this.currentCol < this.hColCount) {
            this.tDiv.scrollLeft = "0px"
        }
        if (this.currentRow < this.hRowCount) {
            this.tDiv.scrollTop = "0px"
        }
        this.lastMouseCell = c;
        var b = {
            x: c.x,
            y: c.y
        };
        var a = {
            x: d.getLocation().x + this.tDiv.scrollLeft,
            y: d.getLocation().y + this.tDiv.scrollTop
        };
        this.selectionChangeArea._setBound(b, this.currentSelection, a);
        this.selectionChangeArea.redraw("dotted");
        this.dragPointDiv.style.display = "none"
    },
    mouseSelectionChangeEnd: function(d) {
        this.selectionChangeArea.destroy();
        if (this.currentSelection) {
            var c = this.currentSelection;
            var a = this.selectionChangeArea;
            var b = {
                x: a.cellX,
                y: a.cellY,
                width: a.cellWidth,
                height: a.cellHeight
            };
            b.x = (b.x == 0 ? 1 : b.x);
            b.y = (b.y == 0 ? 1 : b.y);
            b.width = (b.width == 0 ? 1 : b.width);
            b.height = (b.height == 0 ? 1 : b.height);
            this.fireEvent("selectionChange", [this, {
                x: c.x,
                y: c.y,
                width: c.width,
                height: c.height
            }, b]);
            this.currentSelection._setBound(b);
            this.currentSelection.reBuild(true);
            this.mouseCellSelectEnd()
        }
    },
    setActiveEditor: function(a) {
        if (this.activeEditor) {
            this.activeEditor.close()
        }
        this.activeEditor = a
    },
    openEditor: function(q, m, o, h, g) {
        if (!this.editorProvider || !q.td) {
            return
        }
        var l = this.editorProvider.getCellEditor(this, q);
        if (!l.control) {
            return
        }
        if (this._eidtorIsOpen(q, l)) {
            return
        }
        this._hideFace();
        this._hideSelectionBorder();
        var n = DNA.engine.DomUtil.getInnerText(q.td);
        if (!n) {
            n = ""
        }
        q.td.setAttribute("st", n);
        DNA.engine.DomUtil.setInnerText(q.td.firstChild, "");
        this.setActiveEditor(l);
        this.activeEditor.open(o, h, g);
        this.focusable = false;
        var a = {
            grid: this,
            col: this.currentCol,
            row: this.currentRow,
            showText: this.currentCell.getShowText(),
            editText: this.currentCell.getEditText()
        };
        this.fireEvent("beforeedit", [a]);
        if (m && m.getKeyCode()) {
            var b = m.getKeyCode();
            var p = String.fromCharCode(b);
            var d = l.getText();
            var c = d + p;
            l.setText(c)
        }
    },
    _eidtorIsOpen: function(a, b) {
        return this._getPermanentHolder(a.colIndex, a.rowIndex) == b.control.getEl().parentNode
    },
    openControl: function(a, d, b) {
        if (!this.controlProvider) {
            return
        }
        var c = this.controlProvider.getCellControl(this, a, b);
        if (!c) {
            return
        }
        if (d) {
            if (this._getPermanentHolder(a.colIndex, a.rowIndex) == c.control.getEl().parentNode) {
                return
            }
        }
        c.open()
    },
    openControlByCellPosition: function(a) {
        var c = new DNA.widget.AbstractGridCellAsync(this,null ,a.i,a.j,false);
        var b = a.eid;
        this.removeControl(a.i, a.j);
        this.controlCells.push({
            x: a.i,
            y: a.j,
            eid: a.eid
        });
        this.openControl(c, true, b)
    },
    setCellEditorProvider: function(a) {
        this.editorProvider = a
    },
    setCellControlProvider: function(a) {
        this.controlProvider = a
    },
    closeEditor: function(h) {
        this.focusable = true;
        if (!this.currentCell) {
            this.activeEditor = null 
        }
        if (this.activeEditor) {
            var d = this.activeEditor.getResult(h ? h : 0);
            if (!d) {
                var c = this.currentCell.getShowText();
                this.activeEditor.close();
                this.activeEditor = null ;
                var a = this.getCell(this.currentCell.getColIndex(), this.currentCell.getRowIndex());
                a.setShowText(c, true);
                return
            }
            var b = d.getShowText();
            var l = d.getEditText();
            var m = {
                grid: this,
                col: this.currentCol,
                row: this.currentRow,
                showText: b,
                editText: l
            };
            this.fireEvent("afteredit", [m]);
            this.activeEditor.close();
            var a = this.getCell(this.currentCell.getColIndex(), this.currentCell.getRowIndex());
            a.setEditText(m.editText ? m.editText : "", true);
            var g = this.getFormattedText(a);
            if (g) {
                a.setShowText(g, true)
            } else {
                a.setShowText(m.showText ? m.showText : "", true)
            }
            a.setFitFontSize();
            this.fireDataChangeEvent({
                x: this.currentCol,
                y: this.currentRow,
                width: this.currentCol,
                height: this.currentRow
            }, DNA.widget.JWTGrid2.DATACHANGE_INPUT);
            this.activeEditor = null 
        }
    },
    getFormattedText: function(a) {
        try {
            var b = this.formatterMgr.getFormatter(a.getFormatter());
            if (b) {
                return b.format(a.getEditText())
            }
        } catch (c) {
            return null 
        }
    },
    ensureEditorClose: function(a, b) {
        if (!this.currentCell && this.activeEditor) {
            this.activeEditor.close();
            this.activeEditor = null ;
            return true
        }
        if (this.activeEditor && this.currentCell) {
            if (a.getRowIndex() == this.currentCell.getRowIndex() && a.getColIndex() == this.currentCell.getColIndex()) {
                if (!this.activeEditor.getCloseFlag()) {
                    if (b) {
                        this.closeEditor()
                    }
                    return false
                }
            }
        }
        return true
    },
    reInitEditor: function(a) {
        if (!this.currentCell) {
            this.activeEditor = null ;
            return
        }
        if (this.activeEditor) {
            if (a.getRowIndex() == this.currentCell.getRowIndex() && a.getColIndex() == this.currentCell.getColIndex()) {
                this.activeEditor.initEditor(-1)
            }
        }
    },
    processAddControl: function() {
        if (this.getData("add_control")) {
            var b = this.getData("add_control");
            if (b) {
                for (var a = 0; a < b.length; a++) {
                    this.openControlByCellPosition(b[a])
                }
            }
            this.removeData("add_control")
        }
    },
    removeControl: function(b, h) {
        var a;
        for (var c = 0; c < this.controlCells.length; c++) {
            if (this.controlCells[c].x == b && this.controlCells[c].y == h) {
                a = this.controlCells[c].eid;
                this.controlCells.removeAt(c);
                break
            }
        }
        var g = new DNA.widget.AbstractGridCellAsync(this,null ,b,h,false);
        if (a) {
            var d = DNA.widget.WidgetRegistry.get(a);
            d.setBounds(0, 0, 0, 0);
            this.getEl().appendChild(d.getEl())
        }
    },
    _autoScroll: function(g) {
        var r = g.getLocation();
        var b = this.tDiv.scrollHeight;
        var h = this.tDiv.scrollWidth;
        var n = DNA.engine.DomUtil.getClientSize(this.tDiv);
        var p = DNA.engine.DomUtil.getSize(this.frTable);
        var q = DNA.engine.DomUtil.getSize(this.hrTable);
        var c = DNA.engine.DomUtil.getSize(this.fcTable);
        var o = DNA.engine.DomUtil.getSize(this.hcTable);
        var a = 100;
        var m = 80;
        var d = 30;
        var l = 30;
        if (n.width - c.width - r.x < a) {
            if (this.tDiv.scrollLeft + n.width + m <= h) {
                this.tDiv.scrollLeft += (m)
            } else {
                this.tDiv.scrollLeft = h - n.width
            }
        }
        if (r.x - o.width < a) {
            if (this.tDiv.scrollLeft - m >= 0) {
                this.tDiv.scrollLeft -= (m)
            } else {
                this.tDiv.scrollLeft = 0
            }
        }
        if (n.height - p.height - r.y < d) {
            if (this.tDiv.scrollTop + n.height + l <= b) {
                this.tDiv.scrollTop += (l)
            } else {
                this.tDiv.scrollTop = b - n.height
            }
        }
        if (r.y - q.height < d) {
            if (this.tDiv.scrollTop - l >= 0) {
                this.tDiv.scrollTop -= (l)
            } else {
                this.tDiv.scrollTop = 0
            }
        }
    },
    setShowSelectingBorder: function(a) {
        this.showBorder = a;
        if (!a) {
            this._hideSelectionBorder()
        }
    },
    synchronizeData: function() {
        if (this.activeEditor) {
            var c = this.activeEditor.getResult();
            var b = c.getShowText();
            var d = c.getEditText();
            var a = this.getCell(this.currentCell.getColIndex(), this.currentCell.getRowIndex());
            a.setShowText(b ? b : "", true, true);
            a.setEditText(d ? d : "", true);
            this.fireDataChangeEvent({
                x: this.currentCol,
                y: this.currentRow,
                width: this.currentCol,
                height: this.currentRow
            }, DNA.widget.JWTGrid2.DATACHANGE_INPUT)
        }
    },
    synDataNoFire: function() {
        if (this.activeEditor) {
            var c = this.activeEditor.getResult();
            var b = c.getShowText();
            var d = c.getEditText();
            var a = this.getCell(this.currentCell.getColIndex(), this.currentCell.getRowIndex());
            a.setShowText(b ? b : "", true, true);
            a.setEditText(d ? d : "", true);
            this.fireDataChangeEvent({
                x: this.currentCol,
                y: this.currentRow,
                width: this.currentCol,
                height: this.currentRow
            }, DNA.widget.JWTGrid2.DATACHANGE_INPUT, true)
        }
    },
    synDataToCellProperty: function() {
        if (this.activeEditor) {
            var c = this.activeEditor.getResult();
            var b = c.getShowText();
            var d = c.getEditText();
            var a = this.getCell(this.currentCell.getColIndex(), this.currentCell.getRowIndex());
            a.setShowText(b ? b : "", true, true);
            a.setEditText(d ? d : "", true)
        }
    },
    insertRowHtml: function(c, a) {
        if (c <= 1 || c > this.rowCount) {
            return
        }
        var b = this.tDiv.childNodes[c];
        b.insertAdjacentElement("afterEnd", a)
    },
    replaceRowHtml: function(c, a) {
        if (c <= 1 || c >= this.rowCount) {
            return
        }
        var b = this.tDiv.childNodes[c];
        b.insertAdjacentElement("afterEnd", a);
        b.replaceNode(this.tDiv.childNodes[c + 1])
    },
    fireDataChangeEvent: function(c, b, a) {
        this.fireEvent("datachange", [this, c, b, a])
    },
    fireSelectionEvent: function() {
        this.fireEvent("selection", [this])
    },
    fireCurrentCellChangedEvent: function() {
        this.fireEvent("currentCellChanged", [this])
    },
    fireCurrentCellChangingEvent: function(a) {
        this.fireEvent("currentCellChanging", [a])
    },
    fireCellExpandEvent: function(a) {
        this.fireEvent("cellExpand", [a])
    },
    fireCellCollapseEvent: function(a) {
        this.fireEvent("cellCollapse", [a])
    },
    firePagingEvent: function(a) {
        this.fireEvent("paging", [a])
    },
    _internalDrawTitle: function(o, l, b) {
        if (!this.checkRendered(true)) {
            return
        }
        var c = o.x;
        var p = o.width;
        var n = o.y;
        var a = o.height;
        var q;
        var m = this._getRowDom(0, this.hrTable);
        for (var g = c; g <= p; ++g) {
            if (!l || !this._colInCurSel(g)) {
                q = this._getRowCell(m, g, 0);
                if (q) {
                    if (b) {
                        q.style.backgroundColor = this._selTitleBackColor;
                        q.style.borderColor = this._selTitleBorderColor
                    } else {
                        var h = q.getAttribute("bgc");
                        if (!h) {
                            h = ""
                        }
                        var d = q.getAttribute("rbc");
                        if (!d) {
                            d = ""
                        }
                        var r = q.getAttribute("bbc");
                        if (!r) {
                            r = ""
                        }
                        q.style.backgroundColor = h;
                        q.style.borderRightColor = d;
                        q.style.borderBottomColor = r;
                        q.style.borderLeftColor = "";
                        q.style.borderTopColor = ""
                    }
                }
                if (g < this.hColCount) {
                    q = this._getCellDom(g, 0, this.hltTab);
                    if (q) {
                        if (b) {
                            q.style.backgroundColor = this._selTitleBackColor;
                            q.style.borderColor = this._selTitleBorderColor
                        } else {
                            var h = q.getAttribute("bgc");
                            if (!h) {
                                h = ""
                            }
                            var d = q.getAttribute("rbc");
                            if (!d) {
                                d = ""
                            }
                            var r = q.getAttribute("bbc");
                            if (!r) {
                                r = ""
                            }
                            q.style.backgroundColor = h;
                            q.style.borderRightColor = d;
                            q.style.borderBottomColor = r;
                            q.style.borderLeftColor = "";
                            q.style.borderTopColor = ""
                        }
                    }
                }
            }
        }
        for (var g = n; g <= a; ++g) {
            if (!l || !this._rowInCurSel(g)) {
                q = this._getCellDom(0, g, this.hcTable);
                if (q) {
                    if (b) {
                        q.style.backgroundColor = this._selTitleBackColor;
                        q.style.borderColor = this._selTitleBorderColor
                    } else {
                        var h = q.getAttribute("bgc");
                        if (!h) {
                            h = ""
                        }
                        var d = q.getAttribute("rbc");
                        if (!d) {
                            d = ""
                        }
                        var r = q.getAttribute("bbc");
                        if (!r) {
                            r = ""
                        }
                        q.style.backgroundColor = h;
                        q.style.borderRightColor = d;
                        q.style.borderBottomColor = r;
                        q.style.borderLeftColor = "";
                        q.style.borderTopColor = ""
                    }
                }
                if (g < this.hRowCount) {
                    q = this._getCellDom(0, g, this.hltTab);
                    if (q) {
                        if (b) {
                            q.style.backgroundColor = this._selTitleBackColor;
                            q.style.borderColor = this._selTitleBorderColor
                        } else {
                            var h = q.getAttribute("bgc");
                            if (!h) {
                                h = ""
                            }
                            var d = q.getAttribute("rbc");
                            if (!d) {
                                d = ""
                            }
                            var r = q.getAttribute("bbc");
                            if (!r) {
                                r = ""
                            }
                            q.style.backgroundColor = h;
                            q.style.borderRightColor = d;
                            q.style.borderBottomColor = r;
                            q.style.borderLeftColor = "";
                            q.style.borderTopColor = ""
                        }
                    }
                }
            }
        }
    },
    ensureHAndW: function(h) {
        if (!h) {
            return
        }
        var n = h.getRowIndex();
        var b = h.getColIndex();
        var d = this.util.getRowAutoHeight(n);
        var a = this.util.getColAutoWidth(b);
        if (d) {
            var l = 0;
            for (var c = 0; c < this.columnCount; ) {
                var g = new DNA.widget.AbstractGridCellAsync(this,this.tDiv,c,n,false);
                var m = DNA.engine.DomUtil.computeTextSize(h.getShowText(), h.getFont());
                if (m.height > l) {
                    l = m.height
                }
                c += g.getColSpan()
            }
            this.setRowHeight(n, l)
        }
    },
    _focusDom: function(a) {
        if (DNA.engine.Client.isIE() && this.tDiv && this.tDiv.ownerDocument.activeElement == this.inputProxy) {
            return
        }
        if (this.tDiv && DNA.engine.Client.isFF()) {
            this.tDiv.focus()
        }
        this._focusInputProxy()
    },
    getScrollTop: function() {
        return this.tDiv.scrollTop
    },
    getScrollLeft: function() {
        return this.tDiv.scrollLeft
    },
    setScrollTop: function(a) {
        this.tDiv.scrollTop = Math.max(0, a)
    },
    setScrollLeft: function(a) {
        return this.tDiv.scrollLeft = Math.max(0, a)
    },
    getClientHeight: function() {
        return this.tDiv.clientHeight
    },
    updateControlCellListAfterRowChange: function(b, a, d) {
        var h;
        var g;
        if (b != null  && b.size() > 0) {
            if (d > 0) {
                for (var c = 0; c < b.size(); c++) {
                    if (b[c].y >= a) {
                        b[c].y += d
                    }
                }
            } else {
                if (d < 0) {
                    h = [];
                    for (c = 0; c < b.size(); c++) {
                        g = b[c];
                        if (g.y >= a) {
                            if (g.y >= a - d) {
                                g.y += d;
                                h.push(g)
                            }
                        } else {
                            h.push(g)
                        }
                    }
                    b = h
                }
            }
        }
        return b
    },
    updateControlCellListAfterColChange: function(b, a, d) {
        var h;
        var g;
        if (b != null  && b.size() > 0) {
            if (d > 0) {
                for (var c = 0; c < b.size(); c++) {
                    if (b[c].x >= a) {
                        b[c].x += d
                    }
                }
            } else {
                if (d < 0) {
                    h = [];
                    for (c = 0; c < b.size(); c++) {
                        g = b[c];
                        if (g.x >= a) {
                            if (g.x >= a - d) {
                                g.x += d;
                                h.push(g)
                            }
                        } else {
                            h.push(g)
                        }
                    }
                    b = h
                }
            }
        }
        return b
    },
    _getScrollElement: function() {
        return this.tDiv
    },
    _showEditor: function() {
        if (this.currentCell) {
            var b = this.currentCell.getColIndex();
            var g = this.currentCell.getRowIndex();
            if (!(this.getEditMode() != DNA.widget.JWTGrid2.EDIT_MODE_READONLY) && this.util.isCellEditable(b, g)) {
                return
            }
            var a = new DNA.widget.AbstractGridCellAsync(this,null ,b,g,false);
            if (!this.editorProvider) {
                return
            }
            var c = this.editorProvider.getCellEditor(this, a);
            if (!c.control) {
                return
            }
            if (this._eidtorIsOpen(a, c)) {
                return
            }
            this._hideFace();
            this._hideSelectionBorder();
            var d = DNA.engine.DomUtil.getInnerText(a.td);
            if (!d) {
                d = ""
            }
            a.td.setAttribute("st", d);
            if (DNA.engine.Client.isFF() && a.td.getAttribute("wl")) {
                DNA.engine.DomUtil.setInnerText(a.td.firstChild, "")
            } else {
                DNA.engine.DomUtil.setInnerText(a.td, "")
            }
            this.setActiveEditor(c);
            this.activeEditor.open(false, null , null , true);
            this.focusable = false
        }
    },
    _hideEditor: function() {
        this.focusable = true;
        if (!this.currentCell) {
            this.activeEditor = null 
        }
        if (this.activeEditor) {
            this.activeEditor.close();
            this.activeEditor = null 
        }
    },
    _scrollToCol: function(c) {
        if (!this.checkRendered(true)) {
            return
        }
        if (c <= 0 || c >= this.columnCount) {
            return
        }
        if (c < this.hColCount) {
            return
        }
        var h = this.tDiv.clientWidth;
        var b = this.hcDiv.clientWidth;
        var a = this.fcDiv.clientWidth;
        var g = this.tDiv.scrollLeft;
        var d = this.util.getColOffsetLeft(c);
        if (h + g - a < d + this.getColumnWidth(c)) {
            this.tDiv.scrollLeft = d - h + a + this.getColumnWidth(c)
        } else {
            if (g + b > d) {
                this.tDiv.scrollLeft = Math.max(d - b, 0)
            }
        }
    },
    _scrollToRow: function(h) {
        if (!this.checkRendered(true)) {
            return
        }
        if (h <= 0 || h >= this.rowCount) {
            return
        }
        if (h < this.hRowCount) {
            return
        }
        var b = this.tDiv.clientHeight;
        var a = this.hrDiv.clientHeight;
        var c = this.frDiv.clientHeight;
        var g = this.tDiv.scrollTop;
        var d = this.util.getRowOffsetTop(h);
        if (b + g - c < d + this.getRowHeight(h)) {
            this.tDiv.scrollTop = d - b + c + this.getRowHeight(h)
        } else {
            if (g + a > d) {
                this.tDiv.scrollTop = Math.max(d - a, 0)
            }
        }
    },
    fullUpdateNoIframe: function(a) {
        this.tDiv.innerHTML = a;
        this._replaceDom()
    },
    setRenderedTop: function(a) {
        this.renderedTop = a
    },
    setRenderedCount: function(a) {
        this.renderedCount = a
    },
    getUpTakenRowHeight: function() {
        return parseInt(this.utrs[1].style.height, 10)
    },
    setUpTakenRowHeight: function(a) {
        this._removeAllCellHTML();
        this._setUpTakenRowHeight(a);
        this._placeAllCellHTML()
    },
    _setUpTakenRowHeight: function(a) {
        for (var b = 0; b < this.utrs.length; b++) {
            if (this.utrs[b]) {
                this.utrs[b].style.height = this._getPXSize(a)
            }
        }
    },
    getDownTakenRowHeight: function() {
        return parseInt(this.dtrs[1].style.height, 10)
    },
    setDownTakenRowHeight: function(a) {
        for (var b = 0; b < this.dtrs.length; b++) {
            if (this.dtrs[b]) {
                this.dtrs[b].style.height = this._getPXSize(a)
            }
        }
    },
    replaceLoadHtml: function(b, c, a) {
        this._replaceHtml(this.tDiv, c);
        this._replaceHtml(this.hcDiv.firstChild, b);
        this._replaceHtml(this.fcDiv.firstChild, a);
        this._buildTakenDiv();
        this._adjustRowDomWidth()
    },
    _replaceHtml: function(b, a) {
        var c = document.createElement("div");
        DNA.engine.DomUtil.append(c, b.firstChild.cloneNode(false).outerHTML);
        DNA.engine.DomUtil.append(c, a);
        DNA.engine.DomUtil.append(c, b.lastChild.cloneNode(false).outerHTML);
        b.innerHTML = c.innerHTML;
        b.zoom = 1
    },
    _getPermanentHolder: function(c, a) {
        var b;
        if (c < this.getHeaderColumnCount()) {
            if (a < this.getHeaderRowCount()) {
                b = this.hltDiv
            } else {
                if (a >= this.getHeaderRowCount() && a < this.getRowCount() - this.getFooterRowCount()) {
                    b = this.hccwDiv
                } else {
                    b = this.flbDiv
                }
            }
        } else {
            if (c >= this.getHeaderColumnCount() && c < this.getColumnCount() - this.getFooterColumnCount()) {
                if (a < this.getHeaderRowCount()) {
                    b = this.hrDiv
                } else {
                    if (a >= this.getHeaderRowCount() && a < this.getRowCount() - this.getFooterRowCount()) {
                        b = this.cwDiv
                    } else {
                        b = this.frDiv
                    }
                }
            } else {
                if (a < this.getHeaderRowCount()) {
                    b = this.frtDiv
                } else {
                    if (a >= this.getHeaderRowCount() && a < this.getRowCount() - this.getFooterRowCount()) {
                        b = this.fcDiv
                    } else {
                        b = this.frbDiv
                    }
                }
            }
        }
        return b
    },
    _hasVScroll: function() {
        var b = false
          , l = false;
        var h = 0, d, c;
        var a = this.tDiv.clientWidth
          , g = this.tDiv.clientHeight;
        for (d = 0,
        c = this.getColumnCount(); d < c; d++) {
            if (!this.getColHidden(d)) {
                h += this.getColumnWidth(d)
            }
            if (h > a) {
                b = true;
                break
            }
        }
        h = 0;
        g = b ? g - 17 : g;
        for (d = 0,
        c = this.getRowCount(); d < c; d++) {
            if (!this.getRowHidden(d)) {
                h += this.getRowHeight(d)
            }
            if (h > g) {
                l = true;
                break
            }
        }
        return l
    },
    _hasHScroll: function() {
        var b = false
          , l = false;
        var h = 0, d, c;
        var a = this.tDiv.clientWidth
          , g = this.tDiv.clientHeight;
        for (d = 0,
        c = this.getRowCount(); d < c; d++) {
            if (!this.getRowHidden(d)) {
                h += this.getRowHeight(d)
            }
            if (h > g) {
                l = true;
                break
            }
        }
        h = 0;
        a = l ? a - 17 : a;
        for (d = 0,
        c = this.getColumnCount(); d < c; d++) {
            if (!this.getColHidden(d)) {
                h += this.getColumnWidth(d)
            }
            if (h > a) {
                b = true;
                break
            }
        }
        return b
    },
    _resizeMergeDiv: function(l) {
        if (l) {
            var a = parseInt(l.getAttribute("ri"), 10);
            var d = parseInt(l.getAttribute("ci"), 10);
            var b = parseInt(l.getAttribute("rs"), 10);
            var g = parseInt(l.getAttribute("cs"), 10);
            var h = DNA.engine.Client.isIE() ? 0 : 5;
            var c = DNA.engine.Client.isIE() ? 0 : 1;
            DNA.engine.DomUtil.setSize(l, {
                width: this.getColumnWidthCount(d, d + g) - h,
                height: this.getRowHeightCount(a, a + b) - c
            });
            DNA.engine.DomUtil.setLeftTop(l, this.getColumnWidthCount(0, d), this.getRowHeightCount(0, a))
        }
    },
    _reRenderMergeDiv: function(l) {
        var o = parseInt(l.getAttribute("ri"), 10);
        var p = parseInt(l.getAttribute("ci"), 10);
        var c = parseInt(l.getAttribute("rs"), 10);
        var g = parseInt(l.getAttribute("cs"), 10);
        var b = l.style.left;
        var m = l.style.width;
        var a = l.style.top;
        var h = l.style.height;
        var n = this.getCell(p, o);
        if (n.td) {
            l.setAttribute("style", n.td.getAttribute("style"));
            l.style.height = h;
            l.style.left = b;
            l.style.width = m;
            l.style.top = a;
            l.innerHTML = n.td.innerHTML;
            n.reVertTextInMergeDiv(l);
            var d = this._getRowBackground(o);
            if (d) {
                l.style.backgroundColor = d
            }
        }
    },
    _reRenderMergeDivs: function() {
        for (var a = 0; a < this.mergeDivs.length; a++) {
            this._reRenderMergeDiv(this.mergeDivs[a])
        }
    },
    _getPXSize: function(a) {
        return Math.max(a, 0) + "px"
    },
    setCurrentCellColor: function(b, a) {
        this.currentCellColorFocused = b;
        this.currentCellColorUnFocused = a;
        this.updateCurrentCellColor()
    },
    updateCurrentCellColor: function() {
        if (this.currentCellColorFocused === null  || this.currentCellColorUnFocused === null ) {
            return
        }
        var a;
        var c = [this.curLeft, this.curRight, this.curBottom, this.curTop];
        if (DNA.engine.DomUtil.hasClass(this.el, "focus")) {
            a = this.currentCellColorFocused
        } else {
            a = this.currentCellColorUnFocused
        }
        for (var b = 0; b < c.length; b++) {
            c[b].style.backgroundColor = a
        }
    }
});
Object.override(DNA.widget.Grid2Async.prototype, {
    jtype: "Grid2Async",
    focusable: true
});
DNA.widget.Grid2SelectionAreaAsync = function(c, g, b, h, d, a) {
    this.grid = c;
    this.div = null ;
    this._setBound(g);
    this.computeFlag = b;
    this.showBorder = a;
    this.ranges = new Array();
    this.divs = new Array();
    this.marks = new Array();
    this.gridDivs = [this.grid.hltDiv, this.grid.hcDiv.childNodes[1].firstChild, this.grid.hrDiv];
    this.markType = {
        LT: 0,
        T: 1,
        L: 2,
        M: 3
    };
    if (b) {
        this.calculateRange()
    }
    if (h) {
        this.div = h
    } else {
        if (!(this.y == this.height && this.x == this.width)) {
            this.createDiv()
        }
    }
    if (!d) {
        this.setDivSize()
    }
}
;
Object.override(DNA.widget.Grid2SelectionAreaAsync.prototype, {
    getRange: function() {
        return {
            x: this.x,
            y: this.y,
            width: this.width,
            height: this.height
        }
    },
    _setBound: function(a) {
        this.y = a.y <= a.height ? a.y : a.height;
        this.height = a.y <= a.height ? a.height : a.y;
        this.x = a.x <= a.width ? a.x : a.width;
        this.width = a.x <= a.width ? a.width : a.x
    },
    isBuild: function() {
        return this.buildFlag
    },
    createDiv: function() {
        this.buildFlag = true;
        this.div = null ;
        this.dragPoint = null ;
        var a = this.grid.hColCount;
        var h = this.grid.hRowCount;
        var o = this.grid.columnCount - 1;
        var m = this.grid.rowCount - 1;
        var l = {
            x: this.x,
            y: this.y,
            width: this.width,
            height: this.height
        };
        var q = "1px";
        var n = "1px";
        if (DNA.engine.Client.isIE() && !DNA.engine.Client.isStrict()) {
            q = "5px";
            n = "5px"
        }
        var p = "<div class='select_area_div2Async' unselectable='on' >";
        p += "</div>";
        if (DNA.engine.Client.isIE() && DNA.engine.Client.getBrowserVersion() < 7) {
            p = "<div class='select_area_div2_IE6Async' unselectable='on'></div>"
        }
        var b = this._getRectIntersection(l, {
            x: a,
            y: h,
            width: o,
            height: m
        });
        if (b) {
            this.ranges.push(b);
            this.marks.push(this.markType.M);
            this.dragPoint = DNA.engine.DomUtil.insertAfter(this.grid.cwDiv.lastChild, p);
            this.divs.push(this.grid.cwDiv.lastChild)
        }
        var c = this._getRectIntersection(l, {
            x: 1,
            y: h,
            width: a - 1,
            height: m
        });
        if (c) {
            this.ranges.push(c);
            this.marks.push(this.markType.L);
            this.dragPoint = DNA.engine.DomUtil.insertAfter(this.grid.hcDiv.childNodes[1].firstChild.lastChild, p);
            this.divs.push(this.grid.hcDiv.childNodes[1].firstChild.lastChild)
        }
        var d = this._getRectIntersection(l, {
            x: a,
            y: 1,
            width: o,
            height: h - 1
        });
        if (d) {
            this.ranges.push(d);
            this.marks.push(this.markType.T);
            this.dragPoint = DNA.engine.DomUtil.insertAfter(this.grid.hrDiv.lastChild, p);
            this.divs.push(this.grid.hrDiv.lastChild)
        }
        var g = this._getRectIntersection(l, {
            x: 1,
            y: 1,
            width: a - 1,
            height: h - 1
        });
        if (g) {
            this.ranges.push(g);
            this.marks.push(this.markType.LT);
            this.dragPoint = DNA.engine.DomUtil.insertAfter(this.grid.hltDiv.lastChild, p);
            this.divs.push(this.grid.hltDiv.lastChild)
        }
    },
    _getRectIntersection: function(d, c) {
        if (d.width < c.x || c.width < d.x) {
            return null 
        }
        var b = d.x > c.x ? d.x : c.x;
        var g = d.width > c.width ? c.width : d.width;
        if (d.height < c.y || c.height < d.y) {
            return null 
        }
        var h = d.y > c.y ? d.y : c.y;
        var a = d.height > c.height ? c.height : d.height;
        return {
            x: b,
            y: h,
            width: g,
            height: a
        }
    },
    setDivSize: function(u) {
        if ((this.x == this.width) && (this.y == this.height)) {
            return
        }
        if (this.div != null ) {
            var s = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,this.x,this.y,!this.computeFlag);
            var G = s.getLeft();
            var c = s.getTop();
            var q = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,this.width,this.height,!this.computeFlag);
            var F = q.getLeft();
            var b = q.getTop();
            var v = F - G + q.getWidth();
            var r = b - c + q.getHeight();
            this.setDiv(this.div, G, c, v, r);
            return
        }
        var E = this.ranges.length;
        for (var C = 0; C < E; ++C) {
            var p = this.ranges[C];
            var s = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,p.x,p.y,!this.computeFlag);
            var G = s.getLeft();
            var c = s.getTop();
            var q = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,p.width,p.height,!this.computeFlag);
            var F = q.getLeft();
            var b = q.getTop();
            var v = F - G + q.getWidth();
            var r = b - c + q.getHeight();
            if (u) {
                this.divs[C].style.zIndex = u
            }
            this.setDiv(this.divs[C], G, c, v, r, this.marks[C], p)
        }
        if (this.showBorder && (this.grid.selectionAreas.length === 1)) {
            var d = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,this.x,this.y,!this.computeFlag);
            var z = d.getLeft();
            var o = d.getTop();
            var B = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,this.width,this.height,!this.computeFlag);
            var A = B.getLeft();
            var m = B.getTop();
            var n = A - z + B.getWidth();
            var D = m - o + B.getHeight();
            var g = z + n - 4;
            var a = o + D - 4;
            var H = this._getDragPointDiv();
            H.style.display = "block";
            DNA.engine.DomUtil.setLeftTop(H, g, a)
        }
    },
    setDiv: function(a, n, m, b, p, h, d) {
        var o = ((DNA.engine.Client.isIE() && !DNA.engine.Client.isStrict()) ? b : b - 2);
        var g = ((DNA.engine.Client.isIE() && !DNA.engine.Client.isStrict()) ? p : p - 2);
        DNA.engine.DomUtil.setSize(a, {
            width: o,
            height: g
        });
        DNA.engine.DomUtil.setLeftTop(a, n, m);
        if (this.showBorder && (this.grid.selectionAreas.length === 1)) {
            var l = m - 1;
            var c = n - 1;
            if (h == this.markType.LT) {
                this.selBorderLeft = this.grid.hltDiv.childNodes[6];
                this.selBorderRight = this.grid.hltDiv.childNodes[7];
                this.selBorderTop = this.grid.hltDiv.childNodes[8];
                this.selBorderBottom = this.grid.hltDiv.childNodes[9];
                this.selBorderLeft.style.display = "block";
                this.selBorderTop.style.display = "block";
                this.selBorderRight.style.display = "none";
                this.selBorderBottom.style.display = "none";
                DNA.engine.DomUtil.setLeftTop(this.selBorderLeft, c, l);
                DNA.engine.DomUtil.setHeight(this.selBorderLeft, p);
                DNA.engine.DomUtil.setLeftTop(this.selBorderTop, c, l);
                DNA.engine.DomUtil.setWidth(this.selBorderTop, b);
                if (d.width < this.grid.hColCount - 1 || d.width == this.width) {
                    this.selBorderRight.style.display = "block";
                    DNA.engine.DomUtil.setLeftTop(this.selBorderRight, c + b - 1, l);
                    DNA.engine.DomUtil.setHeight(this.selBorderRight, p)
                }
                if (d.height < this.grid.hRowCount - 1 || d.height == this.height) {
                    this.selBorderBottom.style.display = "block";
                    DNA.engine.DomUtil.setLeftTop(this.selBorderBottom, c, l + p - 1);
                    DNA.engine.DomUtil.setWidth(this.selBorderBottom, b)
                }
            } else {
                if (h == this.markType.L) {
                    this.selBorderLeft = this.grid.hccwDiv.childNodes[6];
                    this.selBorderRight = this.grid.hccwDiv.childNodes[7];
                    this.selBorderTop = this.grid.hccwDiv.childNodes[8];
                    this.selBorderBottom = this.grid.hccwDiv.childNodes[9];
                    this.selBorderLeft.style.display = "block";
                    this.selBorderBottom.style.display = "block";
                    this.selBorderRight.style.display = "none";
                    this.selBorderTop.style.display = "none";
                    DNA.engine.DomUtil.setLeftTop(this.selBorderLeft, c, l);
                    DNA.engine.DomUtil.setHeight(this.selBorderLeft, p);
                    DNA.engine.DomUtil.setLeftTop(this.selBorderBottom, c, l + p - 1);
                    DNA.engine.DomUtil.setWidth(this.selBorderBottom, b);
                    if (d.width < this.grid.hColCount - 1 || d.width == this.width) {
                        this.selBorderRight.style.display = "block";
                        DNA.engine.DomUtil.setLeftTop(this.selBorderRight, c + b - 1, l);
                        DNA.engine.DomUtil.setHeight(this.selBorderRight, p)
                    }
                    if (d.y > this.grid.hRowCount || d.y == this.y) {
                        this.selBorderTop.style.display = "block";
                        DNA.engine.DomUtil.setLeftTop(this.selBorderTop, c, l);
                        DNA.engine.DomUtil.setWidth(this.selBorderTop, b)
                    }
                } else {
                    if (h == this.markType.T) {
                        this.selBorderLeft = this.grid.hrDiv.childNodes[6];
                        this.selBorderRight = this.grid.hrDiv.childNodes[7];
                        this.selBorderTop = this.grid.hrDiv.childNodes[8];
                        this.selBorderBottom = this.grid.hrDiv.childNodes[9];
                        this.selBorderRight.style.display = "block";
                        this.selBorderTop.style.display = "block";
                        this.selBorderBottom.style.display = "none";
                        this.selBorderLeft.style.display = "none";
                        DNA.engine.DomUtil.setLeftTop(this.selBorderTop, c, l);
                        DNA.engine.DomUtil.setWidth(this.selBorderTop, b);
                        DNA.engine.DomUtil.setLeftTop(this.selBorderRight, c + b - 1, l);
                        DNA.engine.DomUtil.setHeight(this.selBorderRight, p);
                        if (d.height < this.grid.hRowCount - 1 || d.height == this.height) {
                            this.selBorderBottom.style.display = "block";
                            DNA.engine.DomUtil.setLeftTop(this.selBorderBottom, c, l + p - 1);
                            DNA.engine.DomUtil.setWidth(this.selBorderBottom, b)
                        }
                        if (d.x > this.grid.hColCount || d.x == this.x) {
                            this.selBorderLeft.style.display = "block";
                            DNA.engine.DomUtil.setLeftTop(this.selBorderLeft, c, l);
                            DNA.engine.DomUtil.setHeight(this.selBorderLeft, p)
                        }
                    } else {
                        this.selBorderLeft = this.grid.mSelBorderLeft;
                        this.selBorderRight = this.grid.mSelBorderRight;
                        this.selBorderTop = this.grid.mSelBorderTop;
                        this.selBorderBottom = this.grid.mSelBorderBottom;
                        this.selBorderRight.style.display = "block";
                        this.selBorderBottom.style.display = "block";
                        this.selBorderLeft.style.display = "none";
                        this.selBorderTop.style.display = "none";
                        DNA.engine.DomUtil.setLeftTop(this.selBorderRight, c + b - 1, l);
                        DNA.engine.DomUtil.setHeight(this.selBorderRight, p);
                        DNA.engine.DomUtil.setLeftTop(this.selBorderBottom, c, l + p - 1);
                        DNA.engine.DomUtil.setWidth(this.selBorderBottom, b);
                        if (!d || d.x > this.grid.hColCount || d.x == this.x) {
                            this.selBorderLeft.style.display = "block";
                            DNA.engine.DomUtil.setLeftTop(this.selBorderLeft, c, l);
                            DNA.engine.DomUtil.setHeight(this.selBorderLeft, p)
                        }
                        if (!d || d.y > this.grid.hRowCount || d.y == this.y) {
                            this.selBorderTop.style.display = "block";
                            DNA.engine.DomUtil.setLeftTop(this.selBorderTop, c, l);
                            DNA.engine.DomUtil.setWidth(this.selBorderTop, b)
                        }
                    }
                }
            }
        }
    },
    _getDragPointDiv: function() {
        var c = {
            width: 0,
            height: 0
        };
        var b = this.markType.M;
        for (var a = 0; a < this.divs.length; a++) {
            if ((this.ranges[a].width + this.ranges[a].height) > (c.width + c.height)) {
                c = this.ranges[a];
                b = this.marks[a]
            }
        }
        if (b == this.markType.LT) {
            return this.grid.hltDiv.childNodes[5]
        } else {
            if (b == this.markType.L) {
                return this.grid.hccwDiv.childNodes[5]
            } else {
                if (b == this.markType.T) {
                    return this.grid.hrDiv.childNodes[5]
                } else {
                    return this.grid.mDragPointDiv
                }
            }
        }
    },
    destroy: function() {
        if (this.div != null ) {
            this.div.style.width = "0px";
            this.div = null 
        }
        var a = this.divs.length;
        for (var b = 0; b < a; ++b) {
            var c = this.divs[b];
            c.parentNode.removeChild(c)
        }
        this.ranges.length = 0;
        this.marks.length = 0;
        this.divs.length = 0;
        this.hideSelectionBorders()
    },
    calculateRange: function() {
        var h = this.y;
        var l = this.height;
        var m = this.x;
        var a = this.width;
        var d, b;
        for (var g = h; g <= l; ++g) {
            d = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,m,g,false);
            b = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,a,g,false);
            if (d.getColIndex() < this.x) {
                this.x = d.getColIndex()
            }
            if (b.getColIndex() + b.getColSpan() - 1 > this.width) {
                this.width = b.getColIndex() + b.getColSpan() - 1
            }
        }
        for (var c = m; c <= a; ++c) {
            d = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,c,h,false);
            b = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,c,l,false);
            if (d.getRowIndex() < this.y) {
                this.y = d.getRowIndex()
            }
            if (b.getRowIndex() + b.getRowSpan() - 1 > this.height) {
                this.height = b.getRowIndex() + b.getRowSpan() - 1
            }
        }
    },
    redraw: function() {
        if (this.computeFlag) {
            this.calculateRange()
        }
        this.setDivSize()
    },
    reBuild: function(a, b) {
        if (a) {
            this.destroy()
        }
        if (this.computeFlag) {
            this.calculateRange()
        }
        if ((this.x == this.width) && (this.y == this.height)) {
            if (this.grid.currentCell) {
                this.grid._drawCurrentCell(this.grid.currentCell)
            }
            return
        }
        this.createDiv();
        this.setDivSize(b)
    },
    hideSelectionBorders: function() {
        for (var a = 0; a < this.gridDivs.length; a++) {
            var b = this.gridDivs[a];
            b.childNodes[5].style.display = "none";
            b.childNodes[6].style.display = "none";
            b.childNodes[7].style.display = "none";
            b.childNodes[8].style.display = "none";
            b.childNodes[9].style.display = "none"
        }
        this.grid.mSelBorderLeft.style.display = "none";
        this.grid.mSelBorderRight.style.display = "none";
        this.grid.mSelBorderTop.style.display = "none";
        this.grid.mSelBorderBottom.style.display = "none";
        this.grid.mDragPointDiv.style.display = "none"
    }
});
DNA.widget.GridCell2Async = function(b, a, c) {
    DNA.widget.GridCell2Async.superclass.constructor.call(this, b, a, c);
    this.rowIndex = c;
    this.colIndex = a;
    this.table = b.tDiv;
    this.td = this.grid._getCellDom(a, c, this.table);
    this.ensureCellType()
}
;
DNA.widget.GridCell2Async.extend(DNA.widget.IGridCellAsync, {
    ensureCellType: function() {
        if (this.x === 0) {
            this.type = DNA.widget.JWTGrid2.CELL_ROWTITLE;
            if (this.y < this.grid.hRowCount) {
                this.isLock = true
            }
            return
        }
        if (this.y === 0) {
            this.type = DNA.widget.JWTGrid2.CELL_COLTITLE;
            if (this.x < this.grid.hColCount) {
                this.isLock = true
            }
            return
        }
        if (this.x < this.grid.hColCount) {
            if (this.y < this.grid.hRowCount) {
                this.type = DNA.widget.JWTGrid2.CELL_HEADERLOCK
            } else {
                if (this.y < this.grid.rowCount - this.grid.fRowCount) {
                    this.type = DNA.widget.JWTGrid2.CELL_HEADERCOL
                } else {
                    this.type = DNA.widget.JWTGrid2.CELL_LEFTBOTTOMLOCK
                }
            }
        } else {
            if (this.x >= this.grid.hColCount && this.x < this.grid.columnCount - this.grid.fColCount) {
                if (this.y < this.grid.hRowCount) {
                    this.type = DNA.widget.JWTGrid2.CELL_HEADERROW
                } else {
                    if (this.y < this.grid.rowCount - this.grid.fRowCount) {
                        this.type = DNA.widget.JWTGrid2.CELL_COMMON
                    } else {
                        this.type = DNA.widget.JWTGrid2.CELL_FOOTERROW
                    }
                }
            } else {
                if (this.y < this.grid.hRowCount) {
                    this.type = DNA.widget.JWTGrid2.CELL_RIGHTTOPLOCK
                } else {
                    if (this.y < this.grid.rowCount - this.grid.fRowCount) {
                        this.type = DNA.widget.JWTGrid2.CELL_FOOTERCOL
                    } else {
                        this.type = DNA.widget.JWTGrid2.CELL_RIGHTBOTTOMLOCK
                    }
                }
            }
        }
    },
    setClientData: function(b) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        if (typeof (b) != "string") {
            b = DNA.engine.JsonUtil.encode(b)
        }
        var a = this.parseStr2Html(b);
        this.setAttribute(this.td, "cd", a);
        this.setterHelper(this._setClientData, a)
    },
    _setClientData: function(b, a) {
        this.setAttribute(b, "cd", a)
    },
    setTopBorderStyle: function(a) {},
    setLeftBorderStyle: function(a) {},
    setRightBorderStyle: function(a) {
        if (a === "auto") {
            this.setRightBorderColor("");
            this.setterHelper2(this._setRightBorderStyle, a);
            return
        }
        this._setRightBorderStyle(this.td, a);
        this.setterHelper(this._setRightBorderStyle, a);
        this.setterMergeHelper(this._setRightBorderStyle, a)
    },
    setBottomBorderStyle: function(a) {
        if (a === "auto") {
            this.setBottomBorderColor("");
            this.setterHelper2(this._setBottomBorderStyle, a);
            return
        }
        this._setBottomBorderStyle(this.td, a);
        this.setterHelper(this._setBottomBorderStyle, a);
        this.setterMergeHelper(this._setBottomBorderStyle, a)
    },
    _setTopBorderStyle: function(b, a) {},
    _setLeftBorderStyle: function(b, a) {},
    _setRightBorderStyle: function(b, a) {
        if (a === "auto") {
            b.style.borderRightStyle = "";
            return
        }
        b.style.borderRightStyle = a
    },
    _setBottomBorderStyle: function(b, a) {
        if (a === "auto") {
            b.style.borderBottomStyle = "";
            return
        }
        b.style.borderBottomStyle = a
    },
    setTopBorderColor: function(a) {},
    setLeftBorderColor: function(a) {},
    setRightBorderColor: function(a) {
        this._setRightBorderColor(this.td, a);
        this.setterHelper(this._setRightBorderColor, a);
        this.setterMergeHelper(this._setRightBorderColor, a)
    },
    setBottomBorderColor: function(a) {
        this._setBottomBorderColor(this.td, a);
        this.setterHelper(this._setBottomBorderColor, a);
        this.setterMergeHelper(this._setBottomBorderColor, a)
    },
    _setTopBorderColor: function(b, a) {},
    _setLeftBorderColor: function(b, a) {},
    _setRightBorderColor: function(b, a) {
        if (this.x == 0 || this.y == 0) {
            this.setAttribute(b, "rbc", a)
        }
        b.style.borderRightColor = a
    },
    _setBottomBorderColor: function(b, a) {
        if (this.x == 0 || this.y == 0) {
            this.setAttribute(b, "bbc", a)
        }
        b.style.borderBottomColor = a
    },
    setBorderStyle: function(a) {},
    setBorderColor: function(a) {},
    setVertAlign: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        this._setVertAlign(this.td, a);
        this.setterHelper2(this._setVertAlign, a);
        this.rePositionTextWrapper();
        this.reVertTextInMergeDiv()
    },
    _setVertAlign: function(b, a) {
        this.setAttribute(b, "va", a.charAt(0))
    },
    setHorzAlign: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        this._setHorzAlign(this.td, a);
        this.setterHelper2(this._setHorzAlign, a);
        this.setterMergeHelper(this._setHorzAlign, a)
    },
    _setHorzAlign: function(b, a) {
        b.style.textAlign = a
    },
    setWrapLine: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        if (a) {
            a = "break-word"
        } else {
            a = "normal"
        }
        this._setWrapLine(this.td, a);
        this.setterHelper2(this._setWrapLine, a);
        this.setterMergeHelper(this._setWrapLine, a);
        this.reVertTextInMergeDiv();
        this.rePositionTextWrapper()
    },
    _setWrapLine: function(b, a) {
        b.style.wordWrap = a;
        if (a === "break-word") {
            b.style.whiteSpace = "normal"
        } else {
            b.style.whiteSpace = "nowrap"
        }
        if (a === "break-word") {
            b.setAttribute("wl", "1")
        } else {
            if (b.getAttribute("wl") == "1") {
                b.removeAttribute("wl")
            }
        }
    },
    setVertText: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        if (!DNA.engine.Client.isIE()) {
            return
        }
        this._setVertText(this.td, a);
        this.setterHelper2(this._setVertText, a)
    },
    _setVertText: function(b, a) {
        if (a) {
            b.style.writingMode = "tb-rl"
        } else {
            b.style.writingMode = "lr-tb"
        }
    },
    setSelectable: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        if (a) {
            this.setAttribute(this.td, "sa", 1);
            this.setterHelper2(this._setSelectable, 1)
        } else {
            this.setAttribute(this.td, "sa", 0);
            this.setterHelper2(this._setSelectable, 0)
        }
    },
    _setSelectable: function(b, a) {
        if (a) {
            this.setAttribute(b, "sa", 1)
        } else {
            this.setAttribute(b, "sa", 0)
        }
    },
    setEditable: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        if (a) {
            this.setAttribute(this.td, "ea", 1);
            this._updateEditorFace(true);
            this.setterHelper2(this._setEditable, 1)
        } else {
            this.grid.ensureEditorClose(this, true);
            this.setAttribute(this.td, "ea", 0);
            this._updateEditorFace(false);
            this.setterHelper2(this._setEditable, 0)
        }
    },
    _setEditable: function(b, a) {
        if (a) {
            this.setAttribute(b, "ea", 1)
        } else {
            this.setAttribute(b, "ea", 0)
        }
    },
    _updateEditorFace: function(a) {
        var b = this.grid.getCurrentCell();
        if (b && b.x == this.getColIndex() && b.y == this.getRowIndex()) {
            if (a) {
                if (this.grid.getEditMode() !== DNA.widget.JWTGrid2.EDIT_MODE_READONLY) {
                    this.grid._showFace()
                }
            } else {
                this.grid._hideFace()
            }
        }
    },
    setIndent: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        this._setIndent(this.td, a);
        this.setterHelper2(this._setIndent, a)
    },
    _setIndent: function(b, a) {
        b.style.textIndent = a + "px"
    },
    setFont: function(a) {
        this._setFont(this.td, a);
        this.setterHelper(this._setFont, a);
        this.setterMergeHelper(this._setFont, a);
        this.rePositionTextWrapper()
    },
    setFontStyle: function(a) {
        this._setFontStyle(this.td, a);
        this.setterHelper(this._setFontStyle, a);
        this.setterMergeHelper(this._setFontStyle, a);
        this.rePositionTextWrapper()
    },
    _setFontStyle: function(b, a) {
        if (a.style) {
            b.style.fontStyle = a.style
        } else {
            b.style.fontStyle = ""
        }
        if (a.weight) {
            b.style.fontWeight = a.weight
        } else {
            b.style.fontWeight = ""
        }
        if (a.decoration) {
            b.style.textDecoration = a.decoration
        } else {
            b.style.textDecoration = ""
        }
    },
    _setFont: function(b, a) {
        if (a.family) {
            b.style.fontFamily = a.family
        }
        if (a.size) {
            b.style.fontSize = parseInt(a.size, 10) + "pt"
        }
        if (a.style) {
            b.style.fontStyle = a.style
        } else {
            b.style.fontStyle = ""
        }
        if (a.weight) {
            b.style.fontWeight = a.weight
        } else {
            b.style.fontWeight = ""
        }
        if (a.decoration) {
            b.style.textDecoration = a.decoration
        } else {
            b.style.textDecoration = ""
        }
    },
    setEditor: function(a, c) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        this.setAttribute(this.td, "ei", a);
        if (c) {
            this.setAttribute(this.td, "ef", c)
        }
        this.setterHelper(this._setEditor, a);
        var b = DNA.widget.WidgetRegistry.get(a);
        if (b && !(this.grid.activeEditor && this.grid.activeEditor.control == b)) {
            b.setVisible(false)
        }
    },
    _setEditor: function(b, a) {
        this.setAttribute(b, "ei", a)
    },
    setForeground: function(a) {
        this._setForeground(this.td, a);
        this.setterHelper(this._setForeground, a);
        this.setterMergeHelper(this._setForeground, a)
    },
    _setForeground: function(b, a) {
        b.style.color = a
    },
    setGradientBackground: function(c, b, a) {
        this._setGradientBackground(this.td, c, b, a);
        this.setterMergeHelper(this._setGradientBackground, c, b, a)
    },
    _setGradientBackground: function(g, d, b, a) {
        if (DNA.engine.Client.isIE()) {
            this._setIEGradientBackground(g, d, b, a)
        } else {
            if (DNA.engine.Client.isFF()) {
                var c = d == 0 ? "top" : "left";
                this._setFFGradientBackground(g, c, b, a)
            } else {
                if (DNA.engine.Client.isChrome()) {
                    var c = d == 0 ? "left top,left bottom" : "left top,right top";
                    this._setWebketGradientBackground(g, c, b, a)
                }
            }
        }
    },
    _setIEGradientBackground: function(d, c, b, a) {
        d.style.filter = "progid:DXImageTransform.Microsoft.Gradient(gradientType=" + c + ",startColorStr=" + b + ",endColorStr=" + a + ");"
    },
    _setFFGradientBackground: function(g, c, b, a) {
        var d = "-moz-linear-gradient(" + c + ", " + b + "," + a + ")";
        g.style.backgroundImage = d
    },
    _setWebketGradientBackground: function(g, c, b, a) {
        var d = "-webkit-gradient(linear," + c + ", from(" + b + "),to(" + a + "))";
        g.style.backgroundImage = d
    },
    setShowImage: function(b, a) {
        this.setAttribute(this.td, "et", b);
        if (!a) {
            this.grid.fireDataChangeEvent({
                x: this.x,
                y: this.y,
                width: this.x,
                height: this.y
            }, 0)
        }
        this._setShowImage(this.td, b);
        this.setterHelper(this._setShowImage, b)
    },
    _setShowImage: function(c, a, b) {
        c.style.backgroundImage = "url(" + DNA.widget.ImageDescriptor.getUrl(a) + ")";
        if (b === true) {
            if (c.style.backgroundPosition == "") {
                c.style.backgroundPosition = "left top"
            }
        }
    },
    clientSetShowImage: function(c, a, b) {
        this._setShowImage(c, a, b);
        this.setterHelper(this._setShowImage, a);
        this.setterMergeHelper(this._setShowImage, a)
    },
    setBackImage: function(b) {
        if (b == "clear") {
            this._clearImage(this.td);
            this.setterHelper(this._clearImage);
            this.setterMergeHelper(this._clearImage)
        } else {
            var a = b.split(",");
            this._setBackImage(this.td, a[0], a[1]);
            this.setterHelper(this._setBackImage, a[0], a[1]);
            this.setterMergeHelper(this._setBackImage, a[0], a[1])
        }
    },
    _clearImage: function(a) {
        a.style.backgroundImage = "";
        if (DNA.engine.Client.isIE()) {
            a.style.filter = ""
        }
    },
    _setBackImage: function(d, c, a) {
        d.style.backgroundImage = "url(" + c + ")";
        this.backImageStyle = d.style.backgroundImage;
        var b;
        switch (a) {
        case "0":
            b = "no-repeat";
            break;
        case "1":
            b = "repeat";
            break;
        case "2":
            if (DNA.engine.Client.isFF()) {
                d.style.MozBackgroundSize = "100% 100%"
            } else {
                if (DNA.engine.Client.isIE()) {
                    d.style.backgroundImage = "";
                    d.style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(src= " + c + ", sizingMethod=scale)"
                }
            }
            break
        }
        if (b) {
            d.style.backgroundRepeat = b;
            if (d.style.backgroundPosition == "") {
                d.style.backgroundPosition = "left top"
            }
        }
    },
    setBackgroundPosition: function(b) {
        if (!this.backImageStyle) {
            return
        }
        var a = b.split(",");
        this._setBackgroundPosition(this.td, a[0], a[1]);
        this.setterHelper(this._setBackgroundPosition, a[0], a[1])
    },
    _setBackgroundPosition: function(c, a, b) {
        c.style.backgroundImage = this.backImageStyle;
        c.style.backgroundRepeat = "";
        c.style.MozBackgroundSize = "";
        c.style.filter = "";
        c.style.backgroundPosition = a + " " + b
    },
    setHtml: function(a) {
        this._setHtml(this.td, a);
        this.setterCoverHelper(this._setHtml, a);
        this.setterMergeHelper(this._setHtml, a)
    },
    _setHtml: function(c, a) {
        var b = c;
        if (c.htmlDiv) {
            c.htmlDiv.parentNode.removeChild(c.htmlDiv)
        }
        c.setAttribute("html", "1");
        b.innerHTML = a;
        this.grid._placeCellHTML(c)
    },
    setBackground: function(a) {
        this._setBackground(this.td, a);
        this.setterHelper(this._setBackground, a);
        this.setterMergeHelper(this._setBackground, a)
    },
    _setBackground: function(b, a) {
        if (this.x == 0 || this.y == 0) {
            this.setAttribute(b, "bgc", a)
        }
        b.style.backgroundColor = a
    },
    setSilverHead: function(a) {
        if (a) {
            this.setBackground("#ece9d8")
        } else {
            var b = this.getBackground();
            if (b == "#ece9d8") {
                this.setBackground("")
            }
        }
    },
    setBackStyle: function(a) {
        if (a === "auto") {
            this.setBackground("")
        }
    },
    setEditText: function(c, b, a) {
        if (this.getShowText() === "image://") {
            this.setShowImage(c)
        } else {
            if (this.getShowText() === "html://") {
                this.setHtml(c);
                c = "html://"
            }
        }
        c = this.parseStr2Html(c);
        this.setAttribute(this.td, "et", c);
        if (!b) {
            this.grid.fireDataChangeEvent({
                x: this.x,
                y: this.y,
                width: this.x,
                height: this.y
            }, 0)
        }
        this.setterHelper2(this._setEditText, c);
        if (a) {
            this.grid.reInitEditor(this)
        }
    },
    _setEditText: function(c, b, a) {
        b = this.parseStr2Html(b);
        this.setAttribute(c, "et", b)
    },
    setTitle: function(b) {
        var a = (b === undefined || b === null ) ? "" : b;
        this.setAttribute(this.td, "title", a);
        this.setterHelper2(this._setTitle, a)
    },
    _setTitle: function(b, a) {
        this.setAttribute(b, "title", a)
    },
    setFormatter: function(a) {
        if (this.x === 0 || this.y === 0) {
            return
        }
        this.setAttribute(this.td, "fi", a);
        this.setterHelper(this._setFormatter, a)
    },
    _setFormatter: function(b, a) {
        this.setAttribute(b, "fi", a)
    },
    setChecked: function(b) {
        var a = DNA.engine.DomUtil.findChild(this.td.firstChild, "span[class^=check]");
        if (a) {
            if (b) {
                a.className = "checkedCellAsync"
            } else {
                a.className = "checkableCellAsync"
            }
        }
    },
    setTreeStyle: function(a) {
        if (a & DNA.JWT.CHECK) {
            var b = DNA.engine.DomUtil.findChild(this.td.firstChild, "span[class^=check]");
            if (b) {
                b.style.display = ""
            }
        }
        if (a & DNA.JWT.LEAF) {
            var b = DNA.engine.DomUtil.findChild(this.td.firstChild, "span[class^=expand]");
            if (b) {
                b.style.visibility = "hidden"
            }
        }
    },
    setTreeImage: function(a) {
        var b = DNA.engine.DomUtil.findChild(this.td.firstChild, "span[class^=treeImage]");
        if (b) {
            if (a && a != "clear") {
                b.style.display = "";
                b.style.backgroundImage = "url(" + DNA.widget.ImageDescriptor.getUrl(a) + ")"
            } else {
                b.style.display = "none"
            }
        }
    },
    setFitFontSizeStyle: function(a) {
        this._setFitFontSizeStyle(this.td, a);
        this.setterHelper(this._setFitFontSizeStyle, a);
        this.setterMergeHelper(this._setFitFontSizeStyle, a);
        this.setFitFontSize()
    },
    _setFitFontSizeStyle: function(g, d) {
        if (d) {
            g.setAttribute("ffs", "1");
            g.setAttribute("ofs", this.getFont().size)
        } else {
            g.removeAttribute("ffs");
            var c = g.getAttribute("ofs");
            if (c) {
                var b = parseInt(c, 10);
                var a = this.getFont();
                a.setSize(b);
                this._setFont(g, a)
            }
            g.removeAttribute("ofs")
        }
    },
    setFitFontSize: function() {
        if (this.td.getAttribute("ffs")) {
            var a = this.getFont();
            a.setSize(this._computeFitFontSize());
            this.setFont(a)
        }
    },
    _computeFitFontSize: function() {
        var c = this.getFont();
        var m = this.getShowText();
        var l = parseInt(this.td.getAttribute("ofs"), 10);
        var d = this.getRowSpan();
        var h = this.getColSpan();
        var a = 0
          , n = 0;
        for (var g = 0; g < h; g++) {
            a += this.grid.getColumnWidth(this.getColIndex() + g)
        }
        for (var g = 0; g < d; g++) {
            n += this.grid.getRowHeight(this.getRowIndex() + g)
        }
        if (this._isWrapline()) {
            for (var g = this.grid.FONTSIZEFLOOR + 1; g <= l; g++) {
                c.setSize(g);
                var b = this.grid.util.computeFoldedTextHeight(m, c, a);
                if (b > n) {
                    c.setSize(g - 1);
                    break
                }
            }
        } else {
            for (var g = this.grid.FONTSIZEFLOOR + 1; g <= l; g++) {
                c.setSize(g);
                var o = this.grid.util.computeUnfoldedTextSize(m, c);
                if (o.height > n || o.width > a) {
                    c.setSize(g - 1);
                    break
                }
            }
        }
        return c.getSize()
    },
    _isWrapline: function() {
        return this.grid.util.getStyle(this.td, "wordWrap") === "break-word"
    },
    setExpandable: function(a, c) {
        var b = this.grid._getCellDom(a, c, this.table);
        this._setExpandable(b);
        this.setterHelper(this._setExpandable)
    },
    _setExpandable: function(b) {
        b.setAttribute("ea", 0);
        this._ensureTreeCell(b);
        var a = b.firstChild.childNodes;
        if (a[a.length - 4].className == "endCellHoriLineAsync") {
            DNA.engine.DomUtil.dispose(a[a.length - 4])
        }
        a[a.length - 4].className = "expandableCellAsync";
        b.setAttribute("ea", 0)
    },
    clearExpandable: function(a, c) {
        var b = this.grid._getCellDom(a, c, this.table);
        this._clearExpandable(b);
        this.setterHelper(this._clearExpandable)
    },
    _clearExpandable: function(b) {
        var a = this.getShowText();
        b.innerHTML = "<div class='textWrapperAsync'></div>";
        this._setShowText(b, a)
    },
    _ensureTreeCell: function(c) {
        if (!(c.firstChild.childNodes.length > 0 && c.firstChild.childNodes[0].tagName == "SPAN")) {
            var a = "";
            a += "<span class='emptyCellAsync'></span>";
            a += "<span class='endCellHoriLineAsync'></span>";
            a += "<span class='checkableCellAsync' style='display:none;'></span>";
            a += "<span class='treeImageCellAsync' style='display:none;'></span>";
            var b = this.getShowText();
            if (!b) {
                b = ""
            }
            a += "<span class='expandCellTextAsync'>" + b + "</span>";
            c.firstChild.innerHTML = a
        }
    },
    setExpanded: function(a) {
        var b = this.grid._getCellDom(this.x, this.y, this.table);
        this._setExpanded(b, a);
        this.setterHelper(this._setExpanded, a)
    },
    _setExpanded: function(d, b) {
        var c = "expandableCellAsync";
        if (b == "true") {
            c = "expandedCellAsync"
        }
        var a = DNA.engine.DomUtil.findChild(d.firstChild, "span[class^=expand]");
        if (a) {
            a.className = c
        }
    },
    _doCellExpendIndentation: function(d, b, c, a) {
        this.__doCellExpendIndentation(this.td, d, b, c, a);
        this.setterHelper(this.__doCellExpendIndentation, d, b, c, a)
    },
    __doCellExpendIndentation: function(l, h, d, g, c) {
        var a = "";
        a += "<span class='emptyCellAsync'></span>";
        for (var b = 1; b < d; b++) {
            a += "<span class='vertLineAsync'></span>"
        }
        if (h == g) {
            a += "<span class='bottomCellAsync'></span>"
        } else {
            a += "<span class='endCellVertLineAsync'></span>";
            a += "<span class='endCellHoriLineAsync'></span>"
        }
        if (c) {
            a += "<span class='checkableCellAsync'></span>"
        } else {
            a += "<span class='checkableCellAsync' style='display:none;'></span>"
        }
        a += "<span class='treeImageCellAsync' style='display:none;'></span>";
        DNA.engine.DomUtil.insertFirst(l.firstChild, a)
    },
    rePositionTextWrapper: function() {
        var a = this._rePositionTextWrapper(this.td);
        this.setterHelper(this._rePositionTextWrapper, a)
    },
    _rePositionTextWrapper: function(g, d) {
        if (d !== undefined) {
            g.firstChild.style.top = d + "px"
        } else {
            var d = 0;
            var c = this.grid.getRowHeight(this.getRowIndex());
            var a = this.grid.getColumnWidth(this.getColIndex());
            var b = this.getVertAlign();
            d = this.grid.util.reVertAlignDiv(c, a, this.isWrapLine(), this.getShowText(), this.getFont(), g.firstChild, b)
        }
        return d
    },
    setShowText: function(c, b, a) {
        if (c == "image://" || c == "html://") {
            this.setAttribute(this.td, "st", c);
            return
        }
        this._setShowText(this.td, c);
        if (!b) {
            this.grid.fireDataChangeEvent({
                x: this.x,
                y: this.y,
                width: this.x,
                height: this.y
            }, 0)
        }
        if (a) {
            this.setterHelper(this._setShowText2, c)
        } else {
            this.setterHelper(this._setShowText, c);
            this.setterMergeHelper(this._setShowText, c);
            this.grid.ensureHAndW(this)
        }
        this.rePositionTextWrapper()
    },
    _setShowText2: function(b, a) {
        if (!a || a == "") {
            a = " "
        }
        this.setAttribute(b, "st", a)
    },
    _setShowText: function(d, c) {
        if (!c) {
            c = ""
        }
        if (this.getAttribute(d, "rhc")) {
            this.setAttribute(d, "st", c)
        } else {
            if (this.x === 0 || this.y === 0) {
                this.setAttribute(d, "st", c)
            } else {
                this.removeAttribute(d, "st")
            }
            if (this.grid.ensureEditorClose(this)) {
                if (d.firstChild.childNodes.length > 0 && (d.firstChild.childNodes[0].nodeName == "SPAN")) {
                    this.setAttribute(d, "st", c);
                    var a = d.firstChild.childNodes[d.firstChild.childNodes.length - 1];
                    if (a.className && a.className != "expandCellTextAsync") {
                        DNA.engine.DomUtil.insertAfter(a, '<span class="expandCellTextAsync"></span>')
                    }
                    DNA.engine.DomUtil.setInnerText(d.firstChild.childNodes[d.firstChild.childNodes.length - 1], c === "" ? " " : c)
                } else {
                    var b = d;
                    b = d.firstChild;
                    if (c.indexOf("\n") > 0) {
                        b.innerHTML = c.replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/\n/g, "<br>")
                    } else {
                        if (DNA.engine.Client.isIE()) {
                            DNA.engine.DomUtil.setInnerText(b, c === "" ? " " : c)
                        } else {
                            b.innerHTML = (this.grid.util.getNBSPString(c)).replace(/</g, "&lt;").replace(/>/g, "&gt;")
                        }
                    }
                }
            } else {
                if (!c || c == "") {
                    c = " "
                }
                this.setAttribute(d, "st", c)
            }
        }
    },
    _resizeWraplineDiv: function() {
        var a = this.__resizeWraplineDiv(this.td);
        this.setterHelper(this.__resizeWraplineDiv, a)
    },
    __resizeWraplineDiv: function(m, a) {
        var g = 0;
        if (a !== undefined) {
            g = a
        } else {
            var c = this.getRowIndex();
            var b = c + parseInt(m.getAttribute("rowSpan"));
            for (var l = c; l < b; l++) {
                var d = this.grid._getCellDom(-1, l, this.grid.contentTable);
                if (d.offsetHeight > 0) {
                    g += parseInt(d.style.height)
                } else {
                    ++b
                }
            }
        }
        if ((g - 1) < this.grid.util.getWrapTextHeight(this.getColIndex(), this.getRowIndex(), this.td.offsetWidth)) {
            m.firstChild.style.height = (g - 1) + "px"
        } else {
            m.firstChild.style.height = ""
        }
        return g
    },
    setterHelper: function(b, d, c) {
        var a = null ;
        switch (this.type) {
        case DNA.widget.JWTGrid2.CELL_HEADERROW:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hrTable);
            b.apply(this, [a, d, c]);
            break;
        case DNA.widget.JWTGrid2.CELL_HEADERCOL:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hcTable);
            b.apply(this, [a, d, c]);
            break;
        case DNA.widget.JWTGrid2.CELL_HEADERLOCK:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hrTable);
            b.apply(this, [a, d, c]);
            a = this.grid._getCellDom(this.x, this.y, this.grid.hcTable);
            b.apply(this, [a, d, c]);
            a = this.grid._getCellDom(this.x, this.y, this.grid.hltTab);
            b.apply(this, [a, d, c]);
            break;
        case DNA.widget.JWTGrid2.CELL_ROWTITLE:
            a = this.grid._getCellDom(0, this.y, this.grid.hcTable);
            b.apply(this, [a, d, c]);
            if (this.isLock) {
                a = this.grid._getCellDom(0, this.y, this.grid.hltTab);
                b.apply(this, [a, d, c])
            }
            break;
        case DNA.widget.JWTGrid2.CELL_COLTITLE:
            a = this.grid._getCellDom(this.x, 0, this.grid.hrTable);
            b.apply(this, [a, d, c]);
            if (this.isLock) {
                a = this.grid._getCellDom(this.x, 0, this.grid.hltTab);
                b.apply(this, [a, d, c])
            }
            break;
        case DNA.widget.JWTGrid2.CELL_LEFTBOTTOMLOCK:
            a = this.grid._getCellDom(0, this.y, this.grid.hcTable);
            b.apply(this, [a, d, c]);
            a = this.grid._getCellDom(0, this.y - this.grid.rowCount + this.grid.fRowCount, this.grid.frTable);
            b.apply(this, [a, d, c]);
            a = this.grid._getCellDom(0, this.y - this.grid.rowCount + this.grid.fRowCount, this.grid.flbTab);
            b.apply(this, [a, d, c]);
            break;
        case DNA.widget.JWTGrid2.CELL_FOOTERROW:
            a = this.grid._getCellDom(this.x, this.y - this.grid.rowCount + this.grid.fRowCount, this.grid.frTable);
            b.apply(this, [a, d, c]);
            break;
        case DNA.widget.JWTGrid2.CELL_FOOTERCOL:
            a = this.grid._getCellDom(this.x - this.grid.columnCount + this.grid.fColCount, this.y, this.grid.fcTable);
            b.apply(this, [a, d, c]);
            break;
        case DNA.widget.JWTGrid2.CELL_RIGHTBOTTOMLOCK:
            a = this.grid._getCellDom(this.x, this.y - this.grid.rowCount + this.grid.fRowCount, this.grid.frTable);
            b.apply(this, [a, d, c]);
            a = this.grid._getCellDom(this.x - this.grid.columnCount + this.grid.fColCount, this.y, this.grid.fcTable);
            b.apply(this, [a, d, c]);
            a = this.grid._getCellDom(this.x - this.grid.columnCount + this.grid.fColCount, this.y - this.grid.rowCount + this.grid.fRowCount, this.grid.frbTab);
            b.apply(this, [a, d, c]);
            break;
        case DNA.widget.JWTGrid2.CELL_RIGHTTOPLOCK:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hrTable);
            b.apply(this, [a, d, c]);
            a = this.grid._getCellDom(this.x - this.grid.columnCount + this.grid.fColCount, this.y, this.grid.fcTable);
            b.apply(this, [a, d, c]);
            a = this.grid._getCellDom(this.x - this.grid.columnCount + this.grid.fColCount, this.y, this.grid.hrtTab);
            b.apply(this, [a, d, c]);
            break;
        default:
            break
        }
    },
    setterHelper2: function(b, c) {
        var a = null ;
        switch (this.type) {
        case DNA.widget.JWTGrid2.CELL_HEADERROW:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hrTable);
            b.apply(this, [a, c]);
            break;
        case DNA.widget.JWTGrid2.CELL_HEADERCOL:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hcTable);
            b.apply(this, [a, c]);
            break;
        case DNA.widget.JWTGrid2.CELL_HEADERLOCK:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hrTable);
            b.apply(this, [a, c]);
            a = this.grid._getCellDom(this.x, this.y, this.grid.hcTable);
            b.apply(this, [a, c]);
            a = this.grid._getCellDom(this.x, this.y, this.grid.hltTab);
            b.apply(this, [a, c]);
            break;
        default:
            break
        }
    },
    setterCoverHelper: function(b, d, c) {
        var a = null ;
        switch (this.type) {
        case DNA.widget.JWTGrid2.CELL_HEADERCOL:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hcTable);
            b.apply(this, [a, d, c]);
            break;
        case DNA.widget.JWTGrid2.CELL_HEADERLOCK:
            a = this.grid._getCellDom(this.x, this.y, this.grid.hcTable);
            b.apply(this, [a, d, c]);
            break;
        case DNA.widget.JWTGrid2.CELL_ROWTITLE:
            a = this.grid._getCellDom(0, this.y, this.grid.hcTable);
            b.apply(this, [a, d, c]);
            break;
        case DNA.widget.JWTGrid2.CELL_LEFTBOTTOMLOCK:
            a = this.grid._getCellDom(0, this.y, this.grid.hcTable);
            b.apply(this, [a, d, c]);
            break;
        case DNA.widget.JWTGrid2.CELL_FOOTERCOL:
            a = this.grid._getCellDom(this.x - this.grid.columnCount + this.grid.fColCount, this.y, this.grid.fcTable);
            b.apply(this, [a, d, c]);
            break;
        case DNA.widget.JWTGrid2.CELL_RIGHTBOTTOMLOCK:
            a = this.grid._getCellDom(this.x - this.grid.columnCount + this.grid.fColCount, this.y, this.grid.fcTable);
            b.apply(this, [a, d, c]);
            break;
        case DNA.widget.JWTGrid2.CELL_RIGHTTOPLOCK:
            a = this.grid._getCellDom(this.x - this.grid.columnCount + this.grid.fColCount, this.y, this.grid.fcTable);
            b.apply(this, [a, d, c]);
            break;
        default:
            break
        }
    },
    setterMergeHelper: function(l, c, b, a) {
        for (var g = 0; g < this.grid.mergeDivs.length; g++) {
            var n = this.grid.mergeDivs[g];
            var m = parseInt(n.getAttribute("ri"));
            var o = parseInt(n.getAttribute("ci"));
            var d = parseInt(n.getAttribute("rs"));
            var h = parseInt(n.getAttribute("cs"));
            if (m == this.y && o == this.x) {
                l.apply(this, [n, c, b, a])
            }
        }
    }
});
DNA.widget.Grid2SelectionChangeAreaAsync = function(a, c, d, b) {
    this.grid = a;
    this.div = d;
    if (!b) {
        this.setDivSize(null )
    }
    this.x = 0;
    this.y = 0;
    this.width = 0;
    this.height = 0;
    this.cellX = null ;
    this.cellY = null ;
    this.cellWidth = null ;
    this.cellHeight = null 
}
;
Object.override(DNA.widget.Grid2SelectionChangeAreaAsync.prototype, {
    _setBound: function(b, h, a) {
        var c = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,b.x,b.y,false);
        var l = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,h.x,h.y,false);
        var m = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,h.width,h.y,false);
        var d = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,h.x,h.height,false);
        var g = new DNA.widget.AbstractGridCellAsync(this.grid,this.grid.tDiv,h.width,h.height,false);
        this.positionLT = {
            x: l.getLeft(),
            y: l.getTop()
        };
        this.positionRT = {
            x: m.getLeft() + m.getWidth(),
            y: m.getTop()
        };
        this.positionLB = {
            x: d.getLeft(),
            y: d.getTop() + d.getHeight()
        };
        this.positionRB = {
            x: g.getLeft() + g.getWidth(),
            y: g.getTop() + g.getHeight()
        };
        if (a.x > this.positionRB.x) {
            if ((a.y - this.positionRB.y) > 0 && (a.y - this.positionRB.y) > (a.x - this.positionRB.x)) {
                this.x = this.positionLT.x;
                this.y = this.positionLT.y;
                this.width = this.positionRT.x - this.positionLT.x;
                this.height = this.positionRB.y - this.positionRT.y + c.getTop() - this.positionRB.y + c.getHeight();
                this.cellX = h.x;
                this.cellY = h.y;
                this.cellWidth = h.width;
                this.cellHeight = b.y
            } else {
                if ((a.y - this.positionRT.y) < 0 && (this.positionRT.y - a.y) > (a.x - this.positionRT.x)) {
                    this.x = this.positionLT.x;
                    this.y = c.getTop();
                    this.width = this.positionRT.x - this.positionLT.x;
                    this.height = this.positionRB.y - c.getTop();
                    this.cellX = h.x;
                    this.cellY = b.y;
                    this.cellWidth = h.width;
                    this.cellHeight = h.height
                } else {
                    this.x = this.positionLT.x;
                    this.y = this.positionLT.y;
                    this.width = this.positionRT.x - this.positionLT.x + c.getLeft() - this.positionRB.x + c.getWidth();
                    this.height = this.positionRB.y - this.positionRT.y;
                    this.cellX = h.x;
                    this.cellY = h.y;
                    this.cellWidth = b.x;
                    this.cellHeight = h.height
                }
            }
            return
        }
        if (a.x < this.positionLB.x) {
            if ((a.y - this.positionRB.y) > 0 && (a.y - this.positionRB.y) > (this.positionLB.x - a.x)) {
                this.x = this.positionLT.x;
                this.y = this.positionLT.y;
                this.width = this.positionRT.x - this.positionLT.x;
                this.height = this.positionRB.y - this.positionRT.y + c.getTop() - this.positionRB.y + c.getHeight();
                this.cellX = h.x;
                this.cellY = h.y;
                this.cellWidth = h.width;
                this.cellHeight = b.y
            } else {
                if ((a.y - this.positionRT.y) < 0 && (this.positionLT.y - a.y) > (this.positionLT.x - a.x)) {
                    this.x = this.positionLT.x;
                    this.y = c.getTop();
                    this.width = this.positionRT.x - this.positionLT.x;
                    this.height = this.positionRB.y - c.getTop();
                    this.cellX = h.x;
                    this.cellY = b.y;
                    this.cellWidth = h.width;
                    this.cellHeight = h.height
                } else {
                    this.x = c.getLeft();
                    this.y = this.positionLT.y;
                    this.width = this.positionRT.x - c.getLeft();
                    this.height = this.positionRB.y - this.positionRT.y;
                    this.cellX = b.x;
                    this.cellY = h.y;
                    this.cellWidth = h.width;
                    this.cellHeight = h.height
                }
            }
            return
        }
        if (a.y < this.positionLT.y) {
            this.x = this.positionLT.x;
            this.y = c.getTop();
            this.width = this.positionRT.x - this.positionLT.x;
            this.height = this.positionRB.y - c.getTop();
            this.cellX = h.x;
            this.cellY = b.y;
            this.cellWidth = h.width;
            this.cellHeight = h.height;
            return
        }
        if (a.y > this.positionLB.y) {
            this.x = this.positionLT.x;
            this.y = this.positionLT.y;
            this.width = this.positionRT.x - this.positionLT.x;
            this.height = c.getTop() - this.positionRT.y + c.getHeight();
            this.cellX = h.x;
            this.cellY = h.y;
            this.cellWidth = h.width;
            this.cellHeight = b.y;
            return
        }
    },
    setDiv: function(h, b, g, d, a, c) {
        DNA.engine.DomUtil.setSize(h, {
            width: d,
            height: a
        });
        DNA.engine.DomUtil.setLeftTop(h, b, g);
        h.style.borderStyle = c;
        h.style.borderWidth = "2px"
    },
    destroy: function() {
        if (this.div != null ) {
            this.div.style.width = "0px";
            this.div.style.borderWidth = "0px";
            this.div.style.borderStyle = "none";
            this.div = null 
        }
    },
    redraw: function(a) {
        this.setDiv(this.div, this.x, this.y, this.width, this.height, a)
    }
});
DNA.widget.AbstractCellControlAsync = function(c, a, b) {
    this.grid = c;
    this.cell = a;
    this.control = null ;
    this.grid = c;
    this.cell = a;
    this.eid = b;
    this.createControl()
}
;
DNA.widget.AbstractCellControlAsync.extend(Object, {
    open: function() {
        if (this.control) {
            if (this.control.checkRendered(true)) {
                this.resizeControl();
                this.control.getEl().style.position = "absolute";
                this.grid._getPermanentHolder(this.cell.colIndex, this.cell.rowIndex).appendChild(this.control.getEl())
            }
        }
    },
    resizeControl: function() {
        if (this.cell.isMerged()) {
            return
        }
        var c = this.cell.getWidth();
        var a = this.cell.getHeight();
        this.control.setVisible(true);
        var d = this.cell.getColIndex() < this.grid.getColumnCount() - this.grid.getFooterColumnCount() ? 0 : this.grid.getColumnCount() - this.grid.getFooterColumnCount();
        var b = this.cell.getRowIndex() < this.grid.getRowCount() - this.grid.getFooterRowCount() ? 0 : this.grid.getRowCount() - this.grid.getFooterRowCount();
        var h = this.cell.getLeft(d);
        var g = this.cell.getTop(b);
        this.control.setBounds(0, 0, 0, 0);
        if (!DNA.engine.Client.isIE()) {
            g -= 1
        }
        a -= 1;
        c -= 1;
        this.control.setBounds(h, g, c, a)
    },
    _ControlMouseUp: function() {
        if (!this.control.checkRendered(true)) {
            return
        }
        this.grid.gridState = DNA.widget.JWTGrid2.STATE_NORMAL
    },
    createControl: function() {
        this.control = DNA.widget.WidgetRegistry.get(this.eid)
    },
    close: function(a) {
        if (!a && !this.getCloseFlag()) {
            this.control.removeListener(this, "keydown");
            this.grid.getEl().appendChild(this.control.getEl());
            this.control.setVisible(false);
            this.setCloseFlag(true)
        }
    },
    setCloseFlag: function(a) {
        this.closed = a
    },
    getCloseFlag: function() {
        return this.closed
    }
});
DNA.widget.CellControlProviderAsync = function() {
    DNA.widget.CellControlProviderAsync.superclass.constructor.call()
}
;
DNA.widget.CellControlProviderAsync.extend(DNA.widget.ICellControlProvider, {
    getCellControl: function(d, a, c) {
        var b = null ;
        if (c) {
            b = new DNA.widget.AbstractCellControlAsync(d,a,c)
        }
        return b
    }
});
DNA.adapter.BorderLayoutCalculator = function() {}
;
DNA.adapter.BorderLayoutCalculator.CENTER = 1 << 24;
DNA.adapter.BorderLayoutCalculator.NORTH = 1;
DNA.adapter.BorderLayoutCalculator.SOUTH = 1 << 1;
DNA.adapter.BorderLayoutCalculator.EAST = 1 << 2;
DNA.adapter.BorderLayoutCalculator.WEST = 1 << 3;
DNA.adapter.BorderLayoutCalculator.computeSize = function(m, b, h, g, c) {
    DNA.adapter.BorderLayoutCalculator.readLayoutData(m, c);
    var p = c.newPoint(0, 0);
    var n = null 
      , a = null 
      , l = null 
      , d = null 
      , o = null ;
    if (c.northChild != null ) {
        n = DNA.adapter.BorderLayoutCalculator.getPreferredSize(c.northChild, b, DNA.JWT.DEFAULT, g, c)
    } else {
        n = c.newPoint(0, 0)
    }
    if (c.southChild != null ) {
        a = DNA.adapter.BorderLayoutCalculator.getPreferredSize(c.southChild, b, DNA.JWT.DEFAULT, g, c)
    } else {
        a = c.newPoint(0, 0)
    }
    if (c.westChild != null ) {
        l = DNA.adapter.BorderLayoutCalculator.getPreferredSize(c.westChild, DNA.JWT.DEFAULT, h, g, c)
    } else {
        l = c.newPoint(0, 0)
    }
    if (c.eastChild != null ) {
        o = DNA.adapter.BorderLayoutCalculator.getPreferredSize(c.eastChild, DNA.JWT.DEFAULT, h, g, c)
    } else {
        o = c.newPoint(0, 0)
    }
    if (c.centerChild != null ) {
        d = DNA.adapter.BorderLayoutCalculator.getPreferredSize(c.centerChild, b, h, g, c)
    } else {
        d = c.newPoint(0, 0)
    }
    p.x = Math.max(Math.max(n.x, n.y), l.x + d.x + o.x);
    p.y = Math.max(Math.max(l.y, o.y), d.y) + n.y + a.y;
    p.x += 2 * c.marginWidth;
    p.y += 2 * c.marginHeight;
    p.y += 2 * c.vgap;
    return p
}
;
DNA.adapter.BorderLayoutCalculator.layout = function(m, h, d) {
    DNA.adapter.BorderLayoutCalculator.readLayoutData(m, d);
    var c = m.getClientArea();
    var l = c.y + d.marginHeight;
    var a = c.y + c.height - d.marginHeight;
    var b = c.x + d.marginWidth;
    var n = c.x + c.width - d.marginWidth;
    var g;
    if (d.northChild != null ) {
        g = DNA.adapter.BorderLayoutCalculator.getPreferredSize(d.northChild, DNA.JWT.DEFAULT, DNA.JWT.DEFAULT, h, d);
        d.northChild.setBounds(b, l, n - b, g.y);
        l += g.y + d.vgap
    }
    if (d.southChild != null ) {
        g = DNA.adapter.BorderLayoutCalculator.getPreferredSize(d.southChild, DNA.JWT.DEFAULT, DNA.JWT.DEFAULT, h, d);
        d.southChild.setBounds(b, a - g.y, n - b, g.y);
        a -= g.y + d.vgap
    }
    if (d.westChild != null ) {
        g = DNA.adapter.BorderLayoutCalculator.getPreferredSize(d.westChild, DNA.JWT.DEFAULT, a - l, h, d);
        d.westChild.setBounds(b, l, g.x, a - l);
        b += g.x + d.hgap
    }
    if (d.eastChild != null ) {
        g = DNA.adapter.BorderLayoutCalculator.getPreferredSize(d.eastChild, DNA.JWT.DEFAULT, a - l, h, d);
        d.eastChild.setBounds(n - g.x, l, g.x, a - l);
        n -= g.x + d.hgap
    }
    if (d.centerChild != null ) {
        d.centerChild.setBounds(b, l, n - b, a - l)
    }
}
;
DNA.adapter.BorderLayoutCalculator.flushCache = function(b, a) {
    return true
}
;
DNA.adapter.BorderLayoutCalculator.readLayoutData = function(g, c) {
    c.northChild = c.southChild = c.eastChild = c.westChild = c.centerChild = null ;
    var b = c.getLayoutControls(g);
    for (var a = 0; a < b.length; a++) {
        var d = b[a].getLayoutData();
        if (d != null ) {
            if (DNA.adapter.BorderLayoutCalculator.NORTH == d.position) {
                c.northChild = b[a]
            } else {
                if (DNA.adapter.BorderLayoutCalculator.SOUTH == d.position) {
                    c.southChild = b[a]
                } else {
                    if (DNA.adapter.BorderLayoutCalculator.EAST == d.position) {
                        c.eastChild = b[a]
                    } else {
                        if (DNA.adapter.BorderLayoutCalculator.WEST == d.position) {
                            c.westChild = b[a]
                        } else {
                            c.centerChild = b[a]
                        }
                    }
                }
            }
        } else {
            c.centerChild = b[a]
        }
    }
}
;
DNA.adapter.BorderLayoutCalculator.getPreferredSize = function(d, b, a, g, c) {
    return d.computeSize(b, a, g)
}
;
DNA.adapter.FillDataCalculator = function() {}
;
DNA.adapter.FillDataCalculator.computeSize = function(g, c, a, h, d) {
    if (h) {
        DNA.adapter.FillDataCalculator.flushCache(d)
    }
    if (c == DNA.JWT.DEFAULT && a == DNA.JWT.DEFAULT) {
        if (d.defaultWidth == -1 || d.defaultHeight == -1) {
            var b = g.computeSize(c, a, h);
            d.defaultWidth = b.x;
            d.defaultHeight = b.y
        }
        return d.newPoint(d.defaultWidth, d.defaultHeight)
    }
    if (d.currentWidth == -1 || d.currentHeight == -1 || c != d.currentWhint || a != d.currentHhint) {
        var b = g.computeSize(c, a, h);
        d.currentWhint = c;
        d.currentHhint = a;
        d.currentWidth = b.x;
        d.currentHeight = b.y
    }
    return d.newPoint(d.currentWidth, d.currentHeight)
}
;
DNA.adapter.FillDataCalculator.flushCache = function(a) {
    a.defaultWidth = a.defaultHeight = -1;
    a.currentWidth = a.currentHeight = -1
}
;
DNA.adapter.FillLayoutCalculator = function() {}
;
DNA.adapter.FillLayoutCalculator.computeSize = function(u, c, z, s, w) {
    var b = w.type;
    var A = w.marginWidth;
    var n = w.marginHeight;
    var d = w.spacing;
    if (c != DNA.JWT.DEFAULT && z != DNA.JWT.DEFAULT) {
        return w.newPoint(c, z)
    }
    var g = w.getLayoutControls(u);
    var l = g.length;
    if (l == 0) {
        return w.newPoint(c != DNA.JWT.DEFAULT ? c : 0, z != DNA.JWT.DEFAULT ? z : 0)
    } else {
        var m = c
          , a = z;
        if (b == DNA.JWT.HORIZONTAL && c != DNA.JWT.DEFAULT) {
            m = Math.round(Math.max(0, (c - (l - 1) * d - A * 2) / l))
        }
        if (b == DNA.JWT.VERTICAL && z != DNA.JWT.DEFAULT) {
            a = Math.round(Math.max(0, (z - (l - 1) * d - n * 2) / l))
        }
        var v = 0
          , r = 0;
        for (var t = 0; t < l; t++) {
            var h = g[t];
            var p = DNA.adapter.FillLayoutCalculator._computeChildSize(h, m, a, s, w);
            v = Math.max(v, p.x);
            r = Math.max(r, p.y)
        }
        var q = 0
          , o = 0;
        if (b == DNA.JWT.HORIZONTAL) {
            q = l * v + (l - 1) * d + A * 2;
            o = r + n * 2
        } else {
            q = v + A * 2;
            o = l * r + (l - 1) * d + n * 2
        }
        if (c != DNA.JWT.DEFAULT) {
            q = c
        }
        if (z != DNA.JWT.DEFAULT) {
            o = z
        }
        return w.newPoint(q, o)
    }
}
;
DNA.adapter.FillLayoutCalculator.layout = function(z, u, A) {
    var h = A.type;
    var B = A.marginWidth;
    var r = A.marginHeight;
    var l = A.spacing;
    var m = A.getLayoutControls(z);
    var o = m.length;
    if (o == 0) {
        return
    }
    var b = z.getClientArea();
    var t = b.width - B * 2;
    var s = b.height - r * 2;
    if (h == DNA.JWT.HORIZONTAL) {
        t -= (o - 1) * l;
        var q = b.x + B;
        var c = t % o;
        var p = b.y + r;
        var v = Math.floor(t / o);
        for (var w = 0; w < o; w++) {
            var n = m[w];
            var d = v;
            if (w == 0) {
                d += Math.floor(c / 2)
            } else {
                if (w == o - 1) {
                    d += Math.floor((c + 1) / 2)
                }
            }
            n.setBounds(q, p, d, s);
            q += Math.floor(d + l)
        }
    } else {
        s -= (o - 1) * l;
        var q = b.x + B;
        var a = Math.floor(s / o);
        var p = b.y + r;
        var c = s % o;
        for (var w = 0; w < o; w++) {
            var n = m[w];
            var g = a;
            if (w == 0) {
                g += Math.floor(c / 2)
            } else {
                if (w == o - 1) {
                    g += Math.floor((c + 1) / 2)
                }
            }
            n.setBounds(q, p, t, g);
            p += Math.floor(g + l)
        }
    }
}
;
DNA.adapter.FillLayoutCalculator.flushCache = function(c, a) {
    var b = c.getLayoutData();
    if (b != null ) {
        DNA.adapter.FillDataCalculator.flushCache(b)
    }
    return true
}
;
DNA.adapter.FillLayoutCalculator._computeChildSize = function(g, b, a, h, c) {
    var d = g.getLayoutData();
    if (d == null ) {
        d = c.newData();
        g.setLayoutData(d)
    }
    return DNA.adapter.FillDataCalculator.computeSize(g, b, a, h, d)
}
;
DNA.adapter.GridDataCalculator = function() {}
;
DNA.adapter.GridDataCalculator.computeSize = function(g, c, a, h, d) {
    if (d.cacheWidth != -1 && d.cacheHeight != -1) {
        return
    }
    if (c == d.widthHint && a == d.heightHint) {
        if (d.defaultWidth == -1 || d.defaultHeight == -1 || c != d.defaultWhint || a != d.defaultHhint) {
            var b = g.computeSize(c, a, h);
            d.defaultWhint = c;
            d.defaultHhint = a;
            d.defaultWidth = b.x;
            d.defaultHeight = b.y
        }
        d.cacheWidth = d.defaultWidth;
        d.cacheHeight = d.defaultHeight;
        return
    }
    if (d.currentWidth == -1 || d.currentHeight == -1 || c != d.currentWhint || a != d.currentHhint) {
        var b = g.computeSize(c, a, h);
        d.currentWhint = c;
        d.currentHhint = a;
        d.currentWidth = b.x;
        d.currentHeight = b.y
    }
    d.cacheWidth = d.currentWidth;
    d.cacheHeight = d.currentHeight
}
;
DNA.adapter.GridDataCalculator.flushCache = function(a) {
    a.cacheWidth = a.cacheHeight = -1;
    a.defaultWidth = a.defaultHeight = -1;
    a.currentWidth = a.currentHeight = -1
}
;
DNA.adapter.GridLayoutCalculator = function() {}
;
DNA.adapter.GridLayoutCalculator.computeSize = function(h, c, a, g, d) {
    var b = DNA.adapter.GridLayoutCalculator._advancedLayout(h, false, 0, 0, c, a, g, d);
    if (c != DNA.JWT.DEFAULT) {
        b.x = c
    }
    if (a != DNA.JWT.DEFAULT) {
        b.y = a
    }
    return b
}
;
DNA.adapter.GridLayoutCalculator.layout = function(d, c, b) {
    var a = d.getClientArea();
    DNA.adapter.GridLayoutCalculator._advancedLayout(d, true, a.x, a.y, a.width, a.height, c, b)
}
;
DNA.adapter.GridLayoutCalculator.flushCache = function(c, a) {
    var b = c.getLayoutData();
    if (b != null ) {
        DNA.adapter.GridDataCalculator.flushCache(b)
    }
    return true
}
;
DNA.adapter.GridLayoutCalculator._advancedLayout = function(U, A, aa, Y, b, g, z, O) {
    if (O.numColumns < 1) {
        if (A) {
            if (O.widths !== undefined) {
                O.widths = []
            }
            if (O.heights !== undefined) {
                O.heights = []
            }
        }
        return O.newPoint(O.marginLeft + O.marginWidth * 2 + O.marginRight, O.marginTop + O.marginHeight * 2 + O.marginBottom)
    }
    var E = O.getLayoutControls(U);
    var ai = 0;
    for (var at = 0; at < E.length; at++) {
        var I = E[at];
        var aw = I.getLayoutData();
        if (aw == null  || !aw.exclude) {
            E[ai++] = E[at]
        }
    }
    if (ai == 0) {
        if (A) {
            if (O.widths !== undefined) {
                O.widths = []
            }
            if (O.heights !== undefined) {
                O.heights = []
            }
        }
        return O.newPoint(O.marginLeft + O.marginWidth * 2 + O.marginRight, O.marginTop + O.marginHeight * 2 + O.marginBottom)
    }
    for (var at = 0; at < ai; at++) {
        var o = E[at];
        var aw = o.getLayoutData();
        if (aw == null ) {
            aw = O.newData()
        }
        o.setLayoutData(aw);
        if (z) {
            DNA.adapter.GridDataCalculator.flushCache(aw)
        }
        DNA.adapter.GridDataCalculator.computeSize(o, aw.widthHint, aw.heightHint, z, aw);
        if (aw.grabExcessHorizontalSpace && aw.minimumWidth > 0) {
            if (aw.cacheWidth < aw.minimumWidth) {
                var a = 0;
                a = o.getBorderWidth() * 2;
                aw.cacheWidth = aw.cacheHeight = DNA.JWT.DEFAULT;
                DNA.adapter.GridDataCalculator.computeSize(o, Math.max(0, aw.minimumWidth - a), aw.heightHint, false, aw)
            }
        }
        if (aw.grabExcessVerticalSpace && aw.minimumHeight > 0) {
            aw.cacheHeight = Math.max(aw.cacheHeight, aw.minimumHeight)
        }
    }
    var B = 0
      , ag = 0
      , s = 0
      , l = O.numColumns;
    var ae = [];
    for (var aq = 0; aq < 4; aq++) {
        ae[aq] = []
    }
    for (var at = 0; at < ai; at++) {
        var o = E[at];
        var aw = o.getLayoutData();
        var al = Math.max(1, Math.min(aw.horizontalSpan, l));
        var aA = Math.max(1, aw.verticalSpan);
        while (true) {
            var H = B + aA;
            if (H >= ae.length) {
                for (var aq = H; aq < H + 4; aq++) {
                    if (!ae[aq]) {
                        ae[aq] = []
                    }
                }
            }
            while (ag < l && ae[B][ag] != null ) {
                ag++
            }
            var C = ag + al;
            if (C <= l) {
                var P = ag;
                while (P < C && ae[B][P] == null ) {
                    P++
                }
                if (P - C < 1 && P - C > -1) {
                    break
                }
                ag = P
            }
            if (ag + al >= l) {
                ag = 0;
                B++
            }
        }
        for (var aq = 0; aq < aA; aq++) {
            if (!ae[B + aq]) {
                ae[B + aq] = []
            }
            for (var ao = 0; ao < al; ao++) {
                ae[B + aq][ag + ao] = o
            }
        }
        s = Math.max(s, B + aA);
        ag += al
    }
    var p = Math.round(b - O.horizontalSpacing * (l - 1) - (O.marginLeft + O.marginWidth * 2 + O.marginRight));
    var af = 0;
    var n = [];
    var N = [];
    var K = [];
    for (var at = 0; at < l; at++) {
        n[at] = 0;
        N[at] = 0
    }
    for (var aq = 0; aq < l; aq++) {
        for (var at = 0; at < s; at++) {
            var aw = DNA.adapter.GridLayoutCalculator._getData(ae, at, aq, s, l, true, O);
            if (aw != null ) {
                var al = Math.max(1, Math.min(aw.horizontalSpan, l));
                if (al == 1) {
                    var ab = aw.cacheWidth + aw.horizontalIndent;
                    n[aq] = Math.max(Math.round(n[aq]), ab);
                    if (aw.grabExcessHorizontalSpace) {
                        if (!K[aq]) {
                            af++
                        }
                        K[aq] = true
                    }
                    if (!aw.grabExcessHorizontalSpace || aw.minimumWidth != 0) {
                        ab = !aw.grabExcessHorizontalSpace || aw.minimumWidth == DNA.JWT.DEFAULT ? aw.cacheWidth : aw.minimumWidth;
                        ab += aw.horizontalIndent;
                        N[aq] = Math.max(N[aq], ab)
                    }
                }
            }
        }
        for (var at = 0; at < s; at++) {
            var aw = DNA.adapter.GridLayoutCalculator._getData(ae, at, aq, s, l, false, O);
            if (aw != null ) {
                var al = Math.max(1, Math.min(aw.horizontalSpan, l));
                if (al > 1) {
                    var L = 0
                      , W = 0
                      , m = 0;
                    for (var ao = 0; ao < al; ao++) {
                        L += n[aq - ao];
                        W += N[aq - ao];
                        if (K[aq - ao]) {
                            m++
                        }
                    }
                    if (aw.grabExcessHorizontalSpace && m == 0) {
                        af++;
                        K[aq] = true
                    }
                    var ab = aw.cacheWidth + aw.horizontalIndent - L - (al - 1) * O.horizontalSpacing;
                    if (ab > 0) {
                        if (O.makeColumnsEqualWidth) {
                            var d = Math.round((ab + L) / al);
                            var G = (ab + L) % al
                              , D = -1;
                            for (var ao = 0; ao < al; ao++) {
                                n[D = aq - ao] = Math.max(d, n[aq - ao])
                            }
                            if (D > -1) {
                                n[D] += G
                            }
                        } else {
                            if (m == 0) {
                                n[aq] += ab
                            } else {
                                var V = Math.round(ab / m);
                                var G = ab % m
                                  , D = -1;
                                for (var ao = 0; ao < al; ao++) {
                                    if (K[aq - ao]) {
                                        n[D = aq - ao] += V
                                    }
                                }
                                if (D > -1) {
                                    n[D] += G
                                }
                            }
                        }
                    }
                    if (!aw.grabExcessHorizontalSpace || aw.minimumWidth != 0) {
                        ab = !aw.grabExcessHorizontalSpace || aw.minimumWidth == DNA.JWT.DEFAULT ? aw.cacheWidth : aw.minimumWidth;
                        ab += aw.horizontalIndent - W - (al - 1) * O.horizontalSpacing;
                        if (ab > 0) {
                            if (m == 0) {
                                N[aq] += ab
                            } else {
                                var V = Math.round(ab / m);
                                var G = ab % m
                                  , D = -1;
                                for (var ao = 0; ao < al; ao++) {
                                    if (K[aq - ao]) {
                                        N[D = aq - ao] += V
                                    }
                                }
                                if (D > -1) {
                                    N[D] += G
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    if (O.makeColumnsEqualWidth) {
        var Q = 0;
        var u = 0;
        for (var at = 0; at < l; at++) {
            Q = Math.max(Q, N[at]);
            u = Math.max(u, n[at])
        }
        u = b == DNA.JWT.DEFAULT || af == 0 ? u : Math.max(Q, Math.round(p / l));
        for (var at = 0; at < l; at++) {
            K[at] = af > 0;
            n[at] = u
        }
    } else {
        if (b != DNA.JWT.DEFAULT && af > 0) {
            var r = 0;
            for (var at = 0; at < l; at++) {
                r += n[at]
            }
            var ax = af;
            var V = Math.round((p - r) / ax);
            var G = (p - r) % ax;
            var D = -1;
            while (r - p > 1 || r - p < -1) {
                for (var aq = 0; aq < l; aq++) {
                    if (K[aq]) {
                        if (n[aq] + V > N[aq]) {
                            n[D = aq] = n[aq] + V
                        } else {
                            n[aq] = N[aq];
                            K[aq] = false;
                            ax--
                        }
                    }
                }
                if (D > -1) {
                    n[D] += G
                }
                for (var aq = 0; aq < l; aq++) {
                    for (var at = 0; at < s; at++) {
                        var aw = DNA.adapter.GridLayoutCalculator._getData(ae, at, aq, s, l, false, O);
                        if (aw != null ) {
                            var al = Math.max(1, Math.min(aw.horizontalSpan, l));
                            if (al > 1) {
                                if (!aw.grabExcessHorizontalSpace || aw.minimumWidth != 0) {
                                    var L = 0
                                      , m = 0;
                                    for (var ao = 0; ao < al; ao++) {
                                        L += n[aq - ao];
                                        if (K[aq - ao]) {
                                            m++
                                        }
                                    }
                                    var ab = !aw.grabExcessHorizontalSpace || aw.minimumWidth == DNA.JWT.DEFAULT ? aw.cacheWidth : aw.minimumWidth;
                                    ab += aw.horizontalIndent - L - (al - 1) * O.horizontalSpacing;
                                    if (ab > 0) {
                                        if (m == 0) {
                                            n[aq] += ab
                                        } else {
                                            var T = Math.round(ab / m);
                                            var q = ab % m
                                              , M = -1;
                                            for (var ao = 0; ao < al; ao++) {
                                                if (K[aq - ao]) {
                                                    n[M = aq - ao] += T
                                                }
                                            }
                                            if (M > -1) {
                                                n[M] += q
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                if (ax == 0) {
                    break
                }
                r = 0;
                for (var at = 0; at < l; at++) {
                    r += n[at]
                }
                r = Math.round(r);
                V = Math.round((p - r) / ax);
                G = (p - r) % ax;
                D = -1
            }
        }
    }
    var t = [];
    var av = 0;
    if (b != DNA.JWT.DEFAULT) {
        for (var aq = 0; aq < l; aq++) {
            for (var at = 0; at < s; at++) {
                var aw = DNA.adapter.GridLayoutCalculator._getData(ae, at, aq, s, l, false, O);
                if (aw != null ) {
                    if (aw.heightHint == DNA.JWT.DEFAULT) {
                        var o = ae[at][aq];
                        var al = Math.max(1, Math.min(aw.horizontalSpan, l));
                        var F = 0;
                        for (var ao = 0; ao < al; ao++) {
                            F += n[aq - ao]
                        }
                        F += (al - 1) * O.horizontalSpacing - aw.horizontalIndent;
                        if ((Math.round(F) != aw.cacheWidth && aw.horizontalAlignment == DNA.JWT.FILL) || (aw.cacheWidth > F)) {
                            var a = 0;
                            a = o.getBorderWidth() * 2;
                            aw.cacheWidth = aw.cacheHeight = DNA.JWT.DEFAULT;
                            DNA.adapter.GridDataCalculator.computeSize(o, Math.max(0, F - a), aw.heightHint, false, aw);
                            if (aw.grabExcessVerticalSpace && aw.minimumHeight > 0) {
                                aw.cacheHeight = Math.max(aw.cacheHeight, aw.minimumHeight)
                            }
                            t[av++] = aw
                        }
                    }
                }
            }
        }
    }
    var v = g - O.verticalSpacing * (s - 1) - (O.marginTop + O.marginHeight * 2 + O.marginBottom);
    af = 0;
    var ak = [];
    var Z = [];
    var ad = [];
    for (var at = 0; at < s; at++) {
        ak[at] = 0;
        Z[at] = 0
    }
    for (var at = 0; at < s; at++) {
        for (var aq = 0; aq < l; aq++) {
            var aw = DNA.adapter.GridLayoutCalculator._getData(ae, at, aq, s, l, true, O);
            if (aw != null ) {
                var aA = Math.max(1, Math.min(aw.verticalSpan, s));
                if (aA == 1) {
                    var au = aw.cacheHeight + aw.verticalIndent;
                    ak[at] = Math.max(ak[at], au);
                    if (aw.grabExcessVerticalSpace) {
                        if (!ad[at]) {
                            af++
                        }
                        ad[at] = true
                    }
                    if (!aw.grabExcessVerticalSpace || aw.minimumHeight != 0) {
                        au = !aw.grabExcessVerticalSpace || aw.minimumHeight == DNA.JWT.DEFAULT ? aw.cacheHeight : aw.minimumHeight;
                        au += aw.verticalIndent;
                        Z[at] = Math.max(Z[at], au)
                    }
                }
            }
        }
        for (var aq = 0; aq < l; aq++) {
            var aw = DNA.adapter.GridLayoutCalculator._getData(ae, at, aq, s, l, false, O);
            if (aw != null ) {
                var aA = Math.max(1, Math.min(aw.verticalSpan, s));
                if (aA > 1) {
                    var az = 0
                      , ay = 0
                      , m = 0;
                    for (var ao = 0; ao < aA; ao++) {
                        az += ak[at - ao];
                        ay += Z[at - ao];
                        if (ad[at - ao]) {
                            m++
                        }
                    }
                    if (aw.grabExcessVerticalSpace && m == 0) {
                        af++;
                        ad[at] = true
                    }
                    var au = aw.cacheHeight + aw.verticalIndent - az - (aA - 1) * O.verticalSpacing;
                    if (au > 0) {
                        if (m == 0) {
                            ak[at] += au
                        } else {
                            var V = Math.round(au / m);
                            var G = au % m
                              , D = -1;
                            for (var ao = 0; ao < aA; ao++) {
                                if (ad[at - ao]) {
                                    ak[D = at - ao] += V
                                }
                            }
                            if (D > -1) {
                                ak[D] += G
                            }
                        }
                    }
                    if (!aw.grabExcessVerticalSpace || aw.minimumHeight != 0) {
                        au = !aw.grabExcessVerticalSpace || aw.minimumHeight == DNA.JWT.DEFAULT ? aw.cacheHeight : aw.minimumHeight;
                        au += aw.verticalIndent - ay - (aA - 1) * O.verticalSpacing;
                        if (au > 0) {
                            if (m == 0) {
                                Z[at] += au
                            } else {
                                var V = Math.round(au / m);
                                var G = au % m
                                  , D = -1;
                                for (var ao = 0; ao < aA; ao++) {
                                    if (ad[at - ao]) {
                                        Z[D = at - ao] += V
                                    }
                                }
                                if (D > -1) {
                                    Z[D] += G
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    if (g != DNA.JWT.DEFAULT && af > 0) {
        var J = 0;
        for (var at = 0; at < s; at++) {
            J += ak[at]
        }
        var ax = af;
        var V = Math.round((v - J) / ax);
        var G = (v - J) % ax;
        var D = -1;
        while (J - v > 1 || J - v < -1) {
            for (var at = 0; at < s; at++) {
                if (ad[at]) {
                    if (ak[at] + V > Z[at]) {
                        ak[D = at] = ak[at] + V
                    } else {
                        ak[at] = Z[at];
                        ad[at] = false;
                        ax--
                    }
                }
            }
            if (D > -1) {
                ak[D] += G
            }
            for (var at = 0; at < s; at++) {
                for (var aq = 0; aq < l; aq++) {
                    var aw = DNA.adapter.GridLayoutCalculator._getData(ae, at, aq, s, l, false, O);
                    if (aw != null ) {
                        var aA = Math.max(1, Math.min(aw.verticalSpan, s));
                        if (aA > 1) {
                            if (!aw.grabExcessVerticalSpace || aw.minimumHeight != 0) {
                                var az = 0
                                  , m = 0;
                                for (var ao = 0; ao < aA; ao++) {
                                    az += ak[at - ao];
                                    if (ad[at - ao]) {
                                        m++
                                    }
                                }
                                var au = !aw.grabExcessVerticalSpace || aw.minimumHeight == DNA.JWT.DEFAULT ? aw.cacheHeight : aw.minimumHeight;
                                au += aw.verticalIndent - az - (aA - 1) * O.verticalSpacing;
                                if (au > 0) {
                                    if (m == 0) {
                                        ak[at] += au
                                    } else {
                                        var T = Math.round(au / m);
                                        var q = au % m
                                          , M = -1;
                                        for (var ao = 0; ao < aA; ao++) {
                                            if (ad[at - ao]) {
                                                ak[M = at - ao] += T
                                            }
                                        }
                                        if (M > -1) {
                                            ak[M] += q
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            if (ax == 0) {
                break
            }
            J = 0;
            for (var at = 0; at < s; at++) {
                J += ak[at]
            }
            V = Math.round((v - J) / ax);
            G = (v - J) % ax;
            D = -1
        }
    }
    if (A) {
        var ap = Y + O.marginTop + O.marginHeight;
        for (var at = 0; at < s; at++) {
            var ar = aa + O.marginLeft + O.marginWidth;
            for (var aq = 0; aq < l; aq++) {
                var aw = DNA.adapter.GridLayoutCalculator._getData(ae, at, aq, s, l, true, O);
                if (aw != null ) {
                    var al = Math.max(1, Math.min(aw.horizontalSpan, l));
                    var aA = Math.max(1, aw.verticalSpan);
                    var an = 0
                      , am = 0;
                    for (var ao = 0; ao < al; ao++) {
                        an += n[aq + ao]
                    }
                    for (var ao = 0; ao < aA; ao++) {
                        am += ak[at + ao]
                    }
                    an += O.horizontalSpacing * (al - 1);
                    var S = ar + aw.horizontalIndent;
                    var X = Math.min(aw.cacheWidth, an);
                    switch (aw.horizontalAlignment) {
                    case DNA.JWT.LEFT:
                    case DNA.JWT.BEGINNING:
                        break;
                    case DNA.JWT.CENTER1:
                    case DNA.JWT.CENTER:
                        S += Math.max(0, (an - aw.horizontalIndent - X) / 2);
                        break;
                    case DNA.JWT.RIGHT:
                    case DNA.JWT.END1:
                    case DNA.JWT.END:
                        S += Math.max(0, an - aw.horizontalIndent - X);
                        break;
                    case DNA.JWT.FILL:
                        X = an - aw.horizontalIndent;
                        break
                    }
                    am += O.verticalSpacing * (aA - 1);
                    var R = ap + aw.verticalIndent;
                    var ah = Math.min(aw.cacheHeight, am);
                    switch (aw.verticalAlignment) {
                    case DNA.JWT.LEFT:
                    case DNA.JWT.BEGINNING:
                        break;
                    case DNA.JWT.CENTER1:
                    case DNA.JWT.CENTER:
                        R += Math.max(0, (am - aw.verticalIndent - ah) / 2);
                        break;
                    case DNA.JWT.RIGHT:
                    case DNA.JWT.END1:
                    case DNA.JWT.END:
                        R += Math.max(0, am - aw.verticalIndent - ah);
                        break;
                    case DNA.JWT.FILL:
                        ah = am - aw.verticalIndent;
                        break
                    }
                    var o = ae[at][aq];
                    if (o != null ) {
                        if (isNaN(R)) {
                            R = 0
                        }
                        if (isNaN(ah)) {
                            ah = 800
                        }
                        o.setBounds(S, R, X, ah)
                    }
                }
                ar += n[aq] + O.horizontalSpacing
            }
            ap += ak[at] + O.verticalSpacing
        }
    }
    for (var at = 0; at < av; at++) {
        t[at].cacheWidth = t[at].cacheHeight = -1
    }
    var aj = 0;
    var ac = 0;
    for (var at = 0; at < l; at++) {
        aj += n[at]
    }
    for (var at = 0; at < s; at++) {
        ac += ak[at]
    }
    aj += O.horizontalSpacing * (l - 1) + O.marginLeft + O.marginWidth * 2 + O.marginRight;
    ac += O.verticalSpacing * (s - 1) + O.marginTop + O.marginHeight * 2 + O.marginBottom;
    if (A) {
        if (O.widths !== undefined) {
            O.widths = n
        }
        if (O.heights !== undefined) {
            O.heights = ak
        }
    }
    return O.newPoint(aj, ac)
}
;
DNA.adapter.GridLayoutCalculator._computeChildSize = function(g, b, a, h, c) {
    var d = g.getLayoutData();
    if (d == null ) {
        d = c.newData();
        g.setLayoutData(d)
    }
    return DNA.adapter.GridDataCalculator.computeSize(g, b, a, h, d)
}
;
DNA.adapter.GridLayoutCalculator._getData = function(a, r, c, p, o, m, n) {
    var l = a[r][c];
    if (l != null ) {
        var h = l.getLayoutData();
        var b = Math.max(1, Math.min(h.horizontalSpan, o));
        var q = Math.max(1, h.verticalSpan);
        var g = m ? r + q - 1 : r - q + 1;
        var d = m ? c + b - 1 : c - b + 1;
        if (0 <= g && g < p) {
            if (0 <= d && d < o) {
                if (l == a[g][d]) {
                    return h
                }
            }
        }
    }
    return null 
}
;
DNA.adapter.RowLayoutCalculator = function() {}
;
DNA.adapter.RowLayoutCalculator.computeSize = function(m, c, h, g, d) {
    var b = d.getLayoutControls(m);
    var a = [];
    var n = null ;
    if (c != DNA.JWT.DEFAULT && h != DNA.JWT.DEFAULT) {
        n = d.newPoint(c, h)
    } else {
        var l = d.newRectangle(0, 0, c, h);
        if (c != DNA.JWT.DEFAULT) {
            l.width -= d.marginLeft + d.marginRight
        }
        if (h != DNA.JWT.DEFAULT) {
            l.height -= d.marginTop + d.marginBottom
        }
        if (d.fill) {
            n = DNA.adapter.RowLayoutCalculator.processFill(b, a, l, g, d)
        } else {
            if (d.wrap) {
                n = DNA.adapter.RowLayoutCalculator.processWrap(b, a, l, g, d)
            } else {
                n = DNA.adapter.RowLayoutCalculator.proessNormal(b, a, l, g, d)
            }
        }
        if (c == DNA.JWT.DEFAULT) {
            n.x += d.marginLeft + d.marginRight
        }
        if (h == DNA.JWT.DEFAULT) {
            n.y += d.marginTop + d.marginBottom
        }
    }
    return n
}
;
DNA.adapter.RowLayoutCalculator.layout = function(h, g, d) {
    var c = DNA.adapter.RowLayoutCalculator.computeUseSize(h, g, d);
    var a = d.getLayoutControls(h);
    var b = [];
    if (d.fill) {
        DNA.adapter.RowLayoutCalculator.processFill(a, b, c, g, d)
    } else {
        if (d.wrap) {
            DNA.adapter.RowLayoutCalculator.processWrap(a, b, c, g, d)
        } else {
            DNA.adapter.RowLayoutCalculator.proessNormal(a, b, c, g, d)
        }
    }
    DNA.adapter.RowLayoutCalculator.setControlsBounds(a, b, d)
}
;
DNA.adapter.RowLayoutCalculator.flushCache = function(b, a) {
    return true
}
;
DNA.adapter.RowLayoutCalculator.computeUseSize = function(d, c, a) {
    var b = d.getClientArea();
    b.x += a.marginLeft;
    b.y += a.marginTop;
    b.width -= a.marginLeft + a.marginRight;
    b.height -= a.marginTop + a.marginBottom;
    return b
}
;
DNA.adapter.RowLayoutCalculator.processFill = function(b, a, m, l, h) {
    var c = [];
    a.push(c);
    var r = h.newPoint(0, 0);
    var o = h.newRectangle(m.x, m.y, 0, 0);
    var p = DNA.adapter.RowLayoutCalculator.getPackSize(b, l, h);
    for (var g = 0; g < b.length; g++) {
        var d = b[g];
        var n = h.newPoint(o.x, o.y);
        var q = DNA.adapter.RowLayoutCalculator.computeSize2(d, l, p, h);
        if (h.type == DNA.JWT.HORIZONTAL) {
            q.y = m.height;
            c.push(h.newRectangle(n.x, n.y, q.x, q.y));
            o.x += q.x + h.spacing;
            r.x = Math.max(r.x, n.x + q.x);
            r.y = Math.max(r.y, n.y + q.y)
        } else {
            q.x = m.width;
            c.push(h.newRectangle(n.x, n.y, q.x, q.y));
            o.y += q.y + h.spacing;
            r.x = Math.max(r.x, n.x + q.x);
            r.y = Math.max(r.y, n.y + q.y)
        }
    }
    DNA.adapter.RowLayoutCalculator.processJustify(a, m, h);
    return r
}
;
DNA.adapter.RowLayoutCalculator.processWrap = function(b, a, l, h, g) {
    var m = [];
    a.push(m);
    var r = g.newPoint(0, 0);
    var o = g.newRectangle(l.x, l.y, 0, 0);
    var p = DNA.adapter.RowLayoutCalculator.getPackSize(b, h, g);
    for (var d = 0; d < b.length; d++) {
        var c = b[d];
        var n = g.newPoint(o.x, o.y);
        var q = DNA.adapter.RowLayoutCalculator.computeSize2(c, h, p, g);
        if (g.type == DNA.JWT.HORIZONTAL) {
            o.height = Math.max(o.height, q.y);
            if (l.width > 0 && n.x + q.x > l.x + l.width) {
                o.x = l.x;
                o.y += o.height + g.spacing;
                n.x = o.x;
                n.y = o.y;
                m = [];
                a.push(m)
            }
            m.push(g.newRectangle(n.x, n.y, q.x, q.y));
            o.x += q.x + g.spacing;
            r.x = Math.max(r.x, n.x + q.x);
            r.y = Math.max(r.y, n.y + q.y)
        } else {
            o.width = Math.max(o.width, q.x);
            if (l.height > 0 && n.y + q.y > l.y + l.height) {
                o.x += o.width + g.spacing;
                o.y = l.y;
                n.x = o.x;
                n.y = o.y;
                m = [];
                a.push(m)
            }
            m.push(g.newRectangle(n.x, n.y, q.x, q.y));
            o.y += q.y + g.spacing;
            r.x = Math.max(r.x, n.x + q.x);
            r.y = Math.max(r.y, n.y + q.y)
        }
    }
    DNA.adapter.RowLayoutCalculator.processJustify(a, l, g);
    return r
}
;
DNA.adapter.RowLayoutCalculator.proessNormal = function(b, a, m, l, h) {
    var c = [];
    a.push(c);
    var r = h.newPoint(0, 0);
    var o = h.newRectangle(m.x, m.y, 0, 0);
    var p = DNA.adapter.RowLayoutCalculator.getPackSize(b, l, h);
    for (var g = 0; g < b.length; g++) {
        var d = b[g];
        var n = h.newPoint(o.x, o.y);
        var q = DNA.adapter.RowLayoutCalculator.computeSize2(d, l, p, h);
        c.push(h.newRectangle(n.x, n.y, q.x, q.y));
        if (h.type == DNA.JWT.HORIZONTAL) {
            o.x += q.x;
            o.height = Math.max(o.height, q.y);
            r.x = Math.max(r.x, n.x + q.x);
            r.y = Math.max(r.y, n.y + q.y);
            o.x += h.spacing
        } else {
            o.y += q.y + h.spacing;
            o.width = Math.max(o.width, q.x);
            r.x = Math.max(r.x, n.x + q.x);
            r.y = Math.max(r.y, n.y + q.y)
        }
    }
    if (h.justify && b.length > 0) {
        DNA.adapter.RowLayoutCalculator.processJustify(a, m, h)
    }
    return r
}
;
DNA.adapter.RowLayoutCalculator.getPackSize = function(c, l, d) {
    var h = null ;
    if (!d.pack) {
        h = d.newPoint(0, 0);
        for (var b = 0; b < c.length; b++) {
            var g = c[b];
            var a = DNA.adapter.RowLayoutCalculator.computeSize1(g, l, d);
            h.x = Math.max(h.x, a.x);
            h.y = Math.max(h.y, a.y)
        }
    }
    return h
}
;
DNA.adapter.RowLayoutCalculator.processJustify = function(a, n, h) {
    if (!h.justify) {
        return
    }
    if (a == null  || a.length <= 0) {
        return
    }
    for (var d = 0; d < a.length; d++) {
        var l = a[d];
        if (l.length < 1) {
            continue
        }
        var g = 0;
        if (h.type == DNA.JWT.HORIZONTAL) {
            g = n.width - (l[l.length - 1].x + l[l.length - 1].width)
        } else {
            g = n.height - (l[l.length - 1].y + l[l.length - 1].height)
        }
        if (g > 1) {
            var o = g / (l.length + 1);
            var b = 0;
            for (var c = 0; c < l.length; c++) {
                var m = l[c];
                b += Math.ceil(o);
                if (b > g) {
                    break
                }
                if (h.type == DNA.JWT.HORIZONTAL) {
                    m.x += b
                } else {
                    m.y += b
                }
            }
        }
    }
}
;
DNA.adapter.RowLayoutCalculator.setControlsBounds = function(b, a, l) {
    var m = 0;
    for (var h = 0; h < a.length; h++) {
        var n = a[h];
        var o = 0;
        if (l.type == DNA.JWT.HORIZONTAL) {
            for (var c = 0; c < n.length; c++) {
                var p = n[c];
                o = Math.max(o, p.height)
            }
            for (var c = 0; c < n.length; c++) {
                var p = n[c];
                var g = b[m++];
                var d = g.getLayoutData();
                if (d != null  && d.alignment != DNA.JWT.BEGINNING) {
                    if (d.alignment == DNA.JWT.CENTER || d.alignment == DNA.JWT.CENTER1) {
                        g.setBounds(p.x, p.y + (o - p.height) / 2, p.width, p.height)
                    } else {
                        if (d.alignment == DNA.JWT.END || d.alignment == DNA.JWT.END1 || d.alignment == DNA.JWT.RIGHT) {
                            g.setBounds(p.x, p.y + o - p.height, p.width, p.height)
                        } else {
                            if (d.alignment == DNA.JWT.FILL) {
                                g.setBounds(p.x, p.y, p.width, o)
                            }
                        }
                    }
                } else {
                    g.setBounds(p.x, p.y, p.width, p.height)
                }
            }
        } else {
            if (l.type == DNA.JWT.VERTICAL) {
                for (var c = 0; c < n.length; c++) {
                    var p = n[c];
                    o = Math.max(o, p.width)
                }
                for (var c = 0; c < n.length; c++) {
                    var p = n[c];
                    var g = b[m++];
                    var d = g.getLayoutData();
                    if (d != null  && d.alignment != DNA.JWT.BEGINNING) {
                        if (d.alignment == DNA.JWT.CENTER || d.alignment == DNA.JWT.CENTER1) {
                            g.setBounds(p.x + (o - p.width) / 2, p.y, p.width, p.height)
                        } else {
                            if (d.alignment == DNA.JWT.END || d.alignment == DNA.JWT.END1 || d.alignment == DNA.JWT.RIGHT) {
                                g.setBounds(p.x + o - p.width, p.y, p.width, p.height)
                            } else {
                                if (d.alignment == DNA.JWT.FILL) {
                                    g.setBounds(p.x, p.y, o, p.height)
                                }
                            }
                        }
                    } else {
                        g.setBounds(p.x, p.y, p.width, p.height)
                    }
                }
            }
        }
    }
}
;
DNA.adapter.RowLayoutCalculator.computeSize1 = function(g, h, c) {
    var b = DNA.JWT.DEFAULT
      , a = DNA.JWT.DEFAULT;
    var d = g.getLayoutData();
    if (d != null ) {
        b = d.width;
        a = d.height
    }
    return g.computeSize(b, a, h)
}
;
DNA.adapter.RowLayoutCalculator.computeSize2 = function(c, d, b, a) {
    if (b == null ) {
        return DNA.adapter.RowLayoutCalculator.computeSize1(c, d, a)
    } else {
        return a.newPoint(b.x, b.y)
    }
}
;
DNA.adapter.TableLayoutCalculator = function() {}
;
DNA.adapter.TableLayoutCalculator.DEFAULT = -1;
DNA.adapter.TableLayoutCalculator.PERCENT = 0;
DNA.adapter.TableLayoutCalculator.INTEGER = 1;
DNA.adapter.TableLayoutCalculator.BEST = 2;
DNA.adapter.TableLayoutCalculator.computeSize = function(o, b, l, h, g) {
    var m = 0;
    var p = 0;
    if (DNA.adapter.TableLayoutCalculator.isPercent(g.width)) {
        m = 0
    } else {
        if (DNA.adapter.TableLayoutCalculator.isDefault(g.width)) {
            var a = o.getClientArea();
            var d = DNA.adapter.TableLayoutCalculator.computeTableBounds(a, g);
            g.realColumnWidths = DNA.adapter.TableLayoutCalculator.computeColumWidth(d.width, g, o);
            for (var c = 0; c < g.columnWidths.length; c++) {
                var n = g.columnWidths[c];
                if (DNA.adapter.TableLayoutCalculator.isInteger(n)) {
                    m += n
                }
            }
        } else {
            if (DNA.adapter.TableLayoutCalculator.isInteger(g.width)) {
                m = g.width
            }
        }
    }
    if (DNA.adapter.TableLayoutCalculator.isPercent(g.height)) {
        p = 0
    } else {
        if (DNA.adapter.TableLayoutCalculator.isDefault(g.height)) {
            var a = o.getClientArea();
            var d = DNA.adapter.TableLayoutCalculator.computeTableBounds(a, g);
            g.realColumnWidths = DNA.adapter.TableLayoutCalculator.computeColumWidth(d.width, g, o);
            g.realRowHeights = DNA.adapter.TableLayoutCalculator.computeRowHeight(d.height, g, o);
            for (var c = 0; c < g.realRowHeights.length; c++) {
                var n = g.realRowHeights[c];
                if (DNA.adapter.TableLayoutCalculator.isInteger(n)) {
                    p += n
                }
            }
        } else {
            if (DNA.adapter.TableLayoutCalculator.isInteger(g.height)) {
                p = g.height
            }
        }
    }
    return g.newPoint(m, p)
}
;
DNA.adapter.TableLayoutCalculator.layout = function(g, d, b) {
    var c = g.getClientArea();
    var a = DNA.adapter.TableLayoutCalculator.computeTableBounds(c, b);
    DNA.adapter.TableLayoutCalculator.advancedLayout(g, true, a.x, a.y, a.width, a.height, d, b)
}
;
DNA.adapter.TableLayoutCalculator.advancedLayout = function(m, c, b, l, d, a, h, g) {
    if (g.columnWidths.length < 1 || g.rowHeights.length < 1) {
        return
    }
    g.realColumnWidths = DNA.adapter.TableLayoutCalculator.computeColumWidth(d, g, m);
    g.realRowHeights = DNA.adapter.TableLayoutCalculator.computeRowHeight(a, g, m);
    if (c) {
        DNA.adapter.TableLayoutCalculator.setControlsBounds(m, g)
    }
}
;
DNA.adapter.TableLayoutCalculator.computeTableBounds = function(c, b) {
    var a = b.newRectangle(c.x, c.y, 0, 0);
    if (b.width <= 0) {
        a.width = b.width
    } else {
        if (b.width > 0 && b.width <= 1) {
            a.width = c.width * b.width;
            if (b.width == 1) {
                a.width -= b.marginRight
            }
        } else {
            a.width = b.width
        }
    }
    a.width -= b.marginLeft;
    if (b.height <= 0) {
        a.height = b.height
    } else {
        if (b.height > 0 && b.height <= 1) {
            a.height = c.height * b.height;
            if (b.height == 1) {
                a.height -= b.marginBottom
            }
        } else {
            a.height = b.height
        }
    }
    a.height -= b.marginTop;
    a.x = b.marginLeft;
    a.y = b.marginTop;
    return a
}
;
DNA.adapter.TableLayoutCalculator.computeColumWidth = function(b, d, l) {
    var g = [];
    var m = DNA.adapter.TableLayoutCalculator.initNumType(d.columnWidths, d, false);
    var h = 0;
    var c = 0;
    if (d.pixelFirst) {
        h = DNA.adapter.TableLayoutCalculator.computeInteger(g, m, d.columnWidths, b, d, l);
        c = DNA.adapter.TableLayoutCalculator.computePercent(g, m, d.columnWidths, b, b - h, d, false)
    } else {
        c = DNA.adapter.TableLayoutCalculator.computePercent(g, m, d.columnWidths, b, b, d);
        h = DNA.adapter.TableLayoutCalculator.computeInteger(g, m, d.columnWidths, b - c, d, l, false)
    }
    var n = DNA.adapter.TableLayoutCalculator.computeDefault(g, m, d.columnWidths, b - c - h, d);
    var a = b - c - h - n;
    if (a > 0) {
        g[g.length - 1] += a
    }
    return g
}
;
DNA.adapter.TableLayoutCalculator.computeRowHeight = function(d, l, n) {
    var c = [];
    var g = DNA.adapter.TableLayoutCalculator.initNumType(l.rowHeights, l, true);
    var m = 0;
    var h = 0;
    if (l.pixelFirst) {
        h = DNA.adapter.TableLayoutCalculator.computeInteger(c, g, l.rowHeights, d, l, n, true);
        m = DNA.adapter.TableLayoutCalculator.computePercent(c, g, l.rowHeights, d, d - h, l)
    } else {
        m = DNA.adapter.TableLayoutCalculator.computePercent(c, g, l.rowHeights, d, d, l);
        h = DNA.adapter.TableLayoutCalculator.computeInteger(c, g, l.rowHeights, d - m, l, n, true)
    }
    var a = DNA.adapter.TableLayoutCalculator.computeDefault(c, g, l.rowHeights, d - m - h, l);
    var b = d - m - h - a;
    if (b > 0) {
        c[c.length - 1] += b
    }
    return c
}
;
DNA.adapter.TableLayoutCalculator.initNumType = function(c, g, b) {
    var a = g.newIntegerArray(c.length);
    for (var d = 0; d < c.length; d++) {
        if (c[d] > 0 && c[d] <= 1) {
            a[d] = DNA.adapter.TableLayoutCalculator.PERCENT
        } else {
            if (g.pixelFirst && (b ? g.height < 0 : g.width < 0) && c[d] === -1) {
                a[d] = DNA.adapter.TableLayoutCalculator.BEST
            } else {
                if (c[d] <= 0) {
                    a[d] = DNA.adapter.TableLayoutCalculator.DEFAULT
                } else {
                    a[d] = DNA.adapter.TableLayoutCalculator.INTEGER
                }
            }
        }
    }
    return a
}
;
DNA.adapter.TableLayoutCalculator.hasPercent = function(c, b) {
    for (var a = 0; a < c.length; a++) {
        if (c[a] > 0 && c[a] <= 1) {
            return true
        }
    }
    return false
}
;
DNA.adapter.TableLayoutCalculator.hasDefault = function(c, b) {
    for (var a = 0; a < c.length; a++) {
        if (c[a] <= 0) {
            return true
        }
    }
    return false
}
;
DNA.adapter.TableLayoutCalculator.hasInteger = function(c, b) {
    for (var a = 0; a < c.length; a++) {
        if (c[a] > 1) {
            return true
        }
    }
    return false
}
;
DNA.adapter.TableLayoutCalculator.computePercent = function(b, m, q, o, p, h) {
    var c = DNA.adapter.TableLayoutCalculator.hasPercent(q, h);
    var g = DNA.adapter.TableLayoutCalculator.hasDefault(q, h);
    var a = DNA.adapter.TableLayoutCalculator.hasInteger(q, h);
    var n = 0;
    var l = 0;
    for (var d = 0; d < q.length; d++) {
        if (m[d] == DNA.adapter.TableLayoutCalculator.PERCENT) {
            l += q[d]
        }
    }
    if (o <= 0) {
        for (var d = 0; d < q.length; d++) {
            if (m[d] == DNA.adapter.TableLayoutCalculator.PERCENT) {
                b[d] = 0
            }
        }
    } else {
        if (c) {
            for (var d = 0; d < q.length; d++) {
                if (m[d] == DNA.adapter.TableLayoutCalculator.PERCENT) {
                    if (h.pixelFirst) {
                        if (l * o > p) {
                            b[d] = p * (q[d] / l);
                            n += b[d]
                        } else {
                            if (g) {
                                b[d] = o * q[d];
                                n += b[d]
                            } else {
                                b[d] = p * (q[d] / l);
                                n += b[d]
                            }
                        }
                    } else {
                        if (l >= 1) {
                            b[d] = o * (q[d] / l);
                            n += b[d]
                        } else {
                            if (a || g) {
                                b[d] = o * q[d];
                                n += b[d]
                            } else {
                                b[d] = o * (q[d] / l);
                                n += b[d]
                            }
                        }
                    }
                }
            }
        }
    }
    return n
}
;
DNA.adapter.TableLayoutCalculator.getTruelyLayoutControls = function(c, g) {
    var b = g.getLayoutControls(c);
    var m = [];
    var d = 0;
    for (var a = 0; a < b.length; a++) {
        var l = b[a];
        var h = l.getLayoutData();
        if (h == null  || !h.exclude) {
            m[d++] = l
        }
    }
    return m
}
;
DNA.adapter.TableLayoutCalculator.computeTableCellsControlIndex = function(g) {
    cellInfos = g.cellInfos;
    var m = cellInfos[0].length;
    var d = cellInfos.length;
    var c = 0;
    var b = [];
    for (var a = 0; a < d; a++) {
        for (var l = 0; l < m; l++) {
            var h = cellInfos[a][l];
            if (!b[a]) {
                b[a] = []
            }
            if (h.ignore) {
                b[a][l] = -1
            } else {
                if (h.isSpan) {
                    b[a][l] = -2
                } else {
                    b[a][l] = c++
                }
            }
        }
    }
    return b
}
;
DNA.adapter.TableLayoutCalculator.getControlsByCellIndex = function(m, l, d) {
    if (l == null ) {
        return null 
    }
    var b = this.getTruelyLayoutControls(m, d);
    var c = this.computeTableCellsControlIndex(d);
    var n = [];
    var h = 0;
    for (var o = 0; o < l.length; o++) {
        for (var a = 0; a < l[0].length; a++) {
            if (l[o][a] && c[o][a] > -1) {
                var g = c[o][a];
                if (g <= b.length - 1) {
                    n[h++] = b[g]
                }
            }
        }
    }
    return n
}
;
DNA.adapter.TableLayoutCalculator.getBestSizeByControls = function(n, h, g, q) {
    if (n == null  || n.length == 0) {
        return 0
    }
    var l = 0;
    var m = null ;
    if (h && g.realColumnWidths) {
        var o = g.cellInfos[q];
        m = [];
        for (var d = 0; d < o.length; d++) {
            m[d] = 0;
            if (o[d].columnSpan > 1) {
                for (var b = 0; b < o[d].columnSpan; b++) {
                    m[d] += g.realColumnWidths[d + b]
                }
            } else {
                m[d] += g.realColumnWidths[d]
            }
        }
    }
    for (var d = 0; d < n.length; d++) {
        var a = n[d].computeSize(m ? m[d] : -1, -1, true);
        var c = n[d].getLayoutData();
        l = Math.max(l, h ? a.y + (c ? c.verticalIndent : 0) : a.x + (c ? c.horizontalIndent : 0))
    }
    return l
}
;
DNA.adapter.TableLayoutCalculator.computeInteger = function(g, m, r, w, u, h, t) {
    var d = DNA.adapter.TableLayoutCalculator.hasPercent(r, u);
    var B = DNA.adapter.TableLayoutCalculator.hasDefault(r, u);
    var A = DNA.adapter.TableLayoutCalculator.hasInteger(r, u);
    var q = 0;
    if (w <= 0) {
        for (var s = 0; s < r.length; s++) {
            if (m[s] == DNA.adapter.TableLayoutCalculator.BEST && u.pixelFirst) {
                var a = u.cellInfos;
                var l = a.length;
                var p = a[0].length;
                var n = [];
                for (var z = 0; z < l; z++) {
                    for (var v = 0; v < p; v++) {
                        if (!n[z]) {
                            n[z] = []
                        }
                        var c = t ? z : v;
                        if (c == s) {
                            n[z][v] = true
                        } else {
                            n[z][v] = false
                        }
                    }
                }
                var o = this.getControlsByCellIndex(h, n, u);
                g[s] = this.getBestSizeByControls(o, t, u, s);
                q += g[s]
            } else {
                if (m[s] == DNA.adapter.TableLayoutCalculator.INTEGER) {
                    g[s] = r[s];
                    q += g[s]
                }
            }
        }
    } else {
        if (A) {
            if (B || (d && u.pixelFirst)) {
                var b = 0;
                for (var s = 0; s < r.length; s++) {
                    if (m[s] == DNA.adapter.TableLayoutCalculator.INTEGER) {
                        b += r[s]
                    }
                }
                if (b > w) {
                    for (var s = 0; s < r.length; s++) {
                        if (m[s] == DNA.adapter.TableLayoutCalculator.INTEGER) {
                            g[s] = (r[s] / b) * w;
                            q += g[s]
                        }
                    }
                } else {
                    for (var s = 0; s < r.length; s++) {
                        if (m[s] == DNA.adapter.TableLayoutCalculator.INTEGER) {
                            g[s] = r[s];
                            q += g[s]
                        }
                    }
                }
            } else {
                var b = 0;
                for (var s = 0; s < r.length; s++) {
                    if (m[s] == DNA.adapter.TableLayoutCalculator.INTEGER) {
                        b += r[s]
                    }
                }
                for (var s = 0; s < r.length; s++) {
                    if (m[s] == DNA.adapter.TableLayoutCalculator.INTEGER) {
                        g[s] = (r[s] / b) * w;
                        q += g[s]
                    }
                }
            }
        }
    }
    return q
}
;
DNA.adapter.TableLayoutCalculator.computeDefault = function(a, h, n, m, g) {
    var l = 0;
    var d = DNA.adapter.TableLayoutCalculator.hasDefault(n, g);
    if (m <= 0) {
        for (var c = 0; c < n.length; c++) {
            if (h[c] == DNA.adapter.TableLayoutCalculator.DEFAULT) {
                a[c] = 0
            }
        }
    } else {
        if (d) {
            var b = 0;
            for (var c = 0; c < n.length; c++) {
                if (h[c] == DNA.adapter.TableLayoutCalculator.DEFAULT) {
                    b++
                }
            }
            for (var c = 0; c < n.length; c++) {
                if (h[c] == DNA.adapter.TableLayoutCalculator.DEFAULT) {
                    a[c] = m / b;
                    l += a[c]
                }
            }
        }
    }
    return l
}
;
DNA.adapter.TableLayoutCalculator.setControlsBounds = function(s, o) {
    var b = o.getLayoutControls(s);
    var d = -1;
    for (var l = 0; l < o.rowHeights.length; l++) {
        for (var g = 0; g < o.columnWidths.length; g++) {
            var c = o.cellInfos[l][g];
            if (c.isSpan == true) {
                continue
            }
            if (c.ignore == true) {
                continue
            }
            d = DNA.adapter.TableLayoutCalculator.getNextControlIndex(b, d, o);
            if (d >= b.length) {
                break
            }
            var q = DNA.adapter.TableLayoutCalculator.getXByColumn(g, o);
            var p = DNA.adapter.TableLayoutCalculator.getYByRow(l, o);
            var r = DNA.adapter.TableLayoutCalculator.getColumnSpanWidth(g, c.columnSpan, o);
            var n = DNA.adapter.TableLayoutCalculator.getRowSpanHeight(l, c.rowSpan, o);
            var m = s.getClientArea();
            var a = DNA.adapter.TableLayoutCalculator.getControlBoundsByTableData(b[d], q, p, r, n, o);
            b[d].setBounds(m.x + a.x + o.marginLeft, m.y + a.y + o.marginTop, a.width, a.height)
        }
    }
}
;
DNA.adapter.TableLayoutCalculator.getXByColumn = function(b, d) {
    var c = 0;
    for (var a = 0; a < b; a++) {
        c += d.realColumnWidths[a]
    }
    return c
}
;
DNA.adapter.TableLayoutCalculator.getYByRow = function(d, c) {
    var b = 0;
    for (var a = 0; a < d; a++) {
        b += c.realRowHeights[a]
    }
    return b
}
;
DNA.adapter.TableLayoutCalculator.getColumnSpanWidth = function(d, c, g) {
    var a = 0;
    for (var b = d; b < d + c && b < g.columnWidths.length; b++) {
        a += g.realColumnWidths[b]
    }
    return a
}
;
DNA.adapter.TableLayoutCalculator.getRowSpanHeight = function(g, c, d) {
    var b = 0;
    for (var a = g; a < g + c && a < d.rowHeights.length; a++) {
        b += d.realRowHeights[a]
    }
    return b
}
;
DNA.adapter.TableLayoutCalculator.getNextControlIndex = function(a, g, b) {
    g++;
    for (; g < a.length; g++) {
        var d = a[g];
        var c = d.getLayoutData();
        if (c == null ) {
            break
        } else {
            if (c.exclude) {
                continue
            } else {
                break
            }
        }
    }
    return g
}
;
DNA.adapter.TableLayoutCalculator.isDefault = function(a) {
    if (a <= 0) {
        return true
    } else {
        return false
    }
}
;
DNA.adapter.TableLayoutCalculator.isPercent = function(a) {
    if (a > 0 && a <= 1) {
        return true
    } else {
        return false
    }
}
;
DNA.adapter.TableLayoutCalculator.isInteger = function(a) {
    if (a > 1) {
        return true
    } else {
        return false
    }
}
;
DNA.adapter.TableLayoutCalculator.getControlBoundsByTableData = function(c, m, l, b, p, g) {
    var d = c.getLayoutData();
    if (d == null ) {
        d = g.newData()
    }
    var o = DNA.adapter.TableLayoutCalculator.comupteControlSize(c, d.width, d.height, g);
    var a = g.newRectangle(m, l, 0, 0);
    if (d.horizontalAlignment == DNA.JWT.BEGINNING) {
        a.x += d.horizontalIndent;
        a.width = Math.min(b - d.horizontalIndent, o.x)
    } else {
        if (d.horizontalAlignment == DNA.JWT.CENTER) {
            var n = Math.min(b - d.horizontalIndent, o.x);
            a.x += d.horizontalIndent + (b - d.horizontalIndent - n) / 2;
            a.width += n
        } else {
            if (d.horizontalAlignment == DNA.JWT.END) {
                a.x += b - Math.min(b, o.x);
                a.width = Math.min(b, o.x)
            } else {
                if (d.horizontalAlignment == DNA.JWT.FILL) {
                    a.x += d.horizontalIndent;
                    a.width = b - d.horizontalIndent
                }
            }
        }
    }
    if (d.verticalAlignment == DNA.JWT.BEGINNING) {
        a.y += d.verticalIndent;
        a.height = Math.min(p - d.verticalIndent, o.y)
    } else {
        if (d.verticalAlignment == DNA.JWT.CENTER) {
            var h = Math.min(p - d.verticalIndent, o.y);
            a.y += d.verticalIndent + (p - d.verticalIndent - h) / 2;
            a.height += h
        } else {
            if (d.verticalAlignment == DNA.JWT.END) {
                a.y += p - Math.min(p, o.y);
                a.height = Math.min(p, o.y)
            } else {
                if (d.verticalAlignment == DNA.JWT.FILL) {
                    a.y += d.verticalIndent;
                    a.height = p - d.verticalIndent
                }
            }
        }
    }
    return a
}
;
DNA.adapter.TableLayoutCalculator.comupteControlSize = function(d, b, a, c) {
    if (b <= 0) {
        b = DNA.JWT.DEFAULT
    }
    if (a <= 0) {
        a = DNA.JWT.DEFAULT
    }
    if (b != DNA.JWT.DEFAULT && a != DNA.JWT.DEFAULT) {
        return c.newPoint(b, a)
    } else {
        return d.computeSize(b, a, false)
    }
}
;
function _Classes() {
    if (typeof (_classes) != "undefined") {
        throw ("Only one instance of _Classes() can be created")
    }
    function registerClass(className, parentClassName) {
        if (!className) {
            throw ("xbObjects.js:_Classes::registerClass: className missing")
        }
        if (className in _classes) {
            return
        }
        if (className != "xbObject" && !parentClassName) {
            parentClassName = "xbObject"
        }
        if (!parentClassName) {
            parentClassName = null 
        } else {
            if (!(parentClassName in _classes)) {
                throw ("xbObjects.js:_Classes::registerClass: parentClassName " + parentClassName + " not defined")
            }
        }
        _classes[className] = {
            classConstructor: null ,
            parentClassName: parentClassName
        }
    }
    _Classes.prototype.registerClass = registerClass;
    function defineClass(className, prototype_func) {
        var p;
        if (!className) {
            throw ("xbObjects.js:_Classes::defineClass: className not given")
        }
        var classRef = _classes[className];
        if (!classRef) {
            throw ("xbObjects.js:_Classes::defineClass: className " + className + " not registered")
        }
        if (classRef.classConstructor) {
            return
        }
        classRef.classConstructor = eval(className);
        var childPrototype = classRef.classConstructor.prototype;
        var parentClassName = classRef.parentClassName;
        if (parentClassName) {
            var parentClassRef = _classes[parentClassName];
            if (!parentClassRef) {
                throw ("xbObjects.js:_Classes::defineClass: parentClassName " + parentClassName + " not registered")
            }
            if (!parentClassRef.classConstructor) {
                var dummy;
                eval("dummy = new " + parentClassName + "();")
            }
            var parentPrototype = parentClassRef.classConstructor.prototype;
            for (p in parentPrototype) {
                switch (p) {
                case "isa":
                case "classRef":
                case "parentPrototype":
                case "parentConstructor":
                case "inheritedFrom":
                    break;
                default:
                    childPrototype[p] = parentPrototype[p];
                    break
                }
            }
        }
        prototype_func();
        childPrototype.isa = className;
        childPrototype.classRef = classRef;
        childPrototype.inheritedFrom = new Object();
        if (parentClassName) {
            for (p in parentPrototype) {
                switch (p) {
                case "isa":
                case "classRef":
                case "parentPrototype":
                case "parentConstructor":
                case "inheritedFrom":
                    break;
                default:
                    if (childPrototype[p] == parentPrototype[p] && parentPrototype.inheritedFrom[p]) {
                        childPrototype.inheritedFrom[p] = parentPrototype.inheritedFrom[p]
                    } else {
                        childPrototype.inheritedFrom[p] = parentClassName
                    }
                    break
                }
            }
        }
    }
    _Classes.prototype.defineClass = defineClass
}
var _classes = new _Classes();
_classes.registerClass("xbObject");
function xbObject() {
    _classes.defineClass("xbObject", a);
    this.init();
    function a() {
        xbObject.prototype.isa = null ;
        xbObject.prototype.classRef = null ;
        xbObject.prototype.inheritedFrom = new Object();
        function g() {}
        xbObject.prototype.init = g;
        function d() {}
        xbObject.prototype.destroy = d;
        function c(h, v, u, t, s, r, q, p, o, n, l) {
            var z = this.isa;
            var w = _classes[z].classConstructor.prototype.inheritedFrom[h];
            var A = _classes[w].classConstructor.prototype[h];
            this.isa = w;
            var m = A.call(this, v, u, t, s, r, q, p, o, n, l);
            this.isa = z;
            return m
        }
        xbObject.prototype.parentMethod = c;
        function b(h) {
            var l = this.isa;
            var m = h.prototype.isa;
            while (l) {
                if (l == m) {
                    return true
                }
                l = _classes[l].parentClassName
            }
            return false
        }
        xbObject.prototype.isInstanceOf = b
    }
}
Util = {};
(function(d) {
    if (d.browser) {
        return
    }
    var b = navigator.userAgent;
    d.browser = {
        version: (b.match(/.+(?:rv|it|ra|ie|me)[\/: ]([\d.]+)/i) || [])[1],
        ie: /msie/i.test(b) && !/opera/i.test(b),
        op: /opera/i.test(b),
        sa: /version.*safari/i.test(b),
        ch: /chrome/.test(b),
        ff: /gecko/i.test(b) && !/webkit/i.test(b),
        wk: /webkit/i.test(b),
        mz: /mozilla/i.test(b) && !/(compatible|webkit)/i.test(b)
    };
    function a() {
        return navigator.userAgent.match(/iP(ad|hone)/i) || navigator.userAgent.match(/ndroid/i)
    }
    d.browser.isMobile = a();
    function c() {
        if (!!window.ActiveXObject || "ActiveXObject" in window) {
            return true
        } else {
            return false
        }
    }
    if (!d.browser.ie) {
        d.browser.ie = c()
    }
})(Util);
Util.isInstanceOf = function(b, a) {
    if (b.isInstanceOf) {
        return b.isInstanceOf(a)
    }
}
;
Util.Array = Util.Array || {};
Util.Array.add = function(c, b, a) {
    if (a != null  && b != null ) {
        c.splice(a, 0, b)
    } else {
        if (b != null  && a == null ) {
            c.push(b)
        }
    }
}
;
Util.Array.contains = function(c, b) {
    for (var a = 0; a < c.length; a++) {
        if (c[a] == b) {
            return true
        }
    }
    return false
}
;
Util.Array.isEmpty = function(a) {
    return a == null  || a.length == 0
}
;
Util.Array.indexOf = function(c, b) {
    for (var a = 0; a < c.length; a++) {
        if (c[a] == b) {
            return a
        }
    }
    return -1
}
;
Util.Array.removeItem = function(g, d) {
    var b;
    for (var c = 0, a = g.length; c < a; c++) {
        if (g[c] == d) {
            b = g[c];
            g.splice(c, 1);
            return b
        }
    }
}
;
Util.Array.remove = function(b, a) {
    b.splice(a, 1)
}
;
Util.Array.addAll = function(a, c) {
    for (var b = 0; b < c.length; b++) {
        a.push(c[b])
    }
}
;
var Debugger = function() {
    function b() {}
    var d = {
        error: b,
        log: b
    };
    function c() {
        if (console && console.error) {
            d.error = function(g) {
                console.error(g)
            }
        }
        if (console && console.log) {
            d.log = function(g) {
                console.log(g)
            }
        }
    }
    function a() {
        d.error = b;
        d.log = b
    }
    if (Util.browser.ie) {} else {
        c()
    }
    d.lock = a;
    d.unlock = c;
    return d
}();
_classes.registerClass("Canvas");
function Canvas(a) {
    if (typeof Canvas._initialized == "undefined") {
        function b() {
            Canvas.prototype.addControllListener = function(c) {
                if (c == null ) {
                    return
                }
                this.controllListeners.push(c)
            }
            ;
            Canvas.prototype.addMouseListener = function(c) {
                if (c == null ) {
                    return
                }
                this.mouseListeners.push(c)
            }
            ;
            Canvas.prototype.addKeyListener = function(c) {
                if (c == null ) {
                    return
                }
                this.keyListeners.push(c)
            }
            ;
            Canvas.prototype.addDisposeListener = function(c) {
                if (c == null ) {
                    return
                }
                this.disposeListeners.push(c)
            }
            ;
            Canvas.prototype.get2dContext = function() {
                return this.canvasElement.getContext("2d")
            }
            ;
            Canvas.prototype.getClientArea = function() {
                return new Rectangle(0,0,this.canvasElement.width,this.canvasElement.height)
            }
            ;
            Canvas.prototype.getHeight = function() {
                return this.canvasElement.height
            }
            ;
            Canvas.prototype.getSize = function() {
                return new Dimension(this.canvasElement.width,this.canvasElement.height)
            }
            ;
            Canvas.prototype.getWidth = function() {
                return this.canvasElement.width
            }
            ;
            Canvas.prototype.getClipping = function() {
                return new Rectangle(0,0,this.canvasElement.width,this.canvasElement.height)
            }
            ;
            Canvas.prototype.open = function() {
                var c;
                for (c = 0; c < this.controllListeners.length; c++) {
                    this.controllListeners[c].controlResized()
                }
            }
            ;
            Canvas.prototype.dispose = function() {
                var c;
                for (c = 0; c < this.disposeListeners.length; c++) {
                    this.disposeListeners[c].widgetDisposed()
                }
            }
            ;
            Canvas.prototype.registerEvent = function() {
                var c = this;
                function d(l, h, g) {
                    (l.attachEvent) ? (l.attachEvent("on" + h, g)) : (l.addEventListener(h, g, false))
                }
                d(document, "keypress", function(g) {
                    c.keyPressed(g)
                });
                d(document, "keyup", function(g) {
                    c.keyReleased(g)
                });
                d(document, "keydown", function(g) {
                    c.keyDown(g)
                });
                d(this.canvasElement, "dblclick", function(h) {
                    if (c.clickTimer != null ) {
                        for (var g = 0; g < c.clickTimer.length; g++) {
                            clearTimeout(c.clickTimer[g])
                        }
                        c.clickTimer = []
                    }
                    c.mouseDoubleClick(h)
                });
                d(this.canvasElement, "click", function(h) {
                    if (c.clickTimer == null ) {
                        c.clickTimer = []
                    }
                    var g = c.parse(h);
                    c.clickTimer.push(setTimeout(function() {
                        c._fireMouseEvent("click", g)
                    }, 250))
                });
                d(this.canvasElement, "selectstart", function(g) {
                    if (g.preventDefault) {
                        g.preventDefault()
                    } else {
                        g.returnValue = false
                    }
                    if (g.stopPropagation) {
                        g.stopPropagation()
                    }
                });
                d(this.canvasElement, "mousedown", function(g) {
                    c._clearMouseHover(g);
                    c.mouseDown(g)
                });
                d(this.canvasElement, "mouseout", function(g) {
                    c._clearMouseHover(g);
                    c.mouseExit(g)
                });
                d(this.canvasElement, "mouseover", function(g) {});
                d(this.canvasElement, "mousemove", function(g) {
                    c._resetMouseHover(g);
                    c.mouseMove(g)
                });
                d(this.canvasElement, "mouseup", function(g) {
                    c._resetMouseHover(g);
                    c.mouseUp(g)
                })
            }
            ;
            Canvas.prototype._resetMouseHover = function(c) {
                this._clearMouseHover();
                this._beginMouseHover(c)
            }
            ;
            Canvas.prototype._beginMouseHover = function(g) {
                var d = this;
                var c = this.parse(g);
                this.hoverTimer = setTimeout(function() {
                    d._fireMouseEvent("mouseHover", c)
                }, Canvas.HOVER_TIME)
            }
            ;
            Canvas.prototype._clearMouseHover = function() {
                if (this.hoverTimer) {
                    clearTimeout(this.hoverTimer)
                }
            }
            ;
            Canvas.prototype.keyPressed = function(d) {
                for (var c = 0; c < this.keyListeners.length; c++) {
                    this.keyListeners[c].keyPressed(d)
                }
            }
            ;
            Canvas.prototype.keyDown = function(d) {
                for (var c = 0; c < this.keyListeners.length; c++) {
                    this.keyListeners[c].keyDown(d)
                }
            }
            ;
            Canvas.prototype.keyReleased = function(d) {
                for (var c = 0; c < this.keyListeners.length; c++) {
                    this.keyListeners[c].keyReleased(d)
                }
            }
            ;
            Canvas.prototype.getEvLocation = function(h) {
                var c = 0;
                var l = 0;
                var g = h.target || h.srcElement;
                if (Util.browser.ie || Util.browser.wk) {
                    c = h.offsetX;
                    l = h.offsetY
                } else {
                    c = h.layerX;
                    l = h.layerY;
                    while (g.offsetParent && g.style.position != "absolute" && g.style.position != "relative") {
                        g = g.offsetParent
                    }
                }
                c += g.offsetLeft;
                l += g.offsetTop;
                var d = g.offsetParent;
                while (d != null  && d != this.element) {
                    c += d.offsetLeft;
                    l += d.offsetTop;
                    d = d.offsetParent
                }
                return new Point(c,l)
            }
            ;
            Canvas.prototype.parse = function(g) {
                var d = this.getEvLocation(g);
                var c = new Html5Event(this);
                c.setLocation(d);
                c.stateMask = this.stateMask;
                c.localX = d.x;
                c.localY = d.y;
                c.type = g.type;
                c.button = this.getMouseButton(g);
                c.altKey = g.altKey;
                c.ctrlKey = g.ctrlKey;
                c.shiftKey = g.shiftKey;
                return c
            }
            ;
            Canvas.prototype.getMouseButton = function(c) {
                if (Util.browser.ff) {
                    return c.buttons
                } else {
                    if (Util.browser.ie) {
                        return c.button
                    } else {
                        if (Util.browser.wk) {
                            if (c.which === 1) {
                                return Canvas.BUTTON_LEFT
                            } else {
                                if (c.which === 2) {
                                    return Canvas.BUTTON_CENTER
                                } else {
                                    if (c.which === 3) {
                                        return Canvas.BUTTON_RIGHT
                                    }
                                }
                            }
                        }
                    }
                }
                return Canvas.BUTTON_NONE
            }
            ;
            Canvas.prototype.mouseDoubleClick = function(g) {
                var d = this.parse(g);
                for (var c = 0; c < this.mouseListeners.length; c++) {
                    this.mouseListeners[c].mouseDoubleClick(d)
                }
            }
            ;
            Canvas.prototype.mouseDown = function(g) {
                var d = this.parse(g);
                for (var c = 0; c < this.mouseListeners.length; c++) {
                    this.mouseListeners[c].mouseDown(d)
                }
            }
            ;
            Canvas.prototype.click = function(d) {
                var c = this.parse(d);
                this._fireMouseEvent("click", c)
            }
            ;
            Canvas.prototype._fireMouseEvent = function(d, g) {
                try {
                    var h;
                    for (var c = 0; c < this.mouseListeners.length; c++) {
                        h = this.mouseListeners[c];
                        if (h[d]) {
                            h[d](g)
                        }
                    }
                } catch (l) {
                    Debugger.error(l)
                }
            }
            ,
            Canvas.prototype.mouseHover = function() {
                var d = this.parse(e);
                for (var c = 0; c < this.mouseListeners.length; c++) {
                    this.mouseListeners[c].mouseHover(d)
                }
            }
            ;
            Canvas.prototype.mouseExit = function(g) {
                return;
                var d = this.parse(g);
                for (var c = 0; c < this.mouseListeners.length; c++) {
                    this.mouseListeners[c].mouseExit(d)
                }
            }
            ;
            Canvas.prototype.mouseHover = function(g) {
                var d = this.parse(g);
                for (var c = 0; c < this.mouseListeners.length; c++) {
                    this.mouseListeners[c].mouseHover(d)
                }
            }
            ;
            Canvas.prototype.mouseMove = function(g) {
                var d = this.parse(g);
                for (var c = 0; c < this.mouseListeners.length; c++) {
                    this.mouseListeners[c].mouseMove(d)
                }
            }
            ;
            Canvas.prototype.mouseUp = function(g) {
                var d = this.parse(g);
                d.button = Canvas.BUTTON_LEFT;
                for (var c = 0; c < this.mouseListeners.length; c++) {
                    this.mouseListeners[c].mouseUp(d)
                }
            }
            ;
            Canvas.prototype.toDisplay = function(d, c) {
                if (d == null ) {
                    return
                }
                if (Util.isInstanceOf(d, Point)) {
                    return d
                } else {
                    return new Point(d,c)
                }
            }
            ;
            Canvas.prototype.resize = function(c, g) {
                this.canvasElement.width = c;
                this.canvasElement.height = g;
                for (var d = 0; d < this.controllListeners.length; d++) {
                    this.controllListeners[d].controlResized()
                }
            }
            ;
            Canvas.prototype.isDisposed = function() {
                return this.canvasElement == null 
            }
            ;
            Canvas.prototype.setCursor = function(c) {
                this.canvasElement.style.cursor = c
            }
            ;
            Canvas.prototype.getParent = function() {
                return this.canvasElement.parentNode
            }
            ;
            Canvas.prototype.init = function(c) {
                this.parentMethod("init");
                this.canvasElement = c;
                this.context = this.canvasElement.getContext("2d");
                this.controllListeners = [];
                this.mouseListeners = [];
                this.keyListeners = [];
                this.disposeListeners = [];
                this.registerEvent();
                this.button = Canvas.BUTTON_NONE;
                this.stateMask = 0
            }
        }
        Canvas._initialized = true;
        _classes.defineClass("Canvas", b)
    }
    this.init(a)
}
Canvas.BUTTON_NONE = 0;
Canvas.BUTTON_LEFT = 1;
Canvas.BUTTON_CENTER = 4;
Canvas.BUTTON_RIGHT = 2;
Canvas.HOVER_TIME = 800;
_classes.registerClass("Html5Event");
function Html5Event(a) {
    if (typeof Html5Event._initialized == "undefined") {
        function b() {
            Html5Event.prototype.getSource = function() {
                return this.source
            }
            ;
            Html5Event.prototype.setLocation = function(d, c) {
                if (d == null ) {
                    return
                }
                if (Util.isInstanceOf(d, Point)) {
                    this.x = d.x;
                    this.y = d.y
                } else {
                    this.x = d;
                    this.y = c
                }
            }
            ;
            Html5Event.prototype.getLocation = function() {
                return new Point(this.x,this.y)
            }
            ;
            Html5Event.prototype.init = function(c) {
                this.parentMethod("init");
                this.source = c;
                this.button = null ;
                this.stateMask = null ;
                this.x = null ;
                this.y = null ;
                this.keyCode = null ;
                this.character = null 
            }
        }
        Html5Event._initialized = true;
        _classes.defineClass("Html5Event", b)
    }
    this.init(a)
}
_classes.registerClass("Map");
function Map() {
    if (typeof Map._initialized == "undefined") {
        function a() {
            Map.prototype.size = function() {
                return this.length
            }
            ;
            Map.prototype.put = function(c, d) {
                var b = this.containsKey(c);
                if (b >= 0) {
                    this.map[b + 1] = d
                } else {
                    ++this.length;
                    this.map.push(c);
                    this.map.push(d)
                }
            }
            ;
            Map.prototype.remove = function(d) {
                var c = this.containsKey(d);
                if (c >= 0) {
                    --this.length;
                    var b = this.map[c + 1];
                    this.map.splice(c, 2);
                    return b
                } else {
                    return false
                }
            }
            ;
            Map.prototype.containsKey = function(c) {
                var b;
                for (b = 0; b < this.map.length; b += 2) {
                    if (this.map[b] == c) {
                        return b
                    }
                }
                return -1
            }
            ;
            Map.prototype.get = function(c) {
                var b = this.containsKey(c);
                if (b >= 0) {
                    return this.map[b + 1]
                }
            }
            ;
            Map.prototype.isEmpty = function() {
                return this.length == 0
            }
            ;
            Map.prototype.keySetIterator = function() {
                return new MapIterator(this.map,"key")
            }
            ;
            Map.prototype.valueSetIterator = function() {
                return new MapIterator(this.map,"value")
            }
            ;
            Map.prototype.init = function() {
                this.map = [];
                this.length = 0
            }
        }
        Map._initialized = true;
        _classes.defineClass("Map", a)
    }
    this.init()
}
_classes.registerClass("MapIterator");
function MapIterator(a, b) {
    if (typeof MapIterator._initialized == "undefined") {
        function c() {
            MapIterator.prototype.next = function() {
                var d = this._items[this._index];
                this._index += 2;
                return d
            }
            ;
            MapIterator.prototype.hasNext = function() {
                if (!this._items) {
                    return false
                }
                if (this._index + 2 <= this._items.length) {
                    return true
                } else {
                    return false
                }
            }
            ;
            MapIterator.prototype.init = function(d, g) {
                this._items = d;
                if (g == "key") {
                    this._index = 0
                } else {
                    this._index = 1
                }
            }
        }
        MapIterator._initialized = true;
        _classes.defineClass("MapIterator", c)
    }
    this.init(a, b)
}
_classes.registerClass("Rectangle");
function Rectangle(b, g, c, a) {
    if (typeof Rectangle._initialized == "undefined") {
        function d() {
            Rectangle.prototype.bottom = function() {
                return this.y + this.height
            }
            ;
            Rectangle.prototype.contains = function(l, h) {
                if (l != null ) {
                    if (Util.isInstanceOf(l, Point)) {
                        return this.contains(l.x, l.y)
                    } else {
                        if (Util.isInstanceOf(l, Rectangle)) {
                            return this.x <= l.x && this.y <= l.y && this.right() >= l.right() && this.bottom() >= l.bottom()
                        } else {
                            if (h != null ) {
                                return h >= this.y && h <= this.y + this.height && l >= this.x && l <= this.x + this.width
                            }
                        }
                    }
                }
            }
            ;
            Rectangle.prototype.copy = function() {
                return new Rectangle(this.x,this.y,this.width,this.height)
            }
            ;
            Rectangle.prototype.crop = function(h) {
                if (!h) {
                    return this
                }
                this.x += h.left;
                this.y += h.top;
                this.width -= (h.getWidth());
                this.height -= (h.getHeight());
                return this
            }
            ;
            Rectangle.prototype.equals = function(h) {
                if (h == null ) {
                    return false
                }
                if (this == h) {
                    return true
                }
                if (Util.isInstanceOf(h, Rectangle)) {
                    return this.x == h.x && this.y == h.y && this.width == h.width && this.height == h.height
                }
                return false
            }
            ;
            Rectangle.prototype.expand = function(l, h) {
                if (l != null ) {
                    if (Util.isInstanceOf(l, Insets)) {
                        this.x -= l.left;
                        this.y -= l.top;
                        this.height += l.getHeight();
                        this.width += l.getWidth();
                        return this
                    } else {
                        if (h != null ) {
                            return this.shrink(-l, -h)
                        }
                    }
                    return this
                }
                return this
            }
            ;
            Rectangle.prototype.getBottom = function() {
                return new Point(this.x + this.width / 2,this.bottom())
            }
            ;
            Rectangle.prototype.getBottomLeft = function() {
                return new Point(this.x,this.y + this.height)
            }
            ;
            Rectangle.prototype.getBottomRight = function() {
                return new Point(this.x + this.width,this.y + this.height)
            }
            ;
            Rectangle.prototype.getCenter = function() {
                return new Point(this.x + this.width / 2,this.y + this.height / 2)
            }
            ;
            Rectangle.prototype.getCopy = function() {
                return new Rectangle(this)
            }
            ;
            Rectangle.prototype.getCropped = function(h) {
                var l = new Rectangle(this);
                l.crop(h);
                return l
            }
            ;
            Rectangle.prototype.getExpanded = function(l, h) {
                if (arguments.length == 1) {
                    return new Rectangle(this).expand(l)
                } else {
                    if (arguments.length == 2) {
                        return new Rectangle(this).expand(l, h)
                    }
                }
            }
            ;
            Rectangle.prototype.getIntersection = function(o) {
                var l = Math.max(this.x, o.x);
                var h = Math.min(this.x + this.width, o.x + o.width);
                var n = Math.max(this.y, o.y);
                var m = Math.min(this.y + this.height, o, g + o.height);
                if ((h - l) < 0 || (m - n) < 0) {
                    return new Rectangle(0,0,0,0)
                } else {
                    return new Rectangle(l,n,h - l,m - n)
                }
            }
            ;
            Rectangle.prototype.getLeft = function() {
                return new Point(this.x,this.y + this.height / 2)
            }
            ;
            Rectangle.prototype.getInsets = function() {
                if (this.getBorder()) {}
            }
            ;
            Rectangle.prototype.getLocation = function() {
                return new Point(this.x,this.y)
            }
            ;
            Rectangle.prototype.getPosition = function(l) {
                var h = PositionConstants.NONE;
                if (this.contains(l)) {
                    return h
                }
                if (l.x < this.x) {
                    h = PositionConstants.WEST
                } else {
                    if (l.x >= this.x + this.width) {
                        h = PositionConstants.EAST
                    }
                }
                if (l.y < this.y) {
                    h = h | PositionConstants.NORTH
                } else {
                    if (l.y >= this.y + this.height) {
                        h = h | PositionConstants.SOUTH
                    }
                }
                return h
            }
            ;
            Rectangle.prototype.getResized = function(l, h) {
                if (arguments.length == 1) {
                    return new Rectangle(this).resize(l)
                } else {
                    if (arguments.length == 2) {
                        return new Rectangle(this).resize(l, h)
                    }
                }
            }
            ;
            Rectangle.prototype.getRight = function() {
                return new Point(this.right(),this.y + this.height / 2)
            }
            ;
            Rectangle.prototype.getSize = function() {
                return new Dimension(this.width,this.height)
            }
            ;
            Rectangle.prototype.getTop = function() {
                return new Point(this.x + this.width / 2,this.y)
            }
            ;
            Rectangle.prototype.getTopLeft = function() {
                return new Point(this.x,this.y)
            }
            ;
            Rectangle.prototype.getTopRight = function() {
                return new Point(this.x + this.width,this.y)
            }
            ;
            Rectangle.prototype.getTranslated = function(l, h) {
                if (arguments.length == 1) {
                    return new Rectangle(this).translate(l)
                } else {
                    if (arguments.length == 2) {
                        return new Rectangle(this).translate(l, h)
                    }
                }
            }
            ;
            Rectangle.prototype.getTransposed = function() {
                var h = new Rectangle(this);
                h.transpose();
                return h
            }
            ;
            Rectangle.prototype.getUnion = function(h) {
                if (!h || h.isEmpty()) {
                    return new Rectangle(this)
                }
                var l = new Rectangle(Math.min(this.x, h.x),Math.min(this.y, h.y),0,0);
                l.width = Math.max(this.x + this.width, h.x + h.width) - l.x;
                l.height = Math.max(this.y + this.height, h.y + h.height) - l.y;
                return l
            }
            ;
            Rectangle.prototype.intersect = function(p) {
                var r;
                var o;
                var l;
                var s;
                if (arguments.length == 1) {
                    r = p.x;
                    o = p.y;
                    l = p.width;
                    s = p.height
                } else {
                    if (arguments.length == 4) {
                        r = arguments[0];
                        o = arguments[1];
                        l = arguments[2];
                        s = arguments[3]
                    }
                }
                var m = Math.max(this.x, r);
                var h = Math.min(this.x + this.width, r + l);
                var q = Math.max(this.y, o);
                var n = Math.min(this.y + this.height, o + s);
                if (((h - m) < 0) || ((n - q) < 0)) {
                    this.x = this.y = this.width = this.height = 0
                } else {
                    this.x = m;
                    this.y = q;
                    this.width = h - m;
                    this.height = n - q
                }
                return this
            }
            ;
            Rectangle.prototype.intersects = function(h) {
                return h.x < this.x + this.width && h.y < this.y + this.height && h.x + h.width > this.x && h.y + h.height > this.y
            }
            ;
            Rectangle.prototype.isEmpty = function() {
                return this.width <= 0 || this.height <= 0
            }
            ;
            Rectangle.prototype.performScale = function(h) {
                this.scale(h)
            }
            ;
            Rectangle.prototype.performTranslate = function(l, h) {
                this.translate(l, h)
            }
            ;
            Rectangle.prototype.resize = function(l, h) {
                if (typeof l == "undefined") {
                    return this
                }
                if (arguments.length == 1) {
                    if (Util.isInstanceOf(l, Dimension)) {
                        this.width += l.width;
                        this.height += l.height
                    }
                } else {
                    if (arguments.length == 2) {
                        this.width += l;
                        this.height += h
                    }
                }
                return this
            }
            ;
            Rectangle.prototype.right = function() {
                return this.x + this.width
            }
            ;
            Rectangle.prototype.scale = function(n, l) {
                var m;
                var h;
                if (n == null ) {
                    return
                }
                if (l == null ) {
                    m = n;
                    h = n
                } else {
                    m = n;
                    h = l
                }
                var p = this.x;
                var o = this.y;
                this.x = Math.floor(this.x * m);
                this.y = Math.floor(this.y * h);
                this.width = Math.ceil((p + this.width) * m) - this.x;
                this.height = Math.ceil((o + this.height) * h) - this.y;
                return this
            }
            ;
            Rectangle.prototype.setBounds = function(h) {
                this.x = h.x;
                this.y = h.y;
                this.width = h.width;
                this.height = h.height;
                return this
            }
            ;
            Rectangle.prototype.setX = function(h) {
                this.x = h
            }
            ;
            Rectangle.prototype.setY = function(h) {
                this.y = h
            }
            ;
            Rectangle.prototype.setWidth = function(h) {
                this.width = h
            }
            ;
            Rectangle.prototype.setHeight = function(h) {
                this.height = h
            }
            ;
            Rectangle.prototype.setLocation = function(l, h) {
                if (l == null ) {
                    return
                }
                if (Util.isInstanceOf(l, Point)) {
                    this.x = l.x;
                    this.y = l.y
                } else {
                    if (arguments.length == 2) {
                        this.x = l;
                        this.y = h
                    }
                }
            }
            ;
            Rectangle.prototype.setSize = function(l, h) {
                if (l == null ) {
                    return
                }
                if (Util.isInstanceOf(l, Dimension)) {
                    this.width = l.width;
                    this.height = l.height
                } else {
                    if (h != null ) {
                        this.width = l;
                        this.height = h
                    }
                }
            }
            ;
            Rectangle.prototype.shrink = function(m, l) {
                this.x += m;
                this.width -= (m + m);
                this.y += l;
                this.height -= (l + l);
                return this
            }
            ;
            Rectangle.prototype.touches = function(h) {
                return h.x <= this.x + this.width && h.y <= this.y + this.height && h.x + h.width >= this.x && h.y + h.height >= this.y
            }
            ;
            Rectangle.prototype.translate = function(h, l) {
                if (h == null ) {
                    return this
                }
                if (Util.isInstanceOf(h, Point)) {
                    this.x += h.x;
                    this.y += h.y
                } else {
                    if (l != null ) {
                        this.x += h;
                        this.y += l
                    }
                }
                return this
            }
            ;
            Rectangle.prototype.transpose = function() {
                var h = this.x;
                this.x = this.y;
                this.y = h;
                h = this.width;
                this.width = this.height;
                this.height = h;
                return this
            }
            ;
            Rectangle.prototype.union = function(p, o, n, m) {
                var r;
                var q;
                var l;
                var t;
                if (p == null ) {
                    return this
                }
                if (typeof p === "number" && typeof o === "number") {
                    r = p;
                    q = o;
                    l = n;
                    t = m
                } else {
                    r = p.x;
                    q = p.y;
                    l = p.width;
                    t = p.height
                }
                if (l == null ) {
                    l = 0
                }
                if (t == null ) {
                    t = 0
                }
                var s = Math.max(this.x + this.width, r + l);
                var h = Math.max(this.y + this.height, q + t);
                this.x = Math.min(this.x, r);
                this.y = Math.min(this.y, q);
                this.width = s - this.x;
                this.height = h - this.y;
                return this
            }
            ;
            Rectangle.prototype.init = function(l, n, m, h) {
                if (l == null ) {
                    this.x = 0;
                    this.y = 0;
                    this.width = 0;
                    this.height = 0
                } else {
                    if (Util.isInstanceOf(l, Rectangle)) {
                        this.x = l.x;
                        this.y = l.y;
                        this.width = l.width;
                        this.height = l.height
                    } else {
                        if (Util.isInstanceOf(l, Point) && Util.isInstanceOf(n, Point)) {
                            this.x = Math.min(l.x, n.x);
                            this.y = Math.min(l.y, n.y);
                            this.width = Math.abs(n.x - l.x) + 1;
                            this.height = Math.abs(n.y - l.y) + 1
                        } else {
                            if (Util.isInstanceOf(l, Point) && Util.isInstanceOf(n, Dimension)) {
                                this.x = l.x;
                                this.y = l.y;
                                this.width = n.width;
                                this.height = n.height
                            } else {
                                this.x = l;
                                this.y = n;
                                this.width = m;
                                this.height = h
                            }
                        }
                    }
                }
            }
        }
        Rectangle._initialized = true;
        _classes.defineClass("Rectangle", d)
    }
    this.init(b, g, c, a)
}
Rectangle.SINGLETON = new Rectangle();
_classes.registerClass("Dimension");
function Dimension(b, a) {
    if (typeof Dimension._initialized == "undefined") {
        function c() {
            Dimension.prototype.contains = function(g) {
                return this.width >= g.width && this.height >= g.height
            }
            ;
            Dimension.prototype.containsProper = function(g) {
                return this.width > g.width && this.height > g.height
            }
            ;
            Dimension.prototype.equals = function(g) {
                if (g == null ) {
                    return false
                }
                if (arguments.length == 1) {
                    var g = arguments[0];
                    return g.width == this.width && g.height == this.height
                } else {
                    if (arguments.length == 2) {
                        return arguments[0] == this.width && arguments[1] == this.height
                    }
                }
            }
            ;
            Dimension.prototype.expand = function(g, d) {
                if (typeof g == "undefined") {
                    return this
                }
                if (Util.isInstanceOf(g, Dimension)) {
                    this.width += g.width;
                    this.height += g.height
                } else {
                    if (Util.isInstanceOf(g, Point)) {
                        this.width += g.x;
                        this.height += g.y
                    } else {
                        if (arguments.length == 2) {
                            this.width += g;
                            this.height += d
                        }
                    }
                }
                return this
            }
            ;
            Dimension.prototype.getArea = function() {
                return this.width * this.height
            }
            ;
            Dimension.prototype.getCopy = function() {
                return new Dimension(this)
            }
            ;
            Dimension.prototype.getDifference = function(g) {
                return new Dimension(this.width - g.width,this.height - g.height)
            }
            ;
            Dimension.prototype.getExpanded = function(l, g) {
                var h;
                var g;
                if (arguments.length == 1) {
                    h = l.width;
                    g = l.height
                } else {
                    if (arguments.length == 2) {
                        h = l;
                        hwight = g
                    }
                }
                return new Dimension(this.width + h,this.height + g)
            }
            ;
            Dimension.prototype.getIntersected = function(g) {
                return new Dimension(this).intersect(g)
            }
            ;
            Dimension.prototype.getNegated = function() {
                return new Dimension(0 - this.width,0 - this.height)
            }
            ;
            Dimension.prototype.getScaled = function(d) {
                return new Dimension(this).scale(d)
            }
            ;
            Dimension.prototype.getShrinked = function(g, d) {
                if (g == null ) {
                    return
                }
                if (Util.isInstanceOf(g, Dimension)) {
                    return this.getCopy().shrink(g.width, g.height)
                } else {
                    return this.getCopy().shrink(g, d)
                }
            }
            ;
            Dimension.prototype.getTransposed = function() {
                return new Dimension(this).transpose()
            }
            ;
            Dimension.prototype.getUnioned = function(g) {
                return new Dimension(this).union(g)
            }
            ;
            Dimension.prototype.intersect = function(g) {
                this.width = Math.min(g.width, this.width);
                this.height = Math.min(g.height, this.height);
                return this
            }
            ;
            Dimension.prototype.isEmpty = function() {
                return (this.width <= 0) || (this.height <= 0)
            }
            ;
            Dimension.prototype.negate = function() {
                this.width = 0 - this.width;
                this.height = 0 - this.height;
                return this
            }
            ;
            Dimension.prototype.performScale = function(d) {
                return this.scale(d)
            }
            ;
            Dimension.prototype.performTranslate = function() {}
            ;
            Dimension.prototype.scale = function() {
                var d;
                var g;
                if (arguments.length == 1) {
                    d = arguments[0];
                    g = d
                } else {
                    if (arguments.length == 2) {
                        d = arguments[0];
                        g = arguments[1]
                    }
                }
                this.width = Math.floor(this.width * d);
                this.height = Math.floor(this.height * g);
                return this
            }
            ;
            Dimension.prototype.setSize = function(g) {
                this.width = g.width;
                this.height = g.height
            }
            ;
            Dimension.prototype.shrink = function(d, g) {
                return this.expand(-d, -g)
            }
            ;
            Dimension.prototype.transpose = function() {
                var d = this.width;
                this.width = this.height;
                this.height = d;
                return this
            }
            ;
            Dimension.prototype.union = function(g) {
                this.width = Math.max(this.width, g.width);
                this.height = Math.max(this.height, g.height);
                return this
            }
            ;
            Dimension.prototype.init = function(g, d) {
                if (g == null ) {
                    this.width = 0;
                    this.height = 0;
                    return
                }
                if (Util.isInstanceOf(g, Dimension)) {
                    this.width = g.width;
                    this.height = g.height
                } else {
                    if (Util.isInstanceOf(g, Point)) {
                        this.width = g.x;
                        this.height = g.y
                    } else {
                        this.width = g;
                        this.height = d
                    }
                }
            }
        }
        Dimension._initialized = true;
        _classes.defineClass("Dimension", c)
    }
    this.init(b, a)
}
Dimension.SINGLETON = new Dimension();
Dimension.max = function(b, a) {
    return new Dimension(Math.max(b.width, a.width),Math.max(b.height, a.height))
}
;
Dimension.min = function(b, a) {
    return new Dimension(Math.min(b.width, a.width),Math.min(b.height, a.height))
}
;
_classes.registerClass("Point");
function Point(a, c) {
    if (typeof Point._initialized == "undefined") {
        function b() {
            Point.prototype.equals = function(d) {
                if (d == null ) {
                    return false
                }
                if (Util.isInstanceOf(d, Point)) {
                    return d.x == this.x && d.y == this.y
                }
                return false
            }
            ;
            Point.prototype.getCopy = function() {
                return new Point(this)
            }
            ;
            Point.prototype.getDifference = function(d) {
                return new Dimension(this.x - d.x,this.y - d.y)
            }
            ;
            Point.prototype.getDistance = function(d) {
                return Math.sqrt(this.getPreciseDistance2(d))
            }
            ;
            Point.prototype.getDistance2 = function(l) {
                var h = Math.floor(l.x - this.x);
                var g = Math.floor(l.y - this.y);
                var d = h * h + g * g;
                return d
            }
            ;
            Point.prototype.getPreciseDistance2 = function(l) {
                var h = l.x - this.x;
                var g = l.y - this.y;
                var d = h * h + g * g;
                return d
            }
            ;
            Point.prototype.getDistanceOrthogonal = function(d) {
                return Math.abs(this.y - d.y) + Math.abs(this.x - d.x)
            }
            ;
            Point.prototype.getNegated = function() {
                return this.getCopy().negate()
            }
            ;
            Point.prototype.getPosition = function(h) {
                var g = h.x - this.x;
                var d = h.y - this.y;
                if (Math.abs(g) > Math.abs(d)) {
                    if (g < 0) {
                        return PositionConstants.WEST
                    }
                    return PositionConstants.EAST
                }
                if (d < 0) {
                    return PositionConstants.NORTH
                }
                return PositionConstants.SOUTH
            }
            ;
            Point.prototype.getScaled = function(d) {
                return this.getCopy().scale(d)
            }
            ;
            Point.prototype.getTranslated = function(g, d) {
                if (arguments.length == 1) {
                    return this.getCopy().translate(g)
                } else {
                    if (arguments.length == 2) {
                        return this.getCopy().translate(g, d)
                    }
                }
            }
            ;
            Point.prototype.getTransposed = function() {
                return this.getCopy().transpose()
            }
            ;
            Point.prototype.negate = function() {
                this.x = -this.x;
                this.y = -this.y;
                return this
            }
            ;
            Point.prototype.performScale = function(d) {
                return this.scale(d)
            }
            ;
            Point.prototype.performTranslate = function(g, d) {
                return this.translate(g, d)
            }
            ;
            Point.prototype.scale = function(g, d) {
                var l;
                var h;
                l = g;
                if (typeof d == "undefined") {
                    h = g
                } else {
                    h = d
                }
                this.x = Math.floor(this.x * l);
                this.y = Math.floor(this.y * h);
                return this
            }
            ;
            Point.prototype.setLocation = function(g, d) {
                if (g == null ) {
                    return
                }
                if (Util.isInstanceOf(g, Point)) {
                    this.x = g.x;
                    this.y = g.y
                } else {
                    if (d != null ) {
                        this.x = g;
                        this.y = d
                    }
                }
                return this
            }
            ;
            Point.prototype.translate = function(g, d) {
                if (g == null ) {
                    return
                }
                if (Util.isInstanceOf(g, Point)) {
                    this.x += g.x;
                    this.y += g.y
                } else {
                    if (Util.isInstanceOf(g, Dimension)) {
                        this.x += g.width;
                        this.y += g.height
                    } else {
                        if (d != null ) {
                            this.x += g;
                            this.y += d
                        }
                    }
                }
                return this
            }
            ;
            Point.prototype.transpose = function() {
                var d = this.x;
                this.x = this.y;
                this.y = d;
                return this
            }
            ;
            Point.prototype.init = function(g, d) {
                this.parentMethod("init");
                if (g == null ) {
                    this.x = 0;
                    this.y = 0;
                    return
                }
                if (Util.isInstanceOf(g, Point)) {
                    this.x = g.x;
                    this.y = g.y
                } else {
                    if (g != null  && d != null ) {
                        this.x = g;
                        this.y = d
                    }
                }
            }
        }
        Point._initialized = true;
        _classes.defineClass("Point", b)
    }
    this.init(a, c)
}
Point.max = function(b, a) {
    return new Rectangle(b,a).getBottomRight().translate(-1, -1)
}
;
Point.min = function(b, a) {
    return new Rectangle(b,a).getTopLeft()
}
;
Point.SINGLETON = new Point(0,0);
_classes.registerClass("AbsoluteBendpoint", "Point");
function AbsoluteBendpoint(b, a) {
    if (typeof AbsoluteBendpoint._initialized == "undefined") {
        function c() {
            AbsoluteBendpoint.prototype.getLocation = function() {
                return this
            }
            ;
            AbsoluteBendpoint.prototype.init = function(g, d) {
                this.parentMethod("init", g, d)
            }
        }
        AbsoluteBendpoint._initialized = true;
        _classes.defineClass("AbsoluteBendpoint", c)
    }
    this.init(b, a)
}
_classes.registerClass("Insets");
function Insets(d, c, a, b) {
    if (typeof Insets._initialized == "undefined") {
        function g() {
            Insets.prototype.add = function(h) {
                this.top += h.top;
                this.left += h.left;
                this.bottom += h.bottom;
                this.right += h.right;
                return this
            }
            ;
            Insets.prototype.equals = function(h) {
                if (h == null ) {
                    return false
                }
                if (Util.isInstanceOf(h, Insets)) {
                    return h.top == this.top && h.left == this.left && h.bottom == this.bottom && h.right == this.right
                }
                return false
            }
            ;
            Insets.prototype.getAdded = function(h) {
                return new Insets(this).add(h)
            }
            ;
            Insets.prototype.getHeight = function() {
                return this.top + this.bottom
            }
            ;
            Insets.prototype.getTransposed = function() {
                return new Insets(this).transpose()
            }
            ;
            Insets.prototype.getWidth = function() {
                return this.left + this.right
            }
            ;
            Insets.prototype.isEmpty = function() {
                return ( this.left == 0 && this.right == 0 && this.top == 0 && this.bottom == 0) 
            }
            ;
            Insets.prototype.transpose = function() {
                var h = this.top;
                this.top = this.left;
                this.left = h;
                h = this.right;
                this.right = this.bottom;
                this.bottom = h;
                return this
            }
            ;
            Insets.prototype.init = function(n, m, l, h) {
                if (n == null ) {
                    this.top = 0;
                    this.left = 0;
                    this.bottom = 0;
                    this.right = 0;
                    return
                }
                if (Util.isInstanceOf(n, Insets)) {
                    this.top = n.top;
                    this.left = n.left;
                    this.bottom = n.bottom;
                    this.right = n.right
                } else {
                    if (m != null  && l != null  && h != null ) {
                        this.top = n;
                        this.left = m;
                        this.bottom = l;
                        this.right = h
                    } else {
                        this.top = n;
                        this.left = n;
                        this.bottom = n;
                        this.right = n
                    }
                }
            }
        }
        Insets._initialized = true;
        _classes.defineClass("Insets", g)
    }
    this.init(d, c, a, b)
}
function Geometry() {}
Geometry.linesIntersect = function(l, g, s, h, r, q, u, t) {
    var w = l - r;
    var v = g - q;
    var p = s - r;
    var o = vy - q;
    var c = r - u;
    var a = q - t;
    if (Geometry.productSign(Geometry.cross(p, o, c, a), Geometry.cross(c, a, w, v)) >= 0) {
        var d = s - l;
        var b = vy - g;
        var n = l - u;
        var m = g - t;
        return productSign(Geometry.cross(-w, -v, d, b), Geometry.cross(d, b, n, m)) <= 0
    }
    return false
}
;
Geometry.productSign = function(a, b) {
    if (a == 0 || b == 0) {
        return 0
    } else {
        if (a < 0 ^ b < 0) {
            return -1
        }
    }
    return 1
}
;
Geometry.cross = function(b, d, a, c) {
    return b * c - a * d
}
;
Geometry.polylineContainsPoint = function(d, a, h, b) {
    var g = d.toIntArray();
    var c;
    for (c = 0; c < g.length - 3; c += 2) {
        if (Geometry.segmentContainsPoint(g[c], g[c + 1], g[c + 2], g[c + 3], a, h, b)) {
            return true
        }
    }
    return false
}
;
Geometry.segmentContainsPoint = function(d, p, c, o, r, q, n) {
    var s = Rectangle.SINGLETON;
    s.setSize(0, 0);
    s.setLocation(d, p);
    s.union(c, o);
    s.expand(n, n);
    if (!s.contains(r, q)) {
        return false
    }
    if (d == c || p == o) {
        return true
    }
    var l = c - d;
    var h = o - p;
    var b = r - d;
    var t = q - p;
    var a = b * h - l * t;
    var g = l * l + h * h;
    var m = (a * a / g);
    return m <= n * n
}
;
Geometry.polygonContainsPoint = function(q, m, h) {
    var r = false;
    var p = q.toIntArray();
    var d = p.length;
    if (d > 3) {
        var b;
        var l;
        var c = p[d - 2];
        var o = p[d - 1];
        var g;
        for (g = 0; g < d; c = b,
        o = l) {
            b = p[g++];
            l = p[g++];
            if (!Geometry.segmentContaintPoint(o, l, h)) {
                continue
            }
            var a = Geometry.crossProduct(b, l, c, o, m, h);
            if (a == 0) {
                if (Geometry.segmentContaintPoint(c, b, m)) {
                    return true
                }
            } else {
                if ((o <= h && h < l && a > 0) || (l <= h && h < o && a < 0)) {
                    r = !r
                }
            }
        }
        return r
    }
    return false
}
;
Geometry.segmentContaintPoint = function(c, b, a) {
    return !((a < c && a < b) || (a > c && a > b))
}
;
Geometry.crossProduct = function(c, b, g, d, a, h) {
    return (c - a) * (d - h) - (b - h) * (g - a)
}
;
Geometry.crossLine = function(b, a) {
    return Math.abs((b.x + b.right()) / 2 - (a.x + a.right()) / 2) < ((b.right() + a.right() - b.x - a.x) / 2) && Math.abs((b.y + b.bottom()) / 2 - (a.y + a.bottom()) / 2) < ((b.bottom() + a.bottom() - b.y - a.y) / 2)
}
;
_classes.registerClass("PointList");
function PointList(a) {
    if (typeof PointList._initialized == "undefined") {
        function b() {
            PointList.prototype.addAll = function(d) {
                if (d) {
                    for (var c = 0; c < d.points.length; c++) {
                        this.points.push(d.points[c])
                    }
                    this.size += d.size
                }
            }
            ;
            PointList.prototype.addPoint = function(g, d) {
                if (g != null ) {
                    var c;
                    var h;
                    if (Util.isInstanceOf(g, Point)) {
                        c = g.x;
                        h = g.y
                    } else {
                        c = g;
                        h = d
                    }
                    this.bounds = null ;
                    if (this.points.length > this.size * 2) {
                        this.points[this.size * 2] = c;
                        this.points[this.size * 2 + 1] = h
                    } else {
                        this.points.push(c);
                        this.points.push(h)
                    }
                    this.size++
                }
            }
            ;
            PointList.prototype.getBounds = function() {
                if (this.bounds != null ) {
                    return this.bounds
                }
                this.bounds = new Rectangle(0,0,0,0);
                if (this.size > 0) {
                    this.bounds.setLocation(this.getPoint(0));
                    for (var c = 0; c < this.size; c++) {
                        this.bounds.union(this.getPoint(c))
                    }
                }
                return this.bounds
            }
            ;
            PointList.prototype.getCopy = function() {
                return new PointList(this)
            }
            ;
            PointList.prototype.getFirstPoint = function() {
                return this.getPoint(0)
            }
            ;
            PointList.prototype.getLastPoint = function() {
                return this.getPoint(this.size - 1)
            }
            ;
            PointList.prototype.getMidpoint = function() {
                if (this.size % 2 == 0) {
                    return this.getPoint(this.size / 2 - 1).getTranslated(this.getPoint(this.size / 2)).scale(0.5)
                }
                return this.getPoint(this.size / 2)
            }
            ;
            PointList.prototype.getPoint = function(g, c) {
                if (g != null ) {
                    var d;
                    if (Util.isInstanceOf(g, Point)) {
                        if (c < 0 || c >= this.size) {
                            throw ("PointList--getPoint()-IndexOutofBounds size=" + this.size + ",index=" + c)
                        }
                        d = c * 2;
                        g.x = this.points[d];
                        g.y = this.points[d + 1];
                        return g
                    } else {
                        if (g < 0 || g >= this.size) {
                            throw ("PointList--getPoint()-IndexOutofBounds size=" + this.size + ",index=" + g)
                        }
                        d = (g << 0) * 2;
                        return new Point(this.points[d],this.points[d + 1])
                    }
                }
            }
            ;
            PointList.prototype.insertPoint = function(d, c) {
                if (this.bounds != null  && !this.bounds.contains(d)) {
                    this.bounds = null 
                }
                if (c > this.size || c < 0) {
                    throw ("PointList--insertPoint()-IndexOutofBounds")
                }
                c *= 2;
                this.points.spliec(c, 0, d.x, d.y);
                this.size++
            }
            ;
            PointList.prototype.intersects = function(c) {
                if (c.isEmpty()) {
                    return false
                }
                for (var h = 0; h < this.size * 2; h += 2) {
                    if (c.contains(this.points[h], this.points[h + 1])) {
                        return true
                    }
                }
                var o = c.x;
                var g = c.y;
                var n = c.x + c.width - 1;
                var d = c.y + c.height - 1;
                var q = c.x + c.width - 1;
                var m = c.y;
                var p = c.x;
                var l = c.y + c.height - 1;
                for (var h = 0; h < (this.size - 1) * 2; h += 2) {
                    if (Geometry.linesIntersect(o, g, n, d, this.points[h], this.points[h + 1], this.points[h + 2], this.points[h + 3]) || Geometry.linesIntersect(q, m, p, l, this.points[h], this.points[h + 1], this.points[h + 2], this.points[h + 3])) {
                        return true
                    }
                }
                return false
            }
            ;
            PointList.prototype.performScale = function(d) {
                for (var c = 0; c < this.points.lenght; c++) {
                    this.points[c] = Math.floor(this.points[c] * d)
                }
                this.bounds = null 
            }
            ;
            PointList.prototype.performTranslate = function(d, c) {
                for (var g = 0; g < this.size * 2; g += 2) {
                    this.points[g] += d;
                    this.points[g + 1] == c
                }
                if (this.bounds != null ) {
                    this.bounds.translate(d, c)
                }
            }
            ;
            PointList.prototype.removeAllPoints = function() {
                this.bounds = null ;
                this.size = 0
            }
            ;
            PointList.prototype.removePoint = function(c) {
                this.bounds = null ;
                if (c < 0 || c >= this.size) {
                    throw ("PointList--removePoint()-IndexOutofBounds")
                }
                c *= 2;
                var d = new Point(this.points[c],this.points[c + 1]);
                this.points.splice(c, 2);
                this.size--;
                return d
            }
            ;
            PointList.prototype.reverse = function() {
                this.points.reverse();
                var c;
                for (var d = 0; d < this.size * 2; d += 2) {
                    c = this.points[d];
                    this.points[d] = this.points[d + 1];
                    this.points[d + 1] = c
                }
            }
            ;
            PointList.prototype.setPoint = function(d, c) {
                if (c < 0 || c >= this.size) {
                    throw ("PointList--setPoint()-IndexOutofBounds")
                }
                if (this.bounds != null  && !this.bounds.contains(d)) {
                    this.bounds = null 
                }
                c *= 2;
                this.points[c] = d.x;
                this.points[c + 1] = d.y
            }
            ;
            PointList.prototype.setSize = function(c) {
                if (this.points.length > c * 2) {
                    this.size = c;
                    return
                }
            }
            ;
            PointList.prototype.getSize = function() {
                return this.size
            }
            ;
            PointList.prototype.toIntArray = function() {
                if (this.points.length == this.size * 2) {
                    return this.points
                }
                var c = this.points;
                this.points = [];
                for (var d = 0; d < this.size * 2; d++) {
                    this.points.push(c[d])
                }
                return this.points
            }
            ;
            PointList.prototype.translate = function(g, d) {
                if (g != null ) {
                    var c = 0;
                    var l = 0;
                    if (Util.isInstanceOf(g, Point)) {
                        c = g.x;
                        l = g.y
                    } else {
                        if (arguments.length == 2) {
                            c = g;
                            l = d
                        }
                    }
                    if (this.bounds != null ) {
                        this.bounds.translate(c, l)
                    }
                    for (var h = 0; h < this.size * 2; h += 2) {
                        this.points[h] += c;
                        this.points[h + 1] += l
                    }
                }
            }
            ;
            PointList.prototype.transpose = function() {
                var c;
                if (this.bounds != null ) {
                    this.bounds.transpose()
                }
                for (var d = 0; d < this.size * 2; d += 2) {
                    c = this.points[d];
                    this.points[d] = this.points[d + 1];
                    this.points[d + 1] = c
                }
            }
            ;
            PointList.prototype.polygonContainsPoint = function(c, d) {
                return Geometry.polygonContainsPoint(this, c, d)
            }
            ;
            PointList.prototype.polylineContainsPoint = function(c, d) {
                return Geometry.polylineContainsPoint(this, c, y, tolerance)
            }
            ;
            PointList.prototype.init = function(c) {
                this.points = [];
                this.bounds = null ;
                this.size = 0;
                if (c != null ) {
                    if (c instanceof Array) {
                        this.points = c;
                        this.size = c.length / 2
                    } else {
                        if (Util.isInstanceOf(c, PointList)) {
                            for (var d = 0; d < c.points.length; d++) {
                                this.points[d] = c.points[d]
                            }
                            this.size = c.size
                        }
                    }
                }
            }
        }
        PointList._initialized = true;
        _classes.defineClass("PointList", b)
    }
    this.init(a)
}
_classes.registerClass("Transform");
function Transform() {
    if (typeof Transform._initialized == "undefined") {
        function a() {
            Transform.prototype.setScale = function(b, c) {
                if (b != null ) {
                    this.scaleX = b;
                    if (c != null ) {
                        this.scaleY = c
                    } else {
                        this.scaleY = b
                    }
                }
            }
            ;
            Transform.prototype.setRotation = function(b) {
                this.cos = Math.cos(b);
                this.sin = Math.sin(b)
            }
            ;
            Transform.prototype.setTranslation = function(b, c) {
                this.dx = b;
                this.dy = c
            }
            ;
            Transform.prototype.getTransformed = function(d) {
                var b = d.x;
                var g = d.y;
                var c;
                b *= this.scaleX;
                g *= this.scaleY;
                c = b * this.cos - g * this.sin;
                g = b * this.sin + g * this.cos;
                b = c;
                return new Point(Math.round(b + this.dx),Math.round(g + this.dy))
            }
            ;
            Transform.prototype.init = function() {
                this.parentMethod("init");
                this.scaleX = 1;
                this.scaleY = 1;
                this.dx = 0;
                this.dy = 0;
                this.cos = 1;
                this.sin = 0
            }
        }
        Transform._initialized = true;
        _classes.defineClass("Transform", a)
    }
    this.init()
}
_classes.registerClass("Transposer");
function Transposer() {
    if (typeof Transposer._initialized == "undefined") {
        function a() {
            Transposer.prototype.disable = function() {
                this.enabled = false
            }
            ;
            Transposer.prototype.enable = function() {
                this.enabled = true
            }
            ;
            Transposer.prototype.isEnabled = function() {
                return this.enabled
            }
            ;
            Transposer.prototype.setEnabled = function(b) {
                this.enabled = b
            }
            ;
            Transposer.prototype.t = function(b) {
                if (this.isEnabled()) {
                    return b.getTransposed()
                }
                return b
            }
            ;
            Transposer.prototype.init = function() {
                this.parentMethod("init");
                this.enabled = false
            }
        }
        Transposer._initialized = true;
        _classes.defineClass("Transposer", a)
    }
    this.init()
}
function PositionConstants() {}
PositionConstants.NONE = 0;
PositionConstants.LEFT = 1;
PositionConstants.CENTER = 2;
PositionConstants.RIGHT = 4;
PositionConstants.LEFT_CENTER_RIGHT = PositionConstants.LEFT | PositionConstants.CENTER | PositionConstants.RIGHT;
PositionConstants.ALWAYS_LEFT = 64;
PositionConstants.ALWAYS_RIGHT = 128;
PositionConstants.TOP = 8;
PositionConstants.MIDDLE = 16;
PositionConstants.BOTTOM = 32;
PositionConstants.TOP_MIDDLE_BOTTOM = PositionConstants.TOP | PositionConstants.MIDDLE | PositionConstants.BOTTOM;
PositionConstants.NORTH = 1;
PositionConstants.SOUTH = 4;
PositionConstants.WEST = 8;
PositionConstants.EAST = 16;
PositionConstants.HORIZONTAL = 64;
PositionConstants.VERTICAL = 128;
PositionConstants.NORTH_EAST = PositionConstants.NORTH | PositionConstants.EAST;
PositionConstants.NORTH_WEST = PositionConstants.NORTH | PositionConstants.WEST;
PositionConstants.SOUTH_EAST = PositionConstants.SOUTH | PositionConstants.EAST;
PositionConstants.SOUTH_WEST = PositionConstants.SOUTH | PositionConstants.WEST;
PositionConstants.NORTH_SOUTH = PositionConstants.NORTH | PositionConstants.SOUTH;
PositionConstants.EAST_WEST = PositionConstants.EAST | PositionConstants.WEST;
PositionConstants.NSEW = PositionConstants.NORTH_SOUTH | PositionConstants.EAST_WEST;
function FigureUtilities() {}
FigureUtilities.RGB_VALUE_MULTIPLIER = 0.6;
FigureUtilities.ghostFillColor = "#1F1F1F";
FigureUtilities.darker = function() {}
;
FigureUtilities.lighter = function() {}
;
FigureUtilities.getRoot = function(a) {
    while (a.getParent() != null ) {
        a = a.getParent()
    }
    return a
}
;
FigureUtilities.getFontMetrics = function(a, b) {
    FigureUtilities.setFont(b);
    FigureUtilities.setText(a);
    if (FigureUtilities.metrics == null ) {
        FigureUtilities.metrics = FigureUtilities.getGraphics().measureText(FigureUtilities.text)
    }
    return FigureUtilities.metrics
}
;
FigureUtilities.getGraphics = function() {
    if (FigureUtilities.graphics == null ) {
        var a = document.createElement("canvas");
        var b = a.getContext("2d");
        FigureUtilities.graphics = new Html5Graphics(b);
        FigureUtilities.font = FigureUtilities.graphics.getFont()
    }
    return FigureUtilities.graphics
}
;
FigureUtilities.getTextExtents = function(b, d, a) {
    var c = new Dimension(FigureUtilities.getFontMetrics(b, d).width,FigureUtilities.getFontMetrics(b, d).height);
    if (a != null ) {
        a.width = c.width;
        a.height = c.height;
        return a
    } else {
        return c
    }
}
;
FigureUtilities.getTextWidth = function(a, b) {
    return FigureUtilities.getFontMetrics(a, b).width
}
;
FigureUtilities.setFont = function(a) {
    if (FigureUtilities.font == a) {
        return
    }
    if (a == null ) {
        a = "12px sans-serif"
    }
    FigureUtilities.getGraphics().setFont(a);
    FigureUtilities.font = a;
    FigureUtilities.metric = null 
}
;
FigureUtilities.setText = function(a) {
    if (FigureUtilities.text == a) {
        return
    }
    FigureUtilities.text = a;
    FigureUtilities.metrics = null 
}
;
FigureUtilities.makeGhostShape = function(a) {
    a.setBackgroundColor(FigureUtilities.ghostFillColor);
    a.setFillXOR(true);
    a.setOutlineXOR(true);
    return a
}
;
_classes.registerClass("Color");
function Color(d, b, a, c) {
    if (typeof Color._initialized == "undefined") {
        function g() {
            Color.prototype.isOpaque = function() {
                return false
            }
            ;
            Color.prototype.equals = function(h) {
                if (h == this) {
                    return true
                }
                if (h == null ) {
                    return false
                }
                if (!Util.isInstanceOf(h, Color)) {
                    return false
                }
                return h.red == this.red && h.green == this.green && h.blue == this.blue && h.alpha == this.alpha
            }
            ;
            Color.prototype.toCSS = function() {
                return new String("#" + this.toHexaString(this.red) + this.toHexaString(this.green) + this.toHexaString(this.blue)).toUpperCase()
            }
            ;
            Color.prototype.toRGB = function() {
                return "rgb(" + this.red + "," + this.green + "," + this.blue + ")"
            }
            ;
            Color.prototype.toRGBA = function() {
                return "rgba(" + this.red + "," + this.green + "," + this.blue + "," + this.alpha + ")"
            }
            ;
            Color.prototype.toHexaString = function(l) {
                var h;
                if (l > 15) {
                    h = l.toString(16)
                } else {
                    h = "0" + l.toString(16)
                }
                return h
            }
            ;
            Color.prototype.init = function(n, l, h, m) {
                if (n != null ) {
                    this.red = n
                } else {
                    this.red = 0
                }
                if (l != null ) {
                    this.green = l
                } else {
                    this.green = 0
                }
                if (h != null ) {
                    this.blue = h
                } else {
                    this.blue = 0
                }
                if (m != null ) {
                    this.alpha = m
                } else {
                    this.alpha = 1
                }
            }
        }
        Color._initialized = true;
        _classes.defineClass("Color", g)
    }
    this.init(d, b, a, c)
}
Color.parse = function(b) {
    if (b == null ) {
        return
    }
    if (!isNaN(b)) {
        return Color.parseNumber(b)
    }
    var a = /rgba/;
    if (a.exec(b) != null ) {
        return Color.parseRGBA(b)
    }
    var c = /#/;
    if (c.exec(b) != null ) {
        return Color.parseCSS(b)
    }
}
;
Color.parseCSS = function(d) {
    if (d == null ) {
        return
    }
    d = new String(d);
    var b = d.indexOf("#") + 1;
    var c = d.substring(b, b + 2);
    var a = d.substring(b + 2, b + 4);
    var g = d.substring(b + 4, b + 6);
    return new Color(parseInt(c, 16),parseInt(a, 16),parseInt(g, 16))
}
;
Color.parseRGBA = function(c) {
    if (c == null ) {
        return
    }
    c = new String(c);
    var l = c.indexOf("rgba(");
    var a = l + 5;
    var p = c.indexOf(",", a) + 1;
    var h = c.indexOf(",", p) + 1;
    var b = c.indexOf(",", h) + 1;
    var n = c.indexOf(")");
    var m = c.substring(a, p - 1);
    var o = c.substring(p, h - 1);
    var d = c.substring(h, b - 1);
    var g = c.substring(b, n);
    return new Color(parseInt(m),parseInt(o),parseInt(d),parseFloat(g))
}
;
Color.parseNumber = function(c) {
    if (c < 0) {
        c = c >>> 0
    }
    var g = (c >> 16);
    var b = c - (g << 16);
    var d = b >> 8;
    var a = b - (d << 8);
    return new Color(g,d,a)
}
;
var ColorConstants = {};
ColorConstants.white = new Color(255,255,255);
ColorConstants.lightGray = new Color(192,192,192);
ColorConstants.gray = new Color(128,128,128);
ColorConstants.darkGray = new Color(64,64,64);
ColorConstants.black = new Color(0,0,0);
ColorConstants.red = new Color(255,0,0);
ColorConstants.orange = new Color(255,196,0);
ColorConstants.yellow = new Color(255,255,0);
ColorConstants.green = new Color(0,255,0);
ColorConstants.lightGreen = new Color(96,255,96);
ColorConstants.darkGreen = new Color(0,127,0);
ColorConstants.cyan = new Color(0,255,255);
ColorConstants.lightBlue = new Color(127,127,255);
ColorConstants.blue = new Color(0,0,255);
ColorConstants.darkBlue = new Color(0,0,127);
ColorConstants.buttonLightest = new Color(255,255,255);
ColorConstants.button = new Color(240,240,240);
ColorConstants.buttonDarker = new Color(160,160,160);
ColorConstants.buttonDarkest = new Color(105,105,105);
ColorConstants.listBackground = new Color(255,255,255);
ColorConstants.listForeground = new Color(0,0,0);
ColorConstants.menuBackground = new Color(240,240,240);
ColorConstants.menuForeground = new Color(0,0,0);
ColorConstants.menuBackgroundSelected = new Color(51,153,255);
ColorConstants.menuForegroundSelected = new Color(255,255,255);
ColorConstants.titleBackground = new Color(153,180,209);
ColorConstants.titleGradient = new Color(185,209,234);
ColorConstants.titleForeground = new Color(0,0,0);
ColorConstants.titleInactiveForeground = new Color(67,78,84);
ColorConstants.titleInactiveBackground = new Color(191,205,219);
ColorConstants.titleInactiveGradient = new Color(215,228,242);
ColorConstants.tooltipForeground = new Color(0,0,0);
ColorConstants.tooltipBackground = new Color(255,255,225);
_classes.registerClass("AbstractBorder");
function AbstractBorder() {
    if (typeof AbstractBorder._initialized == "undefined") {
        function a() {
            AbstractBorder.prototype.getPaintRectangle = function(b, c) {
                AbstractBorder.tempRect.setBounds(b.getBounds());
                return AbstractBorder.tempRect.crop(c)
            }
            ;
            AbstractBorder.prototype.getPreferredSize = function(b) {
                return AbstractBorder.EMPTY
            }
            ;
            AbstractBorder.prototype.isOpaque = function() {
                return false
            }
            ;
            AbstractBorder.prototype.init = function() {}
        }
        AbstractBorder._initialized = true;
        _classes.defineClass("AbstractBorder", a)
    }
    this.init()
}
AbstractBorder.EMPTY = new Dimension(0,0);
AbstractBorder.tempRect = new Rectangle(0,0,0,0);
_classes.registerClass("AbstractBackground", "AbstractBorder");
function AbstractBackground() {
    if (typeof AbstractBackground._initialized == "undefined") {
        function a() {
            AbstractBackground.prototype.getInsets = function(b) {
                return Figure.NO_INSETES
            }
            ;
            AbstractBackground.prototype.paint = function(b, d, c) {}
            ;
            AbstractBackground.prototype.paintBackground = function(b, d, c) {}
            ;
            AbstractBackground.prototype.init = function() {}
        }
        AbstractBackground._initialized = true;
        _classes.defineClass("AbstractBackground", a)
    }
    this.init()
}
_classes.registerClass("AbstractLabeledBorder", "AbstractBorder");
function AbstractLabeledBorder(a) {
    if (typeof AbstractLabeledBorder._initialized == "undefined") {
        function b() {
            AbstractLabeledBorder.prototype.calculateInsets = function(c) {}
            ;
            AbstractLabeledBorder.prototype.getFont = function(c) {
                if (this.font == null ) {
                    return f.getFont()
                }
                return this.font
            }
            ;
            AbstractLabeledBorder.prototype.getInsets = function(c) {
                if (this.insets == null ) {
                    this.insets = this.calculateInsets(c)
                }
                return this.insets
            }
            ;
            AbstractLabeledBorder.prototype.getLabel = function() {
                return this.label
            }
            ;
            AbstractLabeledBorder.prototype.getPreferredSize = function(c) {
                return new Dimension(this.getTextExtents(c))
            }
            ;
            AbstractLabeledBorder.prototype.getTextColor = function() {
                return this.textColor
            }
            ;
            AbstractLabeledBorder.prototype.getTextExtents = function(c) {
                if (this.textExtents == null ) {
                    this.textExtents = FigureUtilities.getTextExtents(this.label, this.getFont(c))
                }
                return this.textExtents
            }
            ;
            AbstractLabeledBorder.prototype.invalidate = function() {
                this.insets = null ;
                this.textExtents = null 
            }
            ;
            AbstractLabeledBorder.prototype.setFont = function(c) {
                this.font = c;
                this.invalidate()
            }
            ;
            AbstractLabeledBorder.prototype.setLabel = function(c) {
                this.label = ((c == null ) ? "" : c);
                this.invalidate()
            }
            ;
            AbstractLabeledBorder.prototype.setTextColor = function(c) {
                this.textColor = c
            }
            ;
            AbstractLabeledBorder.prototype.init = function(c) {
                this.textExtents = null ;
                this.label = null ;
                this.insets = null ;
                this.textColor = ColorConstants.black;
                this.font = null ;
                this.setLabel(c)
            }
        }
        AbstractLabeledBorder._initialized = true;
        _classes.defineClass("AbstractLabeledBorder", b)
    }
    this.init(a)
}
_classes.registerClass("CompoundBorder", "AbstractBorder");
function CompoundBorder(b, a) {
    if (typeof CompoundBorder._initialized == "undefined") {
        function c() {
            CompoundBorder.prototype.getInnerBorder = function() {
                return this.inner
            }
            ;
            CompoundBorder.prototype.getInsets = function(d) {
                var h = null ;
                if (this.inner != null ) {
                    h = this.inner.getInsets(d)
                } else {
                    h = new Insets()
                }
                if (this.outer != null ) {
                    var g = this.outer.getInsets(d);
                    h = h.getAdded(g)
                }
                return h
            }
            ;
            CompoundBorder.prototype.getPreferredSize = function(g) {
                var d = new Dimension(this.inner.getPreferredSize(g));
                var h = this.outer.getInsets(g);
                d.expand(h.getWidth(), h.getHeight());
                d.union(this.outer.getPreferredSize(g));
                return d
            }
            ;
            CompoundBorder.prototype.getOuterBorder = function() {
                return this.outer
            }
            ;
            CompoundBorder.prototype.isOpaque = function() {
                return ((this.inner != null ) ? this.inner.isOpaque() : false) && ((this.outer != null ) ? this.outer.isOpaque() : false)
            }
            ;
            CompoundBorder.prototype.paint = function(d, h, g) {
                if (this.outer != null ) {
                    h.saveState();
                    this.outer.paint(d, h, g);
                    h.restoreState();
                    g = g.getAdded(this.outer.getInsets(d))
                }
                if (this.inner != null ) {
                    this.inner.paint(d, h, g)
                }
            }
            ;
            CompoundBorder.prototype.init = function(g, d) {
                this.inner = d;
                this.outer = g
            }
        }
        CompoundBorder._initialized = true;
        _classes.defineClass("CompoundBorder", c)
    }
    this.init(b, a)
}
_classes.registerClass("FocusBorder", "AbstractBorder");
function FocusBorder() {
    if (typeof FocusBorder._initialized == "undefined") {
        function a() {
            FocusBorder.prototype.getInsets = function(b) {
                return new Insets(1)
            }
            ;
            FocusBorder.prototype.paint = function(b, d, c) {
                AbstractBorder.tempRect.setBounds(this.getPaintRectangle(b, c));
                AbstractBorder.tempRect.width--;
                AbstractBorder.tempRect.height--;
                d.setStrokeColor(ColorConstants.black);
                d.setFillColor(ColorConstants.black);
                d.drawFocus(AbstractBorder.tempRect)
            }
            ;
            FocusBorder.prototype.isOpaque = function() {
                return true
            }
            ;
            FocusBorder.prototype.init = function() {}
        }
        FocusBorder._initialized = true;
        _classes.defineClass("FocusBorder", a)
    }
    this.init()
}
_classes.registerClass("LineBorder", "AbstractBorder");
function LineBorder(b, a) {
    if (typeof LineBorder._initialized == "undefined") {
        function c() {
            LineBorder.prototype.getColor = function() {
                return this.color
            }
            ;
            LineBorder.prototype.getInsets = function(d) {
                return new Insets(this.getWidth())
            }
            ;
            LineBorder.prototype.getWidth = function() {
                return this.width
            }
            ;
            LineBorder.prototype.paint = function(d, l, g) {
                AbstractBorder.tempRect.setBounds(this.getPaintRectangle(d, g));
                if (this.getWidth() % 2 == 1) {
                    AbstractBorder.tempRect.width--;
                    AbstractBorder.tempRect.height--
                }
                AbstractBorder.tempRect.shrink(this.getWidth() / 2, this.getWidth() / 2);
                l.setLineWidth(this.getWidth());
                if (this.getColor() != null ) {
                    l.setStrokeColor(this.getColor())
                }
                var h = AbstractBorder.tempRect;
                l.strokeRect(h.x, h.y, h.width, h.height)
            }
            ;
            LineBorder.prototype.setColor = function(d) {
                this.color = d
            }
            ;
            LineBorder.prototype.setWidth = function(d) {
                if (d > 0) {
                    this.width = d
                }
            }
            ;
            LineBorder.prototype.isOpaque = function() {
                return true
            }
            ;
            LineBorder.prototype.init = function(g, d) {
                this.parentMethod("init");
                this.width = 1;
                this.setWidth(g);
                this.setColor(d)
            }
        }
        LineBorder._initialized = true;
        _classes.defineClass("LineBorder", c)
    }
    this.init(b, a)
}
_classes.registerClass("MarginBorder", "AbstractBorder");
function MarginBorder(d, c, b, a) {
    if (typeof MarginBorder._initialized == "undefined") {
        function g() {
            MarginBorder.prototype.getInsets = function(h) {
                return this.insets
            }
            ;
            MarginBorder.prototype.paint = function(h, m, l) {}
            ;
            MarginBorder.prototype.init = function(n, m, l, h) {
                if (n != null ) {
                    if (Util.isInstanceOf(n, Insets)) {
                        this.insets = n
                    } else {
                        if (m != null  && l != null  && h != null ) {
                            this.insets = new Insets(n,m,l,h)
                        } else {
                            this.insets = new Insets(n)
                        }
                    }
                }
            }
        }
        MarginBorder._initialized = true;
        _classes.defineClass("MarginBorder", g)
    }
    this.init(d, c, b, a)
}
_classes.registerClass("Scheme");
function Scheme(a, c) {
    if (typeof Scheme._initialized == "undefined") {
        function b() {
            Scheme.prototype.calculateInsets = function() {
                var d = this.highlight.length;
                var g = this.shadow.length;
                return new Insets(d,d,g,g)
            }
            ;
            Scheme.prototype.calculateOpaque = function() {
                var d = this.highlight;
                for (var g = 0; g < d.length; g++) {
                    if (d[g] == null ) {
                        return false
                    }
                }
                d = this.shadow;
                for (g = 0; g < d.length; g++) {
                    if (d[g] == null ) {
                        return false
                    }
                }
                return true
            }
            ;
            Scheme.prototype.initialize = function() {
                this.insets = this.calculateInsets();
                this.isOpaque = this.calculateOpaque()
            }
            ;
            Scheme.prototype.init = function(d, g) {
                this.insets = null ;
                this.isOpaque = false;
                this.highlight = d || [];
                this.shadow = g || d || [];
                this.initialize()
            }
        }
        Scheme._initialized = true;
        _classes.defineClass("Scheme", b)
    }
    this.init(a, c)
}
_classes.registerClass("SchemeBorder", "AbstractBorder");
function SchemeBorder(a) {
    if (typeof SchemeBorder._initialized == "undefined") {
        function b() {
            SchemeBorder.prototype.getInsets = function(c) {
                return this.scheme.insets
            }
            ;
            SchemeBorder.prototype.isOpaque = function() {
                return true
            }
            ;
            SchemeBorder.prototype.paint = function(c, g, d) {
                this.internal_paint(g, c, d, this.scheme.highlight, this.scheme.shadow)
            }
            ;
            SchemeBorder.prototype.internal_paint = function(p, d, h, s, r) {
                p.setLineWidth(1);
                var o = this.getPaintRectangle(d, h);
                var n = o.y;
                var g = o.x;
                var c = o.bottom() - 1;
                var q = o.right() - 1;
                var l;
                var m = 0;
                p.beginPath();
                for (; m < r.length; m++) {
                    l = r[m];
                    p.setStrokeColor(l);
                    p.moveTo(q - m, c - m);
                    p.lineTo(q - m, n + m);
                    p.moveTo(q - m, c - m);
                    p.lineTo(g + m, c - m)
                }
                p.stroke();
                q--;
                c--;
                p.beginPath();
                for (m = 0; m < s.length; m++) {
                    l = s[m];
                    p.setStrokeColor(l);
                    p.moveTo(g + m, n + m);
                    p.lineTo(q - m, n + m);
                    p.moveTo(g + m, n + m);
                    p.lineTo(g + m, c - m)
                }
                p.stroke()
            }
            ;
            SchemeBorder.prototype.init = function(c) {
                this.scheme = c
            }
        }
        SchemeBorder._initialized = true;
        _classes.defineClass("SchemeBorder", b)
    }
    this.init(a)
}
SchemeBorder.DARKEST_DARKER = [ColorConstants.buttonDarkest, ColorConstants.buttonDarker];
SchemeBorder.LIGHTER_DARKER = [ColorConstants.buttonLightest, ColorConstants.buttonDarker];
SchemeBorder.DARKER_LIGHTER = [ColorConstants.buttonDarker, ColorConstants.buttonLightest];
SchemeBorder.SCHEMES = {
    BUTTON_CONTRAST: new Scheme([ColorConstants.button, ColorConstants.buttonLightest],SchemeBorder.DARKEST_DARKER),
    BUTTON_RAISED: new Scheme([ColorConstants.buttonLightest],SchemeBorder.DARKEST_DARKER),
    BUTTON_PRESSED: new Scheme(SchemeBorder.DARKEST_DARKER,[ColorConstants.buttonLightest]),
    RAISED: new Scheme([ColorConstants.buttonLightest],[ColorConstants.buttonDarkest]),
    LOWERED: new Scheme([ColorConstants.buttonDarkest],[ColorConstants.buttonLightest]),
    RIDGED: new Scheme(SchemeBorder.LIGHTER_DARKER,SchemeBorder.DARKER_LIGHTER),
    ETCHED: new Scheme(SchemeBorder.DARKER_LIGHTER,SchemeBorder.LIGHTER_DARKER)
};
_classes.registerClass("ButtonScheme", "Scheme");
function ButtonScheme(a, g, c, b) {
    if (typeof ButtonScheme._initialized == "undefined") {
        function d() {
            ButtonScheme.prototype.calculateInsets = function() {
                var h = Math.max(this.highlight.length, this.shadowPressed.length);
                var l = 1 + Math.max(this.shadow.length, this.highlightPressed.length);
                return new Insets(h,h,l,l)
            }
            ;
            ButtonScheme.prototype.calculateOpaque = function() {
                this.isa = "ButtonScheme";
                if (!this.parentMethod("calculateOpaque")) {
                    return false
                }
                if (this.highlight.length != this.shadowPressed.length) {
                    return false
                }
                if (this.shadow.length != this.highlightPressed.length) {
                    return false
                }
                var h = this.highlightPressed;
                for (var l = 0; l < h.length; l++) {
                    if (h[l] == null ) {
                        return false
                    }
                }
                h = this.shadowPressed;
                for (l = 0; l < h.length; l++) {
                    if (h[l] == null ) {
                        return false
                    }
                }
                return true
            }
            ;
            ButtonScheme.prototype.initialize = function() {
                this.insets = this.calculateInsets();
                this.isOpaque = this.calculateOpaque()
            }
            ;
            ButtonScheme.prototype.init = function(h, n, m, l) {
                this.highlight = h;
                this.shadow = n;
                this.highlightPressed = m || h;
                this.shadowPressed = m || n;
                this.initialize()
            }
        }
        ButtonScheme._initialized = true;
        _classes.defineClass("ButtonScheme", d)
    }
    this.init(a, g, c, b)
}
_classes.registerClass("ButtonBorder", "SchemeBorder");
function ButtonBorder(a) {
    if (typeof ButtonBorder._initialized == "undefined") {
        function b() {
            ButtonBorder.prototype.paint = function(g, m, h) {
                var d = g;
                var n = d.getModel();
                var c = this.scheme;
                if (d.isRolloverEnabled() && !n.isMouseOver() && !n.isSelected()) {
                    return
                }
                var l, o;
                if (n.isSelected() || n.isArmed()) {
                    l = c.shadowPressed;
                    o = c.highlightPressed
                } else {
                    l = c.highlight;
                    o = c.shadow
                }
                this.internal_paint(m, g, h, l, o)
            }
            ;
            ButtonBorder.prototype.init = function(c) {
                this.scheme = c || ButtonBorder.SCHEMES.BUTTON
            }
        }
        ButtonBorder._initialized = true;
        _classes.defineClass("ButtonBorder", b)
    }
    this.init(a)
}
ButtonBorder.SCHEMES = {
    BUTTON_CONTRAST: new ButtonScheme([ColorConstants.button, ColorConstants.buttonLightest],SchemeBorder.DARKEST_DARKER),
    BUTTON: new ButtonScheme([ColorConstants.buttonLightest],SchemeBorder.DARKEST_DARKER),
    TOOLBAR: new ButtonScheme([ColorConstants.buttonLightest],[ColorConstants.buttonDarker]),
    BUTTON_SCROLLBAR: new ButtonScheme([ColorConstants.button, ColorConstants.buttonLightest],SchemeBorder.DARKEST_DARKER,[ColorConstants.buttonDarker],[ColorConstants.buttonDarker])
};
_classes.registerClass("Html5Graphics");
function Html5Graphics(a, b) {
    if (typeof Html5Graphics._initialized == "undefined") {
        function c() {
            Html5Graphics.prototype.setAntialias = function(d) {}
            ;
            Html5Graphics.prototype.saveState = function() {
                this.context.save();
                this.stack.push(new Rectangle(this.currentClip));
                this.stackPointer++;
                this.scaleStack.push({
                    x: this.currentScale.x,
                    y: this.currentScale.y
                })
            }
            ;
            Html5Graphics.prototype.pushState = function() {
                this.context.save();
                this.stack.push(new Rectangle(this.currentClip));
                this.stackPointer++;
                this.scaleStack.push({
                    x: this.currentScale.x,
                    y: this.currentScale.y
                })
            }
            ;
            Html5Graphics.prototype.restoreState = function() {
                this.currentClip = this.stack.pop();
                this.stackPointer--;
                this.currentScale = this.scaleStack.pop();
                this.context.restore()
            }
            ;
            Html5Graphics.prototype.rotate = function(d) {
                this.context.rotate(d)
            }
            ;
            Html5Graphics.prototype.scale = function(d, g) {
                this.context.scale(d, g);
                if (d != 0 && d != 1) {
                    this.currentScale.x *= d
                }
                if (g != 0 && g != 1) {
                    this.currentScale.y *= g
                }
            }
            ;
            Html5Graphics.prototype.setTransform = function(l, h, n, m, g, d) {
                this.context.setTransform(l, h, n, m, g, d)
            }
            ;
            Html5Graphics.prototype.transform = function(l, h, n, m, g, d) {
                this.context.transform(l, h, n, m, g, d)
            }
            ;
            Html5Graphics.prototype.translate = function(g, d) {
                if (g == 0 && d == 0) {
                    return
                }
                this.context.translate(g, d);
                if (this.currentClip) {
                    this.currentClip.translate(-g * this.currentScale.x, -d * this.currentScale.y)
                }
            }
            ;
            Html5Graphics.prototype.getGlobalAlpha = function() {
                return this.context.globalAlpha
            }
            ;
            Html5Graphics.prototype.setGlobalAlpha = function(d) {
                this.context.globalAlpha = d
            }
            ;
            Html5Graphics.prototype.getGlobalCompositeOperation = function() {
                return this.context.globalCompositeOperation
            }
            ;
            Html5Graphics.prototype.setGlobalCompositeOperation = function(d) {
                this.context.globalCompositeOperation = d
            }
            ;
            Html5Graphics.prototype.getFillStyle = function() {
                return this.context.fillStyle
            }
            ;
            Html5Graphics.prototype.setFillStyle = function(d) {
                this.context.fillStyle = d
            }
            ;
            Html5Graphics.prototype.getStrokeStyle = function() {
                return this.context.strokeStyle
            }
            ;
            Html5Graphics.prototype.setStrokeStyle = function(d) {
                this.context.strokeStyle = d
            }
            ;
            Html5Graphics.prototype.createLinearGradient = function(g, l, d, h) {
                return this.context.createLinearGradient(g, l, d, h)
            }
            ;
            Html5Graphics.prototype.createRadialGradient = function(l, n, h, g, m, d) {
                return this.context.createRadialGradient(l, n, h, g, m, d)
            }
            ;
            Html5Graphics.prototype.createPattern = function(g, d) {
                return this.context.createPattern(g, d)
            }
            ;
            Html5Graphics.prototype.addColorsToGrad = function(h, d) {
                for (var g = 0; g < d.length; g++) {
                    h.addColorStop(g / d.length, d[g].toRGB())
                }
                return h
            }
            ;
            Html5Graphics.prototype.setFillColor = function(g) {
                if (g == null ) {
                    return
                }
                var d = g.toRGBA();
                this.context.fillStyle = d
            }
            ;
            Html5Graphics.prototype.getFillColor = function() {
                var d = this.context.fillStyle;
                return Color.parse(d)
            }
            ;
            Html5Graphics.prototype.setStrokeColor = function(d) {
                if (d == null ) {
                    return
                }
                var g = d.toCSS();
                this.context.strokeStyle = g
            }
            ;
            Html5Graphics.prototype.getStrokeColor = function() {
                var d = a.strokeStyle;
                return Color.parseCSS(d)
            }
            ;
            Html5Graphics.prototype.getLineCap = function() {
                return this.context.lineCap
            }
            ;
            Html5Graphics.prototype.setLineCap = function(d) {
                this.context.lineCap = d
            }
            ;
            Html5Graphics.prototype.getLineJoin = function() {
                return this.context.lineJoin
            }
            ;
            Html5Graphics.prototype.setLineJoin = function(d) {
                this.context.lineJoin = d
            }
            ;
            Html5Graphics.prototype.getLineWidth = function() {
                return this.context.lineWidth
            }
            ;
            Html5Graphics.prototype.setLineWidth = function(d) {
                this.context.lineWidth = d
            }
            ;
            Html5Graphics.prototype.getMiterLimit = function() {
                return this.context.miterLimit
            }
            ;
            Html5Graphics.prototype.setMiterLimit = function(d) {
                this.context.miterLimit = d
            }
            ;
            Html5Graphics.prototype.setLineAttributes = function(g) {
                if (g == null ) {
                    return
                }
                var h = g.lineCap.toLowerCase();
                if (h == "butt" || h == "round" || h == "square") {
                    this.context.lineCap = g.lineCap
                }
                var d = g.lineJoin.toLowerCase();
                if (d == "miter" || d == "round" || d == "bevel") {
                    this.context.lineJoin = g.lineJoin
                }
                if (g.lineWidth > 0) {
                    this.context.lineWidth = g.lineWidth
                }
                if (g.miterLimit > 0) {
                    this.context.miterLimit = g.miterLimit
                }
                this.setStrokeColor(g.lineColor)
            }
            ;
            Html5Graphics.prototype.getShadowBlur = function() {
                return this.context.shadowBlur
            }
            ;
            Html5Graphics.prototype.setShadowBlur = function(d) {
                this.context.shadowBlur = d
            }
            ;
            Html5Graphics.prototype.getShadowColor = function() {
                return this.context.shadowColor
            }
            ;
            Html5Graphics.prototype.setShadowColor = function(d) {
                this.context.shadowColor = d
            }
            ;
            Html5Graphics.prototype.getShadowOffsetX = function() {
                return this.context.shadowOffsetX
            }
            ;
            Html5Graphics.prototype.setShadowOffsetX = function(d) {
                this.context.shadowOffsetX = d
            }
            ;
            Html5Graphics.prototype.getShadowOffsetY = function() {
                return this.context.shadowOffsetY
            }
            ;
            Html5Graphics.prototype.setShadowOffsetY = function(d) {
                this.context.shadowOffsetY = d
            }
            ;
            Html5Graphics.prototype.clearRect = function(d, m, g, l) {
                this.context.clearRect(d, m, g, l)
            }
            ;
            Html5Graphics.prototype.fillRect = function(d, m, g, l) {
                this.context.fillRect(d, m, g, l)
            }
            ;
            Html5Graphics.prototype.strokeRect = function(d, m, g, l) {
                this.context.strokeRect(d, m, g, l)
            }
            ;
            Html5Graphics.prototype.arc = function(g, n, d, l, h, m) {
                this.context.arc(g, n, d, l, h, m)
            }
            ;
            Html5Graphics.prototype.arcTo = function(h, m, g, l, d) {
                this.context.arcTo(h, m, g, l, d)
            }
            ;
            Html5Graphics.prototype.beginPath = function() {
                this.context.beginPath()
            }
            ;
            Html5Graphics.prototype.bezierCurveTo = function(h, g, m, l, d, n) {
                this.context.bezierCurveTo(h, g, m, l, d, n)
            }
            ;
            Html5Graphics.prototype.closePath = function() {
                this.context.closePath()
            }
            ;
            Html5Graphics.prototype.fill = function() {
                this.context.fill()
            }
            ;
            Html5Graphics.prototype.lineTo = function(d, g) {
                this.context.lineTo(d, g)
            }
            ;
            Html5Graphics.prototype.moveTo = function(d, g) {
                this.context.moveTo(d, g)
            }
            ;
            Html5Graphics.prototype.quadraticCurveTo = function(h, g, d, l) {
                this.context.quadraticCurveTo(h, g, d, l)
            }
            ;
            Html5Graphics.prototype.rect = function(d, m, g, l) {
                this.context.rect(d, m, g, l)
            }
            ;
            Html5Graphics.prototype.stroke = function() {
                this.context.stroke()
            }
            ;
            Html5Graphics.prototype.isPointInPath = function(d, g) {
                return this.context.isPointInPath(d, g)
            }
            ;
            Html5Graphics.prototype.ellipse = function(d, o, n, h, l, g, m) {
                this.context.moveTo(d + n * Math.cos(l * Math.PI / 180), o - h * Math.sin(l * Math.PI / 180));
                this.lineToEllipse(d, o, n, h, l, g, m)
            }
            ;
            Html5Graphics.prototype.lineToEllipse = function(r, p, d, m, o, h, l) {
                for (var n = o; n <= h; n++) {
                    var s = n * Math.PI / 180;
                    var g = r + d * Math.cos(s);
                    var q = p - m * Math.sin(s);
                    this.context.lineTo(g, q)
                }
            }
            ;
            Html5Graphics.prototype.roundRect = function(g, n, l, d, m, h) {
                this.context.moveTo(g + 0.5, n + h);
                this.lineToEllipse(g + m + 0.5, n + d - h, m, h - 0.5, 180, 270, true);
                this.lineToEllipse(g + l - m, n + d - h - 0.5, m, h - 0.5, 270, 360, true);
                this.lineToEllipse(g + l - m, n + h, m, h, 0, 90, true);
                this.lineToEllipse(g + m + 0.5, n + h, m, h, 90, 180, true)
            }
            ;
            Html5Graphics.prototype.polygon = function(d) {
                var l = d.getFirstPoint();
                if (l == null ) {
                    return
                }
                this.context.moveTo(l.x, l.y);
                for (var h = 1; h < d.size; h++) {
                    var g = d.getPoint(h);
                    this.context.lineTo(g.x, g.y)
                }
                this.context.lineTo(l.x, l.y)
            }
            ;
            Html5Graphics.prototype.polyline = function(d, l) {
                var m = d.getFirstPoint();
                if (m == null ) {
                    return
                }
                if (l) {
                    this.context.moveTo((m.x >> 0) + 0.5, (m.y >> 0) + 0.5)
                } else {
                    this.context.moveTo(m.x, m.y)
                }
                for (var h = 1; h < d.size; h++) {
                    var g = d.getPoint(h);
                    if (l) {
                        this.context.lineTo((g.x >> 0) + 0.5, (g.y >> 0) + 0.5)
                    } else {
                        this.context.lineTo(g.x, g.y)
                    }
                }
                return m
            }
            ;
            Html5Graphics.prototype.dashedPolyline = function(o, m, h, g) {
                var p = o.getFirstPoint();
                if (p == null ) {
                    return
                }
                var n = p;
                var d;
                for (var l = 1; l < o.size; l++) {
                    var d = o.getPoint(l);
                    this.dashedLine(n.x, n.y, d.x, d.y, m, h, g);
                    n = d
                }
            }
            ;
            Html5Graphics.prototype.dashedLine = function(w, t, d, u, m, p, q) {
                if (!q) {
                    q = [m, p]
                }
                var o = q.length;
                this.context.moveTo(w, t);
                var A = (d - w)
                  , z = (u - t);
                var r = z / A;
                var l = Math.sqrt(A * A + z * z);
                var n = 0
                  , v = true;
                var s = A == 0 ? (u > t ? 1 : -1) : (d > w ? 1 : -1);
                while (l >= 0.1) {
                    var h = q[n++ % o];
                    if (h > l) {
                        h = l
                    }
                    var g = A == 0 ? 0 : Math.sqrt(h * h / (1 + r * r));
                    w += g * s;
                    t += A == 0 ? h * s : r * g * s;
                    this[v ? "lineTo" : "moveTo"](w, t);
                    l -= h;
                    v = !v
                }
            }
            ;
            Html5Graphics.prototype.drawFocus = function(g, l, h, d) {
                this.beginPath();
                this.dashedPolyline(new PointList([g + 0.5, l + 0.5, g + h - 0.5, l + 0.5, g + h - 0.5, l + d - 0.5, g + 0.5, l + d - 0.5, g + 0.5, l + 0.5]), 4, 4, Html5Graphics.FOCUS_PATTERN);
                this.stroke()
            }
            ;
            Html5Graphics.prototype.getFont = function() {
                return this.context.font
            }
            ;
            Html5Graphics.prototype.setFont = function(d) {
                if (d == null ) {
                    return
                }
                this.context.font = d
            }
            ;
            Html5Graphics.prototype.getTextAlign = function() {
                return this.context.textAlign
            }
            ;
            Html5Graphics.prototype.setTextAlign = function(d) {
                this.context.textAlign = d
            }
            ;
            Html5Graphics.prototype.getTextBaseline = function() {
                return this.context.textBaseline
            }
            ;
            Html5Graphics.prototype.setTextBaseline = function(d) {
                this.context.textBaseline = d
            }
            ;
            Html5Graphics.prototype.fillText = function(g, d, l, h) {
                //debugger;
                if (Util.browser.ie && 11 == Util.browser.version) {
                    l -= 2
                }
                if (g != null  && !isNaN(d) && !isNaN(l) && !isNaN(h)) {
                    this.context.fillText(g, d, l, h)
                } else {
                    if (g != null  && !isNaN(d) && !isNaN(l)) {
                        this.context.fillText(g, d, l)
                    }
                }
            }
            ;
            Html5Graphics.prototype.measureText = function(d) {
                return this.context.measureText(d)
            }
            ;
            Html5Graphics.prototype.strokeText = function(g, d, l, h) {
                if (Util.browser.ie && 11 == Util.browser.version) {
                    l -= 2
                }
                if (g != null  && !isNaN(d) && !isNaN(l) && !isNaN(h)) {
                    this.context.strokeText(g, d, l, h)
                } else {
                    if (g != null  && !isNaN(d) && !isNaN(l)) {
                        this.context.strokeText(g, d, l)
                    }
                }
            }
            ;
            Html5Graphics.prototype.drawImage = function(h, g, q, m, o, d, p, l, n) {
                if (h == null ) {
                    return
                }
                if (!isNaN(g) && !isNaN(q)) {
                    if (!isNaN(m) && !isNaN(o)) {
                        if (!isNaN(l) && !isNaN(n)) {
                            this.context.drawImage(h, g, q, m, o, d, p, l, n)
                        } else {
                            this.context.drawImage(h, g, q, m, o)
                        }
                    } else {
                        this.context.drawImage(h, g, q)
                    }
                }
            }
            ;
            Html5Graphics.prototype.createImageData = function(g, d) {
                if (g != null  && d != null ) {
                    return this.context.createImageData(g, d)
                } else {
                    if (g != null ) {
                        return this.context.createImageData(g)
                    }
                }
            }
            ;
            Html5Graphics.prototype.getImageData = function(l, h, d, g) {
                return this.context.getImageData(l, h, d, g)
            }
            ;
            Html5Graphics.prototype.putImageData = function(m, l, h, g, o, d, n) {
                if (m == null ) {
                    return
                }
                if (!isNaN(l) && !isNaN(h) && !isNaN(g) && !isNaN(o) && !isNaN(d) && !isNaN(n)) {
                    this.context.putImageData(m, l, h, g, o, d, n)
                } else {
                    if (!isNaN(l) && !isNaN(h)) {
                        this.context.putImageData(m, l, h)
                    }
                }
            }
            ;
            Html5Graphics.prototype.fillRectangle = function(g, l, h, d) {
                if (!isNaN(g) && !isNaN(l) && !isNaN(h) && !isNaN(d)) {
                    this.context.fillRect(g, l, h, d)
                } else {
                    if (g != null  && Util.isInstanceOf(g, Rectangle)) {
                        this.context.fillRect(g.x, g.y, g.width, g.height)
                    }
                }
            }
            ;
            Html5Graphics.prototype.clipRect = function(d) {
                this.currentClip.intersect(d.x * this.currentScale.x, d.y * this.currentScale.y, d.width * this.currentScale.x, d.height * this.currentScale.y);
                this.context.beginPath();
                this.context.rect(d.x, d.y, d.width, d.height);
                this.context.closePath();
                this.context.clip()
            }
            ;
            Html5Graphics.prototype.clipPath = function(d) {}
            ;
            Html5Graphics.prototype.getClip = function(d) {
                d.x = this.currentClip.x / this.currentScale.x;
                d.y = this.currentClip.y / this.currentScale.y;
                d.width = this.currentClip.width / this.currentScale.x;
                d.height = this.currentClip.height / this.currentScale.y;
                return d
            }
            ;
            Html5Graphics.prototype.dispose = function() {
                while (this.stackPointer > 0) {
                    this.restoreState()
                }
                delete this.context
            }
            ;
            Html5Graphics.prototype.init = function(d, g) {
                this.context = d;
                this.stack = [];
                this.stackPointer = 0;
                this.scaleStack = [];
                this.currentScale = {
                    x: 1,
                    y: 1
                };
                this.pushState();
                if (g == null ) {
                    g = new Rectangle(0,0,d.canvas.width,d.canvas.height)
                }
                this.currentClip = g;
                this.clipRect(g);
                this.setTextBaseline("top");
                this.setFont("12px sans-serif")
            }
        }
        Html5Graphics._initialized = true;
        _classes.defineClass("Html5Graphics", c)
    }
    this.init(a, b)
}
Html5Graphics.FOCUS_PATTERN = [1, 2, 1, 2];
_classes.registerClass("TreeSearch");
function TreeSearch() {
    if (typeof TreeSearch._initialized == "undefined") {
        function a() {
            TreeSearch.prototype.accept = function(b) {}
            ;
            TreeSearch.prototype.prune = function(b) {}
            ;
            TreeSearch.prototype.init = function() {
                this.parentMethod("init")
            }
        }
        TreeSearch._initialized = true;
        _classes.defineClass("TreeSearch", a)
    }
    this.init()
}
_classes.registerClass("ExclusionSearch", "TreeSearch");
function ExclusionSearch(b) {
    if (typeof ExclusionSearch._initialized == "undefined") {
        function a() {
            ExclusionSearch.prototype.accept = function(c) {
                return true
            }
            ;
            ExclusionSearch.prototype.prune = function(c) {
                if (this.c != null  && this.c.length > 0) {
                    return Util.Array.contains(this.c, c)
                }
                return false
            }
            ;
            ExclusionSearch.prototype.init = function(d) {
                this.parentMethod("init");
                this.c = d
            }
        }
        ExclusionSearch._initialized = true;
        _classes.defineClass("ExclusionSearch", a)
    }
    this.init(b)
}
_classes.registerClass("NoInsets", "Insets");
function NoInsets() {
    if (typeof NoInsets._initialized == "undefined") {
        function a() {
            NoInsets.prototype.isEmpty = function() {
                return true
            }
            ;
            NoInsets.prototype.init = function() {
                this.parentMethod("init", 0, 0, 0, 0)
            }
        }
        NoInsets._initialized = true;
        _classes.defineClass("NoInsets", a)
    }
    this.init()
}
_classes.registerClass("EmptyList", "Insets");
function EmptyList() {
    if (typeof EmptyList._initialized == "undefined") {
        function a() {
            EmptyList.prototype.isEmpty = function() {
                return true
            }
            ;
            EmptyList.prototype.init = function() {
                this.parentMethod("init", 0, 0, 0, 0)
            }
        }
        EmptyList._initialized = true;
        _classes.defineClass("EmptyList", a)
    }
    this.init()
}
_classes.registerClass("IdentitySearch", "TreeSearch");
function IdentitySearch(a) {
    if (typeof IdentitySearch._initialized == "undefined") {
        function b() {
            IdentitySearch.prototype.accept = function(c) {
                return true
            }
            ;
            IdentitySearch.prototype.prune = function(c) {
                return false
            }
            ;
            IdentitySearch.prototype.init = function(c) {
                this.parentMethod("init");
                this.host = c
            }
        }
        IdentitySearch._initialized = true;
        _classes.defineClass("IdentitySearch", b)
    }
    this.init(a)
}
IdentitySearch.INSTANCE = new IdentitySearch();
_classes.registerClass("LayoutNotifier");
function LayoutNotifier(b, c, a) {
    if (typeof LayoutNotifier._initialized == "undefined") {
        function d() {
            LayoutNotifier.prototype.getConstraint = function(g) {
                if (this.realLayout != null ) {
                    return this.realLayout.getConstraint(g)
                }
                return null 
            }
            ;
            LayoutNotifier.prototype.getMinimumSize = function(g, l, h) {
                if (this.realLayout != null ) {
                    return this.realLayout.getMinimumSize(g, l, h)
                }
                return null 
            }
            ;
            LayoutNotifier.prototype.getPreferredSize = function(g, l, h) {
                if (this.realLayout != null ) {
                    return realLayout.getPreferredSize(g, l, h)
                }
                return null 
            }
            ;
            LayoutNotifier.prototype.invalidate = function() {
                for (var g = 0; g < this.listeners.length; g++) {
                    this.listeners[g].invalidate(a)
                }
                if (this.realLayout != null ) {
                    this.realLayout.invalidate()
                }
            }
            ;
            LayoutNotifier.prototype.layout = function(g) {
                var l = false;
                for (var h = 0; h < this.listeners.length; h++) {
                    l |= this.listeners[h].layout(g)
                }
                if (this.realLayout != null  && !l) {
                    this.realLayout.layout(g)
                }
                for (var h = 0; h < this.listeners.length; h++) {
                    this.listeners[h].postLayout(g)
                }
            }
            ;
            LayoutNotifier.prototype.remove = function(h) {
                for (var g = 0; g < this.listeners.length; g++) {
                    this.listeners[g].remove(h)
                }
                if (this.realLayout != null ) {
                    this.realLayout.remove(h)
                }
            }
            ;
            LayoutNotifier.prototype.setConstraint = function(l, h) {
                for (var g = 0; g < listeners.length; g++) {
                    listeners[g].setConstraint(l, h)
                }
                if (this.realLayout != null ) {
                    this.realLayout.setConstraint(l, h)
                }
            }
            ;
            LayoutNotifier.prototype.init = function(h, l, g) {
                this.parentMethod("init");
                this.host = g;
                this.realLayout = h;
                this.listeners = [];
                this.listeners.push(l)
            }
        }
        LayoutNotifier._initialized = true;
        _classes.defineClass("LayoutNotifier", d)
    }
    this.init(b, c, a)
}
_classes.registerClass("FigureIterator");
function FigureIterator(a) {
    if (typeof FigureIterator._initialized == "undefined") {
        function b() {
            FigureIterator.prototype.nextFigure = function() {
                return this.list[--this.index]
            }
            ;
            FigureIterator.prototype.hasNext = function() {
                return this.index > 0
            }
            ;
            FigureIterator.prototype.init = function(c) {
                this.parentMethod("init");
                this.list = c.children;
                this.index = this.list.length
            }
        }
        FigureIterator._initialized = true;
        _classes.defineClass("FigureIterator", b)
    }
    this.init(a)
}
_classes.registerClass("Figure");
function Figure(b) {
    if (typeof Figure._initialized == "undefined") {
        function a() {
            Figure.prototype.add = function(h, g, d) {
                (this.id + " => Figure-add()");
                var c;
                for (c = this; c; c = c.getParent()) {
                    if (c == h) {
                        Debugger.log(this.id + " => Figure-add-Figure being added introduces cycle")
                    }
                }
                if (h.getParent()) {
                    h.getParent().remove(h)
                }
                d = (d == null ) ? -1 : d;
                if (d == -1) {
                    this.children.push(h)
                } else {
                    this.children.splice(d, 0, h)
                }
                h.setParent(this);
                if (this.layoutManager && g) {
                    this.layoutManager.setConstraint(h, g)
                }
                this.revalidate();
                if (this.getFlag(FigureConstants.FLAG_REALIZED)) {
                    h.addNotify()
                }
                h.repaint()
            }
            ;
            Figure.prototype.addAncestorListener = function(c) {
                if (this.ancestorHelper == null ) {
                    this.ancestorHelper = new AncestorHelper(this)
                }
                this.ancestorHelper.addAncestorListener(c)
            }
            ;
            Figure.prototype.addCoordinateListener = function(c) {
                this.eventListeners.addListener("CoordinateListener", c)
            }
            ;
            Figure.prototype.addFigureListener = function(c) {
                this.eventListeners.addListener("FigureListener", c)
            }
            ;
            Figure.prototype.addFocusListener = function(c) {
                this.eventListeners.addListener("FocusListener", c)
            }
            ;
            Figure.prototype.addKeyListener = function(c) {
                this.eventListeners.addListener("KeyListener", c)
            }
            ;
            Figure.prototype.addLayoutListener = function(c) {
                if (this.layoutManager != null  && Util.isInstanceOf(this.layoutManager, LayoutNotifier)) {
                    this.layoutManager.listeners.push(c)
                } else {
                    this.layoutManager = new LayoutNotifier(this.layoutManager,c,this)
                }
            }
            ;
            Figure.prototype.addListener = function(c, d) {
                this.eventListeners.addListener(c, d)
            }
            ;
            Figure.prototype.addMouseListener = function(c) {
                this.eventListeners.addListener("MouseListener", c)
            }
            ;
            Figure.prototype.addMouseMotionListener = function(c) {
                this.eventListeners.addListener("MouseMotionListener", c)
            }
            ;
            Figure.prototype.addNotify = function() {
                if (this.getFlag(FigureConstants.FLAG_REALIZED)) {
                    Debugger.log(this.id + " => addNotify() should not be called multiple times")
                }
                this.setFlag(FigureConstants.FLAG_REALIZED, true);
                for (var c = 0; c < this.children.length; c++) {
                    this.children[c].addNotify()
                }
            }
            ;
            Figure.prototype.addPropertyChangeListener = function(g, d) {
                if (this.propertyListeners == null ) {
                    this.propertyListeners = new PropertyChangeSupport(this)
                }
                if (arguments.length == 2 && g != null ) {
                    this.propertyListeners.addPropertyChangeListener(g, d)
                } else {
                    var c = (g != null  ? g : d);
                    this.propertyListeners.addPropertyChangeListener(d)
                }
            }
            ;
            Figure.prototype.containsPoint = function(g, d) {
                if (g == null ) {
                    return
                }
                var c;
                var h;
                if (Util.isInstanceOf(g, Point)) {
                    c = g.x;
                    h = g.y
                } else {
                    if (d != null ) {
                        c = g;
                        h = d
                    }
                }
                return this.getBounds().contains(c, h)
            }
            ;
            Figure.prototype.dispose = function() {
                if (null  != this.children) {
                    for (var c = 0; c < this.children.length; c++) {
                        var d = this.children[c];
                        this.children[c] = null ;
                        if (d && d.dispose) {
                            d.dispose()
                        }
                    }
                    this.children = null 
                }
                if (this.layoutManager && this.layoutManager.dispose) {
                    this.layoutManager.dispose()
                }
                this.layoutManager = null ;
                if (null  != this.ancestorHelper && this.ancestorHelper.dispose) {
                    this.ancestorHelper.dispose()
                }
                this.ancestorHelper = null ;
                if (null  != this.eventListeners) {
                    for (var c = 0; c < this.eventListeners.length; c++) {
                        this.eventListeners[c] = null 
                    }
                    this.eventListeners = null 
                }
                this.parent = null ;
                this.bounds = null ;
                this.maxSize = null ;
                this.minSize = null ;
                this.bgColor = null ;
                this.border = null 
            }
            ;
            Figure.prototype.erase = function() {
                if (!this.getParent() || !this.isVisible()) {
                    return
                }
                var c = new Rectangle(this.getBounds());
                this.getParent().translateToParent(c);
                this.getParent().repaint(c.x, c.y, c.width, c.height)
            }
            ;
            Figure.prototype.findDescendantAtExcluding = function(c, l, g) {
                Figure.PRIVATE_POINT.setLocation(c, l);
                this.translateFromParent(Figure.PRIVATE_POINT);
                if (!this.getClientArea(Rectangle.SINGLETON).contains(Figure.PRIVATE_POINT)) {
                    return null 
                }
                c = Figure.PRIVATE_POINT.x;
                l = Figure.PRIVATE_POINT.y;
                var h;
                for (var d = this.children.length; d > 0; ) {
                    d--;
                    h = this.children[d];
                    if (h.isVisible()) {
                        h = h.findFigureAt(c, l, g);
                        if (h != null ) {
                            return h
                        }
                    }
                }
                return null 
            }
            ;
            Figure.prototype.findFigureAt = function(g, d, c) {
                if (g == null ) {
                    return
                }
                if (c != null  && Util.isInstanceOf(c, TreeSearch)) {
                    if (!this.containsPoint(g, d)) {
                        return null 
                    }
                    if (c.prune(this)) {
                        return null 
                    }
                    var h = this.findDescendantAtExcluding(g, d, c);
                    if (h != null ) {
                        return h
                    }
                    if (c.accept(this)) {
                        return this
                    }
                    return null 
                }
                if (Util.isInstanceOf(g, Point)) {
                    return this.findFigureAtExcluding(g.x, g.y, Figure.EMPTY_LIST)
                } else {
                    if (d != null ) {
                        return this.findFigureAt(g, d, IdentitySearch.INSTANCE)
                    }
                }
            }
            ;
            Figure.prototype.findFigureAtExcluding = function(d, h, g) {
                return this.findFigureAt(d, h, new ExclusionSearch(g))
            }
            ;
            Figure.prototype.findMouseEventTargetAt = function(c, g) {
                if (!this.containsPoint(c, g)) {
                    return null 
                }
                var d = this.findMouseEventTargetInDescendantsAt(c, g);
                if (d != null ) {
                    return d
                }
                if (this.isMouseEventTarget()) {
                    return this
                }
                return null 
            }
            ;
            Figure.prototype.findMouseEventTargetInDescendantsAt = function(c, h) {
                Figure.PRIVATE_POINT.setLocation(c, h);
                this.translateFromParent(Figure.PRIVATE_POINT);
                if (!this.getClientArea(Rectangle.SINGLETON).contains(Figure.PRIVATE_POINT)) {
                    return null 
                }
                var g;
                for (var d = this.children.length; d > 0; ) {
                    d--;
                    g = this.children[d];
                    if (g.isVisible() && g.isEnabled()) {
                        if (g.containsPoint(Figure.PRIVATE_POINT.x, Figure.PRIVATE_POINT.y)) {
                            g = g.findMouseEventTargetAt(Figure.PRIVATE_POINT.x, Figure.PRIVATE_POINT.y);
                            return g
                        }
                    }
                }
                return null 
            }
            ;
            Figure.prototype.fireCoordinateSystemChanged = function() {
                if (!this.eventListeners.containsListener("CoordinateListener")) {
                    return
                }
                var c = this.eventListeners.getListeners("CoordinateListener");
                while (c.hasNext()) {
                    c.next().coordinateSystemChanged(this)
                }
            }
            ;
            Figure.prototype.fireFigureMoved = function() {
                if (!this.eventListeners.containsListener("FigureListener")) {
                    return
                }
                var c = this.eventListeners.getListeners("FigureListener");
                while (c.hasNext()) {
                    c.next().figureMoved(this)
                }
            }
            ;
            Figure.prototype.fireMoved = function() {
                this.fireFigureMoved();
                this.fireCoordinateSystemChanged()
            }
            ;
            Figure.prototype.firePropertyChange = function(d, c, g) {
                if (this.propertyListeners == null ) {
                    return
                }
                this.propertyListeners.firePropertyChange(d, c, g)
            }
            ;
            Figure.prototype.getBackgroundColor = function() {
                if (this.bgColor == null  && this.getParent() != null ) {
                    return this.getParent().getBackgroundColor()
                }
                return this.bgColor
            }
            ;
            Figure.prototype.getBorder = function() {
                return this.border
            }
            ;
            Figure.prototype.getBounds = function() {
                return this.bounds
            }
            ;
            Figure.prototype.getChildren = function() {
                return this.children
            }
            ;
            Figure.prototype.getClientArea = function(c) {
                if (c == null ) {
                    c = new Rectangle(0,0,0,0)
                }
                c.setBounds(this.getBounds());
                c.crop(this.getInsets());
                if (this.useLocalCoordinates()) {
                    c.setLocation(0, 0)
                }
                return c
            }
            ;
            Figure.prototype.getCursor = function() {
                if (this.cursor == null  && this.getParent() != null ) {
                    return this.getParent().getCursor()
                }
                return this.cursor
            }
            ;
            Figure.prototype.getFlag = function(c) {
                return (this.flags & c) != 0
            }
            ;
            Figure.prototype.getFont = function() {
                if (this.font != null ) {
                    return this.font
                }
                if (this.getParent() != null ) {
                    return this.getParent().getFont()
                }
                return null 
            }
            ;
            Figure.prototype.getForegroundColor = function() {
                if (this.fgColor == null  && this.getParent() != null ) {
                    return this.getParent().getForegroundColor()
                }
                return this.fgColor
            }
            ;
            Figure.prototype.getInsets = function() {
                if (this.border != null ) {
                    return this.border.getInsets(this)
                }
                return Figure.NO_INSETS
            }
            ;
            Figure.prototype.getLayoutManager = function() {
                if (this.layoutManager != null  && Util.isInstanceOf(this.layoutManager, LayoutNotifier)) {
                    return this.layoutManager.realLayout
                }
                return this.layoutManager
            }
            ;
            Figure.prototype.getListeners = function(c) {
                if (this.eventListeners == null ) {
                    return new EMPTY_IERATOR()
                }
                return this.eventListeners.getListeners(c)
            }
            ;
            Figure.prototype.getLocalBackgroundColor = function() {
                return this.bgColor
            }
            ;
            Figure.prototype.getLocalFont = function() {
                return this.font
            }
            ;
            Figure.prototype.getLocalForegroundColor = function() {
                return this.fgColor
            }
            ;
            Figure.prototype.getLocation = function() {
                return new Point(this.getBounds().x,this.getBounds().y)
            }
            ;
            Figure.prototype.getMaximumSize = function() {
                if (this.maxSize != null ) {
                    return maxSize
                }
                return Figure.MAX_DIMENSION
            }
            ;
            Figure.prototype.getMinimumSize = function(h, c) {
                var l = h;
                var g = c;
                if (h == null  || c == null ) {
                    l = -1;
                    g = -1
                }
                if (this.minSize != null ) {
                    return this.minSize
                }
                if (this.getLayoutManager() != null ) {
                    var m = this.getLayoutManager().getMinimumSize(this, l, g);
                    if (m != null ) {
                        return m
                    }
                }
                return this.getPreferredSize(l, g)
            }
            ;
            Figure.prototype.getParent = function() {
                return this.parent
            }
            ;
            Figure.prototype.getPreferredSize = function(l, c) {
                var h = l;
                var g = c;
                if (l == null  || c == null ) {
                    h = -1;
                    g = -1
                }
                if (this.prefSize) {
                    return this.prefSize
                }
                if (this.layoutManager) {
                    var m = this.layoutManager.getPreferredSize(this, h, g);
                    if (m) {
                        return m
                    }
                }
                return this.getSize()
            }
            ;
            Figure.prototype.getSize = function() {
                return this.getBounds().getSize()
            }
            ;
            Figure.prototype.getToolTip = function() {
                return this.toolTip
            }
            ;
            Figure.prototype.getUpdateManager = function() {
                if (this.getParent()) {
                    return this.getParent().getUpdateManager()
                } else {
                    return new UpdateManager()
                }
            }
            ;
            Figure.prototype.handleFocusGained = function(g) {
                var c = this.eventListeners.getListeners("FocusListener");
                var d;
                while (c.hasNext()) {
                    d = c.next();
                    if (d.focusGained != null ) {
                        d.focusGained(g, this)
                    }
                }
            }
            ;
            Figure.prototype.handleFocusLost = function(g) {
                var c = this.eventListeners.getListeners("FocusListener");
                var d;
                while (c.hasNext()) {
                    d = c.next();
                    if (d.focusLost != null ) {
                        d.focusLost(g, this)
                    }
                }
            }
            ;
            Figure.prototype.handleKeyPressed = function(g) {
                var c = this.eventListeners.getListeners("KeyListener");
                var d;
                while (!g.isConsumed() && c.hasNext()) {
                    d = c.next();
                    if (d.keyPressed != null ) {
                        d.keyPressed(g, this)
                    }
                }
            }
            ;
            Figure.prototype.handleKeyReleased = function(g) {
                var c = this.eventListeners.getListeners("KeyListener");
                var d;
                while (!g.isConsumed() && c.hasNext()) {
                    d = c.next();
                    if (d.keyReleased != null ) {
                        d.keyReleased(g, this)
                    }
                }
            }
            ;
            Figure.prototype.handleMouseDoubleClicked = function(g) {
                var c = this.eventListeners.getListeners("MouseListener");
                var d;
                while (!g.isConsumed() && c.hasNext()) {
                    d = c.next();
                    if (d.mouseDoubleClicked != null ) {
                        d.mouseDoubleClicked(g, this)
                    }
                }
            }
            ;
            Figure.prototype.handleMouseClicked = function(g) {
                var c = this.eventListeners.getListeners("MouseListener");
                var d;
                while (!g.isConsumed() && c.hasNext()) {
                    d = c.next();
                    if (d.mouseClicked != null ) {
                        d.mouseClicked(g, this)
                    }
                }
            }
            ;
            Figure.prototype.handleMouseDragged = function(g) {
                var c = this.eventListeners.getListeners("MouseMotionListener");
                var d;
                while (!g.isConsumed() && c.hasNext()) {
                    d = c.next();
                    if (d.mouseDragged != null ) {
                        d.mouseDragged(g, this)
                    }
                }
            }
            ;
            Figure.prototype.handleMouseEntered = function(g) {
                var c = this.eventListeners.getListeners("MouseMotionListener");
                var d;
                while (!g.isConsumed() && c.hasNext()) {
                    d = c.next();
                    if (d.mouseEntered != null ) {
                        d.mouseEntered(g, this)
                    }
                }
            }
            ;
            Figure.prototype.handleMouseExited = function(g) {
                var c = this.eventListeners.getListeners("MouseMotionListener");
                var d;
                while (!g.isConsumed() && c.hasNext()) {
                    d = c.next();
                    if (d.mouseExited != null ) {
                        d.mouseExited(g, this)
                    }
                }
            }
            ;
            Figure.prototype.handleMouseHover = function(g) {
                var c = this.eventListeners.getListeners("MouseMotionListener");
                var d;
                while (!g.isConsumed() && c.hasNext()) {
                    d = c.next();
                    if (d.mouseHover != null ) {
                        d.mouseHover(g, this)
                    }
                }
            }
            ;
            Figure.prototype.handleMouseMoved = function(g) {
                var c = this.eventListeners.getListeners("MouseMotionListener");
                var d;
                while (!g.isConsumed() && c.hasNext()) {
                    d = c.next();
                    if (d.mouseMoved != null ) {
                        d.mouseMoved(g, this)
                    }
                }
            }
            ;
            Figure.prototype.handleMousePressed = function(g) {
                var c = this.eventListeners.getListeners("MouseListener");
                var d;
                while (!g.isConsumed() && c.hasNext()) {
                    d = c.next();
                    if (d.mousePressed != null ) {
                        d.mousePressed(g, this)
                    }
                }
            }
            ;
            Figure.prototype.handleMouseReleased = function(g) {
                var c = this.eventListeners.getListeners("MouseListener");
                var d;
                while (!g.isConsumed() && c.hasNext()) {
                    d = c.next();
                    if (d.mouseReleased != null ) {
                        d.mouseReleased(g, this)
                    }
                }
            }
            ;
            Figure.prototype.hasFocus = function() {
                var c = this.internalGetEventDispatcher();
                if (c == null ) {
                    return false
                }
                return c.getFocusOwner() == this
            }
            ;
            Figure.prototype.internalGetEventDispatcher = function() {
                if (this.getParent() != null ) {
                    return this.getParent().internalGetEventDispatcher()
                }
                return null 
            }
            ;
            Figure.prototype.intersects = function(c) {
                return this.getBounds().intersects(c)
            }
            ;
            Figure.prototype.invalidate = function() {
                if (this.layoutManager) {
                    this.layoutManager.invalidate()
                }
                this.setValid(false)
            }
            ;
            Figure.prototype.invalidateTree = function() {
                this.invalidate();
                for (var c = 0; c < this.children.length; c++) {
                    this.children[c].invalidateTree()
                }
            }
            ;
            Figure.prototype.isCoordinateSystem = function() {
                return this.useLocalCoordinates()
            }
            ;
            Figure.prototype.isEnabled = function() {
                return this.getFlag(FigureConstants.FLAG_ENABLED)
            }
            ;
            Figure.prototype.isFocusTraversable = function() {
                return this.getFlag(FigureConstants.FLAG_FOCUS_TRAVERSABLE)
            }
            ;
            Figure.prototype.isMouseEventTarget = function() {
                return ( this.eventListeners.containsListener("MouseListener") || this.eventListeners.containsListener("MouseMotionListener")) 
            }
            ;
            Figure.prototype.isMirrored = function() {
                return false
            }
            ;
            Figure.prototype.isOpaque = function() {
                return this.getFlag(FigureConstants.FLAG_OPAQUE)
            }
            ;
            Figure.prototype.isRequestFocusEnabled = function() {
                return this.getFlag(FigureConstants.FLAG_FOCUSABLE)
            }
            ;
            Figure.prototype.isShowing = function() {
                return this.isVisible() && (this.getParent() == null  || this.getParent().isShowing())
            }
            ;
            Figure.prototype.isValid = function() {
                return this.getFlag(FigureConstants.FLAG_VALID)
            }
            ;
            Figure.prototype.isValidationRoot = function() {
                return false
            }
            ;
            Figure.prototype.isVisible = function() {
                return this.getFlag(FigureConstants.FLAG_VISIBLE)
            }
            ;
            Figure.prototype.layout = function() {
                if (this.layoutManager) {
                    this.layoutManager.layout(this)
                }
            }
            ;
            Figure.prototype.paint = function(c) {
                c.pushState();
                if (this.getLocalForegroundColor() != null ) {
                    c.setFillColor(this.getLocalForegroundColor());
                    c.setStrokeColor(this.getLocalForegroundColor())
                }
                if (this.font != null ) {
                    c.setFont(this.font)
                }
                c.pushState();
                this.paintFigure(c);
                c.restoreState();
                c.pushState();
                this.paintClientArea(c);
                c.restoreState();
                c.pushState();
                this.paintBorder(c);
                c.restoreState();
                c.restoreState()
            }
            ;
            Figure.prototype.paintBorder = function(c) {
                if (this.getBorder() != null ) {
                    this.getBorder().paint(this, c, Figure.NO_INSETS)
                }
            }
            ;
            Figure.prototype.paintChildren = function(c) {
                var h;
                var g = Rectangle.SINGLETON;
                for (var d = 0; d < this.children.length; d++) {
                    h = this.children[d];
                    if (h.isVisible() && h.intersects(c.getClip(g))) {
                        c.pushState();
                        c.clipRect(h.getBounds());
                        h.paint(c);
                        c.restoreState()
                    }
                }
            }
            ;
            Figure.prototype.paintClientArea = function(c) {
                if (this.children.length == 0) {
                    return
                }
                var d = this.getBorder() == null  || this.getBorder().isOpaque();
                if (this.useLocalCoordinates()) {
                    c.translate(this.getBounds().x + this.getInsets().left, this.getBounds().y + this.getInsets().top);
                    if (d) {
                        c.clipRect(this.getClientArea(Figure.PRIVATE_RECT))
                    }
                    c.pushState();
                    this.paintChildren(c);
                    c.restoreState()
                } else {
                    if (d) {
                        this.paintChildren(c)
                    } else {
                        c.clipRect(this.getClientArea(Figure.PRIVATE_RECT));
                        c.pushState();
                        this.paintChildren(c);
                        c.restoreState()
                    }
                }
            }
            ;
            Figure.prototype.paintFigure = function(c) {
                if (this.isOpaque()) {
                    if (this.getLocalBackgroundColor() != null ) {
                        c.pushState();
                        c.setFillColor(this.getLocalBackgroundColor());
                        c.fillRect(this.getBounds().x, this.getBounds().y, this.getBounds().width, this.getBounds().height);
                        c.restoreState()
                    }
                }
                if (this.getBorder() != null  && Util.isInstanceOf(this.getBorder(), AbstractBackground)) {
                    this.getBorder().paintBackground(this, c, Figure.NO_INSETS)
                }
            }
            ;
            Figure.prototype.primTranslate = function(d, c) {
                this.getBounds().x += d;
                this.getBounds().y += c;
                if (this.useLocalCoordinates()) {
                    this.fireCoordinateSystemChanged();
                    return
                }
                for (var g = 0; g < this.children.length; g++) {
                    this.children[g].translate(d, c)
                }
            }
            ;
            Figure.prototype.remove = function(c) {
                if ((c.getParent() != this) ) {
                    Debugger.log(this.id + "=>remove()--Figure is not a child")
                }
                if (this.getFlag(FigureConstants.FLAG_REALIZED)) {
                    c.removeNotify()
                }
                if (this.layoutManager != null ) {
                    this.layoutManager.remove(c)
                }
                c.erase();
                c.setParent(null );
                Util.Array.removeItem(this.children, c);
                this.revalidate()
            }
            ;
            Figure.prototype.removeAll = function() {
                while (this.children.length > 0) {
                    this.remove(this.children[0])
                }
            }
            ;
            Figure.prototype.removeAncestorListener = function(c) {
                if (this.ancestorHelper != null ) {
                    this.ancestorHelper.removeAncestorListener(c);
                    if (this.ancestorHelper.isEmpty()) {
                        this.ancestorHelper.dispose();
                        ancestorHelper = null 
                    }
                }
            }
            ;
            Figure.prototype.removeCoordinateListener = function(c) {
                this.eventListeners.removeListener("CoordinateListener", c)
            }
            ;
            Figure.prototype.removeFigureListener = function(c) {
                this.eventListeners.removeListener("FigureListener", c)
            }
            ;
            Figure.prototype.removeFocusListener = function(c) {
                this.eventListeners.removeListener("FocusListener", c)
            }
            ;
            Figure.prototype.removeKeyListener = function(c) {
                this.eventListeners.removeListener("KeyListener", c)
            }
            ;
            Figure.prototype.removeLayoutListener = function(c) {
                if (Util.isInstanceOf(this.layoutManager, LayoutNotifier)) {
                    Util.Array.removeItem(this.layoutManager.listeners, c);
                    if (this.layoutManager.listeners.length == 0) {
                        layoutManager = this.layoutManager.realLayout
                    }
                }
            }
            ;
            Figure.prototype.removeListener = function(c, d) {
                if (this.eventListeners == null ) {
                    return
                }
                this.eventListeners.removeListener(c, d)
            }
            ;
            Figure.prototype.removeMouseListener = function(c) {
                this.eventListeners.removeListener("MouseListener", c)
            }
            ;
            Figure.prototype.removeMouseMotionListener = function(c) {
                this.eventListeners.removeListener("MouseMotionListener", c)
            }
            ;
            Figure.prototype.removeNotify = function() {
                for (var c = 0; c < this.children.length; c++) {
                    this.children[c].removeNotify()
                }
                if (this.internalGetEventDispatcher() != null ) {
                    this.internalGetEventDispatcher().requestRemoveFocus(this)
                }
                this.setFlag(FigureConstants.FLAG_REALIZED, false)
            }
            ;
            Figure.prototype.removePropertyChangeListener = function(g, d) {
                if (this.propertyListeners == null ) {
                    return
                }
                if (g != null  && d != null ) {
                    this.propertyListeners.removePropertyChangeListener(g, d)
                } else {
                    var c = (g != null  ? g : d);
                    this.propertyListeners.removePropertyChangeListener(c)
                }
            }
            ;
            Figure.prototype.repaint = function(l, h, g, d) {
                var o;
                var n;
                var c;
                var p;
                if (l == null ) {
                    o = this.getBounds().x;
                    n = this.getBounds().y;
                    c = this.getBounds().width;
                    p = this.getBounds().height
                } else {
                    if (l != null  && Util.isInstanceOf(l, Rectangle)) {
                        var m = arguments[0];
                        o = m.x;
                        n = m.y;
                        c = m.width;
                        p = m.height
                    } else {
                        if (l != null  && h != null  && g != null  && d != null ) {
                            o = arguments[0];
                            n = arguments[1];
                            c = arguments[2];
                            p = arguments[3]
                        }
                    }
                }
                if (this.isVisible() && c > 0 && p > 0) {
                    this.getUpdateManager().addDirtyRegion(this, o - 1, n - 1, c + 2, p + 2)
                }
            }
            ;
            Figure.prototype.requestFocus = function() {
                if (!this.isRequestFocusEnabled() || this.hasFocus()) {
                    return
                }
                var c = this.internalGetEventDispatcher();
                if (c == null ) {
                    return
                }
                c.requestFocus(this)
            }
            ;
            Figure.prototype.revalidate = function() {
                this.invalidate();
                if ((!this.parent) || this.isValidationRoot()) {
                    this.getUpdateManager().addInvalidFigure(this)
                } else {
                    this.getParent().revalidate()
                }
            }
            ;
            Figure.prototype.setBackgroundColor = function(c) {
                this.bgColor = c;
                this.repaint()
            }
            ;
            Figure.prototype.setBorder = function(c) {
                this.border = c;
                this.revalidate();
                this.repaint()
            }
            ;
            Figure.prototype.setBounds = function(l) {
                var c = this.getBounds().x;
                var n = this.getBounds().y;
                var h = (l.width != this.getBounds().width) || (l.height != this.getBounds().height);
                var m = (l.x != c) || (l.y != n);
                if ((h || m) && this.isVisible()) {
                    this.erase()
                }
                if (m) {
                    var g = l.x - c;
                    var d = l.y - n;
                    this.primTranslate(g, d)
                }
                this.getBounds().width = l.width;
                this.getBounds().height = l.height;
                if (m || h) {
                    if (h) {
                        this.invalidate()
                    }
                    this.fireFigureMoved();
                    this.repaint()
                }
            }
            ;
            Figure.prototype.setChildrenDirection = function(d) {
                var c = new FigureIterator(this);
                var g;
                while (c.hasNext()) {
                    g = c.nextFigure();
                    if (g.setDirection != null ) {
                        g.setDirection(d)
                    }
                }
            }
            ;
            Figure.prototype.setChildrenEnabled = function(d) {
                var c = new FigureIterator(this);
                while (c.hasNext()) {
                    c.nextFigure().setEnabled(d)
                }
            }
            ;
            Figure.prototype.setChildrenOrientation = function(c) {
                var d = new FigureIterator(this);
                var g;
                while (d.hasNext()) {
                    g = d.nextFigure();
                    if (g.setOrientation != null ) {
                        g.setOrientation(c)
                    }
                }
            }
            ;
            Figure.prototype.setConstraint = function(d, c) {
                if (d.getParent() != this) {
                    Debugger.log(this.id + "=>Figure--setConstraint()--Figure must be a child")
                }
                if (this.layoutManager != null ) {
                    this.layoutManager.setConstraint(d, c)
                }
                this.revalidate()
            }
            ;
            Figure.prototype.setCursor = function(d) {
                if (this.cursor == d) {
                    return
                }
                this.cursor = d;
                var c = this.internalGetEventDispatcher();
                if (c != null ) {
                    c.updateCursor()
                }
            }
            ;
            Figure.prototype.setEnabled = function(c) {
                if (this.isEnabled() == c) {
                    return
                }
                this.setFlag(FigureConstants.FLAG_ENABLED, c)
            }
            ;
            Figure.prototype.setFlag = function(c, d) {
                if (d) {
                    this.flags |= c
                } else {
                    this.flags &= ~c
                }
            }
            ;
            Figure.prototype.setFocusTraversable = function(c) {
                if (this.isFocusTraversable() == c) {
                    return
                }
                this.setFlag(FigureConstants.FLAG_FOCUS_TRAVERSABLE, c)
            }
            ;
            Figure.prototype.setFont = function(c) {
                if (this.font != c) {
                    this.font = c;
                    this.revalidate();
                    this.repaint()
                }
            }
            ;
            Figure.prototype.setForegroundColor = function(c) {
                if (this.fgColor != null  && this.fgColor.equals(c)) {
                    return
                }
                this.fgColor = c;
                this.repaint()
            }
            ;
            Figure.prototype.setLayoutManager = function(c) {
                if (this.layoutManager != null  && Util.isInstanceOf(this.layoutManager, LayoutNotifier)) {
                    c.realLayout = manager
                } else {
                    this.layoutManager = c
                }
                this.revalidate()
            }
            ;
            Figure.prototype.setLocation = function(d) {
                if (this.getLocation().equals(d)) {
                    return
                }
                var c = new Rectangle(this.getBounds());
                c.setLocation(d);
                this.setBounds(c)
            }
            ;
            Figure.prototype.setMaximumSize = function(c) {
                if (this.maxSize != null  && this.maxSize.equals(c)) {
                    return
                }
                this.maxSize = c;
                this.revalidate()
            }
            ;
            Figure.prototype.setMinimumSize = function(c) {
                if (this.minSize != null  && this.minSize.equals(c)) {
                    return
                }
                this.minSize = c;
                this.revalidate()
            }
            ;
            Figure.prototype.setOpaque = function(c) {
                this.setFlag(FigureConstants.FLAG_OPAQUE, c)
            }
            ;
            Figure.prototype.setParent = function(d) {
                var c = this.parent;
                this.parent = d;
                this.firePropertyChange("parent", c, d)
            }
            ;
            Figure.prototype.setPreferredSize = function(d, c) {
                if (d == null ) {
                    return
                }
                var g;
                if (Util.isInstanceOf(d, Dimension)) {
                    g = d
                } else {
                    g = new Dimension(d,c)
                }
                if (this.prefSize != null  && this.prefSize.equals(g)) {
                    return
                }
                this.prefSize = g;
                this.revalidate()
            }
            ;
            Figure.prototype.setRequestFocusEnabled = function(c) {
                if (this.isRequestFocusEnabled() == c) {
                    return
                }
                this.setFlag(FigureConstants.FLAG_FOCUSABLE, c)
            }
            ;
            Figure.prototype.setSize = function(g, d) {
                if (g == null ) {
                    return
                }
                var c;
                var l;
                if (Util.isInstanceOf(g, Dimension)) {
                    c = g.width;
                    l = g.height
                } else {
                    c = g;
                    l = d
                }
                var n = this.getBounds();
                if (n.width == c && n.height == l) {
                    return
                }
                var m = new Rectangle(this.getBounds());
                m.setSize(c, l);
                this.setBounds(m)
            }
            ;
            Figure.prototype.setToolTip = function(c) {
                if (this.toolTip == c) {
                    return
                }
                this.toolTip = c
            }
            ;
            Figure.prototype.setValid = function(c) {
                this.setFlag(FigureConstants.FLAG_VALID, c)
            }
            ;
            Figure.prototype.setVisible = function(d) {
                var c = this.isVisible();
                if (d == c) {
                    return
                }
                if (c) {
                    this.erase()
                }
                this.setFlag(FigureConstants.FLAG_VISIBLE, d);
                if (d) {
                    this.repaint()
                }
                this.revalidate()
            }
            ;
            Figure.prototype.translate = function(c, d) {
                this.primTranslate(c, d);
                this.fireFigureMoved()
            }
            ;
            Figure.prototype.translateFromParent = function(c) {
                if (this.useLocalCoordinates()) {
                    c.performTranslate(-this.getBounds().x - this.getInsets().left, -this.getBounds().y - this.getInsets().top)
                }
            }
            ;
            Figure.prototype.translateToAbsolute = function(c) {
                if (this.getParent() != null ) {
                    this.getParent().translateToParent(c);
                    this.getParent().translateToAbsolute(c)
                }
            }
            ;
            Figure.prototype.translateToParent = function(c) {
                if (this.useLocalCoordinates()) {
                    c.performTranslate(this.getBounds().x + this.getInsets().left, this.getBounds().y + this.getInsets().top)
                }
            }
            ;
            Figure.prototype.translateToRelative = function(c) {
                if (this.getParent() != null ) {
                    this.getParent().translateToRelative(c);
                    this.getParent().translateFromParent(c)
                }
            }
            ;
            Figure.prototype.useLocalCoordinates = function() {
                return false
            }
            ;
            Figure.prototype.validate = function() {
                if (this.isValid()) {
                    return
                }
                this.setValid(true);
                this.layout();
                var c;
                for (c = 0; c < this.children.length; c++) {
                    this.children[c].validate()
                }
            }
            ;
            Figure.prototype.init = function(c) {
                this.flags = FigureConstants.FLAG_VISIBLE | FigureConstants.FLAG_ENABLED;
                this.children = [];
                this.bounds = new Rectangle(0,0,0,0);
                this.eventListeners = new EventListenerList();
                this.id = c;
                this.propertyListeners = null ;
                this.prefSize = null ;
                this.minSize = null ;
                this.maxSize = null ;
                this.font = null ;
                this.bgColor = null ;
                this.fgColor = null ;
                this.border = null ;
                this.toolTip = null ;
                this.ancestorHelper = null 
            }
        }
        Figure._initialized = true;
        _classes.defineClass("Figure", a)
    }
    this.init(b)
}
Figure.NO_INSETS = new NoInsets();
Figure.PRIVATE_RECT = new Rectangle(0,0,0,0);
Figure.PRIVATE_POINT = new Point(0,0);
Figure.EMPTY_LIST = null ;
Figure.MAX_DIMENSION = new Dimension(Number.MAX_VALUE,Number.MAX_VALUE);
Figure.MIN_DIMENSION = new Dimension(5,5);
Figure.FLAG_VALID = 1,
Figure.FLAG_OPAQUE = 1 << 1;
Figure.FLAG_VISIBLE = 1 << 2;
Figure.FLAG_FOCUSABLE = 1 << 3;
Figure.FLAG_ENABLED = 1 << 4;
Figure.FLAG_FOCUS_TRAVERSABLE = 1 << 5;
Figure.FLAG_REALIZED = 1 << 31;
Figure.MAX_FLAG = Figure.FLAG_FOCUS_TRAVERSABLE;
_classes.registerClass("Label", "Figure");
function Label(d, b, a) {
    if (typeof Label._initialized == "undefined") {
        function c() {
            Label.prototype.alignOnHeight = function(l, h, m) {
                var g = this.getInsets();
                switch (m) {
                case PositionConstants.TOP:
                    l.y = g.top;
                    break;
                case PositionConstants.BOTTOM:
                    l.y = this.getBounds().height - h.height - g.bottom;
                    break;
                default:
                    l.y = (this.getBounds().height - h.height) / 2
                }
            }
            ;
            Label.prototype.alignOnWidth = function(l, h, m) {
                var g = this.getInsets();
                switch (m) {
                case PositionConstants.LEFT:
                    l.x = g.left;
                    break;
                case PositionConstants.RIGHT:
                    l.x = this.getBounds().width - h.width - g.right;
                    break;
                default:
                    l.x = (this.getBounds().width - h.width) / 2
                }
            }
            ;
            Label.prototype.calculateAlignment = function() {
                switch (this.textPlacement) {
                case PositionConstants.EAST:
                case PositionConstants.WEST:
                    this.alignOnHeight(this.textLocation, this.getTextSize(), this.textAlignment);
                    this.alignOnHeight(this.iconLocation, this.getIconSize(), this.iconAlignment);
                    break;
                case PositionConstants.NORTH:
                case PositionConstants.SOUTH:
                    this.alignOnWidth(this.textLocation, this.getSubStringTextSize(), this.textAlignment);
                    this.alignOnWidth(this.iconLocation, this.getIconSize(), this.iconAlignment);
                    break
                }
            }
            ;
            Label.prototype.clearLocation = function() {
                this.iconLocation = null ;
                this.textLocation = null 
            }
            ;
            Label.prototype.calculateLabelSize = function(g) {
                var l = this.getIconTextGap();
                if (this.icon == null  || this.text == "") {
                    l = 0
                }
                var h = new Dimension(0,0);
                if (this.textPlacement == PositionConstants.WEST || this.textPlacement == PositionConstants.EAST) {
                    h.width = this.getIconSize().width + l + g.width;
                    h.height = Math.max(this.getIconSize().height, g.height)
                } else {
                    h.width = Math.max(this.getIconSize().width, g.width);
                    h.height = this.getIconSize().height + l + g.height
                }
                return h
            }
            ;
            Label.prototype.calculateLocations = function() {
                this.textLocation = new Point();
                this.iconLocation = new Point();
                this.calculatePlacement();
                this.calculateAlignment();
                var g = this.getSize().getDifference(this.getPreferredSize());
                g.width += this.getTextSize().width - this.getSubStringTextSize().width;
                switch (this.labelAlignment) {
                case PositionConstants.CENTER:
                    g.scale(0.5);
                    break;
                case PositionConstants.LEFT:
                    g.scale(0);
                    break;
                case PositionConstants.RIGHT:
                    g.scale(1);
                    break;
                case PositionConstants.TOP:
                    g.height = 0;
                    g.scale(0.5);
                    break;
                case PositionConstants.BOTTOM:
                    g.height = g.height * 2;
                    g.scale(0.5);
                    break;
                default:
                    g.scale(0.5);
                    break
                }
                switch (this.textPlacement) {
                case PositionConstants.EAST:
                case PositionConstants.WEST:
                    g.height = 0;
                    break;
                case PositionConstants.NORTH:
                case PositionConstants.SOUTH:
                    g.width = 0;
                    break
                }
                this.textLocation.translate(g);
                this.iconLocation.translate(g)
            }
            ;
            Label.prototype.calculatePlacement = function() {
                var h = this.getIconTextGap();
                if (this.icon == null  || this.text == "") {
                    h = 0
                }
                var g = this.getInsets();
                switch (this.textPlacement) {
                case PositionConstants.EAST:
                    this.iconLocation.x = g.left;
                    this.textLocation.x = this.getIconSize().width + h + g.left;
                    break;
                case PositionConstants.WEST:
                    this.textLocation.x = g.left;
                    this.iconLocation.x = this.getSubStringTextSize().width + h + g.left;
                    break;
                case PositionConstants.NORTH:
                    this.textLocation.y = g.top;
                    this.iconLocation.y = this.getTextSize().height + h + g.top;
                    break;
                case PositionConstants.SOUTH:
                    this.textLocation.y = this.getIconSize().height + h + g.top;
                    this.iconLocation.y = g.top;
                    break
                }
            }
            ;
            Label.prototype.calculateSubStringTextSize = function() {
                var g = this.getSubStringText();
                if (g == null  || g === "") {
                    return new Dimension(0,0)
                }
                return this.getTextUtilities().getTextExtents(g, this.getFont())
            }
            ;
            Label.prototype.calculateTextSize = function() {
                var g = this.getText();
                if (g == null  || g === "") {
                    return new Dimension(0,0)
                }
                return this.getTextUtilities().getTextExtents(this.getText(), this.getFont())
            }
            ;
            Label.prototype.clearLocations = function() {
                this.iconLocation = null ;
                this.textLocation = null 
            }
            ;
            Label.prototype.getIcon = function() {
                return this.icon
            }
            ;
            Label.prototype.getIconBounds = function() {
                return new Rectangle(this.getBounds().getLocation().translate(this.getIconLocation()),this.getIconSize())
            }
            ;
            Label.prototype.getIconLocation = function() {
                if (this.iconLocation == null ) {
                    this.calculateLocations()
                }
                return this.iconLocation
            }
            ;
            Label.prototype.getIconSize = function() {
                if (this.iconSize == null ) {
                    if (this.icon != null ) {
                        this.iconSize = new Dimension(this.icon.width,this.icon.height)
                    } else {
                        return new Dimension(0,0)
                    }
                }
                return this.iconSize
            }
            ;
            Label.prototype.getIconTextGap = function() {
                return this.iconTextGap
            }
            ;
            Label.prototype.getMinimumSize = function(m, n) {
                if (this.minSize) {
                    return this.minSize
                }
                this.minSize = new Dimension();
                if (this.layoutManager) {
                    this.minSize.setSize(this.layoutManager.getMinimumSize(this, m, n))
                }
                var l = this.calculateLabelSize(this.getTextUtilities().getTextExtents(this.getTruncationString(), this.getFont()).intersect(this.getTextUtilities().getTextExtents(this.getText(), this.getFont())));
                var g = this.getInsets();
                l.expand(g.getWidth(), g.getHeight());
                this.minSize.union(l);
                return this.minSize
            }
            ;
            Label.prototype.getPreferredSize = function(m, l) {
                if (this.prefSize == null ) {
                    this.prefSize = this.calculateLabelSize(this.getTextSize());
                    var h = this.getInsets();
                    if (!h.isEmpty()) {
                        this.prefSize.expand(h.getWidth(), h.getHeight())
                    }
                    if (this.layoutManager) {
                        this.prefSize.union(this.layoutManager.getPreferredSize(this, m, l))
                    }
                }
                if (m >= 0 && m < this.prefSize.width) {
                    var n = this.getMinimumSize(m, l);
                    var g = this.prefSize.getCopy();
                    g.width = Math.min(g.width, m);
                    g.width = Math.max(n.width, g.width);
                    return g
                }
                return this.prefSize
            }
            ;
            Label.prototype.getSubStringText = function() {
                if (this.subStringText != null ) {
                    return this.subStringText
                }
                this.subStringText = this.text;
                var l = this.getPreferredSize().width - this.getSize().width;
                if (l <= 0) {
                    return this.subStringText
                }
                var n = this.getTextSize().getExpanded(-l, 0);
                var g = this.getFont();
                var m = this.getTextUtilities().getTextExtents(this.getTruncationString(), g).width;
                if (n.width < m) {
                    n.width = m
                }
                var h = this.getTextUtilities().getLargestSubstringConfinedTo(this.text, g, n.width - m);
                this.subStringText = new String(this.text.substring(0, h) + this.getTruncationString());
                return this.subStringText
            }
            ;
            Label.prototype.getSubStringTextSize = function() {
                if (this.subStringTextSize == null ) {
                    this.subStringTextSize = this.calculateSubStringTextSize()
                }
                return this.subStringTextSize
            }
            ;
            Label.prototype.getText = function() {
                return this.text
            }
            ;
            Label.prototype.getTextBounds = function() {
                return new Rectangle(this.getBounds().getLocation().translate(this.getTextLocation()),this.textSize)
            }
            ;
            Label.prototype.getTextLocation = function() {
                if (this.textLocation != null ) {
                    return this.textLocation
                }
                this.calculateLocations();
                return this.textLocation
            }
            ;
            Label.prototype.getTextSize = function() {
                if (this.textSize != null ) {
                    return this.textSize
                }
                this.textSize = this.calculateTextSize();
                return this.textSize
            }
            ;
            Label.prototype.getTextUtilities = function() {
                return TextUtilities.INSTANCE
            }
            ;
            Label.prototype.getTruncationString = function() {
                return Label.ELLIPSIS
            }
            ;
            Label.prototype.invalidate = function() {
                this.prefSize = null ;
                this.minSize = null ;
                this.clearLocations();
                this.textSize = null ;
                this.subStringTextSize = null ;
                this.subStringText = null ;
                this.isa = "Label";
                this.parentMethod("invalidate")
            }
            ;
            Label.prototype.isTextTruncated = function() {
                return !this.getSubStringText().equals(this.getText())
            }
            ;
            Label.prototype.paintFigure = function(g) {
                if (this.isOpaque()) {
                    this.isa = "Label";
                    this.parentMethod("paintFigure", g)
                }
                var h = this.getBounds();
                g.translate(h.x, h.y);
                if (this.icon) {
                    g.drawImage(this.icon, this.getIconLocation().x, this.getIconLocation().y)
                }
                if (!this.isEnabled()) {
                    g.translate(1, 1);
                    g.fillText(this.getSubStringText(), this.getTextLocation().x, this.getTextLocation().y);
                    g.translate(-1, -1)
                }
                g.fillText(this.getSubStringText(), this.getTextLocation().x, this.getTextLocation().y);
                g.translate(-h.x, -h.y)
            }
            ;
            Label.prototype.pictureLoaded = function() {
                this.iconSize = null ;
                this.revalidate();
                this.repaint()
            }
            ;
            Label.prototype.setIcon = function(g) {
                if (g == this.icon) {
                    return
                }
                if (this.icon && this.icon.removeLoadListener) {
                    this.icon.removeLoadListener(this)
                }
                this.icon = g;
                g.addLoadListener(this);
                this.repaint();
                if (this.icon == null ) {
                    this.setIconDimension(new Dimension())
                } else {
                    this.setIconDimension(new Dimension(g.width,g.height))
                }
            }
            ;
            Label.prototype.dispose = function() {
                this.isa = "Label";
                this.parentMethod("dispose");
                if (this.icon && this.icon.removeLoadListener) {
                    this.icon.removeLoadListener(this)
                }
                this.icon = null 
            }
            ,
            Label.prototype.setIconAlignment = function(g) {
                if (this.iconAlignment == g) {
                    return
                }
                this.iconAlignment = g;
                this.clearLocations();
                this.repaint()
            }
            ;
            Label.prototype.setIconDimension = function(g) {
                if (g.equals(this.iconSize)) {
                    return
                }
                this.iconSize = g;
                this.revalidate()
            }
            ;
            Label.prototype.setIconTextGap = function(g) {
                if (this.iconTextGap == g) {
                    return
                }
                this.iconTextGap = g;
                this.repaint();
                this.revalidate()
            }
            ;
            Label.prototype.setLabelAlignment = function(g) {
                if (this.labelAlignment == g) {
                    return
                }
                this.labelAlignment = g;
                this.clearLocation();
                this.repaint()
            }
            ;
            Label.prototype.setText = function(g) {
                if (g == null ) {
                    g = ""
                }
                if (g == this.text) {
                    return
                }
                this.text = g;
                this.revalidate();
                this.repaint()
            }
            ;
            Label.prototype.setTextAlignment = function(g) {
                if (this.textAlignment == g) {
                    return
                }
                this.textAlignment = g;
                this.clearLocation();
                this.repaint()
            }
            ;
            Label.prototype.setTextPlacement = function(g) {
                if (this.textPlacement == g) {
                    return
                }
                this.textPlacement = g;
                this.revalidate();
                this.repaint()
            }
            ;
            Label.prototype.init = function(l, h, g) {
                this.parentMethod("init", l);
                this.iconSize = new Dimension(0,0);
                this.textAlignment = PositionConstants.CENTER;
                this.iconAlignment = PositionConstants.CENTER;
                this.labelAlignment = PositionConstants.CENTER;
                this.textPlacement = PositionConstants.EAST;
                this.iconTextGap = 3;
                if (typeof h == "string" || h instanceof String) {
                    this.setText(h)
                } else {
                    if (h instanceof Image) {
                        this.setIcon(h)
                    }
                }
                if (typeof g == "string" || g instanceof String) {
                    this.setText(g)
                } else {
                    if (g instanceof Image) {
                        this.setIcon(g)
                    }
                }
            }
        }
        Label._initialized = true;
        _classes.defineClass("Label", c)
    }
    this.init(d, b, a)
}
Label.ELLIPSIS = "...";
_classes.registerClass("Panel", "Figure");
function Panel(b) {
    if (typeof Panel._initialized == "undefined") {
        function a() {
            Panel.prototype.isOpaque = function() {
                return true
            }
            ;
            Panel.prototype.init = function(c) {
                this.parentMethod("init", c)
            }
        }
        Panel._initialized = true;
        _classes.defineClass("Panel", a)
    }
    this.init(b)
}
_classes.registerClass("Shape", "Figure");
function Shape(b) {
    if (typeof Shape._initialized == "undefined") {
        function a() {
            Shape.prototype.getLineWidth = function() {
                return this.lineWidth
            }
            ;
            Shape.prototype.outlineShape = function(c) {
                Debugger.error("please implement the function outlineShape()")
            }
            ;
            Shape.prototype.paintFill = function(c) {
                c.setFillColor(this.fillColor);
                c.fill()
            }
            ;
            Shape.prototype.paintFigure = function(c) {
                c.beginPath();
                if (!this.isEnabled()) {
                    c.translate(1, 1);
                    this.outlineShape(c);
                    if (this.fill) {
                        this.paintFill(c)
                    }
                    if (this.outline) {
                        this.paintOutline(c)
                    }
                    c.translate(-1, -1)
                }
                this.outlineShape(c);
                if (this.fill) {
                    this.paintFill(c)
                }
                if (this.outline) {
                    this.paintOutline(c)
                }
            }
            ;
            Shape.prototype.paintOutline = function(c) {
                c.setLineAttributes(this.lineAttributes);
                c.stroke()
            }
            ;
            Shape.prototype.setLineAttributes = function(c) {
                if (!this.lineAttributes.equals(c)) {
                    this.lineAttributes = c;
                    this.repaint()
                }
            }
            ;
            Shape.prototype.setFillColor = function(c) {
                if (c != null  && !(c.equals(this.fillColor))) {
                    this.fillColor = c;
                    this.repaint()
                }
            }
            ;
            Shape.prototype.setOutlineColor = function(c) {
                if (this.lineAttributes != null ) {
                    if (this.lineAttributes.lineColor != null  && !(this.lineAttributes.lineColor.equals(c))) {
                        this.lineAttributes.lineColor = c
                    }
                    this.repaint()
                }
            }
            ;
            Shape.prototype.setFill = function(c) {
                if (this.fill != c) {
                    this.fill = c;
                    this.repaint()
                }
            }
            ;
            Shape.prototype.setOutline = function(c) {
                if (this.outline != c) {
                    this.outline = c;
                    this.repaint()
                }
            }
            ;
            Shape.prototype.setLineWidth = function(c) {
                if (this.lineAttributes.lineWidth != c) {
                    this.lastLineWidth = c;
                    this.lineWidth = c;
                    this.lineAttributes.lineWidth = c;
                    this.repaint()
                }
            }
            ;
            Shape.prototype.init = function(c) {
                this.parentMethod("init", c);
                this.lineAttributes = new LineAttributes();
                this.fillColor = new Color();
                this.fill = true;
                this.outline = true;
                this.lineWidth = this.lineAttributes.lineWidth;
                this.lastLineWidth = this.lineWidth
            }
        }
        Shape._initialized = true;
        _classes.defineClass("Shape", a)
    }
    this.init(b)
}
_classes.registerClass("Ellipse", "Shape");
function Ellipse(b) {
    if (typeof Ellipse._initialized == "undefined") {
        function a() {
            Ellipse.prototype.containsPoint = function(c, l) {
                this.isa = "Ellipse";
                if (!this.parentMethod("containsPoint", c, l)) {
                    return false
                } else {
                    var h = this.getBounds();
                    var g = c - h.x - h.width / 2;
                    var d = l - h.y - h.height / 2;
                    return ((g * g) << 10) / (h.width * h.width) + ((d * d) << 10) / (h.height * h.height) <= 256
                }
            }
            ;
            Ellipse.prototype.outlineShape = function(c) {
                c.beginPath();
                var d = this.getBounds();
                c.ellipse(d.x + d.width / 2, (d.y + d.height / 2), d.width / 2 - 1, d.height / 2 - 1, 0, 360, true)
            }
            ;
            Ellipse.prototype.init = function(c) {
                this.parentMethod("init", c)
            }
        }
        Ellipse._initialized = true;
        _classes.defineClass("Ellipse", a)
    }
    this.init(b)
}
_classes.registerClass("AbstractPointListShape", "Shape");
function AbstractPointListShape(b) {
    if (typeof AbstractPointListShape._initialized == "undefined") {
        function a() {
            AbstractPointListShape.prototype.containsPoint = function(c, d) {
                this.isa = "AbstractPointListShape";
                if (!this.parentMethod("containsPoint", c, d)) {
                    return false
                }
                return this.shapeContainsPoint(c, d) || this.childrenContainsPoint(c, d)
            }
            ;
            AbstractPointListShape.prototype.childrenContainsPoint = function(c, g) {
                for (var d = 0; d < this.children.length; d++) {
                    if (this.children[d].containsPoint(c, g)) {
                        return true
                    }
                }
                return false
            }
            ;
            AbstractPointListShape.prototype.shapeContainsPoint = function() {}
            ;
            AbstractPointListShape.prototype.addPoint = function(c) {
                this.erase();
                this.points.addPoint(c);
                this.repaint()
            }
            ;
            AbstractPointListShape.prototype.getStart = function() {
                return this.points.getFirstPoint()
            }
            ;
            AbstractPointListShape.prototype.getEnd = function() {
                return this.points.getLastPoint()
            }
            ;
            AbstractPointListShape.prototype.getPoints = function() {
                return this.points
            }
            ;
            AbstractPointListShape.prototype.insertPoint = function(d, c) {
                this.erase();
                this.points.insertPoint(d, c);
                this.repaint()
            }
            ;
            AbstractPointListShape.prototype.removeAllPoints = function() {
                this.erase();
                this.points.removeAllPoints()
            }
            ;
            AbstractPointListShape.prototype.removePoint = function(c) {
                this.erase();
                this.points.removePoint(c);
                this.repaint()
            }
            ;
            AbstractPointListShape.prototype.setStart = function(c) {
                if (this.points.size == 0) {
                    this.addPoint(c)
                } else {
                    this.setPoint(c, 0)
                }
            }
            ;
            AbstractPointListShape.prototype.setEnd = function(c) {
                if (this.points.size < 2) {
                    this.addPoint(c)
                } else {
                    this.setPoint(c, this.points.size - 1)
                }
            }
            ;
            AbstractPointListShape.prototype.setEndpoints = function(d, c) {
                this.setStart(d);
                this.setEnd(c)
            }
            ;
            AbstractPointListShape.prototype.setPoint = function(d, c) {
                this.erase();
                this.points.setPoint(d, c);
                this.repaint()
            }
            ;
            AbstractPointListShape.prototype.setPoints = function(c) {
                this.erase();
                this.points = c;
                this.repaint()
            }
            ;
            AbstractPointListShape.prototype.init = function(c) {
                this.parentMethod("init", c);
                this.points = new PointList()
            }
        }
        AbstractPointListShape._initialized = true;
        _classes.defineClass("AbstractPointListShape", a)
    }
    this.init(b)
}
_classes.registerClass("RectangleFigure", "Shape");
function RectangleFigure(b) {
    if (typeof RectangleFigure._initialized == "undefined") {
        function a() {
            RectangleFigure.prototype.outlineShape = function(l) {
                var n = Math.max(1, this.getLineWidth()) / 2;
                var h = Math.floor(n);
                var g = Math.ceil(n);
                var d = this.getBounds().x + h;
                var o = this.getBounds().y + g;
                var m = this.getBounds().width - (h + g);
                var c = this.getBounds().height - (h + g);
                l.rect(d, o, m, c)
            }
            ;
            RectangleFigure.prototype.init = function(c) {
                this.parentMethod("init", c)
            }
        }
        RectangleFigure._initialized = true;
        _classes.defineClass("RectangleFigure", a)
    }
    this.init(b)
}
_classes.registerClass("RoundedRectangle", "Shape");
function RoundedRectangle(b) {
    if (typeof RoundedRectangle._initialized == "undefined") {
        function a() {
            RoundedRectangle.prototype.outlineShape = function(l) {
                var n = Math.max(1, this.getLineWidth()) / 2;
                var h = Math.floor(n);
                var g = Math.ceil(n);
                var d = this.getBounds().x + h;
                var o = this.getBounds().y + g;
                var m = this.getBounds().width - (h + g);
                var c = this.getBounds().height - (h + g);
                l.roundRect(d, o, m, c, this.corner.width, this.corner.height)
            }
            ;
            RoundedRectangle.prototype.setCornerDimensions = function(c) {
                this.corner.width = c.width;
                this.corner.height = c.height
            }
            ;
            RoundedRectangle.prototype.init = function(c) {
                this.parentMethod("init", c);
                this.corner = new Dimension(18,18)
            }
        }
        RoundedRectangle._initialized = true;
        _classes.defineClass("RoundedRectangle", a)
    }
    this.init(b)
}
_classes.registerClass("Triangle", "Shape");
function Triangle(b) {
    if (typeof Triangle._initialized == "undefined") {
        function a() {
            Triangle.prototype.outlineShape = function(c) {
                c.polygon(this.triangle)
            }
            ;
            Triangle.prototype.primTranslate = function(d, c) {
                this.isa = "Triangle";
                this.parentMethod("primTranslate", d, c);
                this.triangle.translate(d, c)
            }
            ;
            Triangle.prototype.setDirection = function(c) {
                if (c == null ) {
                    return
                }
                if ((c & (PositionConstants.NORTH | PositionConstants.SOUTH)) != 0) {
                    this.orientation = PositionConstants.VERTICAL
                } else {
                    this.orientation = PositionConstants.HORIZONTAL
                }
                this.direction = c;
                this.revalidate();
                this.repaint()
            }
            ;
            Triangle.prototype.setOrientation = function(c) {
                if (this.orientation == PositionConstants.VERTICAL && c == PositionConstants.HORIZONTAL) {
                    if (this.direction == PositionConstants.NORTH) {
                        this.setDirection(PositionConstants.WEST)
                    } else {
                        this.setDirection(PositionConstants.EAST)
                    }
                    if (this.orientation == PositionConstants.HORIZONTAL && c == PositionConstants.VERTICAL) {
                        if (this.direction == PositionConstants.WEST) {
                            this.setDirection(PositionConstants.NORTH)
                        } else {
                            this.setDirection(PositionConstants.SOUTH)
                        }
                    }
                }
            }
            ;
            Triangle.prototype.validate = function() {
                this.isa = "Triangle";
                this.parentMethod("validate");
                var g = new Rectangle(0,0,0,0);
                g.setBounds(this.getBounds());
                g.crop(this.getInsets());
                g.resize(-1, -1);
                var d = 0;
                switch (this.direction & (PositionConstants.NORTH | PositionConstants.SOUTH)) {
                case 0:
                    d = Math.min(g.height / 2, g.width);
                    g.x += (g.width - d) / 2;
                    break;
                default:
                    d = Math.min(g.height, g.width / 2);
                    g.y += (g.height - d) / 2;
                    break
                }
                d = Math.max(d, 1);
                var c, l, h;
                switch (this.direction) {
                case PositionConstants.NORTH:
                    c = new Point(g.x + g.width / 2,g.y);
                    l = new Point(c.x - d,c.y + d);
                    h = new Point(c.x + d,c.y + d);
                    break;
                case PositionConstants.SOUTH:
                    c = new Point(g.x + g.width / 2,g.y + d);
                    l = new Point(c.x - d,c.y - d);
                    h = new Point(c.x + d,c.y - d);
                    break;
                case PositionConstants.WEST:
                    c = new Point(g.x,g.y + g.height / 2);
                    l = new Point(c.x + d,c.y - d);
                    h = new Point(c.x + d,c.y + d);
                    break;
                default:
                    c = new Point(g.x + d,g.y + g.height / 2);
                    l = new Point(c.x - d,c.y - d);
                    h = new Point(c.x - d,c.y + d)
                }
                this.triangle.removeAllPoints();
                this.triangle.addPoint(c);
                this.triangle.addPoint(l);
                this.triangle.addPoint(h)
            }
            ;
            Triangle.prototype.init = function(c) {
                this.parentMethod("init", c);
                this.direction = PositionConstants.NORTH;
                this.orientation = PositionConstants.VERTICAL;
                this.triangle = new PointList()
            }
        }
        Triangle._initialized = true;
        _classes.defineClass("Triangle", a)
    }
    this.init(b)
}
_classes.registerClass("PolygonShape", "AbstractPointListShape");
function PolygonShape(b) {
    if (typeof PolygonShape._initialized == "undefined") {
        function a() {
            PolygonShape.prototype.shapeContainsPoint = function(c, g) {
                var d = this.getLocation();
                return Geometry.polygonContainsPoint(this.points, c - d.x, g - d.y)
            }
            ;
            PolygonShape.prototype.outlineShape = function(d) {
                var c = this.getLocation();
                d.pushState();
                d.translate(c.x, c.y);
                d.polygon(this.points);
                d.restoreState()
            }
            ;
            PolygonShape.prototype.init = function(c) {
                this.parentMethod("init", c)
            }
        }
        PolygonShape._initialized = true;
        _classes.defineClass("PolygonShape", a)
    }
    this.init(b)
}
_classes.registerClass("Polyline", "AbstractPointListShape");
function Polyline(b) {
    if (typeof Polyline._initialized == "undefined") {
        function a() {
            Polyline.prototype.containsPoint = function(c, g) {
                var d = Math.max(this.getLineWidth() / 2, this.tolerance);
                Polyline.LINEBOUNDS.setBounds(this.getBounds());
                Polyline.LINEBOUNDS.expand(d, d);
                if (!Polyline.LINEBOUNDS.contains(c, g)) {
                    return false
                }
                return this.shapeContainsPoint(c, g) || this.childrenContainsPoint(c, g)
            }
            ;
            Polyline.prototype.shapeContainsPoint = function(c, d) {
                return Geometry.polylineContainsPoint(this.points, c, d, this.tolerance)
            }
            ;
            Polyline.prototype.getBounds = function() {
                if (this.bounds == null ) {
                    var c = this.getLineWidth() / 2;
                    this.bounds = this.getPoints().getBounds();
                    if (this.bounds != null ) {
                        this.bounds = this.bounds.getExpanded(c, c);
                        this.bounds.x = this.bounds.x >> 0;
                        this.bounds.y = this.bounds.y >> 0
                    }
                }
                return this.bounds
            }
            ;
            Polyline.prototype.isOpaque = function() {
                return false
            }
            ;
            Polyline.prototype.outlineShape = function(c) {
                c.polyline(this.points)
            }
            ;
            Polyline.prototype.primTranslate = function() {}
            ;
            Polyline.prototype.removeAllPoints = function() {
                this.isa = "Polyline";
                this.parentMethod("removeAllPoints");
                this.bounds = null 
            }
            ;
            Polyline.prototype.setLineWidth = function(c) {
                if (this.getLineWidth() == c) {
                    return
                }
                if (c < this.getLineWidth()) {
                    this.erase()
                }
                this.bounds = null ;
                this.isa = "Polyline";
                this.parentMethod("setLineWidth", c)
            }
            ;
            Polyline.prototype.setPoints = function(c) {
                this.isa = "Polyline";
                this.parentMethod("setPoints", c);
                this.firePropertyChange(Connection.PROPERTY_POINTS, null , c)
            }
            ;
            Polyline.prototype.setTolerance = function(c) {
                this.tolerance = c
            }
            ;
            Polyline.prototype.repaint = function() {
                this.bounds = null ;
                this.isa = "Polyline";
                this.parentMethod("repaint")
            }
            ;
            Polyline.prototype.init = function(c) {
                this.parentMethod("init", c);
                this.tolerance = 2;
                this.setFill(false);
                this.bounds = null 
            }
        }
        Polyline._initialized = true;
        _classes.defineClass("Polyline", a)
    }
    this.init(b)
}
Polyline.LINEBOUNDS = Rectangle.SINGLETON;
_classes.registerClass("Polygon", "Polyline");
function Polygon(b) {
    if (typeof Polygon._initialized == "undefined") {
        function a() {
            Polygon.prototype.containsPoint = function(c, d) {
                if (!this.getBounds().contains(c, d)) {
                    return false
                }
                return this.shapeContainsPoint(c, d) || this.childrenContainsPoint(c, d)
            }
            ;
            Polygon.prototype.shapeContainsPoint = function(c, d) {
                return Geometry.polygonContainsPoint(this.points, c, d)
            }
            ;
            Polygon.prototype.outlineShape = function(c) {
                c.polygon(this.getPoints())
            }
            ;
            Polygon.prototype.init = function(c) {
                this.parentMethod("init", c)
            }
        }
        Polygon._initialized = true;
        _classes.defineClass("Polygon", a)
    }
    this.init(b)
}
_classes.registerClass("PolylineShape", "AbstractPointListShape");
function PolylineShape(b) {
    if (typeof PolylineShape._initialized == "undefined") {
        function a() {
            PolylineShape.prototype.shapeContainsPoint = function(c, g) {
                var d = this.getLocation();
                return Geometry.polylineContainsPoint(this.points, c - d.x, g - d.y, this.tolerance)
            }
            ;
            PolylineShape.prototype.outlineShape = function(c) {
                c.pushState();
                c.translate(this.getLocation());
                c.polyline(this.points);
                c.restoreState()
            }
            ;
            PolylineShape.prototype.setTolerance = function(c) {
                this.tolerance = c
            }
            ;
            PolylineShape.prototype.init = function(c) {
                this.parentMethod("init", c);
                this.tolerance = 2
            }
        }
        PolylineShape._initialized = true;
        _classes.defineClass("PolylineShape", a)
    }
    this.init(b)
}
_classes.registerClass("ScalablePolygonShape", "AbstractPointListShape");
function ScalablePolygonShape(b) {
    if (typeof ScalablePolygonShape._initialized == "undefined") {
        function a() {
            ScalablePolygonShape.prototype.shapeContainsPoint = function(c, g) {
                var d = this.getLocation();
                return Geometry.polygonContainsPoint(this.getScaledPoints(), c - d.x, g - d.y)
            }
            ;
            ScalablePolygonShape.prototype.outlineShape = function(c) {
                c.pushState();
                c.translate(this.getLocation());
                c.polygon(this.getScaledPoints());
                c.restoreState()
            }
            ;
            ScalablePolygonShape.prototype.getTemplateBounds = function() {
                ScalablePolygonShape.TEMPLATEBOUNDS.setLocation(0, 0);
                ScalablePolygonShape.TEMPLATEBOUNDS.setSize(0, 0);
                var g = this.points.toIntArray();
                for (var d = 0; d < g.length; ) {
                    var c = g[d++];
                    if (c > ScalablePolygonShape.TEMPLATEBOUNDS.width) {
                        ScalablePolygonShape.TEMPLATEBOUNDS.width = c
                    }
                    var h = g[d++];
                    if (h > ScalablePolygonShape.TEMPLATEBOUNDS.height) {
                        ScalablePolygonShape.TEMPLATEBOUNDS.height = h
                    }
                }
                return ScalablePolygonShape.TEMPLATEBOUNDS
            }
            ;
            ScalablePolygonShape.prototype.getScaledPoints = function() {
                if (this.scaledPoints != null ) {
                    return this.scaledPoints
                }
                var h = this.getTemplateBounds();
                var g = this.getBounds();
                var m = g.width > this.lineWidth ? (g.width - this.lineWidth) / h.width : 0;
                var l = g.height > this.lineWidth ? (g.height - this.lineWidth) / h.height : 0;
                var c = (this.lineWidth) / 2;
                this.scaledPoints = new PointList(this.points);
                var n = this.scaledPoints.toIntArray();
                for (var d = 0; d < n.length; d += 2) {
                    n[d] = Math.floor(n[d] * m) + c;
                    n[d + 1] = Math.floor(n[d + 1] * l) + c
                }
                return scaledPoints
            }
            ;
            ScalablePolygonShape.prototype.addPoint = function(c) {
                this.scaledPoints = null ;
                this.isa = "ScalablePolygonShape";
                this.parentMethod("addPoint", c)
            }
            ;
            ScalablePolygonShape.prototype.insertPoint = function(d, c) {
                this.scaledPoints = null ;
                this.isa = "ScalablePolygonShape";
                this.parentMethod("insertPoint", d)
            }
            ;
            ScalablePolygonShape.prototype.removeAllPoints = function() {
                this.scaledPoints = null ;
                this.isa = "ScalablePolygonShape";
                this.parentMethod("removeAllPoints")
            }
            ;
            ScalablePolygonShape.prototype.removePoint = function(c) {
                this.scaledPoints = null ;
                this.isa = "ScalablePolygonShape";
                this.parentMethod("removePoint", c)
            }
            ;
            ScalablePolygonShape.prototype.setStart = function(c) {
                this.scaledPoints = null ;
                this.isa = "ScalablePolygonShape";
                this.parentMethod("setStart", c)
            }
            ;
            ScalablePolygonShape.prototype.setEnd = function(c) {
                this.scaledPoints = null ;
                this.isa = "ScalablePolygonShape";
                this.parentMethod("setEnd", c)
            }
            ;
            ScalablePolygonShape.prototype.setPoint = function(d, c) {
                this.scaledPoints = null ;
                this.isa = "ScalablePolygonShape";
                this.parentMethod("setPoint", d, c)
            }
            ;
            ScalablePolygonShape.prototype.setPoints = function(c) {
                this.scaledPoints = null ;
                this.isa = "ScalablePolygonShape";
                this.parentMethod("setPoints", c)
            }
            ;
            ScalablePolygonShape.prototype.setBounds = function(c) {
                this.scaledPoints = null ;
                this.isa = "ScalablePolygonShape";
                this.parentMethod("setBounds", c)
            }
            ;
            ScalablePolygonShape.prototype.setLineWidth = function(c) {
                this.scaledPoints = null ;
                this.isa = "ScalablePolygonShape";
                this.parentMethod("setLineWidth", c)
            }
            ;
            ScalablePolygonShape.prototype.init = function(d) {
                this.parentMethod("init", d);
                var c = null 
            }
        }
        ScalablePolygonShape._initialized = true;
        _classes.defineClass("ScalablePolygonShape", a)
    }
    this.init(b)
}
ScalablePolygonShape.TEMPLATEBOUNDS = Rectangle.SINGLETON;
_classes.registerClass("PolylineDecoration", "Polyline");
function PolylineDecoration(b) {
    if (typeof PolylineDecoration._initialized == "undefined") {
        function a() {
            PolylineDecoration.prototype.getPoints = function() {
                if (this.points == null ) {
                    this.points = new PointList();
                    for (var c = 0; c < this.template.size; c++) {
                        this.points.addPoint(this.transform.getTransformed(this.template.getPoint(c)))
                    }
                }
                return this.points
            }
            ;
            PolylineDecoration.prototype.setLocation = function(c) {
                this.points = null ;
                this.bounds = null ;
                this.location.setLocation(c);
                this.transform.setTranslation(c.x, c.y)
            }
            ;
            PolylineDecoration.prototype.setTemplate = function(c) {
                this.erase();
                this.template = c;
                this.points = null ;
                this.bounds = null ;
                this.repaint()
            }
            ;
            PolylineDecoration.prototype.setScale = function(c, d) {
                this.points = null ;
                this.bounds = null ;
                this.transform.setScale(c, d)
            }
            ;
            PolylineDecoration.prototype.setReferencePoint = function(c) {
                var d = Point.SINGLETON;
                d.setLocation(c);
                d.negate().translate(this.location);
                this.setRotation(Math.atan2(d.y, d.x))
            }
            ;
            PolylineDecoration.prototype.setRotation = function(c) {
                this.points = null ;
                this.bounds = null ;
                this.transform.setRotation(c)
            }
            ;
            PolylineDecoration.prototype.init = function(c) {
                this.parentMethod("init", c);
                this.location = new Point(0,0);
                this.template = PolylineDecoration.TRIANGLE_TIP;
                this.transform = new Transform();
                this.setBackgroundColor(ColorConstants.black);
                this.setScale(7, 3)
            }
        }
        PolylineDecoration._initialized = true;
        _classes.defineClass("PolylineDecoration", a)
    }
    this.init(b)
}
PolylineDecoration.TRIANGLE_TIP = new PointList();
PolylineDecoration.TRIANGLE_TIP.addPoint(-1, 1);
PolylineDecoration.TRIANGLE_TIP.addPoint(0, 0);
PolylineDecoration.TRIANGLE_TIP.addPoint(-1, -1);
_classes.registerClass("PolygonDecoration", "Polygon");
function PolygonDecoration(b) {
    if (typeof PolygonDecoration._initialized == "undefined") {
        function a() {
            PolygonDecoration.prototype.getLocalBackgroundColor = function() {
                this.isa = "PolygonDecoration";
                var c = this.parentMethod("getLocalBackgroundColor");
                if (c == null ) {
                    return this.getForegroundColor()
                } else {
                    return c
                }
            }
            ;
            PolygonDecoration.prototype.getPoints = function() {
                if (this.points == null ) {
                    this.points = new PointList();
                    for (var c = 0; c < this.template.size; c++) {
                        this.points.addPoint(this.transform.getTransformed(this.template.getPoint(c)))
                    }
                }
                return this.points
            }
            ;
            PolygonDecoration.prototype.setLocation = function(c) {
                this.points = null ;
                this.bounds = null ;
                this.location.setLocation(c);
                this.transform.setTranslation(c.x, c.y)
            }
            ;
            PolygonDecoration.prototype.setTemplate = function(c) {
                this.erase();
                this.template = c;
                this.points = null ;
                this.bounds = null ;
                this.repaint()
            }
            ;
            PolygonDecoration.prototype.setScale = function(c, d) {
                this.points = null ;
                this.bounds = null ;
                this.transform.setScale(c, d)
            }
            ;
            PolygonDecoration.prototype.setReferencePoint = function(c) {
                var d = Point.SINGLETON;
                d.setLocation(c);
                d.negate().translate(this.location);
                this.setRotation(Math.atan2(d.y, d.x))
            }
            ;
            PolygonDecoration.prototype.setRotation = function(c) {
                this.points = null ;
                this.bounds = null ;
                this.transform.setRotation(c)
            }
            ;
            PolygonDecoration.prototype.init = function(c) {
                this.parentMethod("init", c);
                this.location = new Point();
                this.template = PolygonDecoration.TRIANGLE_TIP;
                this.transform = new Transform();
                this.setFill(true);
                this.setScale(7, 3)
            }
        }
        PolygonDecoration._initialized = true;
        _classes.defineClass("PolygonDecoration", a)
    }
    this.init(b)
}
PolygonDecoration.TRIANGLE_TIP = new PointList();
PolygonDecoration.INVERTED_TRIANGLE_TIP = new PointList();
PolygonDecoration.TRIANGLE_TIP.addPoint(0, 0);
PolygonDecoration.TRIANGLE_TIP.addPoint(-1, 1);
PolygonDecoration.TRIANGLE_TIP.addPoint(-1, -1);
PolygonDecoration.INVERTED_TRIANGLE_TIP.addPoint(0, 1);
PolygonDecoration.INVERTED_TRIANGLE_TIP.addPoint(0, -1);
PolygonDecoration.INVERTED_TRIANGLE_TIP.addPoint(-1, 0);
function FigureConstants() {}
FigureConstants.FLAG_VALID = 1,
FigureConstants.FLAG_OPAQUE = 1 << 1;
FigureConstants.FLAG_VISIBLE = 1 << 2;
FigureConstants.FLAG_FOCUSABLE = 1 << 3;
FigureConstants.FLAG_ENABLED = 1 << 4;
FigureConstants.FLAG_FOCUS_TRAVERSABLE = 1 << 5;
FigureConstants.FLAG_REALIZED = 1 << 31;
FigureConstants.MAX_FLAG = FigureConstants.FLAG_FOCUS_TRAVERSABLE;
_classes.registerClass("RootFigure", "Figure");
function RootFigure(a) {
    if (typeof RootFigure._initialized == "undefined") {
        function b() {
            RootFigure.prototype.getUpdateManager = function() {
                return this.lws.getUpdateManager()
            }
            ;
            RootFigure.prototype.internalGetEventDispatcher = function() {
                return this.lws.getEventDispatcher()
            }
            ;
            RootFigure.prototype.isShowing = function() {
                return true
            }
            ;
            RootFigure.prototype.init = function(c) {
                this.parentMethod("init", "rootFigure");
                this.lws = c
            }
        }
        RootFigure._initialized = true;
        _classes.defineClass("RootFigure", b)
    }
    this.init(a)
}
_classes.registerClass("Layer", "Figure");
function Layer(b) {
    if (typeof Layer._initialized == "undefined") {
        function a() {
            Layer.prototype.containsPoint = function(c, l) {
                if (this.isOpaque()) {
                    this.isa = "Layer";
                    return this.parentMethod("containsPoint", c, l)
                }
                var g = Point.SINGLETON;
                g.setLocation(c, l);
                this.translateFromParent(g);
                c = g.x;
                l = g.y;
                for (var d = 0; d < this.children.length; d++) {
                    var h = this.children[d];
                    if (h.containsPoint(c, l)) {
                        return true
                    }
                }
                return false
            }
            ;
            Layer.prototype.findFigureAt = function(c, h, d) {
                this.isa = "Layer";
                if (!this.isEnabled()) {
                    return null 
                }
                if (this.isOpaque()) {
                    return this.parentMethod("findFigureAt", c, h, d)
                }
                var g = this.parentMethod("findFigureAt", c, h, d);
                if (g == this) {
                    return null 
                }
                return g
            }
            ;
            Layer.prototype.init = function(c) {
                this.parentMethod("init", c)
            }
        }
        Layer._initialized = true;
        _classes.defineClass("Layer", a)
    }
    this.init(b)
}
_classes.registerClass("LayeredPane", "Layer");
function LayeredPane(b) {
    if (typeof LayeredPane._initialized == "undefined") {
        function a() {
            LayeredPane.prototype.add = function(c, g, d) {
                if (d == -1) {
                    d = this.layerKeys.length
                }
                this.isa = "LayeredPane";
                this.parentMethod("add", c, null , d);
                Util.Array.add(this.layerKeys, g, d)
            }
            ;
            LayeredPane.prototype.addLayerAfter = function(g, d, h) {
                var c = Util.Array.indexOf(this.layerKeys, h);
                this.add(g, d, ++c)
            }
            ;
            LayeredPane.prototype.addLayerBefore = function(g, d, h) {
                var c = Util.Array.indexOf(this.layerKeys, h);
                this.add(g, d, c)
            }
            ;
            LayeredPane.prototype.getLayerbyKey = function(d) {
                var c = Util.Array.indexOf(this.layerKeys, d);
                if (c == -1) {
                    return null 
                }
                return this.children[c]
            }
            ;
            LayeredPane.prototype.getLayer = function(c) {
                if (c > 0) {
                    return this.children[index]
                } else {
                    return this.getLayerbyKey(c)
                }
            }
            ;
            LayeredPane.prototype.remove = function(c) {
                var d = Util.Array.indexOf(this.children, c);
                if (d != -1) {
                    Util.Array.remove(this.layerKeys, d)
                }
                this.isa = "LayeredPane";
                this.parentMethod("remove", c)
            }
            ;
            LayeredPane.prototype.removeLayer = function(c) {
                if (c == null ) {
                    return
                }
                var d;
                if (c >= 0) {
                    d = this.getLayer(index)
                } else {
                    if (Util.isInstanceOf(c, Figure)) {
                        d = c
                    } else {
                        d = this.getLayer(Util.Array.indexOf(this.layerKeys, key))
                    }
                }
                this.remove(d)
            }
            ;
            LayeredPane.prototype.init = function(c) {
                this.parentMethod("init", c);
                this.layerKeys = [];
                this.setLayoutManager(new StackLayout())
            }
        }
        LayeredPane._initialized = true;
        _classes.defineClass("LayeredPane", a)
    }
    this.init(b)
}
_classes.registerClass("ScalableLayeredPane", "LayeredPane");
function ScalableLayeredPane(b) {
    if (typeof ScalableLayeredPane._initialized == "undefined") {
        function a() {
            ScalableLayeredPane.prototype.getClientArea = function(c) {
                if (c == null ) {
                    c = new Rectangle(0,0,0,0)
                }
                this.isa = "ScalableLayeredPane";
                this.parentMethod("getClientArea", c);
                c.width /= this.scale;
                c.height /= this.scale;
                c.x /= this.scale;
                c.y /= this.scale;
                return c
            }
            ;
            ScalableLayeredPane.prototype.getMinimumSize = function(m, g) {
                this.isa = "ScalableLayeredPane";
                var n = this.parentMethod("getMinimumSize", m / this.getScale(), g / this.getScale());
                var c = this.getInsets().getWidth();
                var l = this.getInsets().getHeight();
                return n.getExpanded(-c, -l).scale(this.scale).expand(c, l)
            }
            ;
            ScalableLayeredPane.prototype.getPreferredSize = function(m, g) {
                this.isa = "ScalableLayeredPane";
                var n = this.parentMethod("getPreferredSize", m / this.getScale(), g / this.getScale());
                var c = this.getInsets().getWidth();
                var l = this.getInsets().getHeight();
                return n.getExpanded(-c, -l).scale(this.scale).expand(c, l)
            }
            ;
            ScalableLayeredPane.prototype.getScale = function() {
                return this.scale
            }
            ;
            ScalableLayeredPane.prototype.isCoordinateSystem = function() {
                return true
            }
            ;
            ScalableLayeredPane.prototype.paintClientArea = function(c) {
                if (this.children.length == 0) {
                    return
                }
                if (this.scale == 1) {
                    this.isa = "ScalableLayeredPane";
                    this.parentMethod("paintClientArea", c)
                } else {
                    var d = (this.getBorder() == null  || this.getBorder().isOpaque());
                    if (!d) {
                        c.clipRect(getBounds().getCropped(getInsets()))
                    }
                    c.scale(this.scale, this.scale);
                    c.pushState();
                    this.paintChildren(c);
                    c.restoreState()
                }
            }
            ;
            ScalableLayeredPane.prototype.setScale = function(c) {
                if (this.scale == c) {
                    return
                }
                this.scale = c;
                this.revalidate();
                this.repaint()
            }
            ;
            ScalableLayeredPane.prototype.translateFromParent = function(c) {
                c.performScale(1 / this.scale)
            }
            ;
            ScalableLayeredPane.prototype.translateToParent = function(c) {
                c.performScale(this.scale)
            }
            ;
            ScalableLayeredPane.prototype.init = function(c) {
                this.parentMethod("init", c);
                this.scale = 1
            }
        }
        ScalableLayeredPane._initialized = true;
        _classes.defineClass("ScalableLayeredPane", a)
    }
    this.init(b)
}
_classes.registerClass("FreeformLayeredPane", "LayeredPane");
function FreeformLayeredPane(b) {
    if (typeof FreeformLayeredPane._initialized == "undefined") {
        function a() {
            FreeformLayeredPane.prototype.add = function(g, d, c) {
                this.isa = "FreeformLayeredPane";
                this.parentMethod("add", g, d, c);
                this.helper.hookChild(g)
            }
            ;
            FreeformLayeredPane.prototype.addFreeformListener = function(c) {
                this.addListener("FreeformListener", c)
            }
            ;
            FreeformLayeredPane.prototype.fireExtentChanged = function() {
                var c = this.getListeners("FreeformListener");
                while (c.hasNext()) {
                    c.next().notifyFreeformExtentChanged()
                }
            }
            ;
            FreeformLayeredPane.prototype.fireMoved = function() {}
            ;
            FreeformLayeredPane.prototype.getFreeformHelper = function() {
                return this.helper
            }
            ;
            FreeformLayeredPane.prototype.getFreeformExtent = function() {
                return this.helper.getFreeformExtent()
            }
            ;
            FreeformLayeredPane.prototype.primTranslate = function(d, c) {
                this.bounds.x += d;
                this.bounds.y += c
            }
            ;
            FreeformLayeredPane.prototype.remove = function(c) {
                this.helper.unhookChild(c);
                this.isa = "FreeformLayeredPane";
                this.parentMethod("remove", c)
            }
            ;
            FreeformLayeredPane.prototype.removeFreeformListener = function(c) {
                this.removeListener("FreeformListener", c)
            }
            ;
            FreeformLayeredPane.prototype.setFreeformBounds = function(c) {
                this.helper.setFreeformBounds(c)
            }
            ;
            FreeformLayeredPane.prototype.superFireMoved = function() {
                this.isa = "FreeformLayeredPane";
                this.parentMethod("fireMoved")
            }
            ;
            FreeformLayeredPane.prototype.init = function(c) {
                this.parentMethod("init", c);
                this.helper = new FreeformHelper(this);
                this.setLayoutManager(null )
            }
        }
        FreeformLayeredPane._initialized = true;
        _classes.defineClass("FreeformLayeredPane", a)
    }
    this.init(b)
}
_classes.registerClass("ScalableFreeformLayeredPane", "FreeformLayeredPane");
function ScalableFreeformLayeredPane(b) {
    if (typeof ScalableFreeformLayeredPane._initialized == "undefined") {
        function a() {
            ScalableFreeformLayeredPane.prototype.getClientArea = function(c) {
                if (c == null ) {
                    c = new Rectangle(0,0,0,0)
                }
                this.isa = "ScalableFreeformLayeredPane";
                this.parentMethod("getClientArea", c);
                c.width /= this.scale;
                c.height /= this.scale;
                c.x /= this.scale;
                c.y /= this.scale;
                return c
            }
            ;
            ScalableFreeformLayeredPane.prototype.getScale = function() {
                return this.scale
            }
            ;
            ScalableFreeformLayeredPane.prototype.isCoordinateSystem = function() {
                return true
            }
            ;
            ScalableFreeformLayeredPane.prototype.paintClientArea = function(c) {
                if (this.children.length == 0) {
                    return
                }
                if (this.scale == 1) {
                    this.isa = "ScalableFreeformLayeredPane";
                    this.parentMethod("paintClientArea", c)
                } else {
                    var d = this.getBorder() == null  || this.getBorder().isOpaque();
                    if (!d) {
                        c.clipRect(this.getBounds().getCropped(this.getInsets()))
                    }
                    c.scale(this.scale, this.scale);
                    c.pushState();
                    this.paintChildren(c);
                    c.restoreState()
                }
            }
            ;
            ScalableFreeformLayeredPane.prototype.setScale = function(c) {
                if (this.scale == c) {
                    return
                }
                this.scale = c;
                this.superFireMoved();
                this.getFreeformHelper().invalidate();
                this.repaint()
            }
            ;
            ScalableFreeformLayeredPane.prototype.translateToParent = function(c) {
                c.performScale(this.scale)
            }
            ;
            ScalableFreeformLayeredPane.prototype.translateFromParent = function(c) {
                c.performScale(1 / this.scale)
            }
            ;
            ScalableFreeformLayeredPane.prototype.useLocalCoordinates = function() {
                return false
            }
            ;
            ScalableFreeformLayeredPane.prototype.init = function(c) {
                this.parentMethod("init", c);
                this.scale = 1
            }
        }
        ScalableFreeformLayeredPane._initialized = true;
        _classes.defineClass("ScalableFreeformLayeredPane", a)
    }
    this.init(b)
}
_classes.registerClass("FreeformLayer", "Layer");
function FreeformLayer(b) {
    if (typeof FreeformLayer._initialized == "undefined") {
        function a() {
            FreeformLayer.prototype.add = function(g, d, c) {
                this.isa = "FreeformLayer";
                this.parentMethod("add", g, d, c);
                this.helper.hookChild(g)
            }
            ;
            FreeformLayer.prototype.addFreeformListener = function(c) {
                this.addListener("FreeformListener", c)
            }
            ;
            FreeformLayer.prototype.fireExtentChanged = function() {
                var c = this.getListeners("FreeformListener");
                while (c.hasNext()) {
                    c.next().notifyFreeformExtentChanged()
                }
            }
            ;
            FreeformLayer.prototype.fireMoved = function() {}
            ;
            FreeformLayer.prototype.getFreeformExtent = function() {
                return this.helper.getFreeformExtent()
            }
            ;
            FreeformLayer.prototype.primTranslate = function(d, c) {
                this.bounds.x += d;
                this.bounds.y += c
            }
            ;
            FreeformLayer.prototype.remove = function(c) {
                this.helper.unhookChild(c);
                this.isa = "FreeformLayer";
                this.parentMethod("remove", c)
            }
            ;
            FreeformLayer.prototype.removeFreeformListener = function(c) {
                this.removeListener("FreeformListener", c)
            }
            ;
            FreeformLayer.prototype.setFreeformBounds = function(c) {
                this.helper.setFreeformBounds(c)
            }
            ;
            FreeformLayer.prototype.init = function(c) {
                this.parentMethod("init", c);
                this.helper = new FreeformHelper(this)
            }
        }
        FreeformLayer._initialized = true;
        _classes.defineClass("FreeformLayer", a)
    }
    this.init(b)
}
_classes.registerClass("ConnectionLayer", "FreeformLayer");
function ConnectionLayer(b) {
    if (typeof ConnectionLayer._initialized == "undefined") {
        function a() {
            ConnectionLayer.prototype.add = function(c, g, d) {
                this.isa = "ConnectionLayer";
                this.parentMethod("add", c, g, d);
                if (c.getConnectionRouter != null  && this.getConnectionRouter() != null ) {
                    c.setConnectionRouter(this.getConnectionRouter())
                }
            }
            ;
            ConnectionLayer.prototype.getConnectionRouter = function() {
                return this.connectionRouter
            }
            ;
            ConnectionLayer.prototype.paint = function(c) {
                if (this.antialias != -1) {
                    c.setAntialias(this.antialias)
                }
                this.isa = "ConnectionLayer";
                this.parentMethod("paint", c)
            }
            ;
            ConnectionLayer.prototype.remove = function(c) {
                if (c.setConnectionRouter != null ) {
                    c.setConnectionRouter(null )
                }
                this.isa = "ConnectionLayer";
                this.parentMethod("remove", c)
            }
            ;
            ConnectionLayer.prototype.setConnectionRouter = function(g) {
                this.connectionRouter = g;
                var d = new FigureIterator(this);
                var c;
                while (d.hasNext()) {
                    c = d.nextFigure();
                    if (Util.isInstanceOf(c, Connection)) {
                        c.setConnectionRouter(g)
                    }
                }
            }
            ;
            ConnectionLayer.prototype.setAntialias = function(c) {
                this.antialias = c
            }
            ;
            ConnectionLayer.prototype.init = function(c) {
                this.parentMethod("init", c);
                this.antialias = -1;
                this.connectionRouter = null 
            }
        }
        ConnectionLayer._initialized = true;
        _classes.defineClass("ConnectionLayer", a)
    }
    this.init(b)
}
_classes.registerClass("AbstractLayout");
function AbstractLayout() {
    if (typeof AbstractLayout._initialized == "undefined") {
        function a() {
            AbstractLayout.prototype.calculatePreferredSize = function() {}
            ;
            AbstractLayout.prototype.getBorderPreferredSize = function(b) {
                if (b.getBorder() == null ) {
                    return new Dimension()
                }
                return b.getBorder().getPreferredSize(b)
            }
            ;
            AbstractLayout.prototype.getConstraint = function(b) {
                return null 
            }
            ;
            AbstractLayout.prototype.getMinimumSize = function(b, d, c) {
                if (d != null  && c != null ) {
                    return this.getPreferredSize(b, d, c)
                }
            }
            ;
            AbstractLayout.prototype.getPreferredSize = function(b, d, c) {
                if (d == null  || c == null ) {
                    return
                }
                if (!this.preferredSize) {
                    this.preferredSize = this.calculatePreferredSize(b, d, c)
                }
                return this.preferredSize
            }
            ;
            AbstractLayout.prototype.invalidate = function() {
                this.preferredSize = null 
            }
            ;
            AbstractLayout.prototype.isObservingVisibility = function() {
                return this.isObservingVisibility
            }
            ;
            AbstractLayout.prototype.remove = function(b) {
                this.invalidate()
            }
            ;
            AbstractLayout.prototype.setConstraint = function(c, b) {
                this.invalidate(c)
            }
            ;
            AbstractLayout.prototype.setObserveVisibility = function(b) {
                if (this.isObservingVisibility == b) {
                    return
                }
                this.isObservingVisibility = b
            }
            ;
            AbstractLayout.prototype.init = function() {
                this.preferredSize;
                this.isObservingVisibility = false
            }
        }
        AbstractLayout._initialized = true;
        _classes.defineClass("AbstractLayout", a)
    }
    this.init()
}
_classes.registerClass("XYLayout", "AbstractLayout");
function XYLayout() {
    if (typeof XYLayout._initialized == "undefined") {
        function a() {
            XYLayout.prototype.calculatePreferredSize = function(n, l, q) {
                var s = new Rectangle();
                var g = n.getChildren();
                for (var m = 0; m < g.length; m++) {
                    var c = g[m];
                    var b = this.constraints.get(c);
                    if (b == null ) {
                        continue
                    }
                    if (b.width == -1 || b.height == -1) {
                        var o = c.getPreferredSize(b.width, b.height);
                        b = b.getCopy();
                        if (b.width == -1) {
                            b.width = o.width
                        }
                        if (b.height == -1) {
                            b.height = o.height
                        }
                    }
                    s.union(b)
                }
                var p = s.getSize();
                var h = n.getInsets();
                return new Dimension(p.width + h.getWidth(),p.height + h.getHeight()).union(this.getBorderPreferredSize(n))
            }
            ;
            XYLayout.prototype.getConstraint = function(b) {
                return this.constraints.get(b)
            }
            ;
            XYLayout.prototype.getOrigin = function(b) {
                return b.getClientArea().getLocation()
            }
            ;
            XYLayout.prototype.layout = function(h) {
                var g = h.children;
                var m = this.getOrigin(h);
                var c;
                var d;
                for (d = 0; d < g.length; d++) {
                    c = g[d];
                    var l = this.getConstraint(c);
                    if (!l) {
                        continue
                    }
                    if (l.width == -1 || l.height == -1) {
                        var b = c.getPreferredSize(l.width, l.height);
                        l = l.getCopy();
                        if (l.width == -1) {
                            l.width = b.width
                        }
                        if (l.height == -1) {
                            l.height = b.height
                        }
                    }
                    l = l.getTranslated(m);
                    c.setBounds(l)
                }
            }
            ;
            XYLayout.prototype.remove = function(b) {
                this.isa = "XYLayout";
                this.parentMethod("remove", b);
                this.constraints.remove(b)
            }
            ;
            XYLayout.prototype.setConstraint = function(b, c) {
                this.isa = "XYLayout";
                this.parentMethod("setConstraint", b, c);
                if (c) {
                    this.constraints.put(b, c)
                }
            }
            ;
            XYLayout.prototype.init = function() {
                this.parentMethod("init");
                this.constraints = new Map()
            }
        }
        XYLayout._initialized = true;
        _classes.defineClass("XYLayout", a)
    }
    this.init()
}
_classes.registerClass("FreeformLayout", "XYLayout");
function FreeformLayout() {
    if (typeof FreeformLayout._initialized == "undefined") {
        function a() {
            FreeformLayout.prototype.getOrigin = function(c) {
                if (this.origin == null ) {
                    this.origin = new Point();
                    if (this.isPositiveCoordinates()) {
                        var g = c.getChildren();
                        var h;
                        var l;
                        for (var d = 0, b = g.length; d < b; d++) {
                            h = g[d];
                            l = this.getConstraint(h);
                            if (l != null ) {
                                this.origin.x = Math.min(this.origin.x, this.constraint.x);
                                this.origin.y = Math.min(this.origin.y, this.constraint.y)
                            }
                        }
                        this.origin.negate()
                    }
                }
                return this.origin
            }
            ;
            FreeformLayout.prototype.isPositiveCoordinates = function() {
                return (this.flags & FreeformLayout.FLAG__POSITIVE_COORDINATES) != 0
            }
            ;
            FreeformLayout.prototype.setPositiveCoordinates = function(b) {
                if (b != this.isPositiveCoordinates()) {
                    if (b) {
                        this.flags |= FreeformLayout.FLAG__POSITIVE_COORDINATES
                    } else {
                        this.flags &= ~FreeformLayout.FLAG__POSITIVE_COORDINATES
                    }
                    this.invalidate()
                }
            }
            ;
            FreeformLayout.prototype.invalidate = function() {
                this.origin = null ;
                this.isa = "FreeformLayout";
                this.parentMethod("invalidate")
            }
            ;
            FreeformLayout.prototype.init = function() {
                this.parentMethod("init");
                this.flags = 0;
                this.origin = null 
            }
        }
        FreeformLayout._initialized = true;
        _classes.defineClass("FreeformLayout", a)
    }
    this.init()
}
FreeformLayout.FLAG__POSITIVE_COORDINATES = 1;
_classes.registerClass("StackLayout", "AbstractLayout");
function StackLayout() {
    if (typeof StackLayout._initialized == "undefined") {
        function a() {
            StackLayout.prototype.calculatePreferredSize = function(b, l, c) {
                if (l > -1) {
                    l = Math.max(0, l - b.getInsets().getWidth())
                }
                if (c > -1) {
                    c = Math.max(0, c - b.getInsets().getWidth())
                }
                var m = new Dimension();
                var h = b.getChildren();
                var n;
                for (var g = 0; g < h.length; g++) {
                    n = h[g];
                    if (!this.isObservingVisibility || n.isVisible()) {
                        m.union(n.getPreferredSize(l, c))
                    }
                }
                m.expand(b.getInsets().getWidth(), b.getInsets().getHeight());
                m.union(this.getBorderPreferredSize(b));
                return m
            }
            ;
            StackLayout.prototype.layout = function(b) {
                var g = b.getClientArea();
                var d = b.getChildren();
                var c;
                for (c = 0; c < d.length; c++) {
                    d[c].setBounds(g)
                }
            }
            ;
            StackLayout.prototype.setConstraint = function() {}
            ;
            StackLayout.prototype.init = function() {
                this.parentMethod("init")
            }
        }
        StackLayout._initialized = true;
        _classes.defineClass("StackLayout", a)
    }
    this.init()
}
_classes.registerClass("DelegatingLayout", "AbstractLayout");
function DelegatingLayout() {
    if (typeof DelegatingLayout._initialized == "undefined") {
        function a() {
            DelegatingLayout.prototype.calculatePreferredSize = function(l, h, b) {
                var g = l.getChildren();
                var m = new Dimension();
                for (var c = 0; c < g.length; c++) {
                    var n = g[c];
                    m.union(n.getPreferredSize())
                }
                return m
            }
            ;
            DelegatingLayout.prototype.getConstraint = function(b) {
                return this.constraints.get(b)
            }
            ;
            DelegatingLayout.prototype.layout = function(g) {
                var d = g.getChildren();
                for (var c = 0; c < d.length; c++) {
                    var h = d[c];
                    var b = this.constraints.get(h);
                    if (b != null ) {
                        b.relocate(h)
                    }
                }
            }
            ;
            DelegatingLayout.prototype.remove = function(b) {
                this.constraints.remove(b)
            }
            ;
            DelegatingLayout.prototype.setConstraint = function(b, c) {
                this.isa = "DelegatingLayout";
                this.parentMethod("setConstraint", b, c);
                if (c != null ) {
                    this.constraints.put(b, c)
                }
            }
            ;
            DelegatingLayout.prototype.init = function() {
                this.parentMethod("init");
                this.constraints = new Map()
            }
        }
        DelegatingLayout._initialized = true;
        _classes.defineClass("DelegatingLayout", a)
    }
    this.init()
}
_classes.registerClass("AbstractHintLayout", "AbstractLayout");
function AbstractHintLayout() {
    if (typeof AbstractHintLayout._initialized == "undefined") {
        function a() {
            AbstractHintLayout.prototype.calculateMinimumSize = function(b, d, c) {
                return this.getPreferredSize(b, d, c)
            }
            ;
            AbstractHintLayout.prototype.getMinimumSize = function(d, c, g) {
                var b = this.cachedMinimumHint.width != c && this.isSensitiveHorizontally(d);
                b |= this.cachedMinimumHint.height != g && this.isSensitiveVertically(d);
                if (b) {
                    this.minimumSize = null ;
                    this.cachedMinimumHint.width = c;
                    this.cachedMinimumHint.height = g
                }
                if (this.minimumSize == null ) {
                    this.minimumSize = this.calculateMinimumSize(d, c, g)
                }
                return this.minimumSize
            }
            ;
            AbstractHintLayout.prototype.getPreferredSize = function(d, c, g) {
                var b = this.cachedPreferredHint.width != c && this.isSensitiveHorizontally(d);
                b |= this.cachedPreferredHint.height != g && this.isSensitiveVertically(d);
                if (b) {
                    this.preferredSize = null ;
                    this.cachedPreferredHint.width = c;
                    this.cachedPreferredHint.height = g
                }
                this.isa = "AbstractHintLayout";
                return this.parentMethod("getPreferredSize", d, c, g)
            }
            ;
            AbstractHintLayout.prototype.invalidate = function() {
                this.minimumSize = null ;
                this.isa = "AbstractHintLayout";
                this.parentMethod("invalidate")
            }
            ;
            AbstractHintLayout.prototype.isSensitiveHorizontally = function() {
                return true
            }
            ;
            AbstractHintLayout.prototype.isSensitiveVertically = function() {
                return true
            }
            ;
            AbstractHintLayout.prototype.init = function() {
                this.parentMethod("init");
                this.minimumSize = null ;
                this.cachedPreferredHint = new Dimension(-1,-1);
                this.cachedMinimumHint = new Dimension(-1,-1)
            }
        }
        AbstractHintLayout._initialized = true;
        _classes.defineClass("AbstractHintLayout", a)
    }
    this.init()
}
_classes.registerClass("ViewportLayout", "AbstractHintLayout");
function ViewportLayout() {
    if (typeof ViewportLayout._initialized == "undefined") {
        function a() {
            ViewportLayout.prototype.calculateMinimumSize = function(c, l, g) {
                var b = c;
                var h = new Dimension();
                var d = b.getInsets();
                return h.getExpanded(d.getWidth(), d.getHeight())
            }
            ;
            ViewportLayout.prototype.calculatePreferredSize = function(h, g, d) {
                var b = h;
                var c = b.getInsets();
                var l = b.getContents();
                if (b.getContentsTracksWidth() && g > -1) {
                    g = Math.max(0, g - c.getWidth())
                } else {
                    g = -1
                }
                if (b.getContentsTracksHeight() && d > -1) {
                    d = Math.max(0, d - c.getHeight())
                } else {
                    d = -1
                }
                if (l == null ) {
                    return new Dimension(c.getWidth(),c.getHeight())
                } else {
                    var m = l.getMinimumSize(g, d);
                    if (g > -1) {
                        g = Math.max(g, m.width)
                    }
                    if (d > -1) {
                        d = Math.max(d, m.height)
                    }
                    return l.getPreferredSize(g, d).getExpanded(c.getWidth(), c.getHeight())
                }
            }
            ;
            ViewportLayout.prototype.isSensitiveHorizontally = function(b) {
                return b.getContentsTracksWidth()
            }
            ;
            ViewportLayout.prototype.isSensitiveVertically = function(b) {
                return b.getContentsTracksHeight()
            }
            ;
            ViewportLayout.prototype.layout = function(o) {
                var m = o;
                var d = m.getContents();
                if (d == null ) {
                    return
                }
                var b = m.getClientArea().getLocation();
                b.translate(m.getViewLocation().getNegated());
                var c = m.getClientArea();
                var h = m.getContentsTracksWidth() ? c.width : -1;
                var n = m.getContentsTracksHeight() ? c.height : -1;
                var l = m.getClientArea().getSize();
                var g = d.getMinimumSize(h, n);
                var q = d.getPreferredSize(h, n);
                if (m.getContentsTracksHeight()) {
                    l.height = Math.max(l.height, g.height)
                } else {
                    l.height = Math.max(l.height, q.height)
                }
                if (m.getContentsTracksWidth()) {
                    l.width = Math.max(l.width, g.width)
                } else {
                    l.width = Math.max(l.width, q.width)
                }
                d.setBounds(new Rectangle(b,l))
            }
            ;
            ViewportLayout.prototype.init = function() {
                this.parentMethod("init")
            }
        }
        ViewportLayout._initialized = true;
        _classes.defineClass("ViewportLayout", a)
    }
    this.init()
}
_classes.registerClass("FreeformViewportLayout", "ViewportLayout");
function FreeformViewportLayout() {
    if (typeof FreeformViewportLayout._initialized == "undefined") {
        function a() {
            FreeformViewportLayout.prototype.calculatePreferredSize = function(h, g, c) {
                var b = h;
                b.getContents().validate();
                g = Math.max(0, g);
                c = Math.max(0, c);
                var d = b.getContents().getFreeformExtent().getExpanded(b.getInsets()).union(0, 0).union(g - 1, c - 1).getSize();
                return d
            }
            ;
            FreeformViewportLayout.prototype.isSensitiveHorizontally = function(b) {
                return true
            }
            ;
            FreeformViewportLayout.prototype.isSensitiveVertically = function(b) {
                return true
            }
            ;
            FreeformViewportLayout.prototype.layout = function() {}
            ;
            FreeformViewportLayout.prototype.init = function() {
                this.parentMethod("init")
            }
        }
        FreeformViewportLayout._initialized = true;
        _classes.defineClass("FreeformViewportLayout", a)
    }
    this.init()
}
_classes.registerClass("FreeformHelper");
function FreeformHelper(a) {
    if (typeof FreeformHelper._initialized == "undefined") {
        function b() {
            FreeformHelper.prototype.getFreeformExtent = function() {
                if (this.freeformExtent != null ) {
                    return this.freeformExtent
                }
                var h;
                var g = this.host.getChildren();
                for (var d = 0; d < g.length; d++) {
                    var l = g[d];
                    if (l.getFreeformExtent != null ) {
                        h = l.getFreeformExtent()
                    } else {
                        h = l.getBounds()
                    }
                    if (this.freeformExtent == null ) {
                        this.freeformExtent = h.getCopy()
                    } else {
                        this.freeformExtent.union(h)
                    }
                }
                var c = this.host.getInsets();
                if (this.freeformExtent == null ) {
                    this.freeformExtent = new Rectangle(0,0,c.getWidth(),c.getHeight())
                } else {
                    this.host.translateToParent(this.freeformExtent);
                    this.freeformExtent.expand(c)
                }
                return this.freeformExtent
            }
            ;
            FreeformHelper.prototype.hookChild = function(c) {
                this.invalidate();
                if (c.addFreeformListener != null ) {
                    c.addFreeformListener(this)
                } else {
                    c.addFigureListener(this.figureListener)
                }
            }
            ;
            FreeformHelper.prototype.invalidate = function() {
                this.freeformExtent = null ;
                this.host.fireExtentChanged();
                if (this.host.getParent() != null ) {
                    this.host.getParent().revalidate()
                } else {
                    this.host.revalidate()
                }
            }
            ;
            FreeformHelper.prototype.notifyFreeformExtentChanged = function() {
                this.invalidate()
            }
            ;
            FreeformHelper.prototype.setFreeformBounds = function(g) {
                this.host.setBounds(g);
                g = g.getCopy();
                this.host.translateFromParent(g);
                var d = this.host.getChildren();
                for (var c = 0; c < d.length; c++) {
                    var h = d[c];
                    if (h.setFreeformBounds != null ) {
                        h.setFreeformBounds(g)
                    }
                }
            }
            ;
            FreeformHelper.prototype.unhookChild = function(c) {
                this.invalidate();
                if (c.removeFreeformListener != null ) {
                    c.removeFreeformListener(this)
                } else {
                    c.removeFigureListener(this.figureListener)
                }
            }
            ;
            FreeformHelper.prototype.init = function(c) {
                this.parentMethod("init");
                this.host = c;
                this.freeformExtent = null ;
                this.figureListener = new ChildTracker(this)
            }
        }
        FreeformHelper._initialized = true;
        _classes.defineClass("FreeformHelper", b)
    }
    this.init(a)
}
_classes.registerClass("ChildTracker");
function ChildTracker(a) {
    if (typeof ChildTracker._initialized == "undefined") {
        function b() {
            ChildTracker.prototype.figureMoved = function(c) {
                this.freeformHelper.invalidate()
            }
            ;
            ChildTracker.prototype.init = function(c) {
                this.parentMethod("init");
                this.freeformHelper = c
            }
        }
        ChildTracker._initialized = true;
        _classes.defineClass("ChildTracker", b)
    }
    this.init(a)
}
_classes.registerClass("AbstractLocator");
function AbstractLocator() {
    if (typeof AbstractLocator._initialized == "undefined") {
        function a() {
            AbstractLocator.prototype.getGap = function() {
                return this.gap
            }
            ;
            AbstractLocator.prototype.getReferencePoint = function() {}
            ;
            AbstractLocator.prototype.getNewBounds = function(h, d) {
                var l = new Rectangle(d,h);
                l.x -= l.width / 2;
                l.y -= l.height / 2;
                var c = 0
                  , g = 0;
                var b = this.getRelativePosition();
                if ((b & PositionConstants.NORTH) != 0) {
                    g = -1
                } else {
                    if ((b & PositionConstants.SOUTH) != 0) {
                        g = 1
                    }
                }
                if ((b & PositionConstants.WEST) != 0) {
                    c = -1
                } else {
                    if ((b & PositionConstants.EAST) != 0) {
                        c = 1
                    }
                }
                l.x += c * (l.width / 2 + this.getGap());
                l.y += g * (l.height / 2 + this.getGap());
                return l
            }
            ;
            AbstractLocator.prototype.getRelativePosition = function() {
                return this.relativePosition
            }
            ;
            AbstractLocator.prototype.relocate = function(d) {
                var c = d.getPreferredSize();
                var b = this.getReferencePoint();
                d.translateToRelative(b);
                d.setBounds(this.getNewBounds(c, b))
            }
            ;
            AbstractLocator.prototype.setGap = function(b) {
                this.gap = b
            }
            ;
            AbstractLocator.prototype.setRelativePosition = function(b) {
                this.relativePosition = b
            }
            ;
            AbstractLocator.prototype.init = function() {
                this.parentMethod("init");
                this.relativePosition = PositionConstants.CENTER;
                this.gap = 0
            }
        }
        AbstractLocator._initialized = true;
        _classes.defineClass("AbstractLocator", a)
    }
    this.init()
}
_classes.registerClass("ConnectionLocator", "AbstractLocator");
function ConnectionLocator(a, c) {
    if (typeof ConnectionLocator._initialized == "undefined") {
        function b() {
            ConnectionLocator.prototype.getAlignment = function() {
                return this.alignment
            }
            ;
            ConnectionLocator.prototype.getConnection = function() {
                return this.connection
            }
            ;
            ConnectionLocator.prototype.getReferencePoint = function() {
                var d = this.getLocation(this.getConnection().getPoints());
                this.getConnection().translateToAbsolute(d);
                return d
            }
            ;
            ConnectionLocator.prototype.getLocation = function(l) {
                switch (this.getAlignment()) {
                case ConnectionLocator.SOURCE:
                    return l.getPoint(Point.SINGLETON, 0);
                case ConnectionLocator.TARGET:
                    return l.getPoint(Point.SINGLETON, l.size - 1);
                case ConnectionLocator.MIDDLE:
                    if (l.size % 2 == 0) {
                        var h = l.size / 2;
                        var g = h - 1;
                        var o = l.getPoint(g);
                        var m = l.getPoint(h);
                        var n = m.getDifference(o);
                        return Point.SINGLETON.setLocation(o.x + n.width / 2, o.y + n.height / 2)
                    }
                    var h = (l.size - 1) / 2;
                    return l.getPoint(Point.SINGLETON, h);
                default:
                    return new Point(0,0)
                }
            }
            ;
            ConnectionLocator.prototype.setAlignment = function(d) {
                this.alignment = d
            }
            ;
            ConnectionLocator.prototype.setConnection = function(d) {
                this.connection = d
            }
            ;
            ConnectionLocator.prototype.init = function(d, g) {
                this.parentMethod("init");
                this.setConnection(d);
                if (g != null ) {
                    this.setAlignment(g)
                } else {
                    this.setAlignment(ConnectionLocator.MIDDLE)
                }
            }
        }
        ConnectionLocator._initialized = true;
        _classes.defineClass("ConnectionLocator", b)
    }
    this.init(a, c)
}
ConnectionLocator.SOURCE = 2;
ConnectionLocator.TARGET = 3;
ConnectionLocator.MIDDLE = 4;
_classes.registerClass("ArrowLocator", "ConnectionLocator");
function ArrowLocator(b, a) {
    if (typeof ArrowLocator._initialized == "undefined") {
        function c() {
            ArrowLocator.prototype.relocate = function(h) {
                var d = this.getConnection().getPoints();
                var g = h;
                g.setLocation(this.getLocation(d));
                if (this.getAlignment() == ConnectionLocator.SOURCE) {
                    g.setReferencePoint(d.getPoint(1))
                } else {
                    if (this.getAlignment() == ConnectionLocator.TARGET) {
                        g.setReferencePoint(d.getPoint(d.size - 2))
                    }
                }
            }
            ;
            ArrowLocator.prototype.init = function(g, d) {
                this.parentMethod("init", g, d)
            }
        }
        ArrowLocator._initialized = true;
        _classes.defineClass("ArrowLocator", c)
    }
    this.init(b, a)
}
_classes.registerClass("MidpointLocator", "ConnectionLocator");
function MidpointLocator(a, b) {
    if (typeof MidpointLocator._initialized == "undefined") {
        function c() {
            MidpointLocator.prototype.getReferencePoint = function() {
                var d = this.getConnection();
                var h = Point.SINGLETON;
                var l = d.getPoints().getPoint(this.getIndex());
                var g = d.getPoints().getPoint(this.getIndex() + 1);
                d.translateToAbsolute(l);
                d.translateToAbsolute(g);
                h.x = (g.x - l.x) / 2 + l.x;
                h.y = (g.y - l.y) / 2 + l.y;
                return h
            }
            ;
            MidpointLocator.prototype.getIndex = function() {
                return this.index
            }
            ;
            MidpointLocator.prototype.init = function(d, g) {
                this.parentMethod("init", d);
                this.index = g
            }
        }
        MidpointLocator._initialized = true;
        _classes.defineClass("MidpointLocator", c)
    }
    this.init(a, b)
}
_classes.registerClass("BendpointLocator", "ConnectionLocator");
function BendpointLocator(a, b) {
    if (typeof BendpointLocator._initialized == "undefined") {
        function c() {
            BendpointLocator.prototype.getReferencePoint = function() {
                var d = this.getConnection().getPoints().getPoint(Point.SINGLETON, this.getIndex());
                this.getConnection().translateToAbsolute(d);
                return d
            }
            ;
            BendpointLocator.prototype.getIndex = function() {
                return this.index
            }
            ;
            BendpointLocator.prototype.init = function(d, g) {
                this.parentMethod("init", d);
                this.index = g
            }
        }
        BendpointLocator._initialized = true;
        _classes.defineClass("BendpointLocator", c)
    }
    this.init(a, b)
}
_classes.registerClass("RelativeLocator");
function RelativeLocator(c, b, a) {
    if (typeof RelativeLocator._initialized == "undefined") {
        function d() {
            RelativeLocator.prototype.relocate = function(m) {
                var g = this.getReferenceFigure();
                var l = new Rectangle(this.getReferenceBox().getResized(-1, -1));
                g.translateToAbsolute(l);
                m.translateToRelative(l);
                l.resize(1, 1);
                var h = m.getPreferredSize();
                l.x += Math.floor(l.width * this.relativeX - ((h.width + 1) / 2));
                l.y += Math.floor(l.height * this.relativeY - ((h.height + 1) / 2));
                l.setSize(h);
                m.setBounds(l)
            }
            ;
            RelativeLocator.prototype.getReferenceBox = function() {
                return this.getReferenceFigure().getBounds()
            }
            ;
            RelativeLocator.prototype.getReferenceFigure = function() {
                return this.reference
            }
            ;
            RelativeLocator.prototype.setReferenceFigure = function(g) {
                this.reference = g
            }
            ;
            RelativeLocator.prototype.init = function(m, l, h) {
                this.parentMethod("init");
                if (m == null ) {
                    this.relativeX = 0;
                    this.relativeY = 0
                } else {
                    this.setReferenceFigure(m);
                    if (h == null ) {
                        var g = l;
                        switch (g & PositionConstants.NORTH_SOUTH) {
                        case PositionConstants.NORTH:
                            this.relativeY = 0;
                            break;
                        case PositionConstants.SOUTH:
                            this.relativeY = 1;
                            break;
                        default:
                            this.relativeY = 0.5
                        }
                        switch (g & PositionConstants.EAST_WEST) {
                        case PositionConstants.WEST:
                            this.relativeX = 0;
                            break;
                        case PositionConstants.EAST:
                            this.relativeX = 1;
                            break;
                        default:
                            this.relativeX = 0.5
                        }
                    } else {
                        this.relativeX = l;
                        this.relativeY = h
                    }
                }
            }
        }
        RelativeLocator._initialized = true;
        _classes.defineClass("RelativeLocator", d)
    }
    this.init(c, b, a)
}
Connection = {};
Connection.PROPERTY_CONNECTION_ROUTER = "connectionRouter";
Connection.PROPERTY_POINTS = "points";
_classes.registerClass("ConnectionAnchorBase");
function ConnectionAnchorBase() {
    if (typeof ConnectionAnchorBase._initialized == "undefined") {
        function a() {
            ConnectionAnchorBase.prototype.addAnchorListener = function(b) {
                this.listeners.push(b)
            }
            ;
            ConnectionAnchorBase.prototype.removeAnchorListener = function(b) {
                Util.Array.removeItem(this.listeners, b)
            }
            ;
            ConnectionAnchorBase.prototype.fireAnchorMoved = function() {
                for (var b = 0; b < this.listeners.length; b++) {
                    this.listeners[b].anchorMoved(this)
                }
            }
            ;
            ConnectionAnchorBase.prototype.init = function() {
                this.parentMethod("init");
                this.listeners = []
            }
        }
        ConnectionAnchorBase._initialized = true;
        _classes.defineClass("ConnectionAnchorBase", a)
    }
    this.init()
}
_classes.registerClass("XYAnchor", "ConnectionAnchorBase");
function XYAnchor(a) {
    if (typeof XYAnchor._initialized == "undefined") {
        function b() {
            XYAnchor.prototype.getLocation = function(c) {
                return this.location
            }
            ;
            XYAnchor.prototype.getOwner = function() {
                return null 
            }
            ;
            XYAnchor.prototype.getReferencePoint = function() {
                return this.location
            }
            ;
            XYAnchor.prototype.setLocation = function(c) {
                this.location.setLocation(c);
                this.fireAnchorMoved()
            }
            ;
            XYAnchor.prototype.init = function(c) {
                this.parentMethod("init");
                this.location = new Point(c)
            }
        }
        XYAnchor._initialized = true;
        _classes.defineClass("XYAnchor", b)
    }
    this.init(a)
}
_classes.registerClass("AbstractConnectionAnchor", "ConnectionAnchorBase");
function AbstractConnectionAnchor(a) {
    if (typeof AbstractConnectionAnchor._initialized == "undefined") {
        function b() {
            AbstractConnectionAnchor.prototype.addAnchorListener = function(c) {
                if (c == null ) {
                    return
                }
                if (this.listeners.length == 0) {
                    this.getOwner().addAncestorListener(this)
                }
                this.parentMethod("addAnchorListener", c)
            }
            ;
            AbstractConnectionAnchor.prototype.ancestorMoved = function(c) {
                this.fireAnchorMoved()
            }
            ;
            AbstractConnectionAnchor.prototype.ancestorAdded = function(c) {}
            ;
            AbstractConnectionAnchor.prototype.ancestorRemoved = function(c) {}
            ;
            AbstractConnectionAnchor.prototype.getOwner = function() {
                return this.owner
            }
            ;
            AbstractConnectionAnchor.prototype.getReferencePoint = function() {
                if (this.getOwner() == null ) {
                    return
                } else {
                    var c = this.getOwner().getBounds().getCenter();
                    this.getOwner().translateToAbsolute(c);
                    return c
                }
            }
            ;
            AbstractConnectionAnchor.prototype.removeAnchorListener = function(c) {
                this.parentMethod("removeAnchorListener", c);
                if (this.listeners.length == 0) {
                    this.getOwner().removeAncestorListener(this)
                }
            }
            ;
            AbstractConnectionAnchor.prototype.setOwner = function(c) {
                this.owner = c
            }
            ;
            AbstractConnectionAnchor.prototype.init = function(c) {
                this.parentMethod("init");
                this.setOwner(c)
            }
        }
        AbstractConnectionAnchor._initialized = true;
        _classes.defineClass("AbstractConnectionAnchor", b)
    }
    this.init(a)
}
_classes.registerClass("BottomAnchor", "AbstractConnectionAnchor");
function BottomAnchor(a, b) {
    if (typeof BottomAnchor._initialized == "undefined") {
        function c() {
            BottomAnchor.prototype.getLocation = function(d) {
                var g = this.getOwner().getBounds().getCopy();
                this.getOwner().translateToAbsolute(g);
                var h = this.offset;
                if (h == -1) {
                    h = g.width / 2
                }
                if (g.contains(d) || g.bottom() > d.y) {
                    return g.getTopLeft().translate(h, 0)
                } else {
                    return g.getBottomLeft().translate(h, -1)
                }
            }
            ;
            BottomAnchor.prototype.init = function(d, g) {
                this.parentMethod("init", d);
                this.offset = g
            }
        }
        BottomAnchor._initialized = true;
        _classes.defineClass("BottomAnchor", c)
    }
    this.init(a, b)
}
_classes.registerClass("TopAnchor", "AbstractConnectionAnchor");
function TopAnchor(a, b) {
    if (typeof TopAnchor._initialized == "undefined") {
        function c() {
            TopAnchor.prototype.getLocation = function(d) {
                var g = this.getOwner().getBounds().getCopy();
                this.getOwner().translateToAbsolute(g);
                var h = this.offset;
                if (h == -1) {
                    h = g.width / 2
                }
                if (g.contains(d) || g.y < d.y) {
                    return g.getBottomLeft().translate(h, -1)
                } else {
                    return g.getTopLeft().translate(h, 0)
                }
            }
            ;
            TopAnchor.prototype.init = function(d, g) {
                this.parentMethod("init", d);
                this.offset = g
            }
        }
        TopAnchor._initialized = true;
        _classes.defineClass("TopAnchor", c)
    }
    this.init(a, b)
}
_classes.registerClass("EllipseAnchor", "AbstractConnectionAnchor");
function EllipseAnchor(a) {
    if (typeof EllipseAnchor._initialized == "undefined") {
        function b() {
            EllipseAnchor.prototype.getLocation = function(c) {
                var m = Rectangle.SINGLETON;
                m.setBounds(this.getOwner().getBounds());
                m.translate(-1, -1);
                m.resize(1, 1);
                this.getOwner().translateToAbsolute(m);
                var l = m.getCenter().negate().translate(c);
                if (l.x == 0) {
                    return new Point(c.x,(l.y > 0) ? m.bottom() : m.y)
                }
                if (l.y == 0) {
                    return new Point((l.x > 0) ? m.right() : m.x,c.y)
                }
                var h = (l.x > 0) ? 0.5 : -0.5;
                var d = (l.y > 0) ? 0.5 : -0.5;
                var g = (l.y * m.width) / (l.x * m.height);
                g = g * g;
                return m.getCenter().translate(m.width * h / Math.sqrt(1 + g), m.height * d / Math.sqrt(1 + 1 / g))
            }
            ;
            EllipseAnchor.prototype.init = function(c) {
                this.parentMethod("init", c)
            }
        }
        EllipseAnchor._initialized = true;
        _classes.defineClass("EllipseAnchor", b)
    }
    this.init(a)
}
_classes.registerClass("ChopboxAnchor", "AbstractConnectionAnchor");
function ChopboxAnchor(a) {
    if (typeof ChopboxAnchor._initialized == "undefined") {
        function b() {
            ChopboxAnchor.prototype.getLocation = function(c) {
                var h = Rectangle.SINGLETON;
                h.setBounds(this.getBox());
                h.translate(-1, -1);
                h.resize(1, 1);
                this.getOwner().translateToAbsolute(h);
                var m = h.x + 0.5 * h.width;
                var l = h.y + 0.5 * h.height;
                if (h.isEmpty() || (c.x == Math.floor(m) && c.y == Math.floor(l))) {
                    return new Point(Math.floor(m),Math.floor(l))
                }
                var g = c.x - m;
                var d = c.y - l;
                var n = 0.5 / Math.max(Math.abs(g) / h.width, Math.abs(d) / h.height);
                g *= n;
                d *= n;
                m += g;
                l += d;
                return new Point(Math.round(m),Math.round(l))
            }
            ;
            ChopboxAnchor.prototype.getBox = function() {
                return this.getOwner().getBounds()
            }
            ;
            ChopboxAnchor.prototype.getReferencePoint = function() {
                var c = this.getBox().getCenter();
                this.getOwner().translateToAbsolute(c);
                return c
            }
            ;
            ChopboxAnchor.prototype.equals = function(d) {
                if (d == null ) {
                    return false
                }
                if (Util.isInstanceOf(d, ChopboxAnchor)) {
                    var c = d;
                    return c.getOwner() == this.getOwner() && c.getBox().equals(this.getBox())
                }
                return false
            }
            ;
            ChopboxAnchor.prototype.init = function(c) {
                this.parentMethod("init", c)
            }
        }
        ChopboxAnchor._initialized = true;
        _classes.defineClass("ChopboxAnchor", b)
    }
    this.init(a)
}
_classes.registerClass("LabelAnchor", "ChopboxAnchor");
function LabelAnchor(a) {
    if (typeof LabelAnchor._initialized == "undefined") {
        function b() {
            LabelAnchor.prototype.getBox = function() {
                return this.getOwner().getIconBounds()
            }
            ;
            LabelAnchor.prototype.init = function(c) {
                this.parentMethod("init", c)
            }
        }
        LabelAnchor._initialized = true;
        _classes.defineClass("LabelAnchor", b)
    }
    this.init(a)
}
_classes.registerClass("RoutingNotifier");
function RoutingNotifier(d, a, b) {
    if (typeof RoutingNotifier._initialized == "undefined") {
        function c() {
            RoutingNotifier.prototype.getConstraint = function(g) {
                return this.realRouter.getConstraint(g)
            }
            ;
            RoutingNotifier.prototype.invalidate = function(g) {
                for (var h = 0; h < this.listeners.length; h++) {
                    this.listeners[h].invalidate(g)
                }
                this.realRouter.invalidate(g)
            }
            ;
            RoutingNotifier.prototype.route = function(g) {
                var l = false;
                for (var h = 0; h < this.listeners.length; h++) {
                    l |= this.listeners[h].route(g)
                }
                if (!l) {
                    this.realRouter.route(g)
                }
                for (var h = 0; h < this.listeners.length; h++) {
                    this.listeners[h].postRoute(g)
                }
            }
            ;
            RoutingNotifier.prototype.remove = function(g) {
                for (var h = 0; h < this.listeners.length; h++) {
                    this.listeners[h].remove(g)
                }
                this.realRouter.remove(g)
            }
            ;
            RoutingNotifier.prototype.setConstraint = function(g, l) {
                for (var h = 0; h < this.listeners.length; h++) {
                    this.listeners[h].setConstraint(g, l)
                }
                this.realRouter.setConstraint(g, l)
            }
            ;
            RoutingNotifier.prototype.init = function(l, g, h) {
                this.parentMethod("init", l);
                this.realRouter = g;
                this.listeners = [];
                if (h != null ) {
                    this.listeners.push(h)
                }
            }
        }
        RoutingNotifier._initialized = true;
        _classes.defineClass("RoutingNotifier", c)
    }
    this.init(d, a, b)
}
_classes.registerClass("AbstractRouter");
function AbstractRouter() {
    if (typeof AbstractRouter._initialized == "undefined") {
        function a() {
            AbstractRouter.prototype.getConstraint = function(b) {
                return null 
            }
            ;
            AbstractRouter.prototype.getEndPoint = function(b) {
                var c = b.getSourceAnchor().getReferencePoint();
                return AbstractRouter.END.setLocation(b.getTargetAnchor().getLocation(c))
            }
            ;
            AbstractRouter.prototype.getStartPoint = function(c) {
                var b = c.getTargetAnchor().getReferencePoint();
                return AbstractRouter.START.setLocation(c.getSourceAnchor().getLocation(b))
            }
            ;
            AbstractRouter.prototype.invalidate = function(b) {}
            ;
            AbstractRouter.prototype.remove = function(b) {}
            ;
            AbstractRouter.prototype.setConstraint = function(b, c) {}
            ;
            AbstractRouter.prototype.init = function() {
                this.parentMethod("init")
            }
        }
        AbstractRouter._initialized = true;
        _classes.defineClass("AbstractRouter", a)
    }
    this.init()
}
AbstractRouter.START = new Point(0,0);
AbstractRouter.END = new Point(0,0);
_classes.registerClass("NullConnectionRouter", "AbstractRouter");
function NullConnectionRouter() {
    if (typeof NullConnectionRouter._initialized == "undefined") {
        function a() {
            NullConnectionRouter.prototype.route = function(c) {
                var b = c.getPoints();
                b.removeAllPoints();
                var d;
                d = this.getStartPoint(c);
                c.translateToRelative(d);
                b.addPoint(d);
                d = this.getEndPoint(c);
                c.translateToRelative(d);
                b.addPoint(d);
                c.setPoints(b)
            }
            ;
            NullConnectionRouter.prototype.init = function() {
                this.parentMethod("init")
            }
        }
        NullConnectionRouter._initialized = true;
        _classes.defineClass("NullConnectionRouter", a)
    }
    this.init()
}
AbstractRouter.NULL = new NullConnectionRouter();
_classes.registerClass("BendpointConnectionRouter", "AbstractRouter");
function BendpointConnectionRouter() {
    if (typeof BendpointConnectionRouter._initialized == "undefined") {
        function a() {
            BendpointConnectionRouter.prototype.getConstraint = function(b) {
                return this.constraints.get(b)
            }
            ;
            BendpointConnectionRouter.prototype.remove = function(b) {
                this.constraints.remove(b)
            }
            ;
            BendpointConnectionRouter.prototype.route = function(m) {
                var h = m.getPoints();
                h.removeAllPoints();
                var g = this.getConstraint(m);
                if (g == null ) {
                    g = []
                }
                var c, b;
                if (g.length == 0) {
                    c = m.getTargetAnchor().getReferencePoint();
                    b = m.getSourceAnchor().getReferencePoint()
                } else {
                    c = new Point(g[0].getLocation());
                    m.translateToAbsolute(c);
                    b = new Point(g[g.length - 1].getLocation());
                    m.translateToAbsolute(b)
                }
                BendpointConnectionRouter.A_POINT.setLocation(m.getSourceAnchor().getLocation(c));
                m.translateToRelative(BendpointConnectionRouter.A_POINT);
                h.addPoint(BendpointConnectionRouter.A_POINT);
                for (var d = 0; d < g.length; d++) {
                    var l = g[d];
                    h.addPoint(l.getLocation())
                }
                BendpointConnectionRouter.A_POINT.setLocation(m.getTargetAnchor().getLocation(b));
                m.translateToRelative(BendpointConnectionRouter.A_POINT);
                h.addPoint(BendpointConnectionRouter.A_POINT);
                m.setPoints(h)
            }
            ;
            BendpointConnectionRouter.prototype.setConstraint = function(b, c) {
                this.constraints.put(b, c)
            }
            ;
            BendpointConnectionRouter.prototype.init = function() {
                this.parentMethod("init");
                this.constraints = new Map()
            }
        }
        BendpointConnectionRouter._initialized = true;
        _classes.defineClass("BendpointConnectionRouter", a)
    }
    this.init()
}
BendpointConnectionRouter.A_POINT = new Point();
_classes.registerClass("PolylineConnection", "Polyline");
function PolylineConnection(b) {
    if (typeof PolylineConnection._initialized == "undefined") {
        function a() {
            PolylineConnection.prototype.addNotify = function() {
                this.parentMethod("addNotify");
                this.hookSourceAnchor();
                this.hookTargetAnchor()
            }
            ;
            PolylineConnection.prototype.addRoutingListener = function(c) {
                if (this.connectionRouter != null ) {
                    if (Util.isInstanceOf(this.connectionRouter, RoutingNotifier)) {
                        this.connectionRouter.listeners.push(c)
                    } else {
                        this.connectionRouter = new RoutingNotifier(this.connectionRouter,c)
                    }
                }
            }
            ;
            PolylineConnection.prototype.anchorMoved = function(c) {
                this.revalidate()
            }
            ;
            PolylineConnection.prototype.getBounds = function() {
                if (this.bounds == null ) {
                    this.isa = "PolylineConnection";
                    this.parentMethod("getBounds");
                    for (var c = 0; c < this.children.length; c++) {
                        var d = this.children[c];
                        this.bounds.union(d.getBounds())
                    }
                }
                return this.bounds
            }
            ;
            PolylineConnection.prototype.getConnectionRouter = function() {
                if (this.connectionRouter != null ) {
                    if (Util.isInstanceOf(this.connectionRouter, RoutingNotifier)) {
                        return this.connectionRouter.realRouter
                    }
                    return this.connectionRouter
                }
            }
            ;
            PolylineConnection.prototype.getRoutingConstraint = function() {
                if (this.getConnectionRouter() != null ) {
                    return this.getConnectionRouter().getConstraint(this)
                } else {
                    return null 
                }
            }
            ;
            PolylineConnection.prototype.getSourceAnchor = function() {
                return this.startAnchor
            }
            ;
            PolylineConnection.prototype.getSourceDecoration = function() {
                return this.startArrow
            }
            ;
            PolylineConnection.prototype.getTargetAnchor = function() {
                return this.endAnchor
            }
            ;
            PolylineConnection.prototype.getTargetDecoration = function() {
                return this.endArrow
            }
            ;
            PolylineConnection.prototype.hookSourceAnchor = function() {
                if (this.getSourceAnchor() != null ) {
                    this.getSourceAnchor().addAnchorListener(this)
                }
            }
            ;
            PolylineConnection.prototype.hookTargetAnchor = function() {
                if (this.getTargetAnchor() != null ) {
                    this.getTargetAnchor().addAnchorListener(this)
                }
            }
            ;
            PolylineConnection.prototype.layout = function() {
                if (this.getSourceAnchor() != null  && this.getTargetAnchor() != null ) {
                    this.connectionRouter.route(this)
                }
                var c = this.bounds;
                this.parentMethod("layout");
                this.bounds = null ;
                if (!this.getBounds().contains(c)) {
                    if (c != null ) {
                        this.getParent().translateToParent(c);
                        this.getUpdateManager().addDirtyRegion(this.getParent(), c)
                    }
                }
                this.repaint();
                this.fireFigureMoved()
            }
            ;
            PolylineConnection.prototype.removeNotify = function() {
                this.unhookSourceAnchor();
                this.unhookTargetAnchor();
                this.connectionRouter.remove(this);
                this.parentMethod("removeNotify")
            }
            ;
            PolylineConnection.prototype.removeRoutingListener = function(c) {
                if (this.connectionRouter != null ) {
                    if (Util.isInstanceOf(this.connectionRouter, RoutingNotifier)) {
                        this.connectionRouter.listeners.remove(c);
                        if (this.connectionRouter.listeners.length == 0) {
                            this.connectionRouter = this.connectionRouter.realRouter
                        }
                    }
                }
            }
            ;
            PolylineConnection.prototype.revalidate = function() {
                this.parentMethod("revalidate");
                this.connectionRouter.invalidate(this)
            }
            ;
            PolylineConnection.prototype.setConnectionRouter = function(d) {
                if (d == null ) {
                    d = AbstractRouter.NULL
                }
                var c = this.getConnectionRouter();
                if (c != d) {
                    this.connectionRouter.remove(this);
                    if (this.connectionRouter != null  && Util.isInstanceOf(this.connectionRouter, RoutingNotifier)) {
                        this.connectionRouter.realRouter = d
                    } else {
                        this.connectionRouter = d
                    }
                    this.firePropertyChange(Connection.PROPERTY_CONNECTION_ROUTER, c, d);
                    this.revalidate()
                }
            }
            ;
            PolylineConnection.prototype.setRoutingConstraint = function(c) {
                if (this.connectionRouter != null ) {
                    this.connectionRouter.setConstraint(this, c)
                }
                this.revalidate()
            }
            ;
            PolylineConnection.prototype.setSourceAnchor = function(c) {
                if (c == this.startAnchor) {
                    return
                }
                this.unhookSourceAnchor();
                this.startAnchor = c;
                if (this.getParent() != null ) {
                    this.hookSourceAnchor()
                }
                this.revalidate()
            }
            ;
            PolylineConnection.prototype.setSourceDecoration = function(c) {
                if (this.startArrow == c) {
                    return
                }
                if (this.startArrow != null ) {
                    this.remove(this.startArrow)
                }
                this.startArrow = c;
                if (this.startArrow != null ) {
                    this.add(this.startArrow, new ArrowLocator(this,ConnectionLocator.SOURCE))
                }
            }
            ;
            PolylineConnection.prototype.setTargetAnchor = function(c) {
                if (c == this.endAnchor) {
                    return
                }
                this.unhookTargetAnchor();
                this.endAnchor = c;
                if (this.getParent() != null ) {
                    this.hookTargetAnchor()
                }
                this.revalidate()
            }
            ;
            PolylineConnection.prototype.setTargetDecoration = function(c) {
                if (this.endArrow == c) {
                    return
                }
                if (this.endArrow != null ) {
                    this.remove(this.endArrow)
                }
                this.endArrow = c;
                if (this.endArrow != null ) {
                    this.add(this.endArrow, new ArrowLocator(this,ConnectionLocator.TARGET))
                }
            }
            ;
            PolylineConnection.prototype.unhookSourceAnchor = function() {
                if (this.getSourceAnchor() != null ) {
                    this.getSourceAnchor().removeAnchorListener(this)
                }
            }
            ;
            PolylineConnection.prototype.unhookTargetAnchor = function() {
                if (this.getTargetAnchor() != null ) {
                    this.getTargetAnchor().removeAnchorListener(this)
                }
            }
            ;
            PolylineConnection.prototype.init = function(c) {
                this.parentMethod("init", c);
                this.startAnchor = null ;
                this.endAnchor = null ;
                this.connectionRouter = AbstractRouter.NULL;
                this.startArrow = null ;
                this.endArrow = null ;
                this.setLayoutManager(new DelegatingLayout());
                this.addPoint(new Point(0,0));
                this.addPoint(new Point(100,100))
            }
        }
        PolylineConnection._initialized = true;
        _classes.defineClass("PolylineConnection", a)
    }
    this.init(b)
}
_classes.registerClass("TextUtilities");
function TextUtilities() {
    if (typeof TextUtilities._initialized == "undefined") {
        function a() {
            TextUtilities.prototype.getTextExtents = function(b, g) {
                var c = FigureUtilities.getTextExtents(b, g);
                if (c.height == null ) {
                    var d = this.getFontSize(g);
                    c.height = d
                }
                return c
            }
            ;
            TextUtilities.prototype.getAscent = function(b) {
                Debugger.log("TextUtilities -getAscent- TODO")
            }
            ;
            TextUtilities.prototype.getAverageCharWidth = function(d) {
                var c = "text";
                var b = this.getTextExtents(c, d).width;
                return b / 4
            }
            ;
            TextUtilities.prototype.getDescent = function(b) {
                Debugger.log("TextUtilities -getDescent- TODO")
            }
            ;
            TextUtilities.prototype.getFontSize = function(c) {
                if (c == null ) {
                    c = "12px sans-serif"
                }
                var b = new String(new RegExp("(?:\\d+|\\d+\\.\\d+)px").exec(c));
                var d = new Number(b.substring(0, b.length - 2));
                return d
            }
            ;
            TextUtilities.prototype.getLargestSubstringConfinedTo = function(p, h, n) {
                var d = new String(p);
                var l = FigureUtilities.getFontMetrics(h);
                var b;
                var m;
                var g = this.getAverageCharWidth(h);
                b = 0;
                m = d.length + 1;
                var c = 0;
                var o = 0;
                while ((m - b) > 1) {
                    c = c + Math.floor((n - o) / g);
                    if (c >= m) {
                        c = m - 1
                    }
                    if (c <= b) {
                        c = b + 1
                    }
                    o = this.getTextExtents(d.substring(0, c), h).width;
                    if (o < n) {
                        b = c
                    } else {
                        m = c
                    }
                }
                return b
            }
            ;
            TextUtilities.prototype.init = function() {}
        }
        TextUtilities._initialized = true;
        _classes.defineClass("TextUtilities", a)
    }
    this.init()
}
TextUtilities.INSTANCE = new TextUtilities();
_classes.registerClass("LineAttributes");
function LineAttributes(d, a, c, g, b) {
    if (typeof LineAttributes._initialized == "undefined") {
        function h() {
            LineAttributes.prototype.init = function(o, l, n, p, m) {
                this.lineWidth = 1;
                this.miterLimit = 10;
                this.lineCap = "butt";
                this.lineJoin = "miter";
                this.lineColor = new Color(0,0,0);
                if (o != null  && o > 0) {
                    this.lineWidth = o
                }
                if (l != null  && l > 0) {
                    this.miterLimit = this.miterLimit
                }
                if (n != null ) {
                    this.lineCap = n
                }
                if (p != null ) {
                    this.lineJoin = p
                }
                if (m != null ) {
                    this.lineColor = m
                }
            }
        }
        LineAttributes._initialized = true;
        _classes.defineClass("LineAttributes", h)
    }
    this.init(d, a, c, g, b)
}
var showPerformUpdateTime = false;
var DEBUG_DRAWDAMAGE = false;
var DEBUG_SHOWDAMAGE = false;
_classes.registerClass("UpdateManager");
function UpdateManager() {
    if (typeof UpdateManager._initialized == "undefined") {
        function a() {
            UpdateManager.prototype.addDirtyRegion = function(g, d, c, b, h) {}
            ;
            UpdateManager.prototype.addInvalidFigure = function(b) {}
            ;
            UpdateManager.prototype.performUpdate = function() {}
            ;
            UpdateManager.prototype.setRoot = function(b) {}
            ;
            UpdateManager.prototype.setGraphicsSource = function(b) {}
            ;
            UpdateManager.prototype.init = function() {}
        }
        UpdateManager._initialized = true;
        _classes.defineClass("UpdateManager", a)
    }
    this.init()
}
_classes.registerClass("DeferredUpdateManager", "UpdateManager");
function DeferredUpdateManager() {
    if (typeof DeferredUpdateManager._initialized == "undefined") {
        function a() {
            DeferredUpdateManager.prototype.addDirtyRegion = function(h, g, d, c, n) {
                var b;
                var l;
                if (h == null  || g == null ) {
                    return
                }
                if (Util.isInstanceOf(g, Rectangle)) {
                    b = h;
                    l = g
                } else {
                    if (arguments.length == 5) {
                        b = arguments[0];
                        l = new Rectangle(arguments[1],arguments[2],arguments[3],arguments[4])
                    }
                }
                if (l.isEmpty()) {
                    return
                }
                var m = this.dirtyRegions.get(b);
                if (!m) {
                    this.dirtyRegions.put(b, l)
                } else {
                    m.union(l)
                }
                this.fireAddDirty();
                this.queueWork()
            }
            ;
            DeferredUpdateManager.prototype.addInvalidFigure = function(b) {
                if (Util.Array.contains(this.invalidFigures, b)) {
                    return
                }
                this.queueWork();
                this.invalidFigures.push(b)
            }
            ;
            DeferredUpdateManager.prototype.fireAddDirty = function() {
                if (this.dirtyListener != null ) {
                    this.dirtyListener()
                }
            }
            ;
            DeferredUpdateManager.prototype.queueWork = function() {
                var b = this;
                if (!this.updateTimeout) {
                    this.updateTimeout = setTimeout(function() {
                        b.performUpdate();
                        b.updateTimeout = null 
                    }, 0)
                }
            }
            ;
            DeferredUpdateManager.prototype.setDirtyListener = function(b) {
                this.dirtyListener = b
            }
            ;
            DeferredUpdateManager.prototype.removeDirtyListener = function() {
                this.dirtyListener = null 
            }
            ;
            DeferredUpdateManager.prototype.fireValidating = function() {}
            ;
            DeferredUpdateManager.prototype.getGraphics = function(b) {
                if (this.graphicsSource) {
                    return this.graphicsSource.getGraphics(b)
                }
            }
            ;
            DeferredUpdateManager.prototype.releaseGraphics = function(b) {
                this.graphicsSource.flushGraphics(this.damage)
            }
            ;
            DeferredUpdateManager.prototype.repairDamage = function() {
                var c = this.dirtyRegions.map;
                if (c.length == 0) {
                    return
                }
                var o = this.dirtyRegions.keySetIterator();
                var h;
                var m;
                var b;
                while (o.hasNext()) {
                    m = o.next();
                    b = m.getParent();
                    h = this.dirtyRegions.get(m);
                    h.intersect(m.getBounds());
                    while (!h.isEmpty() && b) {
                        b.translateToParent(h);
                        h.intersect(b.getBounds());
                        b = b.getParent()
                    }
                    if (!this.damage) {
                        this.damage = new Rectangle(h)
                    } else {
                        this.damage.union(h)
                    }
                }
                if (!this.dirtyRegions.isEmpty()) {
                    var g = this.dirtyRegions;
                    this.dirtyRegions = new Map()
                }
                if (this.damage && !this.damage.isEmpty()) {
                    try {
                        var n = this.getGraphics(this.damage)
                    } catch (l) {
                        if (console && console.error) {
                            console.error(l)
                        }
                    }
                    if (n) {
                        try {
                            var d = n.getClip(new Rectangle(0,0,0,0));
                            this.root.paint(n)
                        } catch (l) {
                            if (console && console.error) {
                                console.error(l)
                            }
                        }
                        try {
                            this.releaseGraphics(n)
                        } catch (l) {
                            if (console && console.error) {
                                console.error(l)
                            }
                        }
                    }
                    if (DEBUG_SHOWDAMAGE) {
                        this.graphicsSource.control.context.clearRect(0, 0, 200, 50);
                        this.graphicsSource.control.context.fillText("damage:[" + this.damage.x + "," + this.damage.y + "," + this.damage.width + "," + this.damage.height + "]", 0, 22);
                        if (d != null ) {
                            this.graphicsSource.control.context.fillText("clip:[" + d.x + "," + d.y + "," + d.width + "," + d.height + "]", 0, 40)
                        }
                    }
                    if (DEBUG_DRAWDAMAGE) {
                        this.graphicsSource.control.context.beginPath();
                        this.graphicsSource.control.context.rect(this.damage.x, this.damage.y, this.damage.width, this.damage.height);
                        this.graphicsSource.control.context.stroke()
                    }
                }
                this.damage = null 
            }
            ;
            DeferredUpdateManager.prototype.setGraphicsSource = function(b) {
                this.graphicsSource = b
            }
            ;
            DeferredUpdateManager.prototype.setRoot = function(b) {
                this.root = b
            }
            ;
            DeferredUpdateManager.prototype.paint = function(b) {
                this.root.invalidateTree();
                this.root.validate();
                this.root.repaint();
                this.performUpdate()
            }
            ;
            DeferredUpdateManager.prototype.performUpdate = function() {
                var b;
                if (showPerformUpdateTime) {
                    b = new Date().getTime()
                }
                if (this.disposed || this.updating) {
                    return
                }
                this.performValidation();
                this.updating = true;
                this.repairDamage();
                this.updating = false;
                if (showPerformUpdateTime) {
                    var c = new Date().getTime();
                    Debugger.log("performUpdate: " + (c - b) + "ms")
                }
            }
            ;
            DeferredUpdateManager.prototype.performValidation = function() {
                if (this.invalidFigures.length == 0 || this.validating) {
                    return
                }
                this.validating = true;
                this.fireValidating();
                var b;
                while (this.invalidFigures.length > 0) {
                    b = this.invalidFigures.shift();
                    b.validate()
                }
                this.validating = false
            }
            ;
            DeferredUpdateManager.prototype.dispose = function() {
                if (this.disposed) {
                    return
                }
                this.disposed = true;
                if (this.invalidFigures) {
                    for (var b = 0; b < this.invalidFigures.length; b++) {
                        this.invalidFigures[b] = null 
                    }
                    this.invalidFigures = null 
                }
                if (this.root && this.root.dispose) {
                    this.root.dispose()
                }
                this.root = null ;
                if (this.graphicsSource && this.graphicsSource.dispose) {
                    this.graphicsSource.dispose()
                }
                this.graphicsSource = null 
            }
            ;
            DeferredUpdateManager.prototype.init = function() {
                this.parentMethod("init");
                this.dirtyRegions = new Map();
                this.updateQueued;
                this.invalidFigures = [];
                this.disposed = false
            }
        }
        DeferredUpdateManager._initialized = true;
        _classes.defineClass("DeferredUpdateManager", a)
    }
    this.init()
}
_classes.registerClass("EventListenerList");
function EventListenerList() {
    if (typeof EventListenerList._initialized == "undefined") {
        function a() {
            EventListenerList.prototype.addListener = function(b, c) {
                if (!(this.array && c)) {
                    throw ("EventListener-addListener-IllegalArgumentException");
                    return
                }
                this.array.push(b);
                this.array.push(c)
            }
            ;
            EventListenerList.prototype.containsListener = function(c) {
                var b;
                for (b = 0; b < this.array.length; b += 2) {
                    if (this.array[b] == c) {
                        return true
                    }
                }
                return false
            }
            ;
            EventListenerList.prototype.getListeners = function(b) {
                return new TypeIterator(this.array,b)
            }
            ;
            EventListenerList.prototype.removeListener = function(c, d) {
                if (this.array.length == 0) {
                    return
                }
                if (!(c && d)) {
                    throw ("EventListenerList-removeListener-IllegalArgumentException");
                    return
                }
                var b;
                for (b = 0; b < this.array.length; b += 2) {
                    if (this.array[b] == c && this.array[b + 1] == d) {
                        break
                    }
                }
                if (b == this.array.length) {
                    return
                }
                this.array.splice(b, 2)
            }
            ;
            EventListenerList.prototype.init = function() {
                this.array = []
            }
        }
        EventListenerList._initialized = true;
        _classes.defineClass("EventListenerList", a)
    }
    this.init()
}
_classes.registerClass("TypeIterator");
function TypeIterator(a, b) {
    if (typeof TypeIterator._initialized == "undefined") {
        function c() {
            TypeIterator.prototype.next = function() {
                var d = this._items[this._index + 1];
                this._index += 2;
                return d
            }
            ;
            TypeIterator.prototype.hasNext = function() {
                if (!this._items) {
                    return false
                }
                while (this._index < this._items.length && (this._items[this._index] != this._type)) {
                    this._index += 2
                }
                return this._index < this._items.length
            }
            ;
            TypeIterator.prototype.init = function(d, g) {
                this._items = d;
                this._type = g;
                this._index = 0
            }
        }
        TypeIterator._initialized = true;
        _classes.defineClass("TypeIterator", c)
    }
    this.init(a, b)
}
_classes.registerClass("EMPTY_IERATOR");
function EMPTY_IERATOR() {
    if (typeof EMPTY_IERATOR._initialized == "undefined") {
        function a() {
            EMPTY_IERATOR.prototype.next = function() {
                return null 
            }
            ;
            EMPTY_IERATOR.prototype.hasNext = function() {
                return false
            }
            ;
            EMPTY_IERATOR.prototype.init = function() {}
        }
        EMPTY_IERATOR._initialized = true;
        _classes.defineClass("EMPTY_IERATOR", a)
    }
    this.init()
}
_classes.registerClass("AncestorHelper");
function AncestorHelper(a) {
    if (typeof AncestorHelper._initialized == "undefined") {
        function b() {
            AncestorHelper.prototype.addAncestorListener = function(c) {
                if (this.listeners == null ) {
                    this.listeners = [];
                    this.listeners.push(c)
                } else {
                    this.listeners.push(c)
                }
            }
            ;
            AncestorHelper.prototype.addAncestors = function(d) {
                for (var c = d; c != null ; c = c.getParent()) {
                    c.addFigureListener(this);
                    c.addPropertyChangeListener("parent", this)
                }
            }
            ;
            AncestorHelper.prototype.dispose = function() {
                this.removeAncestors(this.base);
                this.listeners = null 
            }
            ;
            AncestorHelper.prototype.figureMoved = function(c) {
                this.fireAncestorMoved(c)
            }
            ;
            AncestorHelper.prototype.fireAncestorMoved = function(d) {
                if (this.listeners == null ) {
                    return
                }
                for (var c = 0; c < this.listeners.length; c++) {
                    this.listeners[c].ancestorMoved(d)
                }
            }
            ;
            AncestorHelper.prototype.fireAncestorAdded = function(d) {
                if (this.listeners == null ) {
                    return
                }
                for (var c = 0; c < this.listeners.length; c++) {
                    this.listeners[c].ancestorAdded(d)
                }
            }
            ;
            AncestorHelper.prototype.fireAncestorRemoved = function(d) {
                if (this.listeners == null ) {
                    return
                }
                for (var c = 0; c < this.listeners.length; c++) {
                    this.listeners[c].ancestorRemoved(d)
                }
            }
            ;
            AncestorHelper.prototype.isEmpty = function() {
                return this.listeners == null 
            }
            ;
            AncestorHelper.prototype.propertyChange = function(g) {
                if (g.getPropertyName() == "parent") {
                    var c = g.getOldValue();
                    var d = g.getNewValue();
                    if (c != null ) {
                        this.removeAncestors(c);
                        this.fireAncestorRemoved(c)
                    }
                    if (d != null ) {
                        this.addAncestors(d);
                        this.fireAncestorAdded(d)
                    }
                }
            }
            ;
            AncestorHelper.prototype.removeAncestorListener = function(d) {
                if (this.listeners == null ) {
                    return
                }
                for (var c = 0; c < this.listeners.length; c++) {
                    if (this.listeners[c] == d) {
                        this.listeners.splice(c, 1);
                        return
                    }
                }
            }
            ;
            AncestorHelper.prototype.removeAncestors = function(d) {
                for (var c = d; c != null ; c = c.getParent()) {
                    c.removeFigureListener(this);
                    c.removePropertyChangeListener("parent", this)
                }
            }
            ;
            AncestorHelper.prototype.init = function(c) {
                this.base = c;
                this.listeners = [];
                this.addAncestors(c)
            }
        }
        AncestorHelper._initialized = true;
        _classes.defineClass("AncestorHelper", b)
    }
    this.init(a)
}
_classes.registerClass("Html5GraphicsSource");
function Html5GraphicsSource(a) {
    if (typeof Html5GraphicsSource._initialized == "undefined") {
        function b() {
            Html5GraphicsSource.prototype.flushGraphics = function() {
                this.graphics.dispose()
            }
            ;
            Html5GraphicsSource.prototype.getGraphics = function(c) {
                if (!this.control) {
                    return
                }
                var d = this.control.getSize();
                this.inUse = new Rectangle(0,0,d.width,d.height);
                this.inUse.intersect(c);
                if (this.inUse.isEmpty()) {
                    return null 
                }
                this.control.context.clearRect(this.inUse.x, this.inUse.y, this.inUse.width, this.inUse.height);
                this.graphics = new Html5Graphics(this.control.context,new Rectangle(this.inUse.x,this.inUse.y,this.inUse.width,this.inUse.height));
                return this.graphics
            }
            ;
            Html5GraphicsSource.prototype.init = function(c) {
                this.control = c
            }
        }
        Html5GraphicsSource._initialized = true;
        _classes.defineClass("Html5GraphicsSource", b)
    }
    this.init(a)
}
_classes.registerClass("LightweightSystem");
function LightweightSystem(a) {
    if (typeof LightweightSystem._initialized == "undefined") {
        function b() {
            LightweightSystem.prototype.addListeners = function() {
                this.canvas.addControllListener(this);
                this.canvas.addMouseListener(this.handler);
                if (this.canvas.addTouchListener) {
                    this.canvas.addTouchListener(this.handler)
                }
                this.canvas.addKeyListener(this.handler)
            }
            ;
            LightweightSystem.prototype.controlResized = function() {
                var c = this.canvas.getClientArea();
                c.setLocation(0, 0);
                this.root.setBounds(c);
                this.root.revalidate();
                this.manager.performUpdate()
            }
            ;
            LightweightSystem.prototype.createRootFigure = function() {
                var c = new RootFigure(this);
                c.addNotify();
                c.setOpaque(true);
                c.setLayoutManager(new StackLayout());
                return c
            }
            ;
            LightweightSystem.prototype.getEventDispatcher = function() {
                if (this.dispatcher == null ) {
                    this.setEventDispatcher(new Html5EventDispatcher())
                }
                return this.dispatcher
            }
            ;
            LightweightSystem.prototype.getUpdateManager = function() {
                return this.manager
            }
            ;
            LightweightSystem.prototype.paint = function() {
                this.manager.paint(this.canvas)
            }
            ;
            LightweightSystem.prototype.performUpdate = function() {
                this.manager.performUpdate()
            }
            ;
            LightweightSystem.prototype.setControl = function(c) {
                this.canvas = c;
                this.manager.setGraphicsSource(this.createGraphicsSource(this.canvas));
                this.getEventDispatcher().setControl(c);
                this.addListeners();
                var d = new Rectangle(c.getClientArea());
                d.setLocation(0, 0);
                this.root.setBounds(d);
                this.root.revalidate()
            }
            ;
            LightweightSystem.prototype.setContents = function(c) {
                if (this.contents) {
                    this.root.remove(this.contents)
                }
                this.contents = c;
                this.root.add(this.contents)
            }
            ;
            LightweightSystem.prototype.setEventDispatcher = function(c) {
                this.dispatcher = c;
                this.dispatcher.setRoot(this.root);
                this.dispatcher.setControl(this.canvas)
            }
            ;
            LightweightSystem.prototype.setRootPaneFigure = function(c) {
                this.manager.setRoot(c);
                this.root = c
            }
            ;
            LightweightSystem.prototype.getRootFigure = function() {
                return this.root
            }
            ;
            LightweightSystem.prototype.createUpdateManager = function() {
                return new DeferredUpdateManager()
            }
            ;
            LightweightSystem.prototype.createGraphicsSource = function(c) {
                return new Html5GraphicsSource(c)
            }
            ;
            LightweightSystem.prototype.dispose = function() {
                if (this.dispatcher && this.dispatcher.dispose) {
                    this.dispatcher.dispose()
                }
                this.dispatcher = null ;
                if (this.canvas && this.canvas.dispose) {
                    this.canvas.dispose()
                }
                this.canvas = null ;
                if (this.manager && this.manager.dispose) {
                    this.manager.dispose()
                }
                this.manager = null 
            }
            ;
            LightweightSystem.prototype.init = function(c) {
                this.manager = this.createUpdateManager();
                this.ignoreResize = false;
                this.setRootPaneFigure(this.createRootFigure());
                this.handler = new EventHandler(this);
                if (c) {
                    this.setControl(c)
                }
            }
        }
        LightweightSystem._initialized = true;
        _classes.defineClass("LightweightSystem", b)
    }
    this.init(a)
}
_classes.registerClass("EventHandler");
function EventHandler(a) {
    if (typeof EventHandler._initialized == "undefined") {
        function b() {
            EventHandler.prototype.keyPressed = function(c) {
                this.host.getEventDispatcher().dispatchKeyPressed(c)
            }
            ;
            EventHandler.prototype.keyDown = function(c) {
                this.host.getEventDispatcher().dispatchKeyDown(c)
            }
            ;
            EventHandler.prototype.keyReleased = function(c) {
                this.host.getEventDispatcher().dispatchKeyReleased(c)
            }
            ;
            EventHandler.prototype.mouseDoubleClick = function(c) {
                this.host.getEventDispatcher().dispatchMouseDoubleClicked(c)
            }
            ;
            EventHandler.prototype.click = function(c) {
                this.host.getEventDispatcher().dispatchMouseClicked(c)
            }
            ;
            EventHandler.prototype.mouseDown = function(c) {
                this.host.getEventDispatcher().dispatchMousePressed(c)
            }
            ;
            EventHandler.prototype.mouseExit = function(c) {
                this.host.getEventDispatcher().dispatchMouseExited(c)
            }
            ;
            EventHandler.prototype.mouseHover = function(c) {
                this.host.getEventDispatcher().dispatchMouseHover(c)
            }
            ;
            EventHandler.prototype.mouseMove = function(c) {
                this.host.getEventDispatcher().dispatchMouseMoved(c)
            }
            ;
            EventHandler.prototype.mouseUp = function(c) {
                this.host.getEventDispatcher().dispatchMouseReleased(c)
            }
            ;
            EventHandler.prototype.mouseWheel = function(c) {
                this.host.getEventDispatcher().dispatchMouseWheelScrolled(c)
            }
            ;
            EventHandler.prototype.touchStart = function(c) {
                this.host.getEventDispatcher().dispatchTouchStart(c)
            }
            ;
            EventHandler.prototype.touchMove = function(c) {
                this.host.getEventDispatcher().dispatchTouchMove(c)
            }
            ;
            EventHandler.prototype.touchEnd = function(c) {
                this.host.getEventDispatcher().dispatchTouchEnd(c)
            }
            ;
            EventHandler.prototype.init = function(c) {
                this.parentMethod("init");
                this.host = c
            }
        }
        EventHandler._initialized = true;
        _classes.defineClass("EventHandler", b)
    }
    this.init(a)
}
_classes.registerClass("PropertyChangeListenerProxy");
function PropertyChangeListenerProxy(a, b) {
    if (typeof PropertyChangeListenerProxy._initialized == "undefined") {
        function c() {
            PropertyChangeListenerProxy.prototype.getListener = function() {
                return this.listener
            }
            ;
            PropertyChangeListenerProxy.prototype.getPropertyName = function() {
                return this.propertyName
            }
            ;
            PropertyChangeListenerProxy.prototype.propertyChange = function(d) {
                this.getListener().propertyChange(d)
            }
            ;
            PropertyChangeListenerProxy.prototype.init = function(d, g) {
                this.parentMethod("init");
                this.propertyName = d;
                this.listener = g
            }
        }
        PropertyChangeListenerProxy._initialized = true;
        _classes.defineClass("PropertyChangeListenerProxy", c)
    }
    this.init(a, b)
}
_classes.registerClass("PropertyChangeSupport");
function PropertyChangeSupport(a) {
    function b() {
        PropertyChangeSupport.prototype.addPropertyChangeListener = function(g, d) {
            if (g == null ) {
                return
            }
            if (d == null ) {
                if (Util.isInstanceOf(g, PropertyChangeListenerProxy)) {
                    this.addPropertyChangeListener(g.getPropertyName(), g.getListener())
                } else {
                    if (this.listeners == null ) {
                        this.listeners = []
                    }
                    this.listeners.push(g)
                }
            } else {
                var c = g;
                var h = d;
                if (this.children == null ) {
                    this.children = new Map()
                }
                var l = this.children.get(c);
                if (l == null ) {
                    l = new PropertyChangeSupport(this.source);
                    this.children.put(c, l)
                }
                l.addPropertyChangeListener(h)
            }
        }
        ;
        PropertyChangeSupport.prototype.removePropertyChangeListener = function(g, d) {
            if (g == null ) {
                return
            }
            if (d == null ) {
                if (Util.isInstanceOf(g, PropertyChangeListenerProxy)) {
                    this.removePropertyChangeListener(g.getPropertyName(), g.getListener())
                } else {
                    if (this.listeners == null ) {
                        return
                    }
                    Util.Array.removeItem(this.listeners, g)
                }
            } else {
                var c = g;
                var h = d;
                if (this.children == null ) {
                    return
                }
                var l = this.children.get(c);
                if (l == null ) {
                    return
                }
                l.removePropertyChangeListener(h)
            }
        }
        ;
        PropertyChangeSupport.prototype.getPropertyChangeListeners = function(d) {
            var n = null ;
            if (d == null ) {
                if (this.listeners != null ) {
                    n = this.listeners
                } else {
                    n = []
                }
                if (this.children != null ) {
                    var m = this.children.keySetIterator();
                    while (m.hasNext()) {
                        var h = m.next();
                        var o = this.children.get(h);
                        var c = o.getPropertyChangeListeners();
                        for (var g = c.length - 1; g >= 0; g--) {
                            n.push(new PropertyChangeListenerProxy(h,c[g]))
                        }
                    }
                }
            } else {
                n = [];
                if (this.children != null ) {
                    var l = this.children.get(d);
                    if (l != null ) {
                        Util.Array.addAll(n, l.getPropertyChangeListeners())
                    }
                }
            }
            return n
        }
        ;
        PropertyChangeSupport.prototype.firePropertyChange = function(n, m, l) {
            if (arguments.length == 3) {
                var o = n;
                var c = m;
                var d = l;
                if (c != null  && d != null  && c == d) {
                    return
                }
                this.firePropertyChange(new PropertyChangeEvent(this.source,o,c,d))
            } else {
                var p = n;
                var c = p.getOldValue();
                var d = p.getNewValue();
                var o = p.getPropertyName();
                if (c != null  && d != null  && c == d) {
                    return
                }
                if (this.listeners != null ) {
                    for (var h = 0; h < this.listeners.length; h++) {
                        this.listeners[h].propertyChange(p)
                    }
                }
                if (this.children != null  && o != null ) {
                    var g = this.children.get(o);
                    if (g != null ) {
                        g.firePropertyChange(p)
                    }
                }
            }
        }
        ;
        PropertyChangeSupport.prototype.fireIndexedPropertyChange = function(c, g, d, h) {
            if (d == h) {
                return
            }
            this.firePropertyChange(new IndexedPropertyChangeEvent(this.source,c,d,h,g))
        }
        ;
        PropertyChangeSupport.prototype.hasListeners = function(c) {
            if (this.listeners != null  && this.listeners.length != 0) {
                return true
            }
            if (this.children != null  && c != null ) {
                var d = this.children.get(c);
                if (d != null  && d.listeners != null ) {
                    return d.listeners.length > 0
                }
            }
            return false
        }
        ;
        PropertyChangeSupport.prototype.init = function(c) {
            this.parentMethod("init");
            this.listeners;
            this.source = c
        }
    }
    _classes.defineClass("PropertyChangeSupport", b);
    this.init(a)
}
_classes.registerClass("PropertyChangeEvent");
function PropertyChangeEvent(c, a, b, d) {
    if (typeof PropertyChangeEvent._initialized == "undefined") {
        function g() {
            PropertyChangeEvent.prototype.getPropertyName = function() {
                return this.propertyName
            }
            ;
            PropertyChangeEvent.prototype.getNewValue = function() {
                return this.newValue
            }
            ;
            PropertyChangeEvent.prototype.getOldValue = function() {
                return this.oldValue
            }
            ;
            PropertyChangeEvent.prototype.setPropagationId = function(h) {
                this.propagationId = h
            }
            ;
            PropertyChangeEvent.prototype.getPropagationId = function() {
                return this.propagationId
            }
            ;
            PropertyChangeEvent.prototype.getSource = function() {
                return this.source
            }
            ;
            PropertyChangeEvent.prototype.init = function(m, h, l, n) {
                this.parentMethod("init");
                this.source = m;
                this.propertyName = h;
                this.newValue = n;
                this.oldValue = l
            }
        }
        PropertyChangeEvent._initialized = true;
        _classes.defineClass("PropertyChangeEvent", g)
    }
    this.init(c, a, b, d)
}
_classes.registerClass("IndexedPropertyChangeEvent", "PropertyChangeEvent");
function IndexedPropertyChangeEvent(d, a, c, g, b) {
    if (typeof IndexedPropertyChangeEvent._initialized == "undefined") {
        function h() {
            IndexedPropertyChangeEvent.prototype.getIndex = function() {
                return this.index
            }
            ;
            IndexedPropertyChangeEvent.prototype.init = function(o, l, n, p, m) {
                this.parentMethod("init", o, l, n, p);
                this.index = m
            }
        }
        IndexedPropertyChangeEvent._initialized = true;
        _classes.defineClass("IndexedPropertyChangeEvent", h)
    }
    this.init(d, a, c, g, b)
}
_classes.registerClass("Html5EventDispatcher");
function Html5EventDispatcher() {
    function a() {
        Html5EventDispatcher.prototype.dispatchFocusGained = function(c) {
            var b = this.getFocusTraverseManager().getCurrentFocusOwner();
            if (b == null ) {
                b = this.getFocusTraverseManager().getNextFocusableFigure(this.root, this.focusOwner)
            }
            this.setFocus(b)
        }
        ;
        Html5EventDispatcher.prototype.dispatchFocusLost = function(b) {
            this.setFocus(null )
        }
        ;
        Html5EventDispatcher.prototype.dispatchKeyPressed = function(c) {
            if (this.focusOwner != null ) {
                var b = new KeyEvent(this,this.focusOwner,c);
                this.focusOwner.handleKeyPressed(b)
            }
        }
        ;
        Html5EventDispatcher.prototype.dispatchKeyReleased = function(c) {
            if (this.focusOwner != null ) {
                var b = new KeyEvent(this,this.focusOwner,c);
                this.focusOwner.handleKeyReleased(b)
            }
        }
        ;
        Html5EventDispatcher.prototype.dispatchKeyDown = function(c) {
            if (this.focusOwner != null ) {
                var b = new KeyEvent(this,this.focusOwner,c);
                this.focusOwner.handleKeyPressed(b)
            }
        }
        ;
        Html5EventDispatcher.prototype.dispatchMouseWheelScrolled = function(b) {}
        ;
        Html5EventDispatcher.prototype.dispatchKeyTraversed = function(b) {}
        ;
        Html5EventDispatcher.prototype.dispatchMouseHover = function(b) {
            this.receive(b);
            if (this.mouseTarget != null ) {
                this.mouseTarget.handleMouseHover(this.currentEvent)
            }
            if (this.hoverSource != null ) {
                this.toolTipHelper = this.getToolTipHelper();
                var c = this.hoverSource.getToolTip();
                var d = b.getSource();
                var g = d.toDisplay(new Point(b.x,b.y));
                this.toolTipHelper.displayToolTipNear(this.hoverSource, c, g.x, g.y)
            }
        }
        ;
        Html5EventDispatcher.prototype.dispatchMouseDoubleClicked = function(b) {
            this.receive(b);
            if (this.mouseTarget != null ) {
                this.mouseTarget.handleMouseDoubleClicked(this.currentEvent)
            }
        }
        ;
        Html5EventDispatcher.prototype.dispatchMouseClicked = function(b) {
            this.receive(b);
            if (this.mouseTarget != null ) {
                this.mouseTarget.handleMouseClicked(this.currentEvent)
            }
        }
        ;
        Html5EventDispatcher.prototype.dispatchMouseEntered = function(b) {
            this.receive(b)
        }
        ;
        Html5EventDispatcher.prototype.dispatchMouseExited = function(b) {
            this.setHoverSource(null , b);
            if (this.mouseTarget != null ) {
                this.currentEvent = new MouseEvent(b.x,b.y,this,this.mouseTarget,b.button,b.stateMask,b);
                this.mouseTarget.handleMouseExited(this.currentEvent);
                this.releaseCapture();
                this.mouseTarget = null 
            }
        }
        ;
        Html5EventDispatcher.prototype.dispatchMousePressed = function(b) {
            this.receive(b);
            if (this.mouseTarget != null ) {
                this.mouseTarget.handleMousePressed(this.currentEvent);
                if (this.currentEvent.isConsumed()) {
                    this.setCapture(this.mouseTarget)
                }
            }
        }
        ;
        Html5EventDispatcher.prototype.dispatchMouseMoved = function(b) {
            this.receive(b);
            if (this.mouseTarget != null ) {
                if (b.button == Canvas.BUTTON_LEFT) {
                    this.mouseTarget.handleMouseDragged(this.currentEvent)
                } else {
                    this.mouseTarget.handleMouseMoved(this.currentEvent)
                }
            }
        }
        ;
        Html5EventDispatcher.prototype.dispatchMouseReleased = function(b) {
            this.receive(b);
            if (this.mouseTarget != null ) {
                this.mouseTarget.handleMouseReleased(this.currentEvent)
            }
            this.releaseCapture();
            this.receive(b)
        }
        ;
        Html5EventDispatcher.prototype.dispatchTouchStart = function(b) {}
        ;
        Html5EventDispatcher.prototype.dispatchTouchMove = function(b) {}
        ;
        Html5EventDispatcher.prototype.dispatchTouchEnd = function(b) {}
        ;
        Html5EventDispatcher.prototype.getCurrentEvent = function() {
            return this.currentEvent
        }
        ;
        Html5EventDispatcher.prototype.getCurrentToolTip = function() {
            if (this.hoverSource != null ) {
                return this.hoverSource.getToolTip()
            } else {
                return null 
            }
        }
        ;
        Html5EventDispatcher.prototype.getCursorTarget = function() {
            return this.cursorTarget
        }
        ;
        Html5EventDispatcher.prototype.getToolTipHelper = function() {
            if (this.toolTipHelper == null ) {
                this.toolTipHelper = new ToolTipHelper(this.control)
            }
            return this.toolTipHelper
        }
        ;
        Html5EventDispatcher.prototype.getFocusTraverseManager = function() {
            if (this.focusManager == null ) {
                this.focusManager = new FocusTraverseManager()
            }
            return this.focusManager
        }
        ;
        Html5EventDispatcher.prototype.getFocusOwner = function() {
            return this.focusOwner
        }
        ;
        Html5EventDispatcher.prototype.getMouseTarget = function() {
            return this.mouseTarget
        }
        ;
        Html5EventDispatcher.prototype.getRoot = function() {
            return this.root
        }
        ;
        Html5EventDispatcher.prototype.isCaptured = function() {
            return this.captured
        }
        ;
        Html5EventDispatcher.prototype.receive = function(b) {
            this.currentEvent = null ;
            this.updateFigureUnderCursor(b);
            var d = b.stateMask;
            if (this.captured) {
                if (this.mouseTarget != null ) {
                    this.currentEvent = new MouseEvent(b.x,b.y,this,this.mouseTarget,b.button,d,b)
                }
            } else {
                var c = this.mouseTarget;
                c = this.root.findMouseEventTargetAt(b.x, b.y);
                if (c == this.mouseTarget) {
                    if (this.mouseTarget != null ) {
                        this.currentEvent = new MouseEvent(b.x,b.y,this,this.mouseTarget,b.button,d,b)
                    }
                    return
                }
                if (this.mouseTarget != null ) {
                    this.currentEvent = new MouseEvent(b.x,b.y,this,this.mouseTarget,b.button,d,b);
                    this.mouseTarget.handleMouseExited(this.currentEvent)
                }
                this.setMouseTarget(c);
                if (this.mouseTarget != null ) {
                    this.currentEvent = new MouseEvent(b.x,b.y,this,this.mouseTarget,b.button,d,b);
                    this.mouseTarget.handleMouseEntered(this.currentEvent)
                }
            }
        }
        ;
        Html5EventDispatcher.prototype.releaseCapture = function() {
            this.captured = false
        }
        ;
        Html5EventDispatcher.prototype.requestFocus = function(b) {
            this.setFocus(b)
        }
        ;
        Html5EventDispatcher.prototype.requestRemoveFocus = function(b) {
            if (this.getFocusOwner() == b) {
                this.setFocus(null )
            }
            if (this.mouseTarget == b) {
                this.mouseTarget = null 
            }
            if (this.cursorTarget == b) {
                this.cursorTarget = null 
            }
            if (this.hoverSource == b) {
                this.hoverSource = null 
            }
            this.getFocusTraverseManager().setCurrentFocusOwner(null )
        }
        ;
        Html5EventDispatcher.prototype.setCapture = function(b) {
            this.captured = true;
            this.mouseTarget = b
        }
        ;
        Html5EventDispatcher.prototype.setControl = function(d) {
            if (d == this.control) {
                return
            }
            if (this.control != null  && !this.control.isDisposed()) {
                throw ("Html5EventDispatcher--setControl--Can not set control again once it has been set")
            }
            var b = this;
            if (d != null ) {
                d.addDisposeListener({
                    widgetDisposed: function() {
                        if (b.toolTipHelper != null ) {
                            b.toolTipHelper.dispose()
                        }
                    }
                })
            }
            this.control = d
        }
        ;
        Html5EventDispatcher.prototype.setCursor = function(b) {
            if (b == null  && this.cursor == null ) {
                return
            } else {
                if (b != this.cursor) {
                    this.cursor = b;
                    if (this.control != null  && !this.control.isDisposed()) {
                        this.control.setCursor(b)
                    }
                }
            }
        }
        ;
        Html5EventDispatcher.prototype.setEnableKeyTraversal = function(b) {
            this.figureTraverse = b
        }
        ;
        Html5EventDispatcher.prototype.setFigureUnderCursor = function(b) {
            if (this.cursorTarget == b) {
                return
            }
            this.cursorTarget = b;
            this.updateCursor()
        }
        ;
        Html5EventDispatcher.prototype.setFocus = function(c) {
            if (c == this.focusOwner) {
                return
            }
            var b = new FocusEvent(this.focusOwner,c);
            var d = this.focusOwner;
            this.focusOwner = c;
            if (d != null ) {
                d.handleFocusLost(b)
            }
            if (c != null ) {
                this.getFocusTraverseManager().setCurrentFocusOwner(c)
            }
            if (this.focusOwner != null ) {
                this.focusOwner.handleFocusGained(b)
            }
        }
        ;
        Html5EventDispatcher.prototype.setHoverSource = function(b, c) {
            this.hoverSource = b;
            if (b != null ) {
                var d = c.getSource();
                var g = d.toDisplay(new Point(c.x,c.y));
                this.toolTipHelper = this.getToolTipHelper();
                this.toolTipHelper.updateToolTip(this.hoverSource, this.getCurrentToolTip(), g.x, g.y)
            } else {
                if (this.toolTipHelper != null ) {
                    this.toolTipHelper.updateToolTip(this.hoverSource, this.getCurrentToolTip(), c.x, c.y)
                }
            }
        }
        ;
        Html5EventDispatcher.prototype.setMouseTarget = function(b) {
            this.mouseTarget = b
        }
        ;
        Html5EventDispatcher.prototype.setRoot = function(b) {
            this.root = b
        }
        ;
        Html5EventDispatcher.prototype.updateCursor = function() {
            var b = null ;
            if (this.cursorTarget != null ) {
                b = this.cursorTarget.getCursor()
            }
            if (b == null ) {
                b = Cursor.DEFAULT
            }
            this.setCursor(b)
        }
        ;
        Html5EventDispatcher.prototype.updateFigureUnderCursor = function(b) {
            if (!this.captured) {
                var c = this.root.findFigureAt(b.x, b.y);
                this.setFigureUnderCursor(c);
                if (this.cursorTarget != this.hoverSource) {
                    this.updateHoverSource(b)
                }
            }
        }
        ;
        Html5EventDispatcher.prototype.updateHoverSource = function(c) {
            if (this.cursorTarget != null ) {
                var b = false;
                var d = this.cursorTarget;
                while (!b && d.getParent() != null ) {
                    if (d.getToolTip() != null ) {
                        b = true
                    } else {
                        d = d.getParent()
                    }
                }
                this.setHoverSource(d, c)
            } else {
                this.setHoverSource(null , c)
            }
        }
        ;
        Html5EventDispatcher.prototype.init = function() {
            this.parentMethod("init");
            this.figureTraverse = true;
            this.captured = false;
            this.root = null ;
            this.mouseTarget = null ;
            this.cursorTarget = null ;
            this.focusOwner = null ;
            this.hoverSource = null ;
            this.currentEvent = null ;
            this.cursor = null ;
            this.control = null ;
            this.toolTipHelper = null ;
            this.focusManager = new FocusTraverseManager()
        }
    }
    _classes.defineClass("Html5EventDispatcher", a);
    this.init()
}
_classes.registerClass("FocusTraverseManager");
function FocusTraverseManager() {
    if (typeof FocusTraverseManager._initialized == "undefined") {
        function a() {
            FocusTraverseManager.prototype.findDeepestRightmostChildOf = function(b) {
                while (b.getChildren().length != 0) {
                    b = b.getChildren().get(b.getChildren().length - 1)
                }
                return b
            }
            ;
            FocusTraverseManager.prototype.getNextFocusableFigure = function(l, h) {
                var s = false;
                var q = h;
                if (h == null ) {
                    if (l.getChildren().length != 0) {
                        q = (l.getChildren())[0];
                        if (this.isFocusEligible(q)) {
                            return q
                        }
                    } else {
                        return null 
                    }
                }
                var c = Util.Array.indexOf(q.getParent().getChildren(), q);
                while (!s) {
                    var o = q.getParent();
                    var m = o.getChildren();
                    if (q.getChildren().length != 0) {
                        q = q.getChildren().get(0);
                        c = 0;
                        if (this.isFocusEligible(q)) {
                            s = true
                        }
                    } else {
                        if (c < m.length - 1) {
                            q = m.get(++c);
                            if (this.isFocusEligible(q)) {
                                s = true
                            }
                        } else {
                            var r = false;
                            while (!r) {
                                var b = q.getParent();
                                var d = b.getParent();
                                if (d != null ) {
                                    var n = d.getChildren().length;
                                    var g = Util.Array.indexOf(d.getChildren(), b);
                                    if (g < n - 1) {
                                        q = b.getParent().getChildren().get(g + 1);
                                        c = g + 1;
                                        r = true;
                                        if (this.isFocusEligible(q)) {
                                            s = true
                                        }
                                    } else {
                                        q = b
                                    }
                                } else {
                                    q = null ;
                                    r = true;
                                    s = true
                                }
                            }
                        }
                    }
                }
                return q
            }
            ;
            FocusTraverseManager.prototype.getPreviousFocusableFigure = function(b, c) {
                if (c == null ) {
                    return null 
                }
                var h = false;
                var m = c;
                while (!h) {
                    var g = m.getParent();
                    if (g == null ) {
                        return null 
                    }
                    var l = g.getChildren();
                    var d = Util.Array.indexOf(l, m);
                    if (d != 0) {
                        var n = this.findDeepestRightmostChildOf(l.get(d - 1));
                        if (this.isFocusEligible(n)) {
                            h = true;
                            m = n
                        } else {
                            if (n.equals(m)) {
                                if (this.isFocusEligible(m)) {
                                    h = true
                                }
                            } else {
                                m = n
                            }
                        }
                    } else {
                        m = g;
                        if (this.isFocusEligible(m)) {
                            h = true
                        }
                    }
                }
                return m
            }
            ;
            FocusTraverseManager.prototype.getCurrentFocusOwner = function() {
                return currentFocusOwner
            }
            ;
            FocusTraverseManager.prototype.isFocusEligible = function(b) {
                return ( b != null  && b.isFocusTraversable() && b.isShowing()) 
            }
            ;
            FocusTraverseManager.prototype.setCurrentFocusOwner = function(b) {
                this.currentFocusOwner = b
            }
            ;
            FocusTraverseManager.prototype.init = function() {
                this.parentMethod("init")
            }
        }
        FocusTraverseManager._initialized = true;
        _classes.defineClass("FocusTraverseManager", a)
    }
    this.init()
}
_classes.registerClass("ToolTipHelper");
function ToolTipHelper(b) {
    if (typeof ToolTipHelper._initialized == "undefined") {
        function a() {
            ToolTipHelper.prototype.isShowing = function() {
                return this.tipShowing
            }
            ;
            ToolTipHelper.prototype.hide = function() {
                this.control.style.display = "none";
                this.control.style.opacity = 0;
                this.tipShowing = false
            }
            ;
            ToolTipHelper.prototype.show = function() {
                this.control.style.display = "block";
                this.tipShowing = true;
                var d = this;
                var c = ToolTipHelper.ANIMATION / 10;
                var h = c;
                var g = setInterval(function() {
                    if (h < ToolTipHelper.ANIMATION) {
                        if (d.directionY == PositionConstants.NORTH) {
                            d.control.style.top = (d.originTop - h) + "px"
                        } else {
                            d.control.style.top = (d.originTop + h) + "px"
                        }
                        h += c;
                        d.control.style.opacity = (h / ToolTipHelper.ANIMATION)
                    } else {
                        clearInterval(g)
                    }
                }, 50)
            }
            ;
            ToolTipHelper.prototype.updateToolTip = function(d, g, c, h) {
                if (d == null ) {
                    if (this.isShowing()) {
                        this.hide()
                    }
                }
                if (this.isShowing() && d != this.currentTipSource) {
                    this.hide()
                } else {
                    if (!this.isShowing() && d != this.currentTipSource) {
                        this.currentTipSource = null 
                    }
                }
            }
            ;
            ToolTipHelper.prototype.displayToolTipNear = function(h, g, c, l) {
                if (g != null  && h != this.currentTipSource) {
                    if (typeof g === "string") {
                        g = new Label("toolTip",g)
                    }
                    if (this.tip != null ) {
                        this.panel.remove(this.tip)
                    }
                    if (this.control == null ) {
                        this.createControl()
                    }
                    this.panel.add(g, new Rectangle(0,0,-1,-1));
                    var d = this.panel.getPreferredSize(-1, -1);
                    if (c + d.width > parseInt(this.originCanvas.getWidth())) {
                        c = c - d.width + ToolTipBorder.WEIGHT / 2;
                        this.directionX = PositionConstants.EAST
                    } else {
                        this.directionX = PositionConstants.WEST
                    }
                    if (l + d.height > parseInt(this.originCanvas.getHeight())) {
                        l = l - d.height - ToolTipHelper.ANIMATION;
                        this.directionY = PositionConstants.SOUTH
                    } else {
                        this.directionY = PositionConstants.NORTH;
                        l = (l + 26 + ToolTipHelper.SHADOW_Y + ToolTipHelper.ANIMATION)
                    }
                    if (d.width < ToolTipBorder.WEIGHT * 4) {
                        d.width = ToolTipBorder.WEIGHT * 4
                    }
                    this.panel.getBorder().setDirection(this.directionX, this.directionY);
                    this.panel.repaint();
                    this.originTop = l;
                    this.resizeToolTip(c, l, d.width, d.height);
                    this.tip = g;
                    this.currentTipSource = h;
                    this.show()
                }
            }
            ;
            ToolTipHelper.prototype.resizeToolTip = function(d, h, g, c) {
                this.control.style.left = d + "px";
                this.control.style.top = h + "px";
                if (this.control.width != g || this.control.height != c) {
                    this.control.width = g;
                    this.control.height = c
                }
                this.lightweightSystem.controlResized()
            }
            ;
            ToolTipHelper.prototype.createControl = function() {
                this.control = document.createElement("canvas");
                this.control.style.display = "none";
                this.control.style.position = "absolute";
                this.control.style.zIndex = 99;
                this.control.style.opacity = 0;
                var c = new Canvas(this.control);
                this.lightweightSystem = new LightweightSystem(c);
                this.panel = new Figure("panel");
                this.panel.setBorder(new ToolTipBorder());
                this.panel.setLayoutManager(new XYLayout());
                this.lightweightSystem.setContents(this.panel);
                this.originCanvas.getParent().appendChild(this.control)
            }
            ;
            ToolTipHelper.prototype.init = function(c) {
                if (c == null ) {
                    Debugger.error("no control for toopTipHelper")
                } else {
                    this.originCanvas = c
                }
            }
        }
        ToolTipHelper._initialized = true;
        _classes.defineClass("ToolTipHelper", a)
    }
    this.init(b)
}
ToolTipHelper.SHADOW_X = 4;
ToolTipHelper.SHADOW_Y = 4;
ToolTipHelper.ANIMATION = 50;
_classes.registerClass("ToolTipBorder", "AbstractBackground");
function ToolTipBorder(a, c) {
    if (typeof ToolTipBorder._initialized == "undefined") {
        function b() {
            ToolTipBorder.prototype.getWidth = function() {
                return 1
            }
            ;
            ToolTipBorder.prototype.setColor = function(d) {
                this.color = d
            }
            ;
            ToolTipBorder.prototype.getColor = function() {
                return this.color
            }
            ;
            ToolTipBorder.prototype.setFillColor = function(d) {
                this.fillColor = d
            }
            ;
            ToolTipBorder.prototype.getFillColor = function() {
                return this.fillColor
            }
            ;
            ToolTipBorder.prototype.setDirection = function(g, d) {
                this.directionX = g;
                this.directionY = d
            }
            ;
            ToolTipBorder.prototype.paintBackground = function(m, o, h) {
                AbstractBorder.tempRect.setBounds(this.getPaintRectangle(m, h));
                if (this.getWidth() % 2 == 1) {
                    AbstractBorder.tempRect.width--;
                    AbstractBorder.tempRect.height--
                }
                AbstractBorder.tempRect.shrink(this.getWidth() / 2, this.getWidth() / 2);
                var h = this.getInsets();
                h = new Insets(h.top / 2,h.left / 2,h.bottom / 2,h.right / 2);
                AbstractBorder.tempRect.crop(h);
                var q = AbstractBorder.tempRect;
                var p = q.x
                  , n = q.y
                  , g = q.width
                  , r = q.height
                  , d = 4
                  , l = 4;
                o.setShadowOffsetX(4);
                o.setShadowOffsetY(4);
                o.setShadowBlur(4);
                o.setShadowColor("rgba(0, 0, 0, 0.5)");
                o.beginPath();
                o.moveTo(p + 0.5, n + l);
                o.lineToEllipse(p + d + 0.5, n + r - l, d, l - 0.5, 180, 270, true);
                if (this.directionY == PositionConstants.SOUTH) {
                    if (this.directionX == PositionConstants.WEST) {
                        o.lineTo(p + d + ToolTipBorder.WEIGHT + h.bottom, n + r);
                        o.lineTo(p + d + ToolTipBorder.WEIGHT + (-h.bottom / 2), n + r + h.bottom);
                        o.lineTo(p + d + ToolTipBorder.WEIGHT, n + r)
                    } else {
                        o.lineTo(p + g - d - ToolTipBorder.WEIGHT - h.bottom, n + r);
                        o.lineTo(p + g - d - ToolTipBorder.WEIGHT - (-h.bottom / 2), n + r + h.bottom);
                        o.lineTo(p + g - d - ToolTipBorder.WEIGHT, n + r)
                    }
                }
                o.lineToEllipse(p + g - d, n + r - l - 0.5, d, l - 0.5, 270, 360, true);
                o.lineToEllipse(p + g - d, n + l, d, l, 0, 90, true);
                if (this.directionY == PositionConstants.NORTH) {
                    if (this.directionX == PositionConstants.WEST) {
                        o.lineTo(p + d + ToolTipBorder.WEIGHT + h.top, n);
                        o.lineTo(p + d + ToolTipBorder.WEIGHT + (-h.top / 2), n - h.top);
                        o.lineTo(p + d + ToolTipBorder.WEIGHT, n)
                    } else {
                        o.lineTo(p + g - d - ToolTipBorder.WEIGHT - h.top, n);
                        o.lineTo(p + g - d - ToolTipBorder.WEIGHT - (-h.top / 2), n - h.top);
                        o.lineTo(p + g - d - ToolTipBorder.WEIGHT, n)
                    }
                }
                o.lineToEllipse(p + d + 0.5, n + l, d, l, 90, 180, true);
                o.closePath();
                if (this.getColor() != null ) {
                    o.setStrokeColor(this.getColor());
                    o.stroke()
                }
                if (this.getFillColor() != null ) {
                    o.setFillColor(this.getFillColor());
                    o.fill()
                }
            }
            ;
            ToolTipBorder.prototype.getInsets = function() {
                return new Insets(ToolTipBorder.WEIGHT,ToolTipBorder.WEIGHT,ToolTipBorder.WEIGHT,ToolTipBorder.WEIGHT)
            }
            ;
            ToolTipBorder.prototype.init = function(d, g) {
                if (d) {
                    this.color = d
                } else {
                    this.color = ToolTipBorder.BG_BORDER_COLOR
                }
                if (g) {
                    this.fillColor = g
                } else {
                    this.fillColor = ToolTipBorder.BG_FILL_COLOR
                }
            }
        }
        ToolTipBorder._initialized = true;
        _classes.defineClass("ToolTipBorder", b)
    }
    this.init(a)
}
ToolTipBorder.WEIGHT = 20;
ToolTipBorder.MinWidth = 20;
ToolTipBorder.BG_BORDER_COLOR = Color.parse("#662266");
ToolTipBorder.BG_FILL_COLOR = new Color(255,200,0);
_classes.registerClass("InputEvent");
function InputEvent(a, c, b) {
    function d() {
        InputEvent.prototype.consume = function() {
            this.consumed = true
        }
        ;
        InputEvent.prototype.getSource = function() {
            return this.source
        }
        ;
        InputEvent.prototype.getState = function() {
            return this.state
        }
        ;
        InputEvent.prototype.isConsumed = function() {
            return this.consumed
        }
        ;
        InputEvent.prototype.init = function(g, l, h) {
            this.parentMethod("init");
            this.source = l;
            this.state = h;
            this.consumed = false
        }
    }
    _classes.defineClass("InputEvent", d);
    this.init(a, c, b)
}
InputEvent.ALT = 1 << 16;
InputEvent.SHIFT = 1 << 17;
InputEvent.CTRL = 1 << 18;
InputEvent.BUTTON1 = 1 << 19;
InputEvent.BUTTON2 = 1 << 20;
InputEvent.BUTTON3 = 1 << 21;
InputEvent.BUTTON4 = 1 << 23;
InputEvent.BUTTON5 = 1 << 25;
InputEvent.BUTTON_MASK = InputEvent.BUTTON1 | InputEvent.BUTTON2 | InputEvent.BUTTON3 | InputEvent.BUTTON4 | InputEvent.BUTTON5;
_classes.registerClass("MouseEvent", "InputEvent");
function MouseEvent(a, m, d, h, b, c, g) {
    function l() {
        MouseEvent.prototype.getLocation = function() {
            return new Point(this.x,this.y)
        }
        ;
        MouseEvent.prototype.init = function(n, u, q, s, o, p, r) {
            this.parentMethod("init", q, s, p);
            var t = Point.SINGLETON;
            t.setLocation(n, u);
            s.translateToRelative(t);
            this.button = o;
            this.x = t.x;
            this.y = t.y;
            if (r) {
                this.e = r.e
            }
        }
    }
    _classes.defineClass("MouseEvent", l);
    this.init(a, m, d, h, b, c, g)
}
_classes.registerClass("TouchEvent", "InputEvent");
function TouchEvent(a, m, d, h, b, c, g) {
    function l() {
        MouseEvent.prototype.getLocation = function() {
            return new Point(this.x,this.y)
        }
        ;
        MouseEvent.prototype.init = function(n, u, q, s, o, p, r) {
            this.parentMethod("init", q, s, p);
            var t = Point.SINGLETON;
            t.setLocation(n, u);
            s.translateToRelative(t);
            this.button = o;
            this.x = t.x;
            this.y = t.y;
            if (r) {
                this.e = r.e
            }
        }
    }
    _classes.defineClass("TouchEvent", l);
    this.init(a, m, d, h, b, c, g)
}
_classes.registerClass("KeyEvent", "InputEvent");
function KeyEvent(b, c, a) {
    function d() {
        KeyEvent.prototype.init = function(h, l, g) {
            this.parentMethod("init", h, l, g.stateMask);
            this.character = g.character;
            this.keyCode = g.keyCode;
            this.e = g.e
        }
    }
    _classes.defineClass("KeyEvent", d);
    this.init(b, c, a)
}
_classes.registerClass("ChangeEvent");
function ChangeEvent(b, a) {
    function c() {
        ChangeEvent.prototype.getSource = function() {
            return this.source
        }
        ;
        ChangeEvent.prototype.getPropertyName = function() {
            return this.property
        }
        ;
        ChangeEvent.prototype.setPropertyName = function(d) {
            this.property = d
        }
        ;
        ChangeEvent.prototype.init = function(g, d) {
            this.parentMethod("init");
            this.source = g;
            this.property = d
        }
    }
    _classes.defineClass("ChangeEvent", c);
    this.init(b, a)
}
_classes.registerClass("ActionEvent");
function ActionEvent(b, a) {
    function c() {
        ActionEvent.prototype.getSource = function() {
            return this.source
        }
        ;
        ActionEvent.prototype.getActionName = function() {
            return this.actionName
        }
        ;
        ActionEvent.prototype.init = function(g, d) {
            this.parentMethod("init");
            this.source = g;
            this.actionName = d
        }
    }
    _classes.defineClass("ActionEvent", c);
    this.init(b, a)
}
_classes.registerClass("FocusEvent");
function FocusEvent(b, a) {
    function c() {
        FocusEvent.prototype.init = function(g, d) {
            this.loser = g;
            this.gainer = d
        }
    }
    _classes.defineClass("FocusEvent", c);
    this.init(b, a)
}
Cursor = {};
Cursor.POINTER = "pointer";
Cursor.CROSS_HAIR = "crosshair";
Cursor.TEXT = "text";
Cursor.WAIT = "wait";
Cursor.DEFAULT = "default";
Cursor.HELP = "help";
Cursor.E_RESIZE = "e-resize";
Cursor.NE_RESIZE = "ne-resize";
Cursor.N_RESIZE = "n-resize";
Cursor.NW_RESIZE = "nw-resize";
Cursor.W_RESIZE = "w-resize";
Cursor.SW_RESIZE = "sw-resize";
Cursor.S_RESIZE = "s-resize";
Cursor.SE_RESIZE = "se-resize";
Cursor.AUTO = "auto";
Cursor.DISABLE = "no-drop";
Cursor.NO = "";
Cursor.MOVE = "move";
Cursor.PROGRESS = "progress";
Cursor.VERTICAL_TEXT = "vertical-text";
Cursor.COL_RESIZE = "col-resize";
Cursor.ROW_RESIZE = "row-resize";
Cursor.getDirectionalCursor = function(b, a) {
    if (a && (b & PositionConstants.EAST_WEST) != 0) {
        b = b ^ PositionConstants.EAST_WEST
    }
    switch (b) {
    case PositionConstants.NORTH:
        return Cursor.N_RESIZE;
    case PositionConstants.SOUTH:
        return Cursor.S_RESIZE;
    case PositionConstants.EAST:
        return Cursor.E_RESIZE;
    case PositionConstants.WEST:
        return Cursor.W_RESIZE;
    case PositionConstants.SOUTH_EAST:
        return Cursor.SE_RESIZE;
    case PositionConstants.SOUTH_WEST:
        return Cursor.SW_RESIZE;
    case PositionConstants.NORTH_EAST:
        return Cursor.NE_RESIZE;
    case PositionConstants.NORTH_WEST:
        return Cursor.NW_RESIZE;
    default:
        break
    }
    return null 
}
;
var ImageResourceManager = (function() {
    var b = {
        imgs: {}
    };
    function a(h) {
        if (this.loaded) {
            return
        }
        var g = 0;
        if (this.loadListeners == null ) {
            this.loadListeners = []
        }
        for (g = 0; g < arguments.length; g++) {
            if (arguments[g] != null ) {
                if (!Util.Array.contains(this.loadListeners, arguments[g])) {
                    this.loadListeners.push(arguments[g])
                }
            }
        }
    }
    function d(g) {
        if (this.loadListeners != null ) {
            Util.Array.removeItem(this.loadListeners, g)
        }
    }
    function c(h) {
        var g = new Image();
        g.src = h;
        b.imgs[h] = g;
        g.loadListeners = [];
        g.loaded = false;
        g.onload = function() {
            g.loaded = true;
            var m;
            var l = 0;
            for (; l < g.loadListeners.length; l++) {
                m = g.loadListeners[l];
                if (typeof m.pictureLoaded == "function") {
                    m.pictureLoaded()
                }
            }
        }
        ;
        g.addLoadListener = a;
        g.removeLoadListener = d;
        return g
    }
    b.getImage = function(g) {
        return this.imgs[g] || c(g)
    }
    ;
    b.addListener4Img = function(h) {
        var g = b.imgs[h];
        var l;
        if (g != null ) {
            if (!g.loadListeners) {
                return
            }
            for (l = 1; l < arguments.length; l++) {
                if (arguments[l] != null ) {
                    g.loadListeners.push(arguments[l])
                }
            }
        }
    }
    ;
    return b
})();
_classes.registerClass("DefaultRangeModel");
function DefaultRangeModel() {
    if (typeof DefaultRangeModel._initialized == "undefined") {
        function a() {
            DefaultRangeModel.prototype.addPropertyChangeListener = function(b) {
                this.propertyListeners.addPropertyChangeListener(b)
            }
            ;
            DefaultRangeModel.prototype.firePropertyChange = function(c, b, d) {
                this.propertyListeners.firePropertyChange(c, b, d)
            }
            ;
            DefaultRangeModel.prototype.getExtent = function() {
                return this.extent
            }
            ;
            DefaultRangeModel.prototype.getMaximum = function() {
                return this.maximum
            }
            ;
            DefaultRangeModel.prototype.getMinimum = function() {
                return this.minimum
            }
            ;
            DefaultRangeModel.prototype.getValue = function() {
                return this.value
            }
            ;
            DefaultRangeModel.prototype.isEnabled = function() {
                return (this.getMaximum() - this.getMinimum()) > this.getExtent()
            }
            ;
            DefaultRangeModel.prototype.removePropertyChangeListener = function(b) {
                this.propertyListeners.removePropertyChangeListener(b)
            }
            ;
            DefaultRangeModel.prototype.setAll = function(g, h, b) {
                var l = this.minimum;
                var d = this.extent;
                var c = this.maximum;
                this.maximum = b;
                this.minimum = g;
                this.extent = h;
                if (c != b) {
                    this.firePropertyChange(DefaultRangeModel.PROPERTY_MAXIMUM, c, b)
                }
                if (d != h) {
                    this.firePropertyChange(DefaultRangeModel.PROPERTY_EXTENT, d, h)
                }
                if (l != g) {
                    this.firePropertyChange(DefaultRangeModel.PROPERTY_MINIMUM, l, g)
                }
                this.setValue(this.getValue())
            }
            ;
            DefaultRangeModel.prototype.setExtent = function(c) {
                if (this.extent == c) {
                    return
                }
                var b = this.extent;
                this.extent = c;
                this.firePropertyChange(DefaultRangeModel.PROPERTY_EXTENT, b, c);
                this.setValue(this.getValue())
            }
            ;
            DefaultRangeModel.prototype.setMaximum = function(c) {
                if (this.maximum == c) {
                    return
                }
                var b = this.maximum;
                this.maximum = c;
                this.firePropertyChange(DefaultRangeModel.PROPERTY_MAXIMUM, b, c);
                this.setValue(this.getValue())
            }
            ;
            DefaultRangeModel.prototype.setMinimum = function(c) {
                if (this.minimum == c) {
                    return
                }
                var b = this.minimum;
                this.minimum = c;
                this.firePropertyChange(DefaultRangeModel.PROPERTY_MINIMUM, b, c);
                this.setValue(this.getValue())
            }
            ;
            DefaultRangeModel.prototype.setValue = function(c) {
                c = Math.max(this.getMinimum(), Math.min(this.getMaximum() - this.getExtent(), c));
                if (this.value == c) {
                    return
                }
                var b = this.value;
                this.value = c;
                this.firePropertyChange(DefaultRangeModel.PROPERTY_VALUE, b, c)
            }
            ;
            DefaultRangeModel.prototype.init = function() {
                this.parentMethod("init");
                this.minimum = 0;
                this.maximum = 100;
                this.extent = 20;
                this.value = 0;
                this.propertyListeners = new PropertyChangeSupport(this)
            }
        }
        DefaultRangeModel._initialized = true;
        _classes.defineClass("DefaultRangeModel", a)
    }
    this.init()
}
DefaultRangeModel.PROPERTY_VALUE = "value";
DefaultRangeModel.PROPERTY_EXTENT = "extent";
DefaultRangeModel.PROPERTY_MINIMUM = "minimum";
DefaultRangeModel.PROPERTY_MAXIMUM = "maximum";
_classes.registerClass("Viewport", "Figure");
function Viewport(c, a) {
    if (typeof Viewport._initialized == "undefined") {
        function b() {
            Viewport.prototype.getClientArea = function(d) {
                this.isa = "Viewport";
                d = this.parentMethod("getClientArea", d);
                if (this.useGraphicsTranslate()) {
                    d.translate(this.getViewLocation())
                }
                return d
            }
            ;
            Viewport.prototype.getContents = function() {
                return this.view
            }
            ;
            Viewport.prototype.getHorizontalRangeModel = function() {
                return this.horiztonalRangeModel
            }
            ;
            Viewport.prototype.getContentsTracksHeight = function() {
                return this.trackHeight
            }
            ;
            Viewport.prototype.getContentsTracksWidth = function() {
                return this.trackWidth
            }
            ;
            Viewport.prototype.getVerticalRangeModel = function() {
                return this.verticalRangeModel
            }
            ;
            Viewport.prototype.getViewableRect = function() {
                var g = this.getBounds();
                var d = this.getViewLocation();
                return new Rectangle(d.x,d.y,g.width,g.height)
            }
            ;
            Viewport.prototype.getViewLocation = function() {
                return new Point(this.getHorizontalRangeModel().getValue(),this.getVerticalRangeModel().getValue())
            }
            ;
            Viewport.prototype.localRevalidate = function() {
                this.invalidate();
                if (this.getLayoutManager() != null ) {
                    this.getLayoutManager().invalidate()
                }
                this.getUpdateManager().addInvalidFigure(this)
            }
            ;
            Viewport.prototype.paintClientArea = function(d) {
                this.isa = "Viewport";
                if (this.useGraphicsTranslate()) {
                    var h = this.getViewLocation();
                    d.translate(-h.x, -h.y);
                    d.pushState();
                    this.parentMethod("paintClientArea", d);
                    d.restoreState();
                    d.translate(h.x, h.y)
                } else {
                    this.parentMethod("paintClientArea", d)
                }
            }
            ;
            Viewport.prototype.isCoordinateSystem = function() {
                this.isa = "Viewport";
                return this.useGraphicsTranslate() || this.parentMethod("isCoordinateSystem")
            }
            ;
            Viewport.prototype.propertyChange = function(d) {
                var g = d.getSource();
                if (g != null  && Util.isInstanceOf(g, DefaultRangeModel)) {
                    if (DefaultRangeModel.PROPERTY_VALUE == (d.getPropertyName())) {
                        if (!this.ignoreScroll) {
                            this.localRevalidate();
                            if (this.useGraphicsTranslate()) {
                                this.repaint();
                                this.fireMoved()
                            }
                        }
                        this.firePropertyChange(Viewport.PROPERTY_VIEW_LOCATION, d.getOldValue(), d.getNewValue())
                    } else {
                        if (DefaultRangeModel.PROPERTY_MAXIMUM == (d.getPropertyName())) {
                            this.firePropertyChange(Viewport.PROPERTY_CONTENT_SIZE, d.getOldValue(), d.getNewValue())
                        }
                    }
                }
            }
            ;
            Viewport.prototype.readjustScrollBars = function() {
                if (this.getContents() == null ) {
                    return
                }
                this.getVerticalRangeModel().setAll(0, this.getClientArea(new Rectangle()).height, this.getContents().getBounds().height);
                this.getHorizontalRangeModel().setAll(0, this.getClientArea(new Rectangle()).width, this.getContents().getBounds().width)
            }
            ;
            Viewport.prototype.setContents = function(d) {
                if (this.view == d) {
                    return
                }
                if (this.view != null ) {
                    this.remove(view)
                }
                this.view = d;
                if (this.view != null ) {
                    this.add(d)
                }
            }
            ;
            Viewport.prototype.setContentsTracksHeight = function(d) {
                this.trackHeight = d
            }
            ;
            Viewport.prototype.setContentsTracksWidth = function(d) {
                this.trackWidth = d
            }
            ;
            Viewport.prototype.setHorizontalLocation = function(d) {
                this.setViewLocation(d, this.getVerticalRangeModel().getValue())
            }
            ;
            Viewport.prototype.setHorizontalRangeModel = function(d) {
                if (this.horiztonalRangeModel != null ) {
                    this.horiztonalRangeModel.removePropertyChangeListener(this)
                }
                this.horiztonalRangeModel = d;
                this.horiztonalRangeModel.addPropertyChangeListener(this)
            }
            ;
            Viewport.prototype.setIgnoreScroll = function(d) {
                this.ignoreScroll = d
            }
            ;
            Viewport.prototype.setVerticalLocation = function(d) {
                this.setViewLocation(this.getHorizontalRangeModel().getValue(), d)
            }
            ;
            Viewport.prototype.setVerticalRangeModel = function(d) {
                if (this.verticalRangeModel != null ) {
                    this.verticalRangeModel.removePropertyChangeListener(this)
                }
                this.verticalRangeModel = d;
                this.verticalRangeModel.addPropertyChangeListener(this)
            }
            ;
            Viewport.prototype.setViewLocation = function(h, g) {
                if (h == null ) {
                    return
                }
                var d;
                var l;
                if (Util.isInstanceOf(h, Point)) {
                    d = h.x;
                    l = h.y
                } else {
                    if (g != null ) {
                        d = h;
                        l = g
                    }
                }
                if (this.getHorizontalRangeModel().getValue() != d) {
                    this.getHorizontalRangeModel().setValue(d)
                }
                if (this.getVerticalRangeModel().getValue() != l) {
                    this.getVerticalRangeModel().setValue(l)
                }
            }
            ;
            Viewport.prototype.translateFromParent = function(d) {
                if (this.useTranslate) {
                    d.performTranslate(this.getHorizontalRangeModel().getValue(), this.getVerticalRangeModel().getValue())
                }
                this.isa = "Viewport";
                this.parentMethod("translateFromParent", d)
            }
            ;
            Viewport.prototype.translateToParent = function(d) {
                if (this.useTranslate) {
                    d.performTranslate(-this.getHorizontalRangeModel().getValue(), -this.getVerticalRangeModel().getValue())
                }
                this.isa = "Viewport";
                this.parentMethod("translateToParent", d)
            }
            ;
            Viewport.prototype.useGraphicsTranslate = function() {
                return this.useTranslate
            }
            ;
            Viewport.prototype.validate = function() {
                this.isa = "Viewport";
                this.parentMethod("validate");
                this.readjustScrollBars()
            }
            ;
            Viewport.prototype.init = function(g, d) {
                this.parentMethod("init", g);
                this.view = null ;
                this.useTranslate = false;
                this.trackWidth = false;
                this.trackHeight = false;
                this.ignoreScroll = false;
                this.horiztonalRangeModel = null ;
                this.verticalRangeModel = null ;
                this.setLayoutManager(new ViewportLayout());
                this.setHorizontalRangeModel(new DefaultRangeModel());
                this.setVerticalRangeModel(new DefaultRangeModel());
                this.useTranslate = d
            }
        }
        Viewport._initialized = true;
        _classes.defineClass("Viewport", b)
    }
    this.init(c, a)
}
Viewport.PROPERTY_VIEW_LOCATION = "viewLocation";
Viewport.PROPERTY_CONTENT_SIZE = "contentSize";
_classes.registerClass("FreeformViewport", "Viewport");
function FreeformViewport(b) {
    if (typeof FreeformViewport._initialized == "undefined") {
        function a() {
            FreeformViewport.prototype.readjustScrollBars = function() {
                if (this.getContents() == null ) {
                    return
                }
                if (!(this.getContents().getFreeformExtent != null )) {
                    return
                }
                var c = this.getContents();
                var g = this.getClientArea();
                var d = c.getFreeformExtent().getCopy();
                d.union(0, 0, g.width, g.height);
                c.setFreeformBounds(d);
                this.getVerticalRangeModel().setAll(d.y, g.height, d.bottom());
                this.getHorizontalRangeModel().setAll(d.x, g.width, d.right())
            }
            ;
            FreeformViewport.prototype.useLocalCoordinates = function() {
                return true
            }
            ;
            FreeformViewport.prototype.init = function(c) {
                this.parentMethod("init", c, true);
                this.setLayoutManager(new FreeformViewportLayout())
            }
        }
        FreeformViewport._initialized = true;
        _classes.defineClass("FreeformViewport", a)
    }
    this.init(b)
}
_classes.registerClass("Clickable", "Figure");
function Clickable(d, b, a) {
    if (typeof Clickable._initialized == "undefined") {
        function c() {
            Clickable.prototype.addActionListener = function(g) {
                this.addListener("ActionListener", g)
            }
            ;
            Clickable.prototype.addChangeListener = function(g) {
                this.addListener("ChangeListener", g)
            }
            ;
            Clickable.prototype.createDefaultModel = function() {
                if (this.isStyle(Clickable.STYLE_TOGGLE)) {
                    return new ToggleModel()
                } else {
                    return new ButtonModel()
                }
            }
            ;
            Clickable.prototype.createEventHandler = function() {
                return new ClickableEventHandler()
            }
            ;
            Clickable.prototype.createModelObserver = function() {
                var h = new Object();
                var g = this;
                h.actionPerformed = function(l) {
                    g.fireActionPerformed()
                }
                ;
                h.handleStateChanged = function(l) {
                    g.fireStateChanged(l)
                }
                ;
                return h
            }
            ;
            Clickable.prototype.doClick = function() {
                this.fireActionPerformed()
            }
            ;
            Clickable.prototype.fireActionPerformed = function() {
                var h = new ActionEvent(this);
                var g = this.getListeners("ActionListener");
                while (g.hasNext()) {
                    g.next().actionPerformed(h)
                }
            }
            ;
            Clickable.prototype.fireStateChanged = function(g) {
                var l = new ChangeEvent(this,g.getPropertyName());
                var h = this.getListeners("ChangeListener");
                while (h.hasNext()) {
                    h.next().handleStateChanged(l)
                }
            }
            ;
            Clickable.prototype.getModel = function() {
                return this.model
            }
            ;
            Clickable.prototype.hookEventHandler = function(g) {
                if (g == null ) {
                    return
                }
                this.addMouseListener(g);
                this.addMouseMotionListener(g);
                this.addChangeListener(g);
                this.addKeyListener(g);
                this.addFocusListener(g)
            }
            ;
            Clickable.prototype.isRolloverEnabled = function() {
                return (this.flags & Clickable.ROLLOVER_ENABLED_FLAG) != 0
            }
            ;
            Clickable.prototype.isSelected = function() {
                return this.getModel().isSelected()
            }
            ;
            Clickable.prototype.isStyle = function(g) {
                return ( (g & this.flags) == g) 
            }
            ;
            Clickable.prototype.paintBorder = function(g) {
                this.isa = "Clickable";
                this.parentMethod("paintBorder", g);
                if (this.hasFocus()) {
                    g.setStrokeColor(ColorConstants.black);
                    var h = this.getClientArea();
                    if (this.isStyle(Clickable.STYLE_BUTTON)) {
                        g.drawFocus(h.x, h.y, h.width, h.height)
                    } else {
                        g.drawFocus(h.x, h.y, h.width - 1, h.height - 1)
                    }
                }
            }
            ;
            Clickable.prototype.paintClientArea = function(g) {
                if (this.isStyle(Clickable.STYLE_BUTTON) && (this.getModel().isArmed() || this.getModel().isSelected())) {
                    g.translate(1, 1);
                    g.pushState();
                    this.isa = "Clickable";
                    this.parentMethod("paintClientArea", g);
                    g.restoreState();
                    g.translate(-1, -1)
                } else {
                    this.isa = "Clickable";
                    this.parentMethod("paintClientArea", g)
                }
            }
            ;
            Clickable.prototype.removeActionListener = function(g) {
                this.removeListener("ActionListener", g)
            }
            ;
            Clickable.prototype.removeChangeListener = function(g) {
                this.removeListener("ChangeListener", g)
            }
            ;
            Clickable.prototype.setContents = function(g) {
                this.setLayoutManager(new StackLayout());
                if (this.getChildren().length > 0) {
                    this.remove(this.getChildren()[0])
                }
                this.add(g)
            }
            ;
            Clickable.prototype.setEnabled = function(g) {
                if (this.isEnabled() == g) {
                    return
                }
                this.isa = "Clickable";
                this.parentMethod("setEnabled", g);
                this.getModel().setEnabled(g);
                this.setChildrenEnabled(g)
            }
            ;
            Clickable.prototype.setEventHandler = function(g) {
                if (this.eventHandler != null ) {
                    this.unhookEventHandler(this.eventHandler)
                }
                this.eventHandler = g;
                if (this.eventHandler != null ) {
                    this.hookEventHandler(this.eventHandler)
                }
            }
            ;
            Clickable.prototype.setFiringMethod = function(g) {
                this.getModel().setFiringBehavior(g)
            }
            ;
            Clickable.prototype.setModel = function(g) {
                if (this.model != null ) {
                    this.model.removeChangeListener(this.modelObserver);
                    this.model.removeActionListener(this.modelObserver);
                    this.modelObserver = null 
                }
                this.model = g;
                if (g != null ) {
                    this.modelObserver = this.createModelObserver();
                    g.addActionListener(this.modelObserver);
                    g.addChangeListener(this.modelObserver)
                }
            }
            ;
            Clickable.prototype.setRolloverEnabled = function(g) {
                if (this.isRolloverEnabled() == g) {
                    return
                }
                this.setFlag(Clickable.ROLLOVER_ENABLED_FLAG, g);
                this.repaint()
            }
            ;
            Clickable.prototype.setSelected = function(g) {
                this.getModel().setSelected(g)
            }
            ;
            Clickable.prototype.setStyle = function(g) {
                if ((g & Clickable.STYLE_BUTTON) != 0) {
                    this.setFlag(Clickable.STYLE_BUTTON_FLAG, true);
                    if (!(this.getBorder() != null  && Util.isInstanceOf(this.getBorder(), ButtonBorder))) {
                        this.setBorder(new ButtonBorder())
                    }
                    this.setOpaque(true)
                } else {
                    this.setFlag(Clickable.STYLE_BUTTON_FLAG, false);
                    this.setOpaque(false)
                }
                if ((g & Clickable.STYLE_TOGGLE) != 0) {
                    this.setFlag(Clickable.STYLE_TOGGLE_FLAG, true);
                    this.setModel(this.createDefaultModel())
                }
            }
            ;
            Clickable.prototype.unhookEventHandler = function(g) {
                if (g == null ) {
                    return
                }
                this.removeMouseListener(g);
                this.removeMouseMotionListener(g);
                this.removeChangeListener(g)
            }
            ;
            Clickable.prototype.initialize = function() {
                this.setModel(this.createDefaultModel());
                this.setEventHandler(this.createEventHandler())
            }
            ;
            Clickable.prototype.init = function(l, h, g) {
                this.isa = "Clickable";
                this.parentMethod("init", l);
                this.ClickableEventHandler = null ;
                this.model = null ;
                this.modelObserver = null ;
                this.initialize();
                this.setRequestFocusEnabled(true);
                this.setFocusTraversable(true);
                if (h != null ) {
                    this.setContents(h);
                    if (g == null ) {
                        g = 0
                    }
                    this.setStyle(g)
                }
            }
        }
        Clickable._initialized = true;
        _classes.defineClass("Clickable", c)
    }
    this.init(d, b, a)
}
Clickable.ROLLOVER_ENABLED_FLAG = Figure.MAX_FLAG << 1;
Clickable.STYLE_BUTTON_FLAG = Figure.MAX_FLAG << 2;
Clickable.STYLE_TOGGLE_FLAG = Figure.MAX_FLAG << 3;
Clickable.MAX_FLAG = Clickable.STYLE_TOGGLE_FLAG;
Clickable.STYLE_BUTTON = Clickable.STYLE_BUTTON_FLAG;
Clickable.STYLE_TOGGLE = Clickable.STYLE_TOGGLE_FLAG;
Clickable.DEFAULT_FIRING = 0;
Clickable.REPEAT_FIRING = 1;
_classes.registerClass("ClickableEventHandler");
function ClickableEventHandler() {
    function a() {
        ClickableEventHandler.prototype.focusLost = function(b) {
            var c = b.loser;
            c.repaint();
            c.getModel().setArmed(false);
            c.getModel().setPressed(false)
        }
        ;
        ClickableEventHandler.prototype.focusGained = function(c) {
            var b = c.gainer;
            b.repaint()
        }
        ;
        ClickableEventHandler.prototype.figureMoved = function(b) {
            if (this.lastEvent == null ) {
                return
            }
            this.mouseDragged(this.lastEvent)
        }
        ;
        ClickableEventHandler.prototype.handleStateChanged = function(c) {
            var b = c.getSource();
            if (c.getPropertyName() == ButtonModel.MOUSEOVER_PROPERTY && !b.isRolloverEnabled()) {
                return
            }
            b.repaint()
        }
        ;
        ClickableEventHandler.prototype.mouseDragged = function(d) {
            this.lastEvent = d;
            var c = d.getSource();
            var b = c.getModel();
            if (b.isPressed()) {
                var g = c.containsPoint(d.getLocation());
                b.setArmed(g);
                b.setMouseOver(g)
            }
        }
        ;
        ClickableEventHandler.prototype.mouseEntered = function(c) {
            var b = c.getSource();
            b.getModel().setMouseOver(true);
            b.addFigureListener(this)
        }
        ;
        ClickableEventHandler.prototype.mouseExited = function(c) {
            var b = c.getSource();
            b.getModel().setMouseOver(false);
            b.removeFigureListener(this)
        }
        ;
        ClickableEventHandler.prototype.mouseMoved = function(b) {}
        ;
        ClickableEventHandler.prototype.mousePressed = function(d) {
            if (d.button != 1) {
                return
            }
            this.lastEvent = d;
            var c = d.getSource();
            var b = c.getModel();
            c.requestFocus();
            b.setArmed(true);
            b.setPressed(true);
            d.consume()
        }
        ;
        ClickableEventHandler.prototype.mouseReleased = function(c) {
            if (c.button != 1) {
                return
            }
            var b = c.getSource().getModel();
            if (!b.isPressed()) {
                return
            }
            b.setPressed(false);
            b.setArmed(false);
            c.consume()
        }
        ;
        ClickableEventHandler.prototype.keyPressed = function(b) {
            var c = b.getSource().getModel();
            if (b.keyCode == 13) {
                c.setPressed(true);
                c.setArmed(true)
            }
        }
        ;
        ClickableEventHandler.prototype.keyReleased = function(b) {
            var c = b.getSource().getModel();
            if (b.keyCode == 13) {
                c.setPressed(false);
                c.setArmed(false)
            }
        }
        ;
        ClickableEventHandler.prototype.init = function() {
            this.parentMethod("init");
            this.lastEvent = null 
        }
    }
    _classes.defineClass("ClickableEventHandler", a);
    this.init()
}
_classes.registerClass("Button", "Clickable");
function Button(d, b, a) {
    function c() {
        Button.prototype.initialize = function(g) {
            this.isa = "Button";
            this.parentMethod("initialize");
            this.setBackgroundColor(ColorConstants.button)
        }
        ;
        Button.prototype.init = function(l, h, g) {
            if (h == null ) {
                this.isa = "Button";
                this.parentMethod("init", l);
                this.setStyle(Clickable.STYLE_BUTTON)
            } else {
                this.isa = "Button";
                this.parentMethod("init", l, new Label(l + "-label",h,g), Clickable.STYLE_BUTTON)
            }
        }
    }
    _classes.defineClass("Button", c);
    this.init(d, b, a)
}
_classes.registerClass("ArrowButton", "Button");
function ArrowButton(c, a) {
    function b() {
        ArrowButton.prototype.createTriangle = function() {
            var d = new Triangle(this.id + "-triangle");
            d.setOutline(true);
            d.setFillColor(ColorConstants.listForeground);
            d.setOutlineColor(ColorConstants.listForeground);
            d.setBorder(new MarginBorder(new Insets(2)));
            this.setContents(d)
        }
        ;
        ArrowButton.prototype.setDirection = function(d) {
            this.setChildrenDirection(d)
        }
        ;
        ArrowButton.prototype.setOrientation = function(d) {
            this.setChildrenOrientation(d)
        }
        ;
        ArrowButton.prototype.init = function(g, d) {
            this.parentMethod("init", g);
            this.createTriangle();
            this.setRequestFocusEnabled(false);
            this.setFocusTraversable(false);
            this.setDirection(d)
        }
    }
    _classes.defineClass("ArrowButton", b);
    this.init(c, a)
}
_classes.registerClass("Toggle", "Clickable");
function Toggle(d, b, a) {
    function c() {
        Toggle.prototype.init = function(l, h, g) {
            if (h == null ) {
                this.isa = "Toggle";
                this.parentMethod("init", l);
                this.setStyle(Clickable.STYLE_TOGGLE)
            } else {
                if (typeof h == "string" || h instanceof String) {
                    this.isa = "Toggle";
                    this.parentMethod("init", l, new Label(l + "label",h,g), Clickable.STYLE_TOGGLE)
                } else {
                    if (Util.isInstanceOf(h, Figure)) {
                        this.isa = "Toggle";
                        this.parentMethod("init", l, h, g == null  ? Clickable.STYLE_TOGGLE : g)
                    }
                }
            }
        }
    }
    _classes.defineClass("Toggle", c);
    this.init(d, b, a)
}
_classes.registerClass("ToggleButton", "Clickable");
function ToggleButton(d, b, a) {
    function c() {
        ToggleButton.prototype.fillCheckeredRectangle = function(g) {
            g.setFillColor(ColorConstants.button);
            g.setStrokeColor(ColorConstants.buttonLightest);
            var l = this.getClientArea(Rectangle.SINGLETON).crop(new Insets(1,1,0,0));
            g.fillRectangle(l.x, l.y, l.width, l.height);
            g.clipRect(l);
            g.translate(l.x, l.y);
            var m = l.width + l.height;
            g.beginPath();
            for (var h = 1; h < m; h += 2) {
                g.moveTo(0, h);
                g.lineTo(h, 0)
            }
            g.stroke();
            g.restoreState()
        }
        ;
        ToggleButton.prototype.paintFigure = function(g) {
            if (this.isSelected() && this.isOpaque()) {
                this.fillCheckeredRectangle(g)
            } else {
                this.isa = "ToggleButton";
                this.parentMethod("paintFigure", g)
            }
        }
        ;
        ToggleButton.prototype.init = function(l, h, g) {
            if (h == null ) {
                this.isa = "ToggleButton";
                this.parentMethod("init", l);
                this.setStyle(Clickable.STYLE_BUTTON | Clickable.STYLE_TOGGLE)
            } else {
                if (typeof h == "string" || h instanceof String) {
                    this.isa = "ToggleButton";
                    this.parentMethod("init", l, new Label(l + "label",h,g), Clickable.STYLE_BUTTON | Clickable.STYLE_TOGGLE)
                } else {
                    if (Util.isInstanceOf(h, Figure)) {
                        this.isa = "ToggleButton";
                        this.parentMethod("init", l, h, Clickable.STYLE_BUTTON | Clickable.STYLE_TOGGLE)
                    }
                }
            }
        }
    }
    _classes.defineClass("ToggleButton", c);
    this.init(d, b, a)
}
_classes.registerClass("CheckBox", "Toggle");
function CheckBox(c, a) {
    function b() {
        CheckBox.prototype.initialize = function() {
            this.isa = "CheckBox";
            this.parentMethod("initialize");
            var d = this;
            this.addChangeListener({
                handleStateChanged: function(g) {
                    if (g.getPropertyName() == ButtonModel.SELECTED_PROPERTY) {
                        d.handleSelectionChanged()
                    }
                }
            })
        }
        ;
        CheckBox.prototype.handleSelectionChanged = function() {
            if (this.isSelected()) {
                this.label.setIcon(CheckBox.CHECKED)
            } else {
                this.label.setIcon(CheckBox.UNCHECKED)
            }
        }
        ;
        CheckBox.prototype.init = function(g, d) {
            this.label = new Label(g + "label",d,CheckBox.UNCHECKED);
            this.isa = "CheckBox";
            this.parentMethod("init", g, this.label)
        }
    }
    _classes.defineClass("CheckBox", b);
    this.init(c, a)
}
CheckBox.UNCHECKED = ImageResourceManager.getImage("data:image/gif;base64,R0lGODlhDQANAPcAAEJCQrW1tc7OztbWzv///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////ywAAAAADQANAAAIPQAFBBhIsGAAAgEAKFzIUABCAAQiSpToMOHEixUhXqT4cCNHix4JZAwpsmPIkSdNeqwooOUAlwJeDiB5MSAAOw==");
CheckBox.CHECKED = ImageResourceManager.getImage("data:image/gif;base64,R0lGODlhDQANAPcAAAAAAEJCQrW1tc7OztbWzv///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////ywAAAAADQANAAAITwAHCBhIsKCAAgICKFzIcADCAAUiSpToMOFEiQAKVIR4EUBGAg8LZIzoMeNGkRlLRgRpsaRHiiFRjlwZU+TFkxdhChjAk8AAnz9/5hxaICAAOw==");
_classes.registerClass("ButtonModel");
function ButtonModel() {
    if (typeof ButtonModel._initialized == "undefined") {
        function a() {
            ButtonModel.prototype.addActionListener = function(b) {
                if (b != null ) {
                    this.listeners.addListener("ActionListener", b)
                }
            }
            ;
            ButtonModel.prototype.addChangeListener = function(b) {
                if (b != null ) {
                    this.listeners.addListener("ChangeListener", b)
                }
            }
            ;
            ButtonModel.prototype.addStateTransitionListener = function(b) {
                if (b != null ) {
                    this.listeners.addListener("ButtonStateTransitionListener", b)
                }
            }
            ;
            ButtonModel.prototype.fireActionPerformed = function() {
                var b = this.listeners.getListeners("ActionListener");
                var c = new ActionEvent(this);
                while (b.hasNext()) {
                    b.next().actionPerformed(c)
                }
            }
            ;
            ButtonModel.prototype.fireCanceled = function() {
                var b = this.listeners.getListeners("ButtonStateTransitionListener");
                while (b.hasNext()) {
                    b.next().canceled()
                }
            }
            ;
            ButtonModel.prototype.firePressed = function() {
                var b = this.listeners.getListeners("ButtonStateTransitionListener");
                while (b.hasNext()) {
                    b.next().pressed()
                }
            }
            ;
            ButtonModel.prototype.fireReleased = function() {
                var b = this.listeners.getListeners("ButtonStateTransitionListener");
                while (b.hasNext()) {
                    b.next().released()
                }
            }
            ;
            ButtonModel.prototype.fireResume = function() {
                var b = this.listeners.getListeners("ButtonStateTransitionListener");
                while (b.hasNext()) {
                    b.next().resume()
                }
            }
            ;
            ButtonModel.prototype.fireStateChanged = function(c) {
                var b = this.listeners.getListeners("ChangeListener");
                var d = new ChangeEvent(this,c);
                while (b.hasNext()) {
                    b.next().handleStateChanged(d)
                }
            }
            ;
            ButtonModel.prototype.fireSuspend = function() {
                var b = this.listeners.getListeners("ButtonStateTransitionListener");
                while (b.hasNext()) {
                    b.next().suspend()
                }
            }
            ;
            ButtonModel.prototype.getFlag = function(b) {
                return (this.state & b) != 0
            }
            ;
            ButtonModel.prototype.getGroup = function() {
                return this.group
            }
            ;
            ButtonModel.prototype.getUserData = function() {
                return this.data
            }
            ;
            ButtonModel.prototype.installFiringBehavior = function() {
                this.setFiringBehavior(ButtonModel.DEFAULT_FIRING_BEHAVIOR)
            }
            ;
            ButtonModel.prototype.isArmed = function() {
                return (this.state & ButtonModel.ARMED_FLAG) != 0
            }
            ;
            ButtonModel.prototype.isEnabled = function() {
                return (this.state & ButtonModel.ENABLED_FLAG) != 0
            }
            ;
            ButtonModel.prototype.isMouseOver = function() {
                return (this.state & ButtonModel.MOUSEOVER_FLAG) != 0
            }
            ;
            ButtonModel.prototype.isPressed = function() {
                return (this.state & ButtonModel.PRESSED_FLAG) != 0
            }
            ;
            ButtonModel.prototype.isSelected = function() {
                if (this.group == null ) {
                    return (this.state & ButtonModel.SELECTED_FLAG) != 0
                } else {
                    return this.group.isSelected(this)
                }
            }
            ;
            ButtonModel.prototype.removeActionListener = function(b) {
                this.listeners.removeListener("ActionListener", b)
            }
            ;
            ButtonModel.prototype.removeChangeListener = function(b) {
                this.listeners.removeListener("ChangeListener", b)
            }
            ;
            ButtonModel.prototype.removeStateTransitionListener = function(b) {
                this.listeners.removeListener("ButtonStateTransitionListener", b)
            }
            ;
            ButtonModel.prototype.setArmed = function(b) {
                if (this.isArmed() == b) {
                    return
                }
                if (!this.isEnabled()) {
                    return
                }
                this.setFlag(ButtonModel.ARMED_FLAG, b);
                this.fireStateChanged(ButtonModel.ARMED_PROPERTY)
            }
            ;
            ButtonModel.prototype.setEnabled = function(b) {
                if (this.isEnabled() == b) {
                    return
                }
                if (!b) {
                    this.setMouseOver(false);
                    this.setArmed(false);
                    this.setPressed(false)
                }
                this.setFlag(ButtonModel.ENABLED_FLAG, b);
                this.fireStateChanged(ButtonModel.ENABLED_PROPERTY)
            }
            ;
            ButtonModel.prototype.setFiringBehavior = function(b) {
                if (this.firingBehavior != null ) {
                    this.removeStateTransitionListener(this.firingBehavior)
                }
                switch (b) {
                case ButtonModel.REPEAT_FIRING_BEHAVIOR:
                    this.firingBehavior = new RepeatFiringBehavior(this);
                    break;
                default:
                    this.firingBehavior = new DefaultFiringBehavior(this)
                }
                this.addStateTransitionListener(this.firingBehavior)
            }
            ;
            ButtonModel.prototype.setFlag = function(b, c) {
                if (c) {
                    this.state |= b
                } else {
                    this.state &= ~b
                }
            }
            ;
            ButtonModel.prototype.setGroup = function(b) {
                if (this.group == b) {
                    return
                }
                if (this.group != null ) {
                    this.group.remove(this)
                }
                this.group = b;
                if (this.group != null ) {
                    this.group.add(this)
                }
            }
            ;
            ButtonModel.prototype.setMouseOver = function(b) {
                if (this.isMouseOver() == b) {
                    return
                }
                if (this.isPressed()) {
                    if (b) {
                        this.fireResume()
                    } else {
                        this.fireSuspend()
                    }
                }
                this.setFlag(ButtonModel.MOUSEOVER_FLAG, b);
                this.fireStateChanged(ButtonModel.MOUSEOVER_PROPERTY)
            }
            ;
            ButtonModel.prototype.setPressed = function(b) {
                if (this.isPressed() == b) {
                    return
                }
                this.setFlag(ButtonModel.PRESSED_FLAG, b);
                if (b) {
                    this.firePressed()
                } else {
                    if (this.isArmed()) {
                        this.fireReleased()
                    } else {
                        this.fireCanceled()
                    }
                }
                this.fireStateChanged(ButtonModel.PRESSED_PROPERTY)
            }
            ;
            ButtonModel.prototype.setSelected = function(b) {
                if (this.group == null ) {
                    if (this.isSelected() == b) {
                        return
                    }
                } else {
                    this.group.setSelected(this, b);
                    if (this.getFlag(ButtonModel.SELECTED_FLAG) == this.isSelected()) {
                        return
                    }
                }
                this.setFlag(ButtonModel.SELECTED_FLAG, b);
                this.fireStateChanged(ButtonModel.SELECTED_PROPERTY)
            }
            ;
            ButtonModel.prototype.setUserData = function(b) {
                this.data = b
            }
            ;
            ButtonModel.prototype.init = function() {
                this.parentMethod("init");
                this.state = ButtonModel.ENABLED_FLAG;
                this.data = new Object();
                this.actionName = null ;
                this.group = null ;
                this.listeners = new EventListenerList();
                this.firingBehavior = null ;
                this.installFiringBehavior()
            }
        }
        ButtonModel._initialized = true;
        _classes.defineClass("ButtonModel", a)
    }
    this.init()
}
ButtonModel.ENABLED_PROPERTY = "enabled";
ButtonModel.PRESSED_PROPERTY = "pressed";
ButtonModel.SELECTED_PROPERTY = "selected";
ButtonModel.ROLLOVER_ENABLED_PROPERTY = "rollover enabled";
ButtonModel.MOUSEOVER_PROPERTY = "mouseover";
ButtonModel.ARMED_PROPERTY = "armed";
ButtonModel.ARMED_FLAG = 1;
ButtonModel.PRESSED_FLAG = 2;
ButtonModel.MOUSEOVER_FLAG = 4;
ButtonModel.SELECTED_FLAG = 8;
ButtonModel.ENABLED_FLAG = 16;
ButtonModel.ROLLOVER_ENABLED_FLAG = 32;
ButtonModel.MAX_FLAG = ButtonModel.ROLLOVER_ENABLED_FLAG;
ButtonModel.DEFAULT_FIRING_BEHAVIOR = 0;
ButtonModel.REPEAT_FIRING_BEHAVIOR = 1;
_classes.registerClass("ButtonStateTransitionListener");
function ButtonStateTransitionListener() {
    if (typeof ButtonStateTransitionListener._initialized == "undefined") {
        function a() {
            ButtonStateTransitionListener.prototype.cancel = function() {}
            ;
            ButtonStateTransitionListener.prototype.canceled = function() {}
            ;
            ButtonStateTransitionListener.prototype.press = function() {}
            ;
            ButtonStateTransitionListener.prototype.pressed = function() {}
            ;
            ButtonStateTransitionListener.prototype.release = function() {}
            ;
            ButtonStateTransitionListener.prototype.released = function() {}
            ;
            ButtonStateTransitionListener.prototype.resume = function() {}
            ;
            ButtonStateTransitionListener.prototype.suspend = function() {}
            ;
            ButtonStateTransitionListener.prototype.init = function() {
                this.parentMethod("init")
            }
        }
        ButtonStateTransitionListener._initialized = true;
        _classes.defineClass("ButtonStateTransitionListener", a)
    }
    this.init()
}
_classes.registerClass("DefaultFiringBehavior", "ButtonStateTransitionListener");
function DefaultFiringBehavior(a) {
    if (typeof DefaultFiringBehavior._initialized == "undefined") {
        function b() {
            DefaultFiringBehavior.prototype.released = function() {
                this.host.fireActionPerformed()
            }
            ;
            DefaultFiringBehavior.prototype.init = function(c) {
                this.parentMethod("init");
                this.host = c
            }
        }
        DefaultFiringBehavior._initialized = true;
        _classes.defineClass("DefaultFiringBehavior", b)
    }
    this.init(a)
}
_classes.registerClass("RepeatFiringBehavior", "ButtonStateTransitionListener");
function RepeatFiringBehavior(a) {
    if (typeof RepeatFiringBehavior._initialized == "undefined") {
        function b() {
            RepeatFiringBehavior.prototype.pressed = function() {
                this.host.fireActionPerformed();
                if (!a.isEnabled()) {
                    return
                }
                this.resume()
            }
            ;
            RepeatFiringBehavior.prototype.canceled = function() {
                this.suspend()
            }
            ;
            RepeatFiringBehavior.prototype.released = function() {
                this.suspend()
            }
            ;
            RepeatFiringBehavior.prototype.resume = function() {
                var d = this.host;
                var h = this.timer;
                var c = this;
                var g = function() {
                    if (!d.isEnabled()) {
                        clearTimeout(h)
                    }
                    c.timer = setTimeout(g, c.INITIAL_DELAY);
                    d.fireActionPerformed()
                }
                ;
                this.timer = setTimeout(g, this.initialDelay)
            }
            ;
            RepeatFiringBehavior.prototype.suspend = function() {
                if (this.timer == null ) {
                    return
                }
                clearTimeout(this.timer);
                this.timer = null 
            }
            ;
            RepeatFiringBehavior.prototype.init = function(c) {
                this.parentMethod("init");
                this.host = c;
                this.stepDelay = RepeatFiringBehavior.STEP_DELAY;
                this.initialDelay = RepeatFiringBehavior.INITIAL_DELAY;
                this.timer = null 
            }
        }
        RepeatFiringBehavior._initialized = true;
        _classes.defineClass("RepeatFiringBehavior", b)
    }
    this.init(a)
}
RepeatFiringBehavior.INITIAL_DELAY = 250;
RepeatFiringBehavior.STEP_DELAY = 40;
_classes.registerClass("ToggleModel", "ButtonModel");
function ToggleModel() {
    if (typeof ToggleModel._initialized == "undefined") {
        function a() {
            ToggleModel.prototype.fireActionPerformed = function() {
                this.setSelected(!this.isSelected());
                this.isa = "ToggleModel";
                this.parentMethod("fireActionPerformed")
            }
            ;
            ToggleModel.prototype.init = function() {
                this.parentMethod("init")
            }
        }
        ToggleModel._initialized = true;
        _classes.defineClass("ToggleModel", a)
    }
    this.init()
}
_classes.registerClass("ScrollPane", "Figure");
function ScrollPane(b) {
    if (typeof ScrollPane._initialized == "undefined") {
        function a() {
            ScrollPane.prototype.createHorizontalScrollBar = function() {
                var c = new ScrollBar(this.id + "-scrollBar-H");
                c.setHorizontal(true);
                this.setHorizontalScrollBar(c)
            }
            ;
            ScrollPane.prototype.createViewport = function() {
                this.setViewport(new Viewport(this.id + "-viewPort"))
            }
            ;
            ScrollPane.prototype.createVerticalScrollBar = function() {
                var c = new ScrollBar(this.id + "-scrollBar-V");
                this.setVerticalScrollBar(c)
            }
            ;
            ScrollPane.prototype.getHorizontalScrollBar = function() {
                if (this.hBar == null ) {
                    this.createHorizontalScrollBar()
                }
                return this.hBar
            }
            ;
            ScrollPane.prototype.getHorizontalScrollBarVisibility = function() {
                return this.hVisibility
            }
            ;
            ScrollPane.prototype.getVerticalScrollBar = function() {
                if (this.vBar == null ) {
                    this.createVerticalScrollBar()
                }
                return this.vBar
            }
            ;
            ScrollPane.prototype.getVerticalScrollBarVisibility = function() {
                return this.vVisibility
            }
            ;
            ScrollPane.prototype.getContents = function() {
                return this.getView()
            }
            ;
            ScrollPane.prototype.getView = function() {
                return this.getViewport().getContents()
            }
            ;
            ScrollPane.prototype.getViewport = function() {
                if (this.viewport == null ) {
                    this.createViewport()
                }
                return this.viewport
            }
            ;
            ScrollPane.prototype.isOpaque = function() {
                return true
            }
            ;
            ScrollPane.prototype.scrollHorizontalTo = function(c) {
                this.getViewport().setHorizontalLocation(c)
            }
            ;
            ScrollPane.prototype.scrollTo = function(c) {
                this.scrollHorizontalTo(c.x);
                this.scrollVerticalTo(c.y)
            }
            ;
            ScrollPane.prototype.scrollVerticalTo = function(c) {
                this.getViewport().setVerticalLocation(c)
            }
            ;
            ScrollPane.prototype.setContents = function(c) {
                this.setView(c)
            }
            ;
            ScrollPane.prototype.setHorizontalScrollBar = function(c) {
                if (this.hBar != null ) {
                    this.remove(this.hBar);
                    this.hBar.getRangeModel().removePropertyChangeListener(this.hBar)
                }
                this.hBar = c;
                if (this.hBar != null ) {
                    this.add(this.hBar);
                    this.hBar.setRangeModel(this.getViewport().getHorizontalRangeModel())
                }
            }
            ;
            ScrollPane.prototype.setHorizontalScrollBarVisibility = function(c) {
                if (this.hVisibility == c) {
                    return
                }
                this.hVisibility = c;
                this.revalidate()
            }
            ;
            ScrollPane.prototype.setScrollBarVisibility = function(c) {
                this.setHorizontalScrollBarVisibility(c);
                this.setVerticalScrollBarVisibility(c)
            }
            ;
            ScrollPane.prototype.setVerticalScrollBar = function(c) {
                if (this.vBar != null ) {
                    this.remove(this.vBar);
                    this.vBar.getRangeModel().removePropertyChangeListener(this.vBar)
                }
                this.vBar = c;
                if (this.vBar != null ) {
                    this.add(this.vBar);
                    this.vBar.setRangeModel(this.getViewport().getVerticalRangeModel())
                }
            }
            ;
            ScrollPane.prototype.setVerticalScrollBarVisibility = function(c) {
                if (this.vVisibility == c) {
                    return
                }
                this.vVisibility = c;
                this.revalidate()
            }
            ;
            ScrollPane.prototype.setView = function(c) {
                this.getViewport().setContents(c)
            }
            ;
            ScrollPane.prototype.setViewport = function(c) {
                if (this.viewport != null ) {
                    this.remove(this.viewport)
                }
                this.viewport = c;
                if (c != null ) {
                    this.add(c, 0)
                }
            }
            ;
            ScrollPane.prototype.validate = function() {
                this.isa = "ScrollPane";
                this.parentMethod("validate");
                this.getHorizontalScrollBar().validate();
                this.getVerticalScrollBar().validate()
            }
            ;
            ScrollPane.prototype.init = function(c) {
                this.parentMethod("init", c);
                this.viewport = null ;
                this.hBar = null ;
                this.vBar = null ;
                this.hVisibility = ScrollPane.AUTOMATIC;
                this.vVisibility = ScrollPane.AUTOMATIC;
                this.setLayoutManager(new ScrollPaneLayout())
            }
        }
        ScrollPane._initialized = true;
        _classes.defineClass("ScrollPane", a)
    }
    this.init(b)
}
ScrollPane.NEVER = 0;
ScrollPane.AUTOMATIC = 1;
ScrollPane.ALWAYS = 2;
_classes.registerClass("ScrollPaneLayout", "AbstractHintLayout");
function ScrollPaneLayout() {
    if (typeof ScrollPaneLayout._initialized == "undefined") {
        function a() {
            ScrollPaneLayout.prototype.calculateMinimumSize = function(b, g, m) {
                var l = b;
                var c = l.getInsets();
                var n = l.getViewport().getMinimumSize(g, m);
                return n.getExpanded(c.getWidth(), c.getHeight())
            }
            ;
            ScrollPaneLayout.prototype.calculatePreferredSize = function(b, g, m) {
                var o = b;
                var h = o.getHorizontalScrollBar();
                var n = o.getVerticalScrollBar();
                var c = o.getInsets();
                var l = c.getWidth();
                var d = c.getHeight();
                if (o.getVerticalScrollBarVisibility() != ScrollPane.NEVER) {
                    l += n.getPreferredSize().width
                }
                if (o.getHorizontalScrollBarVisibility() != ScrollPane.NEVER) {
                    d += h.getPreferredSize().height
                }
                if (g > -1) {
                    g = Math.max(0, g - l)
                }
                if (m > -1) {
                    m = Math.max(0, m - d)
                }
                return o.getViewport().getPreferredSize(g, m).getExpanded(l, d)
            }
            ;
            ScrollPaneLayout.prototype.layout = function(m) {
                var o = m;
                var h = o.getViewport();
                var g = o.getHorizontalScrollBar();
                var n = o.getVerticalScrollBar();
                var p = ScrollPaneSolver.solve(m.getClientArea(), h, o.getHorizontalScrollBarVisibility(), o.getVerticalScrollBarVisibility(), n.getPreferredSize().width, g.getPreferredSize().height);
                if (p.showV) {
                    n.setBounds(new Rectangle(p.viewportArea.right(),p.viewportArea.y,p.insets.right,p.viewportArea.height))
                }
                if (p.showH) {
                    g.setBounds(new Rectangle(p.viewportArea.x,p.viewportArea.bottom(),p.viewportArea.width,p.insets.bottom))
                }
                n.setVisible(p.showV);
                g.setVisible(p.showH);
                var l = n.getStepIncrement();
                var b = n.getRangeModel().getExtent() - l;
                if (b < l) {
                    b = l
                }
                n.setPageIncrement(b);
                var c = g.getStepIncrement();
                var d = g.getRangeModel().getExtent() - c;
                if (d < c) {
                    d = c
                }
                g.setPageIncrement(d)
            }
            ;
            ScrollPaneLayout.prototype.init = function() {
                this.parentMethod("init")
            }
        }
        ScrollPaneLayout._initialized = true;
        _classes.defineClass("ScrollPaneLayout", a)
    }
    this.init()
}
ScrollPaneLayout.NEVER = ScrollPane.NEVER;
ScrollPaneLayout.AUTO = ScrollPane.AUTOMATIC;
ScrollPaneLayout.ALWAYS = ScrollPane.ALWAYS;
ScrollPaneSolver = new Object();
ScrollPaneSolver.NEVER = 0;
ScrollPaneSolver.AUTOMATIC = 1;
ScrollPaneSolver.ALWAYS = 2;
ScrollPaneSolver.solve = function(h, m, a, d, l, p) {
    var v = new Object();
    v.insets = new Insets();
    v.insets.bottom = p;
    v.insets.right = l;
    var b = h.getSize();
    var s = new Dimension(b).shrink((d == ScrollPaneSolver.NEVER ? 0 : v.insets.right), (a == ScrollPaneSolver.NEVER ? 0 : v.insets.bottom));
    s.width = Math.max(s.width, 0);
    s.height = Math.max(s.height, 0);
    var c = s.width;
    var o = s.height;
    var u = m.getPreferredSize(c, o).getCopy();
    var r = m.getInsets();
    viewportMinSize = new Dimension(r.getWidth(),r.getHeight());
    if (m.getContents() != null ) {
        if (m.getContentsTracksHeight() && o > -1) {
            o = Math.max(0, o - r.getHeight())
        }
        if (m.getContentsTracksWidth() && c > -1) {
            c = Math.max(0, c - r.getWidth())
        }
        viewportMinSize.expand(m.getContents().getMinimumSize(c, o))
    }
    if (m.getContentsTracksHeight()) {
        u.height = viewportMinSize.height
    }
    if (m.getContentsTracksWidth()) {
        u.width = viewportMinSize.width
    }
    var q = b.contains(u);
    var n = !q && u.containsProper(s);
    var t = n || u.height > b.height;
    var g = n || u.width > b.width;
    v.showV = d != ScrollPaneSolver.NEVER && (t || d == ScrollPaneSolver.ALWAYS);
    v.showH = a != ScrollPaneSolver.NEVER && (g || a == ScrollPaneSolver.ALWAYS);
    if (!v.showV) {
        v.insets.right = 0
    }
    if (!v.showH) {
        v.insets.bottom = 0
    }
    v.viewportArea = h.getCropped(v.insets);
    m.setBounds(v.viewportArea);
    return v
}
;
_classes.registerClass("ScrollBarLayout", "AbstractLayout");
function ScrollBarLayout(a) {
    function b() {
        ScrollBarLayout.prototype.setConstraint = function(c, d) {
            if (d == ScrollBarLayout.UP_ARROW) {
                this.up = c
            } else {
                if (d == ScrollBarLayout.DOWN_ARROW) {
                    this.down = c
                } else {
                    if (d == ScrollBarLayout.THUMB) {
                        this.thumb = c
                    } else {
                        if (d == ScrollBarLayout.PAGE_UP) {
                            this.pageUp = c
                        } else {
                            if (d == ScrollBarLayout.PAGE_DOWN) {
                                this.pageDown = c
                            }
                        }
                    }
                }
            }
        }
        ;
        ScrollBarLayout.prototype.calculatePreferredSize = function(m, g, l) {
            var c = this.transposer.t(m.getInsets());
            var n = new Dimension(16,16 * 4);
            n.expand(c.getWidth(), c.getHeight());
            return this.transposer.t(n)
        }
        ;
        ScrollBarLayout.prototype.layout = function(q) {
            var c = q;
            var r = this.layoutButtons(c);
            var s = c.getExtent();
            var o = c.getMaximum();
            var d = c.getMinimum();
            var p = o - d;
            var m = p - s;
            if ((m < 1) || (!c.isEnabled())) {
                var t = new Rectangle(r);
                var h = new Rectangle(r);
                t.height /= 2;
                h.y += t.height;
                h.height = r.height - t.height;
                if (this.pageUp != null ) {
                    this.pageUp.setBounds(this.transposer.t(t))
                }
                if (this.pageDown != null ) {
                    this.pageDown.setBounds(this.transposer.t(h))
                }
                return
            }
            if (p == 0) {
                return
            }
            var g = Math.max(this.thumb == null  ? 0 : this.thumb.getMinimumSize().height, r.height * s / p);
            if (this.thumb != null ) {
                this.thumb.setVisible(r.height > g)
            }
            var n = r.y + (r.height - g) * (c.getValue() - d) / m;
            var l = new Rectangle(r.x,n,r.width,g);
            if (this.thumb != null ) {
                this.thumb.setBounds(this.transposer.t(l))
            }
            if (this.pageUp != null ) {
                this.pageUp.setBounds(this.transposer.t(new Rectangle(r.x,r.y,r.width,l.y - r.y)))
            }
            if (this.pageDown != null ) {
                this.pageDown.setBounds(this.transposer.t(new Rectangle(r.x,l.y + g,r.width,r.bottom() - l.bottom())))
            }
        }
        ;
        ScrollBarLayout.prototype.layoutButtons = function(l) {
            var h = this.transposer.t(l.getClientArea());
            var d = new Dimension(h.width,Math.min(h.width, h.height / 2));
            if (this.up != null ) {
                this.up.setBounds(this.transposer.t(new Rectangle(h.getTopLeft(),d)))
            }
            if (this.down != null ) {
                var g = new Rectangle(h.x,h.bottom() - d.height,d.width,d.height);
                this.down.setBounds(this.transposer.t(g))
            }
            var c = h.getCropped(new Insets((this.up == null ) ? 0 : d.height,0,(this.down == null ) ? 0 : d.height,0));
            return c
        }
        ;
        ScrollBarLayout.prototype.remove = function(c) {
            if (c == this.up) {
                this.up = null 
            } else {
                if (c == this.down) {
                    this.down = null 
                } else {
                    if (c == this.thumb) {
                        this.thumb = null 
                    } else {
                        if (c == this.pageUp) {
                            this.pageUp = null 
                        } else {
                            if (c == this.pageDown) {
                                this.pageDown = null 
                            }
                        }
                    }
                }
            }
        }
        ;
        ScrollBarLayout.prototype.init = function(c) {
            this.parentMethod("init");
            this.up = null ;
            this.down = null ;
            this.thumb = null ;
            this.pageUp = null ;
            this.pageDown = null ;
            this.transposer = c
        }
    }
    _classes.defineClass("ScrollBarLayout", b);
    this.init(a)
}
ScrollBarLayout.UP_ARROW = "up arrow";
ScrollBarLayout.DOWN_ARROW = "down arrow";
ScrollBarLayout.THUMB = "thumb";
ScrollBarLayout.PAGE_UP = "page_up";
ScrollBarLayout.PAGE_DOWN = "page_down";
_classes.registerClass("ScrollBar", "Figure");
function ScrollBar(b) {
    if (typeof ScrollBar._initialized == "undefined") {
        function a() {
            ScrollBar.prototype.createDefaultUpButton = function() {
                var c = new ArrowButton(this.id + "-ArrowButton-up");
                return c
            }
            ;
            ScrollBar.prototype.createDefaultDownButton = function() {
                var c = new ArrowButton(this.id + "-ArrowButton-down");
                return c
            }
            ;
            ScrollBar.prototype.createPageDown = function() {
                return this.createPageUp()
            }
            ;
            ScrollBar.prototype.createPageUp = function() {
                var c = new Clickable(this.id + "-Clickable-pageup");
                c.setOpaque(true);
                c.setBackgroundColor(ScrollBar.COLOR_TRACK);
                c.setRequestFocusEnabled(false);
                c.setFocusTraversable(false);
                var d = new Object();
                d.handleStateChanged = function(g) {
                    if (c.getModel().isArmed()) {
                        c.setBackgroundColor(ColorConstants.black)
                    } else {
                        c.setBackgroundColor(ScrollBar.COLOR_TRACK)
                    }
                }
                ;
                c.addChangeListener(d);
                return c
            }
            ;
            ScrollBar.prototype.createDefaultThumb = function() {
                var c = new Panel(this.id + "-thumb");
                c.setMinimumSize(new Dimension(6,6));
                c.setBackgroundColor(ScrollBar.COLOR_THUMB);
                var d = new LineBorder();
                d.setColor(new Color(151,151,151));
                c.setBorder(d);
                return c
            }
            ;
            ScrollBar.prototype.getButtonUp = function() {
                return this.buttonUp
            }
            ;
            ScrollBar.prototype.getButtonDown = function() {
                return this.buttonDown
            }
            ;
            ScrollBar.prototype.getExtent = function() {
                return this.getRangeModel().getExtent()
            }
            ;
            ScrollBar.prototype.getMinimum = function() {
                return this.getRangeModel().getMinimum()
            }
            ;
            ScrollBar.prototype.getMaximum = function() {
                return this.getRangeModel().getMaximum()
            }
            ;
            ScrollBar.prototype.getPageDown = function() {
                return this.pageDown
            }
            ;
            ScrollBar.prototype.getPageIncrement = function() {
                return this.pageIncrement
            }
            ;
            ScrollBar.prototype.getPageUp = function() {
                return this.pageUp
            }
            ;
            ScrollBar.prototype.getRangeModel = function() {
                return this.rangeModel
            }
            ;
            ScrollBar.prototype.getStepIncrement = function() {
                return this.stepIncrement
            }
            ;
            ScrollBar.prototype.getThumb = function() {
                return this.thumb
            }
            ;
            ScrollBar.prototype.getValue = function() {
                return this.getRangeModel().getValue()
            }
            ;
            ScrollBar.prototype.getValueRange = function() {
                return this.getMaximum() - this.getExtent() - this.getMinimum()
            }
            ;
            ScrollBar.prototype.isHorizontal = function() {
                return this._isHorizontal
            }
            ;
            ScrollBar.prototype.pageDown = function() {
                this.setValue(this.getValue() + this.getPageIncrement())
            }
            ;
            ScrollBar.prototype.pageUp = function() {
                this.setValue(this.getValue() - this.getPageIncrement())
            }
            ;
            ScrollBar.prototype.propertyChange = function(c) {
                if (c.getSource() != null  && Util.isInstanceOf(c.getSource(), DefaultRangeModel)) {
                    this.setEnabled(this.getRangeModel().isEnabled());
                    if (DefaultRangeModel.PROPERTY_VALUE == c.getPropertyName()) {
                        this.firePropertyChange("value", c.getOldValue(), c.getNewValue());
                        this.revalidate()
                    }
                    if (DefaultRangeModel.PROPERTY_MINIMUM == c.getPropertyName()) {
                        this.firePropertyChange("value", c.getOldValue(), c.getNewValue());
                        this.revalidate()
                    }
                    if (DefaultRangeModel.PROPERTY_MAXIMUM == c.getPropertyName()) {
                        this.firePropertyChange("value", c.getOldValue(), c.getNewValue());
                        this.revalidate()
                    }
                    if (DefaultRangeModel.PROPERTY_EXTENT == c.getPropertyName()) {
                        this.firePropertyChange("value", c.getOldValue(), c.getNewValue());
                        this.revalidate()
                    }
                }
            }
            ;
            ScrollBar.prototype.revalidate = function() {
                this.invalidate();
                this.getUpdateManager().addInvalidFigure(this)
            }
            ;
            ScrollBar.prototype.setDirection = function(c) {}
            ;
            ScrollBar.prototype.setDownClickable = function(g) {
                if (this.buttonDown != null ) {
                    this.remove(this.buttonDown)
                }
                this.buttonDown = g;
                if (this.buttonDown != null ) {
                    if (this.buttonDown.setDirection != null ) {
                        this.buttonDown.setDirection(this.isHorizontal() ? PositionConstants.EAST : PositionConstants.SOUTH)
                    }
                    this.buttonDown.setFiringMethod(Clickable.REPEAT_FIRING);
                    var c = this;
                    var d = new Object();
                    d.actionPerformed = function(h) {
                        c.stepDown()
                    }
                    ;
                    this.buttonDown.addActionListener(d);
                    this.add(this.buttonDown, ScrollBarLayout.DOWN_ARROW)
                }
            }
            ;
            ScrollBar.prototype.setUpClickable = function(c) {
                if (this.buttonUp != null ) {
                    this.remove(this.buttonUp)
                }
                this.buttonUp = c;
                if (c != null ) {
                    if (c.setDirection != null ) {
                        c.setDirection(this.isHorizontal() ? PositionConstants.WEST : PositionConstants.NORTH)
                    }
                    this.buttonUp.setFiringMethod(Clickable.REPEAT_FIRING);
                    var d = this;
                    var g = new Object();
                    g.actionPerformed = function(h) {
                        d.stepUp()
                    }
                    ;
                    this.buttonUp.addActionListener(g);
                    this.add(this.buttonUp, ScrollBarLayout.UP_ARROW)
                }
            }
            ;
            ScrollBar.prototype.setEnabled = function(c) {
                if (this.isEnabled() == c) {
                    return
                }
                this.isa = "ScrollBar";
                this.parentMethod("setEnabled", c);
                this.setChildrenEnabled(c);
                if (this.getThumb() != null ) {
                    this.getThumb().setVisible(c);
                    this.revalidate()
                }
            }
            ;
            ScrollBar.prototype.setExtent = function(c) {
                if (this.getExtent() == c) {
                    return
                }
                this.getRangeModel().setExtent(c)
            }
            ;
            ScrollBar.prototype.setHorizontal = function(c) {
                this.setOrientation(c ? PositionConstants.HORIZONTAL : PositionConstants.VERTICAL)
            }
            ;
            ScrollBar.prototype.setMaximum = function(c) {
                if (this.getMaximum() == c) {
                    return
                }
                this.getRangeModel().setMaximum(c)
            }
            ;
            ScrollBar.prototype.setMinimum = function(c) {
                if (this.getMinimum() == c) {
                    return
                }
                this.getRangeModel().setMinimum(c)
            }
            ;
            ScrollBar.prototype.setOrientation = function(c) {
                if ((c == PositionConstants.HORIZONTAL) == this.isHorizontal()) {
                    return
                }
                this._isHorizontal = (c == PositionConstants.HORIZONTAL);
                this.transposer.setEnabled(this._isHorizontal);
                this.setChildrenOrientation(c);
                this.isa = "ScrollBar";
                this.parentMethod("revalidate")
            }
            ;
            ScrollBar.prototype.setPageIncrement = function(c) {
                var d = c
            }
            ;
            ScrollBar.prototype.setPageDown = function(g) {
                if (this.pageDown != null ) {
                    this.remove(this.pageDown)
                }
                this.pageDown = g;
                if (this.pageDown != null ) {
                    this.pageDown.setFiringMethod(Clickable.REPEAT_FIRING);
                    var c = this;
                    var d = new Object();
                    d.actionPerformed = function(h) {
                        c.pageDown()
                    }
                    ;
                    this.pageDown.addActionListener(d);
                    this.add(g, ScrollBarLayout.PAGE_DOWN)
                }
            }
            ;
            ScrollBar.prototype.setPageUp = function(c) {
                if (this.pageUp != null ) {
                    this.remove(this.pageUp)
                }
                this.pageUp = c;
                if (this.pageUp != null ) {
                    this.pageUp.setFiringMethod(Clickable.REPEAT_FIRING);
                    var d = this;
                    var g = new Object();
                    g.actionPerformed = function(h) {
                        d.pageUp()
                    }
                    ;
                    this.pageUp.addActionListener(g);
                    this.add(this.pageUp, ScrollBarLayout.PAGE_UP)
                }
            }
            ;
            ScrollBar.prototype.setRangeModel = function(c) {
                if (this.rangeModel != null ) {
                    this.rangeModel.removePropertyChangeListener(this)
                }
                this.rangeModel = c;
                c.addPropertyChangeListener(this)
            }
            ;
            ScrollBar.prototype.setStepIncrement = function(c) {
                this.stepIncrement = c
            }
            ;
            ScrollBar.prototype.setThumb = function(c) {
                if (this.thumb != null ) {
                    this.thumb.removeMouseListener(this.thumbDragger);
                    this.thumb.removeMouseMotionListener(this.thumbDragger);
                    this.remove(this.thumb)
                }
                this.thumb = c;
                if (this.thumb != null ) {
                    this.thumb.addMouseListener(this.thumbDragger);
                    this.thumb.addMouseMotionListener(this.thumbDragger);
                    this.add(this.thumb, ScrollBarLayout.THUMB)
                }
            }
            ;
            ScrollBar.prototype.setValue = function(c) {
                this.getRangeModel().setValue(c)
            }
            ;
            ScrollBar.prototype.stepDown = function() {
                this.setValue(this.getValue() + this.getStepIncrement())
            }
            ;
            ScrollBar.prototype.stepUp = function() {
                this.setValue(this.getValue() - this.getStepIncrement())
            }
            ;
            ScrollBar.prototype.initialize = function() {
                this.setLayoutManager(new ScrollBarLayout(this.transposer));
                this.setUpClickable(this.createDefaultUpButton());
                this.setDownClickable(this.createDefaultDownButton());
                this.setPageUp(this.createPageUp());
                this.setPageDown(this.createPageDown());
                this.setThumb(this.createDefaultThumb())
            }
            ;
            ScrollBar.prototype.init = function(d) {
                this.parentMethod("init", d);
                this.rangeModel = null ;
                this.thumb = null ;
                this.pageUp = null ;
                this.pageDown = null ;
                this.buttonUp = null ;
                this.buttonDown = null ;
                this.thumbDragger = new ThumbDragger(this);
                this._isHorizontal = false;
                this.pageIncrement = 50;
                this.stepIncrement = 10;
                this.transposer = new Transposer();
                this.setRangeModel(new DefaultRangeModel());
                this.initialize();
                var c = new LineBorder();
                c.setColor(new Color(227,227,227));
                this.setBorder(c)
            }
        }
        ScrollBar._initialized = true;
        _classes.defineClass("ScrollBar", a)
    }
    this.init(b)
}
ScrollBar.ORIENTATION_FLAG = Figure.MAX_FLAG << 1;
ScrollBar.MAX_FLAG = ScrollBar.ORIENTATION_FLAG;
ScrollBar.COLOR_TRACK = new Color(237,237,237);
ScrollBar.COLOR_THUMB = new Color(241,241,241);
ScrollBar.COLOR_BUTTON = new Color(12,38,52);
_classes.registerClass("ThumbDragger");
function ThumbDragger(a) {
    function b() {
        ThumbDragger.prototype.mousePressed = function(h) {
            this.armed = true;
            this.start = h.getLocation();
            var g = new Rectangle(this.host.transposer.t(this.host.getClientArea()));
            var c = this.host.transposer.t(this.host.getThumb().getSize());
            if (this.host.getButtonUp() != null ) {
                g.height -= this.host.transposer.t(this.host.getButtonUp().getSize()).height
            }
            if (this.host.getButtonDown() != null ) {
                g.height -= this.host.transposer.t(this.host.getButtonDown().getSize()).height
            }
            var d = new Dimension(g.width,g.height - c.height);
            this.dragRange = d.height;
            this.revertValue = this.host.getValue()
        }
        ;
        ThumbDragger.prototype.mouseDragged = function(c) {
            if (!this.armed) {
                return
            }
            var g = this.host.transposer.t(c.getLocation().getDifference(this.start));
            var d = this.host.getValueRange() * g.height / this.dragRange;
            this.host.setValue(this.revertValue + d)
        }
        ;
        ThumbDragger.prototype.mouseReleased = function(c) {
            if (!this.armed) {
                return
            }
            this.armed = false
        }
        ;
        ThumbDragger.prototype.init = function(c) {
            this.parentMethod("init");
            this.host = c;
            this.start = null ;
            this.dragRange = null ;
            this.revertValue = null ;
            this.armed = null 
        }
    }
    _classes.defineClass("ThumbDragger", b);
    this.init(a)
}
COM = {};
COM.NameSpace = {
    createNew: function() {
        var a = arguments, o = null , d, rt;
        for (var i = 0, l1 = a.length; i < l1; i++) {
            d = a[i].split(".");
            rt = d[0];
            eval("if (typeof " + rt + ' == "undefined"){' + rt + " = {};} o = " + rt + ";");
            for (var j = 1, l2 = d.length; j < l2; j++) {
                o[d[j]] = o[d[j]] || {};
                o = o[d[j]]
            }
        }
    }
};
COM.NameSpace.createNew("COM.Util", "COM.widget", "COM.draw2d", "COM.gef", "COM.engine");
function getCOMDomain() {
    return window
}
COM.engine.PropertyMap = function() {
    this._map = {}
}
;
COM.engine.PropertyMap.extend(Object, {
    isEmpty: function() {
        for (var a in this._map) {
            if (this._map.hasOwnProperty(a)) {
                return false
            }
        }
        return true
    },
    hasKey: function(a) {
        return this._map.hasOwnProperty(a)
    },
    put: function(a, b) {
        this._map[a] = b
    },
    get: function(a) {
        return this._map[a]
    },
    getKeys: function() {
        var b = [];
        for (var a in this._map) {
            if (this._map.hasOwnProperty(a)) {
                b.push(a)
            }
        }
        return b
    },
    getValues: function() {
        var a = [];
        for (var b in this._map) {
            if (this._map.hasOwnProperty(b)) {
                a.push(this._map[b])
            }
        }
        return a
    },
    remove: function(a) {
        delete this._map[a]
    },
    clear: function() {
        for (var a in this._map) {
            if (this._map.hasOwnProperty(a)) {
                delete this._map[a]
            }
        }
    },
    each: function(d, h) {
        var g = this.getKeys();
        for (var c = 0, a = g.length; c < a; c++) {
            var b = g[c];
            d.call(h, this.get(b), b, this)
        }
    },
    filter: function(g, l) {
        var d = [];
        var h = this.getKeys();
        for (var c = 0, a = h.length; c < a; c++) {
            var b = h[c];
            if (g.call(l, this.get(b), b, this)) {
                d.push(this.get(b))
            }
        }
        return d
    }
});
(function(d) {
    if (d.Array) {
        return
    }
    function h(o) {
        return typeof o == "object" && typeof o.length === "number" && !(o.propertyIsEnumerable("length"))
    }
    function b(q, p) {
        if (!h(q)) {
            return false
        }
        var o;
        for (o = 0; o < q.length; o++) {
            if (q[o] === p) {
                return true
            }
        }
        return false
    }
    function l(q, p) {
        if (!h(q)) {
            return -1
        }
        var o;
        for (o = 0; o < q.length; o++) {
            if (q[o] === p) {
                return o
            }
        }
        return -1
    }
    function g(q, p) {
        var o = l(q, p);
        if (o > -1) {
            q.splice(o, 1)
        }
    }
    function a(q) {
        if (!h(q)) {
            return []
        }
        var o = [];
        for (var p = 0; p < q.length; p++) {
            o.push(q[p])
        }
        return o
    }
    function n(q, p, o) {
        if (q != null  && o != null  && p != null ) {
            q.splice(o, 0, p)
        } else {
            if (p != null  && o == null ) {
                this.push(o)
            }
        }
    }
    function m(s, q, r) {
        for (var p = 0, o = s.length; p < o; p++) {
            q.call(r, s[p], p, this)
        }
    }
    var c = {};
    c.isArray = h;
    c.contains = b;
    c.indexOf = l;
    c.remove = g;
    c.copy = a;
    c.add = n;
    c.each = m;
    d.Array = c
})(COM.Util);
(function(b) {
    if (b.EventRegister) {
        return
    }
    function a(g, d, c) {
        (g.attachEvent) ? (g.attachEvent("on" + d, c)) : (g.addEventListener(d, c, false))
    }
    b.EventRegister = {
        addEvent: a
    }
})(COM.Util);
(function(a) {
    if (a.Common) {
        return
    }
    function b(d) {
        if (d) {
            d--;
            var c = [];
            while (d >= 0) {
                c.unshift(String.fromCharCode((d % 26 + 65)));
                d = Math.floor(d / 26) - 1
            }
            return c.join("")
        } else {
            return ""
        }
    }
    a.Common = {
        to26Str: b
    }
})(COM.Util);
(function(a) {
    if (a.browser) {
        return
    }
    a.browser = Util.browser
})(COM.Util);
Mouse = {
    BUTTON1: 1 << 19,
    BUTTON2: 1 << 20,
    BUTTON3: 1 << 21,
    BUTTON4: 1 << 22,
    BUTTON5: 1 << 23,
    BUTTON_ANY: this.BUTTON1 | this.BUTTON2 | this.BUTTON3 | this.BUTTON4 | this.BUTTON5,
    DOUBLE: 1 << 28,
    getStatemark: function(a) {
        if (a.buttonDown) {
            return Mouse.BUTTON1
        } else {
            return 0
        }
    },
    getMouseNumber: function(a) {
        return a.button
    }
};
SharedCursors = {
    CURSOR_TREE_ADD: ""
};
function KeyStroke(b, c, a, d) {
    this.stateMask = a;
    this.character = b;
    this.onPressed = d;
    this.keyCode = c
}
KeyStroke.prototype.equals = function(a) {
    if (a == null ) {
        return
    }
    if (a instanceof KeyStroke) {
        return a.character == this.character && a.keyCode == this.keyCode && a.onPressed == this.onPressed && a.stateMask == this.stateMask
    }
    return false
}
;
KeyStroke.prototype.hashCode = function(a) {
    return (this.stateMask + 1) * ((this.character ^ this.keyCode) + 1) + (this.onPressed ? 0 : 32)
}
;
KeyStroke.prototype.toString = function(a) {
    return "<" + this.character + "," + this.keyCode + "," + this.onPressed + "," + this.stateMask + ">"
}
;
KeyStroke.KEYCODE_BIT = 1 << 24;
KeyStroke.ARROW_UP = KeyStroke.KEYCODE_BIT + 1;
KeyStroke.ARROW_DOWN = KeyStroke.KEYCODE_BIT + 2;
KeyStroke.ARROW_LEFT = KeyStroke.KEYCODE_BIT + 3;
KeyStroke.ARROW_RIGHT = KeyStroke.KEYCODE_BIT + 4;
KeyStroke.DEL = 127;
KeyStroke.ESC = 27;
KeyStroke.ALT = 1 << 16;
KeyStroke.CTRL = 1 << 18;
KeyStroke.SHIFT = 1 << 17;
KeyStroke.getStatemark = function(c, b, a) {
    var d = 0;
    if (c) {
        d |= KeyStroke.ALT
    }
    if (b) {
        d |= KeyStroke.CTRL
    }
    if (a) {
        d |= KeyStroke.SHIFT
    }
    return d
}
;
KeyStroke.get = function(a, b) {
    return new KeyStroke(a.charCode,a.keyCode,getStatemark(a.altKey, a.ctrlKey, a.shiftKey),true)
}
;
KeyStroke.getPressedByCharacter = function(b, a) {
    return new KeyStroke(b,0,a,true)
}
;
KeyStroke.getPressedByKeyCode = function(b, a) {
    return new KeyStroke(0,b,a,true)
}
;
KeyStroke.getPressed = function(b, c, a) {
    return new KeyStroke(b,c,a,true)
}
;
KeyStroke.getReleasedByCharacter = function(b, a) {
    return new KeyStroke(b,0,a,false)
}
;
KeyStroke.getReleasedByKeyCode = function(b, a) {
    return new KeyStroke(0,b,a,false)
}
;
KeyStroke.getReleased = function(b, c, a) {
    return new KeyStroke(b,c,a,false)
}
;
COM.gef.ConditionalTreeSearch = function ConditionalTreeSearch(a, b, c) {
    COM.gef.ConditionalTreeSearch.superclass.constructor.call(this, a);
    this._viewer = b;
    this._condition = c
}
;
COM.gef.ConditionalTreeSearch.extend(ExclusionSearch, {
    accept: function(a) {
        var b = null ;
        while (b == null  && a != null ) {
            b = this._viewer.getVisualPartMap().get(a);
            a = a.getParent()
        }
        return b != null  && (this._condition == null  || this._condition.evaluate(b))
    }
});
COM.gef.EditPart = function EditPart() {}
;
COM.gef.EditPart.prototype.activate = Function.needOverride;
COM.gef.EditPart.prototype.addEditPartListener = Function.needOverride;
COM.gef.EditPart.prototype.addNotify = Function.needOverride;
COM.gef.EditPart.prototype.deactivate = Function.needOverride;
COM.gef.EditPart.prototype.eraseSourceFeedback = Function.needOverride;
COM.gef.EditPart.prototype.eraseTargetFeedback = Function.needOverride;
COM.gef.EditPart.prototype.getChildren = Function.needOverride;
COM.gef.EditPart.prototype.getCommand = Function.needOverride;
COM.gef.EditPart.prototype.getDragTracker = Function.needOverride;
COM.gef.EditPart.prototype.getEditPolicy = Function.needOverride;
COM.gef.EditPart.prototype.getModel = Function.needOverride;
COM.gef.EditPart.prototype.getParent = Function.needOverride;
COM.gef.EditPart.prototype.getRoot = Function.needOverride;
COM.gef.EditPart.prototype.getSelected = Function.needOverride;
COM.gef.EditPart.prototype.getTargetEditPart = Function.needOverride;
COM.gef.EditPart.prototype.getViewer = Function.needOverride;
COM.gef.EditPart.prototype.hasFocus = Function.needOverride;
COM.gef.EditPart.prototype.installEditPolicy = Function.needOverride;
COM.gef.EditPart.prototype.isActive = Function.needOverride;
COM.gef.EditPart.prototype.isSelectable = Function.needOverride;
COM.gef.EditPart.prototype.performRequest = Function.needOverride;
COM.gef.EditPart.prototype.refresh = Function.needOverride;
COM.gef.EditPart.prototype.removeEditPartListener = Function.needOverride;
COM.gef.EditPart.prototype.removeEditPolicy = Function.needOverride;
COM.gef.EditPart.prototype.removeNotify = Function.needOverride;
COM.gef.EditPart.prototype.setFocus = Function.needOverride;
COM.gef.EditPart.prototype.setModel = Function.needOverride;
COM.gef.EditPart.prototype.setParent = Function.needOverride;
COM.gef.EditPart.prototype.setSelected = Function.needOverride;
COM.gef.EditPart.prototype.showSourceFeedback = Function.needOverride;
COM.gef.EditPart.prototype.showTargetFeedback = Function.needOverride;
COM.gef.EditPart.prototype.understandsRequest = Function.needOverride;
COM.gef.EditPart.prototype.getId = Function.needOverride;
COM.gef.EditPart.SELECTED_NONE = 0;
COM.gef.EditPart.SELECTED = 1;
COM.gef.EditPart.SELECTED_PRIMARY = 2;
COM.gef.LayerConstants = {};
COM.gef.LayerConstants.PRIMARY_LAYER = "Primary Layer";
COM.gef.LayerConstants.CONNECTION_LAYER = "Connection Layer";
COM.gef.LayerConstants.GRID_LAYER = "Grid Layer";
COM.gef.LayerConstants.GUIDE_LAYER = "Guide Layer";
COM.gef.LayerConstants.HANDLE_LAYER = "Handle Layer";
COM.gef.LayerConstants.FEEDBACK_LAYER = "Feedback Layer";
COM.gef.LayerConstants.SCALED_FEEDBACK_LAYER = "Scaled Feedback Layer";
COM.gef.LayerConstants.PRINTABLE_LAYERS = "Printable Layers";
COM.gef.LayerConstants.SCALABLE_LAYERS = "Scalable Layers";
COM.gef.LayerManager = function LayerManager() {}
;
COM.gef.LayerManager.ID = {};
COM.gef.LayerManager.Helper = {
    find: function(a) {
        return a.getViewer().getEditPartRegistry().get(COM.gef.LayerManager.ID)
    }
};
COM.gef.EditPolicy = function EditPolicy() {}
;
COM.gef.EditPolicy.prototype.activate = Function.needOverride;
COM.gef.EditPolicy.prototype.deactivate = Function.needOverride;
COM.gef.EditPolicy.prototype.eraseSourceFeedback = Function.needOverride;
COM.gef.EditPolicy.prototype.eraseTargetFeedback = Function.needOverride;
COM.gef.EditPolicy.prototype.getCommand = Function.needOverride;
COM.gef.EditPolicy.prototype.getHost = Function.needOverride;
COM.gef.EditPolicy.prototype.getTargetEditPart = Function.needOverride;
COM.gef.EditPolicy.prototype.setHost = Function.needOverride;
COM.gef.EditPolicy.prototype.showSourceFeedback = Function.needOverride;
COM.gef.EditPolicy.prototype.showTargetFeedback = Function.needOverride;
COM.gef.EditPolicy.prototype.understandsRequest = Function.needOverride;
COM.gef.EditPolicy.COMPONENT_ROLE = "ComponentEditPolicy";
COM.gef.EditPolicy.CONNECTION_ENDPOINTS_ROLE = "Connection Endpoint Policy";
COM.gef.EditPolicy.CONNECTION_BENDPOINTS_ROLE = "Connection Bendpoint Policy";
COM.gef.EditPolicy.CONNECTION_ROLE = "ConnectionEditPolicy";
COM.gef.EditPolicy.CONTAINER_ROLE = "ContainerEditPolicy";
COM.gef.EditPolicy.DIRECT_EDIT_ROLE = "DirectEditPolicy";
COM.gef.EditPolicy.GRAPHICAL_NODE_ROLE = "GraphicalNodeEditPolicy";
COM.gef.EditPolicy.LAYOUT_ROLE = "LayoutEditPolicy";
COM.gef.EditPolicy.NODE_ROLE = "NodeEditPolicy";
COM.gef.EditPolicy.PRIMARY_DRAG_ROLE = "PrimaryDrag Policy";
COM.gef.EditPolicy.SELECTION_FEEDBACK_ROLE = "Selection Feedback";
COM.gef.EditPolicy.TREE_CONTAINER_ROLE = "TreeContainerEditPolicy";
COM.gef.EditPartFactory = function EditPartFactory() {}
;
COM.gef.EditPartFactory.prototype.createEditPart = Function.needOverride;
COM.gef.EditPartViewer = function EditPartViewer() {}
;
COM.gef.EditPartViewer.prototype.addSelectionChangedListener = Function.needOverride;
COM.gef.EditPartViewer.prototype.getSelection = Function.needOverride;
COM.gef.EditPartViewer.prototype.removeSelectionChangedListener = Function.needOverride;
COM.gef.EditPartViewer.prototype.setSelection = Function.needOverride;
COM.gef.EditPartViewer.prototype.addDragSourceListener = Function.needOverride;
COM.gef.EditPartViewer.prototype.addDropTargetListener = Function.needOverride;
COM.gef.EditPartViewer.prototype.addPropertyChangeListener = Function.needOverride;
COM.gef.EditPartViewer.prototype.appendSelection = Function.needOverride;
COM.gef.EditPartViewer.prototype.createControl = Function.needOverride;
COM.gef.EditPartViewer.prototype.deselect = Function.needOverride;
COM.gef.EditPartViewer.prototype.deselectAll = Function.needOverride;
COM.gef.EditPartViewer.prototype.findObjectAt = Function.needOverride;
COM.gef.EditPartViewer.prototype.findObjectAtExcluding = Function.needOverride;
COM.gef.EditPartViewer.prototype.flush = Function.needOverride;
COM.gef.EditPartViewer.prototype.getContents = Function.needOverride;
COM.gef.EditPartViewer.prototype.getContextMenu = Function.needOverride;
COM.gef.EditPartViewer.prototype.getControl = Function.needOverride;
COM.gef.EditPartViewer.prototype.getEditDomain = Function.needOverride;
COM.gef.EditPartViewer.prototype.getEditPartFactory = Function.needOverride;
COM.gef.EditPartViewer.prototype.getEditPartRegistry = Function.needOverride;
COM.gef.EditPartViewer.prototype.getFocusEditPart = Function.needOverride;
COM.gef.EditPartViewer.prototype.getKeyHandler = Function.needOverride;
COM.gef.EditPartViewer.prototype.getProperty = Function.needOverride;
COM.gef.EditPartViewer.prototype.getResourceManager = Function.needOverride;
COM.gef.EditPartViewer.prototype.getRootEditPart = Function.needOverride;
COM.gef.EditPartViewer.prototype.getSelectedEditParts = Function.needOverride;
COM.gef.EditPartViewer.prototype.getSelection = Function.needOverride;
COM.gef.EditPartViewer.prototype.getSelectionManager = Function.needOverride;
COM.gef.EditPartViewer.prototype.getVisualPartMap = Function.needOverride;
COM.gef.EditPartViewer.prototype.removePropertyChangeListener = Function.needOverride;
COM.gef.EditPartViewer.prototype.reveal = Function.needOverride;
COM.gef.EditPartViewer.prototype.select = Function.needOverride;
COM.gef.EditPartViewer.prototype.setContents = Function.needOverride;
COM.gef.EditPartViewer.prototype.setContextMenu = Function.needOverride;
COM.gef.EditPartViewer.prototype.setControl = Function.needOverride;
COM.gef.EditPartViewer.prototype.setCursor = Function.needOverride;
COM.gef.EditPartViewer.prototype.setEditDomain = Function.needOverride;
COM.gef.EditPartViewer.prototype.setEditPartFactory = Function.needOverride;
COM.gef.EditPartViewer.prototype.setFocus = Function.needOverride;
COM.gef.EditPartViewer.prototype.setKeyHandler = Function.needOverride;
COM.gef.EditPartViewer.prototype.setProperty = Function.needOverride;
COM.gef.EditPartViewer.prototype.setRootEditPart = Function.needOverride;
COM.gef.EditPartViewer.prototype.setRouteEventsToEditDomain = Function.needOverride;
COM.gef.EditPartViewer.prototype.setSelectionManager = Function.needOverride;
COM.gef.EditPartViewer.prototype.setSelectionManager = Function.needOverride;
COM.gef.EditPartViewer.Conditional = function() {}
;
COM.gef.EditPartViewer.Conditional.prototype.evaluate = Function.needOverride;
COM.gef.Command = function Command(a) {
    COM.gef.Command.superclass.constructor.call(this);
    this.label = null ;
    this.debugLabel = null ;
    if (a != null ) {
        this.setLabel(a)
    }
}
;
COM.gef.Command.extend(Object, {
    canExecute: function() {
        return true
    },
    canUndo: function() {
        return true
    },
    chain: function(b) {
        if (b == null ) {
            return this
        }
        var a = new COM.gef.CompoundCommand();
        a.chain = function(d) {
            this.add(d);
            return this
        }
        ;
        a.setDebugLabel("Chained Commands");
        result.add(this);
        result.add(b);
        return result
    },
    dispose: function() {},
    execute: function() {},
    getDebugLabel: function() {
        return this.debugLabel + " " + this.getLabel()
    },
    getLabel: function() {
        return this.label
    },
    redo: function() {
        this.execute()
    },
    setDebugLabel: function(a) {
        this.debugLabel = a
    },
    setLabel: function(a) {
        this.label = a
    },
    undo: function() {}
});
COM.gef.UnexecutableCommand = function UnexecutableCommand(a) {
    COM.gef.UnexecutableCommand.superclass.constructor.call(this)
}
;
COM.gef.UnexecutableCommand.extend(COM.gef.Command, {
    canExecute: function() {
        return false
    },
    canUndo: function() {
        return false
    }
});
COM.gef.UnexecutableCommand.INSTANCE = new COM.gef.UnexecutableCommand();
COM.gef.CommandStack = function CommandStack(a) {
    COM.gef.CommandStack.superclass.constructor.call(this);
    this.eventListeners = [];
    this.redoable = [];
    this.saveLocation = 0;
    this.undoable = [];
    this.undoLimit = 0;
    this.listeners = []
}
;
COM.gef.CommandStack.extend(Object, {
    addCommandStackEventListener: function(a) {
        this.eventListeners.push(a)
    },
    canRedo: function() {
        return this.redoable.length != 0
    },
    canUndo: function() {
        if (this.undoable.length == 0) {
            return false
        }
        return this.undoable[this.undoable.length - 1].canUndo()
    },
    dispose: function() {
        this.flushUndo();
        this.flushRedo()
    },
    execute: function(a) {
        if (a == null  || !a.canExecute()) {
            return
        }
        this.flushRedo();
        this.notifyListeners(a, COM.gef.CommandStack.PRE_EXECUTE);
        try {
            a.execute();
            if (this.getUndoLimit() > 0) {
                while (this.undoable.length >= this.getUndoLimit()) {
                    this.undoable.shift().dispose();
                    if (this.saveLocation > -1) {
                        this.saveLocation--
                    }
                }
            }
            if (this.saveLocation > this.undoable.length) {
                this.saveLocation = -1
            }
            this.undoable.push(a)
        } finally {
            this.notifyListeners(a, COM.gef.CommandStack.POST_EXECUTE)
        }
    },
    flush: function() {
        this.flushRedo();
        this.flushUndo();
        this.saveLocation = 0
    },
    flushRedo: function() {
        while (this.redoable.length > 0) {
            this.redoable.pop().dispose()
        }
    },
    flushUndo: function() {
        while (this.undoable.length > 0) {
            this.undoable.pop().dispose()
        }
    },
    getCommands: function() {
        var a = COM.Util.Array.copy(this.undoable);
        for (var b = this.redoable.length - 1; b >= 0; b--) {
            a.push(this.redoable[b])
        }
        return a
    },
    getRedoCommand: function() {
        return this.redoable.length ? this.redoable[this.redoable.length - 1] : null 
    },
    getUndoCommand: function() {
        return this.undoable.length ? this.undoable[this.undoable.length - 1] : null 
    },
    getUndoLimit: function() {
        return this.undoLimit
    },
    isDirty: function() {
        return this.undoable.length != this.saveLocation
    },
    markSaveLocation: function() {
        this.saveLocation = this.undoable.length
    },
    notifyListeners: function(d, c) {
        var b = new COM.gef.CommandStackEvent(this,d,c);
        for (var a = 0; a < this.listeners.length; a++) {
            this.listeners[a].stackChanged(b)
        }
    },
    redo: function() {
        if (!this.canRedo()) {
            return
        }
        var a = this.redoable.pop();
        this.notifyListeners(a, COM.gef.CommandStack.PRE_REDO);
        try {
            a.redo();
            this.undoable.push(a)
        } finally {
            this.notifyListeners(a, COM.gef.CommandStack.POST_REDO)
        }
    },
    removeCommandStackEventListener: function(a) {
        COM.Util.Array.remove(this.eventListeners, a)
    },
    setUndoLimit: function(a) {
        this.undoLimit = a
    },
    undo: function() {
        var a = this.undoable.pop();
        this.notifyListeners(a, COM.gef.CommandStack.PRE_UNDO);
        try {
            a.undo();
            this.redoable.push(a)
        } finally {
            this.notifyListeners(a, COM.gef.CommandStack.POST_UNDO)
        }
    }
});
COM.gef.CommandStack.POST_EXECUTE = 8;
COM.gef.CommandStack.POST_REDO = 16;
COM.gef.CommandStack.POST_UNDO = 32;
COM.gef.CommandStack.POST_MASK = (COM.gef.CommandStack.POST_EXECUTE | COM.gef.CommandStack.POST_UNDO | COM.gef.CommandStack.POST_REDO);
COM.gef.CommandStack.PRE_EXECUTE = 1;
COM.gef.CommandStack.PRE_REDO = 2;
COM.gef.CommandStack.PRE_UNDO = 4;
COM.gef.CommandStack.PRE_MASK = (COM.gef.CommandStack.PRE_EXECUTE | COM.gef.CommandStack.PRE_UNDO | COM.gef.CommandStack.PRE_REDO);
COM.gef.EventObject = function EventObject(a) {
    if (a == null ) {
        throw {
            type: "��ֵ",
            message: "sourceΪ��"
        }
    }
    this.source = a
}
;
COM.gef.EventObject.extend(Object, {
    getSource: function() {
        return this.source
    },
    toString: function() {
        return "COM.gef.EventObject[source=" + source + "]"
    }
});
COM.gef.CommandStackEvent = function CommandStackEvent(a, d, b) {
    COM.gef.CommandStackEvent.superclass.constructor.call(this, a);
    this.command = d;
    this.detail = b
}
;
COM.gef.CommandStackEvent.extend(COM.gef.EventObject, {
    getCommand: function() {
        return this.command
    },
    isPreChangeEvent: function() {
        return 0 != (this.getDetail() & COM.gef.CommandStack.PRE_MASK)
    },
    isPostChangeEvent: function() {
        return 0 != (this.getDetail() & COM.gef.CommandStack.POST_MASK)
    },
    getDetail: function() {
        return this.detail
    }
});
COM.gef.DomainEventDispatcher = function DomainEventDispatcher(a, b) {
    COM.gef.DomainEventDispatcher.superclass.constructor.call(this, a, b);
    this.domain = a;
    this.viewer = b;
    this.editorCaptured = false;
    this.setEnableKeyTraversal(false);
    this.overrideCursor = null 
}
;
COM.gef.DomainEventDispatcher.extend(Html5EventDispatcher, {
    dispatchFocusGained: function(a) {
        COM.gef.DomainEventDispatcher.superclass.dispatchFocusGained.call(this, a);
        this.domain.focusGained(a, this.viewer)
    },
    dispatchFocusLost: function(a) {
        COM.gef.DomainEventDispatcher.superclass.dispatchFocusLost.call(this, a);
        this.domain.focusLost(a, this.viewer);
        this.setRouteEventsToEditor(false)
    },
    _superDispatch: function(a, b) {
        if (!this.editorCaptured) {
            COM.gef.DomainEventDispatcher.superclass[a].call(this, b);
            if (this.draw2dBusy()) {
                return true
            }
        }
    },
    _internalDispatch: function(a, b, c) {
        if (this._superDispatch(a, c)) {
            return
        }
        if (this.okToDispatch()) {
            this.domain[b](c, this.viewer)
        }
    },
    dispatchKeyPressed: function(a) {
        this._internalDispatch("dispatchKeyPressed", "keyPressed", a)
    },
    dispatchKeyReleased: function(a) {
        this._internalDispatch("dispatchKeyReleased", "keyUp", a)
    },
    dispatchKeyDown: function(a) {
        this._internalDispatch("dispatchKeyDown", "keyDown", a)
    },
    dispatchMouseWheelScrolled: function(a) {
        this._internalDispatch("dispatchMouseWheelScrolled", "mouseWheelScrolled", a)
    },
    dispatchMouseHover: function(a) {
        this._internalDispatch("dispatchMouseHover", "mouseHover", a)
    },
    dispatchMouseDoubleClicked: function(a) {
        this._internalDispatch("dispatchMouseDoubleClicked", "mouseDoubleClick", a)
    },
    dispatchMouseClicked: function(a) {
        this._internalDispatch("dispatchMouseClicked", "mouseClick", a)
    },
    dispatchMouseEntered: function(a) {
        this._internalDispatch("dispatchMouseEntered", "viewerEntered", a)
    },
    dispatchMouseExited: function(a) {},
    dispatchMousePressed: function(a) {
        this.setCapture(null );
        this.setRouteEventsToEditor(false);
        if (this._superDispatch("dispatchMousePressed", a)) {
            return
        }
        if (this.okToDispatch()) {
            this.setFocus(null );
            this.setRouteEventsToEditor(true);
            this.domain.mouseDown(a, this.viewer)
        }
    },
    dispatchMouseMoved: function(a) {
        if (this._superDispatch("dispatchMouseMoved", a)) {
            return
        }
        if (this.okToDispatch()) {
            if (a.button == Canvas.BUTTON_LEFT) {
                this.domain.mouseDrag(a, this.viewer)
            } else {
                this.domain.mouseMove(a, this.viewer)
            }
        }
    },
    dispatchMouseReleased: function(a) {
        if (this._superDispatch("dispatchMouseReleased", a)) {
            return
        }
        if (this.okToDispatch()) {
            this.setRouteEventsToEditor(false);
            this.domain.mouseUp(a, this.viewer);
            this.updateFigureUnderCursor(a)
        }
    },
    dispatchTouchStart: function(a) {
        this._internalDispatch("dispatchTouchStart", "touchStart", a)
    },
    dispatchTouchMove: function(a) {
        this._internalDispatch("dispatchTouchMove", "touchMove", a)
    },
    dispatchTouchEnd: function(a) {
        this._internalDispatch("dispatchTouchEnd", "touchEnd", a)
    },
    dispatchNativeDragFinished: function(a, b) {
        this.domain.nativeDragFinished(a, b)
    },
    dispatchNativeDragStarted: function(a, b) {
        this.setRouteEventsToEditor(false);
        this.bedomainnch.nativeDragStarted(a, b)
    },
    draw2dBusy: function() {
        if (this.getCurrentEvent() != null ) {
            if (this.getCurrentEvent().isConsumed()) {
                return true
            }
        }
        if (this.isCaptured()) {
            return true
        }
        return false
    },
    getViewer: function() {
        return this.viewer
    },
    okToDispatch: function() {
        return this.domain != null 
    },
    setCapture: function(a) {
        COM.gef.DomainEventDispatcher.superclass.setCapture.call(this, a);
        if (a == null ) {
            this.releaseCapture();
            this.setRouteEventsToEditor(true)
        }
    },
    setCursor: function(b) {
        var a = this.overrideCursor || b;
        COM.gef.DomainEventDispatcher.superclass.setCursor.call(this, a)
    },
    setRouteEventsToEditor: function(a) {
        this.editorCaptured = a
    },
    setOverrideCursor: function(a) {
        if (this.overrideCursor == a) {
            return
        }
        this.overrideCursor = a;
        if (this.overrideCursor == null ) {
            this.updateCursor()
        } else {
            this.setCursor(this.overrideCursor)
        }
    }
});
COM.gef.RequestConstants = {};
COM.gef.RequestConstants.REQ_CONNECTION_START = "connection start";
COM.gef.RequestConstants.REQ_CONNECTION_END = "connection end";
COM.gef.RequestConstants.REQ_RECONNECT_SOURCE = "Reconnection source";
COM.gef.RequestConstants.REQ_RECONNECT_TARGET = "Reconnection target";
COM.gef.RequestConstants.REQ_MOVE_BENDPOINT = "move bendpoint";
COM.gef.RequestConstants.REQ_CREATE_BENDPOINT = "create bendpoint";
COM.gef.RequestConstants.REQ_RESIZE = "resize";
COM.gef.RequestConstants.REQ_RESIZE_CHILDREN = "resize children";
COM.gef.RequestConstants.REQ_MOVE = "move";
COM.gef.RequestConstants.REQ_MOVE_CHILDREN = "move children";
COM.gef.RequestConstants.REQ_OPEN = "open";
COM.gef.RequestConstants.REQ_ORPHAN = "orphan";
COM.gef.RequestConstants.REQ_ORPHAN_CHILDREN = "orphan children";
COM.gef.RequestConstants.REQ_CREATE = "create child";
COM.gef.RequestConstants.REQ_ADD = "add children";
COM.gef.RequestConstants.REQ_CLONE = "clone";
COM.gef.RequestConstants.REQ_DELETE = "delete";
COM.gef.RequestConstants.REQ_DELETE_DEPENDANT = "delete dependant";
COM.gef.RequestConstants.REQ_ALIGN = "align";
COM.gef.RequestConstants.REQ_ALIGN_CHILDREN = "align children";
COM.gef.RequestConstants.REQ_DIRECT_EDIT = "direct edit";
COM.gef.RequestConstants.REQ_SELECTION = "selection";
COM.gef.RequestConstants.REQ_SELECTION_HOVER = "selection hover";
COM.gef.Request = function Request(a) {
    COM.gef.Request.superclass.constructor.call(this);
    this.type = null ;
    this.extendedData = null ;
    if (a != null ) {
        this.setType(a)
    }
}
;
COM.gef.Request.extend(Object, {
    getExtendedData: function() {
        if (this.extendedData == null ) {
            this.extendedData = new COM.engine.PropertyMap()
        }
        return this.extendedData
    },
    getType: function() {
        return this.type
    },
    setExtendedData: function(a) {
        this.extendedData = a
    },
    setType: function(a) {
        this.type = a
    }
});
COM.gef.SelectionManager = function SelectionManager() {
    COM.gef.SelectionManager.superclass.constructor.call(this);
    this.focusPart = null ;
    this.selection = null ;
    this.viewer = null 
}
;
COM.gef.SelectionManager.extend(Object, {
    appendSelection: function(a) {
        var b;
        if (a != this.getFocus()) {
            this.viewer.setFocus(null )
        }
        if (this.selection.length > 0) {
            b = this.selection[selection.length - 1];
            b.setSelected(COM.gef.EditPart.SELECTED)
        }
        COM.Util.Array.remove(this.selection, a);
        this.selection.push(a);
        a.setSelected(COM.gef.EditPart.SELECTED_PRIMARY);
        this.fireSelectionChanged()
    },
    deselect: function(c) {
        var a;
        c.setSelected(COM.gef.EditPart.SELECTED_NONE);
        COM.Util.Array.remove(this.selection, c);
        if (this.selection.length > 0) {
            for (var b = this.selection.length - 1; b >= 0; b--) {
                a = this.selection[b];
                if (a.isSelectable()) {
                    a.setSelected(COM.gef.EditPart.SELECTED_PRIMARY);
                    break
                }
            }
        }
        this.fireSelectionChanged()
    },
    deselectAll: function() {
        var a;
        this.setFocus(null );
        for (var b = 0; b < this.selection.length; b++) {
            a = this.selection[b];
            a.setSelected(COM.gef.EditPart.SELECTED_NONE)
        }
        this.selection.length = 0;
        this.fireSelectionChanged()
    },
    fireSelectionChanged: function() {},
    getFocus: function() {
        return this.focusPart
    },
    getSelection: function() {
        if (this.selection.length === 0 && this.viewer.getContents() != null ) {
            return [this.viewer.getContents()]
        }
        return this.selection
    },
    getViewer: function() {
        return this.viewer
    },
    internalHookControl: Function.emptyFunction,
    internalUninstall: Function.emptyFunction,
    hookViewer: Function.emptyFunction,
    internalInitialize: function(b, a) {
        this.viewer = b;
        this.selection = a;
        this.hookViewer(b)
    },
    setFocus: function(a) {
        if (this.focusPart === a) {
            return
        }
        if (this.focusPart != null ) {
            this.focusPart.setFocus(false)
        }
        this.focusPart = a;
        if (this.focusPart != null ) {
            this.focusPart.setFocus(true)
        }
    },
    setSelection: function(a) {
        if (a == null  || !COM.Util.Array.isArray(a)) {
            return
        }
        var b;
        var c;
        for (c = 0; c < this.selection.length; c++) {
            b = this.selection[c];
            if (!COM.Util.Array.contains(a, b)) {
                b.setSelected(COM.gef.EditPart.SELECTED_NONE)
            }
        }
        this.selection.length = 0;
        if (a.length > 0) {
            for (c = 0; c < a.length; c++) {
                b = a[c];
                this.selection.push(b);
                if (c === a.length - 1) {
                    b.setSelected(COM.gef.EditPart.SELECTED_PRIMARY);
                    break
                }
                b.setSelected(COM.gef.EditPart.SELECTED)
            }
        }
        this.fireSelectionChanged()
    }
});
COM.gef.SelectionManager.createDefault = function() {
    return new COM.gef.SelectionManager()
}
;
COM.gef.Tool = function Tool() {}
;
COM.gef.Tool.prototype.activate = Function.needOverride;
COM.gef.Tool.prototype.deactivate = Function.needOverride;
COM.gef.Tool.prototype.focusGained = Function.needOverride;
COM.gef.Tool.prototype.focusLost = Function.needOverride;
COM.gef.Tool.prototype.keyDown = Function.needOverride;
COM.gef.Tool.prototype.keyTraversed = Function.needOverride;
COM.gef.Tool.prototype.keyPressed = Function.needOverride;
COM.gef.Tool.prototype.keyUp = Function.needOverride;
COM.gef.Tool.prototype.mouseDoubleClick = Function.needOverride;
COM.gef.Tool.prototype.mouseDown = Function.needOverride;
COM.gef.Tool.prototype.mouseDrag = Function.needOverride;
COM.gef.Tool.prototype.mouseHover = Function.needOverride;
COM.gef.Tool.prototype.mouseMove = Function.needOverride;
COM.gef.Tool.prototype.mouseUp = Function.needOverride;
COM.gef.Tool.prototype.mouseWheelScrolled = Function.needOverride;
COM.gef.Tool.prototype.nativeDragFinished = Function.needOverride;
COM.gef.Tool.prototype.nativeDragStarted = Function.needOverride;
COM.gef.Tool.prototype.setEditDomain = Function.needOverride;
COM.gef.Tool.prototype.setViewer = Function.needOverride;
COM.gef.Tool.prototype.viewerEntered = Function.needOverride;
COM.gef.Tool.prototype.viewerExited = Function.needOverride;
COM.gef.Tool.prototype.setProperties = Function.needOverride;
COM.gef.EditDomain = function EditDomain(a) {
    COM.gef.EditDomain.superclass.constructor.call(this);
    this.shell = a;
    this.defaultTool = null ;
    this.activeTool = null ;
    this.viewers = [];
    this.commandStack = new COM.gef.CommandStack();
    this.loadDefaultTool()
}
;
COM.gef.EditDomain.extend(Object, {
    dispose: function() {
        this.shell = null ;
        if (this.defaultTool && this.defaultTool.dispose) {
            this.defaultTool.dispose()
        }
        this.defaultTool = null ;
        this.viewers = null ;
        this.commandStack = null 
    },
    addViewer: function(a) {
        a.setEditDomain(this);
        this.getControl().appendChild(a.getElement());
        this.viewers[0] = a
    },
    getControl: function() {
        return this.shell
    },
    focusGained: function(b, c) {
        var a = this.getActiveTool();
        if (a != null ) {
            a.focusGained(b, c)
        }
    },
    focusLost: function(b, c) {
        var a = this.getActiveTool();
        if (a != null ) {
            a.focusLost(b, c)
        }
    },
    getActiveTool: function() {
        return this.activeTool
    },
    getCommandStack: function() {
        return this.commandStack
    },
    getDefaultTool: function() {
        if (this.defaultTool == null ) {
            this.defaultTool = new COM.gef.SelectionTool()
        }
        return this.defaultTool
    },
    _internalDispatch: function(b, c, d) {
        var a = this.getActiveTool();
        if (a != null  && a[b]) {
            a[b](c, d)
        }
    },
    keyDown: function(a, b) {
        this._internalDispatch("keyDown", a, b)
    },
    keyPressed: function(a, b) {
        this._internalDispatch("keyPressed", a, b)
    },
    keyUp: function(a, b) {
        this._internalDispatch("keyUp", a, b)
    },
    loadDefaultTool: function() {
        this.setActiveTool(null );
        this.setActiveTool(this.getDefaultTool())
    },
    mouseDoubleClick: function(b, a) {
        this._internalDispatch("mouseDoubleClick", b, a)
    },
    mouseClick: function(b, a) {
        this._internalDispatch("mouseClick", b, a)
    },
    mouseDown: function(b, a) {
        this._internalDispatch("mouseDown", b, a)
    },
    mouseDrag: function(b, a) {
        this._internalDispatch("mouseDrag", b, a)
    },
    mouseHover: function(b, a) {
        this._internalDispatch("mouseHover", b, a)
    },
    mouseMove: function(b, a) {
        this._internalDispatch("mouseMove", b, a)
    },
    mouseUp: function(b, a) {
        this._internalDispatch("mouseUp", b, a)
    },
    mouseWheelScrolled: function(a, b) {
        this._internalDispatch("mouseWheelScrolled", a, b)
    },
    nativeDragFinished: function(a, b) {
        this._internalDispatch("nativeDragFinished", a, b)
    },
    nativeDragStarted: function(a, b) {
        this._internalDispatch("nativeDragStarted", a, b)
    },
    touchStart: function(a, b) {
        this._internalDispatch("touchStart", a, b)
    },
    touchMove: function(a, b) {
        this._internalDispatch("touchMove", a, b)
    },
    touchEnd: function(a, b) {
        this._internalDispatch("touchEnd", a, b)
    },
    removeViewer: function(a) {
        if (this.viewers.remove(a)) {
            a.setEditDomain(null )
        }
    },
    setCommandStack: function(a) {
        this.commandStack = a
    },
    setDefaultTool: function(a) {
        this.defaultTool = a
    },
    setPaletteRoot: function(a) {
        if (this.paletteRoot == a) {
            return
        }
        this.paletteRoot = a;
        if (this.getPaletteViewer() != null ) {
            this.getPaletteViewer().setPaletteRoot(this.paletteRoot);
            this.loadDefaultTool()
        }
    },
    setPaletteViewer: function(a) {
        if (a == this.paletteViewer) {
            return
        }
        if (this.paletteViewer != null ) {
            this.paletteViewer.removePaletteListener(this.paletteListener)
        }
        this.paletteViewer = a;
        if (this.paletteViewer != null ) {
            a.addPaletteListener(this.paletteListener);
            if (this.paletteRoot != null ) {
                this.paletteViewer.setPaletteRoot(this.paletteRoot);
                this.loadDefaultTool()
            }
        }
    },
    setActiveTool: function(a) {
        if (this.activeTool != null ) {
            this.activeTool.deactivate()
        }
        this.activeTool = a;
        if (this.activeTool != null ) {
            this.activeTool.setEditDomain(this);
            this.activeTool.activate()
        }
    },
    viewerEntered: function(b, a) {
        this._internalDispatch("viewerEntered", b, a)
    },
    viewerExited: function(b, a) {
        this._internalDispatch("viewerExited", b, a)
    }
});
COM.gef.AbstractEditPartViewer = function AbstractEditPartViewer() {
    COM.gef.AbstractEditPartViewer.superclass.constructor.call(this);
    this.disposeListener = null ;
    this.selectionModel = COM.gef.SelectionManager.createDefault();
    this.selection = [];
    this.selectionListeners = [];
    this.factory = null ;
    this.mapIDToEditPart = new Map();
    this.mapVisualToEditPart = new Map();
    this.properties = {};
    this.control = null ;
    this.resources = null ;
    this.domain = null ;
    this.rootEditPart = null ;
    this.contextMenu = null ;
    this.keyHandler = null ;
    this.changeSupport = null ;
    this.init();
    function a() {
        var b = "editPartViewer_" + COM.gef.AbstractEditPartViewer.count;
        COM.gef.AbstractEditPartViewer.count++;
        return b
    }
    this.id = a();
    this.disposed = false
}
;
COM.gef.AbstractEditPartViewer.count = 0;
COM.gef.AbstractEditPartViewer.extend(COM.gef.EditPartViewer, {
    dispose: function() {
        if (this.disposed) {
            return
        }
        this.disposed = true;
        this.selectionModel = null ;
        this.selection = null ;
        this.mapIDToEditPart = null ;
        this.mapVisualToEditPart = null ;
        this.properties = null ;
        this.contextMenu = null ;
        this.keyHandler = null ;
        this.changeSupport = null ;
        if (this.rootEditPart && this.rootEditPart.dispose) {
            this.rootEditPart.dispose()
        }
        this.rootEditPart = null ;
        return true
    },
    getId: function() {
        return this.id
    },
    setSelectionManager: function(a) {
        if (a == null ) {
            throw {
                type: "��ֵ",
                message: "setSelectionManager�Ĳ���Ϊ��."
            }
        }
        if (this.selectionModel != null ) {
            this.selectionModel.internalUninstall()
        }
        this.selectionModel = a;
        a.internalInitialize(this, this.selection);
        if (this.getControl() != null ) {
            a.internalHookControl(this.getControl())
        }
    },
    addPropertyChangeListener: function(a) {
        if (this.changeSupport == null ) {
            this.changeSupport = new PropertyChangeSupport(this)
        }
    },
    addSelectionChangedListener: function(a) {
        this.selectionListeners.push(a)
    },
    appendSelection: function(a) {
        this.selectionModel.appendSelection(a)
    },
    createControl: Function.needOverride,
    deselect: function(a) {
        this.selectionModel.deselect(a)
    },
    deselectAll: function() {
        this.selectionModel.deselectAll()
    },
    handleDispose: function() {
        if (this.resources != null ) {
            this.resources.dispose()
        }
        this.setControl(null )
    },
    findObjectAt: function(a) {
        return this.findObjectAtExcluding(a, [])
    },
    findObjectAtExcluding: function(b, a) {
        return this.findObjectAtExcluding(b, a, null )
    },
    fireSelectionChanged: function() {
        for (var a = 0; a < this.selectionListeners.length; a++) {
            this.selectionListeners[a].selectionChanged(this, this.getSelection())
        }
    },
    flush: Function.emptyFunction,
    getContextMenu: function() {
        return this.contextMenu
    },
    getContents: function() {
        return this.getRootEditPart().getContents()
    },
    getControl: function() {
        return this.control
    },
    getEditDomain: function() {
        return this.domain
    },
    getEditPartFactory: function() {
        return this.factory
    },
    getEditPartRegistry: function() {
        return this.mapIDToEditPart
    },
    getFocusEditPart: function() {
        if (this.selectionModel.getFocus() != null ) {
            return this.selectionModel.getFocus()
        }
        if (this.getSelectedEditParts().length === 0) {
            if (this.getContents() != null ) {
                return this.getContents()
            } else {
                return this.getRootEditPart()
            }
        }
        var a = this.getSelectedEditParts();
        return a[a.length - 1]
    },
    getKeyHandler: function() {
        return this.keyHandler
    },
    getProperty: function(a) {
        if (this.properties != null ) {
            return this.properties.get(a)
        }
        return null 
    },
    getResourceManager: function() {
        if (this.resources != null ) {
            return this.resources
        }
        if (this.getControl() == null ) {
            Debugger.error("control is null.")
        }
        return this.resources
    },
    getRootEditPart: function() {
        return this.rootEditPart
    },
    getSelectedEditParts: function() {
        return this.selection
    },
    getSelection: function() {
        return this.selectionModel.getSelection()
    },
    getSelectionManager: function() {
        return this.selectionModel
    },
    getVisualPartMap: function() {
        return this.mapVisualToEditPart
    },
    hookControl: function() {
        var b = this.getControl();
        var a = this;
        if (b == null ) {
            throw {
                type: "��ֵ",
                message: "controlΪ��!"
            }
        }
        this.getSelectionManager().internalHookControl(b);
        this.disposeListener = {
            widgetDisposed: function(c) {
                a.handleDispose(c)
            }
        };
        b.addDisposeListener(this.disposeListener);
        if (this.getRootEditPart() != null ) {
            this.getRootEditPart().activate()
        }
        if (this.contextMenu != null ) {
            b.setMenu(this.contextMenu.createContextMenu(this.getControl()))
        }
    },
    init: Function.emptyFunction,
    primDeselectAll: function() {
        var a;
        var c = this.primGetSelectedEditParts();
        for (var b = 0; b < c.length; b++) {
            a = c[b];
            a.setSelected(COM.gef.EditPart.SELECTED_NONE)
        }
        c.length = 0
    },
    primGetSelectedEditParts: function() {
        return this.selection
    },
    removePropertyChangeListener: function(a) {
        if (this.changeSupport != null ) {
            this.changeSupport.removePropertyChangeListener(a);
            if (this.changeSupport.getPropertyChangeListeners().length === 0) {
                this.changeSupport = null 
            }
        }
    },
    removeSelectionChangedListener: function(a) {
        this.selectionListeners.remove(a)
    },
    reveal: Function.emptyFunction,
    select: function(a) {
        if ((this.getSelectedEditParts().length == 1) && (this.getSelectedEditParts()[0] == a)) {
            return
        }
        this.primDeselectAll();
        this.appendSelection(a)
    },
    setContextMenu: function(a) {
        if (this.contextMenu != null ) {
            this.contextMenu.dispose()
        }
        this.contextMenu = a;
        if (this.getControl() != null  && !this.getControl().isDisposed()) {
            this.getControl().setMenu(this.contextMenu.createContextMenu(this.getControl()))
        }
    },
    setContents: function(a) {
        this.getRootEditPart().setContents(a)
    },
    setContents: function(a) {
        if (a instanceof COM.gef.EditPart) {
            this.getRootEditPart().setContents(a)
        } else {
            if (this.getEditPartFactory() == null ) {
                throw {
                    type: "��ֵ",
                    message: "editPartFacotryΪ��"
                }
            }
            this.setContents(this.getEditPartFactory().createEditPart(null , a))
        }
    },
    setControl: function(a) {
        if (this.control != null ) {
            this.unhookControl()
        }
        this.control = a;
        if (a != null ) {
            this.hookControl()
        }
    },
    setCursor: function(a) {
        if (this.getControl() == null  || this.getControl().isDisposed()) {
            return
        }
        this.getControl().setCursor(a)
    },
    setEditDomain: function(a) {
        this.domain = a
    },
    setEditPartFactory: function(a) {
        this.factory = a
    },
    setFocus: function(a) {
        this.getSelectionManager().setFocus(a)
    },
    setKeyHandler: function(a) {
        this.keyHandler = a
    },
    setProperty: function(b, c) {
        if (this.properties == null ) {
            this.properties = new HashMap()
        }
        var a;
        if (c == null ) {
            a = this.properties.remove(b)
        } else {
            a = this.properties.put(b, c)
        }
        if (this.changeSupport != null ) {
            this.changeSupport.firePropertyChange(b, a, c)
        }
    },
    setRootEditPart: function(a) {
        if (this.rootEditPart != null ) {
            if (this.rootEditPart.isActive()) {
                this.rootEditPart.deactivate()
            }
            this.rootEditPart.setViewer(null )
        }
        this.rootEditPart = a;
        this.rootEditPart.setViewer(this);
        if (this.getControl() != null ) {
            this.rootEditPart.activate()
        }
    },
    setRouteEventsToEditDomain: Function.emptyFunction,
    setSelection: function(a) {
        this.selectionModel.setSelection(a)
    },
    unhookControl: function() {
        if (this.getControl() == null ) {
            throw {
                type: "��ֵ",
                mesage: "viewer��controlΪ��"
            }
        }
        if (this.disposeListener != null ) {
            this.getControl().removeDisposeListener(this.disposeListener);
            this.disposeListener = null 
        }
        if (this.getContextMenu() != null ) {
            this.getContextMenu().dispose()
        }
        if (this.getRootEditPart() != null ) {
            this.getRootEditPart().deactivate()
        }
    }
});
COM.gef.GraphicalViewerImpl = function GraphicalViewerImpl() {
    COM.gef.GraphicalViewerImpl.superclass.constructor.call(this);
    this.lws = this.createLightweightSystem();
    this.createControl();
    this.rootFigure = null ;
    this.eventDispatcher = null ;
    this.lFocus = null ;
    this.createDefaultRoot();
    this.initScrollHelper()
}
;
COM.gef.GraphicalViewerImpl.extend(COM.gef.AbstractEditPartViewer, {
    dispose: function() {
        if (COM.gef.GraphicalViewerImpl.superclass.dispose.call(this)) {
            if (this.scrollHelper && this.scrollHelper.dispose) {
                this.scrollHelper.dispose()
            }
            if (this.control && this.control.dispose) {
                this.control.dispose()
            }
            if (this.lws && this.lws.dispose) {
                this.lws.dispose()
            }
            if (this.rootFigure && this.rootFigure.dispose) {
                this.rootFigure.dispose()
            }
            if (this.eventDispatcher && this.eventDispatcher.dispose) {
                this.eventDispatcher.dispose()
            }
            delete this.element;
            delete this.scrollHelper;
            delete this.eventDispatcher;
            delete this.control;
            delete this.lws;
            delete this.rootFigure;
            delete this.lFocus
        }
    },
    getScrollHelper: function() {
        return this.scrollHelper
    },
    initScrollHelper: function() {
        this.scrollBar = document.createElement("div");
        this.scrollBar.style.position = "absolute";
        this.scrollBar.style.overflow = "auto";
        this.scrollBar.style.height = 800 + "px";
        this.scrollBar.style.width = 1600 + "px";
        this.placeHolder = document.createElement("div");
        this.scrollBar.appendChild(this.placeHolder);
        this.scrollHelper = {
            scrollBar: this.scrollBar,
            placeHolder: this.placeHolder
        }
    },
    setSize: function(b, a) {
        var c = this.getElement();
        c.style.width = b + "px";
        c.style.height = a + "px";
        this.getControl().resize(b, a);
        this.width = b;
        this.height = a;
        this.setScrollBarSize(b, a)
    },
    setScrollBarSize: function(b, a) {
        this.scrollBar.style.width = b + "px";
        this.scrollBar.style.height = a + "px"
    },
    getSize: function() {
        return new Dimension(this.width,this.height)
    },
    getElement: function() {
        if (null  == this.element) {
            this.element = document.createElement("div");
            this.element.className = "viewer";
            this.element.style.position = "absolute"
        }
        return this.element
    },
    createControl: function() {
        var a = document.createElement("canvas");
        a.style.position = "absolute";
        a.style.top = "0px";
        a.style.left = "0px";
        a.id = this.getId();
        this.getElement().appendChild(a);
        var b = new Canvas(this.canvasElement);
        this.setControl(b)
    },
    createDefaultRoot: function() {
        this.setRootEditPart(new COM.gef.ScalableRootEditPart())
    },
    createLightweightSystem: function() {
        var a = new LightweightSystem();
        return a
    },
    handleDispose: function(a) {},
    handleFocusGained: function(a) {
        if (this.getFocusEditPart() != null ) {
            this.getFocusEditPart().setFocus(true)
        }
    },
    handleFocusLost: function(a) {
        if (this.getFocusEditPart() != null ) {
            this.getFocusEditPart().setFocus(false)
        }
    },
    findHandleAt: function(d) {
        var a = this.getEditPartRegistry().get(COM.gef.LayerManager.ID);
        if (a == null ) {
            return null 
        }
        var c = [];
        c.push(a.getLayer(COM.gef.LayerConstants.PRIMARY_LAYER));
        c.push(a.getLayer(COM.gef.LayerConstants.CONNECTION_LAYER));
        c.push(a.getLayer(COM.gef.LayerConstants.FEEDBACK_LAYER));
        var b = this.getLightweightSystem().getRootFigure().findFigureAtExcluding(d.x, d.y, c);
        if (b == null ) {
            return null 
        }
        if (b.getDragTracker) {
            return b
        }
        return null 
    },
    findObjectAtExcluding: function(d, b, g) {
        var a = this.getLightweightSystem().getRootFigure().findFigureAt(d.x, d.y, new COM.gef.ConditionalTreeSearch(b,this,g));
        var c = null ;
        while (c == null  && a != null ) {
            c = this.getVisualPartMap().get(a);
            a = a.getParent()
        }
        if (c == null ) {
            return this.getContents()
        }
        return c
    },
    flush: function() {
        this.getLightweightSystem().getUpdateManager().performUpdate()
    },
    getLayerManager: function() {
        return this.getEditPartRegistry().get(COM.gef.LayerManager.ID)
    },
    getLightweightSystem: function() {
        return this.lws
    },
    hookControl: function() {
        COM.gef.GraphicalViewerImpl.superclass.hookControl.call(this);
        this.getLightweightSystem().setControl(this.getControl())
    },
    reveal: function(a) {},
    setContextMenu: function(a) {
        COM.gef.GraphicalViewerImpl.superclass.setContextMenu.call(this, a)
    },
    setCursor: function(a) {
        if (this.eventDispatcher != null ) {
            this.eventDispatcher.setOverrideCursor(a)
        }
    },
    setEditDomain: function(a) {
        COM.gef.GraphicalViewerImpl.superclass.setEditDomain.call(this, a);
        this.eventDispatcher = this.createEventDispatcher(a, this);
        this.getLightweightSystem().setEventDispatcher(this.eventDispatcher);
        this.appendScrollBar(a.getControl())
    },
    createEventDispatcher: function(a, b) {
        return new COM.gef.DomainEventDispatcher(a,b)
    },
    appendScrollBar: function(a) {
        a.appendChild(this.scrollBar)
    },
    setRootEditPart: function(a) {
        COM.gef.GraphicalViewerImpl.superclass.setRootEditPart.call(this, a);
        this.setRootFigure(a.getFigure())
    },
    setRootFigure: function(a) {
        this.rootFigure = a;
        this.hookRootFigure()
    },
    hookRootFigure: function() {
        this.getLightweightSystem().setContents(this.rootFigure)
    },
    setRouteEventsToEditDomain: function(a) {
        this.eventDispatcher.setRouteEventsToEditor(a)
    },
    unhookControl: function() {
        COM.gef.GraphicalViewerImpl.superclass.unhookControl.call(this);
        if (this.lFocus != null ) {
            this.etControl().removeFocusListener(this.lFocus);
            this.lFocus = null 
        }
    }
});
COM.gef.FeedbackLayer = function FeedbackLayer(a) {
    COM.gef.FeedbackLayer.superclass.constructor.call(this);
    this.setEnabled(false)
}
;
COM.gef.FeedbackLayer.extend(Layer, {
    getPreferredSize: function(c, a) {
        var d = new Rectangle();
        for (var b = 0; b < this.getChildren().length; b++) {
            d.union((this.getChildren()[b]).getBounds())
        }
        return d.getSize()
    }
});
COM.gef.AbstractEditPart = function AbstractEditPart(a) {
    COM.gef.AbstractEditPart.superclass.constructor.call(this);
    this.model = null ;
    this.flags = 0;
    this.parent = null ;
    this.selected = 0;
    this.policies = [];
    this.children = [];
    this.eventListeners = new EventListenerList()
}
;
COM.gef.AbstractEditPart.extend(COM.gef.EditPart, {
    activate: function() {
        this.setFlag(COM.gef.AbstractEditPart.FLAG_ACTIVE, true);
        this.activateEditPolicies();
        var b = this.getChildren();
        for (var a = 0; a < b.length; a++) {
            b[a].activate()
        }
        this.fireActivated()
    },
    activateEditPolicies: function() {
        for (var a = 1; a < this.policies.length; a += 2) {
            this.policies[a].activate()
        }
    },
    addChild: function(b, a) {
        if (!b) {
            throw {
                type: "��ֵ",
                message: "childΪ��."
            }
        }
        if (a >= 0) {
            this.getChildren().splice(a, 0, b)
        } else {
            a = this.children.length;
            this.getChildren().push(b)
        }
        b.setParent(this);
        this.addChildVisual(b, a);
        b.addNotify();
        if (this.isActive()) {
            b.activate()
        }
        this.fireChildAdded(b, a)
    },
    addChildVisual: Function.needOverride,
    addEditPartListener: function(a) {
        this.eventListeners.addListener("EditPartListener", a)
    },
    addNotify: function() {
        this.register();
        this.createEditPolicies();
        var b = this.getChildren();
        for (var a = 0; a < b.length; a++) {
            b[a].addNotify()
        }
        this.refresh()
    },
    createChild: function(a) {
        return this.getViewer().getEditPartFactory().createEditPart(this, a)
    },
    createEditPolicies: Function.needOverride,
    deactivate: function() {
        var b = this.getChildren();
        for (var a = 0; a < b.length; a++) {
            b[a].deactivate()
        }
        this.deactivateEditPolicies();
        this.setFlag(COM.gef.AbstractEditPart.FLAG_ACTIVE, false);
        this.fireDeactivated()
    },
    deactivateEditPolicies: function() {
        for (var a = 1; a < this.policies.length; a += 2) {
            this.policies[a].deactivate()
        }
    },
    eraseSourceFeedback: function(b) {
        if (this.isActive()) {
            for (var a = 1; a < this.policies.length; a += 2) {
                this.policies[a].eraseSourceFeedback(b)
            }
        }
    },
    eraseTargetFeedback: function(b) {
        if (this.isActive()) {
            for (var a = 1; a < this.policies.length; a += 2) {
                this.policies[a].eraseTargetFeedback(b)
            }
        }
    },
    fireActivated: function() {
        var a = this.getEventListeners("EditPartListener");
        while (a.hasNext()) {
            a.next().partActivated(this)
        }
    },
    fireChildAdded: function(c, a) {
        var b = this.getEventListeners("EditPartListener");
        while (b.hasNext()) {
            b.next().childAdded(c, a)
        }
    },
    fireDeactivated: function() {
        var a = this.getEventListeners("EditPartListener");
        while (a.hasNext()) {
            a.next().partDeactivated(this)
        }
    },
    fireRemovingChild: function(c, a) {
        var b = this.getEventListeners("EditPartListener");
        while (b.hasNext()) {
            b.next().removingChild(c, a)
        }
    },
    fireSelectionChanged: function() {
        var a = this.getEventListeners("EditPartListener");
        while (a.hasNext()) {
            a.next().selectedStateChanged(this)
        }
    },
    getChildren: function() {
        if (this.children == null ) {
            this.children = []
        }
        return this.children
    },
    getCommand: function(b) {
        var c = null ;
        for (var a = 1; a < this.policies.length; a += 2) {
            if (c != null ) {
                c = c.chain(this.policies[a].getCommand(b))
            } else {
                c = this.policies[a].getCommand(b)
            }
        }
        return c
    },
    getEventListeners: function(a) {
        return this.eventListeners.getListeners(a)
    },
    getEditPolicy: function(b) {
        if (this.policies != null ) {
            for (var a = 0; a < this.policies.length; a += 2) {
                if (this.policies[a] === b) {
                    return this.policies[a + 1]
                }
            }
        }
        return null 
    },
    getFlag: function(a) {
        return (this.flags & a) != 0
    },
    getModel: function() {
        return this.model
    },
    getModelChildren: function() {
        return []
    },
    getParent: function() {
        return this.parent
    },
    getRoot: function() {
        if (this.getParent() == null ) {
            return null 
        }
        return this.getParent().getRoot()
    },
    getSelected: function() {
        return this.selected
    },
    getTargetEditPart: function(c) {
        var a;
        for (var b = 1; b < this.policies.length; b += 2) {
            a = this.policies[b].getTargetEditPart(c);
            if (a != null ) {
                return a
            }
        }
        if (COM.gef.RequestConstants.REQ_SELECTION == c.getType()) {
            if (this.isSelectable()) {
                return this
            }
        }
        return null 
    },
    getViewer: function() {
        var a = this.getRoot();
        if (a == null ) {
            return null 
        }
        return a.getViewer()
    },
    hasFocus: function() {
        return this.getFlag(COM.gef.AbstractEditPart.FLAG_FOCUS)
    },
    installEditPolicy: function(d, b) {
        if (d == null ) {
            throw {
                type: "��ֵ",
                message: "keyΪ��"
            }
        }
        if (this.policies == null ) {
            this.policies = [];
            this.policies.push(d);
            this.policies.push(b)
        } else {
            var c = 0;
            while (c < this.policies.length && d !== this.policies[c]) {
                c += 2
            }
            if (c < this.policies.length) {
                c++;
                var a = this.policies[c];
                if (a != null  && this.isActive()) {
                    a.deactivate()
                }
                this.policies[c] = b
            } else {
                this.policies.push(d);
                this.policies.push(b)
            }
        }
        if (b != null ) {
            b.setHost(this);
            if (this.isActive()) {
                b.activate()
            }
        }
    },
    isActive: function() {
        return this.getFlag(COM.gef.AbstractEditPart.FLAG_ACTIVE)
    },
    isSelectable: function() {
        return true
    },
    performRequest: Function.emptyFunction,
    refresh: function() {
        this.refreshVisuals();
        this.refreshChildren()
    },
    refreshChildren: function() {
        var c;
        var h;
        var d;
        var a = this.getChildren();
        var m = a.length;
        var l;
        var n;
        var g = new Map();
        if (m > 0) {
            for (c = 0; c < m; c++) {
                h = a[c];
                g.put(h.getModel(), h)
            }
        }
        var b = this.getModelChildren();
        for (c = 0; c < b.length; c++) {
            d = b[c];
            if (c < a.length && a[c].getModel() === d) {
                continue
            }
            h = g.get(d);
            if (h != null ) {
                this.reorderChild(h, c)
            } else {
                h = this.createChild(d);
                this.addChild(h, c)
            }
        }
        m = a.length;
        if (c < m) {
            l = [];
            for (; c < m; c++) {
                l.push(a[c])
            }
            for (c = 0; c < l.length; c++) {
                n = l[c];
                this.removeChild(n)
            }
        }
    },
    refreshVisuals: Function.emptyFunction,
    register: function() {
        this.registerModel();
        this.registerVisuals()
    },
    registerModel: function() {
        this.getViewer().getEditPartRegistry().put(this.getModel(), this)
    },
    registerVisuals: Function.emptyFunction,
    removeChild: function(b) {
        if (b == null ) {
            throw {
                type: "��ֵ",
                messag: "childΪ��"
            }
        }
        var a = COM.Util.Array.indexOf(this.getChildren(), b);
        if (a < 0) {
            return
        }
        this.fireRemovingChild(b, a);
        if (this.isActive()) {
            b.deactivate()
        }
        b.removeNotify();
        this.removeChildVisual(b);
        b.setParent(null );
        this.getChildren().remove(b)
    },
    removeChildVisual: Function.needOverride,
    removeEditPartListener: function(a) {
        this.eventListeners.removeListener("EditPartListener", a)
    },
    removeEditPolicy: function(b) {
        if (this.policies == null ) {
            return
        }
        for (var a = 0; a < this.policies.length; a += 2) {
            if (b === this.policies[a]) {
                a++;
                var c = this.policies[a];
                this.policies[a] = null ;
                if (this.isActive() && c != null ) {
                    c.deactivate()
                }
            }
        }
    },
    removeNotify: function() {
        if (this.getSelected() != COM.gef.EditPart.SELECTED_NONE) {
            this.getViewer().deselect(this)
        }
        if (this.hasFocus()) {
            this.getViewer().setFocus(null )
        }
        var b = this.getChildren();
        for (var a = 0; a < b.length; a++) {
            b[a].removeNotify()
        }
        this.unregister()
    },
    reorderChild: function(c, a) {
        this.removeChildVisual(c);
        var b = this.getChildren();
        COM.Util.Array.remove(b, c);
        COM.Util.Array.add(b, c, a);
        this.addChildVisual(c, a)
    },
    setFlag: function(a, b) {
        if (b) {
            this.flags |= a
        } else {
            this.flags &= ~a
        }
    },
    setFocus: function(a) {
        if (!this.isSelectable() && a) {
            throw {
                type: "�Ƿ�����",
                message: "���ܽ�һ������ѡ��editPart��Ϊ����"
            }
        }
        if (this.hasFocus() === a) {
            return
        }
        this.setFlag(COM.gef.AbstractEditPart.FLAG_FOCUS, a);
        this.fireSelectionChanged()
    },
    setModel: function(a) {
        this.model = a
    },
    setParent: function(a) {
        this.parent = a
    },
    setSelected: function(a) {
        if (!isSelectable() && a != SELECTED_NONE) {
            throw {
                type: "�Ƿ�����",
                message: "����ѡ��һ������ѡ��editPart"
            }
        }
        if (this.selected === a) {
            return
        }
        this.selected = a;
        this.fireSelectionChanged()
    },
    showSourceFeedback: function(b) {
        if (!this.isActive()) {
            return
        }
        for (var a = 1; a < this.policies.length; a += 2) {
            this.policies[a].showSourceFeedback(b)
        }
    },
    showTargetFeedback: function(b) {
        if (!this.isActive()) {
            return
        }
        for (var a = 1; a < this.policies.length; a += 2) {
            this.policies[a].showTargetFeedback(b)
        }
    },
    toString: function() {
        var a = "COM.gef.AbstractEditPart(" + this.getModel() + ")";
        return a
    },
    understandsRequest: function(b) {
        for (var a = 1; a < this.policies.length; a += 2) {
            if (this.policies[a].understandsRequest(b)) {
                return true
            }
        }
        return false
    },
    unregister: function() {
        this.unregisterVisuals();
        this.unregisterModel()
    },
    unregisterModel: function() {
        var a = this.getViewer().getEditPartRegistry();
        if (a.get(this.getModel()) === this) {
            a.remove(this.getModel())
        }
    },
    unregisterVisuals: Function.emptyFunction
});
COM.gef.AbstractEditPart.FLAG_ACTIVE = 1;
COM.gef.AbstractEditPart.FLAG_FOCUS = 2;
COM.gef.AbstractEditPart.MAX_FLAG = COM.gef.AbstractEditPart.FLAG_FOCUS;
COM.gef.AbstractGraphicalEditPart = function AbstractGraphicalEditPart() {
    COM.gef.AbstractGraphicalEditPart.superclass.constructor.call(this);
    this.figure = null ;
    this.sourceConnections = null ;
    this.targetConnections = null 
}
;
COM.gef.AbstractGraphicalEditPart.extend(COM.gef.AbstractEditPart, {
    activate: function() {
        COM.gef.AbstractGraphicalEditPart.superclass.activate.call(this);
        var a = this.getSourceConnections();
        for (var b = 0; b < a.length; b++) {
            a[b].activate()
        }
    },
    addChildVisual: function(b, a) {
        var c = b.getFigure();
        this.getContentPane().add(c, a)
    },
    addNodeListener: function(a) {
        this.eventListeners.addListener("NodeListener", a)
    },
    addNotify: function() {
        COM.gef.AbstractGraphicalEditPart.superclass.addNotify.call(this);
        var a;
        var b;
        a = this.getSourceConnections();
        for (b = 0; b < a.length; b++) {
            a[b].setSource(this)
        }
        a = this.getTargetConnections();
        for (b = 0; b < a.length; b++) {
            a[b].setTarget(this)
        }
    },
    addSourceConnection: function(a, b) {
        this.primAddSourceConnection(a, b);
        var c = a.getSource();
        if (c != null ) {
            COM.Util.Array.remove(c.getSourceConnections(), a)
        }
        a.setSource(this);
        if (this.isActive()) {
            a.activate()
        }
        this.fireSourceConnectionAdded(a, b)
    },
    addTargetConnection: function(a, b) {
        this.primAddTargetConnection(a, b);
        var c = a.getTarget();
        if (c != null ) {
            COM.Util.Array.remove(c.getTargetConnections(), a)
        }
        a.setTarget(this);
        this.fireTargetConnectionAdded(a, b)
    },
    createConnection: function(a) {
        return this.getViewer().getEditPartFactory().createEditPart(this, a)
    },
    createFigure: Function.needOverride,
    createOrFindConnection: function(a) {
        var b = this.getViewer().getEditPartRegistry().get(a);
        if (b != null ) {
            return b
        }
        return this.createConnection(a)
    },
    deactivate: function() {
        var a = this.getSourceConnections();
        for (var b = 0; b < a.length; b++) {
            a[b].deactivate()
        }
        COM.gef.AbstractGraphicalEditPart.superclass.deactivate.call(this)
    },
    fireRemovingSourceConnection: function(a, b) {
        if (this.eventListeners == null ) {
            return
        }
        var c = this.eventListeners.getListeners("NodeListener");
        var d = null ;
        while (c.hasNext()) {
            d = c.next();
            d.removingSourceConnection(a, b)
        }
    },
    fireRemovingTargetConnection: function(a, b) {
        if (this.eventListeners == null ) {
            return
        }
        var c = this.eventListeners.getListeners("NodeListener");
        var d = null ;
        while (c.hasNext()) {
            d = c.next();
            d.removingTargetConnection(a, b)
        }
    },
    fireSourceConnectionAdded: function(a, b) {
        if (this.eventListeners == null ) {
            return
        }
        var c = this.eventListeners.getListeners("NodeListener");
        var d = null ;
        while (c.hasNext()) {
            d = c.next();
            d.sourceConnectionAdded(a, b)
        }
    },
    fireTargetConnectionAdded: function(a, b) {
        if (this.eventListeners == null ) {
            return
        }
        var c = this.eventListeners.getListeners("NodeListener");
        var d = null ;
        while (c.hasNext()) {
            d = c.next();
            d.targetConnectionAdded(a, b)
        }
    },
    getContentPane: function() {
        return this.getFigure()
    },
    getDragTracker: function(a) {
        return new COM.gef.DragEditPartsTracker(this)
    },
    getFigure: function() {
        if (this.figure == null ) {
            this.setFigure(this.createFigure())
        }
        return this.figure
    },
    getLayer: function(b) {
        var a = this.getViewer().getEditPartRegistry().get(COM.gef.LayerManager.ID);
        return a.getLayer(b)
    },
    getModelSourceConnections: function() {
        return []
    },
    getModelTargetConnections: function() {
        return []
    },
    getSourceConnections: function() {
        if (this.sourceConnections == null ) {
            return []
        }
        return this.sourceConnections
    },
    getTargetConnections: function() {
        if (this.targetConnections == null ) {
            return []
        }
        return this.targetConnections
    },
    isSelectable: function() {
        var a = COM.gef.AbstractGraphicalEditPart.superclass.isSelectable.call(this);
        return a && this.getFigure() != null  && this.getFigure().isShowing()
    },
    primAddSourceConnection: function(a, b) {
        if (this.sourceConnections == null ) {
            this.sourceConnections = []
        }
        COM.Util.Array.add(this.sourceConnections, a, b)
    },
    primAddTargetConnection: function(a, b) {
        if (this.targetConnections == null ) {
            this.targetConnections = []
        }
        COM.Util.Array.add(this.targetConnections, a, b)
    },
    primRemoveSourceConnection: function(a) {
        COM.Util.Array.remove(this.sourceConnections, a)
    },
    primRemoveTargetConnection: function(a) {
        COM.Util.Array.remove(this.targetConnections, a)
    },
    refresh: function() {
        COM.gef.AbstractGraphicalEditPart.superclass.refresh.call(this);
        this.refreshSourceConnections();
        this.refreshTargetConnections()
    },
    refreshSourceConnections: function() {
        var h;
        var a;
        var d;
        var m = this.getSourceConnections();
        var g = m.length;
        var l = new Map();
        if (g > 0) {
            for (h = 0; h < g; h++) {
                a = m[h];
                l.put(a.getModel(), a)
            }
        }
        var c = this.getModelSourceConnections();
        if (c == null ) {
            c = []
        }
        for (h = 0; h < c.length; h++) {
            d = c[h];
            if (h < m.length && m[h].getModel() === d) {
                continue
            }
            a = l.get(d);
            if (a != null ) {
                this.reorderSourceConnection(a, h)
            } else {
                a = this.createOrFindConnection(d);
                this.addSourceConnection(a, h)
            }
        }
        g = m.length;
        if (h < g) {
            var b = [];
            for (; h < g; h++) {
                b.push(m[h])
            }
            for (h = 0; h < b.length; h++) {
                this.removeSourceConnection(b[h])
            }
        }
    },
    refreshTargetConnections: function() {
        var h;
        var a;
        var d;
        var m = this.getTargetConnections();
        var g = m.length;
        var l = new Map();
        if (g > 0) {
            for (h = 0; h < g; h++) {
                a = this.targetConnections.get(h);
                l.put(a.getModel(), a)
            }
        }
        var c = this.getModelTargetConnections();
        if (c == null ) {
            c = []
        }
        for (h = 0; h < c.length; h++) {
            d = c[h];
            if (h < m.length && m[h].getModel() === d) {
                continue
            }
            a = l.get(d);
            if (a != null ) {
                this.reorderTargetConnection(a, h)
            } else {
                a = this.createOrFindConnection(d);
                this.addTargetConnection(a, h)
            }
        }
        g = m.length;
        if (h < g) {
            var b = [];
            for (; h < g; h++) {
                b.push(m[h])
            }
            for (h = 0; h < b.length; h++) {
                this.removeTargetConnection(b[h])
            }
        }
    },
    registerVisuals: function() {
        this.getViewer().getVisualPartMap().put(this.getFigure(), this)
    },
    removeChildVisual: function(a) {
        var b = a.getFigure();
        this.getContentPane().remove(b)
    },
    removeNodeListener: function(a) {
        this.eventListeners.removeListener("NodeListener", a)
    },
    removeNotify: function() {
        var b;
        var a;
        b = this.getSourceConnections();
        for (var c = 0; c < b.length; c++) {
            a = [c];
            if (a.getSource() === this) {
                a.setSource(null )
            }
        }
        b = this.getTargetConnections();
        for (var c = 0; c < b.length; c++) {
            a = b[c];
            if (a.getTarget() === this) {
                a.setTarget(null )
            }
        }
        COM.gef.AbstractGraphicalEditPart.superclass.removeNotify.call(this)
    },
    removeSourceConnection: function(a) {
        this.fireRemovingSourceConnection(a, COM.Util.Array.indexOf(this.getSourceConnections(), a));
        if (a.getSource() === this) {
            a.deactivate();
            a.setSource(null )
        }
        this.primRemoveSourceConnection(a)
    },
    removeTargetConnection: function(a) {
        this.fireRemovingTargetConnection(a, COM.Util.Array.indexOf(this.getTargetConnections(), a));
        if (a.getTarget() === this) {
            a.setTarget(null )
        }
        this.primRemoveTargetConnection(a)
    },
    reorderChild: function(g, b) {
        var a = g.getFigure();
        var c = this.getContentPane().getLayoutManager();
        var d = null ;
        if (c != null ) {
            d = c.getConstraint(a)
        }
        COM.gef.AbstractGraphicalEditPart.superclass.reorderChild.call(this, g, b);
        this.setLayoutConstraint(g, a, d)
    },
    reorderSourceConnection: function(a, b) {
        this.primRemoveSourceConnection(a);
        this.primAddSourceConnection(a, b)
    },
    reorderTargetConnection: function(a, b) {
        this.primRemoveTargetConnection(a);
        this.primAddTargetConnection(a, b)
    },
    setFigure: function(a) {
        this.figure = a
    },
    setLayoutConstraint: function(c, a, b) {
        a.getParent().setConstraint(a, b)
    },
    unregisterVisuals: function() {
        this.getViewer().getVisualPartMap().remove(this.getFigure())
    }
});
COM.gef.SimpleRootEditPart = function SimpleRootEditPart() {
    COM.gef.SimpleRootEditPart.superclass.constructor.call(this);
    this.contents = null ;
    this.viewer = null 
}
;
COM.gef.SimpleRootEditPart.extend(COM.gef.AbstractGraphicalEditPart, {
    createEditPolicies: Function.emptyFunction,
    createFigure: function() {
        var a = new Figure("simpleRootEditPart-figure");
        a.setBackgroundColor(new Color(10,200,10));
        a.setOpaque(true);
        a.setLayoutManager(new StackLayout());
        return a
    },
    getCommand: function(a) {
        var b = new Command();
        b.canExecute = function() {
            return false
        }
        ;
        b.canUndo = function() {
            return false
        }
        ;
        return b
    },
    getContents: function() {
        return this.contents
    },
    getRoot: function() {
        return this
    },
    getViewer: function() {
        return this.viewer
    },
    refreshChildren: Function.emptyFunction,
    setContents: function(a) {
        if (this.contents === a) {
            return
        }
        if (this.contents != null ) {
            this.removeChild(this.contents)
        }
        this.contents = a;
        if (this.contents != null ) {
            this.addChild(this.contents, 0)
        }
    },
    setViewer: function(a) {
        if (this.viewer === a) {
            return
        }
        if (this.viewer != null ) {
            this.unregister()
        }
        this.viewer = a;
        if (this.viewer != null ) {
            this.register()
        }
    }
});
COM.gef.ScalableRootEditPart = function ScalableRootEditPart() {
    COM.gef.ScalableRootEditPart.superclass.constructor.call(this);
    this.innerLayers = null ;
    this.printableLayers = null ;
    this.scaledLayers = null 
}
;
COM.gef.ScalableRootEditPart.extend(COM.gef.SimpleRootEditPart, {
    createFigure: function() {
        var a = this.createViewport();
        this.innerLayers = new LayeredPane();
        this.createLayers(this.innerLayers);
        a.setContents(this.innerLayers);
        return a
    },
    createGridLayer: function() {
        return new COM.gef.GridLayer()
    },
    createLayers: function(a) {
        a.add(this.getScaledLayers(), COM.gef.LayerConstants.SCALABLE_LAYERS);
        a.add((function() {
            var b = new Layer();
            b.getPreferredSize = function(d, c) {
                return new Dimension()
            }
            ;
            return b
        })(), COM.gef.LayerConstants.HANDLE_LAYER);
        a.add(new COM.gef.FeedbackLayer(), COM.gef.LayerConstants.FEEDBACK_LAYER)
    },
    createPrintableLayers: function() {
        var b = new LayeredPane();
        var a = new Layer();
        a.setLayoutManager(new StackLayout());
        b.add(a, COM.gef.LayerConstants.PRIMARY_LAYER);
        a = new ConnectionLayer();
        a.setPreferredSize(new Dimension(5,5));
        b.add(a, COM.gef.LayerConstants.CONNECTION_LAYER);
        return b
    },
    createScaledLayers: function() {
        function a() {
            COM.gef.FeedbackLayer.superclass.constructor.call(this);
            this.setEnabled(false)
        }
        a.extend(Layer, {
            getPreferredSize: function(h, c) {
                var l = new Rectangle();
                var g = this.getChildren();
                for (var d = 0; d < g.length; d++) {
                    l.union(g[d].getBounds())
                }
                return l.getSize()
            }
        });
        var b = new ScalableLayeredPane();
        b.add(this.getPrintableLayers(), COM.gef.LayerConstants.PRINTABLE_LAYERS);
        b.add(new a(), COM.gef.LayerConstants.SCALED_FEEDBACK_LAYER);
        return b
    },
    createViewport: function() {
        return new Viewport(true)
    },
    getContentPane: function() {
        return this.getLayer(COM.gef.LayerConstants.PRIMARY_LAYER)
    },
    getDragTracker: function(a) {
        return new MarqueeDragTracker()
    },
    getLayer: function(b) {
        if (this.innerLayers == null ) {
            return null 
        }
        var a = this.scaledLayers.getLayer(b);
        if (a != null ) {
            return a
        }
        a = this.printableLayers.getLayer(b);
        if (a != null ) {
            return a
        }
        return this.innerLayers.getLayer(b)
    },
    getModel: function() {
        return COM.gef.LayerManager.ID
    },
    getPrintableLayers: function() {
        if (this.printableLayers == null ) {
            this.printableLayers = this.createPrintableLayers()
        }
        return this.printableLayers
    },
    getScaledLayers: function() {
        if (this.scaledLayers == null ) {
            this.scaledLayers = this.createScaledLayers()
        }
        return this.scaledLayers
    },
    getZoomManager: function() {
        return this.zoomManager
    },
    refreshGridLayer: function() {},
    register: function() {
        COM.gef.ScalableRootEditPart.superclass.register.call(this);
        if (this.getLayer(COM.gef.LayerConstants.GRID_LAYER) != null ) {
            this.getViewer().addPropertyChangeListener(this.gridListener);
            this.refreshGridLayer()
        }
    },
    unregister: function() {
        this.getViewer().removePropertyChangeListener(this.gridListener);
        COM.gef.ScalableRootEditPart.superclass.unregister.call(this)
    }
});
COM.gef.FreeformGraphicalRootEditPart = function FreeformGraphicalRootEditPart() {
    COM.gef.FreeformGraphicalRootEditPart.superclass.constructor.call(this);
    this.innerLayers = null ;
    this.printableLayers = null ;
    this.gridListener = {}
}
;
COM.gef.FreeformGraphicalRootEditPart.extend(COM.gef.SimpleRootEditPart, {
    createFigure: function() {
        var a = new FreeformViewport();
        this.innerLayers = new FreeformLayeredPane();
        this.createLayers(this.innerLayers);
        a.setContents(this.innerLayers);
        return a
    },
    createGridLayer: function() {
        return new GridLayer()
    },
    createLayers: function(a) {
        a.add(this.getPrintableLayers(), COM.gef.LayerConstants.PRINTABLE_LAYERS);
        a.add(new FreeformLayer(), COM.gef.LayerConstants.HANDLE_LAYER);
        a.add(new COM.gef.FeedbackLayer(), COM.gef.LayerConstants.FEEDBACK_LAYER)
    },
    createPrintableLayers: function() {
        var a = new FreeformLayeredPane();
        a.add(new FreeformLayer(), COM.gef.LayerConstants.PRIMARY_LAYER);
        a.add(new ConnectionLayer(), COM.gef.LayerConstants.CONNECTION_LAYER);
        return a
    },
    getContentPane: function() {
        return this.getLayer(COM.gef.LayerConstants.PRIMARY_LAYER)
    },
    getDragTracker: function(a) {
        return new COM.gef.MarqueeDragTracker()
    },
    getLayer: function(b) {
        if (this.innerLayers == null ) {
            return null 
        }
        var a = this.innerLayers.getLayer(b);
        if (a != null ) {
            return a
        }
        if (this.printableLayers == null ) {
            return null 
        }
        return this.printableLayers.getLayer(b)
    },
    getModel: function() {
        return COM.gef.LayerManager.ID
    },
    getPrintableLayers: function() {
        if (this.printableLayers == null ) {
            this.printableLayers = this.createPrintableLayers()
        }
        return this.printableLayers
    },
    refreshGridLayer: function() {},
    register: function() {
        COM.gef.FreeformGraphicalRootEditPart.superclass.register.call(this);
        if (this.getLayer(COM.gef.LayerConstants.GRID_LAYER) != null ) {
            this.getViewer().addPropertyChangeListener(this.gridListener);
            this.refreshGridLayer()
        }
    },
    unregister: function() {
        this.getViewer().removePropertyChangeListener(this.gridListener);
        COM.gef.FreeformGraphicalRootEditPart.superclass.unregister.call(this)
    }
});
COM.gef.FeedbackLayer = function(a) {
    COM.gef.FeedbackLayer.superclass.constructor.call(this);
    this.setEnabled(false)
}
;
COM.gef.FeedbackLayer.extend(FreeformLayer, {});
COM.gef.AbstractTool = function AbstractTool() {
    COM.gef.AbstractTool.superclass.constructor.call(this);
    this.flags = 0;
    this.accessibleBegin = null ;
    this.accessibleStep = null ;
    this.command = null ;
    var a = this;
    this.commandStackListener = {
        stackChanged: function(b) {
            if (b.isPreChangeEvent()) {
                a.handleCommandStackChanged()
            }
        }
    };
    this.current = null ;
    this.currentViewer = null ;
    this.defaultCursor = null ;
    this.disabledCursor = null ;
    this.domain = null ;
    this.operationSet = null ;
    this.startX = null ;
    this.startY = null ;
    this.state = null ;
    this.property = {};
    this.setFlag(COM.gef.AbstractTool.FLAG_UNLOAD, true)
}
;
COM.gef.AbstractTool.extend(COM.gef.Tool, {
    acceptAbort: function(a) {
        return a.charCode == KeyStroke.ESC
    },
    acceptArrowKey: function(b) {
        var a = b.keyCode;
        if (!(this.isInState(COM.gef.AbstractTool.STATE_INITIAL | COM.gef.AbstractTool.STATE_ACCESSIBLE_DRAG | COM.gef.AbstractTool.STATE_ACCESSIBLE_DRAG_IN_PROGRESS))) {
            return false
        }
        return (a == KeyStroke.ARROW_UP) || (a == KeyStroke.ARROW_RIGHT) || (a == KeyStroke.ARROW_DOWN) || (a == KeyStroke.ARROW_LEFT)
    },
    acceptDragCommit: function(a) {
        return this.isInState(COM.gef.AbstractTool.STATE_ACCESSIBLE_DRAG_IN_PROGRESS) && a.character == 13
    },
    accGetStep: function() {
        return this.accessibleStep
    },
    accStepIncrement: function() {
        if (this.accessibleBegin == -1) {
            this.accessibleBegin = new Date().getTime();
            this.accessibleStep = 1
        } else {
            this.accessibleStep = 4;
            var a = new Date().getTime() - accessibleBegin;
            if (a > 1000) {
                this.accessibleStep = Math.min(16, (a / 150) << 0)
            }
        }
    },
    accStepReset: function() {
        this.accessibleBegin = -1
    },
    activate: function() {
        this.resetFlags();
        this.accessibleBegin = -1;
        this.getCurrentInput().verifyMouseButtons = true;
        this.setState(COM.gef.AbstractTool.STATE_INITIAL);
        this.setFlag(COM.gef.AbstractTool.FLAG_ACTIVE, true);
        this.getDomain().getCommandStack().addCommandStackEventListener(this.commandStackListener)
    },
    addFeedback: function(a) {
        var b = this.getCurrentViewer().getEditPartRegistry().get(COM.gef.LayerManager.ID);
        if (b == null ) {
            return
        }
        b.getLayer(COM.gef.LayerConstants.FEEDBACK_LAYER).add(a)
    },
    applyProperty: function(a, b) {
        if (COM.gef.AbstractTool.PROPERTY_UNLOAD_WHEN_FINISHED === a) {
            if (typeof b === "boolean") {
                this.setUnloadWhenFinished(b)
            }
            return
        }
        if (typeof a !== "string") {
            return
        }
        this.property[a] = b
    },
    calculateCursor: function() {
        if (this.isInState(COM.gef.AbstractTool.STATE_TERMINAL)) {
            return null 
        }
        var a = this.getCurrentCommand();
        if (a == null  || !a.canExecute()) {
            return this.getDisabledCursor()
        }
        return this.getDefaultCursor()
    },
    commitDrag: Function.emptyFunction,
    createOperationSet: function() {
        return this.getCurrentViewer().getSelectedEditParts()
    },
    deactivate: function() {
        this.setFlag(COM.gef.AbstractTool.FLAG_ACTIVE, false);
        this.setViewer(null );
        this.setCurrentCommand(null );
        this.setState(COM.gef.AbstractTool.STATE_TERMINAL);
        this.operationSet = null ;
        this.current = null ;
        this.getDomain().getCommandStack().removeCommandStackEventListener(this.commandStackListener)
    },
    executeCommand: function(a) {
        this.getDomain().getCommandStack().removeCommandStackEventListener(this.commandStackListener);
        try {
            this.getDomain().getCommandStack().execute(a)
        } finally {
            this.getDomain().getCommandStack().addCommandStackEventListener(this.commandStackListener)
        }
    },
    executeCurrentCommand: function() {
        var a = this.getCurrentCommand();
        if (a != null  && a.canExecute()) {
            this.executeCommand(a)
        }
        this.setCurrentCommand(null )
    },
    focusGained: function(a, b) {
        this.setViewer(b);
        this.handleFocusGained()
    },
    focusLost: function(a, b) {
        this.setViewer(b);
        this.handleFocusLost()
    },
    getCommand: function() {
        return COM.gef.UnexecutableCommand.INSTANCE
    },
    getCommandName: Function.needOverride,
    getCurrentCommand: function() {
        return this.command
    },
    getCurrentInput: function() {
        if (this.current == null ) {
            this.current = new COM.gef.Input4Tool()
        }
        return this.current
    },
    getCurrentViewer: function() {
        return this.currentViewer
    },
    getDefaultCursor: function() {
        return this.defaultCursor
    },
    getDisabledCursor: function() {
        if (this.disabledCursor != null ) {
            return this.disabledCursor
        }
        return this.getDefaultCursor()
    },
    getDomain: function() {
        return this.domain
    },
    getDragMoveDelta: function() {
        return this.getLocation().getDifference(this.getStartLocation())
    },
    getLocation: function() {
        return new Point(this.getCurrentInput().getMouseLocation())
    },
    getOperationSet: function() {
        if (this.operationSet == null ) {
            this.operationSet = this.createOperationSet()
        }
        return this.operationSet
    },
    getStartLocation: function() {
        return new Point(this.startX,this.startY)
    },
    getState: function() {
        return this.state
    },
    handleButtonDown: function(a) {
        return false
    },
    handleButtonUp: function(a) {
        return false
    },
    handleCommandStackChanged: function() {
        if (!this.isInState(COM.gef.AbstractTool.STATE_INITIAL | COM.gef.AbstractTool.STATE_INVALID)) {
            this.setState(COM.gef.AbstractTool.STATE_INVALID);
            this.handleInvalidInput();
            return true
        }
        return false
    },
    handleDoubleClick: function(a) {
        return false
    },
    handleClick: function(a) {
        return false
    },
    handleDrag: function() {
        return false
    },
    handleDragInProgress: function() {
        return false
    },
    handleDragStarted: function() {
        return false
    },
    handleFinished: function() {
        if (this.unloadWhenFinished()) {
            this.getDomain().loadDefaultTool()
        } else {
            this.reactivate()
        }
    },
    handleFocusGained: function() {
        return false
    },
    handleFocusLost: function() {
        return false
    },
    handleHover: function() {
        return false
    },
    handleInvalidInput: function() {
        return false
    },
    handleKeyDown: function(a) {
        if (this.acceptAbort(a)) {
            this.getDomain().loadDefaultTool();
            return true
        }
        return false
    },
    handleKeyPressed: function() {
        return false
    },
    handleKeyTraversed: Function.emptyFunction,
    handleKeyUp: function(a) {
        return false
    },
    handleMove: function() {
        return false
    },
    handleNativeDragFinished: function(a) {
        return false
    },
    handleNativeDragStarted: function(a) {
        return false
    },
    handleViewerEntered: function() {
        return false
    },
    handleViewerExited: function() {
        return false
    },
    isActive: function() {
        return this.getFlag(COM.gef.AbstractTool.FLAG_ACTIVE)
    },
    isCurrentViewerMirrored: function() {
        return false
    },
    isHoverActive: function() {
        return this.getFlag(COM.gef.AbstractTool.FLAG_HOVER)
    },
    isInDragInProgress: function() {
        return this.isInState(COM.gef.AbstractTool.STATE_DRAG_IN_PROGRESS | COM.gef.AbstractTool.STATE_ACCESSIBLE_DRAG_IN_PROGRESS)
    },
    isInputSynched: function(c) {
        var b = this.getCurrentInput();
        var a = Mouse.getStatemark(c);
        return b.isMouseButtonDown(1) == ((a & Mouse.BUTTON1) != 0) && b.isMouseButtonDown(2) == ((a & Mouse.BUTTON2) != 0) && b.isMouseButtonDown(3) == ((a & Mouse.BUTTON3) != 0) && b.isMouseButtonDown(4) == ((a & Mouse.BUTTON4) != 0) && b.isMouseButtonDown(5) == ((a & Mouse.BUTTON5) != 0)
    },
    isInState: function(a) {
        return ( (this.getState() & a) != 0) 
    },
    isViewerImportant: function(a) {
        return true
    },
    keyDown: function(a, b) {
        if (!this.isViewerImportant(b)) {
            return
        }
        this.setViewer(b);
        this.getCurrentInput().setInputByKeyboard(a);
        this.handleKeyDown(a)
    },
    keyPressed: function(a, b) {
        if (!this.isViewerImportant(b)) {
            return
        }
        this.setViewer(b);
        this.getCurrentInput().setInputByKeyboard(a);
        this.handleKeyPressed(a)
    },
    keyTraversed: function(a, b) {
        if (!this.isViewerImportant(b)) {
            return
        }
        this.setViewer(b);
        this.getCurrentInput().setInputByKeyboard(a);
        this.handleKeyTraversed(a)
    },
    keyUp: function(a, b) {
        if (!this.isViewerImportant(b)) {
            return
        }
        this.setViewer(b);
        this.getCurrentInput().setInputByKeyboard(a);
        this.handleKeyUp(a)
    },
    mouseClick: function(a, b) {
        if (a.button > 5 || !this.isViewerImportant(b)) {
            return
        }
        this.setViewer(b);
        this.getCurrentInput().setInputByMouse(a, false);
        this.handleClick(Mouse.getMouseNumber(a))
    },
    mouseDoubleClick: function(a, b) {
        if (a.button > 5 || !this.isViewerImportant(b)) {
            return
        }
        this.setViewer(b);
        this.getCurrentInput().setInputByMouse(a, true);
        this.handleDoubleClick(Mouse.getMouseNumber(a))
    },
    mouseDown: function(a, b) {
        if (!this.isViewerImportant(b)) {
            return
        }
        this.setViewer(b);
        this.getCurrentInput().setInputByMouse(a);
        this.getCurrentInput().setMouseButton(Mouse.getMouseNumber(a), true);
        this.startX = a.localX;
        this.startY = a.localY;
        this.handleButtonDown(Mouse.getMouseNumber(a))
    },
    mouseDrag: function(a, c) {
        if (!this.isViewerImportant(c)) {
            return
        }
        this.setViewer(c);
        var b = this.movedPastThreshold();
        this.getCurrentInput().setInputByMouse(a);
        this.handleDrag();
        if (this.movedPastThreshold()) {
            if (!b) {
                this.handleDragStarted()
            }
            this.handleDragInProgress()
        }
    },
    mouseHover: function(a, b) {
        if (!this.isViewerImportant(b)) {
            return
        }
        this.setViewer(b);
        this.getCurrentInput().setInputByMouse(a);
        this.handleHover()
    },
    mouseMove: function(g, h) {
        if (!this.isViewerImportant(h)) {
            return
        }
        this.setViewer(h);
        if (!this.isInputSynched(g)) {
            var d = this.getCurrentInput().isMouseButtonDown(1);
            var c = this.getCurrentInput().isMouseButtonDown(2);
            var b = this.getCurrentInput().isMouseButtonDown(3);
            var a = this.getCurrentInput().isMouseButtonDown(4);
            var l = this.getCurrentInput().isMouseButtonDown(5);
            this.getCurrentInput().verifyMouseButtons = true;
            this.getCurrentInput().setInputByMouse(g);
            if (d) {
                this.handleButtonUp(1)
            }
            if (c) {
                this.handleButtonUp(2)
            }
            if (b) {
                this.handleButtonUp(3)
            }
            if (a) {
                this.handleButtonUp(4)
            }
            if (l) {
                this.handleButtonUp(5)
            }
            if (this.getDomain().getActiveTool() != this) {
                return
            }
            this.setViewer(h)
        } else {
            this.getCurrentInput().setInputByMouse(g)
        }
        if (this.isInState(COM.gef.AbstractTool.STATE_ACCESSIBLE_DRAG_IN_PROGRESS)) {
            this.handleDragInProgress()
        } else {
            this.handleMove()
        }
    },
    mouseUp: function(a, b) {
        if (!this.isViewerImportant(b)) {
            return
        }
        this.setViewer(b);
        this.getCurrentInput().setInputByMouse(a);
        this.getCurrentInput().setMouseButton(Mouse.getMouseNumber(a), false);
        this.handleButtonUp(Mouse.getMouseNumber(a))
    },
    touchStart: function(a, b) {
        if (!this.isViewerImportant(b)) {
            return
        }
        this.setViewer(b);
        this.getCurrentInput().setInputByMouse(a);
        this.getCurrentInput().setMouseButton(Mouse.getMouseNumber(a), true);
        this.startX = a.localX;
        this.startY = a.localY;
        if (this.handleTouchStart) {
            this.handleTouchStart()
        }
    },
    touchMove: function(a, b) {
        if (!this.isViewerImportant(b)) {
            return
        }
        this.setViewer(b);
        this.getCurrentInput().setInputByMouse(a);
        if (this.handleTouchMove) {
            this.handleTouchMove()
        }
    },
    touchEnd: function(a, b) {
        if (!this.isViewerImportant(b)) {
            return
        }
        this.setViewer(b);
        this.getCurrentInput().setInputByMouse(a);
        this.getCurrentInput().setMouseButton(Mouse.getMouseNumber(a), false);
        if (this.handleTouchEnd) {
            this.handleTouchEnd()
        }
    },
    mouseWheelScrolled: function(a, b) {
        if (this.isInState(COM.gef.AbstractTool.STATE_INITIAL)) {
            this.performViewerMouseWheel(a, b)
        }
    },
    movedPastThreshold: function() {
        if (this.getFlag(COM.gef.AbstractTool.FLAG_PAST_THRESHOLD)) {
            return true
        }
        var b = this.getStartLocation()
          , a = this.getLocation();
        if (Math.abs(b.x - a.x) > COM.gef.AbstractTool.DRAG_THRESHOLD || Math.abs(b.y - a.y) > COM.gef.AbstractTool.DRAG_THRESHOLD) {
            this.setFlag(COM.gef.AbstractTool.FLAG_PAST_THRESHOLD, true);
            return true
        }
        return false
    },
    nativeDragFinished: function(a, b) {
        if (!this.isViewerImportant(b)) {
            return
        }
        this.setViewer(b);
        this.handleNativeDragFinished(a)
    },
    nativeDragStarted: function(a, b) {
        if (!this.isViewerImportant(b)) {
            return
        }
        this.setViewer(b);
        this.handleNativeDragStarted(a)
    },
    performViewerMouseWheel: function(a, b) {},
    placeMouseInViewer: function(a) {},
    reactivate: function() {
        var a = this.getCurrentViewer();
        this.deactivate();
        this.activate();
        if (a != null ) {
            var b = a.getControl();
            if (b != null  && !b.isDisposed() && b.isFocusControl()) {
                this.setViewer(a)
            }
        }
    },
    refreshCursor: function() {
        if (this.isActive()) {
            this.setCursor(this.calculateCursor())
        }
    },
    releaseToolCapture: function() {
        this.getCurrentViewer().setRouteEventsToEditDomain(false)
    },
    removeFeedback: function(a) {
        var b = this.getCurrentViewer().getEditPartRegistry().get(COM.gef.LayerManager.ID);
        if (b == null ) {
            return
        }
        b.getLayer(COM.gef.LayerConstants.FEEDBACK_LAYER).remove(a)
    },
    resetFlags: function() {
        this.setFlag(COM.gef.AbstractTool.FLAG_PAST_THRESHOLD, false);
        this.setFlag(COM.gef.AbstractTool.FLAG_HOVER, false)
    },
    setCurrentCommand: function(a) {
        this.command = a;
        this.refreshCursor()
    },
    setCursor: function(a) {
        if (this.getCurrentViewer() != null ) {
            this.getCurrentViewer().setCursor(a)
        }
    },
    setDefaultCursor: function(a) {
        if (this.defaultCursor == a) {
            return
        }
        this.defaultCursor = a;
        this.refreshCursor()
    },
    setDisabledCursor: function(a) {
        if (this.disabledCursor == a) {
            return
        }
        this.disabledCursor = a;
        this.refreshCursor()
    },
    setEditDomain: function(a) {
        this.domain = a
    },
    setHoverActive: function(a) {
        this.setFlag(COM.gef.AbstractTool.FLAG_HOVER, a)
    },
    setMouseCapture: function(a) {
        if (this.getCurrentViewer() != null  && this.getCurrentViewer().getControl() != null  && !this.getCurrentViewer().getControl().isDisposed()) {
            this.getCurrentViewer().getControl().setCapture(a)
        }
    },
    setProperties: function(b) {
        if (b == null ) {
            return
        }
        for (var a in b) {
            this.applyProperty(a, b[a])
        }
    },
    setStartLocation: function(a) {
        this.startX = a.x;
        this.startY = a.y
    },
    setState: function(a) {
        this.state = a
    },
    setToolCapture: function() {
        this.getCurrentViewer().setRouteEventsToEditDomain(true)
    },
    setUnloadWhenFinished: function(a) {
        this.setFlag(COM.gef.AbstractTool.FLAG_UNLOAD, a)
    },
    setViewer: function(a) {
        if (a == this.currentViewer) {
            return
        }
        this.setCursor(null );
        this.currentViewer = a;
        if (this.currentViewer != null ) {
            this.getCurrentInput().setMouseLocation(this.startX, this.startY)
        }
        this.refreshCursor()
    },
    stateTransition: function(b, a) {
        if ((this.getState() & b) != 0) {
            this.setState(a);
            return true
        } else {
            return false
        }
    },
    unloadWhenFinished: function() {
        return this.getFlag(COM.gef.AbstractTool.FLAG_UNLOAD)
    },
    viewerEntered: function(a, b) {
        if (!this.isViewerImportant(b)) {
            return
        }
        this.getCurrentInput().setInputByMouse(a);
        if (this.getCurrentViewer() != null  && this.getCurrentViewer() != b) {
            this.handleViewerExited()
        }
        this.setViewer(b);
        this.handleViewerEntered()
    },
    viewerExited: function(a, b) {
        if (b === this.getCurrentViewer()) {
            this.getCurrentInput().setInputByMouse(a);
            this.handleViewerExited();
            this.setViewer(null )
        }
    },
    setFlag: function(a, b) {
        if (b) {
            this.flags |= a
        } else {
            this.flags &= ~a
        }
    },
    getFlag: function(a) {
        return (this.flags & a) != 0
    },
    debug_printState: function(b) {
        var a;
        switch (b) {
        case 1:
            a = "STATE_INITIAL";
            break;
        case 2:
            a = "STATE_DRAG";
            break;
        case 4:
            a = "STATE_DRAG_IN_PROGRESS";
            break;
        case 8:
            a = "STATE_INVALID";
            break;
        case 16:
            a = "STATE_ACCESSIBLE_DRAG";
            break;
        case 32:
            a = "STATE_ACCESSIBLE_DRAG_IN_PROGRESS";
            break;
        case 1 << 30:
            a = "STATE_TERMINAL";
            break
        }
    }
});
COM.gef.AbstractTool.PROPERTY_UNLOAD_WHEN_FINISHED = "unloadWhenFinished";
COM.gef.AbstractTool.DRAG_THRESHOLD = 5;
COM.gef.AbstractTool.FLAG_ACTIVE = 8;
COM.gef.AbstractTool.FLAG_PAST_THRESHOLD = 1;
COM.gef.AbstractTool.FLAG_UNLOAD = 4;
COM.gef.AbstractTool.MAX_FLAG = 8;
COM.gef.AbstractTool.MAX_STATE = 32;
COM.gef.AbstractTool.MOUSE_BUTTON1 = 524288;
COM.gef.AbstractTool.MOUSE_BUTTON2 = 1048576;
COM.gef.AbstractTool.MOUSE_BUTTON3 = 2097152;
COM.gef.AbstractTool.MOUSE_BUTTON_ANY = 1;
COM.gef.AbstractTool.STATE_ACCESSIBLE_DRAG = 16;
COM.gef.AbstractTool.STATE_ACCESSIBLE_DRAG_IN_PROGRESS = 32;
COM.gef.AbstractTool.STATE_DRAG = 2;
COM.gef.AbstractTool.STATE_DRAG_IN_PROGRESS = 4;
COM.gef.AbstractTool.STATE_INITIAL = 1;
COM.gef.AbstractTool.STATE_INVALID = 8;
COM.gef.AbstractTool.STATE_TERMINAL = 1 << 30;
COM.gef.AbstractTool.MODIFIER_NO_SNAPPING = 1;
COM.gef.FlagSupport = function() {
    this.flags = 0
}
;
COM.gef.FlagSupport.extend(Object, {
    getFlag: function(a) {
        return (this.flags & a) != 0
    },
    setFlag: function(a, b) {
        if (b) {
            this.flags |= a
        } else {
            this.flags &= ~a
        }
    }
});
COM.gef.Input4Tool = function() {
    COM.gef.Input4Tool.superclass.constructor.call(this);
    this.modifiers = null ;
    this.mouse = new Point();
    this.verifyMouseButtons = null 
}
;
COM.gef.Input4Tool.extend(COM.gef.FlagSupport, {
    getModifiers: function() {
        return this.modifiers
    },
    getMouseLocation: function() {
        return this.mouse
    },
    isAltKeyDown: function() {
        return (this.modifiers & KeyStroke.ALT) != 0
    },
    isAnyButtonDown: function() {
        return this.getFlag(2 | 4 | 8 | 16 | 32)
    },
    isControlKeyDown: function() {
        return (this.modifiers & KeyStroke.CTRL) != 0
    },
    isModKeyDown: function(a) {
        return (this.modifiers & a) != 0
    },
    isMouseButtonDown: function(a) {
        return this.getFlag(1 << a)
    },
    isShiftKeyDown: function() {
        return (this.modifiers & KeyStroke.SHIFT) != 0
    },
    setInputByKeyboard: function(a) {
        this.modifiers = KeyStroke.getStatemark(a.altKey, a.ctrlKey, a.shiftKey);
        this.e = a.e
    },
    setInputByMouse: function(a, b) {
        this.setMouseLocation(a.localX, a.localY);
        this.e = a.e;
        this.modifiers = Mouse.getStatemark(a) | KeyStroke.getStatemark(a.altKey, a.ctrlKey, a.shiftKey);
        if (this.verifyMouseButtons) {
            this.setMouseButton(1, (this.modifiers & Mouse.BUTTON1) != 0);
            this.setMouseButton(2, (this.modifiers & Mouse.BUTTON2) != 0);
            this.setMouseButton(3, (this.modifiers & Mouse.BUTTON3) != 0);
            this.setMouseButton(4, (this.modifiers & Mouse.BUTTON4) != 0);
            this.setMouseButton(5, (this.modifiers & Mouse.BUTTON5) != 0);
            this.verifyMouseButtons = false
        }
    },
    getBrowserEvent: function() {
        return this.e
    },
    setMouseButton: function(b, a) {
        this.setFlag(1 << b, a)
    },
    setMouseLocation: function(a, b) {
        this.mouse.x = a;
        this.mouse.y = b
    }
});
COM.gef.TargetingTool = function TargetingTool() {
    COM.gef.TargetingTool.superclass.constructor.call(this);
    this.targetRequest = null ;
    this.targetEditPart = null 
}
;
COM.gef.TargetingTool.extend(COM.gef.AbstractTool, {
    createTargetRequest: function() {
        var a = new Request();
        a.setType(this.getCommandName());
        return a
    },
    deactivate: function() {
        if (this.isHoverActive()) {
            this.resetHover()
        }
        this.eraseTargetFeedback();
        this.targetEditPart = null ;
        this.targetRequest = null ;
        COM.gef.TargetingTool.superclass.deactivate.call(this)
    },
    eraseTargetFeedback: function() {
        if (!this.isShowingTargetFeedback()) {
            return
        }
        this.setFlag(COM.gef.TargetingTool.FLAG_TARGET_FEEDBACK, false)
    },
    getCommand: function() {
        if (this.getTargetEditPart() == null ) {
            return null 
        }
        return this.getTargetEditPart().getCommand(this.getTargetRequest())
    },
    getExclusionSet: function() {
        return []
    },
    getTargetingConditional: function() {
        var a = this;
        return {
            evaluate: function(b) {
                return b.getTargetEditPart(a.getTargetRequest()) != null 
            }
        }
    },
    getTargetEditPart: function() {
        return this.targetEditPart
    },
    getTargetRequest: function() {
        if (this.targetRequest == null ) {
            this.setTargetRequest(this.createTargetRequest())
        }
        return this.targetRequest
    },
    handleEnteredEditPart: function() {
        this.updateTargetRequest();
        this.showTargetFeedback();
        return true
    },
    handleExitingEditPart: function() {
        this.resetHover();
        this.eraseTargetFeedback();
        return true
    },
    handleHoverStop: function() {
        return false
    },
    handleInvalidInput: function() {
        this.eraseTargetFeedback();
        this.setCurrentCommand(COM.gef.UnexecutableCommand.INSTANCE);
        return true
    },
    handleLeavingEditPart: Function.emptyFunction,
    handleViewerExited: function() {
        this.setTargetEditPart(null );
        return true
    },
    isShowingTargetFeedback: function() {
        return this.getFlag(COM.gef.TargetingTool.FLAG_TARGET_FEEDBACK)
    },
    isTargetLocked: function() {
        return this.getFlag(COM.gef.TargetingTool.FLAG_LOCK_TARGET)
    },
    lockTargetEditPart: function(a) {
        if (a == null ) {
            this.unlockTargetEditPart();
            return
        }
        this.setFlag(COM.gef.TargetingTool.FLAG_LOCK_TARGET, true);
        this.setTargetEditPart(a)
    },
    resetFlags: function() {
        this.setFlag(COM.gef.TargetingTool.FLAG_LOCK_TARGET, false);
        COM.gef.TargetingTool.superclass.resetFlags.call(this)
    },
    resetHover: function() {
        if (this.isHoverActive()) {
            this.handleHoverStop()
        }
        this.setHoverActive(false)
    },
    setTargetEditPart: function(a) {
        if (a != this.targetEditPart) {
            if (this.targetEditPart != null ) {
                this.handleExitingEditPart()
            }
            this.targetEditPart = a;
            if (this.getTargetRequest() != null  && this.getTargetRequest().setTargetEditPart != null ) {
                this.getTargetRequest().setTargetEditPart(this.targetEditPart)
            }
            this.handleEnteredEditPart()
        }
    },
    setTargetRequest: function(a) {
        this.targetRequest = a
    },
    showTargetFeedback: function() {
        if (this.getTargetEditPart() != null ) {
            this.getTargetEditPart().showTargetFeedback(this.getTargetRequest())
        }
        this.setFlag(COM.gef.TargetingTool.FLAG_TARGET_FEEDBACK, true)
    },
    unlockTargetEditPart: function() {
        this.setFlag(COM.gef.TargetingTool.FLAG_LOCK_TARGET, false);
        this.updateTargetUnderMouse()
    },
    updateTargetRequest: Function.emptyFunction,
    updateTargetUnderMouse: function() {
        if (!this.isTargetLocked()) {
            var a = this.getCurrentViewer().findObjectAtExcluding(this.getLocation(), this.getExclusionSet(), this.getTargetingConditional());
            if (a != null ) {
                a = a.getTargetEditPart(this.getTargetRequest())
            }
            var b = this.getTargetEditPart() != a;
            this.setTargetEditPart(a);
            return b
        } else {
            return false
        }
    }
});
COM.gef.TargetingTool.FLAG_LOCK_TARGET = COM.gef.AbstractTool.MAX_FLAG << 1;
COM.gef.TargetingTool.FLAG_TARGET_FEEDBACK = COM.gef.AbstractTool.MAX_FLAG << 2;
COM.gef.TargetingTool.MAX_FLAG = COM.gef.TargetingTool.FLAG_TARGET_FEEDBACK;
COM.gef.SelectionTool = function SelectionTool() {
    COM.gef.SelectionTool.superclass.constructor.call(this);
    this.handleIndex = null ;
    this.dragTracker = null ;
    this.hoverRequest = null 
}
;
COM.gef.SelectionTool.extend(COM.gef.TargetingTool, {
    acceptTraverseHandle: function(a) {
        return (a.charCode == ".".charCodeAt(0) || a.charCode == ">".charCodeAt(0)) && isInState(STATE_INITIAL | STATE_ACCESSIBLE_DRAG | STATE_ACCESSIBLE_DRAG_IN_PROGRESS) && !a.altKey && !a.ctrlKey
    },
    createHoverRequest: function() {
        this.hoverRequest = new COM.gef.LocationRequest();
        this.hoverRequest.setType(COM.gef.RequestConstants.REQ_SELECTION_HOVER)
    },
    createTargetRequest: function() {
        var a = new COM.gef.SelectionRequest();
        a.setType(this.getCommandName());
        return a
    },
    deactivate: function() {
        this.setDragTracker(null );
        COM.gef.SelectionTool.superclass.deactivate.call(this)
    },
    eraseHoverFeedback: function() {
        if (this.getTargetEditPart() == null ) {
            return
        }
        if (this.getTargetHoverRequest() == null ) {
            return
        }
        this.getTargetEditPart().eraseTargetFeedback(this.getTargetHoverRequest())
    },
    getCommandName: function() {
        return COM.gef.RequestConstants.REQ_SELECTION
    },
    getDragTracker: function() {
        return this.dragTracker
    },
    getTargetHoverRequest: function() {
        if (this.hoverRequest == null ) {
            this.createHoverRequest()
        }
        return this.hoverRequest
    },
    handleDoubleClick: function(b) {
        var g = this.getCurrentViewer();
        var d = this.getLocation();
        if (this.getDragTracker() != null ) {
            this.getDragTracker().deactivate()
        }
        var c = g.findHandleAt(d);
        if (c != null ) {
            this.setDragTracker(c.getDragTracker());
            return true
        }
        this.updateTargetRequest();
        this.getTargetRequest().setLastButtonPressed(b);
        this.updateTargetUnderMouse();
        var a = this.getTargetEditPart();
        if (a != null ) {
            this.setDragTracker(a.getDragTracker(this.getTargetRequest()));
            this.lockTargetEditPart(a);
            return true
        }
        return false
    },
    handleButtonDown: function(b) {
        if (!this.stateTransition(COM.gef.AbstractTool.STATE_INITIAL, COM.gef.AbstractTool.STATE_DRAG)) {
            this.resetHover();
            return true
        }
        this.resetHover();
        var g = this.getCurrentViewer();
        var d = this.getLocation();
        if (this.getDragTracker() != null ) {
            this.getDragTracker().deactivate()
        }
        var c = g.findHandleAt(d);
        if (c != null ) {
            this.setDragTracker(c.getDragTracker());
            return true
        }
        this.updateTargetRequest();
        this.getTargetRequest().setLastButtonPressed(b);
        this.updateTargetUnderMouse();
        var a = this.getTargetEditPart();
        if (a != null ) {
            this.setDragTracker(a.getDragTracker(this.getTargetRequest()));
            this.lockTargetEditPart(a);
            return true
        }
        return false
    },
    touchStart: function(a, b) {
        COM.gef.SelectionTool.superclass.touchStart.call(this, a, b);
        if (this.getDragTracker() != null  && this.getDragTracker().touchStart) {
            this.getDragTracker().touchStart(a, b)
        }
    },
    touchMove: function(a, b) {
        if (this.getDragTracker() != null  && this.getDragTracker().touchMove) {
            this.getDragTracker().touchMove(a, b)
        }
        COM.gef.SelectionTool.superclass.touchMove.call(this, a, b)
    },
    touchEnd: function(a, b) {
        if (this.getDragTracker() != null  && this.getDragTracker().touchEnd) {
            this.getDragTracker().touchEnd(a, b)
        }
        COM.gef.SelectionTool.superclass.touchEnd.call(this, a, b)
    },
    handleTouchStart: function() {
        var d = this.getCurrentViewer();
        var c = this.getLocation();
        if (this.getDragTracker() != null ) {
            this.getDragTracker().deactivate()
        }
        var b = d.findHandleAt(c);
        if (b != null ) {
            this.setDragTracker(b.getDragTracker());
            return true
        }
        this.updateTargetRequest();
        this.updateTargetUnderMouse();
        var a = this.getTargetEditPart();
        if (a != null ) {
            this.setDragTracker(a.getDragTracker(this.getTargetRequest()));
            return true
        }
        return false
    },
    handleTouchEnd: function() {
        this.getTargetRequest().setLastButtonPressed(0);
        this.setDragTracker(null );
        this.unlockTargetEditPart();
        return true
    },
    handleButtonUp: function(a) {
        if (this.getCurrentInput().isAnyButtonDown()) {
            return false
        }
        this.getTargetRequest().setLastButtonPressed(0);
        this.setDragTracker(null );
        this.setState(COM.gef.AbstractTool.STATE_INITIAL);
        this.unlockTargetEditPart();
        return true
    },
    handleCommandStackChanged: function() {
        if (this.getDragTracker() == null ) {
            COM.gef.SelectionTool.superclass.handleCommandStackChanged.call(this)
        }
        return false
    },
    handleFocusLost: function() {
        if (this.isInState(COM.gef.AbstractTool.STATE_ACCESSIBLE_DRAG | COM.gef.AbstractTool.STATE_ACCESSIBLE_DRAG_IN_PROGRESS | COM.gef.AbstractTool.STATE_DRAG | COM.gef.AbstractTool.STATE_DRAG_IN_PROGRESS)) {
            if (this.getDragTracker() != null ) {
                this.setState(COM.gef.AbstractTool.STATE_INITIAL)
            }
            return true
        }
        return false
    },
    handleKeyDown: function(a) {
        this.resetHover();
        if (this.acceptArrowKey(a)) {
            if (this.stateTransition(COM.gef.AbstractTool.STATE_ACCESSIBLE_DRAG, COM.gef.AbstractTool.STATE_ACCESSIBLE_DRAG_IN_PROGRESS)) {
                return true
            }
        }
        if (this.acceptAbort(a)) {
            if (this.getDragTracker() != null ) {
                this.setDragTracker(null )
            }
            if (this.isInState(COM.gef.AbstractTool.STATE_TRAVERSE_HANDLE | COM.gef.AbstractTool.STATE_ACCESSIBLE_DRAG | COM.gef.AbstractTool.STATE_ACCESSIBLE_DRAG_IN_PROGRESS)) {
                this.placeMouseInViewer(this.getStartLocation().getTranslated(6, 6))
            }
            this.setState(COM.gef.AbstractTool.STATE_INITIAL);
            this.setLastHandleProvider(null );
            return true
        }
        if (this.acceptTraverseHandle(a)) {
            if (this.isInState(COM.gef.AbstractTool.STATE_ACCESSIBLE_DRAG_IN_PROGRESS)) {
                if (this.getDragTracker() != null ) {
                    this.getDragTracker().commitDrag()
                }
            }
            if (this.isInState(COM.gef.AbstractTool.STATE_ACCESSIBLE_DRAG | COM.gef.AbstractTool.STATE_ACCESSIBLE_DRAG_IN_PROGRESS)) {
                this.setDragTracker(null );
                this.getCurrentViewer().flush()
            }
            if (!this.handleTraverseHandle(a)) {
                this.setState(COM.gef.AbstractTool.STATE_INITIAL)
            }
            return true
        }
        if (this.acceptDragCommit(a)) {
            if (this.getDragTracker() != null ) {
                this.getDragTracker().commitDrag()
            }
            this.setDragTracker(null );
            this.setState(COM.gef.AbstractTool.STATE_INITIAL);
            this.handleIndex--;
            this.placeMouseInViewer(this.getLocation().getTranslated(6, 6));
            return true
        }
        if (this.isInState(COM.gef.AbstractTool.STATE_INITIAL)) {
            this._performHandleKey("keyDown", a)
        }
        return false
    },
    handleKeyPressed: function(a) {
        if (this.isInState(COM.gef.AbstractTool.STATE_INITIAL)) {
            this._performHandleKey("keyPressed", a)
        }
        return false
    },
    handleKeyUp: function(a) {
        if (this.isInState(COM.gef.AbstractTool.STATE_INITIAL)) {
            this._performHandleKey("keyReleased", a)
        }
        return false
    },
    _performHandleKey: function(c, b) {
        var a = this.getCurrentViewer().getKeyHandler();
        if (a && a[c]) {
            a[c](b)
        }
    },
    handleMove: function() {
        if (this.stateTransition(COM.gef.AbstractTool.STATE_ACCESSIBLE_DRAG, COM.gef.AbstractTool.STATE_INITIAL)) {
            this.setDragTracker(null )
        }
        if (this.isInState(COM.gef.AbstractTool.STATE_INITIAL)) {
            this.updateTargetRequest();
            this.updateTargetUnderMouse();
            this.showTargetFeedback();
            return true
        } else {
            if (this.isInState(COM.gef.AbstractTool.STATE_TRAVERSE_HANDLE)) {
                var a = this.getCurrentViewer();
                handle = a.findHandleAt(this.getLocation());
                if (handle != null ) {
                    this.setState(COM.gef.AbstractTool.STATE_ACCESSIBLE_DRAG);
                    this.setStartLocation(this.getLocation());
                    this.setDragTracker(handle.getDragTracker());
                    return true
                } else {
                    this.setState(COM.gef.AbstractTool.STATE_INITIAL)
                }
            }
        }
        return false
    },
    keyDown: function(a, b) {
        if (this.getDragTracker() != null ) {
            this.getDragTracker().keyDown(a, b)
        }
        COM.gef.SelectionTool.superclass.keyDown.call(this, a, b)
    },
    keyUp: function(a, b) {
        if (this.getDragTracker() != null ) {
            this.getDragTracker().keyUp(a, b)
        }
        COM.gef.SelectionTool.superclass.keyUp.call(this, a, b)
    },
    mouseDown: function(a, b) {
        COM.gef.SelectionTool.superclass.mouseDown.call(this, a, b);
        if (this.getDragTracker() != null ) {
            this.getDragTracker().mouseDown(a, b)
        }
    },
    mouseDoubleClick: function(a, b) {
        COM.gef.SelectionTool.superclass.mouseDoubleClick.call(this, a, b);
        if (this.getDragTracker() != null ) {
            this.getDragTracker().mouseDoubleClick(a, b)
        }
        this.handleButtonUp(Mouse.getMouseNumber(a))
    },
    mouseDrag: function(a, b) {
        if (this.getDragTracker() != null ) {
            this.getDragTracker().mouseDrag(a, b)
        }
        COM.gef.SelectionTool.superclass.mouseDrag.call(this, a, b)
    },
    mouseHover: function(a, b) {
        if (this.getDragTracker() != null ) {
            this.getDragTracker().mouseHover(a, b)
        }
        COM.gef.SelectionTool.superclass.mouseHover.call(this, a, b)
    },
    mouseMove: function(a, b) {
        if (this.getDragTracker() != null ) {
            this.getDragTracker().mouseMove(a, b)
        }
        COM.gef.SelectionTool.superclass.mouseMove.call(this, a, b)
    },
    mouseUp: function(a, b) {
        if (this.getDragTracker() != null ) {
            this.getDragTracker().mouseUp(a, b)
        }
        COM.gef.SelectionTool.superclass.mouseUp.call(this, a, b)
    },
    mouseWheelScrolled: function(a, b) {
        if (this.getDragTracker() != null ) {
            this.getDragTracker().mouseWheelScrolled(event, b);
            event.doit = false
        } else {
            COM.gef.SelectionTool.superclass.mouseWheelScrolled.call(this, a, b)
        }
    },
    refreshCursor: function() {
        if (this.getDragTracker() == null ) {
            COM.gef.SelectionTool.superclass.refreshCursor.call(this)
        }
    },
    setDragTracker: function(a) {
        if (a == this.dragTracker) {
            return
        }
        if (this.dragTracker != null ) {
            this.dragTracker.deactivate()
        }
        this.dragTracker = a;
        if (a != null ) {
            a.setEditDomain(this.getDomain());
            a.activate();
            a.setViewer(this.getCurrentViewer())
        }
        this.refreshCursor()
    },
    updateHoverRequest: function() {
        var a = this.getTargetHoverRequest();
        a.setLocation(this.getLocation())
    },
    updateTargetRequest: function() {
        var a = this.getTargetRequest();
        a.setModifiers(this.getCurrentInput().getModifiers());
        a.setType(this.getCommandName());
        a.setLocation(this.getLocation());
        this.updateHoverRequest()
    }
});
COM.gef.SelectionTool.FLAG_HOVER_FEEDBACK = COM.gef.TargetingTool.MAX_FLAG << 1;
COM.gef.SelectionTool.MAX_FLAG = COM.gef.SelectionTool.FLAG_HOVER_FEEDBACK;
COM.gef.SelectionTool.STATE_TRAVERSE_HANDLE = COM.gef.AbstractTool.MAX_STATE << 1;
COM.gef.SelectionTool.MAX_STATE = COM.gef.SelectionTool.STATE_TRAVERSE_HANDLE;
COM.gef.SimpleDragTracker = function SimpleDragTracker() {
    COM.gef.SimpleDragTracker.superclass.constructor.call(this);
    this.sourceRequest = null 
}
;
COM.gef.SimpleDragTracker.extend(COM.gef.AbstractTool, {
    calculateCursor: function() {
        if (this.isInState(COM.gef.AbstractTool.STATE_INITIAL | COM.gef.AbstractTool.STATE_DRAG | COM.gef.AbstractTool.STATE_ACCESSIBLE_DRAG)) {
            return this.getDefaultCursor()
        }
        return COM.gef.SimpleDragTracker.superclass.calculateCursor.call(this)
    },
    commitDrag: function() {
        this.eraseSourceFeedback();
        this.performDrag();
        this.setState(COM.gef.AbstractTool.STATE_TERMINAL)
    },
    createSourceRequest: function() {
        return new COM.gef.Request()
    },
    deactivate: function() {
        this.eraseSourceFeedback();
        this.sourceRequest = null ;
        COM.gef.SimpleDragTracker.superclass.deactivate.call(this)
    },
    eraseSourceFeedback: function() {
        if (!this.isShowingFeedback()) {
            return
        }
        this.setFlag(COM.gef.SimpleDragTracker.FLAG_SOURCE_FEEDBACK, false);
        var b = this.getOperationSet();
        for (var c = 0; c < b.length; c++) {
            var a = b[c];
            a.eraseSourceFeedback(this.getSourceRequest())
        }
    },
    getSourceRequest: function() {
        if (this.sourceRequest == null ) {
            this.sourceRequest = this.createSourceRequest()
        }
        return this.sourceRequest
    },
    handleButtonDown: function(a) {
        if (a != 1) {
            this.setState(COM.gef.AbstractTool.STATE_INVALID);
            this.handleInvalidInput()
        } else {
            this.stateTransition(COM.gef.AbstractTool.STATE_INITIAL, COM.gef.AbstractTool.STATE_DRAG)
        }
        return true
    },
    handleButtonUp: function(a) {
        if (this.stateTransition(COM.gef.AbstractTool.STATE_DRAG_IN_PROGRESS, COM.gef.AbstractTool.STATE_TERMINAL)) {
            this.eraseSourceFeedback();
            this.performDrag()
        }
        return true
    },
    handleDragInProgress: function() {
        if (this.isInDragInProgress()) {
            this.updateSourceRequest();
            this.showSourceFeedback();
            this.setCurrentCommand(this.getCommand())
        }
        return true
    },
    handleDragStarted: function() {
        return this.stateTransition(COM.gef.AbstractTool.STATE_DRAG, COM.gef.AbstractTool.STATE_DRAG_IN_PROGRESS)
    },
    handleInvalidInput: function() {
        this.eraseSourceFeedback();
        this.setCurrentCommand(null );
        return true
    },
    handleKeyDown: function(a) {
        if (this.acceptArrowKey(a)) {
            this.accStepIncrement();
            if (this.stateTransition(COM.gef.AbstractTool.STATE_INITIAL, COM.gef.AbstractTool.STATE_ACCESSIBLE_DRAG_IN_PROGRESS)) {
                this.setStartLocation(this.getLocation())
            }
            return true
        }
        return false
    },
    handleKeyUp: function(a) {
        if (this.acceptArrowKey(a)) {
            this.accStepReset();
            return true
        }
        return false
    },
    isShowingFeedback: function() {
        return this.getFlag(COM.gef.SimpleDragTracker.FLAG_SOURCE_FEEDBACK)
    },
    performDrag: function() {
        this.executeCurrentCommand()
    },
    showSourceFeedback: function() {
        var b = this.getOperationSet();
        for (var c = 0; c < b.length; c++) {
            var a = b[c];
            a.showSourceFeedback(this.getSourceRequest())
        }
        this.setFlag(COM.gef.SimpleDragTracker.FLAG_SOURCE_FEEDBACK, true)
    },
    updateSourceRequest: function() {
        this.getSourceRequest().setType(this.getCommandName())
    }
});
COM.gef.SimpleDragTracker.FLAG_SOURCE_FEEDBACK = COM.gef.AbstractTool.MAX_FLAG << 1;
COM.gef.SimpleDragTracker.MAX_FLAG = COM.gef.SimpleDragTracker.FLAG_SOURCE_FEEDBACK;
COM.gef.LocationRequest = function LocationRequest(a) {
    COM.gef.LocationRequest.superclass.constructor.call(a);
    this.location = null 
}
;
COM.gef.LocationRequest.extend(COM.gef.Request, {
    getLocation: function() {
        return this.location
    },
    setLocation: function(a) {
        this.location = a
    }
});
COM.gef.SelectionRequest = function SelectionRequest(a) {
    COM.gef.LocationRequest.superclass.constructor.call(a);
    this.statemask = null ;
    this.lastButtonPressed = null 
}
;
COM.gef.SelectionRequest.extend(COM.gef.LocationRequest, {
    getLastButtonPressed: function() {
        return this.lastButtonPressed
    },
    getModifiers: function() {
        return this.statemask
    },
    isAltKeyPressed: function() {
        return ( (this.statemask & KeyStroke.ALT) != 0) 
    },
    isAnyMouseButtonPressed: function() {
        return ( (this.statemask & Mouse.BUTTON_ANY) != 0) 
    },
    isControlKeyPressed: function() {
        return ( (this.statemask & KeyStroke.CTRL) != 0) 
    },
    isLeftMouseButtonPressed: function() {
        return ( (this.statemask & Mouse.BUTTON1) != 0) 
    },
    isRightMouseButtonPressed: function() {
        return ( (this.statemask & Mouse.BUTTON3) != 0) 
    },
    isShiftKeyPressed: function() {
        return ( (this.statemask & KeyStroke.SHIFT) != 0) 
    },
    setModifiers: function(a) {
        this.statemask = a
    },
    setLastButtonPressed: function(a) {
        this.lastButtonPressed = a
    }
});
COM.gef.AbstractHandle = function AbstractHandle(b, a, c) {
    COM.gef.AbstractHandle.superclass.constructor.call(this);
    this.isHandle = true;
    this.editpart = null ;
    this.dragTracker = null ;
    this.locator = null ;
    this.setOwner(b);
    this.setLocator(a);
    this.setCursor(c)
}
;
COM.gef.AbstractHandle.extend(Figure, {
    addNotify: function() {
        COM.gef.AbstractHandle.superclass.addNotify.call(this);
        this.getOwnerFigure().addAncestorListener(this)
    },
    ancestorMoved: function(a) {
        this.revalidate()
    },
    ancestorAdded: Function.emptyFunction,
    ancestorRemoved: Function.emptyFunction,
    createDragTracker: Function.emptyFunction,
    getAccessibleLocation: function() {
        var a = this.etBounds().getCenter();
        this.translateToAbsolute(a);
        return a
    },
    getDragTracker: function() {
        if (this.dragTracker == null ) {
            this.dragTracker = this.createDragTracker()
        }
        return this.dragTracker
    },
    getLocator: function() {
        return this.locator
    },
    getOwner: function() {
        return this.editpart
    },
    getOwnerFigure: function() {
        return this.getOwner().getFigure()
    },
    removeNotify: function() {
        this.getOwnerFigure().removeAncestorListener(this);
        COM.gef.AbstractHandle.superclass.removeAncestorListener.call(this)
    },
    setDragTracker: function(a) {
        this.dragTracker = a
    },
    setLocator: function(a) {
        this.locator = a
    },
    setOwner: function(a) {
        this.editpart = a
    },
    validate: function() {
        if (this.isValid()) {
            return
        }
        this.getLocator().relocate(this);
        COM.gef.AbstractHandle.superclass.validate.call(this)
    }
});
COM.gef.MoveHandle = function MoveHandle(b, a) {
    if (a == null  && b != null ) {
        a = new MoveHandleLocator(b.getFigure())
    }
    COM.gef.MoveHandle.superclass.constructor.call(this, b, a);
    this.innerPad = 2;
    this.initialize()
}
;
COM.gef.MoveHandle.extend(COM.gef.AbstractHandle, {
    createDragTracker: function() {
        return new COM.gef.SimpleDragTracker()
    },
    containsPoint: function(a, b) {
        if (!COM.gef.MoveHandle.superclass.containsPoint.call(this, a, b)) {
            return false
        }
        return !Rectangle.SINGLETON.setBounds(this.getBounds()).shrink(this.innerPad * 2, this.innerPad * 2).contains(a, b)
    },
    getInnerPad: function() {
        return this.innerPad
    },
    setInnerPad: function(a) {
        this.innerPad = a
    },
    getAccessibleLocation: function() {
        var a = this.getBounds().getTopRight().translate(-1, this.getBounds().height / 4);
        this.translateToAbsolute(a);
        return a
    },
    initialize: function() {
        this.setOpaque(false);
        this.setBorder(new LineBorder(this.innerPad));
        this.setCursor(Cursor.MOVE)
    }
});
COM.gef.MoveHandleLocator = function MoveHandleLocator(a) {
    COM.gef.MoveHandleLocator.superclass.constructor.call(this);
    this.setReference(a)
}
;
COM.gef.MoveHandleLocator.extend(Object, {
    getReference: function() {
        return this.reference
    },
    relocate: function(a) {},
    setReference: function(a) {
        this.reference = a
    }
});
COM.gef.AbstractEditPolicy = function AbstractEditPolicy() {
    COM.gef.AbstractEditPolicy.superclass.constructor.call(this);
    this.host = null 
}
;
COM.gef.AbstractEditPolicy.extend(COM.gef.EditPolicy, {
    activate: Function.emptyFunction,
    deactivate: Function.emptyFunction,
    eraseSourceFeedback: Function.emptyFunction,
    eraseTargetFeedback: Function.emptyFunction,
    getCommand: Function.emptyFunction,
    getHost: function() {
        return this.host
    },
    getTargetEditPart: Function.emptyFunction,
    setHost: function(a) {
        this.host = a
    },
    showSourceFeedback: Function.emptyFunction,
    showTargetFeedback: Function.emptyFunction,
    understandsRequest: Function.emptyFunction
});
COM.gef.GraphicalEditPolicy = function GraphicalEditPolicy() {
    COM.gef.GraphicalEditPolicy.superclass.constructor.call(this)
}
;
COM.gef.GraphicalEditPolicy.extend(COM.gef.AbstractEditPolicy, {
    addFeedback: function(a) {
        this.getFeedbackLayer().add(a)
    },
    getFeedbackLayer: function() {
        return this.getLayer(COM.gef.LayerConstants.FEEDBACK_LAYER)
    },
    getHostFigure: function() {
        this.getHost().getFigure()
    },
    getLayer: function(a) {
        return COM.gef.LayerManager.Helper.find(this.getHost()).getLayer(a)
    },
    removeFeedback: function(a) {
        this.getFeedbackLayer().remove(a)
    }
});
Debugger.lock();
COM.widget.Grid = function Grid(t, z, v) {
    if (COM.widget.Grid.idCount) {
        this.id = "_grid_" + (COM.widget.Grid.idCount++)
    } else {
        COM.widget.Grid.idCount = 1;
        this.id = "_grid_1"
    }
    this.listeners = {};
    var m = null ;
    var b = null ;
    var A = null ;
    var n = null ;
    var o = null ;
    var p = v;
    var c = null ;
    var h = false;
    function d() {
        var B = document.createElement("div");
        B.className = "gridHtml5";
        B.style.position = "relative";
        B.style.overflow = "hidden";
        return B
    }
    function l() {
        return m
    }
    this.reload = function(C) {
        var B = l().isVisible();
        var E = this.getAbsoluteScrollLeft();
        var D = this.getAbsoluteScrollTop();
        if (o) {
            n.removeChild(o);
            r.call(this);
            if (C) {
                a.call(this, C)
            }
            this.fireEvent("reload", {})
        }
        l().onVisibleChanged(B);
        this.setScrollLeft(E);
        this.setScrollTop(D)
    }
    ;
    this.dispose = function() {
        if (this.isDisposed()) {
            return
        }
        h = true;
        if (o && n) {
            n.removeChild(o)
        }
        o = null ;
        p = null ;
        n = null ;
        c = null ;
        if (this.gridModel && this.gridModel.dispose) {
            this.gridModel.dispose();
            this.gridModel = null 
        }
        if (b && b.dispose) {
            b.dispose();
            b = null 
        }
        if (m && m.dispose) {
            m.dispose();
            m = null 
        }
        if (A && A.dispose) {
            A.dispose();
            A = null 
        }
        this.listeners = null ;
        d = null ;
        l = null ;
        w = null ;
        a = null ;
        r = null ;
        s = null ;
        q = null ;
        u = null ;
        for (var B in this) {
            delete this[B]
        }
    }
    ;
    this.isDisposed = function() {
        return h
    }
    ;
    var g = {};
    function w() {
        if (this.isDisposed()) {
            throw "grid has disposed!"
        }
    }
    function a(B) {
        this.gridModel = new COM.widget.Grid.GridModel(this,B,p ? p.cellFigureFactory : null );
        this.gridModel.shareManager = g;
        this.gridModel.defaultHelper = new COM.widget.Grid.DefaultHelper();
        b.setContents(this.gridModel);
        this.gridModel.onSizeChanged();
        m = this.gridModel.editPart;
        m.onDataSizeChanged();
        m.refreshVisuals_scroll()
    }
    function r() {
        o = d();
        n.appendChild(o);
        A = new COM.gef.EditDomain(o);
        b = new COM.widget.Grid.GridViewer(p ? p.eventSource : null ,p ? p.scrollHelper : null );
        var C = this.width || n.clientWidth;
        var B = this.height || n.clientHeight;
        b.setSize(C, B);
        o.style.width = C + "px";
        o.style.height = B + "px";
        this.width = C;
        this.height = B;
        b.setEditPartFactory(new COM.widget.Grid.PartFactory());
        A.addViewer(b)
    }
    function s(B, C) {
        try {
            n = B;
            r.call(this);
            if (C) {
                a.call(this, C)
            }
        } catch (D) {
            Debugger.error(D)
        }
    }
    this.addListener = function(F, G, C) {
        var E = this.listeners[F];
        if (E == null ) {
            this.listeners[F] = [];
            E = this.listeners[F]
        }
        for (var D = 0, B = E.length - 1; D < B; D += 2) {
            if (E[D] === G && E[D + 1] === C) {
                return
            }
        }
        E.push(G);
        E.push(C)
    }
    ;
    this.removeListener = function(F, G, C) {
        var E = this.listeners[F];
        if (E == null ) {
            return
        }
        for (var D = 0, B = E.length - 1; D < B; D += 2) {
            if (E[D] === G && (C == null  || E[D + 1] === C)) {
                E.splice(D, 2);
                B -= 2;
                D -= 2
            }
        }
    }
    ;
    this.fireEvent = function(F, G) {
        var E = this.listeners[F];
        if (E == null ) {
            return
        }
        if (G) {
            G.grid = this
        }
        try {
            for (var D = 0, B = E.length - 1; D < B; D += 2) {
                if (E[D]) {
                    if (E[D + 1]) {
                        E[D].call(E[D + 1], G)
                    } else {
                        E[D].call(window, G)
                    }
                }
            }
        } catch (C) {
            Debugger.error(C)
        }
    }
    ;
    this.focus = function() {
        l().focus()
    }
    ;
    this.blur = function() {
        l().blur()
    }
    ;
    this.setId = function(B) {
        this.id = B
    }
    ;
    this.getId = function() {
        return this.id
    }
    ;
    this.setBlurCurrentCellColor = function(B) {
        this.gridModel.data.options.blurCurrentCellColor = B
    }
    ;
    this.keyEnter = function() {
        l().performKeyEnter()
    }
    ;
    this.keyDirection = function(B) {
        l().performKeyDirection(B)
    }
    ;
    this.setSize = function(C, B) {
        if (!q()) {
            c = {
                width: C,
                height: B
            };
            return
        }
        if (C == this.width && B == this.height) {
            return
        }
        this.width = C;
        this.height = B;
        o.style.width = C + "px";
        o.style.height = B + "px";
        if (b) {
            b.setSize(C, B)
        }
        this.gridModel.onSizeChanged(C, B);
        l().onSizeChanged();
        l().refreshVisuals_scroll()
    }
    ;
    this.getDataSize = function() {
        return this.gridModel.getDataSize()
    }
    ;
    this.getDataLoadMode = function() {
        return this.gridModel.data.options.loadMode
    }
    ;
    this.setSelectionMode = function(B) {
        this.gridModel.data.options.selectionMode = B
    }
    ;
    this.getSelectionMode = function() {
        return this.gridModel.data.options.selectionMode
    }
    ;
    this.setEditMode = function(C) {
        if (this.gridModel.data.options.editMode == C) {
            return
        }
        this.gridModel.data.options.editMode = C;
        if (C == COM.widget.Grid.EDIT_MODE_READ_ONLY) {
            this.closeActiveEditor()
        } else {
            if (C == COM.widget.Grid.EDIT_MODE_INPUT && !this.getCurrentCell().isEditable()) {
                this.closeActiveEditor()
            }
        }
        l().clearInputCache();
        var B = l().getCurrentCellColRow();
        this.fireEvent(COM.widget.Grid.Event.EDIT_MODE_CHANGED, {
            col: B.col,
            row: B.row
        })
    }
    ;
    this.getEditMode = function() {
        return this.gridModel.data.options.editMode
    }
    ;
    this.setEnterNext = function(B) {
        this.gridModel.setEnterNext(B)
    }
    ;
    this.getEnterNext = function() {
        return this.gridModel.getEnterNext()
    }
    ;
    this.setRowSelectable = function(B) {
        this.gridModel.data.options.rowSelectable = B
    }
    ;
    this.isRowSelectable = function() {
        return this.gridModel.data.options.rowSelectable
    }
    ;
    this.setAdvancedResize = function(B) {}
    ;
    this.isAdvancedResize = function() {
        return this.gridModel.isAdvancedResize()
    }
    ;
    this.setRowColResizeable = function(C, B) {
        this.gridModel.setRowColResizeable(C, B)
    }
    ;
    this.setColRowResizeable = function(B, C) {
        this.gridModel.setColRowResizeable(B, C)
    }
    ;
    this.isRowColResizeable = function(B) {
        return this.gridModel.isRowColResizeable(B)
    }
    ;
    this.isColRowResizeable = function(B) {
        return this.gridModel.isColRowResizeable(B)
    }
    ;
    this.setColSelectable = function(B) {
        this.gridModel.data.options.colSelectable = B
    }
    ;
    this.isColSelectable = function() {
        return this.gridModel.data.options.colSelectable
    }
    ;
    this.setIgnoreHidden = function(B) {
        this.gridModel.data.options.ignoreHidden = B
    }
    ;
    this.isIgnoreHidden = function() {
        return this.gridModel.data.options.ignoreHidden
    }
    ;
    this.setColResizeable = function(B) {
        this.gridModel.data.options.colResizeable = B
    }
    ;
    this.isColResizeable = function() {
        return this.gridModel.data.options.colResizeable
    }
    ;
    this.setRowResizeable = function(B) {
        this.gridModel.data.options.rowResizeable = B
    }
    ;
    this.isRowResizeable = function() {
        return this.gridModel.data.options.rowResizeable
    }
    ;
    this.setColFreeResizeable = function(B) {
        this.gridModel.data.options.colFreeResizeable = B
    }
    ;
    this.isColFreeResizeable = function() {
        return this.gridModel.data.options.colFreeResizeable
    }
    ;
    this.setRowFreeResizeable = function(B) {
        this.gridModel.data.options.rowFreeResizeable = B
    }
    ;
    this.isRowFreeResizeable = function() {
        return this.gridModel.data.options.rowFreeResizeable
    }
    ;
    this.setColGrabable = function(B) {
        if (this.gridModel.data.options.colGrabable != B) {
            this.gridModel.data.options.colGrabable = B;
            this.gridModel.freshColGrab(B)
        }
    }
    ;
    this.isColGrabable = function() {
        return this.gridModel.data.options.colGrabable
    }
    ;
    this.setShowSelectionBorder = function(B) {
        this.gridModel.data.options.showSelectionBorder = B
    }
    ;
    this.isShowSelectionBorder = function() {
        return this.gridModel.data.options.showSelectionBorder
    }
    ;
    this.setCurrenCellBorderHidden = function(B) {
        this.gridModel.data.options.currentCellBorderHidden = B
    }
    ;
    this.isCurrenCellBorderHidden = function() {
        return this.gridModel.data.options.currentCellBorderHidden
    }
    ;
    this.setColExchangeable = function(B) {
        this.gridModel.data.options.colExchangeable = B
    }
    ;
    this.isColExchangeable = function() {
        return this.gridModel.data.options.colExchangeable
    }
    ;
    this.setPassReadonly = function(B) {
        this.gridModel.data.options.passReadOnly = B
    }
    ;
    this.isPassReadOnly = function() {
        return this.gridModel.data.options.passReadOnly
    }
    ;
    this.setShowSelectionChange = function(B) {
        this.gridModel.data.options.showSelectionChange = B
    }
    ;
    this.isShowSelectionChange = function() {
        return this.gridModel.data.options.showSelectionChange
    }
    ;
    this.setSelectionColor = function(B) {
        this.gridModel.data.options.slectionColor = B
    }
    ;
    this.getSelectionColor = function() {
        return this.gridModel.data.options.slectionColor
    }
    ;
    this.setSelectionBorderColor = function(B) {
        this.gridModel.data.options.selectionBorderColor = B
    }
    ;
    this.getSelectionBorderColor = function() {
        return this.gridModel.data.options.selectionBorderColor
    }
    ;
    this.setCurrentCellColor = function(B) {
        this.gridModel.data.options.currentCellColor = B
    }
    ;
    this.getCurrentCellColor = function() {
        return this.gridModel.data.options.currentCellColor
    }
    ;
    this.setDefaultBorderColor = function(B) {
        this.gridModel.data.options.defaultBorderColor = B
    }
    ;
    this.getDefaultBorderColor = function() {
        return this.gridModel.data.options.defaultBorderColor
    }
    ;
    this.setDefaultBorderStyle = function(B) {
        this.gridModel.data.options.defaultBorderStyle = B
    }
    ;
    this.getDefaultBorderStyle = function() {
        return this.gridModel.data.options.defaultBorderStyle
    }
    ;
    this.setCurrentCellBorderColor = function(B) {
        this.gridModel.data.options.currentCellBorderColor = B
    }
    ;
    this.getCurrentCellBorderColor = function() {
        return this.gridModel.data.options.currentCellBorderColor
    }
    ;
    this.setMergeCellShowMode = function(B) {
        this.gridModel.data.options.mergeCellShowMode = B
    }
    ;
    this.getCellShowMode = function() {
        return this.gridModel.data.options.mergeCellShowMode
    }
    ;
    this.getCurrentCell = function() {
        return l().getCurrentCell()
    }
    ;
    this.setCurrentCell = function(B, D, C) {
        var E = C ? C : {
            type: COM.widget.Grid.CAUSE_CALL
        };
        if (this.getDataLoadMode() != COM.widget.Grid.LOAD_MODE_NORMAL) {
            l().setCurrentCellWidthDataCheck(B, D, E)
        } else {
            l().setCurrentCell(B, D, E)
        }
    }
    ;
    this.setScrollLeft = function(B) {
        l().setScrollLeft(B)
    }
    ;
    this.setScrollTop = function(B) {
        l().setScrollTop(B)
    }
    ;
    this.getScrollLeft = function() {
        return l().getFixedScrollLeft()
    }
    ;
    this.getScrollTop = function() {
        return l().getFixedScrollTop()
    }
    ;
    this.getAbsoluteScrollLeft = function() {
        return l().getScrollLeft()
    }
    ;
    this.getAbsoluteScrollTop = function() {
        return l().getScrollTop()
    }
    ;
    this.getScrollHeight = function() {
        return l().getScrollHeight()
    }
    ;
    this.getScrollWidth = function() {
        return l().getScrollWidth()
    }
    ;
    this.addSelection = function(C, F, D, B, E) {
        l().addSelection(new Rectangle(C,F,D,B), E)
    }
    ;
    this.getSelections = function() {
        var E = l().getSelections();
        var C = [];
        var F;
        if (E != null  && E.length > 0) {
            for (var D = 0, B = E.length; D < B; D++) {
                F = E[D];
                C[D] = {
                    x: F.x,
                    y: F.y,
                    width: F.width,
                    height: F.height
                }
            }
        }
        return C
    }
    ;
    this.getSelection = function() {
        var C = l().getSelection();
        var B = null ;
        if (C != null ) {
            B = {
                x: C.x,
                y: C.y,
                width: C.width,
                height: C.height
            }
        }
        return B
    }
    ;
    this.select = function(C, D) {
        var B;
        if (C != null ) {
            B = new Rectangle(C.x,C.y,C.width,C.height)
        }
        if (B && !B.isEmpty()) {
            return l().select(B, D)
        } else {
            return this.clearSelection()
        }
    }
    ;
    this.setSelections = function(D, F) {
        var G = [];
        var E;
        var B;
        var C;
        if (D) {
            for (B = 0; B < D.length; B++) {
                var C = D[B];
                E = new Rectangle(C.x,C.y,C.width,C.height);
                if (!E.isEmpty()) {
                    G.push(E)
                }
            }
        }
        if (G.length > 0) {
            if (this.getDataLoadMode() != COM.widget.Grid.LOAD_MODE_NORMAL) {
                l().setSelectionsWidthDataCheck(G, F)
            } else {
                l().setSelections(G, F)
            }
        } else {
            this.clearSelection()
        }
    }
    ;
    this.clearSelection = function() {
        l().clearSelection()
    }
    ;
    this.setColCount = function(B) {
        this.gridModel.setColCount(B)
    }
    ;
    this.setRowCount = function(B) {
        this.gridModel.setRowCount(B)
    }
    ;
    this.getRowCount = function() {
        return this.gridModel.getRowCount()
    }
    ;
    this.getColCount = function() {
        return this.gridModel.getColCount()
    }
    ;
    this.setColHeaderCount = function(B) {
        return this.gridModel.setColHeaderCount(B)
    }
    ;
    this.setRowHeaderCount = function(B) {
        return this.gridModel.setRowHeaderCount(B)
    }
    ;
    this.setColFooterCount = function(B) {
        return this.gridModel.setColFooterCount(B)
    }
    ;
    this.setRowFooterCount = function(B) {
        return this.gridModel.setRowFooterCount(B)
    }
    ;
    this.getRowHeaderCount = function() {
        return this.gridModel.getRowHeaderCount()
    }
    ;
    this.getColHeaderCount = function() {
        return this.gridModel.getColHeaderCount()
    }
    ;
    this.getRowFooterCount = function() {
        return this.gridModel.getRowFooterCount()
    }
    ;
    this.getColFooterCount = function() {
        return this.gridModel.getColFooterCount()
    }
    ;
    this.setRowHeight = function(C, B) {
        this.gridModel.setRowSize(C, B)
    }
    ;
    this.setColWidth = function(B, C) {
        this.gridModel.setColSize(B, C)
    }
    ;
    this.getRowHeight = function(B) {
        return this.gridModel.getRowSize(B)
    }
    ;
    this.getColWidth = function(B) {
        return this.gridModel.getColSize(B)
    }
    ;
    this.insertCols = function(B, D, F, C) {
        if (C == null ) {
            C = COM.widget.Grid.COPY_STYLE
        }
        var E = new COM.widget.Grid.InsertColsCommand();
        E.setGridModel(this.gridModel).setIndex(B).setCount(D).setCopyIndex(F).setCopyWay(C);
        A.getCommandStack().execute(E)
    }
    ;
    this.insertRows = function(B, D, F, C) {
        if (C == null ) {
            C = COM.widget.Grid.COPY_STYLE
        }
        var E = new COM.widget.Grid.InsertRowsCommand();
        E.setGridModel(this.gridModel).setIndex(B).setCount(D).setCopyIndex(F).setCopyWay(C);
        A.getCommandStack().execute(E)
    }
    ;
    this.deleteCols = function(B, C) {
        var D = new COM.widget.Grid.DeleteColsCommand();
        D.setGridModel(this.gridModel).setIndex(B).setCount(C);
        A.getCommandStack().execute(D)
    }
    ;
    this.deleteRows = function(B, C) {
        var D = new COM.widget.Grid.DeleteRowsCommand();
        D.setGridModel(this.gridModel).setIndex(B).setCount(C);
        A.getCommandStack().execute(D)
    }
    ;
    this.setColVisible = function(B, C) {
        this.gridModel.setColVisible(B, C)
    }
    ;
    this.setRowVisible = function(C, B) {
        this.gridModel.setRowVisible(C, B)
    }
    ;
    this.isColHidden = function(B) {
        return this.gridModel.isColHidden(B)
    }
    ;
    this.isRowHidden = function(B) {
        return this.gridModel.isRowHidden(B)
    }
    ;
    this.setRowBackgroundColor = function(C, B) {
        this.gridModel.setRowBackgroundColor(C, B)
    }
    ;
    this.setColGrab = function(C, B) {
        this.gridModel.setColGrab(C, B)
    }
    ;
    this.isColGrab = function(B) {
        return this.gridModel.getColGrab(B)
    }
    ;
    this.setRowAutoHeight = function(B, C) {
        this.gridModel.setRowAutoHeight(B, C)
    }
    ;
    this.isRowAutoHeight = function(B) {
        return this.gridModel.isRowAutoHeight(B)
    }
    ;
    this.setColAutoWidth = function(B, C) {
        this.gridModel.setColAutoWidth(B, C)
    }
    ;
    this.isColAutoWidth = function(B) {
        return this.gridModel.isColAutoWidth(B)
    }
    ;
    this.mergeCell = function(C, E, D, B) {
        this.gridModel.mergeCell(C, E, D, B)
    }
    ;
    this.unMergeCell = function(B, D, C) {
        this.gridModel.unMergeCell(B, D, C)
    }
    ;
    this.paste = function(B, C) {
        this.gridModel.paste(B.x, B.y)
    }
    ;
    this.cut = function(C, B) {
        return this.gridModel.cut(C)
    }
    ;
    this.copy = function(C, B) {
        return this.gridModel.copy(C)
    }
    ;
    this.setCopyFunction = function(B, C) {
        g.copyFunction = B;
        g.copyObj = C
    }
    ;
    this.setPasteFunction = function(B, C) {
        g.pasteFunction = B;
        g.pasteObj = C
    }
    ;
    this.expandTree = function(B, D, C) {}
    ;
    this.collapseTree = function(B, C) {}
    ;
    this.setDefaultEditor = function(B) {
        this.gridModel.setDefaultEditor(B)
    }
    ;
    this.setDefaultEditorId = function(B) {
        this.gridModel.setDefaultEditorId(B)
    }
    ;
    this.getDefaultEditorId = function() {
        return this.gridModel.getDefaultEditorId()
    }
    ;
    this.getDefaultEditor = function() {
        return this.gridModel.getDefaultEditor()
    }
    ;
    this.getActiveEditorId = function() {
        return l().getActiveEditorId()
    }
    ;
    this.getActiveEditor = function() {
        return l().getActiveEditor()
    }
    ;
    this.openEditor = function(B, C) {
        l().setCurrentCell(B, C, {
            type: COM.widget.Grid.CAUSE_CALL
        });
        l().editCurrentCell({
            type: COM.widget.Grid.CAUSE_CALL
        })
    }
    ;
    this.editCurrentCell = function(B) {
        l().editCurrentCell(B || {
            type: COM.widget.Grid.CAUSE_CALL
        })
    }
    ;
    this.closeActiveEditor = function() {
        l().commitEdit(COM.widget.Grid.CAUSE_CALL)
    }
    ;
    this.clearText = function(B) {
        this.gridModel.clearText(B, COM.widget.Grid.CAUSE_CALL)
    }
    ;
    this.getCellByPoint = function(B, D) {
        var C = l().getColRow(B, D);
        if (C == null ) {
            return {
                col: -1,
                row: -1
            }
        }
        return C
    }
    ;
    this.loadData = function(B) {
        this.gridModel.loadData(B.byRow, B.list, B.unknown)
    }
    ;
    this.setColHeadCursor = function(B) {
        this.gridModel.setColHeadCursor(B)
    }
    ;
    this.setRowHeadCursor = function(B) {
        this.gridModel.setRowHeadCursor(B)
    }
    ;
    this.getCell = function(C, D) {
        var B = this.gridModel.getCellController(C, D);
        return B
    }
    ;
    this.clearRect = function(B, C) {
        this.gridModel.clearRect(B, COM.widget.Grid.CAUSE_CLEAR, C)
    }
    ;
    this.deleteRect = function(B, C) {
        this.gridModel.deleteRect(B, C)
    }
    ;
    this.isEditing = function() {
        return l().isEditing()
    }
    ;
    this.setCellDefaultBorderStyle = function(D, B, E, C) {}
    ;
    this.getCellDefaultBorderStyle = function() {}
    ;
    this.getHeight = function() {
        return this.height
    }
    ;
    this.getWidth = function() {
        return this.width
    }
    ;
    this.getDataClientHeight = function() {
        return this.gridModel.getDataClientHeight()
    }
    ;
    this.getDataClientWidth = function() {
        return this.gridModel.getDataClientWidth()
    }
    ;
    this.getDataHeight = function() {
        return this.gridModel.getDataHeight()
    }
    ;
    this.getDataWidth = function() {
        return this.gridModel.getDataWidth()
    }
    ;
    this.beginUpdate = function() {
        l().getFigure().getUpdateManager().lock()
    }
    ;
    this.endUpdate = function() {
        l().getFigure().getUpdateManager().unlock();
        l().getFigure().getUpdateManager().queueWork()
    }
    ;
    this.getImageUrlById = function(B) {
        return B
    }
    ;
    this.setEnabled = function(B) {
        this.gridModel.setEnabled(B)
    }
    ;
    this.setShowInsDelAnimation = function(B) {
        this.gridModel.setShowInsDelAnimation(B)
    }
    ;
    this.isShowInsDelAnimation = function() {
        return this.gridModel.isShowInsDelAnimation()
    }
    ;
    this.canCellEdit = function(C, D) {
        var B = l().getCell(C, D);
        return l().canEdit(B)
    }
    ;
    this.appendChild = function(C) {
        var B = b.getElement();
        B.appendChild(C)
    }
    ;
    this.removeChild = function(C) {
        var B = b.getElement();
        B.removeChild(C)
    }
    ;
    this.setVisible = function(B) {
        if (q() == B) {
            return
        }
        l().onVisibleChanged(B);
        u.call(this, B)
    }
    ;
    var u = function(B) {
        if (B) {
            if (c) {
                this.setSize(c.width, c.height);
                c = null 
            }
        }
    }
    ;
    var q = function() {
        return l().isVisible()
    }
    ;
    this.isVisible = q;
    this.getDrawAreaInfo = function() {
        var B = {};
        B.startRow = l().drawStartRow;
        B.startCol = l().drawStartCol;
        B.endRow = l().drawEndRow;
        B.endCol = l().drawEndCol;
        return B
    }
    ;
    s.call(this, t, z)
}
;
COM.widget.Grid.ThemeProvider = {
    UNCHECKED_IMAGE: ImageResourceManager.getImage("data:image/gif;base64,R0lGODlhDQANAPcAAEJCQrW1tc7OztbWzv///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////ywAAAAADQANAAAIPQAFBBhIsGAAAgEAKFzIUABCAAQiSpToMOHEixUhXqT4cCNHix4JZAwpsmPIkSdNeqwooOUAlwJeDiB5MSAAOw=="),
    CHECKED_IMAGE: ImageResourceManager.getImage("data:image/gif;base64,R0lGODlhDQANAPcAAAAAAEJCQrW1tc7OztbWzv///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////ywAAAAADQANAAAITwAHCBhIsKCAAgICKFzIcADCAAUiSpToMOFEiQAKVIR4EUBGAg8LZIzoMeNGkRlLRgRpsaRHiiFRjlwZU+TFkxdhChjAk8AAnz9/5hxaICAAOw=="),
    getUnCheckedImage: function() {
        return this.UNCHECKED_IMAGE
    },
    getCheckedImage: function() {
        return this.CHECKED_IMAGE
    },
    getDefaultHeadColor: function() {
        return "#f0f"
    }
};
COM.widget.Grid.deserialize = function(d) {
    function b(p, h) {
        if (p == null  || h == null ) {
            return
        }
        var l;
        var t;
        var o, n, m, q, r, s;
        for (o = 0; o < p.length; o++) {
            l = p[o];
            if (l == null ) {
                continue
            }
            for (n = 0; n < l.length; n++) {
                t = l[n];
                if (t == null ) {
                    continue
                }
                if (o > 0 && n > 0) {
                    for (s in h) {
                        if (s == "borderColor" || s == "border" || s == "padding" || s == "gradientBackground") {
                            continue
                        }
                        if (typeof t[s] == "undefined" && typeof h[s] != "undefined") {
                            t[s] = h[s]
                        }
                    }
                    if (typeof t.borderColor == "undefined" && typeof h.borderColor != "undefined") {
                        var g = h.borderColor;
                        var r = [];
                        t.borderColor = r;
                        for (m = 0; m < g.length; m++) {
                            r[m] = g[m]
                        }
                    }
                    if (typeof t.border == "undefined" && typeof h.border != "undefined") {
                        var g = h.border;
                        var r = [];
                        t.border = r;
                        for (m = 0; m < g.length; m++) {
                            r[m] = g[m]
                        }
                    }
                    if (typeof t.padding == "undefined" && typeof h.padding != "undefined") {
                        g = h.padding;
                        r = [];
                        t.padding = r;
                        for (m = 0; m < g.length; m++) {
                            r[m] = g[m]
                        }
                    }
                    if (typeof t.gradientBackground == "undefined" && typeof h.gradientBackground != "undefined") {
                        g = h.gradientBackground;
                        r = {};
                        t.gradientBackground = r;
                        for (s in g) {
                            r[s] = g[s]
                        }
                    }
                }
                if (t.cellMode == null ) {
                    t.cellMode = COM.widget.Grid.Cell.Cell_MODE_NORMAL
                }
                t.showText = t["1"];
                t.editText = t["2"];
                t.colIndex = t["3"];
                t.rowIndex = t["4"];
                delete t["1"];
                delete t["2"];
                delete t["3"];
                delete t["4"]
            }
        }
    }
    var a = d.cells;
    if (a) {
        var c = a.rowList
    }
    if (c) {
        b(c, d.defaultStyle)
    }
}
;
COM.widget.Grid.LOAD_MODE_NORMAL = 1;
COM.widget.Grid.LOAD_MODE_LAZY = 2;
COM.widget.Grid.LOAD_MODE_STREAM = 3;
COM.widget.Grid.SELECTION_MODE_ROW = 1;
COM.widget.Grid.SELECTION_MODE_COL = 2;
COM.widget.Grid.SELECTION_MODE_MULTI = 3;
COM.widget.Grid.SELECTION_MODE_SINGLE = 4;
COM.widget.Grid.EDIT_MODE_READ_ONLY = 1;
COM.widget.Grid.EDIT_MODE_INPUT = 2;
COM.widget.Grid.EDIT_MODE_EDIT = 3;
COM.widget.Grid.DELETE_DEAL_VERTI = 1;
COM.widget.Grid.DELETE_DEAL_HORIZ = 2;
COM.widget.Grid.ENTER_NEXT_NONE = 0;
COM.widget.Grid.ENTER_NEXT_UP = 1;
COM.widget.Grid.ENTER_NEXT_LEFT = 2;
COM.widget.Grid.ENTER_NEXT_DOWN = 3;
COM.widget.Grid.ENTER_NEXT_RIGHT = 4;
COM.widget.Grid.MERGE_SHOW_MODE_NORMAL = 1;
COM.widget.Grid.MERGE_SHOW_MODE_CONTRACT = 2;
COM.widget.Grid.RESULT_FALSE = 0;
COM.widget.Grid.RESULT_TRUE = 1;
COM.widget.Grid.COPY_CONTENT = 1;
COM.widget.Grid.COPY_STYLE = 2;
COM.widget.Grid.COPY_BOTH = COM.widget.Grid.COPY_CONTENT | COM.widget.Grid.COPY_STYLE;
COM.widget.Grid.PASTE_TEXT = 1;
COM.widget.Grid.PASTE_STYLE = 2;
COM.widget.Grid.PASTE_BOTH = COM.widget.Grid.PASTE_TEXT | COM.widget.Grid.PASTE_STYLE;
COM.widget.Grid.CAUSE_MOUSE = 1;
COM.widget.Grid.CAUSE_KEY = 2;
COM.widget.Grid.CAUSE_CALL = 3;
COM.widget.Grid.CAUSE_CLEAR = 4;
COM.widget.Grid.CAUSE_CUT = 5;
COM.widget.Grid.CAUSE_PASTE = 6;
COM.widget.Grid.CAUSE_INPUT = 7;
COM.widget.Grid.CAUSE_DELETE = 8;
COM.widget.Grid.CAUSE_CLICKFACE = 9;
COM.widget.Grid.BUTTON_LEFT = 1;
COM.widget.Grid.BUTTON_RIGHT = 2;
COM.widget.Grid.BUTTON_CENTER = 4;
COM.widget.Grid.CURRENT_CELL_SHOW_TYPE = {
    BORDER: true,
    BACK: false
};
COM.widget.Grid.Cell = function(a, b) {
    this.cell = a;
    this.gridModel = b
}
;
COM.widget.Grid.Cell.prototype.setEditorId = function(a) {
    this.gridModel.setCellEditorId(this.cell.colIndex, this.cell.rowIndex, a)
}
;
COM.widget.Grid.Cell.prototype.getEditorId = function() {
    return this.cell.editorId
}
;
COM.widget.Grid.Cell.prototype.setEditor = function(a) {
    this.cell.editor = a
}
;
COM.widget.Grid.Cell.prototype.getEditor = function() {
    return this.cell.editor
}
;
COM.widget.Grid.Cell.prototype.setTitle = function(a) {
    this.cell.title = a;
    if (this.cell.figure) {
        this.cell.figure.setToolTip(a)
    }
}
;
COM.widget.Grid.Cell.prototype.getTitle = function() {
    return this.cell.title
}
;
COM.widget.Grid.Cell.prototype.getShowText = function() {
    return this.cell.showText
}
;
COM.widget.Grid.Cell.prototype.setShowText = function(b, a) {
    if (this.cell.figure) {
        this.cell.figure.setText(b);
        this.cell.figure.repaint()
    }
    if (this.getCellMode() == COM.widget.Grid.Cell.Cell_MODE_HTML) {
        this.setCellMode(COM.widget.Grid.Cell.Cell_MODE_NORMAL)
    }
    if (b == this.cell.showText) {
        return
    }
    this.cell.showText = b;
    if (a !== true) {
        this.gridModel.fireEvent(COM.widget.Grid.Event.DATA_CHANGE, {
            rect: {
                x: this.getCol(),
                y: this.getRow(),
                width: 1,
                height: 1
            },
            cause: COM.widget.Grid.CAUSE_CALL
        })
    }
}
;
COM.widget.Grid.Cell.prototype.getEditText = function() {
    return this.cell.editText
}
;
COM.widget.Grid.Cell.prototype.setEditText = function(b, a) {
    if (b == this.cell.editText) {
        return
    }
    this.cell.editText = b;
    if (a !== true) {
        this.gridModel.fireEvent(COM.widget.Grid.Event.DATA_CHANGE, {
            rect: {
                x: this.getCol(),
                y: this.getRow(),
                width: 1,
                height: 1
            },
            cause: COM.widget.Grid.CAUSE_CALL
        })
    }
}
;
COM.widget.Grid.Cell.prototype.setHtml = function(a) {
    this.setCellMode(COM.widget.Grid.Cell.Cell_MODE_HTML);
    this.cell.html = a;
    var c = this.cell.figure;
    if (c) {
        c.setText("");
        c.setHtml(a);
        var b = c.getParent();
        if (b) {
            c.appendControl(b.getZindex(c), b.controlParent)
        }
    }
}
;
COM.widget.Grid.Cell.prototype.getHtml = function() {
    return this.cell.html
}
;
COM.widget.Grid.Cell.prototype.getCol = function() {
    return this.cell.colIndex
}
;
COM.widget.Grid.Cell.prototype.getRow = function() {
    return this.cell.rowIndex
}
;
COM.widget.Grid.Cell.prototype.getColSpan = function() {
    return this.cell.colSpan
}
;
COM.widget.Grid.Cell.prototype.getRowSpan = function() {
    return this.cell.rowSpan
}
;
COM.widget.Grid.Cell.prototype.getMergedInfo = function() {
    if (this.cell.merged) {
        return this.cell.mergeInfo
    }
}
;
COM.widget.Grid.Cell.prototype.setControl = function(c) {
    this.setCellMode(COM.widget.Grid.Cell.Cell_MODE_CONTROL);
    this.cell.control = c;
    var a = this.cell.figure;
    if (a) {
        a.setControl(c);
        var b = a.getParent();
        if (b) {
            a.appendControl(b.getZindex(a), b.controlParent);
            a.repaint()
        }
    }
}
;
COM.widget.Grid.Cell.prototype.getControl = function() {
    return this.cell.control
}
;
COM.widget.Grid.Cell.prototype.reomveControl = function() {
    this.cell.control = null ;
    this.cell.cellMode = COM.widget.Grid.Cell.Cell_MODE_NORMAL;
    if (this.cell.figure) {
        this.cell.figure.setCellMode(COM.widget.Grid.Cell.Cell_MODE_NORMAL)
    }
}
;
COM.widget.Grid.Cell.prototype.romoveHtml = function() {
    this.cell.html = null ;
    this.cell.cellMode = COM.widget.Grid.Cell.Cell_MODE_NORMAL;
    if (this.cell.figure) {
        this.cell.figure.setCellMode(COM.widget.Grid.Cell.Cell_MODE_NORMAL)
    }
}
;
COM.widget.Grid.Cell.prototype.setSelectable = function(a) {
    this.cell.selectable = a
}
;
COM.widget.Grid.Cell.prototype.isSelectable = function() {
    return this.cell.selectable
}
;
COM.widget.Grid.Cell.prototype.setEditable = function(a) {
    if (this.cell.editable == a) {
        return
    }
    this.cell.editable = a;
    this.gridModel.freshEditable(this.getCol(), this.getRow(), a)
}
;
COM.widget.Grid.Cell.prototype.isEditable = function() {
    return this.cell.editable
}
;
COM.widget.Grid.Cell.prototype.setTreeImage = function(a) {
    this.setCellMode(COM.widget.Grid.Cell.Cell_MODE_TREE);
    this.cell.treeImage = a;
    if (this.cell.figure) {
        if (a) {
            this.cell.figure.setTreeImage(ImageResourceManager.getImage(this.gridModel.grid.getImageUrlById(a)))
        } else {
            this.cell.figure.setTreeImage(null )
        }
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.getTreeImage = function() {
    return this.cell.treeImage
}
;
COM.widget.Grid.Cell.prototype.setChecked = function(a) {
    this.setCellMode(COM.widget.Grid.Cell.Cell_MODE_TREE);
    this.cell.checked = a;
    if (this.cell.figure) {
        this.cell.figure.setChecked(a);
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.isChecked = function(a) {
    return this.cell.checked
}
;
COM.widget.Grid.Cell.prototype.isExpanded = function() {
    return this.cell.expanded
}
;
COM.widget.Grid.Cell.prototype.setExpanded = function(a) {
    this.setCellMode(COM.widget.Grid.Cell.Cell_MODE_TREE);
    this.cell.expanded = a;
    if (this.cell.figure) {
        this.cell.figure.setExpanded(a);
        this.cell.figure.repaint()
    }
    return this
}
;
COM.widget.Grid.Cell.prototype.setExpandable = function(a) {
    this.setCellMode(COM.widget.Grid.Cell.Cell_MODE_TREE);
    this.cell.expandable = a;
    if (this.cell.figure) {
        this.cell.figure.setExpandable(a)
    }
    return this
}
;
COM.widget.Grid.Cell.prototype.getExpandable = function() {
    return this.cell.expandable
}
;
COM.widget.Grid.Cell.prototype.clearExpandable = function() {
    this.cell.expandable = null ;
    this.cell.cellMode = COM.widget.Grid.Cell.Cell_MODE_NORMAL;
    if (this.cell.figure) {
        this.cell.figure.setCellMode(COM.widget.Grid.Cell.Cell_MODE_NORMAL)
    }
}
;
COM.widget.Grid.Cell.prototype.setCheckable = function(a) {
    this.setCellMode(COM.widget.Grid.Cell.Cell_MODE_TREE);
    this.cell.checkable = a;
    if (this.cell.figure) {
        this.cell.figure.setCheckable(a);
        this.cell.figure.repaint()
    }
    return this
}
;
COM.widget.Grid.Cell.prototype.getCheckable = function() {
    return this.cell.checkable
}
;
COM.widget.Grid.Cell.prototype.setDepth = function(a) {
    this.setCellMode(COM.widget.Grid.Cell.Cell_MODE_TREE);
    if (a == this.cell.depth) {
        return
    }
    this.cell.depth = a;
    if (this.cell.figure) {
        this.cell.figure.setDepth(a);
        this.cell.figure.repaint()
    }
    return this
}
;
COM.widget.Grid.Cell.prototype.getDepth = function() {
    return this.cell.depth
}
;
COM.widget.Grid.Cell.prototype.setTreeStyle = function(b, a) {
    this.setExpandable(b);
    this.setCheckable(a)
}
;
COM.widget.Grid.Cell.prototype.getTreeStyle = function() {
    return {
        expandable: this.getExpandable(),
        checkable: this.getCheckable()
    }
}
;
COM.widget.Grid.Cell.prototype.setBackImage = function(b) {
    if (b == this.cell.backImage) {
        return
    }
    this.cell.backImage = b;
    if (this.cell.figure) {
        if (b == null  || "" == b) {
            this.cell.figure.setBackImage(null )
        } else {
            var a = ImageResourceManager.getImage(this.gridModel.grid.getImageUrlById(b));
            this.cell.figure.setBackImage(a)
        }
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.getBackImage = function() {
    return this.cell.backImage
}
;
COM.widget.Grid.Cell.prototype.setBackImageStyle = function(a) {
    if (a == this.cell.backImageStyle) {
        return
    }
    this.cell.backImageStyle = a;
    if (this.cell.figure) {
        this.cell.figure.setBackImageStyle(a);
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.getBackImageStyle = function(a) {
    return this.cell.backImageStyle
}
;
COM.widget.Grid.Cell.prototype.setBackImagePosition = function(b, a, c) {
    if (!c) {
        this.setBackImageStyle(COM.widget.Grid.Cell.BACK_IMAGE_STYLE_POSITION)
    }
    this.cell.backImageHorizion = b;
    this.cell.backImageVertical = a;
    if (this.cell.figure) {
        this.cell.figure.setBackImageHorizion(b);
        this.cell.figure.setBackImageVertical(a);
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.getBackImageHorizon = function() {
    return this.cell.backImageHorizion
}
;
COM.widget.Grid.Cell.prototype.getBackImageVectical = function() {
    return this.cell.backImageVertical
}
;
COM.widget.Grid.Cell.prototype.setBackImageBounds = function(b, g, c, a) {
    var d = {
        x: b,
        y: g,
        width: c,
        height: a
    };
    this.cell.backImageBounds = d;
    if (this.cell.figure) {
        this.cell.figure.setBackImageBounds(d);
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.getBackImageBounds = function() {
    return this.cell.backImageBounds
}
;
COM.widget.Grid.Cell.prototype.setBackStyle = function(a) {
    if (this.cell.backStyle == a) {
        return
    }
    this.cell.backStyle = a;
    if (this.cell.figure) {
        this.cell.figure.setBackStyle(a);
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.getBackStyle = function() {
    return this.cell.backStyle
}
;
COM.widget.Grid.Cell.prototype.setBackColor = function(a) {
    this.cell.backColor = a;
    if (a == null ) {
        var b = this.gridModel.data.rows[this.getRow()];
        if (b.color) {
            a = b.color
        }
    }
    if (this.cell.figure) {
        if (a != this.cell.figure.getBackColor()) {
            this.cell.figure.setBackColor(a);
            this.cell.figure.repaint()
        }
    }
}
;
COM.widget.Grid.Cell.prototype.getBackColor = function() {
    return this.cell.backColor
}
;
COM.widget.Grid.Cell.prototype.setGradientBackground = function(a, c, d) {
    var b = {
        begin: a,
        end: c,
        direction: d
    };
    this.cell.gradientBacground = b;
    if (this.cell.figure) {
        this.cell.figure.setGradientBackground(b);
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.getGradientBackground = function() {
    return this.cell.gradientBacground
}
;
COM.widget.Grid.Cell.prototype.setFontName = function(a) {
    if (this.cell.fontName == a) {
        return
    }
    this.cell.fontName = a;
    if (this.cell.figure) {
        this.cell.figure.setFontName(a);
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.getFontName = function() {
    return this.cell.fontName
}
;
COM.widget.Grid.Cell.prototype.setFontSize = function(a) {
    if (this.cell.fontSize == a) {
        return
    }
    this.cell.fontSize = a;
    if (this.cell.figure) {
        this.cell.figure.setFontSize(a);
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.getFontSize = function() {
    return this.cell.fontSize
}
;
COM.widget.Grid.Cell.prototype.setFontBold = function(a) {
    if (this.cell.fontBold == a) {
        return
    }
    this.cell.fontBold = a;
    if (this.cell.figure) {
        this.cell.figure.setFontBold(a);
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.setFontItalic = function(a) {
    if (this.cell.fontItalic == a) {
        return
    }
    this.cell.fontItalic = a;
    if (this.cell.figure) {
        this.cell.figure.setFontItalic(a);
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.setDecoration = function(a) {
    if (this.cell.decoration == a) {
        return
    }
    this.cell.decoration = a;
    if (this.cell.figure) {
        this.cell.figure.setDecoration(a);
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.getDecoration = function() {
    return this.cell.decoration
}
;
COM.widget.Grid.Cell.prototype.isFontBold = function() {
    return this.cell.fontBold
}
;
COM.widget.Grid.Cell.prototype.isFontItalic = function() {
    return this.cell.fontItalic
}
;
COM.widget.Grid.Cell.prototype.setFontColor = function(a) {
    if (this.cell.fontColor == a) {
        return
    }
    this.cell.fontColor = a;
    if (this.cell.figure) {
        this.cell.figure.setFontColor(a);
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.getFontColor = function() {
    return this.cell.fontColor
}
;
COM.widget.Grid.Cell.prototype.setTextShadow = function(a, g, c, b) {
    var d = {
        offsetX: a,
        offsetY: g,
        blur: c,
        color: b
    };
    this.cell.textShadow = d;
    if (this.cell.figure) {
        this.cell.figure.setTextShadow(d);
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.getTextShadow = function() {
    return this.cell.textShadow
}
;
COM.widget.Grid.Cell.prototype.setTextStroke = function(a) {
    if (this.cell.textStroke == a) {
        return
    }
    this.cell.textStroke = a;
    if (this.cell.figure) {
        this.cell.figure.setTextStroke(a);
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.isTextStroke = function() {
    return this.cell.textStroke
}
;
COM.widget.Grid.Cell.prototype.setLeftBorderColor = function(a) {}
;
COM.widget.Grid.Cell.prototype.getLeftBorderColor = function() {}
;
COM.widget.Grid.Cell.prototype.setTopBorderColor = function(a) {}
;
COM.widget.Grid.Cell.prototype.getTopBorderColor = function() {}
;
COM.widget.Grid.Cell.prototype._doSetBorderColor = function(b, a) {
    if (this.cell.borderColor) {
        if (this.cell.borderColor[b] == a) {
            return
        }
    } else {
        this.cell.borderColor = []
    }
    this.cell.borderColor[b] = a;
    if (this.cell.figure) {
        var c = this.cell.figure.getBorderColor();
        if (!c) {
            c = [];
            this.cell.figure.setBorderColor(c)
        }
        c[b] = a;
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype._doGetBorderColor = function(a) {
    if (this.cell.borderColor) {
        return this.cell.borderColor[a]
    }
}
;
COM.widget.Grid.Cell.prototype._doSetBorderStyle = function(b, c) {
    if (isNaN(c)) {
        throw "set invalidate border style [" + c + "] for cell(" + this.getCol() + "," + this.getRow() + ")."
    }
    if (this.cell.border) {
        if (this.cell.border[b] == c) {
            return
        }
    } else {
        this.cell.border = []
    }
    this.cell.border[b] = c;
    if (this.cell.figure) {
        var a = this.cell.figure.getBorder();
        if (!a) {
            a = []
        }
        a[b] = c;
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype._doGetBorderStyle = function(a) {
    if (this.cell.border) {
        return this.cell.border[a]
    }
}
;
COM.widget.Grid.Cell.prototype.setRightBorderColor = function(a) {
    this._doSetBorderColor(0, a)
}
;
COM.widget.Grid.Cell.prototype.getRightBorderColor = function() {
    return this._doGetBorderColor(0)
}
;
COM.widget.Grid.Cell.prototype.setBottomBorderColor = function(a) {
    this._doSetBorderColor(1, a)
}
;
COM.widget.Grid.Cell.prototype.getBottomBorderColor = function() {
    return this._doGetBorderColor(1)
}
;
COM.widget.Grid.Cell.prototype.setDiagonalBorderColor = function(a) {
    this._doSetBorderColor(2, a)
}
;
COM.widget.Grid.Cell.prototype.getDiagonalBorderColor = function() {
    return this._doGetBorderColor(2)
}
;
COM.widget.Grid.Cell.prototype.setInverseDiagonalBorderColor = function(a) {
    this._doSetBorderColor(3, a)
}
;
COM.widget.Grid.Cell.prototype.getInverseDiagonalBorderColor = function() {
    return this._doGetBorderColor(3)
}
;
COM.widget.Grid.Cell.prototype.setRightBorderStyle = function(a) {
    this._doSetBorderStyle(0, a)
}
;
COM.widget.Grid.Cell.prototype.getRightBorderStyle = function() {
    return this._doGetBorderStyle(0)
}
;
COM.widget.Grid.Cell.prototype.setBottomBorderStyle = function(a) {
    this._doSetBorderStyle(1, a)
}
;
COM.widget.Grid.Cell.prototype.getBottomBorderStyle = function() {
    return this._doGetBorderStyle(1)
}
;
COM.widget.Grid.Cell.prototype.setLeftBorderStyle = function(a) {}
;
COM.widget.Grid.Cell.prototype.getLeftBorderStyle = function() {}
;
COM.widget.Grid.Cell.prototype.setUpBorderStyle = function(a) {}
;
COM.widget.Grid.Cell.prototype.getUpBorderStyle = function() {}
;
COM.widget.Grid.Cell.prototype.setDiagonalBorderStyle = function(a) {
    this._doSetBorderStyle(2, a)
}
;
COM.widget.Grid.Cell.prototype.getDiagonalBorderStyle = function() {
    return this._doGetBorderStyle(2)
}
;
COM.widget.Grid.Cell.prototype.setInverseDiagonalBorderStyle = function(a) {
    this._doSetBorderStyle(3, a)
}
;
COM.widget.Grid.Cell.prototype.getInverseDiagonalBorderStyle = function() {
    return this._doGetBorderStyle(3)
}
;
COM.widget.Grid.Cell.prototype.setMultiLine = function(a) {
    if (this.cell.multiLine == a) {
        return
    }
    this.cell.multiLine = a;
    if (this.cell.figure) {
        this.cell.figure.setMultiLine(a);
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.isMultiLine = function() {
    return this.cell.multiLine
}
;
COM.widget.Grid.Cell.prototype.setWrapLine = function(a) {
    if (this.cell.wrapLine == a) {
        return
    }
    this.cell.wrapLine = a;
    if (this.cell.figure) {
        this.cell.figure.setWrapLine(a);
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.isWrapLine = function() {
    return this.cell.wrapLine
}
;
COM.widget.Grid.Cell.prototype.setIndent = function(a) {
    if (this.cell.indent == a) {
        return
    }
    this.cell.indent = a;
    if (this.cell.figure) {
        this.cell.figure.setIndent(a);
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.getIndent = function() {
    return this.cell.indent
}
;
COM.widget.Grid.Cell.prototype.setIndentPx = function(a) {
    if (this.cell.indentPx == a) {
        return
    }
    this.cell.indentPx = a;
    if (this.cell.figure) {
        this.cell.figure.setIndentPx(a);
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.getIndentPx = function() {
    return this.cell.indentPx
}
;
COM.widget.Grid.Cell.prototype.setPadding = function(d, c, a, b) {
    if (typeof d == "undifined") {
        this.cell.padding = null ;
        if (this.cell.figure) {
            this.cell.figure.setPadding(null );
            this.cell.figure.repaint()
        }
        return
    }
    this.cell.padding = [d, c, a, b];
    if (this.cell.figure) {
        this.cell.figure.setPadding(new Insets(d,c,a,b));
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.getPadding = function() {
    return this.cell.indentPx
}
;
COM.widget.Grid.Cell.prototype.setHorzAlign = function(a) {
    if (this.cell.horzAlign == a) {
        return
    }
    this.cell.horzAlign = a;
    if (this.cell.figure) {
        this.cell.figure.setHorzAlign(a);
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.getHorzAlign = function() {
    return this.cell.horzAlign
}
;
COM.widget.Grid.Cell.prototype.setVertAlign = function(a) {
    if (this.cell.vertAlign == a) {
        return
    }
    this.cell.vertAlign = a;
    if (this.cell.figure) {
        this.cell.figure.setVertAlign(a);
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.getVertAlign = function() {
    return this.cell.vertAlign
}
;
COM.widget.Grid.Cell.prototype.setVertText = function(a) {
    if (this.cell.vertText == a) {
        return
    }
    this.cell.vertText = a;
    if (this.cell.figure) {
        this.cell.figure.setVertText(a);
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.isVertText = function() {
    return this.cell.vertText
}
;
COM.widget.Grid.Cell.prototype.setFitFontSize = function(a) {
    if (this.cell.fitFontSize == a) {
        return
    }
    this.cell.fitFontSize = a;
    if (this.cell.figure) {
        this.cell.figure.setFitFontSize(a);
        this.cell.figure.repaint()
    }
}
;
COM.widget.Grid.Cell.prototype.isFitFontSize = function() {
    return this.cell.fitFontSize
}
;
COM.widget.Grid.Cell.prototype.setClientData = function(a) {
    this.cell.clientData = a
}
;
COM.widget.Grid.Cell.prototype.getClientData = function() {
    if (!this.cell.clientData) {
        this.cell.clientData = {}
    }
    return this.cell.clientData
}
;
COM.widget.Grid.Cell.prototype.translateToAbsolute = function(a) {
    if (this.cell.figure) {
        this.cell.figure.translateToAbsolute(a)
    }
}
;
COM.widget.Grid.Cell.prototype.translateToRealative = function(a) {
    if (this.cell.figure) {
        this.cell.figure.translateToRealative(a)
    }
}
;
COM.widget.Grid.Cell.prototype.getCellMode = function() {
    return this.cell.cellMode
}
;
COM.widget.Grid.Cell.prototype.setCellMode = function(a) {
    if (this.cell.cellMode == a) {
        return
    }
    this.cell.cellMode = a;
    if (this.cell.figure) {
        this.cell.figure.setCellMode(a)
    }
    return this
}
;
COM.widget.Grid.Cell.prototype.getModel = function() {
    return this.cell
}
;
COM.widget.Grid.Cell.prototype.getFigure = function() {
    return this.cell.figure
}
;
COM.widget.Grid.Cell.prototype.getRelativeLocation = function() {
    var a = this.cell.figure;
    var c;
    if (a) {
        var b = a.getBounds();
        if (b) {
            c = {};
            c.x = b.x;
            c.y = b.y
        }
    }
    return c
}
;
COM.widget.Grid.Cell.prototype.getShowSize = function() {
    if (this.cell.figure) {
        var a = this.cell.figure.getBounds();
        if (a) {
            return {
                width: a.width,
                height: a.height
            }
        }
    }
}
;
COM.widget.Grid.Cell.getNoneCell = function(b, d) {
    var a = new COM.widget.Grid.Cell();
    var c;
    for (c in a) {
        if (typeof a[c] === "function") {
            a[c] = Function.emptyFunction
        }
    }
    a.getRow = function() {
        return d
    }
    ;
    a.getCol = function() {
        return b
    }
    ;
    a.getClientData = function() {
        if (null  == this.clientData) {
            this.clientData = {}
        }
        return this.clientData
    }
    ;
    return a
}
;
COM.widget.Grid.Cell.FONT_SIZE_UNIT_PX = 0;
COM.widget.Grid.Cell.FONT_SIZE_UNIT_PT = 1;
COM.widget.Grid.Cell.Cell_MODE_NORMAL = 1;
COM.widget.Grid.Cell.Cell_MODE_TREE = 2;
COM.widget.Grid.Cell.Cell_MODE_CONTROL = 3;
COM.widget.Grid.Cell.Cell_MODE_HTML = 4;
COM.widget.Grid.Cell.BACK_MODE_STYLE = 1;
COM.widget.Grid.Cell.BACK_MODE_COLOR = 2;
COM.widget.Grid.Cell.BACK_MODE_GRADIRENT = 3;
COM.widget.Grid.Cell.DIRECTION_VERTI = 1;
COM.widget.Grid.Cell.DIRECTION_HORIZ = 0;
COM.widget.Grid.Cell.BACK_IMAGE_STYLE_REPEAT = 1;
COM.widget.Grid.Cell.BACK_IMAGE_STYLE_REPEAT_X = 2;
COM.widget.Grid.Cell.BACK_IMAGE_STYLE_REPEAT_Y = 3;
COM.widget.Grid.Cell.BACK_IMAGE_STYLE_STRETCH = 4;
COM.widget.Grid.Cell.BACK_IMAGE_STYLE_POSITION = 5;
COM.widget.Grid.Cell.BACK_IMAGE_STYLE_BOUNDS = 6;
COM.widget.Grid.Cell.BORDER = {
    AUTO: -1,
    NONE: 0,
    SOLID: 1,
    DASH: 2,
    BOLD: 4,
    DOUBLE: 9
};
COM.widget.Grid.Cell.BORDER_AUTO = -1;
COM.widget.Grid.Cell.BORDER_NONE = 0;
COM.widget.Grid.Cell.BORDER_SOLID = 1;
COM.widget.Grid.Cell.BORDER_DASH = 2;
COM.widget.Grid.Cell.BORDER_BOLD = 4;
COM.widget.Grid.Cell.BORDER_DOUBLE = 8;
COM.widget.Grid.Cell.BORDER_DOTTED = 16;
COM.widget.Grid.Cell.BACK_STYLE_NONE = 0;
COM.widget.Grid.Cell.BACK_STYLE_FILL = 1;
COM.widget.Grid.Cell.BACK_STYLE = {
    NONE: 0,
    FILL: 1,
    DIAG_CROSS_LINE: 2,
    DIAG_CROSS_BLOCK: 3,
    CRUX_BLOCK: 4,
    CROSS_DOT: 5,
    DIAG_CROSS_DOT: 6,
    HORZ_LINE: 7,
    VERT_LINE: 8,
    BDIAG_LINE: 9,
    FDIAG_LINE: 10,
    HORZ_LINE_SPARSE: 11,
    VERT_LINE_SPARSE: 12,
    HORZ_DASH_DOT: 13,
    VERT_DASH_DOT: 14,
    WALL: 15,
    TREES: 16,
    GRASS: 17,
    FLOWERS: 18,
    ROUNDS: 19,
    LOZENGES: 20,
    DIAG_CRUX: 21,
    HILLS: 22,
    GRID_LINE: 23,
    DIAG_BLOCK: 24,
    HORIZ_DIAG_BLOCK: 25,
    VERT_DIAG_BLOCK: 26
};
COM.widget.Grid.Cell.BACK_POSITION = {
    FORE: 0,
    CENTER: 1,
    BACK: 2
};
COM.widget.Grid.Cell.DECORATION = {
    NONE: 0,
    UNDERLINE: 1,
    STRIKEOUT: 2,
    BOTH: 3,
    getCssStr: function(a) {
        if (0 == a) {
            return "none"
        } else {
            if (1 == a) {
                return "underline"
            } else {
                if (2 == a) {
                    return "line-through"
                } else {
                    if (3 == a) {
                        return "underline,line-through"
                    }
                }
            }
        }
        return ""
    }
};
COM.widget.Grid.Cell.ALIGN = {
    AUTO: 0,
    FORE: 1,
    BACK: 2,
    CENTER: 3,
    SPARSE: 4,
    EXTEND: 5,
    MIGHT_BACK: 6
};
COM.widget.Grid.Cell.ALIGN.getCssStr = function(b, a) {
    if (a) {
        switch (b) {
        case 1:
            return "top";
        case 2:
            return "bottom";
        case 3:
            return "middle"
        }
    } else {
        switch (b) {
        case 1:
            return "left";
        case 2:
            return "right";
        case 3:
            return "center"
        }
    }
}
;
COM.widget.Grid.GridHelper = {
    copyCol: function(a) {
        return {
            size: a.size,
            auto: a.auto,
            hidden: false,
            clientSize: a.size,
            rowResizeable: a.rowResizeable
        }
    },
    copyRow: function(a) {
        return {
            size: a.size,
            auto: a.auto,
            hidden: false,
            clientSize: a.size,
            colResizeable: a.colResizeable
        }
    }
};
COM.widget.Grid.Event = {};
COM.widget.Grid.Event.RELOAD = "reload";
COM.widget.Grid.Event.EDIT_MODE_CHANGED = "editModeChanged";
COM.widget.Grid.Event.DATA_CHANGE = "dataChange";
COM.widget.Grid.Event.DATA_LOADED = "dataLoaded";
COM.widget.Grid.Event.DATA_LOAD_EVENT = "dataLoadEvent";
COM.widget.Grid.Event.SELECTION = "selection";
COM.widget.Grid.Event.SELECTION_CHANGE = "selectionChange";
COM.widget.Grid.Event.COL_RESIZE = "colResize";
COM.widget.Grid.Event.ROW_RESIZE = "rowResize";
COM.widget.Grid.Event.EXCHANGE_COLS = "exchangeCols";
COM.widget.Grid.Event.DELETING_RECT = "deletingRect";
COM.widget.Grid.Event.COPY = "copy";
COM.widget.Grid.Event.PASTE = "paste";
COM.widget.Grid.Event.PASTED = "pasted";
COM.widget.Grid.Event.PAGING = "paging";
COM.widget.Grid.Event.SCROLLED = "scrolled";
COM.widget.Grid.Event.GRID_CLICK = "gridClick";
COM.widget.Grid.Event.GRID_DOUBLE_CLICK = "griddbClick";
COM.widget.Grid.Event.CELL_MOUSE_IN = "cellMouseIn";
COM.widget.Grid.Event.CELL_MOUSE_OUT = "cellMouseOut";
COM.widget.Grid.Event.CELL_MOUSE_MOVE = "cellMouseMove";
COM.widget.Grid.Event.CELL_MOUSE_CLICK = "cellMouseClick";
COM.widget.Grid.Event.CELL_DOUBLE_CLICK = "celldbClick";
COM.widget.Grid.Event.CONTROL_ARRIVED = "controlArrived";
COM.widget.Grid.Event.CONTROL_RESIZE = "controlResize";
COM.widget.Grid.Event.CURRENT_CELL_CHANGING = "currentCellChanging";
COM.widget.Grid.Event.CURRENT_CELL_CHANGED = "currentCellChanged";
COM.widget.Grid.Event.EDITOR_OPEN = "editorOpen";
COM.widget.Grid.Event.EDITOR_LOCATE = "editorLocate";
COM.widget.Grid.Event.EDITOR_RESIZE = "editorResize";
COM.widget.Grid.Event.EDITOR_CLOSE = "editorClose";
COM.widget.Grid.Event.EDITOR_HIDE = "editorHide";
COM.widget.Grid.Event.EDITOR_SHOW = "editorShow";
COM.widget.Grid.Event.CELL_COLLAPSE = "cellCollapse";
COM.widget.Grid.Event.CELL_EXPAND = "cellExpand";
COM.widget.Grid.Event.CELL_CHECKED = "cellChecked";
COM.widget.Grid.Event.KEY_DOWN_EVENT = "KeyDownEvent";
COM.widget.Grid.Event.KEY_PRESS_EVENT = "KeyPressEvent";
COM.widget.Grid.Event.LAYOUT = "layout";
COM.widget.Grid.Event.CELL_MOUSE_DOWN = "cellMouseDown";
COM.widget.Grid.Event.CELL_MOUSE_UP = "cellMouseUp";
COM.widget.Grid.Event.CELL_DRAG = "cellDrag";
COM.widget.Grid.Event.CELL_DRAG_START = "cellDragStart";
COM.widget.Grid.Event.MOUSE_WHEEL = "mousewheel";
COM.widget.Grid.GridGraphicsSource = function GridGraphicsSource(a) {
    this.control = a
}
;
COM.widget.Grid.GridGraphicsSource.extend(Object, {
    getGraphics: function(a) {
        if (!this.control) {
            return
        }
        var b = this.control.getSize();
        this.inUse = new Rectangle(0,0,b.width,b.height);
        this.inUse.intersect(a);
        if (this.inUse.isEmpty()) {
            return null 
        }
        this.control.context.clearRect(this.inUse.x, this.inUse.y, this.inUse.width, this.inUse.height);
        this.graphics = new Html5Graphics(this.control.context);
        return this.graphics
    },
    flushGraphics: function() {
        this.graphics.dispose();
        this.control.flush(this.inUse)
    },
    dispose: function() {
        if (this.control && this.control.dispose) {
            this.control.dispose()
        }
        if (this.graphics && this.graphics.dispose()) {
            this.graphics.dispose()
        }
        delete this.control;
        delete this.graphics
    }
});
COM.widget.Grid.GridCanvas = function GridCanvas(a) {
    this.canvasList = [[], [], []];
    this.contextList = [[], [], []];
    this.inintElement();
    this.controllListeners = [];
    this.mouseListeners = [];
    this.touchListeners = [];
    this.keyListeners = [];
    this.disposeListeners = [];
    this.eventSource = a;
    this.registerEvent(a);
    this.button = Canvas.BUTTON_NONE;
    this.stateMask = 0;
    this.context = this.center.getContext("2d");
    this.lefts = [];
    this.tops = [];
    this.disposed = false
}
;
COM.widget.Grid.GridCanvas.extend(Object, {
    flush: function(a) {
        this.overPaint(0, 0);
        this.overPaint(0, 1);
        this.overPaint(0, 2);
        this.overPaint(1, 0);
        this.overPaint(1, 2);
        this.overPaint(2, 0);
        this.overPaint(2, 1);
        this.overPaint(2, 2)
    },
    dispose: function() {
        if (this.disposed) {
            return
        }
        this.disposed = true;
        if (this.disposeListeners) {
            for (var a = 0; a < this.disposeListeners.length; a++) {
                this.disposeListeners[a].widgetDisposed();
                this.disposeListeners[a] = null 
            }
        }
        this.unRegisterEvent(this.eventSource);
        delete this.eventSource;
        delete this.disposeListeners;
        delete this.element;
        delete this.context;
        delete this.canvasList;
        delete this.contextList;
        delete this.controllListeners;
        delete this.mouseListeners;
        delete this.keyListeners;
        delete this.lefts;
        delete this.tops;
        delete this.center
    },
    overPaint: function(g, c) {
        var d = this.contextList[g][c];
        var h = this.canvasList[g][c].width;
        var b = this.canvasList[g][c].height;
        var a = -this.lefts[c];
        var l = -this.tops[g];
        d.fillStyle = "#fff";
        d.fillRect(0, 0, h, b);
        d.drawImage(this.center, a, l)
    },
    onLayouted: function(c, d) {
        var c = c;
        var d = d;
        var h = [];
        var g = [];
        var a = 0;
        var b = 0;
        for (b = 0; b < 3; b++) {
            h[b] = a;
            a += c[b]
        }
        a = 0;
        for (b = 0; b < 3; b++) {
            g[b] = a;
            a += d[b]
        }
        if (c[0] != this.canvasList[0][0].width) {
            this.canvasList[0][0].width = c[0];
            this.canvasList[1][0].width = c[0];
            this.canvasList[2][0].width = c[0]
        }
        if (c[1] != this.canvasList[0][1].width) {
            this.canvasList[0][1].width = c[1];
            this.canvasList[2][1].width = c[1]
        }
        if (c[2] != this.canvasList[0][2].width) {
            this.canvasList[0][2].width = c[2];
            this.canvasList[1][2].width = c[2];
            this.canvasList[2][2].width = c[2]
        }
        if (d[0] != this.canvasList[0][0].height) {
            this.canvasList[0][0].height = d[0];
            this.canvasList[0][1].height = d[0];
            this.canvasList[0][2].height = d[0]
        }
        if (d[1] != this.canvasList[1][0].height) {
            this.canvasList[1][0].height = d[1];
            this.canvasList[1][2].height = d[1]
        }
        if (d[2] != this.canvasList[2][0].height) {
            this.canvasList[2][0].height = d[2];
            this.canvasList[2][1].height = d[2];
            this.canvasList[2][2].height = d[2]
        }
        if (h[1] != this.lefts[1]) {
            this.canvasList[0][1].style.left = h[1] + "px";
            this.canvasList[2][1].style.left = h[1] + "px"
        }
        if (h[2] != this.lefts[2]) {
            this.canvasList[0][2].style.left = h[2] + "px";
            this.canvasList[1][2].style.left = h[2] + "px";
            this.canvasList[2][2].style.left = h[2] + "px"
        }
        if (g[1] != this.tops[1]) {
            this.canvasList[1][0].style.top = g[1] + "px";
            this.canvasList[1][2].style.top = g[1] + "px"
        }
        if (g[2] != this.tops[2]) {
            this.canvasList[2][0].style.top = g[2] + "px";
            this.canvasList[2][1].style.top = g[2] + "px";
            this.canvasList[2][2].style.top = g[2] + "px"
        }
        this.lefts = h;
        this.tops = g
    },
    inintElement: function() {
        this.element = document.createElement("div");
        this.element.className = "gridCanvas";
        this.element.style.position = "relative";
        this.element.tabIndex = 0;
        this.element.hideFocus = "true";
        this.element.outline = "none";
        this.initCanvasList(this.element);
        this.center = this.canvasList[1][1]
    },
    getElement: function() {
        return this.element
    },
    initCanvasList: function(d) {
        for (var c = 0; c < 3; c++) {
            for (var b = 0; b < 3; b++) {
                var a = this.createCavansElement(COM.widget.Grid.GridCanvas.getIndex(c, b));
                a.style.left = "0px";
                a.style.top = "0px";
                this.canvasList[c][b] = a;
                d.appendChild(a);
                this.contextList[c][b] = a.getContext("2d")
            }
        }
    },
    createCavansElement: function(b) {
        var a = document.createElement("canvas");
        a.style.position = "absolute";
        a.style.zIndex = b;
        a.widht = 0;
        a.height = 0;
        return a
    },
    addControllListener: function(a) {
        if (a == null ) {
            return
        }
        this.controllListeners.push(a)
    },
    addMouseListener: function(a) {
        if (a == null ) {
            return
        }
        this.mouseListeners.push(a)
    },
    addTouchListener: function(a) {
        if (a == null ) {
            return
        }
        this.touchListeners.push(a)
    },
    addKeyListener: function(a) {
        if (a == null ) {
            return
        }
        this.keyListeners.push(a)
    },
    addDisposeListener: function(a) {
        if (a == null ) {
            return
        }
        this.disposeListeners.push(a)
    },
    getClientArea: function() {
        return new Rectangle(0,0,this.center.width,this.center.height)
    },
    getHeight: function() {
        return this.center.height
    },
    getSize: function() {
        return new Dimension(this.center.width,this.center.height)
    },
    getWidth: function() {
        return this.center.width
    },
    getClipping: function() {
        return new Rectangle(0,0,this.center.width,this.center.height)
    },
    open: function() {
        var a;
        for (a = 0; a < this.controllListeners.length; a++) {
            this.controllListeners[a].controlResized()
        }
    },
    registerEvent: function(l) {
        var h = this;
        function d(o, n) {
            var m = (Util.browser.ff && !Util.browser.ie) ? "DOMMouseScroll" : "mousewheel";
            if ((o == null  || o == window) && (o = document)) {
                return null 
            }
            return {
                type: m,
                elem: o,
                fn: function(p) {
                    var q = 0;
                    p = p || window.event;
                    if (p.wheelDelta) {
                        q = p.wheelDelta / 120;
                        if (Util.browser.op && Util.browser.version < 10) {
                            q = -q
                        }
                    } else {
                        if (p.detail) {
                            q = -p.detail / 3
                        }
                    }
                    p.delta = Math.round(q);
                    n.call(o, p)
                }
            }
        }
        function a(n) {
            for (var m = 0; m < h.mouseListeners.length; m++) {
                h.mouseListeners[m].mouseWheel(n)
            }
        }
        function g(p, o, n, m) {
            if (l && l[o]) {
                p = l[o]
            }
            (p.attachEvent) ? (p.attachEvent("on" + o, n)) : (p.addEventListener(o, n, m))
        }
        function c(m) {
            m = m || window.event;
            if (m.stopPropagation) {
                m.stopPropagation()
            } else {
                m.cancelBubble = true
            }
        }
        var b = d(this.element, a);
        this.controlEventListeners = {};
        this.controlEventListeners.event = b;
        this.controlEventListeners.keypress = function(m) {
            h._clearMouseHover();
            h.keyPressed(m)
        }
        ;
        this.controlEventListeners.keyup = function(m) {
            h._clearMouseHover();
            h.keyReleased(m)
        }
        ;
        this.controlEventListeners.keydown = function(m) {
            h._clearMouseHover();
            h.keydown(m)
        }
        ;
        this.controlEventListeners.dblclick = function(m) {
            h.mouseDoubleClick(m)
        }
        ;
        this.controlEventListeners.click = function(m) {
            h.click(m)
        }
        ;
        this.controlEventListeners.mousedown = function(m) {
            h._clearMouseHover(m);
            h.mouseDown(m)
        }
        ;
        this.controlEventListeners.mouseout = function(m) {
            h._clearMouseHover(m)
        }
        ;
        this.controlEventListeners.mousemove = function(m) {
            h._resetMouseHover(m);
            h.mouseMove(m)
        }
        ;
        this.controlEventListeners.mouseup = function(m) {
            h._resetMouseHover(m);
            h.mouseUp(m)
        }
        ;
        this.controlEventListeners.touchstart = function(m) {
            h.touchstart(m)
        }
        ;
        this.controlEventListeners.touchmove = function(m) {
            h.touchmove(m)
        }
        ;
        this.controlEventListeners.touchend = function(m) {
            h.touchend(m)
        }
        ;
        g(b.elem, b.type, b.fn);
        g(this.element, "keypress", this.controlEventListeners.keypress);
        g(this.element, "keyup", this.controlEventListeners.keyup);
        g(this.element, "keydown", this.controlEventListeners.keydown);
        g(this.element, "dblclick", this.controlEventListeners.dblclick);
        g(this.element, "click", this.controlEventListeners.click);
        g(this.element, "mousedown", this.controlEventListeners.mousedown, true);
        g(this.element, "mouseout", this.controlEventListeners.mouseout);
        g(this.element, "mousemove", this.controlEventListeners.mousemove);
        g(this.element, "mouseup", this.controlEventListeners.mouseup);
        g(this.element, "touchstart", this.controlEventListeners.touchstart);
        g(this.element, "touchmove", this.controlEventListeners.touchmove);
        g(this.element, "touchend", this.controlEventListeners.touchend)
    },
    unRegisterEvent: function(b) {
        if (this.controlEventListeners) {
            function c(l, h, g, d) {
                if (b && b[h]) {
                    l = b[h]
                }
                (l.detachEvent) ? (l.detachEvent("on" + h, g)) : (l.removeEventListener ? l.removeEventListener(h, g, d) : true)
            }
            var a = this.controlEventListeners.event;
            c(a.elem, a.type, a.fn);
            c(this.element, "keypress", this.controlEventListeners.keypress);
            c(this.element, "keyup", this.controlEventListeners.keyup);
            c(this.element, "keydown", this.controlEventListeners.keydown);
            c(this.element, "dblclick", this.controlEventListeners.dblclick);
            c(this.element, "click", this.controlEventListeners.click);
            c(this.element, "mousedown", this.controlEventListeners.mousedown, true);
            c(this.element, "mouseout", this.controlEventListeners.mouseout);
            c(this.element, "mousemove", this.controlEventListeners.mousemove);
            c(this.element, "mouseup", this.controlEventListeners.mouseup);
            c(this.element, "touchstart", this.controlEventListeners.touchstart);
            c(this.element, "touchmove", this.controlEventListeners.touchmove);
            c(this.element, "touchend", this.controlEventListeners.touchend);
            this.controlEventListeners.event = null ;
            this.controlEventListeners.keypress = null ;
            this.controlEventListeners.keyup = null ;
            this.controlEventListeners.keydown = null ;
            this.controlEventListeners.dblclick = null ;
            this.controlEventListeners.click = null ;
            this.controlEventListeners.mousedown = null ;
            this.controlEventListeners.mouseout = null ;
            this.controlEventListeners.mousemove = null ;
            this.controlEventListeners.mouseup = null ;
            this.controlEventListeners.touchstart = null ;
            this.controlEventListeners.touchmove = null ;
            this.controlEventListeners.touchend = null ;
            this.controlEventListeners = null 
        }
    },
    _resetMouseHover: function(a) {
        this._clearMouseHover();
        this._beginMouseHover(a)
    },
    _beginMouseHover: function(c) {
        var b = this;
        var a = this.parse(c);
        this.hoverTimer = setTimeout(function() {
            b._fireMouseEvent("mouseHover", a)
        }, Canvas.HOVER_TIME)
    },
    _clearMouseHover: function() {
        if (this.hoverTimer) {
            clearTimeout(this.hoverTimer)
        }
    },
    isValid: function(b) {
        var a = b.target || b.srcElement;
        do {
            if (a == this.element) {
                return true
            }
        } while (a = a.parentNode);return false
    },
    getEvLocation: function(d) {
        var a, g;
        var c = d.target || d.srcElement;
        if (Util.browser.ie || Util.browser.wk && d.offsetX != null ) {
            if (d.offsetX <= d.srcElement.offsetWidth) {
                a = d.offsetX
            } else {
                a = 0
            }
            if (d.offsetY <= d.srcElement.offsetHeight) {
                g = d.offsetY
            } else {
                g = 0
            }
        } else {
            a = d.layerX;
            g = d.layerY;
            while (c.offsetParent && c.style.position != "absolute" && c.style.position != "relative") {
                c = c.offsetParent
            }
        }
        a += c.offsetLeft;
        g += c.offsetTop;
        var b = c.offsetParent;
        while (b != null  && b != this.element && b != this.element.parentNode) {
            a += b.offsetLeft;
            g += b.offsetTop;
            b = b.offsetParent
        }
        return new Point(a,g)
    },
    parse: function(c) {
        var b = this.getEvLocation(c);
        var a = new Html5Event(this);
        a.setLocation(b);
        a.stateMask = this.stateMask;
        a.localX = b.x;
        a.localY = b.y;
        a.type = c.type;
        a.button = this.getMouseButton(c);
        a.altKey = c.altKey;
        a.ctrlKey = c.ctrlKey;
        a.shiftKey = c.shiftKey;
        a.e = c;
        return a
    },
    getMouseButton: function(a) {
        if (Util.browser.ff) {
            return a.buttons
        } else {
            if (Util.browser.ie) {
                return a.button
            } else {
                if (Util.browser.wk) {
                    if (a.which === 1) {
                        return Canvas.BUTTON_LEFT
                    } else {
                        if (a.which === 2) {
                            return Canvas.BUTTON_CENTER
                        } else {
                            if (a.which === 3) {
                                return Canvas.BUTTON_RIGHT
                            }
                        }
                    }
                }
            }
        }
        return Canvas.BUTTON_NONE
    },
    _fireMouseEvent: function(b, c) {
        try {
            if (this.mouseListeners) {
                for (var a = 0; a < this.mouseListeners.length; a++) {
                    this.mouseListeners[a][b](c)
                }
            }
        } catch (d) {
            Debugger.error(d)
        }
    },
    _fireTouchEvent: function(b, c) {
        try {
            if (this.touchListeners) {
                for (var a = 0; a < this.touchListeners.length; a++) {
                    this.touchListeners[a][b](c)
                }
            }
        } catch (d) {
            Debugger.error(d)
        }
    },
    keyPressed: function(b) {
        if (Util.browser.ff && b.charCode == 0) {
            return
        }
        for (var a = 0; a < this.keyListeners.length; a++) {
            this.keyListeners[a].keyPressed(b)
        }
    },
    keydown: function(b) {
        for (var a = 0; a < this.keyListeners.length; a++) {
            this.keyListeners[a].keyDown(b)
        }
    },
    keyReleased: function(b) {
        for (var a = 0; a < this.keyListeners.length; a++) {
            this.keyListeners[a].keyReleased(b)
        }
    },
    mouseDoubleClick: function(b) {
        var a = this.parse(b);
        this._fireMouseEvent("mouseDoubleClick", a)
    },
    click: function(b) {
        var a = this.parse(b);
        this._fireMouseEvent("click", a)
    },
    mouseDown: function(b) {
        if (!this.isValid(b)) {
            return
        }
        var a = this.parse(b);
        this.button = a.button;
        this._fireMouseEvent("mouseDown", a)
    },
    mouseExit: function(b) {
        var a = this.parse(b);
        this._fireMouseEvent("mouseExit", a)
    },
    mouseMove: function(b) {
        var a = this.parse(b);
        this._fireMouseEvent("mouseMove", a)
    },
    touchstart: function(b) {
        var a = this.parse(b);
        this._fireTouchEvent("touchStart", a)
    },
    touchmove: function(b) {
        var a = this.parse(b);
        this._fireTouchEvent("touchMove", a)
    },
    touchend: function(b) {
        var a = this.parse(b);
        this._fireTouchEvent("touchEnd", a)
    },
    mouseUp: function(b) {
        var a = this.parse(b);
        a.button = this.button;
        this._fireMouseEvent("mouseUp", a)
    },
    mouseHover: function(b) {
        var a = this.parse(b);
        this._fireMouseEvent("mouseHover", a)
    },
    toDisplay: function(b, a) {
        if (b == null ) {
            return
        }
        if (Util.isInstanceOf(b, Point)) {
            return b
        } else {
            return new Point(b,a)
        }
    },
    layout: function() {},
    resize: function(a, c) {
        this.element.style.width = a + "px";
        this.element.style.height = c + "px";
        this.center.width = a;
        this.center.height = c;
        for (var b = 0; b < this.controllListeners.length; b++) {
            this.controllListeners[b].controlResized()
        }
    },
    isDisposed: function() {
        return this.element == null 
    },
    getParent: function() {
        return this.element.parentNode
    },
    setCursor: function(a) {
        this.element.style.cursor = a
    },
    focus: function() {
        if (this.element) {
            this.element.focus()
        }
    },
    blur: function() {
        if (this.element) {
            this.element.blur()
        }
    }
});
COM.widget.Grid.GridCanvas.BUTTON_NONE = 0;
COM.widget.Grid.GridCanvas.BUTTON_LEFT = 1;
COM.widget.Grid.GridCanvas.BUTTON_CENTER = 4;
COM.widget.Grid.GridCanvas.BUTTON_RIGHT = 2;
COM.widget.Grid.GridCanvas.HOVER_TIME = 800;
COM.widget.Grid.GridCanvas.getIndex = function(b, a) {
    return (Math.pow(b - 1, 2) + Math.pow(a - 1, 2)) * 4
}
;
COM.widget.Grid.GridUpdateManager = function GridUpdateManager() {
    COM.widget.Grid.GridUpdateManager.superclass.constructor.call(this);
    this.capture = false
}
;
COM.widget.Grid.GridUpdateManager.extend(DeferredUpdateManager, {
    queueWork: function() {
        if (!this.capture) {
            COM.widget.Grid.GridUpdateManager.superclass.queueWork.call(this)
        }
    },
    lock: function() {
        this.capture = true
    },
    unlock: function() {
        this.capture = false
    }
});
COM.widget.Grid.GridSelectionManager = function GridSelectionManager(a) {
    this.editPart = a;
    this.selections = [];
    this.selectionCols = new COM.engine.PropertyMap();
    this.selectionRows = new COM.engine.PropertyMap()
}
;
COM.widget.Grid.GridSelectionManager.extend(Object, {
    clearSelection: function() {
        this.eraseSelectionHandle();
        this.clearSelectionCellVisuals()
    },
    select: function(a, b) {
        if (b || this.adjustSelection(a)) {
            this.clearSelection();
            this.selections = [a];
            this.addSelectionColRow(a);
            this.showSelectionCellVisual(a);
            this.showSelectionHandle()
        }
    },
    showSelectionHandle: function() {
        this.editPart.showSelectionHandle()
    },
    eraseSelectionHandle: function() {
        this.editPart.eraseSelectionHandle()
    },
    commitSelect: function() {
        this.editPart.fireEvent(COM.widget.Grid.Event.SELECTION)
    },
    clearSelectionCellVisuals: function() {
        var c = this.selections;
        var d;
        for (var b = 0, a = this.selections.length; b < a; b++) {
            d = c[b];
            this.removeSelectionColRow(d);
            this.removeSelectionCellVisual(d)
        }
        this.selections = []
    },
    showSelectionCellVisual: function(b) {
        var a = this.getSelectionFigure();
        var c = this.createCellFieldFigure(b);
        a.addSelection(c)
    },
    createCellFieldFigure: function(c) {
        var b = new COM.widget.Grid.CellFieldFigure(this.getHost());
        c.figure = b;
        var a = new COM.widget.Grid.CellFieldLocator();
        a.setEditPart(this.getHost());
        b.setLocator(a);
        b.setField(c.x, c.y, c.width, c.height);
        b.single = this.isFieldSingle(c);
        return b
    },
    isFieldSingle: function(b) {
        var a = this.editPart.getModel().getCell(b.x, b.y);
        if (a && a.colSpan == b.width && a.rowSpan == b.height) {
            return true
        }
    },
    getSelectionFigure: function() {
        if (this.selectionFigure == null ) {
            this.selectionFigure = this.createSlectionFigure();
            this.getLayer().add(this.selectionFigure)
        }
        return this.selectionFigure
    },
    createSlectionFigure: function() {
        var a = new COM.widget.Grid.SelectionFigure();
        a.colorProvider = this.editPart.getColorProvider();
        return a
    },
    removeSelectionCellVisual: function(a) {
        if (a && a.figure) {
            if (this.selectionFigure) {
                this.selectionFigure.removeSelection(a.figure)
            }
        }
    },
    addSelection: function(a, b) {
        if (b || this.adjustSelection(a)) {
            this.eraseSelectionHandle();
            this.selections.push(a);
            this.addSelectionColRow(a);
            this.showSelectionCellVisual(a)
        }
    },
    setSelection: function(c, d) {
        if (d || this.adjustSelection(c)) {
            var b = this.selections;
            var a;
            if (b == null  && b.length == 0) {
                return
            }
            this.removeSelectionColRow(b[b.length - 1]);
            this.removeSelectionCellVisual(b[b.length - 1]);
            b[b.length - 1] = c;
            this.addSelectionColRow(b[b.length - 1]);
            this.showSelectionCellVisual(b[b.length - 1]);
            if (b.length === 1) {
                this.showSelectionHandle()
            }
        }
    },
    setSelections: function(a, c) {
        this.clearSelection();
        if (a) {
            if (a[0]) {
                this.select(a[0], c)
            }
            for (var b = 1; b < a.length; b++) {
                this.addSelection(a[b], c)
            }
        }
    },
    freshSelectionColRow: function() {},
    getHost: function() {
        return this.editPart
    },
    getLayer: function() {
        return COM.gef.LayerManager.Helper.find(this.getHost()).getLayer(COM.widget.Grid.GridSelectionManager.SELECTION_FEEDBACK_LAYER)
    },
    refreshCurrentFigureField: function(b, d) {
        if (this.currentFigure) {
            var c = this.currentFigure.getField();
            if (c.x == b && c.y == d) {
                var a = this.editPart.getCell(c.x, c.y);
                c.width = a.colSpan || 1;
                c.height = a.rowSpan || 1;
                this.currentFigure.revalidate()
            }
        }
    },
    freshFeedbacksLocation: function() {
        var c;
        for (var b = 0, a = this.selections.length; b < a; b++) {
            c = this.selections[b];
            if (c && c.figure) {
                c.figure.revalidate()
            }
        }
        if (this.currentFigure) {
            this.currentFigure.revalidate()
        }
    },
    adjustSelection: function(c) {
        var d = this.editPart.getModel().getColCount();
        var b = this.editPart.getModel().getRowCount();
        if (c.x >= d) {
            return false
        }
        if (c.y >= b) {
            return false
        }
        if (c.x + c.width > d) {
            c.width = d - c.x
        }
        if (c.y + c.height > b) {
            c.height = b - c.y
        }
        switch (this.editPart.getSelectionMode()) {
        case COM.widget.Grid.SELECTION_MODE_ROW:
            c.x = 1;
            c.width = d - 1;
            this.adjustMergeCell(c, true, true);
            break;
        case COM.widget.Grid.SELECTION_MODE_COL:
            c.y = 1;
            c.height = b - 1;
            this.adjustMergeCell(c, false, false, true, true);
            break;
        case COM.widget.Grid.SELECTION_MODE_SINGLE:
            c.width = 1;
            c.height = 1;
            break;
        case COM.widget.Grid.SELECTION_MODE_MULTI:
            this.adjustMergeCell(c, true, true, true, true);
            break
        }
        if (c.width === 1 && c.height === 1) {
            var a = this.editPart.getCell(c.x, c.y);
            if (a) {
                c.height = a.rowSpan;
                c.width = a.colSpan
            }
        }
        return true
    },
    adjustMergeCell: function(l, h, p, c, n) {
        var b;
        var q;
        var o;
        var a;
        var m;
        var g = true;
        while (g) {
            g = false;
            b = l.x;
            q = l.y;
            a = q + l.height - 1;
            if (h) {
                for (var d = 0; d < l.width; d++) {
                    m = this.editPart.getCell(b + d, q);
                    if (m == null ) {
                        break
                    }
                    if (m.merged) {
                        g = this.performAdjust(l, m.mergeInfo) || g
                    }
                }
            }
            if (a >= q && p) {
                for (var d = 0; d < l.width; d++) {
                    m = this.editPart.getCell(b + d, a);
                    if (m == null ) {
                        break
                    }
                    if (m.merged) {
                        g = this.performAdjust(l, m.mergeInfo) || g
                    } else {
                        if (m.rowSpan > 1) {
                            g = true;
                            l.height = m.rowIndex + m.rowSpan - l.y
                        }
                    }
                }
            }
            b = l.x;
            q = l.y;
            o = b + l.width - 1;
            if (c) {
                for (d = 0; d < l.height; d++) {
                    m = this.editPart.getCell(b, q + d);
                    if (m == null ) {
                        break
                    }
                    if (m.merged) {
                        g = this.performAdjust(l, m.mergeInfo) || g
                    }
                }
            }
            if (o >= b && n) {
                for (d = 0; d < l.height; d++) {
                    m = this.editPart.getCell(o, q + d);
                    if (m == null ) {
                        break
                    }
                    if (m.merged) {
                        g = this.performAdjust(l, m.mergeInfo) || g
                    } else {
                        if (m.colSpan > 1) {
                            g = true;
                            l.width = m.colIndex + m.colSpan - l.x
                        }
                    }
                }
            }
        }
        return true
    },
    performAdjust: function(c, b) {
        var a = this.editPart.getCell(b.col, b.row);
        var d = new Rectangle(b.col,b.row,a.colSpan,a.rowSpan);
        if (!c.contains(d)) {
            c.union(d);
            return true
        }
        return false
    },
    getSelection: function() {
        if (this.selections == null  || this.selections.length < 1) {
            return null 
        }
        return this.selections[this.selections.length - 1]
    },
    getSelections: function() {
        if (this.selections == null ) {
            this.selections = []
        }
        return this.selections
    },
    addSelectionColRow: function(d) {
        for (var c = d.x, a = d.right(); c < a; c++) {
            this.addSelectionCol(c)
        }
        for (var b = d.y, a = d.bottom(); b < a; b++) {
            this.addSelectionRow(b)
        }
    },
    removeSelectionColRow: function(d) {
        for (var c = d.x, a = d.right(); c < a; c++) {
            this.removeSelectionCol(c)
        }
        for (var b = d.y, a = d.bottom(); b < a; b++) {
            this.removeSelectionRow(b)
        }
    },
    addSelectionCol: function(a) {
        var b = this.editPart.getCol(a);
        this.setSelectionColVisual(a, true);
        this.selectionCols.put(a, a)
    },
    addSelectionRow: function(b) {
        var a = this.editPart.getRow(b);
        this.setSelectionRowVisual(b, true);
        this.selectionRows.put(b, b)
    },
    removeSelectionCol: function(a) {
        var b = this.editPart.getCol(a);
        this.setSelectionColVisual(a, false);
        this.selectionCols.remove(a)
    },
    removeSelectionRow: function(b) {
        var a = this.editPart.getRow(b);
        this.setSelectionRowVisual(b, false);
        this.selectionRows.remove(b)
    },
    setSelectionColVisual: function(b, c) {
        var d = this.editPart.getCol(b);
        var a = this.editPart.getCell(b, 0);
        if (a && a.figure) {
            a.figure.setSelected(c);
            a.figure.repaint()
        }
    },
    setSelectionRowVisual: function(d, c) {
        var b = this.editPart.getRow(d);
        var a = this.editPart.getCell(0, d);
        if (a && a.figure) {
            a.figure.setSelected(c);
            a.figure.repaint()
        }
    },
    getSelectionCols: function() {
        return this.selectionCols
    },
    getSelectionRows: function() {
        return this.selectionRows
    },
    hasSelectionInRow: function(a) {
        return this.selectionRows.get(a) != null 
    },
    hasSelectionInCol: function(a) {
        return this.selectionCols.get(a) != null 
    },
    setCurrentCell: function(c, g, d, a) {
        var b = this.getSelectionFigure();
        if (c < 0 || g < 0) {
            if (b.currentFigure) {
                b.remove(b.currentFigure);
                b.currentFigure = null ;
                this.currentFigure = null 
            }
        } else {
            if (!b.currentFigure) {
                b.currentFigure = this.createCurentCellFigure(new Rectangle(c,g,d,a));
                b.currentFigure.focus = true;
                b.add(b.currentFigure);
                this.currentFigure = b.currentFigure
            } else {
                b.currentFigure.setField(c, g, d, a)
            }
            this.currentFigure.revalidate()
        }
    },
    createCurentCellFigure: function(c) {
        var b = new COM.widget.Grid.CellFieldFigure(this.getHost());
        c.figure = b;
        var a = new COM.widget.Grid.CellFieldLocator();
        a.relocate = function(l) {
            var h = l.getField();
            var d = new Rectangle();
            var g = this.getEditPart().getCellAreaBounds(h, d);
            g.x = (g.x >> 0) - 0.5;
            g.y = (g.y >> 0) - 0.5;
            d.x = (g.x >> 0) - 0.5;
            d.y = (g.y >> 0) - 0.5;
            l.setBounds(g);
            l.setInnerBounds(d)
        }
        ;
        a.setEditPart(this.getHost());
        b.setLocator(a);
        b.setField(c.x, c.y, c.width, c.height);
        b.addFigureListener(this.editPart.getEditCurrentMoveListener());
        return b
    }
});
COM.widget.Grid.GridSelectionManager.SELECTION_FEEDBACK_LAYER = "selection_feedback";
COM.widget.Grid.GridLightwightSystem = function GridLightwightSystem() {
    COM.widget.Grid.GridLightwightSystem.superclass.constructor.call(this)
}
;
COM.widget.Grid.GridLightwightSystem.extend(LightweightSystem, {
    createUpdateManager: function() {
        return new COM.widget.Grid.GridUpdateManager()
    },
    createGraphicsSource: function(a) {
        return new COM.widget.Grid.GridGraphicsSource(a)
    }
});
COM.widget.Grid.GridViewer = function GridViewer(b, a) {
    this.eventSource = b;
    this.scrollHelper = a;
    COM.widget.Grid.GridViewer.superclass.constructor.call(this)
}
;
COM.widget.Grid.GridViewer.extend(COM.gef.GraphicalViewerImpl, {
    createControl: function() {
        var b = this.getElement();
        var a = new COM.widget.Grid.GridCanvas(this.eventSource);
        b.appendChild(a.getElement());
        this.setControl(a)
    },
    createLightweightSystem: function() {
        var a = new COM.widget.Grid.GridLightwightSystem();
        return a
    },
    createEventDispatcher: function(b, c) {
        var a = new COM.gef.DomainEventDispatcher(b,c);
        a.getToolTipHelper = function() {
            if (this.toolTipHelper == null ) {
                this.toolTipHelper = new COM.widget.Grid.ToolTipHelper(this.control)
            }
            return this.toolTipHelper
        }
        ;
        return a
    },
    createDefaultRoot: function() {
        this.setRootEditPart(new COM.widget.Grid.GridRootEditPart())
    },
    initScrollHelper: function() {
        if (null  == this.scrollHelper) {
            this.scrollHelper = new COM.widget.Grid.ScrollHelper()
        }
    },
    setScrollBarSize: function(b, a) {
        this.scrollHelper.setSize(b, a)
    },
    appendScrollBar: function(a) {
        this.scrollHelper.appendTo(a)
    },
    dispose: function() {
        if (COM.widget.Grid.GridViewer.superclass.dispose && COM.widget.Grid.GridViewer.superclass.dispose.call(this)) {
            delete this.element;
            delete this.toolTipHelper;
            delete this.eventSource
        }
    }
});
COM.widget.Grid.ToolTipHelper = function ToolTipHelper(a) {
    COM.widget.Grid.ToolTipHelper.superclass.constructor.call(this);
    this.originControl = a;
    this.createControl()
}
;
COM.widget.Grid.ToolTipHelper.extend(Object, {
    show: function() {
        this.control.innerHTML = this.tip;
        this.control.style.display = "";
        this.tipShowing = true
    },
    hide: function() {
        this.control.style.display = "none";
        this.tipShowing = false
    },
    isShowing: function() {
        return this.tipShowing
    },
    updateToolTip: function(b, c, a, d) {
        if (b == null ) {
            if (this.isShowing()) {
                this.hide()
            }
        }
        if (this.isShowing() && b != this.currentTipSource) {
            this.hide()
        } else {
            if (!this.isShowing() && b != this.currentTipSource) {
                this.currentTipSource = null 
            }
        }
    },
    dispose: function() {
        this.control = null 
    },
    displayToolTipNear: function(c, b, a, d) {
        if (null  == b || "" == b) {
            return
        }
        b = b.split("\n").join("<br/>");
        if (b != null  && c != this.currentTipSource) {
            this.locateToolTip(a, d + 20);
            this.tip = b;
            this.currentTipSource = c;
            this.show()
        }
    },
    locateToolTip: function(a, b) {
        this.control.style.left = a + "px";
        this.control.style.top = b + "px"
    },
    createControl: function() {
        this.control = document.createElement("div");
        this.control.style.display = "none";
        this.control.style.position = "absolute";
        this.control.style.zIndex = 99;
        this.control.style.boxShadow = "5px 5px 5px #000";
        this.control.style.backgroundColor = "#ddd";
        this.control.style.padding = "4px";
        this.control.style.borderRadius = "4px";
        this.originControl.getParent().appendChild(this.control)
    }
});
COM.widget.Grid.GridRootEditPart = function GridRootEditPart() {
    COM.widget.Grid.GridRootEditPart.superclass.constructor.call(this);
    this.innerLayers = null 
}
;
COM.widget.Grid.GridRootEditPart.extend(COM.gef.SimpleRootEditPart, {
    createFigure: function() {
        this.innerLayers = new LayeredPane();
        this.createLayers(this.innerLayers);
        return this.innerLayers
    },
    createLayers: function(c) {
        function a() {
            a.superclass.constructor.call(this);
            this.setEnabled(false)
        }
        a.extend(Layer, {
            getPreferredSize: function(l, d) {
                var m = new Rectangle();
                var h = this.getChildren();
                for (var g = 0; g < h.length; g++) {
                    m.union(h[g].getBounds())
                }
                return m.getSize()
            }
        });
        var b = new Layer();
        b.setLayoutManager(new StackLayout());
        c.add(b, COM.gef.LayerConstants.PRIMARY_LAYER);
        b = new Layer();
        b.setLayoutManager(new StackLayout());
        b.setEnabled(false);
        c.add(b, COM.widget.Grid.GridSelectionManager.SELECTION_FEEDBACK_LAYER);
        c.add((function() {
            var d = new Layer();
            d.getPreferredSize = function(h, g) {
                return new Dimension()
            }
            ;
            return d
        })(), COM.gef.LayerConstants.HANDLE_LAYER);
        c.add(new a(), COM.gef.LayerConstants.FEEDBACK_LAYER)
    },
    getContentPane: function() {
        return this.getLayer(COM.gef.LayerConstants.PRIMARY_LAYER)
    },
    getDragTracker: function(a) {
        return new MarqueeDragTracker()
    },
    getLayer: function(a) {
        if (this.innerLayers == null ) {
            return null 
        }
        return this.innerLayers.getLayer(a)
    },
    getModel: function() {
        return COM.gef.LayerManager.ID
    }
});
window.requestAnimFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(a) {
    window.setTimeout(a, 1000 / 60)
}
;
var Element = function() {
    Element.superclass.constructor.call(this);
    this.listeners = new PropertyChangeSupport(this)
}
;
Element.extend(Object, {
    addPropertyChangeListener: function(a) {
        this.listeners.addPropertyChangeListener(a)
    },
    firePropertyChange: function(c, a, b) {
        this.listeners.firePropertyChange(c, a, b)
    },
    fireStructureChange: function(b, a) {
        this.listeners.firePropertyChange(b, null , a)
    },
    removePropertyChangeListener: function(a) {
        this.listeners.removePropertyChangeListener(a)
    }
});
COM.widget.Grid.GridModel = function GridModel(b, c, a) {
    COM.widget.Grid.GridModel.superclass.constructor.call(this);
    this.enterNext = COM.widget.Grid.ENTER_NEXT_UP;
    this.grid = b;
    this.data = c;
    this.firstRow = 1;
    this.firstCol = 1;
    this.editPart;
    this.dataHeight = this.getDataHeight();
    this.dataWidth = this.getDataWidth();
    this.defaultEditorId = c.defaultEditorId;
    this.defaultEditor = c.defaultEditor;
    if (c.rowHeaderCount == 0) {
        c.rowHeaderCount = 1
    }
    if (c.colHeaderCount == 0) {
        c.colHeaderCount = 1
    }
    this.grabCols = null ;
    this.enabled = true;
    this.rowHeaderResizeable = false;
    this.colHeaderResizeable = false;
    this.showInsDelAnimation = false;
    this.afterLoadToDo = new COM.engine.PropertyMap();
    this.selectionMover = null ;
    this.colorProvider = null ;
    this.cellFigureFactory = a;
    this.init()
}
;
COM.widget.Grid.GridModel.extend(Element, {
    init: function() {
        this.calculateMergeCells();
        this.freshDataClientWidth();
        this.initSelectionMover();
        this.initColorProvider(this.data.options);
        this.initCellFigureFactory()
    },
    initCellFigureFactory: function() {
        var d = this.getColorProvider();
        var c = this.grid;
        var a = this.getHeadStyle();
        if (this.cellFigureFactory && this.cellFigureFactory.init) {
            this.cellFigureFactory.init(d, c, a, this)
        } else {
            function b(m, h, g, l) {
                this.create = function(n) {
                    if (null  == n) {
                        return this.normalCreator.create(null )
                    }
                    if (0 == n.rowIndex || 0 == n.colIndex) {
                        return this.headCreator.create(n)
                    } else {
                        return this.normalCreator.create(n)
                    }
                }
                ;
                this.init = function(q, o, n, p) {
                    this.normalCreator = new COM.widget.Grid.NormalFigureCreator(q,o,p);
                    this.headCreator = new COM.widget.Grid.HeadFigureCreator(q,o,n)
                }
                ;
                this.init(m, h, g, l)
            }
            this.cellFigureFactory = new b(d,c,a,this)
        }
    },
    initSelectionMover: function() {
        this.selectionMover = (function() {
            var a = COM.Util.Array.each;
            var b = 0;
            var d = function(l, h) {
                if (l >= b) {
                    return true
                }
            }
            ;
            var g = function(p, o, t, m) {
                var l = p.getSelections();
                var s;
                if (l) {
                    for (var n = 0, r = l.length; n < r; n++) {
                        s = l[n];
                        if (s.x >= b) {
                            s.x = t ? s.x + o : s.x - o
                        }
                    }
                }
                if (m) {
                    if (p.currentCellCol >= b) {
                        p.currentCellCol = t ? p.currentCellCol + o : p.currentCellCol - o
                    }
                }
                var h = p.getSelectionCols();
                var q = h.filter(d);
                a(q, function(w, v) {
                    h.remove(w);
                    var u = t ? w + o : w - o;
                    h.put(u, u)
                })
            }
            ;
            var c = function(p, o, s, l) {
                var h = p.getSelections();
                var r;
                if (h) {
                    for (var n = 0, q = h.length; n < q; n++) {
                        r = h[n];
                        if (r.y >= b) {
                            r.y = s ? r.y + o : r.y - o
                        }
                    }
                }
                if (l) {
                    if (p.currentCellRow >= b) {
                        p.currentCellRow = s ? p.currentCellRow + o : p.currentCellRow - o
                    }
                }
                var m = p.getSelectionRows();
                var t = m.filter(d);
                a(t, function(w, v) {
                    m.remove(w);
                    var u = s ? w + o : w - o;
                    m.put(u, u)
                })
            }
            ;
            return {
                moveRight: function(h, l, m, n) {
                    b = l;
                    g(h, m, true, n)
                },
                moveLeft: function(h, l, m, n) {
                    b = l;
                    g(h, m, false, n)
                },
                moveDown: function(h, l, m, n) {
                    b = l;
                    c(h, m, true, n)
                },
                moveUp: function(h, l, m, n) {
                    b = l;
                    c(h, m, false, n)
                }
            }
        })()
    },
    initColorProvider: function(a) {
        this.colorProvider = function(b) {
            var c = b;
            return {
                getSelectionColor: function() {
                    return c.selectionColor || "rgba(0,0,255,0.2)"
                },
                getSelectionHeadColor: function() {
                    return c.selectionHeadColor || "rgba(255,229,160,1)"
                },
                getCurrentCellColor: function() {
                    return c.currentCellColor || "rgba(0,255,255,0.2)"
                },
                getBlurCurrentCellColor: function() {
                    return c.blurCurrentCellColor || "rgba(255,0,0,0.2)"
                },
                getSelectionBorderColor: function() {
                    return c.selectionBorderColor || "#0f0"
                },
                getSelectionBorderWidth: function() {
                    return c.selectionBorderWidth || 2
                },
                getDefaultBorderColor: function() {
                    return c.defaultBorderColor || "#000"
                },
                getDefaultBorderStyle: function() {
                    return c.defaultBorderStyle || COM.widget.Grid.Cell.BORDER_SOLID
                },
                getDefaultBackColor: function() {
                    return c.defaultBackColor || "#fff"
                },
                getDefaultHeadColor: function() {
                    return c.defaultHeadColor || "#fff"
                },
                isHideSingleSelect: function() {
                    return c.hideSingleSelect || false
                },
                getCurrentCellShowType: function() {
                    return c.currentCellShowType || COM.widget.Grid.CURRENT_CELL_SHOW_TYPE.BACK
                },
                isCurrenCellBorderHidden: function() {
                    return c.currentCellBorderHidden || false
                },
                isSimpleInsert: function() {
                    return c.simpleInsert || false
                },
                isTableCell: function() {
                    return c.tableCell || false
                },
                isShowMergeChildBorder: function() {
                    return c.showMergeChildBorder || false
                },
                isHideSelectionChangeable: function() {
                    return !!c.hideSelectionChangeable
                },
                setOptions: function(d) {
                    c = d
                }
            }
        }(a)
    },
    loadData: function(p, n, c) {
        debugger;
        console.log(n);
        var o;
        if (p) {
            for (var h = 0; h < n.length; h++) {
                o = n[h];
                for (var g = 0; g < o.data.length; g++) {
                    b = o.data[g];
                    if (b != null ) {
                        for (var d = 0; d < b.length; d++) {
                            if (b[d].cellMode == null ) {
                                b[d].cellMode = COM.widget.Grid.Cell.Cell_MODE_NORMAL
                            }
                        }
                    }
                    this.data.cells.rowList[g + o.begin] = b
                }
            }
        } else {
            var m = this.getRowCount();
            var a;
            var b;
            for (var h = 0; h < n.length; h++) {
                o = n[h];
                for (var g = 0; g < o.data.length; g++) {
                    a = o.data[g];
                    for (var d = 0; d < m; d++) {
                        if (!this.data.cells.rowList[d]) {
                            this.data.cells.rowList[d] = []
                        }
                        b = this.data.cells.rowList[d];
                        b[g + o.begin] = a[d]
                    }
                }
            }
        }
        if (c) {
            var r = 0;
            var q;
            var l = 0;
            if (p) {
                for (var h = 0; h < n.length; h++) {
                    q = n[h].rows;
                    for (var g = 0; g < q.length; g++) {
                        this.data.rows[g + o.begin] = q[g];
                        r += q[g].size
                    }
                    l += n[h].end - n[h].begin + 1
                }
                this.data.rowCount += l;
                this.data.height += r
            }
            this.dataHeight += r;
            this.freshDataClientHeight();
            this.firePropertyChange(COM.widget.Grid.GridModel.PROP_LOAD_DATA, this.data.rowCount - l, this.data.rowCount)
        }
        this.fireEvent(COM.widget.Grid.Event.DATA_LOADED, {
            byRow: p,
            list: n
        });
        this.doThingsAfterLoad();
        this.editPart.refreshVisuals_scroll()
    },
    doThingsAfterLoad: function() {
        if (this.afterLoadToDo) {
            this.afterLoadToDo.each(this.doOneThingAfterLoad, this)
        }
    },
    doOneThingAfterLoad: function(b, a, c) {
        if (b && typeof b === "function") {
            if (b()) {
                c.remove(a)
            }
        } else {
            c.remove(a)
        }
    },
    addTingsToDoAtferLoad: function(a, b) {
        if (this.afterLoadToDo == null ) {
            this.afterLoadToDo = new COM.engine.PropertyMap()
        }
        this.afterLoadToDo.put(a, b)
    },
    getRowHeaderCount: function() {
        return this.data.rowHeaderCount
    },
    getColHeaderCount: function() {
        return this.data.colHeaderCount
    },
    getRowFooterCount: function() {
        return this.data.rowFooterCount
    },
    getColFooterCount: function() {
        return this.data.colFooterCount
    },
    setRowHeaderCount: function(a) {
        if (!(a > 1)) {
            a = 1
        }
        if (a > this.getRowCount()) {
            return false
        }
        this.data.rowHeaderCount = a;
        var b = this.editPart.doOnScroll(null , true);
        if (!b) {
            this.editPart.refreshVisuals_scroll()
        }
        return true
    },
    setColHeaderCount: function(a) {
        if (!(a > 1)) {
            a = 1
        }
        if (a > this.getColCount()) {
            return false
        }
        this.data.colHeaderCount = a;
        var b = this.editPart.doOnScroll(null , true);
        if (!b) {
            this.editPart.refreshVisuals_scroll()
        }
        return true
    },
    setRowFooterCount: function(c) {
        if (c < 0 || c > this.getRowCount()) {
            return false
        }
        if (c > 0 && c < this.getRowCount()) {
            var d = this.getColCount();
            var a;
            var h = this.getRowCount() - c;
            for (var b = 0; b < d; b++) {
                a = this.getCell(b, h);
                if (a && a.mergeInfo) {
                    if (a.mergeInfo.row < h) {
                        return false
                    }
                }
            }
        }
        this.data.rowFooterCount = c;
        var g = this.editPart.doOnScroll(null , true);
        if (!g) {
            this.editPart.refreshVisuals_scroll()
        }
    },
    setColFooterCount: function(d) {
        if (d < 0 || d > this.getColCount()) {
            return false
        }
        if (d > 0 && d < this.getColCount()) {
            var c = this.getRowCount();
            var a;
            var h = this.getColCount() - d;
            for (var b = 0; b < c; b++) {
                a = this.getCell(h, b);
                if (a && a.mergeInfo) {
                    if (a.mergeInfo.col < h) {
                        return false
                    }
                }
            }
        }
        this.data.colFooterCount = d;
        var g = this.editPart.doOnScroll(null , true);
        if (!g) {
            this.editPart.refreshVisuals_scroll()
        }
    },
    setEditPart: function(a) {
        this.editPart = a
    },
    getRowCount: function() {
        return this.data.rowCount
    },
    getColCount: function() {
        return this.data.colCount
    },
    getRowResizeIndex: function() {
        return this.data.rowResizeIndex
    },
    getColResizeIndex: function() {
        return this.data.colResizeIndex
    },
    getCell: function(a, c) {
        var b = this.data.cells.rowList[c];
        if (b) {
            return b[a]
        }
    },
    getEditPart: function() {
        return this.editPart
    },
    getCol: function(a) {
        return this.data.cols[a]
    },
    getRow: function(a) {
        return this.data.rows[a]
    },
    setColCount: function(b) {
        var a = this.getColCount();
        var c;
        if (b > a) {
            c = b - a;
            this.insertCols(null , c)
        } else {
            c = a - b;
            this.deleteCols(b, c)
        }
    },
    setRowCount: function(b) {
        var a = this.getRowCount();
        var c;
        if (b > a) {
            c = b - a;
            this.insertRows(null , c)
        } else {
            c = a - b;
            this.deleteRows(b, c)
        }
    },
    setColSize: function(a, c) {
        var d = this.data.cols[a].size;
        if (d == c) {
            return
        }
        this.data.cols[a].size = c;
        this.data.cols[a].clientSize = c;
        this.freshDataWidth();
        if (this.grabCols) {
            COM.Util.Array.remove(this.grabCols, this.data.cols[a])
        }
        this.performColGrab(a);
        this.freshDataClientWidth();
        this.freshGrabCols();
        this.freshDataWidth();
        if (this.editPart.isEditing() && this.editPart.getCurrentCellColRow().col == a) {
            this.editPart.resizeEditor()
        }
        this.fireEvent(COM.widget.Grid.Event.COL_RESIZE, {
            col: a,
            width: c
        });
        for (var b = 0; b < this.data.rows.length; b++) {
            this.data.rows[b].dirty = true
        }
        this.firePropertyChange(COM.widget.Grid.GridModel.PROP_COL_SIZE, d, c)
    },
    getColSize: function(a) {
        return this.data.cols[a].clientSize
    },
    setRowSize: function(c, a) {
        var b = this.data.rows[c].size;
        if (b == a) {
            return
        }
        this.data.rows[c].size = a;
        this.data.rows[c].clientSize = a;
        this.dataHeight += a - b;
        this.freshDataClientHeight();
        this.freshDataHeight();
        this.firePropertyChange(COM.widget.Grid.GridModel.PROP_ROW_SIZE, b, a);
        if (this.editPart.isEditing() && this.editPart.getCurrentCellColRow().row == c) {
            this.editPart.resizeEditor()
        }
        this.fireEvent(COM.widget.Grid.Event.ROW_RESIZE, {
            row: c,
            height: a
        })
    },
    getRowSize: function(a) {
        return this.data.rows[a].clientSize
    },
    setColVisible: function(a, b) {
        this.data.cols[a].hidden = !b;
        this.freshDataWidth();
        this.performColGrab();
        this.freshDataClientWidth();
        this.editPart.onDataSizeChanged();
        this.editPart.refreshVisuals_scroll()
    },
    setRowVisible: function(b, a) {
        this.data.rows[b].hidden = !a;
        this.freshDataHeight();
        this.freshDataClientHeight();
        this.editPart.onDataSizeChanged();
        this.editPart.refreshVisuals_scroll()
    },
    isColHidden: function(a) {
        return this.data.cols[a].hidden
    },
    isRowHidden: function(a) {
        return this.data.rows[a].hidden
    },
    setRowBackgroundColor: function(l, c) {
        var g = this.getRow(l);
        if (g != null ) {
            g.color = c
        }
        var h = this.getColCount();
        var a;
        var b = this.data.cells.rowList[l];
        for (var d = 1; d < b.length; d++) {
            a = b[d];
            if (!a.backColor) {
                if (a.figure) {
                    a.figure.setBackColor(c);
                    a.figure.repaint()
                }
            }
        }
    },
    setColGrab: function(b, a) {
        if (this.data.cols[b]) {
            if (this.data.cols[b].grab == a) {
                return
            }
            this.data.cols[b].grab = a;
            if (!this.grabCols) {
                this.grabCols = []
            }
            if (a) {
                this.grabCols.push(this.data.cols[b])
            } else {
                this.data.cols[b].clientSize = this.data.cols[b].size;
                COM.Util.Array.remove(this.grabCols, this.data.cols[b])
            }
            this.freshDataWidth();
            this.performColGrab();
            this.freshDataClientWidth();
            this.editPart.onDataSizeChanged();
            this.editPart.refreshVisuals_scroll()
        }
    },
    getColGrab: function(a) {
        return this.data.cols[a].grab
    },
    setRowAutoHeight: function(b, c) {
        if (!this.data.rows[b]) {
            return
        }
        var a = this.data.rows[b].auto;
        this.data.rows[b].auto = c;
        if (this.calculateRowSize(b)) {
            this.freshDataClientHeight();
            this.firePropertyChange(COM.widget.Grid.GridModel.PROP_ROW_SIZE_AUTO, a, c)
        }
    },
    isRowAutoHeight: function() {
        return this.data.rows[row].auto
    },
    setColAutoWidth: function(b, c) {
        if (!this.data.cols[b]) {
            return
        }
        var a = this.data.cols[b].auto;
        this.data.cols[b].auto = c;
        if (this.calculateColSize(b)) {
            this.freshDataClientWidth();
            this.firePropertyChange(COM.widget.Grid.GridModel.PROP_COL_SIZE_AUTO, a, c)
        }
    },
    isColAutoWidth: function(a) {
        return this.data.cols[a].auto
    },
    mergeCell: function(c, p, a, o) {
        if (c < 0 || p < 0 || c + a > this.getColCount() || p + o > this.getRowCount()) {
            return false
        }
        var m = new Rectangle(c,p,a,o);
        var b = this.data.mergeCells;
        var g;
        var l;
        var h;
        for (g = 0; g < b.length; g++) {
            l = b[g];
            h = new Rectangle(b[g].col,b[g].row,b[g].width,b[g].height);
            if (m.intersects(h)) {
                m.union(h);
                b.splice(g, 1);
                g--
            }
        }
        this.data.mergeCells.push({
            col: m.x,
            row: m.y,
            width: m.width,
            height: m.height
        });
        var n;
        for (var g = p; g < p + o; g++) {
            for (var d = c; d < c + a; d++) {
                n = this.getCell(d, g);
                if (n) {
                    n.merged = true;
                    n.mergeInfo = {
                        col: c,
                        row: p
                    };
                    if (n.figure) {
                        n.figure.setVisible(false)
                    }
                }
            }
        }
        n = this.getCell(c, p);
        if (n) {
            n.rowSpan = o;
            n.colSpan = a;
            n.merged = false;
            n.mergeInfo = null ;
            if (n.figure) {
                n.figure.setRowSpan(o);
                n.figure.setColSpan(a);
                n.figure.setVisible(true)
            }
        }
        this.editPart.refreshCurrentFigureField(c, p);
        this.editPart.refreshVisuals_scroll()
    },
    unMergeCell: function(d, o, b) {
        var c = this.data.mergeCells;
        var l;
        var m;
        var a;
        for (l = 0; l < c.length; l++) {
            m = c[l];
            if ((m.col == d && m.row == o) || (b && ((d >= m.col && d < m.col + m.width) && (o >= m.row && o < m.row + m.height)))) {
                a = m;
                break
            }
        }
        if (a) {
            c.splice(l, 1);
            var h = 0;
            var g = 0;
            var n;
            for (h = 0; h < a.width; h++) {
                for (g = 0; g < a.height; g++) {
                    n = this.getCell(a.col + h, a.row + g);
                    if (!n) {
                        break
                    }
                    n.rowSpan = 1;
                    n.colSpan = 1;
                    n.merged = false;
                    n.mergeInfo = null ;
                    if (n.figure) {
                        n.figure.setRowSpan(1);
                        n.figure.setColSpan(1);
                        n.figure.setVisible(true)
                    }
                }
            }
        }
        this.editPart.refreshVisuals_scroll()
    },
    setDefaultEditor: function(a) {
        this.defaultEditor = a
    },
    setDefaultEditorId: function(a) {
        this.defaultEditorId = a
    },
    getDefaultEditorId: function() {
        return this.defaultEditorId
    },
    getDefaultEditor: function() {
        return this.defaultEditor
    },
    mergedBySameCell: function(b, a) {
        if (b == null  || a == null ) {
            return false
        }
        var d = b.mergeInfo || {
            col: b.colIndex,
            row: b.rowIndex
        };
        var c = a.mergeInfo || {
            col: a.colIndex,
            row: a.rowIndex
        };
        return ( d != null  && c != null  && ((d.col == c.col && d.row == c.row))) 
    },
    getControlSize: function() {
        return {
            width: this.grid.width,
            height: this.grid.height
        }
    },
    moveRows: function(a, b, c) {},
    updateMergeInfo: function(b) {
        var c = this.data.mergeCells;
        var a;
        var d;
        for (a = 0; a < c.length; a++) {
            d = c[a];
            if (d.col == b.col && d.row == b.row) {
                d.width = b.width;
                d.height = b.height
            }
        }
    },
    updateMergeInfoAfterInsertCol: function(a, c) {
        var d = this.data.mergeCells;
        var b;
        var g;
        for (b = 0; b < d.length; b++) {
            g = d[b];
            if (g.col >= a) {
                g.col += c
            }
        }
    },
    updateMergeInfoAfterDeleteCol: function(a, c) {
        var d = this.data.mergeCells;
        var b;
        var g;
        for (b = 0; b < d.length; b++) {
            g = d[b];
            if (g.col > a) {
                if (g.col < a + c) {
                    if (g.col + g.width < a + c) {
                        d.splice(b, 1);
                        b--
                    } else {
                        g.width = g.width - (a + c - g.col);
                        g.col = a
                    }
                } else {
                    g.col -= c
                }
            } else {
                if (g.col + g.width > a) {
                    g.width -= Math.min(g.col + g.width - a, c)
                }
            }
        }
    },
    updateMergeInfoAfterInsertRow: function(a, c) {
        var d = this.data.mergeCells;
        var b;
        var g;
        for (b = 0; b < d.length; b++) {
            g = d[b];
            if (g.row >= a) {
                g.row += c
            }
        }
    },
    updateMergeInfoAfterDeleteRow: function(a, c) {
        var d = this.data.mergeCells;
        var b;
        var g;
        for (b = 0; b < d.length; b++) {
            g = d[b];
            if (g.row > a) {
                if (g.row < a + c) {
                    if (g.row + g.height < a + c) {
                        d.splice(b, 1);
                        b--
                    } else {
                        g.height = g.height - (a + c - g.row);
                        g.row = a
                    }
                } else {
                    g.row -= c
                }
            } else {
                if (g.row + g.height > a) {
                    g.height -= Math.min(g.row + g.height - a, c)
                }
            }
        }
    },
    deleteMergeInfo: function(b) {
        var c = this.data.mergeCells;
        var a;
        var d;
        for (a = 0; a < c.length; a++) {
            d = c[a];
            if (d.row == b.row && d.col == b.col) {
                c.splice(a, 1);
                a--
            }
        }
    },
    calculateRowSize: function(n) {
        var b = this.data.rows[n];
        var a = this.data.cells.rowList[n];
        var d = b.clientSize;
        if (!a) {
            return
        }
        var m;
        var l = [];
        var h;
        var g = b.minSize || b.size || 0;
        for (var c = 0; c < a.length; c++) {
            m = a[c];
            if (!m) {
                continue
            }
            if (!this.isColVisible(c)) {
                continue
            }
            h = m.padding || l;
            g = Math.max(TextHelper.calculateHeight(m, this.getCellWidth(m)) + (h[0] || 0) + (h[2] || 0), g)
        }
        b.dirty = false;
        b.clientSize = g;
        if (null  != this.data.height) {
            this.data.height += g - d
        }
        if (null  != this.dataClientHeight) {
            this.dataClientHeight += g - d
        }
        return d != g
    },
    getCellHeight: function(b) {
        var a = 0;
        if (b.rowSpan > 1) {
            for (index = b.rowIndex,
            end = b.rowIndex + b.rowSpan; index < end; index++) {
                if (this.isRowVisible(index)) {
                    a += this.data.rows[index].clientSize
                }
            }
        } else {
            a = this.data.rows[b.rowIndex].clientSize
        }
        return a
    },
    getCellWidth: function(a) {
        var b = 0;
        if (a.colSpan > 1) {
            for (index = a.colIndex,
            end = a.colIndex + a.colSpan; index < end; index++) {
                if (this.isColVisible(index)) {
                    b += this.data.cols[index].clientSize
                }
            }
        } else {
            b = this.data.cols[a.colIndex].clientSize
        }
        return b
    },
    calculateColSize: function(b) {
        var a = this.data.cols[b];
        var d = this.data.cells.rowList;
        var g = a.clientSize;
        var n;
        var m = [];
        var l;
        var h = a.minSize || a.size || 0;
        for (var c = 0; c < d.length; c++) {
            n = d[c][b];
            if (!n) {
                continue
            }
            if (!this.isRowVisible(c)) {
                continue
            }
            l = n.padding || m;
            h = Math.max(TextHelper.calculateWidth(n, this.getCellHeight(n)) + (l[1] || 0) + (l[3] || 0), h)
        }
        a.dirty = false;
        a.clientSize = h;
        if (null  != this.data.width) {
            this.data.width += h - g
        }
        if (null  != this.dataClientWidth) {
            this.dataClientWidth += h - g
        }
        return g != h
    },
    exchangeCols: function(b, l) {
        var q = {};
        q.doit = COM.widget.Grid.RESULT_TRUE;
        this.fireEvent(COM.widget.Grid.Event.EXCHANGE_COLS, {
            col1: b,
            col2: l,
            result: q
        });
        if (q.doit != COM.widget.Grid.RESULT_TRUE) {
            return
        }
        if (this.editPart.currentCellCol == b) {
            this.editPart.currentCellCol = l
        } else {
            if (this.editPart.currentCellCol == l) {
                this.editPart.currentCellCol = b
            }
        }
        var h = this.data.cells.rowList;
        var c;
        var p;
        var o;
        for (var g = 0; g < h.length; g++) {
            c = h[g];
            if (c) {
                p = c[b];
                o = c[l];
                if (p.merged || o.merged) {
                    var d = p.merged;
                    var a = p.mergeInfo;
                    p.merged = o.merged;
                    p.mergeInfo = o.mergeInfo;
                    o.merged = d;
                    o.mergeInfo = a;
                    if (p.figure) {
                        p.figure.setVisible(p.merged)
                    }
                    if (o.figure) {
                        o.figure.setVisible(o.merged)
                    }
                }
                if (p.colSpan > 1 || o.colSpan > 1) {
                    var m = p.colSpan;
                    var n = p.rowSpan;
                    p.colSpan = o.colSpan;
                    p.rowSpan = o.rowSpan;
                    o.colSpan = m;
                    o.rowSpan = n;
                    if (p.figure) {
                        p.figure.setRowSpan(p.rowSpan);
                        p.figure.setColSpan(p.colSpan)
                    }
                    if (o.figure) {
                        o.figure.setRowSpan(o.rowSpan);
                        o.figure.setColSpan(o.colSpan)
                    }
                }
                p.colIndex = l;
                o.colIndex = b;
                c[b] = o;
                c[l] = p
            }
        }
        this.editPart.refreshVisuals_scroll()
    },
    deleteRect: function(c, r) {
        var d = c.x;
        var l = c.y;
        var v = c.width;
        var t = c.height;
        var C = d + v - 1;
        var n = l + t - 1;
        var h = this.data.cells.rowList;
        var z = this.data.mergeCells;
        var m;
        var b;
        var u = this.data.colCount;
        var o = this.data.rowCount;
        var a = [];
        var D;
        function s(F, G, E) {
            D = true;
            a.push({
                col: F,
                row: G
            })
        }
        if (r == COM.widget.Grid.DELETE_DEAL_HORIZ) {
            for (var B = l; B <= n; B++) {
                m = h[B];
                for (var w = d; w < u; w++) {
                    b = m[w];
                    if (b) {
                        if (b.merged) {
                            if (b.mergeInfo.row < l || b.mergeInfo.col < d) {
                                s(b.mergeInfo.col, b.mergeInfo.row, b)
                            }
                        } else {
                            if (b.rowIndex + b.rowSpan - 1 > n) {
                                s(w, B, b)
                            }
                        }
                    }
                }
            }
            var p = {};
            p.doit = COM.widget.Grid.RESULT_TRUE;
            if (D) {
                this.fireEvent(COM.widget.Grid.Event.DELETING_RECT, {
                    rect: {
                        x: d,
                        y: l,
                        width: v,
                        height: t
                    },
                    result: p,
                    unMergeList: a
                })
            }
            if (p.doit !== COM.widget.Grid.RESULT_TRUE) {
                return
            }
            var q;
            for (var B = 0, A = a.length; B < A; B++) {
                q = a[B];
                this.unMergeCell(q.col, q.row)
            }
            var g;
            for (var B = 0, A = z.length; B < A; B++) {
                var g = z[B];
                if (g.row < l || g.row > n) {
                    break
                }
                if (g.col > d) {
                    if (g.col > C) {
                        g.col -= v
                    } else {
                        if (g.col + g.width - 1 > C) {
                            g.col = d
                        } else {
                            z.splice(B, 1);
                            A--
                        }
                    }
                }
            }
            for (var B = l; B <= n; B++) {
                m = h[B];
                for (var w = C + 1; w <= u; w++) {
                    b = m[w];
                    if (b) {
                        if (b.merged) {
                            if (b.mergeInfo.col > C) {
                                b.mergeInfo.col -= v
                            }
                        }
                        b.colIndex -= v;
                        m[w - v] = b
                    }
                }
            }
            for (var B = l; B <= n; B++) {
                m = h[B];
                for (var w = u - v; w < u; w++) {
                    b = this.defaultHelper.createDefaultCell();
                    b.rowIndex = B;
                    b.colIndex = w;
                    m[w] = b
                }
            }
        } else {
            for (var B = l; B < o; B++) {
                m = h[B];
                for (var w = d; w <= C; w++) {
                    b = m[w];
                    if (b) {
                        if (b.merged) {
                            if (b.mergeInfo.col < d || b.mergeInfo.row < l) {
                                s(b.mergeInfo.col, b.mergeInfo.row, b)
                            }
                        } else {
                            if (b.colIndex + b.colSpan - 1 > C) {
                                s(w, B, b)
                            }
                        }
                    }
                }
            }
            var p = {};
            p.doit = COM.widget.Grid.RESULT_TRUE;
            if (D) {
                this.fireEvent(COM.widget.Grid.Event.DELETING_RECT, {
                    rect: {
                        x: d,
                        y: l,
                        width: v,
                        height: t
                    },
                    result: p,
                    unMergeList: a
                })
            }
            if (p.doit !== COM.widget.Grid.RESULT_TRUE) {
                return
            }
            var q;
            for (var B = 0, A = a.length; B < A; B++) {
                q = a[B];
                this.unMergeCell(q.col, q.row)
            }
            var g;
            for (var B = 0, A = z.length; B < A; B++) {
                var g = z[B];
                if (g.col < d || g.col > C) {
                    break
                }
                if (g.row > l) {
                    if (g.row > n) {
                        g.row -= t
                    } else {
                        if (g.row + g.height - 1 > n) {
                            g.row = l
                        } else {
                            z.splice(B, 1);
                            A--
                        }
                    }
                }
            }
            for (var B = n + 1; B < o; B++) {
                m = h[B];
                for (var w = d; w <= C; w++) {
                    b = m[w];
                    if (b) {
                        if (b.merged) {
                            if (b.mergeInfo.row > n) {
                                b.mergeInfo.row -= t
                            }
                        }
                        b.rowIndex -= t;
                        h[B - t][w] = b
                    }
                }
            }
            for (var B = o - t; B < o; B++) {
                for (var w = d; w <= C; w++) {
                    b = this.defaultHelper.createDefaultCell();
                    b.rowIndex = B;
                    b.colIndex = w;
                    h[B][w] = b
                }
            }
        }
        this.editPart.refreshVisuals_scroll()
    },
    calculateMergeCells: function() {
        var g = this.data;
        var h = g.mergeCells;
        var b = g.cells.rowList;
        var n;
        var o;
        var p;
        var l;
        var m;
        if (h != null ) {
            for (var d = 0; d < h.length; d++) {
                n = h[d];
                m = b[n.row];
                if (m == null ) {
                    continue
                }
                l = b[n.row][n.col];
                if (l == null ) {
                    continue
                }
                if (l.merged) {
                    h.splice(d, 1);
                    d--;
                    continue
                }
                l.rowSpan = n.height;
                l.colSpan = n.width;
                for (var a = 0; a < n.height; a++) {
                    for (var c = 0; c < n.width; c++) {
                        p = b[n.row + a];
                        if (p) {
                            o = p[n.col + c];
                            if (o) {
                                o.merged = true;
                                o.mergeInfo = {
                                    col: n.col,
                                    row: n.row
                                }
                            }
                        }
                    }
                }
                l.merged = false;
                l.mergeInfo = null 
            }
        }
    },
    getEditMode: function() {
        return this.data.options.editMode
    },
    clearText: function(d, l, h) {
        var g = this.data.cells.rowList;
        var m;
        var a;
        for (var c = 0; c < d.height; c++) {
            m = g[d.y + c];
            if (m) {
                for (var b = 0; b < d.width; b++) {
                    a = m[d.x + b];
                    if (a) {
                        if (h || a.editable) {
                            a.showText = "";
                            a.editText = "";
                            if (a.figure) {
                                a.figure.setText("");
                                a.figure.repaint()
                            }
                        }
                    }
                }
            }
        }
        this.fireEvent(COM.widget.Grid.Event.DATA_CHANGE, {
            rect: {
                x: d.x,
                y: d.y,
                width: d.width,
                height: d.height
            },
            cause: l
        })
    },
    clearRect: function(d, l, h) {
        var g = this.data.cells.rowList;
        var m;
        var a;
        for (var c = 0; c < d.height; c++) {
            m = g[d.y + c];
            if (m) {
                for (var b = 0; b < d.width; b++) {
                    a = m[d.x + b];
                    if (a) {
                        if (h || a.editable) {
                            this.clearCell(a)
                        }
                    }
                }
            }
        }
        this.fireEvent(COM.widget.Grid.Event.DATA_CHANGE, {
            rect: {
                x: d.x,
                y: d.y,
                width: d.width,
                height: d.height
            },
            cause: l
        })
    },
    copyCell: function(b, c) {
        var a = {};
        if (c & COM.widget.Grid.COPY_CONTENT) {
            a.editorId = b.editorId;
            a.title = b.title;
            a.showText = b.showText;
            a.editText = b.editText;
            a.cellMode = b.cellMode;
            a.html = b.html;
            a.treeImage = b.treeImage;
            a.control = b.control;
            a.checked = b.checked;
            a.checkable = b.checkable;
            a.expandable = b.expandable;
            a.expanded = b.expanded;
            a.depth = b.depth;
            a.clientData = b.clientData;
            a.isTreeEnd = b.isTreeEnd;
            a.rowSpan = 1;
            a.colSpan = 1;
            a.merged = b.merged
        }
        if (c & COM.widget.Grid.COPY_STYLE) {
            a.selectable = b.selectable;
            a.editable = b.editable;
            a.rowSpan = b.rowSpan;
            a.colSpan = b.colSpan;
            a.backStyle = b.backStyle;
            a.backColor = b.backColor;
            if (b.gradientBackground) {
                a.gradientBackground = {
                    begin: b.gradientBackground.begin,
                    end: b.gradientBackground.end,
                    direction: b.gradientBackground.direction
                }
            }
            a.border = [b.border[0], b.border[1], b.border[2], b.border[3]];
            a.borderColor = [b.borderColor[0], b.borderColor[1], b.borderColor[2], b.borderColor[3]];
            a.fontName = b.fontName;
            a.fontSize = b.fontSize;
            a.fontBold = b.fontBold;
            a.fontItalic = b.fontItalic;
            a.fontColor = b.fontColor;
            a.textStroke = b.textStroke;
            if (b.textShadow) {
                a.textShadow = {
                    offsetX: b.offsetX,
                    offsetY: b.offsetY,
                    blur: b.blur,
                    color: b.color
                }
            }
            a.wrapLine = b.wrapLine;
            a.indent = b.indent;
            a.horzAlign = b.horzAlign;
            a.vertAlign = b.vertAlign;
            a.vertText = b.vertText;
            a.fitFontSize = b.fitFontSize;
            a.multiLine = b.multiLine;
            a.decoration = b.decoration;
            a.fontSizeUnit = b.fontSizeUnit;
            a.cellMode = COM.widget.Grid.Cell.Cell_MODE_NORMAL;
            a.clientData = {}
        }
        return a
    },
    clearCell: function(a) {
        a.showText = "";
        a.editText = "";
        a.title = "";
        a.selectable = true;
        a.editable = true;
        a.cellMode = COM.widget.Grid.Cell.Cell_MODE_NORMAL;
        a.backStyle = 1;
        a.backColor = "#fff";
        a.gradientBackground = null ;
        a.border = this.defaultHelper.createDefaultBorder();
        a.borderColor = this.defaultHelper.createDefaultBorderColor();
        a.fontName = "����";
        a.fontSize = 12;
        if (a.figure) {
            a.figure.setText("");
            a.figure.setCellMode(COM.widget.Grid.Cell.Cell_MODE_NORMAL);
            a.figure.setBackStyle(1);
            a.figure.setBackColor("#fff");
            a.figure.setGradientBackground(null );
            a.figure.setBackStyle(a.border);
            a.figure.setBorderColor(a.borderColor);
            a.figure.setFontName(a.fontName);
            a.figure.setFontSize(a.fontSize)
        }
    },
    isPassReadOnly: function() {
        return this.data.options.passReadOnly
    },
    getEnterNext: function() {
        return this.data.options.enterNext
    },
    setEnterNext: function(a) {
        this.data.options.enterNext = a
    },
    isRowSelectable: function() {
        return this.data.options.rowSelectable
    },
    isColSelectable: function() {
        return this.data.options.colSelectable
    },
    isShowSelectionBorder: function() {
        return this.data.options.showSelectionBorder
    },
    setShowSlectionBorder: function(a) {
        this.data.options.showSelectionBorder = a
    },
    isCurrenCellBorderHidden: function() {
        return this.data.options.currentCellBorderHidden
    },
    isColExchangeable: function() {
        return this.data.options.colExchangeable
    },
    isColResizeable: function() {
        return this.data.options.colResizeable
    },
    isRowResizeable: function() {
        return this.data.options.rowResizeable
    },
    isColFreeResizeable: function() {
        return this.data.options.colFreeResizeable
    },
    isRowFreeResizeable: function() {
        return this.data.options.rowFreeResizeable
    },
    setCurrentCell: function(a, c, b) {
        this.editPart.setCurrentCell(a, c, b)
    },
    getCurrentCell: function() {
        var a = this.editPart.currentCellCol;
        var b = this.editPart.currentCellRow;
        return this.getCellController(a, b)
    },
    getCellFigureFactory: function() {
        return this.cellFigureFactory
    },
    onSizeChanged: function() {
        this.performColGrab();
        this.freshDataClientWidth()
    },
    getColorProvider: function() {
        return this.colorProvider
    },
    freshColGrab: function(d) {
        if (d) {
            this.performColGrab();
            this.freshDataClientWidth()
        } else {
            var b = this.getGrabCols();
            for (var c = 0, a = b.length; c < a; c++) {
                b[c].clientSize = b[c].size
            }
        }
        this.editPart.refreshVisuals_scroll()
    },
    freshGrabCols: function() {
        this.grabCols = null 
    },
    performColGrab: function() {
        Debugger.log("perform grab");
        if (this.data.options.colGrabable) {
            if (this.data.options.loadMode != COM.widget.Grid.LOAD_MODE_NORMAL && !this.data.options.loadByRow) {
                return
            }
            var c = this.getDataWidth();
            var g = this.editPart.getViewer().getSize().width;
            Debugger.log("total width:" + g);
            if (c >= g) {
                return
            }
            var a = this.getGrabCols();
            if (a.length > 0) {
                var d = ((g - c) / a.length) << 0;
                for (var b = 0; b < a.length; b++) {
                    a[b].clientSize = a[b].size + d
                }
            }
        }
    },
    freshDataClientWidth: function() {
        this.dataClientWidth = null 
    },
    freshDataClientHeight: function() {
        this.dataClientHeight = null 
    },
    freshDataWidth: function() {
        this.dataWidth = null 
    },
    freshDataHeight: function() {
        this.dataHeight = null 
    },
    getDataWidth: function() {
        if (this.dataWidth == null ) {
            this.dataWidth = 0;
            for (var a = 0; a < this.data.cols.length; a++) {
                if (!this.data.cols[a].hidden) {
                    this.dataWidth += this.data.cols[a].size
                }
            }
        }
        return this.dataWidth
    },
    getDataSize: function() {
        var b = this.getDataWidth();
        var a = this.getDataHeight();
        return new Dimension(b,a)
    },
    getDataHeight: function() {
        if (this.dataHeight == null ) {
            this.dataHeight = 0;
            for (var a = 0; a < this.data.rows.length; a++) {
                if (!this.data.rows[a].hidden) {
                    this.dataHeight += this.data.rows[a].size
                }
            }
        }
        return this.dataHeight
    },
    getDataClientSize: function() {
        var b = this.getDataClientWidth();
        var a = this.getDataClientHeight();
        return new Dimension(width,a)
    },
    getDataClientWidth: function() {
        if (this.dataClientWidth == null ) {
            this.dataClientWidth = 0;
            for (var a = 0; a < this.data.cols.length; a++) {
                if (!this.data.cols[a].hidden) {
                    this.dataClientWidth += this.data.cols[a].clientSize || this.data.cols[a].size
                }
            }
        }
        return this.dataClientWidth
    },
    getDataClientHeight: function() {
        if (this.dataClientHeight == null ) {
            this.dataClientHeight = 0;
            for (var a = 0; a < this.data.rows.length; a++) {
                if (!this.data.rows[a].hidden) {
                    this.dataClientHeight += this.data.rows[a].clientSize || this.data.rows[a].size
                }
            }
        }
        return this.dataClientHeight
    },
    getGrabCols: function() {
        if (!this.grabCols) {
            this.grabCols = [];
            var a;
            for (var b = 0; b < this.data.cols.length; b++) {
                a = this.data.cols[b];
                if (!a.hidden && a.grab) {
                    this.grabCols.push(a)
                }
            }
        }
        return this.grabCols
    },
    getCellController: function(b, c) {
        var a = this.getCell(b, c);
        if (!a) {
            return COM.widget.Grid.Cell.getNoneCell(b, c)
        }
        if (!a.controller) {
            a.controller = new COM.widget.Grid.Cell(a,this)
        }
        return a.controller
    },
    isRowHeaderResizeable: function() {
        return this.rowHeaderResizeable
    },
    isColHeaderResizeable: function() {
        return this.colHeaderResizeable
    },
    cut: function(c, a) {
        var b = this.copy(c, a);
        this.clearText(c, COM.widget.Grid.CAUSE_CUT);
        return b
    },
    copy: function(c, b) {
        var a = {};
        a.doit = COM.widget.Grid.RESULT_TRUE;
        this.fireEvent(COM.widget.Grid.Event.COPY, {
            col: c.x,
            row: c.y,
            width: c.width,
            height: c.height,
            result: a,
            style: b
        });
        if (a.doit != COM.widget.Grid.RESULT_TRUE) {
            return
        }
        var d = this.getCopyText(c, false);
        if (this.shareManager.copyFunction) {
            this.shareManager.copyFunction.call(this.shareManager.copyObj, d)
        }
        return d
    },
    getCopyText: function(h) {
        var n = "";
        var b = /\r\n/g;
        for (var d = h.y, a = h.y + h.height - 1; d <= a; ++d) {
            if (this.isIgnoreHidden() && !this.isRowVisible(d)) {
                continue
            }
            for (var c = h.x, l = h.x + h.width - 1; c <= l; ++c) {
                if (this.isIgnoreHidden() && !this.isColVisible(c)) {
                    continue
                }
                var m = this.getCell(c, d);
                var g = m.showText;
                if (!g) {
                    g = ""
                }
                g = g.replace(b, "\n");
                n += g;
                if (c != l) {
                    n += "\t"
                }
            }
            n += "\r\n"
        }
        return n
    },
    freshEditable: function(a, d, b) {
        if (!this.editPart.isEditing()) {
            return
        }
        var c = this.editPart.getCurrentCellColRow();
        if (c.col == a && c.row == d) {
            if (!this.editPart.canEdit(this.getCell(a, d))) {
                this.editPart.commitEdit(COM.widget.Grid.CAUSE_CALL)
            }
        }
    },
    isIgnoreHidden: function() {
        return this.data.options.ignoreHidden
    },
    isRowVisible: function(a) {
        return !this.data.rows[a].hidden
    },
    isColVisible: function(a) {
        return !this.data.cols[a].hidden
    },
    paste: function(b, d, c) {
        var a = this;
        function g(l) {
            var h = {};
            h.doit = COM.widget.Grid.RESULT_TRUE;
            a.fireEvent(COM.widget.Grid.Event.PASTE, {
                col: b,
                row: d,
                result: h,
                cbText: l
            });
            if (h.doit != COM.widget.Grid.RESULT_TRUE) {
                return
            }
            a.doPaste(l, b, d)
        }
        if (typeof this.shareManager.pasteFunction == "function") {
            this.shareManager.pasteFunction.call(this.shareManager.pasteObj, g)
        } else {
            g()
        }
    },
    doPaste: function(h, b, u) {
        if (h == null ) {
            return
        }
        var v = [];
        var o = "\r\n";
        if (!COM.Util.browser.ie && COM.Util.browser.ff) {
            o = "\n"
        }
        v = h.split(o);
        if (v.length > 0) {
            var r = v[v.length - 1];
            if (!r) {
                v.splice(v.length - 1, 1)
            }
        }
        var t = v.length;
        var a = 0;
        var s;
        for (var d = 0, n = v.length; d < n; d++) {
            s = v[d];
            v[d] = s.split("\t");
            a = Math.max(a, v[d].length)
        }
        var m = this.getRowCount();
        var q = this.getColCount();
        var p;
        var g;
        for (var d = 0, n = v.length; d < n && d + u < m; d++) {
            if (this.isIgnoreHidden() && !this.isRowVisible(d)) {
                continue
            }
            s = v[d];
            for (var c = 0, l = s.length; c < l && c + b < q; c++) {
                if (this.isIgnoreHidden() && !this.isColVisible(d)) {
                    continue
                }
                p = this.getCell(c + b, d + u);
                if (p) {
                    if (this.editPart.canEdit(p)) {
                        p.editText = s[c];
                        p.showText = s[c];
                        g = this.getCellController(c + b, d + u);
                        if (p.figure) {
                            p.figure.setText(p.showText);
                            p.figure.repaint()
                        }
                    }
                }
            }
        }
        this.fireEvent(COM.widget.Grid.Event.DATA_CHANGE, {
            rect: {
                x: b,
                y: u,
                width: c,
                height: d
            },
            cause: COM.widget.Grid.CAUSE_PASTE
        });
        this.fireEvent(COM.widget.Grid.Event.PASTED, {
            rect: {
                x: b,
                y: u,
                width: c,
                height: d
            }
        })
    },
    changeSelection: function(c, b, d) {
        var a = {
            doit: 1
        };
        this.fireEvent(COM.widget.Grid.Event.SELECTION_CHANGE, {
            oldSelection: c.getCopy(),
            newSelection: b.getCopy(),
            result: a
        });
        if (a.doit) {}
        this.editPart.setSelection(b);
        this.editPart.showSelectionHandle();
        this.editPart.setCurrentCell(b.x, b.y, {
            type: COM.widget.Grid.CAUSE_MOUSE,
            value: d
        })
    },
    fireEvent: function(a, b) {
        if (this.grid) {
            this.grid.fireEvent(a, b)
        }
    },
    setCellCursor: function(b, d, c) {
        var a = this.getCell(b, d);
        if (!a || a.cursor == c) {
            return
        }
        a.cursor = c;
        if (a.figure) {
            a.figure.setCursor(c)
        }
    },
    setColHeadCursor: function(c) {
        var a = this.getRowCount();
        for (var b = 0; b < a; b++) {
            this.setCellCursor(0, b, c)
        }
        this.colHeadCursor = c
    },
    setRowHeadCursor: function(c) {
        var a = this.getColCount();
        for (var b = 0; b < a; b++) {
            this.setCellCursor(b, 0, c)
        }
        this.rowHeadCursor = c
    },
    getColHeadCursor: function() {
        return this.colHeadCursor
    },
    getRowHeadCursor: function() {
        return this.rowHeadCursor
    },
    getCursorProvider: function() {
        return this
    },
    setEnabled: function(a) {
        if (this.enabled == a) {
            return
        }
        this.enabled = a;
        this.editPart.onEnabledChanged(this.enabled)
    },
    isEnabled: function() {
        return this.enabled
    },
    getHeadStyle: function() {
        return this.data.headStyle
    },
    isAdvancedResize: function() {
        return this.data.options.advancedResize
    },
    setRowRowResizeable: function(c, b) {
        var a = this.getRow(c);
        if (null  != a) {
            a.rowResizeable = b
        }
    },
    setRowColResizeable: function(c, b) {
        var a = this.getRow(c);
        if (null  != a) {
            a.colResizeable = b
        }
    },
    setColColResizeable: function(a, b) {
        var c = this.getCol(a);
        if (null  != c) {
            c.colResizeable = b
        }
    },
    setColRowResizeable: function(a, b) {
        var c = this.getCol(a);
        if (null  != c) {
            c.rowResizeable = b
        }
    },
    isRowRowResizeable: function(b) {
        var a = this.getRow(b);
        if (null  != a) {
            return a.rowResizeable
        }
    },
    isRowColResizeable: function(b) {
        var a = this.getRow(b);
        if (null  != a) {
            return a.colResizeable
        }
    },
    isColColResizeable: function(a) {
        var b = this.getCol(a);
        if (null  != b) {
            return b.colResizeable
        }
    },
    isColRowResizeable: function(a) {
        var b = this.getCol(a);
        if (null  != b) {
            return b.rowResizeable
        }
    },
    setCellEditorId: function(b, d, g) {
        var a = this.getCell(b, d);
        if (null  == a) {
            return
        }
        if (this.editPart.isEditing()) {
            var c = this.editPart.getCurrentCellColRow();
            if (null  != c && c.col == b && c.row == d && g != a.editorId) {
                this.editPart.commitEdit()
            }
        }
        a.editorId = g;
        a.editor = null 
    },
    insertRows: function(l, m, A, r) {
        this.editPart.tryCommitEdit();
        l = (l == null  || l > this.getRowCount()) ? this.getRowCount() : l;
        m = m || 1;
        if (!(A >= 0)) {
            if (l > 0) {
                A = l - 1
            }
        }
        if (l < this.data.rowHeaderCount) {
            this.data.rowHeaderCount += m
        }
        var p = false;
        var c = this.editPart.getCurrentCellColRow();
        if (l <= c.row) {
            p = true
        }
        var u = this.data.mergeCells;
        var b;
        var a;
        var d = this.data.cells.rowList;
        for (var z = 0; z < u.length; z++) {
            b = u[z];
            if (b.row >= l) {
                b.row += m
            } else {
                if (b.row + b.height > l) {
                    b.height += m;
                    a = this.getCell(b.col, b.row);
                    if (a) {
                        a.rowSpan += m;
                        if (a.figure) {
                            a.figure.setRowSpan(a.rowSpan)
                        }
                    }
                }
            }
        }
        var a;
        var n;
        for (var z = l; z < d.length; z++) {
            n = d[z];
            if (n) {
                for (var w = 0; w < n.length; w++) {
                    a = n[w];
                    if (a) {
                        a.rowIndex = z + m;
                        if (a.mergeInfo && a.mergeInfo.row >= l) {
                            a.mergeInfo.row += m
                        }
                    }
                }
            }
        }
        var h;
        var s;
        var q = this.getColorProvider();
        if (A > 0 && this.getRow(A) != null  && !q.isSimpleInsert()) {
            h = COM.widget.Grid.GridHelper.copyRow(this.getRow(A))
        }
        if (h == null ) {
            h = this.defaultHelper.createDefaultRow()
        }
        var B;
        var g;
        if (l > 0) {
            B = d[l - 1]
        }
        if (l < this.getRowCount()) {
            g = d[l]
        }
        var v;
        if (r == null ) {
            r = COM.widget.Grid.COPY_STYLE
        }
        if (typeof r === "number") {
            v = function(D) {
                return COM.widget.Grid.GridModel.copyCell(D, r)
            }
        } else {
            v = r
        }
        if (typeof v !== "function") {
            throw "wrong copy way"
        }
        var t;
        if (B == null  && g == null ) {
            d.splice(l, m, null )
        } else {
            for (var z = 0; z < m; z++) {
                t = [];
                for (var w = 0; w < this.getColCount(); w++) {
                    if (A >= 0 && !q.isSimpleInsert()) {
                        a = v(this.getCell(w, A))
                    } else {
                        a = this.defaultHelper.createDefaultCell()
                    }
                    a.rowIndex = l + m - z - 1;
                    a.colIndex = w;
                    if (l < this.getRowCount()) {
                        if (l > 0 && l < this.getRowCount() && this.mergedBySameCell(B[w], g[w])) {
                            a.merged = true;
                            a.mergeInfo = {
                                col: g[w].mergeInfo.col,
                                row: g[w].mergeInfo.row
                            }
                        }
                    }
                    t.push(a)
                }
                d.splice(l, 0, t)
            }
        }
        var o = 0;
        for (s = 0; s < m; s++) {
            this.data.rows.splice(l, 0, h);
            h = COM.widget.Grid.GridHelper.copyRow(h)
        }
        this.data.rowCount += m;
        o = h.size * m;
        for (z = l + m; z < this.data.rowCount; z++) {
            a = this.getCell(0, z);
            if (a && a.showText == null  && a.figure) {
                a.figure.setText(z)
            }
        }
        this.selectionMover.moveDown(this.editPart, l, m, true, p);
        this.editPart.setSelections(this.editPart.getSelections());
        var C = this.editPart.getCurrentCellColRow();
        if (null  !== C) {
            this.editPart.performSetCurrentCell(C.col, C.row)
        }
        this.dataHeight += o;
        this.freshDataClientHeight();
        this.firePropertyChange(COM.widget.Grid.GridModel.PROP_INSERT_ROW, l, h);
        if (this.isShowInsDelAnimation()) {
            this.playInsertRowsAnimation(l, m)
        }
    },
    insertCols: function(l, m, C, p) {
        this.editPart.tryCommitEdit();
        m = m || 1;
        l = (l == null  || l > this.getColCount()) ? this.getColCount() : l;
        if (!(C > 0)) {
            if (l > 0) {
                C = l - 1
            }
        }
        if (l < this.data.colHeaderCount) {
            this.data.colHeaderCount += m
        }
        var n = false;
        var d = this.editPart.getCurrentCellColRow();
        if (l <= d.col) {
            n = true
        }
        var s = this.data.mergeCells;
        var c;
        var a;
        var g = this.data.cells.rowList;
        for (var B = 0; B < s.length; B++) {
            c = s[B];
            if (c.col >= l) {
                c.col += m
            } else {
                if (c.col + c.width > l) {
                    c.width += m;
                    a = this.getCell(c.col, c.row);
                    a.colSpan += m;
                    if (a.figure) {
                        a.figure.setColSpan(a.colSpan)
                    }
                }
            }
        }
        var o = this.getColorProvider();
        var b;
        var q;
        if (C > 0 && this.getCol(C) != null  && !o.isSimpleInsert()) {
            b = COM.widget.Grid.GridHelper.copyCol(this.getCol(C))
        }
        if (b == null ) {
            b = this.defaultHelper.createDefaultCol()
        }
        var u = 0;
        var D = 0;
        for (q = 0; q < m; q++) {
            this.data.cols.splice(l, 0, b);
            b = COM.widget.Grid.GridHelper.copyCol(b);
            u += b.size;
            D += b.clientSize
        }
        var v;
        if (p == null ) {
            p = COM.widget.Grid.COPY_STYLE
        }
        if (p == null ) {
            p = COM.widget.Grid.COPY_STYLE
        }
        if (typeof p === "number") {
            v = function(F) {
                return COM.widget.Grid.GridModel.copyCell(F, p)
            }
        } else {
            v = p
        }
        if (typeof v !== "function") {
            throw ("wrong copy way")
        }
        var r;
        var a;
        var a;
        var h;
        var z;
        var t = this.getColCount();
        for (var B = 0; B < g.length; B++) {
            r = g[B];
            if (r) {
                for (var w = l; w < r.length; w++) {
                    a = r[w];
                    a.colIndex = w + m;
                    if (a.mergeInfo && a.mergeInfo.col >= l) {
                        a.mergeInfo.col += m
                    }
                }
                if (l > 0) {
                    h = r[l - 1]
                }
                if (l < t - 1) {
                    z = r[l]
                }
                for (var A = 0; A < m; A++) {
                    if (C >= 0 && !o.isSimpleInsert()) {
                        a = v(this.getCell(C, B))
                    } else {
                        a = this.defaultHelper.createDefaultCell()
                    }
                    a.colIndex = l + m - A - 1;
                    a.rowIndex = B;
                    if (this.mergedBySameCell(h, z)) {
                        a.merged = true;
                        a.mergeInfo = {
                            col: z.mergeInfo.col,
                            row: z.mergeInfo.row
                        }
                    }
                    r.splice(l, 0, a)
                }
            }
        }
        this.data.colCount += m;
        this.dataWidth += u;
        this.performColGrab();
        this.freshDataClientWidth();
        for (B = l + m; B < this.data.colCount; B++) {
            a = this.getCell(B, 0);
            if (a && a.showText == null  && a.figure) {
                a.figure.setText(COM.Util.Common.to26Str(B - 1))
            }
        }
        this.selectionMover.moveRight(this.editPart, l, m, true);
        this.editPart.setSelections(this.editPart.getSelections());
        var E = this.editPart.getCurrentCellColRow();
        if (null  !== E) {
            this.editPart.performSetCurrentCell(E.col, E.row)
        }
        this.firePropertyChange(COM.widget.Grid.GridModel.PROP_INSERT_COL, l, b);
        if (this.isShowInsDelAnimation()) {
            this.playInsertColsAnimation(l, m)
        }
    },
    deleteRows: function(n, m) {
        this.editPart.tryCommitEdit();
        m = m || 1;
        m = Math.min(m, this.data.rowCount - n);
        var c = this.data.mergeCells;
        var p;
        var q;
        var b;
        var l = this.data.cells.rowList;
        if (n < this.data.rowHeaderCount) {
            this.data.rowHeaderCount -= Math.min(m, this.data.rowHeaderCount - n)
        }
        var s = true;
        var o = this.editPart.getCurrentCellColRow();
        if (n <= o.row && n + m > o.row) {
            this.editPart.setCurrentCell(-1, -1, {
                type: COM.widget.Grid.CAUSE_CALL
            });
            s = false
        }
        for (var h = 0; h < c.length; h++) {
            p = c[h];
            if (p.row >= n) {
                if (p.row > n + m - 1) {
                    p.row -= m
                } else {
                    if (p.row + p.height > n + m) {
                        p.height = p.height - (n + m - p.row);
                        p.row = n;
                        b = l[n + m];
                        if (b) {
                            q = b[p.col];
                            if (q) {
                                q.rowSpan = p.height;
                                q.colSpan = p.width;
                                q.merged = false;
                                if (q.figure) {
                                    q.figure.setVisible(true)
                                }
                            }
                        }
                    } else {
                        c.splice(h, 1);
                        h--
                    }
                }
            } else {
                if (p.row + p.height > n + m - 1) {
                    p.height -= m;
                    b = l[p.row];
                    if (b) {
                        q = b[p.col];
                        if (q) {
                            q.rowSpan = p.height
                        }
                    }
                } else {
                    if (p.row + p.height >= n) {
                        p.height = n - p.row;
                        b = l[p.row];
                        if (b) {
                            q = b[p.col];
                            if (q) {
                                q.rowSpan = p.height
                            }
                        }
                    }
                }
            }
        }
        for (var g = n + m; g < l.length; g++) {
            b = l[g];
            if (b) {
                for (var h = 0; h < b.length; h++) {
                    q = b[h];
                    if (q) {
                        q.rowIndex = g - m;
                        if (q.merged) {
                            if (q.mergeInfo.row >= n) {
                                if (q.mergeInfo.row < n + m) {
                                    q.mergeInfo.row = n
                                } else {
                                    q.mergeInfo.row -= m
                                }
                            }
                        }
                    }
                }
            }
        }
        l.splice(n, m);
        var r = 0;
        for (var a = 0; a < m; a++) {
            var t = this.getRow(n + a);
            r += t.clientSize
        }
        this.data.rows.splice(n, m);
        this.data.rowCount -= m;
        this.dataHeight -= r;
        this.freshDataClientHeight();
        for (h = n; h < this.data.rowCount; h++) {
            q = this.getCell(0, h);
            if (q && q.showText == null  && q.figure) {
                q.figure.setText(h)
            }
        }
        this.selectionMover.moveUp(this.editPart, n + m, m, s);
        this.editPart.setSelections(this.editPart.getSelections());
        var d = this.editPart.getCurrentCellColRow();
        if (null  !== d) {
            this.editPart.performSetCurrentCell(d.col, d.row)
        }
        if (this.isShowInsDelAnimation()) {
            this.playDeleteRowsAnimation(n, r, m)
        } else {
            this.firePropertyChange(COM.widget.Grid.GridModel.PROP_DELETE_ROW, n, {})
        }
    },
    deleteCols: function(p, o) {
        this.editPart.tryCommitEdit();
        o = o || 1;
        o = Math.min(o, this.data.colCount - p);
        if (p < this.data.colHeaderCount) {
            this.data.colHeaderCount -= Math.min(o, (this.data.colHeaderCount - p))
        }
        var u = true;
        var q = this.editPart.getCurrentCellColRow();
        if (p <= q.col && p + o > q.col) {
            this.editPart.setCurrentCell(-1, -1, {
                type: COM.widget.Grid.CAUSE_CALL
            });
            u = false
        }
        var n = this.data.cells.rowList;
        var c = 0;
        var a = 0;
        var m = 0;
        var g;
        var d = this.data.mergeCells;
        var s;
        var b;
        var t;
        for (var m = 0; m < d.length; m++) {
            s = d[m];
            if (s.col >= p) {
                if (s.col > p + o - 1) {
                    s.col -= o
                } else {
                    if (s.col + s.width > p + o) {
                        s.width = s.width - (p + o - s.col);
                        s.col = p;
                        b = n[s.row];
                        if (b) {
                            t = b[p + o];
                            if (t) {
                                t.rowSpan = s.height;
                                t.colSpan = s.width;
                                t.merged = false;
                                if (t.figure) {
                                    t.figure.setVisible(true)
                                }
                            }
                        }
                    } else {
                        d.splice(m, 1);
                        m--
                    }
                }
            } else {
                if (s.col + s.width > p + o - 1) {
                    s.width -= o;
                    b = n[s.row];
                    if (b) {
                        t = b[s.col];
                        if (t) {
                            t.rowSpan = s.height;
                            t.colSpan = s.width
                        }
                    }
                } else {
                    if (s.col + s.width >= p) {
                        s.width = p - s.col;
                        b = n[s.row];
                        if (b) {
                            t = b[s.col];
                            if (t) {
                                t.rowSpan = s.height;
                                t.colSpan = s.width
                            }
                        }
                    }
                }
            }
        }
        for (a = 0; a < o; a++) {
            g = this.getCol(p + a);
            c += g.size
        }
        this.data.cols.splice(p, o);
        for (m = 0; m < n.length; m++) {
            b = n[m];
            if (b) {
                b.splice(p, o);
                for (var l = p, r = b.length; l < r; l++) {
                    t = b[l];
                    t.colIndex -= o;
                    if (t.merged) {
                        if (t.mergeInfo.col > p) {
                            if (t.mergeInfo.col >= p + o) {
                                t.mergeInfo.col -= o
                            } else {
                                t.mergeInfo.col = p
                            }
                        }
                    }
                }
            }
        }
        this.data.colCount -= o;
        for (m = p; m < this.data.rowCount; m++) {
            t = this.getCell(m, 0);
            if (t && t.showText == null  && t.figure) {
                t.figure.setText(COM.Util.Common.to26Str(m - 1))
            }
        }
        this.selectionMover.moveLeft(this.editPart, p + o, o, u);
        this.editPart.setSelections(this.editPart.getSelections());
        var h = this.editPart.getCurrentCellColRow();
        if (null  !== h) {
            this.editPart.performSetCurrentCell(h.col, h.row)
        }
        this.dataWidth -= c;
        this.freshDataClientWidth();
        if (this.isShowInsDelAnimation()) {
            this.playDeleteColsAnimation(p, o)
        } else {
            this.firePropertyChange(COM.widget.Grid.GridModel.PROP_DELETE_COL, p, {})
        }
    },
    setShowInsDelAnimation: function(a) {
        this.showInsDelAnimation = a
    },
    isShowInsDelAnimation: function() {
        return this.showInsDelAnimation
    },
    playInsertRowsAnimation: function(l, m) {
        var z = this.editPart.getFigure();
        var h = z.getUpdateManager();
        h.performUpdate();
        var q = this.editPart.areaWidths;
        var w = this.editPart.areaHeights;
        var t = q[0] + q[1] + q[2];
        var s = w[0] + w[1] + w[2];
        var o = this.editPart.getRealRowBegin(l);
        var g = 0;
        var p = this.data.rows;
        for (var v = l, u = l + m; v < u; v++) {
            g += p[v].clientSize
        }
        var r = h.graphicsSource;
        var c = r.control.context;
        var n = c.getImageData(0, o, t, g);
        c.clearRect(0, o, t, g);
        r.flushGraphics();
        var a = 1000;
        var b = this.createInsertRowsAnimationCallback(o, g, t, c, n, r);
        var d = this.createAnimationCompleteCallback(h);
        h.updating = true;
        this.beginAnimation(b, a, d)
    },
    playInsertColsAnimation: function(l, m) {
        var z = this.editPart.getFigure();
        var h = z.getUpdateManager();
        h.performUpdate();
        var o = this.editPart.areaWidths;
        var w = this.editPart.areaHeights;
        var s = o[0] + o[1] + o[2];
        var r = w[0] + w[1] + w[2];
        var v = this.editPart.getRealColBegin(l);
        var g = 0;
        var p = this.data.cols;
        for (var u = l, t = l + m; u < t; u++) {
            g += p[u].clientSize
        }
        var q = h.graphicsSource;
        var c = q.control.context;
        var n = c.getImageData(v, 0, g, r);
        c.clearRect(v, 0, g, r);
        q.flushGraphics();
        var a = 1000;
        var b = this.createInsertColsAnimationCallback(v, g, r, c, n, q);
        var d = this.createAnimationCompleteCallback(h);
        h.updating = true;
        this.beginAnimation(b, a, d)
    },
    playDeleteColsAnimation: function(l, m) {
        var z = this.editPart.getFigure();
        var h = z.getUpdateManager();
        var o = this.editPart.areaWidths;
        var w = this.editPart.areaHeights;
        var s = o[0] + o[1] + o[2];
        var r = w[0] + w[1] + w[2];
        var v = this.editPart.getRealColBegin(l);
        var g = 0;
        var p = this.data.cols;
        for (var u = l, t = l + m; u < t; u++) {
            g += p[u].clientSize
        }
        var q = h.graphicsSource;
        var c = q.control.context;
        var n = c.getImageData(v, 0, g, r);
        c.clearRect(v, 0, g, r);
        q.flushGraphics();
        var a = 1000;
        var b = this.createDeleteColsAnimationCallback(v, g, r, c, n, q);
        var d = this.createDeleteColsAnimationCompleteCallback(l, h);
        h.updating = true;
        this.beginAnimation(b, a, d)
    },
    playDeleteRowsAnimation: function(q, r, o) {
        var t = this.editPart.getFigure();
        var p = t.getUpdateManager();
        var l = this.editPart.areaWidths;
        var s = this.editPart.areaHeights;
        var d = l[0] + l[1] + l[2];
        var u = s[0] + s[1] + s[2];
        var n = this.editPart.getRealRowBegin(q);
        var v = this.data.rows;
        var h = p.graphicsSource;
        var c = h.control.context;
        var b = c.getImageData(0, n, d, r);
        c.clearRect(0, n, d, r);
        h.flushGraphics();
        var m = 1000;
        var g = this.createDeleteRowsAnimationCallback(0, n, d, r, c, b, h);
        var a = this.createDeleteRowsAnimationCompleteCallback(q, p);
        p.updating = true;
        this.beginAnimation(g, m, a)
    },
    createDeleteRowsAnimationCallback: function(b, l, g, a, d, h, c) {
        return function(m) {
            d.clearRect(b, l, g, a);
            d.putImageData(h, -m * g, l);
            c.flushGraphics()
        }
    },
    createDeleteRowsAnimationCompleteCallback: function(b, c) {
        var a = this;
        return function() {
            c.updating = false;
            a.firePropertyChange(COM.widget.Grid.GridModel.PROP_DELETE_ROW, b, {})
        }
    },
    createInsertRowsAnimationCallback: function(h, a, d, c, g, b) {
        return function(l) {
            c.clearRect(0, h, d, a);
            c.putImageData(g, l * d - d, h);
            b.flushGraphics()
        }
    },
    createDeleteColsAnimationCallback: function(b, g, a, d, h, c) {
        return function(l) {
            d.clearRect(b, 0, g, a);
            d.putImageData(h, b, -l * a);
            c.flushGraphics()
        }
    },
    createDeleteColsAnimationCompleteCallback: function(b, c) {
        var a = this;
        return function() {
            c.updating = false;
            a.firePropertyChange(COM.widget.Grid.GridModel.PROP_DELETE_COL, b, {})
        }
    },
    createInsertColsAnimationCallback: function(b, g, a, d, h, c) {
        return function(l) {
            d.clearRect(b, 0, g, a);
            d.putImageData(h, b, l * a - a);
            c.flushGraphics()
        }
    },
    createAnimationCompleteCallback: function(a) {
        if (this.completeCallback == null ) {
            this.completeCallback = function() {
                a.updating = false
            }
        }
        return this.completeCallback
    },
    beginAnimation: function(g, c, b) {
        var a = new Date().getTime();
        function d() {
            var l = new Date().getTime();
            var h = (l - a) / c;
            h = Math.min(h, 1);
            g(h);
            if (h < 1) {
                requestAnimFrame(d)
            } else {
                b()
            }
        }
        requestAnimFrame(d)
    },
    dispose: function() {
        delete this.grid;
        delete this.editPart;
        delete this.defaultEditor;
        delete this.afterLoadToDo;
        delete this.selectionMover;
        delete this.colorProvider;
        delete this.cellFigureFactory;
        var d = this.data.rows;
        var h = this.data.cols;
        try {
            for (var l = 0; l < d.length; l++) {
                var c = this.data.cells.rowList[l];
                if (c) {
                    for (var b = 0; b < h.rows; b++) {
                        var a = c[b];
                        if (a) {
                            delete a.editor;
                            delete a.control;
                            if (a.figure && a.figure.doDispose) {
                                a.figure.doDispose()
                            }
                            delete c[b]
                        }
                    }
                    delete this.data.cells.rowList[l]
                }
            }
        } catch (g) {
            Debugger.error("dispose data faild.")
        }
        delete this.data.cells.rowList;
        delete this.data.rows;
        delete this.data.cols;
        delete this.data
    }
});
COM.widget.Grid.GridModel.PROP_CELL = "CELL";
COM.widget.Grid.GridModel.PROP_COL_SIZE = "col size";
COM.widget.Grid.GridModel.PROP_ROW_SIZE = "row size";
COM.widget.Grid.GridModel.PROP_COL_SIZE_AUTO = "col size auto";
COM.widget.Grid.GridModel.PROP_ROW_SIZE_AUTO = "row size auto";
COM.widget.Grid.GridModel.PROP_INSERT_ROW = "insert row";
COM.widget.Grid.GridModel.PROP_INSERT_COL = "insert col";
COM.widget.Grid.GridModel.PROP_DELETE_ROW = "delete row";
COM.widget.Grid.GridModel.PROP_DELETE_COL = "delete col";
COM.widget.Grid.GridModel.PROP_CELL_SHOWTEXT = "showText";
COM.widget.Grid.GridModel.PROP_CELL_EDITTEXT = "editText";
COM.widget.Grid.GridModel.PROP_LOAD_DATA = "load data";
COM.widget.Grid.GridModel.copyCell = function(b, d) {
    var a = {};
    if (d & COM.widget.Grid.COPY_CONTENT) {
        a.title = b.title;
        a.showText = b.showText;
        a.editText = b.editText;
        a.cellMode = b.cellMode;
        a.html = b.html;
        a.treeImage = b.treeImage;
        a.checked = b.checked;
        a.checkable = b.checkable;
        a.expandable = b.expandable;
        a.expanded = b.expanded;
        a.depth = b.depth;
        a.isTreeEnd = b.isTreeEnd
    }
    if (d & COM.widget.Grid.COPY_STYLE) {
        a.editorId = b.editorId;
        a.selectable = b.selectable;
        a.editable = b.editable;
        a.rowSpan = 1;
        a.colSpan = 1;
        a.backStyle = b.backStyle;
        a.backColor = b.backColor;
        if (b.gradientBackground) {
            a.gradientBackground = {
                begin: b.gradientBackground.begin,
                end: b.gradientBackground.end,
                direction: b.gradientBackground.direction
            }
        }
        if (b.border) {
            a.border = [b.border[0], b.border[1], b.border[2], b.border[3]]
        } else {
            a.border = []
        }
        if (b.borderColor) {
            a.borderColor = [b.borderColor[0], b.borderColor[1], b.borderColor[2], b.borderColor[3]]
        } else {
            a.borderColor = []
        }
        a.fontName = b.fontName;
        a.fontSize = b.fontSize;
        a.fontBold = b.fontBold;
        a.fontItalic = b.fontItalic;
        a.fontColor = b.fontColor;
        a.textStroke = b.textStroke;
        if (b.textShadow) {
            a.textShadow = {
                offsetX: b.offsetX,
                offsetY: b.offsetY,
                blur: b.blur,
                color: b.color
            }
        }
        if (b.padding != null ) {
            a.padding = [];
            a.padding[0] = b.padding[0];
            a.padding[1] = b.padding[1];
            a.padding[2] = b.padding[2];
            a.padding[3] = b.padding[3]
        }
        a.wrapLine = b.wrapLine;
        a.indent = b.indent;
        a.horzAlign = b.horzAlign;
        a.vertAlign = b.vertAlign;
        a.vertText = b.vertText;
        a.fitFontSize = b.fitFontSize;
        a.multiLine = b.multiLine;
        a.decoration = b.decoration;
        a.fontSizeUnit = b.fontSizeUnit;
        a.cellMode = COM.widget.Grid.Cell.Cell_MODE_NORMAL;
        var g = b.clientData;
        a.clientData = {};
        for (var c in g) {
            a.clientData[c] = g[c]
        }
    }
    a.rowSpan = 1;
    a.colSpan = 1;
    a.merged = false;
    a.mergeInfo = null ;
    return a
}
;
COM.widget.Grid.GridModel.ModelReader = function() {
    this.isRowResizeable = function(a) {
        if (null  != a) {
            return a.rowResizeable
        }
    }
    ;
    this.isColResizeable = function(a) {
        if (null  != a) {
            return a.colResizeable
        }
    }
    ;
    return this
}();
COM.widget.Grid.GridEditPart = function GridEditPart() {
    COM.widget.Grid.GridEditPart.superclass.constructor.call(this);
    this.scrollTopCell = 0;
    this.scrollLeftCell = 0;
    this.scrollTop = 0;
    this.scrollLeft = 0;
    this.fixedScrollTop = 0;
    this.fixedScrollLeft = 0;
    this.blankX = 0;
    this.blankY = 0;
    this.drawStartRow = 0;
    this.drawEndRow = 0;
    this.drawStartCol = 0;
    this.drawEndCol = 0;
    this.selectionHandleShowing = true;
    this.goNextMemery = {};
    this.areas = [[], [], []];
    this.currentCellCol = -1;
    this.currentCellRow = -1;
    this.initCellMouseMotionListener();
    this.initCellMouseListener();
    this.initGridMouseListener();
    this.offsetX = 0;
    this.offsetY = 0;
    this.visible = true;
    this.disposed = false
}
;
COM.widget.Grid.GridEditPart.extend(COM.gef.AbstractGraphicalEditPart, {
    isEnabled: function() {
        return this.model.isEnabled()
    },
    onVisibleChanged: function(a) {
        if (this.visible === a) {
            return
        }
        this.visible = a
    },
    isVisible: function() {
        return this.visible
    },
    canVisible: function() {
        return this.getViewer().width > 0 || this.getViewer().height > 0
    },
    canFocus: function() {
        return this.isVisible()
    },
    onEnabledChanged: function(a) {
        if (a) {
            this.hideMask()
        } else {
            this.showMask()
        }
    },
    showMask: function() {
        this.resizeMask().style.display = ""
    },
    resizeMask: function() {
        var a = this.getMask();
        var b = this.getViewer().getSize();
        a.style.width = b.width + 16 + "px";
        a.style.height = b.height + 16 + "px";
        return a
    },
    hideMask: function() {
        var a = this.getMask();
        a.style.display = "none"
    },
    getMask: function() {
        if (this.mask == null ) {
            this.mask = document.createElement("div");
            this.mask.style.position = "absolute";
            this.mask.id = "mask";
            this.mask.style.left = "0px";
            this.mask.style.top = "0px";
            this.mask.style.display = "none";
            this.mask.style.backgroundColor = "rgba(255,255,255,0.2)";
            this.mask.style.zIndex = 100;
            this.getViewer().getEditDomain().getControl().appendChild(this.mask)
        }
        return this.mask
    },
    getDragTracker: function() {
        if (this.dragTracker == null ) {
            this.dragTracker = new COM.widget.Grid.GridDragTracker(this)
        }
        return this.dragTracker
    },
    getRowCount: function() {
        return this.getModel().data.rowCount
    },
    getColCount: function() {
        return this.getModel().data.colCount
    },
    propertyChange: function(a) {
        var c = a.getPropertyName();
        if (c != COM.widget.Grid.GridModel.PROP_CELL_SHOWTEXT && c != COM.widget.Grid.GridModel.PROP_CELL_EDITTEXT && this.isEditing()) {}
        this.onDataSizeChanged();
        if (c == COM.widget.Grid.GridModel.PROP_INSERT_COL) {
            var b = this.doOnScroll(null , true);
            if (!b) {
                this.refreshVisuals_scroll()
            }
        } else {
            if (c == COM.widget.Grid.GridModel.PROP_INSERT_ROW) {
                var b = this.doOnScroll(null , true);
                if (!b) {
                    this.refreshVisuals_scroll()
                }
            } else {
                if (c == COM.widget.Grid.GridModel.PROP_DELETE_COL) {
                    var b = this.doOnScroll(null , true);
                    if (!b) {
                        this.refreshVisuals_scroll()
                    }
                } else {
                    if (c == COM.widget.Grid.GridModel.PROP_DELETE_ROW) {
                        var b = this.doOnScroll(null , true);
                        if (!b) {
                            this.refreshVisuals_scroll()
                        }
                    }
                }
            }
        }
        switch (c) {
        case COM.widget.Grid.GridModel.PROP_COL_SIZE:
        case COM.widget.Grid.GridModel.PROP_ROW_SIZE:
        case COM.widget.Grid.GridModel.PROP_COL_SIZE_AUTO:
        case COM.widget.Grid.GridModel.PROP_ROW_SIZE_AUTO:
        case COM.widget.Grid.GridModel.PROP_LOAD_DATA:
            this.refreshVisuals_scroll();
            break;
        default:
        }
    },
    onDataSizeChanged: function() {
        this.freshScrollPlaceHolderSize()
    },
    onSizeChanged: function() {
        this.resizeMask();
        this.freshScrollPlaceHolderSize()
    },
    freshScrollPlaceHolderSize: function() {
        if (!(this.vertiScroller && this.horizScroller)) {
            return
        }
        var c = this.getModel().getDataClientHeight();
        var g = this.getModel().getDataClientWidth();
        var l = this.getModel().getControlSize();
        var h = this.getViewer().getSize();
        var d = new Dimension();
        if (c <= this.vertiScroller.getSize()) {
            c = 1;
            d.width = l.width;
            this.vertiScroller.hide()
        } else {
            c += 0;
            d.width = l.width - 16 - 2;
            this.vertiScroller.show()
        }
        if (g <= this.horizScroller.getSize()) {
            g = 1;
            d.height = l.height;
            this.horizScroller.hide()
        } else {
            g += 0;
            d.height = l.height - 16 - 2;
            this.horizScroller.show()
        }
        this.horizScroller.setContentSize(g);
        this.vertiScroller.setContentSize(c);
        var b = false;
        var a = false;
        if (d.height != h.height) {
            b = true
        }
        if (d.width != h.width) {
            b = true;
            a = true
        }
        if (b) {
            this.getViewer().setSize(d.width, d.height)
        }
        if (a) {
            this.getModel().performColGrab();
            this.getModel().freshDataClientWidth()
        }
    },
    activate: function() {
        COM.widget.Grid.GridEditPart.superclass.activate.call(this);
        this.getModel().addPropertyChangeListener(this);
        this.getModel().setEditPart(this);
        this.vertiScroller = this.getViewer().getScrollHelper().getVerti();
        this.horizScroller = this.getViewer().getScrollHelper().getHoriz();
        this.freshScrollPlaceHolderSize();
        var a = this;
        this.vertiScroller.bindScrollListener(function(b) {
            a.onScroll(b)
        });
        this.horizScroller.bindScrollListener(function(b) {
            a.onScroll(b)
        });
        this.getViewer().setKeyHandler(this);
        this.setCursorProvider(this.getModel().getCursorProvider());
        this.addFocusReceiver(this.getViewer().getControl().getElement());
        this.bindKeyListenerForFocusReceiver();
        this.selectionManager = new COM.widget.Grid.GridSelectionManager(this);
        this.getViewer().getEditDomain().mouseWheelScrolled = function(b, c) {
            a.onMouseWheelScrolled(b)
        }
        ;
        this.addResizeHandle()
    },
    deactivate: function() {
        COM.widget.Grid.GridEditPart.superclass.deactivate.call(this);
        this.getModel().removePropertyChangeListener(this)
    },
    addResizeHandle: function() {
        if (this.isActive()) {
            for (var a = 1; a < this.policies.length; a += 2) {
                if (this.policies[a].addResizeHandle) {
                    this.policies[a].addResizeHandle()
                }
            }
        }
    },
    firePaging: function(b) {
        var a = {
            doit: 1
        };
        this.fireEvent(COM.widget.Grid.Event.PAGING, {
            origin: b,
            result: a
        });
        return a.doit == COM.widget.Grid.RESULT_TRUE
    },
    pageDown: function(b) {
        if (!this.firePaging(b)) {
            return
        }
        var a = this.areaHeights[1];
        this.vertiScroller.setScrollTop(this.vertiScroller.getScrollTop() + a)
    },
    pageUp: function(b) {
        if (!this.firePaging(b)) {
            return
        }
        var a = this.areaHeights[1];
        this.vertiScroller.setScrollTop(this.vertiScroller.getScrollTop() - a)
    },
    onMouseWheelScrolled: function(c) {
        var b = this.scrollVerti(c.delta < 0, 1, this.canRowVisible, this);
        if (this.getModel().data.options.loadMode == COM.widget.Grid.LOAD_MODE_STREAM) {
            if (this.vertiScroller.getScrollTop() == this.vertiScroller.getScrollTopMax()) {
                if (!this.loadCompeleted_v) {
                    var a = {};
                    this.lazyfireEvent(COM.widget.Grid.Event.DATA_LOAD_EVENT, {
                        byRow: true,
                        result: a
                    });
                    if (a.vdone) {
                        this.loadCompeleted_v = true
                    }
                }
            }
        }
        return true
    },
    scrollVerti: function(o, a, c, g) {
        var m = 0;
        var b;
        var q;
        var d = 0;
        a = a || 1;
        var p = this;
        for (var l = 1; d < a; l++) {
            if (o) {
                q = this.drawEndRow + l;
                if (q >= this.getRowCount()) {
                    m = this.vertiScroller.getScrollHeight() - this.vertiScroller.getScrollTop();
                    break
                } else {
                    b = this.getRowHeight(q)
                }
            } else {
                q = this.drawStartRow - l;
                if (q < 0) {
                    break
                } else {
                    b = -this.getRowHeight(q)
                }
            }
            if (this.isRowVisible(q)) {
                m += b
            }
            if (!(c && g && !c.call(g, q))) {
                d++
            }
        }
        this.vertiScroller.setScrollTop(this.vertiScroller.getScrollTop() + m);
        var n = o ? "down" : "up";
        this.fireEvent(COM.widget.Grid.Event.MOUSE_WHEEL, {
            direction: n
        });
        return true
    },
    scrollHoriz: function(d, a, b, g) {
        var n = 0;
        var l;
        var c;
        var m = 0;
        a = a || 1;
        b = b || this.isColVisible;
        g = g || this;
        for (var h = 0; m < a; h++) {
            if (d) {
                c = this.drawEndCol + h;
                if (c >= this.getColCount()) {
                    n = this.horizScroller.getScrollWidth() - this.horizScroller.getScrollLeft();
                    break
                } else {
                    l = this.getColWidth(c)
                }
            } else {
                c = this.drawStartCol - h;
                if (c < 0) {
                    break
                } else {
                    l = -this.getColWidth(c)
                }
            }
            if (this.isColVisible(c)) {
                n += l
            }
            if (b.call(g, c)) {
                m++
            }
        }
        this.horizScroller.setScrollLeft(this.horizScroller.getScrollLeft() + n)
    },
    setScrollLeft: function(a) {
        this.horizScroller.setScrollLeft(a)
    },
    getScrollLeft: function() {
        return this.horizScroller.getScrollLeft()
    },
    setScrollTop: function(a) {
        this.vertiScroller.setScrollTop(a)
    },
    getScrollTop: function() {
        return this.vertiScroller.getScrollTop()
    },
    getScrollHeight: function() {
        return this.vertiScroller.getScrollHeight()
    },
    getScrollWidth: function() {
        return this.horizScroller.getScrollWidth()
    },
    isRowVisible: function(a) {
        return !this.getModel().data.rows[a].hidden
    },
    canRowVisible: function(b) {
        var a = this.getModel().data.rows[b];
        return !a.hidden && a.clientSize > 0
    },
    isColVisible: function(a) {
        return !this.getModel().data.cols[a].hidden
    },
    getRowHeight: function(a) {
        return this.getModel().data.rows[a].clientSize
    },
    getColWidth: function(a) {
        return this.getModel().data.cols[a].clientSize
    },
    getFixedScrollTop: function() {
        return this.fixedScrollTop - this.blankY
    },
    getFixedScrollLeft: function() {
        return this.fixedScrollLeft - this.blankX
    },
    onScroll: function(a) {
        this.defalutDoOnScroll(a)
    },
    defalutDoOnScroll: function(b) {
        var a = this;
        if (this.scrollTimer == null ) {
            this.scrollTimer = setTimeout(function() {
                a.doOnScroll(b);
                a.scrollTimer = null 
            }, 10)
        } else {}
    },
    doOnScroll: function(o, a) {
        var b = this.getScrollTop();
        var d = this.getScrollLeft();
        var m = this.getModel().data;
        var n = 0
          , r = 0;
        var p = this.scrollTopCell;
        var c = this.scrollLeftCell;
        if (b != this.scrollTop || a) {
            if (b == 0) {
                p = 0;
                this.fixedScrollTop = 0
            } else {
                p = 0;
                for (var l = m.rowHeaderCount; l < m.rowCount - m.rowFooterCount; l++) {
                    if (!m.rows[l].hidden) {
                        n += m.rows[l].clientSize
                    }
                    if (n >= b) {
                        this.fixedScrollTop = n;
                        l++;
                        break
                    }
                }
                p = l - m.rowHeaderCount;
                p = Math.min(p, m.rowCount - m.rowHeaderCount - m.rowFooterCount - 1)
            }
            this.scrollTop = b
        }
        if (d != this.scrollLeft || a) {
            if (d == 0) {
                c = 0;
                this.fixedScrollLeft = 0
            } else {
                c = 0;
                for (var l = m.colHeaderCount; l < m.colCount - m.colFooterCount; l++) {
                    if (!m.cols[l].hidden) {
                        r += m.cols[l].clientSize
                    }
                    if (r >= d) {
                        this.fixedScrollLeft = r;
                        l++;
                        break
                    }
                }
                c = l - m.colHeaderCount;
                c = Math.min(c, m.colCount - m.colHeaderCount - m.colFooterCount - 1)
            }
            this.scrollLeft = d
        }
        var q = false;
        var g = false;
        if (p != this.scrollTopCell) {
            q = p > this.scrollTopCell;
            g = true;
            this.scrollTopCell = p
        }
        if (c != this.scrollLeftCell) {
            q = c > this.scrollLeftCell;
            g = true;
            this.scrollLeftCell = c
        }
        if (g) {
            this.refreshVisuals_scroll(true, q)
        }
        if (null  != o) {
            this.fireEvent(COM.widget.Grid.Event.SCROLLED, {
                origin: o
            })
        }
        return g
    },
    refreshVisuals_scroll: function(a, c) {
        var b = this.getFigure();
        this.createFigureContent(b);
        this.refreshHandlesLocation();
        this.refreshSelectionFeedbacksLocation();
        if (this.isEditing()) {
            if (this.currentCellCol > 0 && this.currentCellRow > 0) {
                if (this.isColCanDraw(this.currentCellCol) && this.isRowCanDraw(this.currentCellRow)) {
                    if (this.editorHide) {
                        this.setEditorVisible(true, COM.widget.Grid.CAUSE_MOUSE)
                    }
                } else {
                    if (!this.editorHide) {
                        this.setEditorVisible(false, COM.widget.Grid.CAUSE_MOUSE)
                    }
                }
            }
        }
    },
    refreshHandlesLocation: function() {
        if (this.isActive()) {
            for (var a = 1; a < this.policies.length; a += 2) {
                if (this.policies[a].refreshHandlesLocation) {
                    this.policies[a].refreshHandlesLocation()
                }
            }
        }
    },
    refreshSelectionFeedbacksLocation: function() {
        if (this.selectionManager) {
            this.selectionManager.freshFeedbacksLocation()
        }
    },
    refreshCurrentFigureField: function(a, b) {
        if (this.selectionManager) {
            this.selectionManager.refreshCurrentFigureField(a, b)
        }
    },
    initGridMouseListener: function() {
        var a = this;
        this.gridMouseListener = {
            mouseClicked: function(c, b) {
                a.fireEvent(COM.widget.Grid.Event.GRID_CLICK, {
                    x: c.x,
                    y: c.y,
                    origin: c.e
                })
            },
            mouseDoubleClicked: function(c, b) {
                a.fireEvent(COM.widget.Grid.Event.GRID_DOUBLE_CLICK, {
                    x: c.x,
                    y: c.y,
                    origin: c.e
                })
            }
        }
    },
    initCellMouseMotionListener: function() {
        var a = this;
        this.cellMouseMotionListener = {
            mouseEntered: function(c, b) {
                a.fireEvent(COM.widget.Grid.Event.CELL_MOUSE_IN, {
                    cell: a.getCellController(b.getCol(), b.getRow()),
                    x: c.x,
                    y: c.y
                })
            },
            mouseExited: function(c, b) {
                a.fireEvent(COM.widget.Grid.Event.CELL_MOUSE_OUT, {
                    cell: a.getCellController(b.getCol(), b.getRow()),
                    x: c.x,
                    y: c.y
                })
            },
            mouseMoved: function(c, b) {
                a.fireEvent(COM.widget.Grid.Event.CELL_MOUSE_MOVE, {
                    cell: a.getCellController(b.getCol(), b.getRow()),
                    x: c.x,
                    y: c.y
                })
            }
        }
    },
    initCellMouseListener: function() {
        var a = this;
        this.cellMouseListener = {
            mouseClicked: function(c, b) {
                a.fireEvent(COM.widget.Grid.Event.CELL_MOUSE_CLICK, {
                    cell: a.getCellController(b.getCol(), b.getRow()),
                    x: c.x,
                    y: c.y
                });
                a.fireEvent(COM.widget.Grid.Event.GRID_CLICK, {
                    x: c.x,
                    y: c.y,
                    origin: c.e
                })
            },
            mouseDoubleClicked: function(c, b) {
                a.fireEvent(COM.widget.Grid.Event.CELL_DOUBLE_CLICK, {
                    cell: a.getCellController(b.getCol(), b.getRow()),
                    x: c.x,
                    y: c.y,
                    origin: c.e
                });
                a.fireEvent(COM.widget.Grid.Event.GRID_DOUBLE_CLICK, {
                    x: c.x,
                    y: c.y,
                    origin: c.e
                })
            }
        }
    },
    createFigure: function() {
        var b = new COM.widget.Grid.GridFigure();
        var a = this;
        b.addMouseListener(this.gridMouseListener);
        b.setControlParent(this.getViewer().getControl().getElement());
        b.setAreaSizeProvider(this);
        b.setZIndexCalculator(this);
        b.cellFigureFinder = this;
        this.createFigureContent(b);
        return b
    },
    isLoadByRow: function() {
        return true
    },
    calculateCanDrawArea: function(v, G) {
        var u = 0;
        var w = 0;
        var D = 0;
        var z = this.getViewer().width;
        var d = 0;
        var g = 0;
        var q;
        var l;
        this.areaWidths = [];
        this.areaHeights = [];
        var r = this;
        var b = this.getModel();
        var F = false;
        function t() {
            var H = v.cols[d];
            if (r.isColVisible(d)) {
                if (G.options.loadMode != COM.widget.Grid.LOAD_MODE_NORMAL && G.options.loadByRow) {} else {
                    if (H.auto) {
                        if (H.dirty == null  || H.dirty) {
                            if (b.calculateColSize(d)) {
                                F = true
                            }
                        }
                    }
                }
                D += v.cols[d].clientSize
            }
        }
        function c() {
            l = v.rows[g];
            if (r.isRowVisible(g)) {
                if (G.options.loadMode != COM.widget.Grid.LOAD_MODE_NORMAL && !G.options.loadByRow) {} else {
                    if (l.auto) {
                        if (l.dirty == null  || l.dirty) {
                            if (b.calculateRowSize(g)) {
                                F = true
                            }
                        }
                    }
                }
                D += l.clientSize
            }
        }
        D = 0;
        z = this.getViewer().width;
        var h = 0;
        for (var A = 0; A < G.colHeaderCount && D < z; A++) {
            d = A;
            h++;
            t()
        }
        this.drawHeaderColCount = h;
        this.areaWidths[0] = D;
        D = 0;
        z = this.getViewer().width - this.areaWidths[0];
        h = 0;
        for (A = G.colCount - 1; A > G.colCount - G.colFooterCount - 1 && D < z; A--) {
            d = A;
            h++;
            t()
        }
        this.drawFooterColCount = h;
        this.areaWidths[2] = D;
        D = 0;
        z = this.getViewer().width - this.areaWidths[0] - this.areaWidths[2];
        h = 0;
        for (u = 0; u < G.colCount - G.colFooterCount - G.colHeaderCount - this.scrollLeftCell && D < z; u++) {
            d = u + G.colHeaderCount + this.scrollLeftCell;
            h++;
            t()
        }
        this.drawCenterColCount = h;
        this.areaWidths[1] = Math.min(z, D);
        D = 0;
        h = 0;
        z = this.getViewer().height;
        for (var A = 0; A < G.rowHeaderCount && D < z; A++) {
            g = A;
            h++;
            c()
        }
        this.drawHeaderRowCount = h;
        this.areaHeights[0] = D;
        D = 0;
        h = 0;
        z = this.getViewer().height - this.areaHeights[0];
        for (A = G.rowCount - 1; A > G.rowCount - G.rowFooterCount - 1 && D < z; A--) {
            g = A;
            h++;
            c()
        }
        this.drawFooterRowCount = h;
        this.areaHeights[2] = D;
        D = 0;
        h = 0;
        z = this.getViewer().height - this.areaHeights[0] - this.areaHeights[2];
        for (w = 0; w < G.rowCount - G.rowFooterCount - G.rowHeaderCount - this.scrollTopCell && D < z; w++) {
            g = w + G.rowHeaderCount + this.scrollTopCell;
            h++;
            c()
        }
        this.drawCenterRowCount = h;
        this.areaHeights[1] = Math.min(D, z);
        if (F) {
            this.onDataSizeChanged()
        }
        this.drawStartRow = G.rowHeaderCount + this.scrollTopCell;
        this.drawEndRow = G.rowHeaderCount + this.scrollTopCell + w - 1;
        this.drawStartCol = G.colHeaderCount + this.scrollLeftCell;
        this.drawEndCol = G.colHeaderCount + this.scrollLeftCell + u - 1;
        this.footerStartCol = G.colCount - this.drawFooterColCount;
        this.footerStartRow = G.rowCount - this.drawFooterRowCount;
        var p = this.getViewer().getSize();
        var E = this.areaHeights[0] + this.areaHeights[1] + this.areaHeights[2];
        var a = this.areaWidths[0] + this.areaWidths[1] + this.areaWidths[2];
        var m = p.height - E;
        var o = p.width - a;
        if (this.drawStartRow > G.rowHeaderCount && this.drawEndRow + 1 >= this.footerStartRow && m > 0) {
            this.areaHeights[1] += m;
            var C = this.getUpperRow(v);
            var n = v.rows[C].clientSize;
            this.drawStartRow = C;
            this.offsetY = n - m;
            this.blankY = m
        } else {
            this.offsetY = 0;
            this.blankY = 0
        }
        if (this.drawStartCol > G.colHeaderCount && this.drawEndCol + 1 >= this.footerStartCol && o > 0) {
            this.areaWidths[1] += o;
            var B = this.getUpperCol(v);
            this.drawStartCol = B;
            var s = v.cols[B].clientSize;
            this.offsetX = s - o;
            this.blankX = o
        } else {
            this.offsetX = 0;
            this.blankX = 0
        }
    },
    checkDrawAreaData: function(c, b) {
        var a = [];
        if (this.isLoadByRow()) {
            this.checkDataByRow(c, 0, b.rowHeaderCount - 1, a);
            this.checkDataByRow(c, this.drawStartRow, this.drawEndRow, a);
            this.checkDataByRow(c, this.footerStartRow, b.rowCount - 1, a)
        } else {
            this.checkDataByCol(c, 0, b.colHeaderCount - 1, a);
            this.checkDataByCol(c, this.drawStartCol, this.drawEndCol, a);
            this.checkDataByCol(c, this.footerStartCol, b.colCount - 1, a)
        }
        if (a.length > 0) {
            return a
        }
    },
    fireAreaSizeChanged: function() {
        this.getViewer().getControl().onLayouted(this.areaWidths, this.areaHeights)
    },
    checkDataBeforeCreateContent: function(c, b) {
        var d = false;
        var a;
        if (this.getModel().data.options.loadMode == COM.widget.Grid.LOAD_MODE_LAZY) {
            a = this.checkDrawAreaData(c, b);
            if (a && a.length > 0) {
                d = true;
                this.lazyfireEvent(COM.widget.Grid.Event.DATA_LOAD_EVENT, {
                    byRow: this.isLoadByRow(),
                    list: a
                })
            }
        }
        return d
    },
    getUpperRow: function(b) {
        var c = this.drawStartRow;
        var a;
        do {
            c = c - 1;
            a = b.rows[c]
        } while (a.hidden && c > 0);return c
    },
    getUpperCol: function(b) {
        var a = this.drawStartCol;
        var c;
        do {
            a = a - 1;
            c = b.cols[a]
        } while (c.hidden && a > 0);return a
    },
    preLoad: function(l, h) {
        var g = [];
        var a = Math.max(this.drawStartRow - 10, l.rowHeaderCount);
        var b = Math.min(this.drawEndRow + 10, this.footerStartRow - 1);
        var c = Math.max(this.drawStartCol - 10, l.colHeaderCount);
        var d = Math.min(this.drawEndCol + 10, this.footerStartCol - 1);
        if (this.isLoadByRow()) {
            if (this.drawStartRow <= this.drawEndRow) {
                this.checkDataByRow(h, a, this.drawStartRow, g);
                this.checkDataByRow(h, this.drawEndRow, b, g)
            }
        } else {
            if (this.drawStartCol <= this.drawEndCol) {
                this.checkDataByCol(h, c, this.drawStartCol, g);
                this.checkDataByCol(h, this.drawEndCol, d, g)
            }
        }
        if (g && g.length > 0) {
            this.lazyfireEvent(COM.widget.Grid.Event.DATA_LOAD_EVENT, {
                byRow: this.isLoadByRow(),
                list: g
            })
        }
    },
    calculateCellSize: function(m, h, b, o, d) {
        var a = 0;
        var n = 0;
        var g = 1;
        var l = 0;
        var c = 0;
        if (d) {
            d.x = 0;
            d.y = 0
        }
        if (m) {
            if (m.rowSpan > 1) {
                c = m.rowIndex + m.rowSpan;
                for (l = m.rowIndex; l < c; l++) {
                    if (d) {
                        if (l == o) {
                            d.y = n
                        }
                        if (this.isRowVisible(l)) {
                            n += h.rows[l].clientSize
                        }
                    } else {
                        if (this.isRowCanDraw(l)) {
                            n += h.rows[l].clientSize
                        }
                    }
                }
            } else {
                n = h.rows[o].clientSize
            }
            if (m.colSpan > 1) {
                c = m.colIndex + m.colSpan;
                for (l = m.colIndex; l < c; l++) {
                    if (d) {
                        if (l == b) {
                            d.x = a
                        }
                        if (this.isColVisible(l)) {
                            a += h.cols[l].clientSize
                        }
                    } else {
                        if (this.isColCanDraw(l)) {
                            a += h.cols[l].clientSize
                        }
                    }
                }
            } else {
                a = h.cols[b].clientSize
            }
        } else {
            a = h.cols[b].clientSize;
            n = h.rows[o].clientSize
        }
        return {
            width: a,
            height: n
        }
    },
    isRowCanDraw: function(a) {
        return this.isRowVisible(a) && this.isRowInDraw(a)
    },
    isRowInDraw: function(c, b, a) {
        return (c > 0 && c < this.data.rowHeaderCount) || (c >= this.drawStartRow && c <= this.drawEndRow) || (c >= this.data.rowCount - this.data.rowFooterCount && c < this.data.rowCount)
    },
    isColCanDraw: function(a) {
        return this.isColVisible(a) && this.isColInDraw(a)
    },
    isColInDraw: function(a) {
        return (a > 0 && a < this.data.colHeaderCount) || (a >= this.drawStartCol && a <= this.drawEndCol) || (a >= this.data.colCount - this.data.colFooterCount && a < this.data.colCount)
    },
    checkDataByRow: function(h, g, b, c) {
        var l = g;
        var a = null ;
        for (var d = g; d <= b; d++) {
            if (h[d] != null  && h[d + 1] == null ) {
                l = d + 1
            }
            if (h[d] == null  && (h[d + 1] != null  || d == b)) {
                a = d;
                c.push({
                    begin: l,
                    end: a
                })
            }
        }
    },
    checkDataByCol: function(h, g, b, c) {
        var m = g;
        var a = null ;
        var l = h[0];
        if (!l) {
            c.push({
                begin: g,
                end: b
            });
            return
        }
        for (var d = g; d < b; d++) {
            if (l[d] != null  && l[d + 1] == null ) {
                m = d + 1
            }
            if (l[d] == null  && (l[d + 1] != null  || d == b - 1)) {
                a = d;
                c.push({
                    begin: m,
                    end: a
                })
            }
        }
    },
    createFigureByModel: function(g, d, h) {
        if (g == null ) {
            var b = this.getCellFigurFactory().create(null );
            b.setBorderStyle([1, 1]);
            b.setBorderColor(["#D0D7E5", "#D0D7E5"]);
            b.setColorProvider(this.getColorProvider());
            b.setFontSize(12);
            return b
        }
        if (g.figure) {
            g.figure.setVisible(!g.merged);
            return g.figure
        }
        var a = this.getCellFigurFactory().create(g);
        a.treeListener = this;
        a.mergeChildProvider = this.getModel();
        if (d == 0 || h == 0) {
            if (this.selectionManager) {
                if (d == 0) {
                    if (this.selectionManager.hasSelectionInRow(h)) {
                        a.setSelected(true)
                    }
                } else {
                    if (this.selectionManager.hasSelectionInCol(d)) {
                        a.setSelected(true)
                    }
                }
            }
            if (this.cursorProvider && a) {
                if (d == 0) {
                    a.setCursor(this.cursorProvider.getRowHeadCursor())
                } else {
                    if (h == 0) {
                        a.setCursor(this.cursorProvider.getColHeadCursor())
                    }
                }
            }
        }
        a.setVisible(!g.merged);
        g.figure = a;
        a.model = g;
        a.addMouseMotionListener(this.cellMouseMotionListener);
        var c = this;
        a.addMouseListener(this.cellMouseListener);
        a.addListener("ControlResizeListener", this);
        a.addListener("ControlArrivedListener", this);
        return a
    },
    controlArrived: function(a) {
        var b = this.getCellController(a.getCol(), a.getRow());
        this.fireControlArrived(b)
    },
    fireControlArrived: function(a) {
        this.fireEvent(COM.widget.Grid.Event.CONTROL_ARRIVED, {
            cell: a
        })
    },
    controlResized: function(c, g, b) {
        var d = this.getCellController(c.getCol(), c.getRow());
        var a = {
            doit: 1
        };
        this.fireEvent(COM.widget.Grid.Event.CONTROL_RESIZE, {
            cell: d,
            size: {
                width: g,
                height: b
            },
            result: a
        });
        if (a.doit) {
            c.setControlSize(g, b)
        }
    },
    getCellFigurFactory: function() {
        return this.getModel().getCellFigureFactory()
    },
    createEditPolicies: function() {
        this.installEditPolicy("resize", new COM.widget.Grid.GridPolicy());
        this.installEditPolicy("colExchange", new COM.widget.Grid.ColExchangePolicy());
        this.installEditPolicy("selection", new COM.widget.Grid.SelectionPolicy());
        this.installEditPolicy("selectionChange", new COM.widget.Grid.SelectionChangePolicy())
    },
    getCellFigureByLocation: function(a, b) {
        return this.getFigure().getCellFigureByLocation(a, b)
    },
    getColRow: function(a, b) {
        return this.getFigure().getColRow(a, b)
    },
    getCellFigure: function(b, d) {
        var c = this.getRealColRow(b, d);
        var a = this.getCell(c.col, c.row);
        if (a != null  && a.merge) {
            a = this.getCell(a.mergeInfo.col, a.mergeInfo.row)
        }
        return a.figure
    },
    getRealColRow: function(h, g) {
        var a;
        var n;
        var c = -1;
        var l = this.data.cols;
        var o = this.data.rows;
        var m = 0;
        var b = this.areaWidths;
        var d = this.areaHeights;
        if (h < b[0]) {
            while (m < h && c < this.data.colHeaderCount) {
                if (!l[++c].hidden) {
                    m += l[c].clientSize
                }
            }
            a = c
        } else {
            if (h < b[0] + b[1]) {
                m = this.getStartX();
                c = this.drawStartCol - 1;
                while (m < h && c < this.drawEndCol) {
                    if (!l[++c].hidden) {
                        m += l[c].clientSize
                    }
                }
                a = c
            } else {
                if (m < b[0] + b[1] + b[2]) {
                    m = b[0] + b[1];
                    c = this.footerStartCol - 1;
                    while (m < h && c < this.data.colCount) {
                        if (!l[++c].hidden) {
                            m += l[c].clientSize
                        }
                    }
                    a = c
                }
            }
        }
        m = 0;
        c = -1;
        if (g < d[0]) {
            while (m < g && c < this.data.rowHeaderCount) {
                if (!o[++c].hidden) {
                    m += o[c].clientSize
                }
            }
            n = c
        } else {
            if (g < d[0] + d[1]) {
                m = this.getStartY();
                c = this.drawStartRow - 1;
                while (m < g && c < this.drawEndRow) {
                    if (!o[++c].hidden) {
                        m += o[c].clientSize
                    }
                }
                n = c
            } else {
                if (m < d[0] + d[1] + d[2]) {
                    m = d[0] + d[1];
                    c = this.footerStartRow - 1;
                    while (m < g && c < this.data.rowCount) {
                        if (!o[++c].hidden) {
                            m += o[c].clientSize
                        }
                    }
                    n = c
                }
            }
        }
        return {
            col: a,
            row: n
        }
    },
    getRealCellBounds: function(c, l) {
        var b;
        var m;
        var h = this.data.cols;
        var g = this.data.rows;
        var d = h[c].clientSize;
        var a = g[l].clientSize;
        if (!this.isColVisible(c)) {
            d = 0
        }
        if (!this.isRowVisible(l)) {
            a = 0
        }
        b = this.getRealColBegin(c);
        m = this.getRealRowBegin(l);
        return new Rectangle(b,m,d,a)
    },
    getStartX: function() {
        return this.areaWidths[0] - this.offsetX
    },
    getStartY: function() {
        return this.areaHeights[0] - this.offsetY
    },
    getRealColBegin: function(c) {
        var d = 0;
        var a = 0;
        var l = this.data.cols;
        var g = l[c].clientSize;
        var h = this.areaWidths;
        var b = 0;
        if (c < this.data.colHeaderCount) {
            d = 0;
            while (d < c) {
                if (!l[d].hidden) {
                    b += l[d].clientSize
                }
                d++
            }
            a = b
        } else {
            if (c < this.drawStartCol) {
                b = this.getStartX();
                d = this.drawStartCol - 1;
                while (d >= c) {
                    if (!l[d].hidden) {
                        b -= l[d].clientSize
                    }
                    d--
                }
                a = b
            } else {
                if (c < this.footerStartCol) {
                    b = this.getStartX();
                    d = this.drawStartCol;
                    while (d < c) {
                        if (!l[d].hidden) {
                            b += l[d].clientSize
                        }
                        d++
                    }
                    a = b
                } else {
                    if (c < this.data.colCount) {
                        b = h[0] + h[1];
                        d = this.footerStartCol;
                        while (d < c) {
                            if (!l[d].hidden) {
                                b += l[d].clientSize
                            }
                            d++
                        }
                        a = b
                    } else {
                        a = 0
                    }
                }
            }
        }
        return a
    },
    getRealRowBegin: function(h) {
        var c = 0;
        var l = 0;
        var b = 0;
        var g = this.data.rows;
        var a = g[h].clientSize;
        var d = this.areaHeights;
        if (h < this.data.rowHeaderCount) {
            c = 0;
            while (c < h) {
                if (!g[c].hidden) {
                    b += g[c].clientSize
                }
                c++
            }
            l = b
        } else {
            if (h < this.drawStartRow) {
                b = this.getStartY();
                c = this.drawStartRow - 1;
                while (c >= h) {
                    if (!g[c].hidden) {
                        b -= g[c].clientSize
                    }
                    c--
                }
                l = b
            } else {
                if (h < this.footerStartRow) {
                    b = this.getStartY();
                    c = this.drawStartRow;
                    while (c < h) {
                        if (!g[c].hidden) {
                            b += g[c].clientSize
                        }
                        c++
                    }
                    l = b
                } else {
                    if (h < this.data.rowCount) {
                        b = d[0] + d[1];
                        c = this.footerStartRow;
                        while (c < h) {
                            if (!g[c].hidden) {
                                b += g[c].clientSize
                            }
                            c++
                        }
                        l = b
                    } else {
                        l = 0
                    }
                }
            }
        }
        return l
    },
    getCurrentCell: function() {
        var a = this.getCellController(this.currentCellCol, this.currentCellRow);
        return a
    },
    getCurrentCellColRow: function() {
        var a = {
            col: this.currentCellCol,
            row: this.currentCellRow
        };
        return a
    },
    setCurrentCell: function(c, m, l, h, g, d) {
        if (c == null  || c >= this.data.colCount) {
            c = -1
        }
        if (m == null  || m >= this.data.rowCount) {
            m = -1
        }
        if (this.currentCellCol === c && this.currentCellRow === m) {
            if (c >= 0 && m >= 0) {
                if (!g) {
                    this.reval(c, m)
                } else {
                    this.revalTimeout = setTimeout(this.getLazyReval(), 400)
                }
            }
            if (b(this.currentCellCol, this.currentCellRow, this.getModel())) {
                return true
            } else {
                return
            }
        }
        function b(o, q, p) {
            if (o > -1 && q > -1) {
                var n = p.getCell(o, q);
                if (null  != n) {
                    return n.cellMode == COM.widget.Grid.Cell.Cell_MODE_NORMAL
                }
            }
        }
        if (!l.noFireChanging) {
            var a = {};
            a.doit = COM.widget.Grid.RESULT_TRUE;
            this.fireEvent(COM.widget.Grid.Event.CURRENT_CELL_CHANGING, {
                col: c,
                row: m,
                result: a,
                cause: l
            });
            if (a.doit != COM.widget.Grid.RESULT_TRUE) {
                return false
            }
        }
        l.noFireChanging = null ;
        if (this.isEditing()) {
            this.commitEdit(l ? l.type : null )
        }
        Debugger.log("set Current Cell: " + c + "," + m);
        this.goNextMemery = h;
        if (c >= 0 && m >= 0) {
            if (!g) {
                this.reval(c, m)
            } else {
                this.revalTimeout = setTimeout(this.getLazyReval(), 400)
            }
        }
        this.performSetCurrentCell(c, m);
        this.clearInputCache();
        this.fireEvent(COM.widget.Grid.Event.CURRENT_CELL_CHANGED, {
            col: (c == null  ? -1 : c),
            row: (m == null  ? -1 : m),
            cause: l
        });
        this.focus();
        return true
    },
    clearInputCache: function() {
        var a = this.getFocusReceiver();
        a.clearValue()
    },
    getLazyReval: function() {
        var a = this;
        return function() {
            a.reval(a.currentCellCol, a.currentCellRow);
            a.revalTimeout = null 
        }
    },
    setCurrentCellWidthDataCheck: function(c, g, d) {
        var a = this.getCell(c, g);
        if (a) {
            if (a.merged) {
                c = a.mergeInfo.col;
                g = a.mergeInfo.row;
                a = this.getCell(c, g)
            }
        }
        var b = this;
        if (a) {
            this.setCurrentCell(c, g, d);
            return true
        } else {
            if (c > 0 && g > 0 && c < this.getModel().getColCount() && g < this.getModel().getRowCount()) {
                this.getModel().addTingsToDoAtferLoad("setCurrentCell", function() {
                    var h = b.getCell(c, g);
                    if (h) {
                        return b.setCurrentCellWidthDataCheck(c, g, d)
                    }
                    return false
                });
                this.loadRect(c, g, 1, 1, this.data, true)
            }
            return false
        }
    },
    loadRect: function(m, l, c, a, h, b) {
        var g = [];
        m = Math.max(0, m);
        c = Math.min(this.getModel().getColCount() - m, c);
        l = Math.max(0, l);
        a = Math.min(this.getModel().getRowCount() - l, a);
        var d = h.cells.rowList;
        if (this.isLoadByRow()) {
            this.checkDataByRow(d, l, l + a - 1, g)
        } else {
            this.checkDataByCol(d, m, m + c - 1, g)
        }
        if (g && g.length > 0) {
            if (b) {
                this.lazyfireEvent(COM.widget.Grid.Event.DATA_LOAD_EVENT, {
                    byRow: this.isLoadByRow(),
                    list: g
                })
            } else {
                this.fireEvent(COM.widget.Grid.Event.DATA_LOAD_EVENT, {
                    byRow: this.isLoadByRow(),
                    list: g
                })
            }
        }
    },
    performSetCurrentCell: function(c, g) {
        this.clearCurrentCell();
        var b = this.getCell(c, g);
        var d = 1;
        var a = 1;
        if (b) {
            d = b.colSpan || 1;
            a = b.rowSpan || 1
        }
        this.currentCellCol = c;
        this.currentCellRow = g;
        this.selectionManager.setCurrentCell(c, g, d, a)
    },
    clearCurrentCell: function() {},
    select: function(a, b) {
        this.selectionManager.select(a, b)
    },
    clearSelection: function() {
        this.selectionManager.clearSelection()
    },
    setSelections: function(a, b) {
        this.selectionManager.setSelections(a, b)
    },
    setSelectionsWidthDataCheck: function(a, d) {
        var c = this.data.cells.rowList;
        var b = this;
        if (c.length > 0) {
            this.selectionManager.setSelections(a, d)
        } else {
            this.getModel().addTingsToDoAtferLoad("setSelections", function() {
                b.selectionManager.setSelections(a, d);
                return true
            })
        }
    },
    setSelection: function(a, b) {
        this.selectionManager.setSelection(a, b)
    },
    addSelection: function(a, b) {
        this.selectionManager.addSelection(a, b)
    },
    getSelections: function() {
        return this.selectionManager.getSelections()
    },
    getSelection: function() {
        return this.selectionManager.getSelection()
    },
    getSelectionCols: function() {
        return this.selectionManager.getSelectionCols()
    },
    getSelectionRows: function() {
        return this.selectionManager.getSelectionRows()
    },
    getSelectionCols: function() {
        return this.selectionManager.getSelectionCols()
    },
    getSelectionRows: function() {
        return this.selectionManager.getSelectionRows()
    },
    focus: function() {
        if (!this.canFocus()) {
            return
        }
        if (this.selectionManager.currentFigure) {
            if (!this.selectionManager.currentFigure.focus) {
                this.selectionManager.currentFigure.focus = true;
                this.selectionManager.currentFigure.repaint()
            }
        }
        if (Util.browser.isMobile) {
            return
        }
        this.focusReceiver.focus()
    },
    blur: function() {
        if (this.selectionManager.currentFigure) {
            if (this.selectionManager.currentFigure.focus) {
                this.selectionManager.currentFigure.focus = false;
                this.selectionManager.currentFigure.repaint()
            }
        }
        this.focusReceiver.blur()
    },
    getSelectionColor: function() {
        return this.getModel().getSelectionColor()
    },
    getCol: function(a) {
        return this.getModel().data.cols[a]
    },
    getRow: function(a) {
        return this.getModel().data.rows[a]
    },
    getCell: function(a, b) {
        return this.getModel().getCell(a, b)
    },
    getCellController: function(a, b) {
        return this.getModel().getCellController(a, b)
    },
    showSelectionHandle: function() {
        if (this.isActive()) {
            for (var a = 1; a < this.policies.length; a += 2) {
                if (this.policies[a].showSelection) {
                    this.policies[a].showSelection()
                }
            }
        }
        this.selectionHandleShowing = true
    },
    eraseSelectionHandle: function() {
        if (this.isActive()) {
            for (var a = 1; a < this.policies.length; a += 2) {
                if (this.policies[a].hideSelection) {
                    this.policies[a].hideSelection()
                }
            }
        }
        this.selectionHandleShowing = false
    },
    getCellAreaBounds: function(b, o) {
        if (this.isDisposed()) {
            throw "you cant call adiposed editpart!"
        }
        var D = this.getModel().data;
        var C = this.getFigure();
        var w = b;
        var B = w.x;
        var a = w.y;
        var t = w.right() - 1;
        var u = w.bottom() - 1;
        if (t < 0) {
            t == D.colCount
        }
        if (u < 0) {
            u == D.rowCount
        }
        var r = 0;
        var d = 0;
        var z = 0;
        var m = 0;
        var g = 0;
        var A = 0;
        var p = 0;
        var s = 0;
        var l = null ;
        var q = null ;
        var c = D.colCount - D.colFooterCount;
        var h = D.rowCount - D.rowFooterCount;
        var n = this.areaWidths;
        var v = this.areaHeights;
        l = this.getRealCellBounds(B, a);
        if (B >= D.colHeaderCount && B < this.drawStartCol) {
            d = n[0] - 10;
            A = n[0]
        } else {
            if (B == this.drawStartCol) {
                d = l.x;
                A = n[0]
            } else {
                if (B > this.drawEndCol && B < this.footerStartCol) {
                    d = n[0] + n[1] - 10;
                    A = n[0] + n[1]
                } else {
                    d = l.x;
                    A = l.x
                }
            }
        }
        if (a >= D.rowHeaderCount && a < this.drawStartRow) {
            r = v[0] - 10;
            g = v[0]
        } else {
            if (a == this.drawStartRow) {
                r = l.y;
                g = v[0]
            } else {
                if (a > this.drawEndRow && a < this.footerStartRow) {
                    r = v[0] + v[1] - 10;
                    g = v[0] + v[1]
                } else {
                    r = l.y;
                    g = l.y
                }
            }
        }
        l = this.getRealCellBounds(t, u);
        if (t >= D.colHeaderCount && t < this.drawStartCol) {
            z = n[0] + 10;
            p = n[0]
        } else {
            if (t > this.drawEndCol && t < this.footerStartCol) {
                z = n[0] + n[1] + 10;
                p = n[0] + n[1]
            } else {
                z = l.right();
                if (t < this.footerStartCol) {
                    p = Math.min(z, n[0] + n[1])
                } else {
                    p = z
                }
            }
        }
        if (u >= D.rowHeaderCount && u < this.drawStartRow) {
            m = v[0] + 10;
            s = v[0]
        } else {
            if (u > this.drawEndRow && u < this.footerStartRow) {
                m = v[0] + v[1] + 10;
                s = v[0] + v[1]
            } else {
                m = l.bottom();
                if (u < this.footerStartRow) {
                    s = Math.min(m, v[0] + v[1])
                } else {
                    s = m
                }
            }
        }
        o.x = d;
        o.y = r;
        o.width = z - d;
        o.height = m - r;
        l = new Rectangle();
        l.x = A;
        l.y = g;
        l.width = p - A;
        l.height = s - g;
        return l
    },
    getSelectionBounds: function(p, c) {
        var E = this.getModel().data;
        var D = this.getFigure();
        var z = c || this.getSelections()[0];
        var C = z.x;
        var a = z.y;
        var u = z.right() - 1;
        var v = z.bottom() - 1;
        if (u < 0) {
            u == E.colCount
        }
        if (v < 0) {
            v == E.rowCount
        }
        var s = 0;
        var g = 0;
        var A = 0;
        var n = 0;
        var h = 0;
        var B = 0;
        var q = 0;
        var t = 0;
        var m = null ;
        var r = null ;
        var d = E.colCount - E.colFooterCount;
        var l = E.rowCount - E.rowFooterCount;
        var o = this.areaWidths;
        var w = this.areaHeights;
        var b = this.getCell(C, a);
        if (b != null ) {
            D = b.figure
        }
        if (D == null ) {
            m = new Rectangle()
        } else {
            m = D.getBounds().getCopy();
            D.translateToAbsolute(m)
        }
        if (C >= E.colHeaderCount && C <= this.drawStartCol) {
            g = o[0] - 10;
            B = o[0]
        } else {
            if (C > this.drawEndCol && C < this.footerStartCol) {
                g = o[0] + o[1] - 10;
                B = o[0] + o[1]
            } else {
                g = m.x;
                B = m.x
            }
        }
        if (a >= E.rowHeaderCount && a <= this.drawStartRow) {
            s = w[0] - 10;
            h = w[0]
        } else {
            if (a > this.drawEndRow && a < this.footerStartRow) {
                s = w[0] + w[1] - 10;
                h = w[0] + w[1]
            } else {
                s = m.y;
                h = m.y
            }
        }
        b = this.getCell(u, v);
        D = null ;
        if (b && b.merged) {
            b = this.getCell(b.mergeInfo.col, b.mergeInfo.row)
        }
        if (b) {
            D = b.figure;
            m = D.getBounds().getCopy();
            D.translateToAbsolute(m)
        }
        if (u >= E.colHeaderCount && u < this.drawStartCol) {
            A = o[0] + 10;
            q = o[0]
        } else {
            if (u > this.drawEndCol && u < this.footerStartCol) {
                A = o[0] + o[1] + 10;
                q = o[0] + o[1]
            } else {
                A = m.right();
                if (u < this.footerStartCol) {
                    q = Math.min(A, o[0] + o[1])
                } else {
                    q = A
                }
            }
        }
        if (v >= E.rowHeaderCount && v < this.drawStartRow) {
            n = w[0] + 10;
            t = w[0]
        } else {
            if (v > this.drawEndRow && v < this.footerStartRow) {
                n = w[0] + w[1] + 10;
                t = w[0] + w[1]
            } else {
                n = m.bottom();
                if (v < this.footerStartRow) {
                    t = Math.min(n, w[0] + w[1])
                } else {
                    t = n
                }
            }
        }
        p.x = g;
        p.y = s;
        p.width = A - g;
        p.height = n - s;
        m = new Rectangle();
        m.x = B;
        m.y = h;
        m.width = q - B;
        m.height = t - h;
        return m
    },
    editCurrentCell: function(b) {
        if (this.getEditMode() == COM.widget.Grid.EDIT_MODE_READ_ONLY) {
            return
        }
        if (this.isEditing()) {
            return
        }
        if (this.currentCellCol > 0 && this.currentCellRow > 0) {
            this.reval(this.currentCellCol, this.currentCellRow);
            var n = this.getCell(this.currentCellCol, this.currentCellRow);
            var m = this.getCellController(this.currentCellCol, this.currentCellRow);
            if (!n || (!n.editable && this.getEditMode() != COM.widget.Grid.EDIT_MODE_EDIT) || n.cellMode == COM.widget.Grid.Cell.Cell_MODE_CONTROL || n.cellMode == COM.widget.Grid.Cell.Cell_MODE_HTML) {
                return
            }
            var d;
            var h;
            var a;
            var o = {
                doit: 1,
                add: 1
            };
            if ((n.editorId == null  || "" == n.editorId) && n.editor == null ) {
                n.editorId = this.getModel().getDefaultEditorId();
                n.editor = this.getModel().getDefaultEditor()
            }
            var l = this.getZIndex(this.currentCellCol, this.currentCellRow);
            var g = this.getViewer().getEditDomain().getControl();
            this.fireEvent(COM.widget.Grid.Event.EDITOR_OPEN, {
                cell: m,
                cause: b,
                result: o,
                zIndex: l,
                editorParent: g
            });
            this.clearInputCache();
            h = n.editor;
            if (!h) {
                h = this.getDefaultEditor()
            }
            if (o.doit) {
                if (n.editText != null ) {
                    h.value = n.editText
                } else {
                    h.value = null 
                }
            }
            if (o.add) {
                h.style.zIndex = l;
                g.appendChild(h);
                this.fireControlArrived(m)
            }
            this.activeEditorId = n.editorId;
            this.activeEditor = h;
            this.editCol = this.currentCellCol;
            this.editRow = this.currentCellRow;
            this.editing = true;
            a = n.figure.getBounds().getCopy();
            n.figure.translateToAbsolute(a);
            o = {
                doit: 1
            };
            this.fireEvent(COM.widget.Grid.Event.EDITOR_LOCATE, {
                cell: m,
                result: o,
                location: {
                    x: a.x,
                    y: a.y
                }
            });
            if (o.doit) {
                h.style.top = a.y + "px";
                h.style.left = a.x + "px"
            }
            n.figure.addFigureListener(this);
            o = {
                doit: 1
            };
            this.fireEvent(COM.widget.Grid.Event.EDITOR_RESIZE, {
                cell: m,
                result: o,
                size: {
                    width: a.width,
                    height: a.height
                }
            });
            if (o.doit) {
                h.style.width = a.width - 1 + "px";
                h.style.height = a.height - 3 + "px"
            }
            this.eraseSelectionHandle();
            var c = this.showEditor(m, h, b);
            if (c == true) {
                n.figure.setText("")
            }
        }
    },
    resizeEditor: function() {
        if (this.isEditing()) {
            var c = this.getCurrentCell();
            var b = {
                doit: 1
            };
            var a = this.getCell(this.currentCellCol, this.currentCellRow);
            var g = a.figure.getBounds().getCopy();
            this.fireEvent(COM.widget.Grid.Event.EDITOR_RESIZE, {
                cell: c,
                result: b,
                size: {
                    width: g.width,
                    height: g.height
                }
            });
            if (b.doit) {
                var d = this.activeEditor;
                d.style.width = g.width - 1 + "px";
                d.style.height = g.height - 3 + "px"
            }
        }
    },
    canEdit: function(a) {
        if (!a || (this.getEditMode() === COM.widget.Grid.EDIT_MODE_READ_ONLY) || (!a.editable && this.getEditMode() != COM.widget.Grid.EDIT_MODE_EDIT) || a.cellMode == COM.widget.Grid.Cell.Cell_MODE_CONTROL || a.cellMode == COM.widget.Grid.Cell.Cell_MODE_HTML) {
            return false
        }
        return true
    },
    figureMoved: function(c) {
        if (this.currentCellCol != null  && this.currentCellRow != null ) {
            var h = this.getModel().data;
            var b = this.getCell(this.currentCellCol, this.currentCellRow);
            var g = this.getCellController(this.currentCellCol, this.currentCellRow);
            var d = c.getLocation();
            c.translateToAbsolute(d);
            var a = {
                doit: 1
            };
            this.fireEvent(COM.widget.Grid.Event.EDITOR_LOCATE, {
                cell: g,
                result: a,
                location: {
                    x: d.x,
                    y: d.y
                }
            });
            if (a.doit) {
                this.getActiveEditor().style.top = d.y + "px";
                this.getActiveEditor().style.left = d.x + "px"
            }
        }
    },
    getActiveEditorId: function() {
        return this.activeEditorId
    },
    getActiveEditor: function() {
        return this.activeEditor
    },
    tryCommitEdit: function(a) {
        if (this.isEditing()) {
            this.commitEdit(a)
        }
    },
    commitEdit: function(b) {
        if (this.editCol > 0 && this.editRow > 0 && this.activeEditor) {
            var n = this.getCell(this.editCol, this.editRow);
            var m = this.getCellController(this.editCol, this.editRow);
            var d;
            var a;
            var o = {
                doit: 1
            };
            n.figure.removeFigureListener(this);
            this.hideEditor(m, this.activeEditor, b);
            o = {
                doit: 1
            };
            this.fireEvent(COM.widget.Grid.Event.EDITOR_CLOSE, {
                cell: m,
                result: o,
                cause: b
            });
            if (o.doit) {
                m.setEditText(this.activeEditor.value);
                m.setShowText(this.activeEditor.value)
            }
            this.activeEditorId = null ;
            this.activeEditor = null ;
            var g = this.getRow(this.editRow);
            var l = false;
            var h = false;
            if (g.auto) {
                l = this.getModel().calculateRowSize(this.editRow)
            }
            var c = this.getCol(this.editCol);
            if (c.auto) {
                h = this.getModel().calculateColSize(this.editCol)
            }
            if (l || h) {
                this.freshScrollPlaceHolderSize();
                this.refreshVisuals_scroll()
            }
            var b = COM.widget.Grid.CAUSE_INPUT;
            this.fireEvent(COM.widget.Grid.Event.DATA_CHANGE, {
                rect: {
                    x: this.editCol,
                    y: this.editRow,
                    width: 1,
                    height: 1
                },
                cause: b
            })
        }
        this.editing = false
    },
    isEditing: function() {
        return this.editing
    },
    getDefaultEditor: function() {
        if (this.defaultEditor == null ) {
            var b = document.createElement("input");
            b.id = "gridtexteditor";
            b.style.overflow = "hidden";
            b.style.visibility = "hidden";
            b.style.textAlign = "left";
            b.style.position = "absolute";
            b.style.borderStyle = "none";
            b.style.zIndex = 10;
            var a = this;
            COM.Util.EventRegister.addEvent(b, "keydown", function(d) {
                var c = d.keyCode || d.which || d.charCode;
                if (c == 13) {
                    a.performKeyEnter()
                }
            });
            this.defaultEditor = b
        }
        return this.defaultEditor
    },
    setEditorVisible: function(g, d) {
        var b = this.getActiveEditor();
        if (!b) {
            return
        }
        var a = this.getCell(this.currentCellCol, this.currentCellRow);
        if (!g) {
            b.style.left = "-10000px";
            this.editorHide = true
        } else {
            if (a.figure) {
                var c = a.figure.getBounds();
                a.figure.translateToAbsolute(c);
                b.style.left = c.x + "px"
            }
            this.editorHide = false
        }
    },
    hideEditor: function(b, c, d) {
        var a = {
            doit: 1
        };
        this.fireEvent(COM.widget.Grid.Event.EDITOR_HIDE, {
            cell: b,
            result: a,
            cause: d
        });
        if (a.doit) {
            c.style.visibility = "hidden"
        }
        this.editorHide = true
    },
    showEditor: function(b, c, d) {
        var a = {
            doit: 1,
            clearShow: 1
        };
        this.fireEvent(COM.widget.Grid.Event.EDITOR_SHOW, {
            cell: b,
            result: a,
            cause: d
        });
        if (a.doit) {
            c.style.visibility = "visible";
            c.focus()
        }
        this.editorHide = false;
        return a.clearShow
    },
    fireEvent: function(a, b) {
        if (this.getModel().grid) {
            this.getModel().grid.fireEvent(a, b)
        }
    },
    lazyfireEvent: function(b, c) {
        if (this.timer) {
            clearTimeout(this.timer)
        }
        var a = this.getModel().grid;
        this.timer = setTimeout(function() {
            a.fireEvent(b, c)
        }, 100)
    },
    onExpandClicked: function(d, h, g) {
        this.setCurrentCell(d, h, {
            type: COM.widget.Grid.CAUSE_MOUSE,
            value: g.button
        });
        this.select(new Rectangle(d,h,1,1));
        var a = this.getCell(d, h);
        var b = this.getCellController(d, h);
        var c = g ? g.e : null ;
        if (a.expanded) {
            this.fireEvent(COM.widget.Grid.Event.CELL_COLLAPSE, {
                cell: b,
                origin: c
            })
        } else {
            this.fireEvent(COM.widget.Grid.Event.CELL_EXPAND, {
                cell: b,
                origin: c
            })
        }
    },
    onCheckStateChanged: function(c, h, d, g) {
        this.setCurrentCell(c, h, {
            type: COM.widget.Grid.CAUSE_MOUSE
        });
        this.select(new Rectangle(c,h,1,1));
        var a = this.getCell(c, h);
        a.checked = d;
        var b = this.getCellController(c, h);
        this.fireEvent(COM.widget.Grid.Event.CELL_CHECKED, {
            cell: b,
            checked: d,
            origin: g
        })
    },
    isHeader: function(a, c) {
        var b = this.getModel().data;
        return a < b.colHeaderCount || c < b.rowHeaderCount
    },
    isFooter: function(a, c) {
        var b = this.getModel().data;
        return a > b.colCount - b.colFooterCount || c > b.rowCount - b.rowFooterCount
    },
    showColExchangeFeedBack: function(b, c, d) {
        if (this.isActive()) {
            for (var a = 1; a < this.policies.length; a += 2) {
                if (this.policies[a].showColExchangeFeedBack) {
                    this.policies[a].showColExchangeFeedBack(b, c, d)
                }
            }
        }
    },
    goNext: function(a, g) {
        var c = g;
        if (null  == c) {
            c = this.getModel().isPassReadOnly()
        }
        var h = this.calculateNext(a, this.currentCellCol, this.currentCellRow, c);
        if (h == null ) {
            return
        }
        var b = h.col;
        var l = h.row;
        cell = this.getCell(b, l);
        if (cell.merged) {
            var d = {};
            d.col = b;
            d.row = l;
            b = cell.mergeInfo.col;
            l = cell.mergeInfo.row
        }
        this.setCurrentCell(b, l, {
            type: COM.widget.Grid.CAUSE_KEY
        }, d);
        this.select(new Rectangle(b,l,1,1));
        this.fireEvent(COM.widget.Grid.Event.SELECTION)
    },
    calculateNext: function(c, b, g, h) {
        var d = b;
        var l = g;
        var a = this.getCell(d, l);
        if (c == null ) {
            c = this.getModel().getEnterNext()
        }
        switch (c) {
        case COM.widget.Grid.ENTER_NEXT_UP:
            if (this.goNextMemery) {
                d = this.goNextMemery.col
            }
            do {
                if (l <= 1) {
                    if (d <= 1) {
                        return
                    }
                    this.setScrollTop(this.getScrollHeight());
                    l = this.data.rowCount - 1;
                    do {
                        d--
                    } while (d > 1 && !this.isColVisible(d));this._scrollAfterGoLeft(d, l)
                } else {
                    l--
                }
                a = this.getCell(d, l);
                if (a.merged) {
                    l = a.mergeInfo.row;
                    a = this.getCell(a.mergeInfo.col, a.mergeInfo.row)
                }
            } while (!a.selectable || (!a.editable && h) || !this.isRowVisible(l));this._scrollAfterGoUp(d, l);
            break;
        case COM.widget.Grid.ENTER_NEXT_LEFT:
            if (this.goNextMemery) {
                l = this.goNextMemery.row
            }
            do {
                if (d <= 1) {
                    if (l <= 1) {
                        return
                    }
                    this.setScrollLeft(this.getScrollWidth());
                    d = this.data.colCount - 1;
                    do {
                        l--
                    } while (l > 1 && !this.isRowVisible(l));this._scrollAfterGoUp(d, l)
                } else {
                    d--
                }
                a = this.getCell(d, l);
                if (a.merged) {
                    d = a.mergeInfo.col;
                    a = this.getCell(a.mergeInfo.col, a.mergeInfo.row)
                }
            } while (!a.selectable || (!a.editable && h) || !this.isColVisible(d));this._scrollAfterGoLeft(d, l);
            break;
        case COM.widget.Grid.ENTER_NEXT_DOWN:
            if (this.goNextMemery) {
                d = this.goNextMemery.col
            }
            do {
                l = l + (a.rowSpan || 1);
                if (l >= this.data.rowCount) {
                    l = 1;
                    do {
                        d++
                    } while (d < this.data.colCount && !this.isColVisible(d));if (d >= this.data.colCount) {
                        return
                    }
                    this.setScrollTop(0);
                    this._scrollAfterGoRight(d, l)
                }
                a = this.getCell(d, l);
                if (a.merged) {
                    a = this.getCell(a.mergeInfo.col, a.mergeInfo.row)
                }
            } while (!a.selectable || (!a.editable && h) || !this.isRowVisible(l));this._scrollAfterGoDown(d, l);
            break;
        case COM.widget.Grid.ENTER_NEXT_RIGHT:
            if (this.goNextMemery) {
                l = this.goNextMemery.row
            }
            do {
                d = d + (a.colSpan || 1);
                if (d >= this.data.colCount) {
                    d = 1;
                    do {
                        l++
                    } while (l < this.data.rowCount && !this.isRowVisible(l));if (l >= this.data.rowCount) {
                        return
                    }
                    this.setScrollLeft(0);
                    this._scrollAfterGoDown(d, l)
                }
                a = this.getCell(d, l);
                if (a.merged) {
                    a = this.getCell(a.mergeInfo.col, a.mergeInfo.row)
                }
            } while (!a.selectable || (!a.editable && h) || !this.isColVisible(d));this._scrollAfterGoRight(d, l);
            break;
        case COM.widget.Grid.ENTER_NEXT_NONE:
        default:
            return null 
        }
        return {
            col: d,
            row: l
        }
    },
    _scrollAfterGoUp: function(a, b) {
        if (b < this.drawStartRow && b >= this.data.rowHeaderCount) {
            this.scrollVerti(false, this.drawStartRow - b)
        } else {
            if (b < this.footerStartRow && b >= this.drawEndRow) {
                this.setScrollTop(this.getScrollHeight())
            }
        }
    },
    _scrollAfterGoDown: function(a, b) {
        if (b < this.footerStartRow && b >= this.drawEndRow) {
            this.scrollVerti(true, b - this.drawEndRow + 1)
        } else {
            if (b < this.drawStartRow && b >= this.data.rowHeaderCount) {
                this.setScrollTop(0)
            }
        }
    },
    _scrollAfterGoLeft: function(a, b) {
        if (a < this.drawStartCol && a >= this.data.colHeaderCount) {
            this.scrollHoriz(false, this.drawStartCol - a)
        } else {
            if (a < this.footerStartCol && a >= this.drawEndCol) {
                this.setScrollLeft(this.getScrollWidth())
            }
        }
    },
    _scrollAfterGoRight: function(a, b) {
        if (a <= this.footerStartCol && a >= this.drawEndCol) {
            this.scrollHoriz(true, a - this.drawEndCol + 1)
        } else {
            if (a < this.drawStartCol && a >= this.data.colHeaderCount) {
                this.setScrollLeft(0)
            }
        }
    },
    isVliadColRow: function(a, b) {
        if (a < 0 || b < 0) {
            return false
        }
        if (a >= this.data.colCount || b >= this.data.rowCount) {
            return false
        }
        return true
    },
    reval: function(g, n) {
        if (!this.isVliadColRow(g, n)) {
            return
        }
        var v = this.defalutDoOnScroll;
        this.defalutDoOnScroll = function() {}
        ;
        var b = this.getCell(g, n);
        var E;
        var F;
        if (b) {
            if (b.merged) {
                g = b.mergeInfo.col;
                n = b.mergeInfo.row;
                b = this.getCell(g, n);
                if (null  == b) {
                    this.reval(g, n);
                    return
                }
                E = {
                    rowSpan: b.rowSpan,
                    colSpan: b.colSpan
                }
            }
        } else {
            var C = this.data.mergeCells;
            var l;
            var u;
            for (F = 0; F < C.length; F++) {
                l = C[F];
                if ((l.col == g && l.row == n) || ((g >= l.col && g < l.col + l.width) && (n >= l.row && n < l.row + l.height))) {
                    u = l;
                    break
                }
            }
            if (u) {
                g = u.col;
                n = u.row;
                E = {
                    rowSpan: u.height,
                    colSpan: u.width
                }
            } else {
                E = {
                    rowSpan: 1,
                    colSpan: 1
                }
            }
        }
        var o;
        if (b && b.figure && b.figure.getParent() == this.getFigure()) {
            o = b.figure.getBounds()
        } else {
            var r = this.getRealColBegin(g);
            var q = this.getRealRowBegin(n);
            var A = null ;
            var D = {
                cols: this.data.cols,
                rows: this.data.rows
            };
            if (b) {
                A = this.calculateCellSize(b, D, g, n)
            } else {
                A = {
                    width: 0,
                    height: 0
                };
                for (F = g,
                max = g + E.colSpan; F < max; F++) {
                    if (this.isColVisible(g)) {
                        A.width += D.cols[F].clientSize
                    }
                }
                for (F = n,
                max = n + E.rowSpan; F < max; F++) {
                    if (this.isRowVisible(n)) {
                        A.height += D.rows[F].clientSize
                    }
                }
            }
            o = new Rectangle(r,q,A.width,A.height)
        }
        var s = this.areaWidths;
        var H = this.areaHeights;
        var d = s[0] + s[1];
        var p = H[0] + H[1];
        var a = -1;
        var c = -1;
        if (o.x < s[0] && g >= this.data.colHeaderCount) {
            a = g
        } else {
            if (o.right() > d && g < this.footerStartCol) {
                if (this.drawStartCol < g) {
                    var B = this.areaWidths[1];
                    var t = 0;
                    for (var m = g; m >= this.data.colHeaderCount; m--) {
                        if (!this.data.cols[m].hidden) {
                            t += this.data.cols[m].clientSize
                        }
                        if (t > B) {
                            m++;
                            break
                        }
                        if (m == g) {
                            break
                        }
                    }
                    a = m
                }
            }
        }
        if (o.y < H[0] && n >= this.data.rowHeaderCount) {
            c = n
        } else {
            if (o.bottom() > p && n < this.footerStartRow) {
                if (this.drawStartRow < n) {
                    var z = this.areaHeights[1];
                    var G = 0;
                    for (var m = n; m >= this.data.rowHeaderCount; m--) {
                        if (!this.data.rows[m].hidden) {
                            G += this.data.rows[m].clientSize
                        }
                        if (G > z) {
                            m++;
                            break
                        }
                    }
                    c = m
                }
            }
        }
        if (a > 0) {
            var t = 0;
            for (var F = this.data.colHeaderCount; F < a && F < this.data.colCount; F++) {
                if (!this.data.cols[F].hidden) {
                    t += this.data.cols[F].clientSize
                }
            }
            this.horizScroller.setScrollLeft(t)
        }
        if (c > 0) {
            var G = 0;
            for (var F = this.data.rowHeaderCount; F < c && F < this.data.rowCount; F++) {
                if (!this.data.rows[F].hidden) {
                    G += this.data.rows[F].clientSize
                }
            }
            this.vertiScroller.setScrollTop(G)
        }
        this.doOnScroll();
        this.defalutDoOnScroll = v
    },
    onDeletePressed: function() {
        if (this.getEditMode() == COM.widget.Grid.EDIT_MODE_READ_ONLY) {
            return
        }
        var c = (this.getEditMode() == COM.widget.Grid.EDIT_MODE_EDIT);
        var b = this.getSelections();
        if (b) {
            for (var a = 0; a < b.length; a++) {
                this.getModel().clearText(b[a], COM.widget.Grid.CAUSE_DELETE, c)
            }
        }
    },
    keyDown: function(c) {
        if (!this.isEnabled()) {
            return
        }
        var b = c.keyCode || c.which || c.charCode;
        var a = {
            doit: COM.widget.Grid.RESULT_TRUE
        };
        this.fireEvent(COM.widget.Grid.Event.KEY_DOWN_EVENT, {
            origin: c,
            result: a
        });
        if (a.doit != COM.widget.Grid.RESULT_TRUE) {
            return
        }
        if (c.ctrlKey) {
            if (b == 67) {
                this.copy();
                this.preventDefault(c)
            } else {
                if (b == 86) {
                    this.paste(this.currentCellCol, this.currentCellRow);
                    this.preventDefault(c)
                } else {
                    if (b == 88) {
                        this.cut();
                        this.preventDefault(c)
                    }
                }
            }
        } else {
            switch (b) {
            case 13:
                this.performKeyEnter();
                break;
            case 37:
                this.performKeyDirection(COM.widget.Grid.ENTER_NEXT_LEFT);
                break;
            case 38:
                this.performKeyDirection(COM.widget.Grid.ENTER_NEXT_UP);
                break;
            case 39:
                this.performKeyDirection(COM.widget.Grid.ENTER_NEXT_RIGHT);
                break;
            case 40:
                this.performKeyDirection(COM.widget.Grid.ENTER_NEXT_DOWN);
                break;
            case 46:
                this.onDeletePressed();
                break;
            case 33:
                this.pageUp(c);
                break;
            case 34:
                this.pageDown(c);
                break;
            default:
            }
        }
    },
    preventDefault: function(a) {
        if (a.preventDefault) {
            a.preventDefault()
        } else {
            a.returnValue = false
        }
    },
    keyPressed: function(d) {
        return;
        if (!this.isEnabled()) {
            return
        }
        var c = d.keyCode || d.which || d.charCode;
        Debugger.log("keypress:" + String.fromCharCode(c));
        var b = {
            doit: COM.widget.Grid.RESULT_TRUE
        };
        this.fireEvent(COM.widget.Grid.Event.KEY_PRESS_EVENT, {
            origin: d,
            result: b
        });
        if (b.doit != COM.widget.Grid.RESULT_TRUE) {
            return
        }
        if (this.allowInput(d)) {
            if (!this.isEditing()) {
                var a = this.getCell(this.currentCellCol, this.currentCellRow);
                if (a && this.canEdit(a)) {
                    if (d.preventDefault) {
                        d.preventDefault()
                    } else {
                        d.returnValue = false
                    }
                    this.editCurrentCell({
                        type: COM.widget.Grid.CAUSE_KEY,
                        value: c
                    })
                }
            }
        }
    },
    allowInput: function(b) {
        if (b.ctrlKey || b.shiftKey || b.altKey) {
            return false
        }
        var a = b.keyCode || b.which || b.charCode;
        switch (a) {
        case 13:
        case 37:
        case 38:
        case 39:
        case 40:
            return false;
        default:
        }
        return true
    },
    keyReleased: function() {
        if (!this.isEnabled()) {
            return
        }
    },
    performKeyEnter: function() {
        if (this.currentCellCol > -1 && this.currentCellRow > -1) {
            this.goNext()
        }
    },
    performKeyDirection: function(a) {
        if (this.currentCellCol > -1 && this.currentCellRow > -1) {
            this.goNext(a, false)
        }
    },
    copy: function() {
        if (this.getSelections() && this.getSelections().length > 0) {
            this.getModel().copy(this.getSelections()[0].getCopy(), this.getDefaultCopyWay())
        }
    },
    paste: function(a, b) {
        this.getModel().paste(a, b, this.getDefaultCopyWay())
    },
    cut: function() {
        if (this.getSelections() && this.getSelections().length > 0) {
            this.getModel().cut(this.getSelections()[0].getCopy(), this.getDefaultCopyWay())
        }
    },
    addLoadAnimation: function() {},
    getSelectionMode: function() {
        return this.getModel().data.options.selectionMode
    },
    getEditMode: function() {
        return this.getModel().getEditMode()
    },
    getColorProvider: function() {
        return this.getModel().getColorProvider()
    },
    getDefaultCopyWay: function() {
        return COM.widget.Grid.COPY_CONTENT
    },
    getZIndex: function(b, d) {
        var c = 0;
        var a = 0;
        if (d >= this.data.rowHeaderCount) {
            if (d >= this.data.rowCount - this.data.rowFooterCount) {
                c = 2
            } else {
                c = 1
            }
        }
        if (b >= this.data.colHeaderCount) {
            if (b >= this.data.colCount - this.data.colFooterCount) {
                a = 2
            } else {
                a = 1
            }
        }
        return COM.widget.Grid.GridCanvas.getIndex(c, a) + 1
    },
    getFirstCurrentCol: function() {
        return Math.max((this.data.colHeaderCount > 1 ? 1 : this.drawStartCol), 1)
    },
    getFirstCurrentRow: function() {
        return Math.max((this.data.rowHeaderCount > 1 ? 1 : this.drawStartRow), 1)
    },
    getContentHeight: function() {
        var c = this.areaHeights;
        var b = 0;
        for (var a = 0; a < c.length; a++) {
            b += c[a]
        }
        return b
    },
    getContentWidth: function() {
        var c = this.areaWidths;
        var b = 0;
        for (var a = 0; a < c.length; a++) {
            b += c[a]
        }
        return b
    },
    addFocusReceiver: function(b) {
        var a = this.getFocusReceiver().getControl();
        b.appendChild(a)
    },
    removeFocusReceiver: function(b) {
        var a = this.getFocusReceiver().getControl();
        if (a) {
            b.removeChild(a)
        }
    },
    getFocusReceiver: function() {
        if (!this.focusReceiver) {
            this.focusReceiver = new FocusReceiver()
        }
        return this.focusReceiver
    },
    bindKeyListenerForFocusReceiver: function() {
        var a = this;
        this.getFocusReceiver().onInputCommint(function(b) {
            setTimeout(function() {
                a.editCurrentCell({
                    type: COM.widget.Grid.CAUSE_KEY,
                    value: b
                })
            }, 0)
        })
    },
    getEditCurrentMoveListener: function() {
        if (this.focusReciverLocater == null ) {
            this.focusReciverLocater = this.createEditCurrentMoveListener()
        }
        return this.focusReciverLocater
    },
    createEditCurrentMoveListener: function() {
        var a = this;
        var b = {
            figureMoved: function(c) {
                var d = c.getBounds();
                c.translateToAbsolute(d);
                a.locateFocusReciver(d.x, d.y + d.height - 2)
            }
        };
        return b
    },
    locateFocusReciver: function(a, b) {
        this.getFocusReceiver().locate(a, b)
    },
    setCursorProvider: function(a) {
        this.cursorProvider = a
    },
    createFigureContent: function(n) {
        var d = this.getModel().data;
        if (d != null ) {
            var g = d.cells.rowList;
            var l = {
                rows: d.rows,
                cols: d.cols
            };
            this.data = d;
            this.calculateCanDrawArea(l, d);
            if (!this.canVisible()) {
                return
            }
            this.fireAreaSizeChanged();
            var m = this.checkDataBeforeCreateContent(g, d);
            var b = !(d.options.mergeCellShowMode === COM.widget.Grid.MERGE_SHOW_MODE_CONTRACT);
            n.unshowAll();
            var a = {};
            a.col = 0;
            a.row = 0;
            a.x = 0;
            a.y = 0;
            a.offsetX = this.offsetX;
            a.offsetY = this.offsetY;
            a.editPart = this;
            a.fullArea = b;
            a.areaHeights = this.areaHeights;
            a.areaWidths = this.areaWidths;
            a.rowList = g;
            a.layoutData = l;
            a.figure = n;
            a.colRanges = [0, this.drawHeaderColCount - 1, this.drawStartCol, this.drawEndCol, this.footerStartCol, d.colCount - 1];
            a.rowRanges = [0, this.drawHeaderRowCount - 1, this.drawStartRow, this.drawEndRow, this.footerStartRow, d.rowCount - 1];
            var c = new Date().getTime();
            COM.widget.Grid.GridEditPart.figureBuilder.buildFigures(a);
            var h = new Date().getTime();
            var o = h - c;
            Debugger.log("create Figure: [ " + o + " ]");
            n.removeUnShow();
            n.repaint();
            n.revalidate();
            this.fireEvent(COM.widget.Grid.Event.LAYOUT, {});
            if (m) {
                return
            } else {
                if (this.getModel().data.options.loadMode == COM.widget.Grid.LOAD_MODE_LAZY) {
                    this.preLoad(d, g)
                }
            }
        }
    },
    isDisposed: function() {
        return this.disposed
    },
    dispose: function() {
        this.disposed = true;
        try {
            var a = this.figure;
            if (a && a.dispose) {
                a.dispose()
            }
            this.figure = null 
        } catch (d) {
            Debugger.error("grid editpart dispose figure failed.")
        }
        if (this.policies && this.policies.length > 0) {
            for (var b = 1; b < this.policies.length; b += 2) {
                var c = this.policies[b];
                if (c && this.policies.dispose) {
                    c.dispose()
                }
                this.policies[b] = 0
            }
            this.policies = null 
        }
        delete this.mask;
        delete this.focusReceiver;
        delete this.initCellMouseMotionListener;
        delete this.createFigure;
        delete this.calculateCanDrawArea;
        delete this.areaWidths;
        delete this.areaHeights;
        delete this.model;
        delete this.data;
        delete this.createFigureByModel;
        delete this.selectionManager;
        delete this.horizScroller;
        delete this.vertiScroller;
        delete this.createFigureContent;
        delete this.parent;
        delete this.viewer
    }
});
COM.widget.Grid.GridEditPart.figureBuilder = function() {
    function c(m, g, n, h) {
        for (var l = m; l <= g; l++) {
            b(l, n.row, n, h)
        }
    }
    function d(l, g, m, h) {
        for (var n = l; n <= g; n++) {
            a(n, m, h)
        }
    }
    function a(n, l, h) {
        l.row = n;
        var m = l.layoutData.rows[n];
        if (!m || m.hidden) {
            return
        }
        l.x = l.areaWidths[0];
        var g;
        if (h || l.offsetX) {
            g = {
                y: h,
                x: l.offsetX
            }
        }
        b(l.colRanges[2], n, l, g);
        if (!h) {
            g = null 
        } else {
            if (g) {
                g.x = 0
            }
        }
        if (l.offsetX > 0) {
            l.x -= l.offsetX
        }
        c(l.colRanges[2] + 1, l.colRanges[3], l, g);
        l.x = 0;
        c(l.colRanges[0], l.colRanges[1], l, g);
        l.x = l.areaWidths[0] + l.areaWidths[1];
        c(l.colRanges[4], l.colRanges[5], l, g);
        l.y += m.clientSize
    }
    function b(l, s, p, q) {
        var h = p.layoutData.cols[l];
        if (!h || h.hidden) {
            return
        }
        var g = p.rowList[s];
        var n;
        var o;
        var m;
        var r;
        if (g) {
            n = g[l]
        } else {
            n = null 
        }
        if (n) {
            if (n.merged) {
                g = p.rowList[n.mergeInfo.row];
                if (g) {
                    n = g[n.mergeInfo.col]
                } else {
                    n = null 
                }
                o = p.editPart.createFigureByModel(n, l, s);
                if (!o.show || o.getParent() != p.figure) {
                    o.gridOffset = null ;
                    if (p.fullArea) {
                        m = {
                            x: 0,
                            y: 0
                        }
                    } else {
                        m = null 
                    }
                    r = p.editPart.calculateCellSize(n, p.layoutData, l, s, m);
                    if (q && (q.x || q.y)) {
                        if (!m) {
                            m = {
                                x: 0,
                                y: 0
                            }
                        }
                        if (q.x) {
                            m.x += q.x
                        }
                        if (q.y) {
                            m.y += q.y
                        }
                    }
                    if (m && (m.x + m.y)) {
                        o.setBounds(new Rectangle(p.x - m.x,p.y - m.y,r.width,r.height));
                        o.gridOffset = m
                    } else {
                        o.setBounds(new Rectangle(p.x,p.y,r.width,r.height))
                    }
                    o.show = true;
                    p.figure.add(o)
                }
            } else {
                o = p.editPart.createFigureByModel(n, l, s);
                o.gridOffset = null ;
                if (!o.show || o.getParent() != p.figure) {
                    r = p.editPart.calculateCellSize(n, p.layoutData, l, s);
                    if (q && (q.x || q.y)) {
                        if (!m) {
                            m = {
                                x: 0,
                                y: 0
                            }
                        }
                        if (q.x) {
                            m.x = q.x
                        }
                        if (q.y) {
                            m.y = q.y
                        }
                        o.setBounds(new Rectangle(p.x - m.x,p.y - m.y,r.width,r.height));
                        o.gridOffset = m
                    } else {
                        o.setBounds(new Rectangle(p.x,p.y,r.width,r.height))
                    }
                    o.show = true;
                    p.figure.add(o)
                }
            }
        }
        p.x += h.clientSize
    }
    this.buildFigures = function(g) {
        g.y = g.areaHeights[0];
        a(g.rowRanges[2], g, g.offsetY);
        if (g.offsetY > 0) {
            g.y -= g.offsetY
        }
        d(g.rowRanges[2] + 1, g.rowRanges[3], g);
        g.y = 0;
        d(g.rowRanges[0], g.rowRanges[1], g);
        g.y = g.areaHeights[0] + g.areaHeights[1];
        d(g.rowRanges[4], g.rowRanges[5], g)
    }
    ;
    return this
}();
COM.widget.Grid.PartFactory = function PartFactory() {
    COM.widget.Grid.PartFactory.superclass.constructor.call(this)
}
;
COM.widget.Grid.PartFactory.extend(COM.gef.EditPartFactory, {
    createEditPart: function(c, b) {
        var a = null ;
        if (b instanceof COM.widget.Grid.GridModel) {
            a = new COM.widget.Grid.GridEditPart()
        }
        a.setModel(b);
        return a
    }
});
COM.widget.Grid.RequestConstants = {};
COM.widget.Grid.RequestConstants.CHANGE_COL_SIZE = "change col size";
COM.widget.Grid.RequestConstants.CHANGE_ROW_SIZE = "change row size";
COM.widget.Grid.RequestConstants.COL_EXCHANGE = "col exchange";
COM.widget.Grid.RequestConstants.SELECTION_MOVE = "selection move";
COM.widget.Grid.DefaultHelper = function() {}
;
COM.widget.Grid.DefaultHelper.prototype = {
    createDefaultCol: function() {
        return {
            size: 100,
            auto: false,
            hidden: false,
            clientSize: 100
        }
    },
    createDefaultRow: function() {
        return {
            size: 20,
            auto: false,
            hidden: false,
            clientSize: 20
        }
    },
    createDefaultCell: function() {
        return {
            editorId: "",
            title: null ,
            showText: null ,
            editText: "",
            selectable: true,
            editable: true,
            cellMode: COM.widget.Grid.Cell.Cell_MODE_NORMAL,
            clientData: {},
            rowSpan: 1,
            colSpan: 1,
            merged: false,
            fontName: "����",
            fontSize: 12,
            fontSizeUnit: 0,
            fontColor: "#000",
            indent: 0,
            horzAlign: 3,
            vertAlign: 0
        }
    },
    getDefaultBorderColor: function() {
        return "gray"
    },
    createDefaultBorder: function() {
        return [1, 1]
    },
    createDefaultBorderColor: function() {
        return ["gray", "gray"]
    }
};
COM.widget.Grid.CellFieldLocator = function CellFieldLocator() {
    COM.widget.Grid.CellFieldLocator.superclass.constructor.call(this)
}
;
COM.widget.Grid.CellFieldLocator.extend(Object, {
    getEditPart: function() {
        return this.editPart
    },
    relocate: function(d) {
        var c = d.getField();
        var a = new Rectangle();
        var b = this.getEditPart().getCellAreaBounds(c, a);
        b.crop(new Insets(1,1,2,2));
        d.setBounds(b);
        d.setInnerBounds(a)
    },
    setEditPart: function(a) {
        this.editPart = a
    }
});
COM.widget.Grid.CellFieldFigure = function CellFieldFigure(b, a) {
    COM.widget.Grid.CellFieldFigure.superclass.constructor.call(this);
    this.setOpaque(true);
    this.field = new Rectangle();
    this.setOwner(b);
    this.setLocator(a)
}
;
COM.widget.Grid.CellFieldFigure.extend(Figure, {
    validate: function() {
        if (this.isValid()) {
            return
        }
        this.getLocator().relocate(this);
        COM.widget.Grid.CellFieldFigure.superclass.validate.call(this)
    },
    setInnerBounds: function(a) {
        this.innerBounds = a
    },
    getInnerBounds: function() {
        return this.innerBounds
    },
    getField: function() {
        return this.field
    },
    setField: function(b, d, c, a) {
        this.field.x = b;
        this.field.y = d;
        this.field.width = c;
        this.field.height = a
    },
    getLocator: function() {
        return this.locator
    },
    setLocator: function(a) {
        this.locator = a
    },
    getOwner: function() {
        return this.editpart
    },
    setOwner: function(a) {
        this.editpart = a
    }
});
COM.widget.Grid.FloatBorderFigure = function FloatBorderFigure(b, a) {
    COM.widget.Grid.FloatBorderFigure.superclass.constructor.call(this);
    this.setOpaque(false);
    this.setBorder(new COM.widget.Grid.SelectionBorder(1,"#f00"));
    this.field = new Rectangle();
    this.setOwner(b);
    this.setLocator(a)
}
;
COM.widget.Grid.FloatBorderFigure.extend(Figure, {
    ancestorMoved: function(a) {
        this.revalidate()
    },
    validate: function() {
        if (this.isValid()) {
            return
        }
        this.getLocator().relocate(this);
        COM.widget.Grid.FloatBorderFigure.superclass.validate.call(this)
    },
    addNotify: function() {
        COM.widget.Grid.FloatBorderFigure.superclass.addNotify.call(this);
        this.getOwnerFigure().addAncestorListener(this)
    },
    removeNotify: function() {
        this.getOwnerFigure().removeAncestorListener(this);
        COM.widget.Grid.FloatBorderFigure.superclass.removeAncestorListener.call(this)
    },
    setInnerBounds: function(a) {
        this.innerBounds = a
    },
    getInnerBounds: function() {
        return this.innerBounds
    },
    getField: function() {
        return this.field
    },
    setField: function(b, d, c, a) {
        this.field.x = b;
        this.field.y = d;
        this.field.width = c;
        this.field.height = a
    },
    getLocator: function() {
        return this.locator
    },
    getOwner: function() {
        return this.editpart
    },
    getOwnerFigure: function() {
        return this.getOwner().getFigure()
    },
    setLocator: function(a) {
        this.locator = a
    },
    setOwner: function(a) {
        this.editpart = a
    }
});
COM.widget.Grid.ScrollHelper = function ScrollHelper() {
    this.init()
}
;
COM.widget.Grid.ScrollHelper.extend(Object, {
    init: function() {
        var c = {};
        var b = document.createElement("div");
        b.style.position = "absolute";
        b.style.visibility = "hidden";
        b.style.overflow = "auto";
        b.style.height = "1px";
        b.style.width = "18px";
        b.className = "verti-scroll-bar";
        b.style.zIndex = 99;
        c.scrollBar = b;
        c.show = this.showFunc;
        c.hide = this.hideFunc;
        var a = document.createElement("div");
        a.style.height = "1px";
        a.style.width = "1px";
        c.placeHolder = a;
        b.appendChild(a);
        this.verti = c;
        c.getSize = function() {
            return parseInt(this.scrollBar.style.height)
        }
        ;
        c.setContentSize = function(g) {
            return this.placeHolder.style.height = g + "px"
        }
        ;
        c.bindScrollListener = function(g) {
            this.scrollBar.onscroll = g
        }
        ;
        c.getScrollTop = function() {
            return this.scrollBar.scrollTop
        }
        ;
        c.setScrollTop = function(g) {
            this.scrollBar.scrollTop = g
        }
        ;
        c.getScrollTopMax = function() {
            return this.scrollBar.scrollTopMax
        }
        ;
        c.getScrollHeight = function() {
            return this.scrollBar.scrollHeight
        }
        ;
        var d = {};
        b = document.createElement("div");
        b.style.position = "absolute";
        b.style.visibility = "hidden";
        b.style.overflow = "auto";
        b.className = "horiz-scroll-bar";
        b.style.height = "18px";
        b.style.width = "1px";
        b.style.zIndex = 99;
        d.scrollBar = b;
        d.show = this.showFunc;
        d.hide = this.hideFunc;
        a = document.createElement("div");
        d.placeHolder = a;
        a.style.height = "1px";
        a.style.width = "1px";
        b.appendChild(a);
        this.horiz = d;
        d.getSize = function() {
            return parseInt(this.scrollBar.style.width)
        }
        ;
        d.setContentSize = function(g) {
            return this.placeHolder.style.width = g + "px"
        }
        ;
        d.bindScrollListener = function(g) {
            this.scrollBar.onscroll = g
        }
        ;
        d.getScrollLeft = function() {
            return this.scrollBar.scrollLeft
        }
        ;
        d.setScrollLeft = function(g) {
            this.scrollBar.scrollLeft = g
        }
        ;
        d.getScrollWidth = function() {
            return this.scrollBar.scrollWidth
        }
    },
    showFunc: function() {
        this.scrollBar.style.visibility = "visible"
    },
    hideFunc: function() {
        this.scrollBar.style.visibility = "hidden"
    },
    getVerti: function() {
        return this.verti
    },
    getHoriz: function() {
        return this.horiz
    },
    getVertiScrollBar: function() {
        return this.verti.scrollBar
    },
    getHorizScrollBar: function() {
        return this.horiz.scrollBar
    },
    getVertiPlaceHolder: function() {
        return this.verti.placeHolder
    },
    getHorizPlaceHolder: function() {
        return this.horiz.placeHolder
    },
    appendTo: function(a) {
        a.appendChild(this.verti.scrollBar);
        a.appendChild(this.horiz.scrollBar)
    },
    removeFrom: function(a) {},
    setSize: function(b, a) {
        this.getVertiScrollBar().style.height = (a) + "px";
        this.getHorizScrollBar().style.top = (a) + "px";
        this.getHorizScrollBar().style.width = (b) + "px";
        this.getVertiScrollBar().style.left = (b) + "px"
    },
    dispose: function() {
        if (this.verti) {
            delete this.verti.scrollBar
        }
        if (this.horiz) {
            delete this.horiz.scrollBar
        }
        delete this.verti;
        delete this.horiz
    }
});
TextHelper = {};
TextHelper.getPxPerPt = function() {
    var b = document.createElement("div");
    b.style.width = "1in";
    b.style.visible = false;
    b.style.padding = "0px";
    var c = document.body;
    c.appendChild(b);
    TextHelper.pxPerPt = b.clientWidth
}
;
TextHelper.cellTextAlign = COM.widget.Grid.Cell.ALIGN;
TextHelper.drawText = function(z, o, q, c) {
    if ((o == "") || (o == null )) {
        return
    }
    var t = 1;
    var a = {
        x: c.x,
        y: c.y,
        right: c.x + c.width,
        bottom: c.y + c.height
    };
    var n;
    var A;
    var l;
    var h = 1;
    var d;
    if (q.fontSizeUnit === COM.widget.Grid.Cell.FONT_SIZE_UNIT_PT) {
        if (TextHelper.pxPerPt == null ) {
            TextHelper.getPxPerPt()
        }
        d = Math.floor(q.fontSize * TextHelper.pxPerPt / 72)
    } else {
        d = q.fontSize
    }
    if (q.indentPx > 0) {
        a.x += q.indentPx
    } else {
        if (q.indentPx < 0) {
            a.right -= q.indentPx
        } else {
            if (q.indent > 0) {
                a.x += Math.round((q.indent * Math.abs(d) / h))
            }
        }
    }
    n = Math.round((a.right - a.x) / h);
    A = Math.round((a.bottom - a.y) / h);
    var r = [];
    var s;
    if (!q.vertText) {
        if (!q.fitFontSize) {
            l = d
        } else {
            l = TextHelper.calcFontAutoHeight(o, d, n, A, q.multiLine, q.wrapLine)
        }
        s = TextHelper.wrapCellText(o, l, n, r, (q.horzAlign == TextHelper.cellTextAlign.CENTER) || (q.horzAlign == TextHelper.cellTextAlign.SPARSE) || (q.horzAlign == TextHelper.cellTextAlign.EXTEND), q.multiLine, q.wrapLine)
    } else {
        if (!q.fitFontSize) {
            l = d
        } else {
            l = TextHelper.calcFontAutoHeight(o, d, A, n, q.multiLine, q.wrapLine)
        }
        s = TextHelper.wrapCellText(o, l, A, r, (q.vertAlign == TextHelper.cellTextAlign.CENTER) || (q.vertAlign == TextHelper.cellTextAlign.SPARSE) || (q.vertAlign == TextHelper.cellTextAlign.EXTEND), q.multiLine, q.wrapLine)
    }
    l = Math.round(l * h);
    l = Math.abs(l);
    z.beginPath();
    var w = "";
    if (q.fontBold) {
        w = "bold "
    }
    if (q.fontItalic) {
        w += "italic "
    }
    if (q.fontUnderLine) {
        w += " "
    }
    if (q.fontColor) {
        z.setFillStyle(q.fontColor);
        z.setStrokeStyle(q.fontColor)
    }
    if (q.textShadow) {
        z.setShadowOffsetX(q.textShadow.offsetX);
        z.setShadowOffsetY(q.textShadow.offsetY);
        z.setShadowBlur(q.textShadow.blur);
        z.setShadowColor(q.textShadow.color)
    }
    w += l + "px " + q.fontName;
    z.setFont(w);
    var g = {
        x: a.x,
        y: a.y,
        right: a.right,
        bottom: a.bottom
    };
    var u = q.horzAlign;
    var m = q.vertAlign;
    if (!q.vertText) {
        var b;
        var p;
        if (m == TextHelper.cellTextAlign.EXTEND) {
            if (s == 1) {
                b = 0
            } else {
                b = Math.floor((g.bottom - g.y - l * s) / (s - 1))
            }
        } else {
            b = Math.floor((g.bottom - g.y - l * s) / (s + 1))
        }
        if (b < 0) {
            b = 0
        }
        if (b <= t) {
            p = b + l;
            if ((m == TextHelper.cellTextAlign.SPARSE) || (m == TextHelper.cellTextAlign.EXTEND)) {
                m = TextHelper.cellTextAlign.CENTER
            }
        } else {
            if ((m != TextHelper.cellTextAlign.SPARSE) && (m != TextHelper.cellTextAlign.EXTEND)) {
                p = l + t;
                b = t
            } else {
                p = l + b
            }
        }
        A = p * s - b;
        if ((m == TextHelper.cellTextAlign.FORE) || (m == TextHelper.cellTextAlign.EXTEND)) {
            g.y = g.y
        } else {
            if ((m == TextHelper.cellTextAlign.MIGHT_BACK) || (m == TextHelper.cellTextAlign.BACK)) {
                g.y = g.bottom - A - Math.min(3, g.bottom - g.y - A)
            } else {
                g.y = Math.floor((g.bottom + g.y - A) / 2)
            }
        }
        for (var v = 0; v <= s - 1; v++) {
            if (g.y + l >= a.y) {
                TextHelper.horzDrawLine(z, l, r[v], g, u, m, q.textStroke, q.decoration, q)
            }
            g.y = g.y + p;
            if (g.y >= a.bottom) {
                break
            }
        }
    } else {
        if (u == TextHelper.cellTextAlign.EXTEND) {
            if (s == 1) {
                b = 0
            } else {
                b = Math.floor((g.right - g.x - l * s) / (s - 1))
            }
        } else {
            b = Math.floor((g.right - g.x - l * s) / (s + 1))
        }
        if (b < 0) {
            b = 0
        }
        if (b <= 0) {
            p = b + l;
            if (u == TextHelper.cellTextAlign.SPARSE || u == TextHelper.cellTextAlign.EXTEND) {
                u = TextHelper.cellTextAlign.CENTER
            }
        } else {
            if (u != TextHelper.cellTextAlign.SPARSE && u != TextHelper.cellTextAlign.EXTEND) {
                p = l + 0;
                b = 0
            } else {
                p = l + b
            }
        }
        A = p * s - b;
        if (u == TextHelper.cellTextAlign.FORE || u == TextHelper.cellTextAlign.EXTEND) {} else {
            if (u == TextHelper.cellTextAlign.MIGHT_BACK || u == TextHelper.cellTextAlign.BACK) {
                g.x = g.right - A
            } else {
                g.x = (g.right + g.x - A) / 2
            }
        }
        for (var v = 0; v < s; v++) {
            if (g.x + l >= a.x) {
                TextHelper.vertDrawLine(z, r[v], g, m, l);
                g.x += p;
                if (g.x >= a.right) {
                    break
                }
            }
        }
    }
}
;
TextHelper.calcFontFitCell = function(l, c, b, p, o, n) {
    var m = 1;
    var d;
    var g = 0;
    var a = 0;
    d = Math.floor(o / Math.abs(b) * 2);
    if (d < 2) {
        d = 2
    }
    for (var h = 0; h < p; h++) {
        if (!n) {
            a++;
            if (c[h] > g) {
                g = c[h]
            }
        } else {
            a += TextHelper.calcLineOccupy(c[h], d)
        }
    }
    var q = a - Math.floor(l / (b + m));
    if (g - d > q) {
        q = g - d
    }
    return q
}
;
TextHelper.calcLineOccupy = function(b, c) {
    var a = Math.floor((b + c - 1) / c);
    if (a == 0) {
        a = 1
    }
    return a
}
;
TextHelper.wrapLine = function(l, d, u, q) {
    var a = TextHelper.calcAnsiCharCount(l);
    var b = l.length;
    var v = TextHelper.calcLineOccupy(a, d);
    var c = 0;
    var o;
    var t;
    var r;
    for (var h = 0; h <= v - 2; h++) {
        if (q) {
            o = Math.round((a) / (v - h) / 2) * 2
        } else {
            o = d
        }
        if (o <= 0) {
            o = 1
        }
        var n = 0;
        var m;
        t = [];
        while ((o > 0) && (c < b)) {
            m = l.charCodeAt(c);
            if (m < 255) {
                t[n] = l[c];
                n++;
                c++;
                o--;
                a--
            } else {
                if ((n == 0) || (o > 1)) {
                    t[n] = l[c];
                    n++;
                    c++;
                    o--;
                    o--;
                    a--;
                    a--
                } else {
                    break
                }
            }
        }
        if (u != null ) {
            r = "";
            for (var g = 0; g < t.length; g++) {
                r += t[g]
            }
            u.push(r)
        }
    }
    if (u != null ) {
        r = l.substr(c, b - c + 1);
        u.push(r)
    }
    return v
}
;
TextHelper.calcAnsiCharCount = function(c) {
    var a = 0;
    for (var b = 0; b < c.length; b++) {
        var d = c.charCodeAt(b);
        a++;
        if (d > 255) {
            a++
        }
    }
    return a
}
;
TextHelper.wrapCellText = function(u, d, r, v, q, n, t) {
    var b;
    var l;
    var g;
    var a;
    var c;
    var m;
    var s;
    var o = new String(u);
    g = Math.floor(r / Math.abs(d) * 2);
    if (g < 2) {
        g = 2
    }
    a = TextHelper.calcAnsiCharCount(u);
    if ((a == 0) || (!n) && (a <= g) || (!n) && (!t)) {
        s = 1;
        if (v != null ) {
            v.push(u)
        }
    } else {
        if (!n) {
            s = TextHelper.wrapLine(u, g, v, q)
        } else {
            m = o.length;
            s = 0;
            c = 0;
            var h = 0;
            while (h < m) {
                b = o.charCodeAt(h);
                if ((b == 13) || (b == 10)) {
                    l = o.substr(c, h - c);
                    if (t) {
                        s += TextHelper.wrapLine(l, g, v, q)
                    } else {
                        s++;
                        if (v != null ) {
                            v.push(l)
                        }
                    }
                    c = h + 1;
                    if ((c <= m) && (o.charCodeAt(c) == 10)) {
                        h++;
                        c++
                    }
                }
                h++
            }
            l = o.substr(c, m + 1 - c);
            if (t) {
                s += TextHelper.wrapLine(l, g, v, q)
            } else {
                s++;
                if (v != null ) {
                    v.push(l)
                }
            }
        }
    }
    return s
}
;
TextHelper.calcFontAutoHeight = function(s, c, r, l, o, q) {
    var a;
    var t;
    var h = 6;
    c = Math.abs(c);
    if (s == "") {
        return c
    }
    if (!o) {
        a = TextHelper.calcAnsiCharCount(s);
        if (!q) {
            t = Math.floor(r / a * 2)
        } else {
            t = Math.floor(Math.sqrt(2 * r * l / a));
            while (t > h) {
                if (floor(r / t) * Math.floor(l / t) >= Math.floor(a / 2 + 1)) {
                    break
                }
                t--
            }
        }
    } else {
        var d = new Array();
        var b = TextHelper.calcLineLengths(s, d);
        t = h;
        var p = t;
        var m = c;
        var g;
        var n;
        while (p <= m) {
            g = Math.floor((p + m + 1) / 2);
            n = TextHelper.calcFontFitCell(l, d, g, b, r, q);
            if (n > 0) {
                m = g - 1
            } else {
                p = g + 1;
                t = g
            }
        }
    }
    if (l < t) {
        t = l
    }
    if (h > t) {
        t = h
    }
    if (t > c) {
        t = c
    }
    return t
}
;
TextHelper.calcLineLengths = function(g, m) {
    var b = false;
    var d;
    var l = 0;
    var c;
    c = g.length;
    var a = 0;
    for (d = 0; d < c; d++) {
        var h = g.charCodeAt(d);
        if (b) {
            b = false;
            if (h == 10) {
                continue
            }
        }
        l++;
        if (h > 255) {
            l++
        } else {
            if ((h == 10) || (h == 13)) {
                l--;
                m[a] = l;
                a++;
                if (a >= m.length) {
                    if (a < 3000) {
                        if (d != 0) {
                            m.length = Math.floor(a * c / d + 100)
                        }
                    } else {
                        break
                    }
                }
                l = 0;
                b = h == 13
            }
        }
    }
    if (l > 0) {
        m[a] = l;
        a++
    }
    return a
}
;
TextHelper.horzDrawLine = function(q, w, z, p, d, o, r, u, b) {
    if (Util.browser.ie && Util.browser.version == 11) {
        p.y += 2
    }
    q.setTextAlign("left");
    q.setTextBaseline("top");
    var c = p.x;
    var n;
    var v;
    var a = TextHelper.textWidth(q, z);
    Decoration = COM.widget.Grid.Cell.DECORATION;
    if (d == TextHelper.cellTextAlign.CENTER) {
        n = Math.floor((p.right - p.x - a) / 2);
        if (n > 0) {
            c += n
        }
    } else {
        if (d == TextHelper.cellTextAlign.BACK) {
            n = p.right - p.x - a;
            if (n > 0) {
                c += n
            }
        } else {
            if (d == TextHelper.cellTextAlign.SPARSE) {
                n = Math.floor((p.right - p.x - a) / (z.length + 1));
                var l = p.x;
                var c = l + n;
                for (var g = 0; g < z.length; g++) {
                    v = z[g];
                    l += n;
                    q[r ? "strokeText" : "fillText"](v, l, p.y);
                    l += TextHelper.textWidth(q, v)
                }
                var t = l;
                TextHelper.drawDecoration(q, c, t, p.y, w, u, Decoration);
                return
            }
        }
    }
    var m = p.right - p.x;
    TextHelper.putText(q, z, c, p.y, r, b, w);
    var t = c + a;
    TextHelper.drawDecoration(q, c, t, p.y, w, u, Decoration)
}
;
TextHelper.putText = function(c, g, a, l, h, b, d) {
    c[h ? "strokeText" : "fillText"](g, a, l);
    return;
    if (!b.fontItalic) {
        c[h ? "strokeText" : "fillText"](g, a, l)
    } else {}
}
;
TextHelper.createItalicSVGImage = function(n, b, p, q, o, m) {
    var c = b.fontColor || "#000";
    var h = "<svg xmlns='http://www.w3.org/2000/svg' width='500' height='200'><foreignObject width='100%' height='100%'><div xmlns='http://www.w3.org/1999/xhtml' style='font-size:40px'><em>This is</em> <span style='font-style:italic;font-size:20px'>����</span> �� <span style='color:white; text-shadow:0 0 2px blue;'>��</span></div></foreignObject></svg>";
    var d = self.URL || self.webkitURL || self;
    var g = new Image();
    var l = new Blob([h],{
        type: "image/svg+xml;charset=utf-8"
    });
    var a = d.createObjectURL(l);
    g.onload = function() {
        n.drawImage(g, o, m);
        d.revokeObjectURL(a)
    }
    ;
    g.src = a
}
;
TextHelper.textWidth = function(a, c) {
    var b = a.measureText(c);
    return b.width
}
;
TextHelper.drawDecoration = function(b, l, g, m, a, d, c) {
    var h = m;
    if (d & c.UNDERLINE) {
        h = m + a;
        TextHelper.drawLine(b, l, g, h)
    }
    if (d & c.STRIKEOUT) {
        h = m + a / 2;
        TextHelper.drawLine(b, l, g, h)
    }
}
;
TextHelper.drawLine = function(a, c, b, d) {
    a.beginPath();
    a.moveTo(c, (d << 0) + 0.5);
    a.lineTo(b, (d << 0) + 0.5);
    a.stroke()
}
;
TextHelper.calculateHeight = function(a, h) {
    if (a.showText == null  || a.showText == "") {
        return 0
    }
    var d = a.showText;
    var l = a.fontName;
    var m = TextHelper.calculateFontSize(a);
    var g = [];
    var c = a;
    var b = TextHelper.wrapCellText(d, m, h, g, (c.horzAlign == TextHelper.cellTextAlign.CENTER) || (c.horzAlign == TextHelper.cellTextAlign.SPARSE) || (c.horzAlign == TextHelper.cellTextAlign.EXTEND), c.multiLine, c.wrapLine);
    return b * m + 2
}
;
TextHelper.calculateWidth = function(b, a) {
    if (b.showText == null  || b.showText == "") {
        return 0
    }
    var d = b.showText;
    var l = b.fontName;
    var m = TextHelper.calculateFontSize(b);
    var c = l + " " + m + "px";
    var h = FigureUtilities.getFontMetrics(d, c);
    var g = h.width + 2;
    return g
}
;
TextHelper.calculateFontSize = function(a) {
    var b = 20;
    if (a.fontSizeUnit === COM.widget.Grid.Cell.FONT_SIZE_UNIT_PT) {
        if (TextHelper.pxPerPt == null ) {
            TextHelper.getPxPerPt()
        }
        b = Math.floor(a.fontSize * TextHelper.pxPerPt / 72)
    } else {
        b = a.fontSize
    }
    return b
}
;
TextHelper.vertDrawLine = function(n, r, m, g, s) {
    var l = function(u) {
        var t = n.measureText(u);
        return t.width
    }
    ;
    var h = 1;
    var c;
    var o, b, p, q, a;
    b = r.length;
    if (g == TextHelper.cellTextAlign.EXTEND) {
        if (b == 1) {
            p = 0
        } else {
            p = Math.floor((m.bottom - m.y - s * b) / (b - 1))
        }
    } else {
        p = Math.floor((m.bottom - m.y - s * b) / (b + 1))
    }
    if (p < 0) {
        p = 0
    }
    if (p <= h) {
        q = p + s
    }
    if (g == TextHelper.cellTextAlign.SPARSE || g == TextHelper.cellTextAlign.EXTEND) {
        g = TextHelper.cellTextAlign.CENTER
    } else {
        if (g != TextHelper.cellTextAlign.SPARSE && g != TextHelper.cellTextAlign.EXTEND) {
            q = s + h;
            p = h
        } else {
            q = s + p
        }
    }
    a = q * b - p;
    if (g == TextHelper.cellTextAlign.FORE || g == TextHelper.cellTextAlign.EXTEND) {} else {
        if (g == TextHelper.cellTextAlign.MIGHT_BACK || g == TextHelper.cellTextAlign.BACK) {
            m.y = m.bottom - a
        } else {
            m.y = (m.bottom + m.y - a) / 2
        }
    }
    for (var d = 0; d < b + 1; d++) {
        c = r[d];
        n.fillText(c, m.x, m.y);
        m.y = m.y + q
    }
}
;
(function(b) {
    var a = {
        drawBackStyle: function(h, d, o, m, c, l, g) {
            var n = this.oppositePatterns[l];
            g = g || "#000";
            h.setFillStyle(g);
            h.fillRect(d, o, m, c);
            if (n) {
                h.setFillStyle(n);
                h.fillRect(d, o, m, c)
            }
        }
    };
    a.patternCreater = (function() {
        var d = document.createElement("canvas");
        if (!d || !d.getContext) {
            this.createOpposite = function() {}
            ;
            this.create = function() {}
            ;
            return this
        }
        var g = d.getContext("2d");
        function l(p) {
            var m = p.length;
            var n = p[0].length;
            d.width = n;
            d.height = m;
            c(g, 0, 0, n, m, p, 0, 0.5);
            var o = g.createPattern(d, "repeat");
            return o
        }
        function h(o, B, A, n, C, v, z, w, u) {
            var p = (B << 0) + w;
            var m = (A << 0) + u;
            var r = p;
            var q = m;
            for (var t = 0; t < C; t++) {
                r = p;
                for (var s = 0; s < n; s++) {
                    o.strokeStyle = v[t % 8][s % 8] ? z : "#fff";
                    o.beginPath();
                    o.moveTo(r, q);
                    o.lineTo(r + 1, q);
                    o.stroke();
                    r++
                }
                q++
            }
        }
        function c(o, A, z, n, B, v, w, u) {
            var p = (A << 0) + w;
            var m = (z << 0) + u;
            var r = p;
            var q = m;
            for (var t = 0; t < B; t++) {
                r = p;
                for (var s = 0; s < n; s++) {
                    if (v[t % 8][s % 8] == 0) {
                        o.strokeStyle = "#fff";
                        o.beginPath();
                        o.moveTo(r, q);
                        o.lineTo(r + 1, q);
                        o.stroke()
                    }
                    r++
                }
                q++
            }
        }
        this.createOpposite = l;
        this.create = l;
        return this
    }());
    (function(h) {
        var g = [[[1, 0, 1, 0, 1, 0, 1, 0], [0, 1, 0, 1, 0, 1, 0, 1], [1, 0, 1, 0, 1, 0, 1, 0], [0, 1, 0, 1, 0, 1, 0, 1], [1, 0, 1, 0, 1, 0, 1, 0], [0, 1, 0, 1, 0, 1, 0, 1], [1, 0, 1, 0, 1, 0, 1, 0], [0, 1, 0, 1, 0, 1, 0, 1]], [[1, 0, 1, 0, 1, 0, 1, 0], [0, 1, 0, 0, 0, 1, 0, 0], [1, 0, 1, 0, 1, 0, 1, 0], [0, 0, 0, 0, 0, 0, 0, 0], [1, 0, 1, 0, 1, 0, 1, 0], [0, 1, 0, 0, 0, 1, 0, 0], [1, 0, 1, 0, 1, 0, 1, 0], [0, 0, 0, 0, 0, 0, 0, 0]], [[0, 0, 1, 0, 0, 0, 1, 0], [0, 0, 1, 0, 0, 0, 0, 0], [1, 1, 0, 1, 1, 0, 0, 0], [0, 0, 1, 0, 0, 0, 0, 0], [0, 0, 1, 0, 0, 0, 1, 0], [0, 0, 0, 0, 0, 0, 1, 0], [1, 0, 0, 0, 1, 1, 0, 1], [0, 0, 0, 0, 0, 0, 1, 0]], [[1, 0, 1, 0, 1, 0, 1, 0], [0, 0, 0, 0, 0, 0, 0, 0], [1, 0, 1, 0, 1, 0, 1, 0], [0, 0, 0, 0, 0, 0, 0, 0], [1, 0, 1, 0, 1, 0, 1, 0], [0, 0, 0, 0, 0, 0, 0, 0], [1, 0, 1, 0, 1, 0, 1, 0], [0, 0, 0, 0, 0, 0, 0, 0]], [[0, 0, 0, 0, 0, 0, 0, 0], [0, 1, 0, 0, 0, 1, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 1, 0, 0, 0, 1], [0, 0, 0, 0, 0, 0, 0, 0], [0, 1, 0, 0, 0, 1, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 1, 0, 0, 0, 1]], [[0, 0, 0, 0, 0, 0, 0, 0], [1, 1, 1, 1, 1, 1, 1, 1], [0, 0, 0, 0, 0, 0, 0, 0], [1, 1, 1, 1, 1, 1, 1, 1], [0, 0, 0, 0, 0, 0, 0, 0], [1, 1, 1, 1, 1, 1, 1, 1], [0, 0, 0, 0, 0, 0, 0, 0], [1, 1, 1, 1, 1, 1, 1, 1]], [[0, 1, 0, 1, 0, 1, 0, 1], [0, 1, 0, 1, 0, 1, 0, 1], [0, 1, 0, 1, 0, 1, 0, 1], [0, 1, 0, 1, 0, 1, 0, 1], [0, 1, 0, 1, 0, 1, 0, 1], [0, 1, 0, 1, 0, 1, 0, 1], [0, 1, 0, 1, 0, 1, 0, 1], [0, 1, 0, 1, 0, 1, 0, 1]], [[0, 0, 0, 1, 0, 0, 0, 1], [0, 0, 1, 0, 0, 0, 1, 0], [0, 1, 0, 0, 0, 1, 0, 0], [1, 0, 0, 0, 1, 0, 0, 0], [0, 0, 0, 1, 0, 0, 0, 1], [0, 0, 1, 0, 0, 0, 1, 0], [0, 1, 0, 0, 0, 1, 0, 0], [1, 0, 0, 0, 1, 0, 0, 0]], [[1, 0, 0, 0, 1, 0, 0, 0], [0, 1, 0, 0, 0, 1, 0, 0], [0, 0, 1, 0, 0, 0, 1, 0], [0, 0, 0, 1, 0, 0, 0, 1], [1, 0, 0, 0, 1, 0, 0, 0], [0, 1, 0, 0, 0, 1, 0, 0], [0, 0, 1, 0, 0, 0, 1, 0], [0, 0, 0, 1, 0, 0, 0, 1]], [[0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0], [1, 1, 1, 1, 1, 1, 1, 1], [0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0], [1, 1, 1, 1, 1, 1, 1, 1], [0, 0, 0, 0, 0, 0, 0, 0]], [[0, 0, 1, 0, 0, 0, 1, 0], [0, 0, 1, 0, 0, 0, 1, 0], [0, 0, 1, 0, 0, 0, 1, 0], [0, 0, 1, 0, 0, 0, 1, 0], [0, 0, 1, 0, 0, 0, 1, 0], [0, 0, 1, 0, 0, 0, 1, 0], [0, 0, 1, 0, 0, 0, 1, 0], [0, 0, 1, 0, 0, 0, 1, 0]], [[0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0], [1, 0, 1, 0, 1, 0, 1, 0], [0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0], [1, 1, 1, 1, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0]], [[0, 0, 1, 0, 0, 0, 1, 0], [0, 0, 0, 0, 0, 0, 1, 0], [0, 0, 1, 0, 0, 0, 1, 0], [0, 0, 0, 0, 0, 0, 1, 0], [0, 0, 1, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 1, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0]], [[0, 0, 1, 0, 0, 0, 0, 0], [0, 0, 1, 0, 0, 0, 0, 0], [0, 0, 1, 0, 0, 0, 0, 0], [1, 1, 1, 1, 1, 1, 1, 1], [0, 0, 0, 0, 0, 0, 1, 0], [0, 0, 0, 0, 0, 0, 1, 0], [0, 0, 0, 0, 0, 0, 1, 0], [1, 1, 1, 1, 1, 1, 1, 1]], [[0, 0, 0, 0, 0, 0, 0, 0], [0, 1, 0, 0, 1, 0, 0, 1], [0, 0, 1, 0, 1, 0, 1, 0], [0, 0, 0, 1, 1, 1, 0, 0], [0, 0, 0, 1, 0, 1, 0, 0], [0, 0, 0, 1, 0, 1, 0, 0], [0, 1, 1, 1, 1, 1, 1, 1], [0, 0, 0, 0, 0, 0, 0, 0]], [[0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 1, 0, 1, 0, 0], [0, 0, 1, 0, 1, 0, 1, 0], [0, 0, 1, 0, 1, 0, 1, 0], [0, 0, 0, 0, 1, 0, 0, 0], [0, 0, 0, 0, 1, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0]], [[0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 1, 0, 1, 0, 0, 0], [0, 1, 0, 0, 0, 1, 0, 0], [0, 0, 0, 1, 0, 0, 0, 0], [0, 1, 0, 0, 0, 1, 0, 0], [0, 0, 1, 0, 1, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0]], [[0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 1, 1, 1, 0, 0, 0], [0, 1, 0, 0, 0, 1, 0, 0], [0, 1, 0, 0, 0, 1, 0, 0], [0, 1, 0, 0, 0, 1, 0, 0], [0, 0, 1, 1, 1, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0]], [[0, 0, 0, 1, 0, 0, 0, 0], [0, 0, 1, 0, 1, 0, 0, 0], [0, 1, 0, 0, 0, 1, 0, 0], [1, 0, 0, 0, 0, 0, 1, 0], [0, 1, 0, 0, 0, 1, 0, 0], [0, 0, 1, 0, 1, 0, 0, 0], [0, 0, 0, 1, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0]], [[0, 0, 0, 0, 0, 0, 0, 0], [0, 1, 0, 0, 0, 0, 1, 0], [0, 0, 1, 0, 0, 1, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 1, 0, 0, 1, 0, 0], [0, 1, 0, 0, 0, 0, 1, 0], [0, 0, 0, 0, 0, 0, 0, 0]], [[1, 0, 0, 0, 0, 0, 0, 1], [0, 1, 0, 0, 0, 0, 1, 0], [0, 0, 1, 0, 0, 1, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 1, 1, 0, 0, 0], [0, 0, 1, 0, 0, 1, 0, 0], [0, 1, 0, 0, 0, 0, 1, 0], [0, 0, 0, 0, 0, 0, 0, 0]], [[1, 1, 1, 1, 1, 1, 1, 1], [1, 0, 1, 0, 1, 0, 1, 0], [1, 1, 1, 1, 1, 1, 1, 1], [1, 0, 1, 0, 1, 0, 1, 0], [1, 1, 1, 1, 1, 1, 1, 1], [1, 0, 1, 0, 1, 0, 1, 0], [1, 1, 1, 1, 1, 1, 1, 1], [1, 0, 1, 0, 1, 0, 1, 0]], [[1, 0, 0, 1, 1, 0, 0, 1], [0, 1, 1, 0, 0, 1, 1, 0], [0, 1, 1, 0, 0, 1, 1, 0], [1, 0, 0, 1, 1, 0, 0, 1], [1, 0, 0, 1, 1, 0, 0, 1], [0, 1, 1, 0, 0, 1, 1, 0], [0, 1, 1, 0, 0, 1, 1, 0], [1, 0, 0, 1, 1, 0, 0, 1]], [[1, 1, 0, 0, 1, 1, 0, 0], [0, 0, 1, 1, 0, 0, 1, 1], [1, 1, 0, 0, 1, 1, 0, 0], [0, 0, 1, 1, 0, 0, 1, 1], [1, 1, 0, 0, 1, 1, 0, 0], [0, 0, 1, 1, 0, 0, 1, 1], [1, 1, 0, 0, 1, 1, 0, 0], [0, 0, 1, 1, 0, 0, 1, 1]], [[1, 0, 1, 0, 1, 0, 1, 0], [1, 0, 1, 0, 1, 0, 1, 0], [0, 1, 0, 1, 0, 1, 0, 1], [0, 1, 0, 1, 0, 1, 0, 1], [1, 0, 1, 0, 1, 0, 1, 0], [1, 0, 1, 0, 1, 0, 1, 0], [0, 1, 0, 1, 0, 1, 0, 1], [0, 1, 0, 1, 0, 1, 0, 1]]];
        var c = [];
        for (var d = 0; d < g.length; d++) {
            c[d] = h.patternCreater.createOpposite(g[d])
        }
        h.oppositePatterns = c
    }(a));
    b.BackStyleHelper = a
}(COM));
function FocusReceiver() {
    this.input = this.createControl();
    this.inputing = false;
    this.bindListener(this.input)
}
FocusReceiver.prototype.createControl = function() {
    var a = document.createElement("input");
    a.style.zIndex = -5;
    a.style.position = "absolute";
    a.style.left = "0px";
    a.style.top = "0px";
    a.style.width = "0px";
    if (COM.Util.browser.wk) {
        a.style.height = "2px"
    } else {
        a.style.height = "0px"
    }
    return a
}
;
FocusReceiver.prototype.bindListener = function(b) {
    var a = this;
    COM.Util.EventRegister.addEvent(b, "keydown", function(c) {
        a.keydown(c)
    });
    COM.Util.EventRegister.addEvent(b, "keyup", function(c) {
        a.keyup(c)
    })
}
;
FocusReceiver.prototype.keydown = function(c) {
    if (this.needTimeout()) {
        if (null  != this.keyupwaiter) {
            clearTimeout(this.keyupwaiter)
        }
        var b = this;
        this.keyupwaiter = setTimeout(function() {
            b.tryCommitInput()
        }, 500)
    }
    var a = c.keyCode;
    if (this.isInputing()) {
        return
    }
    if (this.isInputBegin(a)) {
        this.setInputing(true)
    }
}
;
FocusReceiver.prototype.isInputBegin = function(a) {
    if (Util.browser.ie || Util.browser.ch || Util.browser.wk) {
        if (229 == a) {
            return true
        }
    } else {
        if (Util.browser.ff) {
            if (0 == a) {
                return true
            }
        }
    }
}
;
FocusReceiver.prototype.setInputing = function(a) {
    this.inputing = a
}
;
FocusReceiver.prototype.isInputing = function() {
    return this.inputing
}
;
FocusReceiver.prototype.getValue = function() {
    return this.input.value
}
;
FocusReceiver.prototype.keyup = function(b) {
    if (this.needTimeout()) {
        if (null  != this.keyupwaiter) {
            clearTimeout(this.keyupwaiter);
            this.keyupwaiter = null 
        }
    }
    var a = b.keyCode;
    if (this.isInputing()) {
        if (13 == a || 32 == a) {
            this.commitInput()
        }
        if (229 == a) {
            this.setInputing(false)
        }
        if (0 == a) {
            this.setInputing(false)
        }
    } else {
        this.tryCommitInput()
    }
}
;
FocusReceiver.prototype.needTimeout = function() {
    return !(!Util.browser.ie && Util.browser.ff)
}
;
FocusReceiver.prototype.tryCommitInput = function() {
    var a = this.getValue();
    if ("" != a) {
        this.commitInput()
    }
}
;
FocusReceiver.prototype.focus = function(a) {
    if (null  != this.input) {
        this.input.focus()
    }
}
;
FocusReceiver.prototype.blur = function(a) {
    if (null  != this.input) {
        this.input.blur()
    }
}
;
FocusReceiver.prototype.getControl = function(a) {
    return this.input
}
;
FocusReceiver.prototype.clearValue = function(a) {
    if (null  != this.input) {
        this.input.value = ""
    }
}
;
FocusReceiver.prototype.locate = function(a, b) {
    if (null  != this.input) {
        this.input.style.left = a + "px";
        this.input.style.top = b + "px"
    }
}
;
FocusReceiver.prototype.commitInput = function() {
    this.setInputing(false);
    if (this.listener) {
        this.listener(this.getValue());
        this.clearValue()
    }
}
;
FocusReceiver.prototype.onInputCommint = function(a) {
    this.listener = a
}
;
COM.widget.Grid.GridPolicy = function GridPolicy(a) {
    COM.widget.Grid.GridPolicy.superclass.constructor.call(this);
    this.handles = [];
    this.setHost(a);
    this.selectionHandleShowing = false
}
;
COM.widget.Grid.GridPolicy.extend(COM.gef.GraphicalEditPolicy, {
    addResizeHandle: function() {
        var a = this.getLayer(COM.gef.LayerConstants.HANDLE_LAYER, Cursor.E_RESIZE);
        var b = this.createResizeHandle();
        a.add(this.resizeHandle)
    },
    createResizeHandle: function() {
        if (this.resizeHandle == null ) {
            if (this.getHost().getModel().isAdvancedResize()) {
                this.resizeHandle = new COM.widget.Grid.AdvancedResizeHandle(this.getHost())
            } else {
                this.resizeHandle = new COM.widget.Grid.ResizeHandle(this.getHost())
            }
        }
        return this.resizeHandle
    },
    getBeginLine: function(b, a) {
        if (this.beginLine == null ) {
            this.beginLine = new Polyline();
            this.beginLine.setOutlineColor(ColorConstants.red)
        }
        return this.beginLine
    },
    getEndLine: function() {
        if (this.endLine == null ) {
            this.endLine = new Polyline();
            this.endLine.setOutlineColor(ColorConstants.red)
        }
        return this.endLine
    },
    showColSizeChangeFeedback: function(c) {
        var b = this.getHost();
        var d = b.getFigure();
        var a = d.getBounds().getCopy();
        d.translateToAbsolute(a);
        var n = b.getContentHeight();
        var m = new Point(c.begin,a.y);
        var l = new Point(c.begin,a.y + n);
        var h = new Point(c.end + c.delta,a.y);
        var g = new Point(c.end + c.delta,a.y + n);
        this.updateLines(m, l, h, g)
    },
    showRowSizeChangeFeedback: function(d) {
        var c = this.getHost();
        var g = c.getFigure();
        var a = g.getBounds().getCopy();
        g.translateToAbsolute(a);
        var b = c.getContentWidth();
        var n = new Point(a.x,d.begin);
        var m = new Point(a.x + b,d.begin);
        var l = new Point(a.x,d.end + d.delta);
        var h = new Point(a.x + b,d.end + d.delta);
        this.updateLines(n, m, l, h)
    },
    getCommand: function(a) {
        var b = a.colRow;
        var d = a.delta;
        var c = null ;
        if (COM.widget.Grid.RequestConstants.CHANGE_COL_SIZE == a.getType()) {
            c = new COM.widget.Grid.ChangeColSizeCommand();
            c.setGridModel(this.getHost().getModel());
            c.setCol(b);
            c.setDelta(d)
        } else {
            if (COM.widget.Grid.RequestConstants.CHANGE_ROW_SIZE == a.getType()) {
                c = new COM.widget.Grid.ChangeRowSizeCommand();
                c.setGridModel(this.getHost().getModel());
                c.setRow(b);
                c.setDelta(d)
            }
        }
        return c
    },
    showSourceFeedback: function(a) {
        if (COM.widget.Grid.RequestConstants.CHANGE_COL_SIZE == a.getType()) {
            this.showColSizeChangeFeedback(a)
        } else {
            if (COM.widget.Grid.RequestConstants.CHANGE_ROW_SIZE == a.getType()) {
                this.showRowSizeChangeFeedback(a)
            }
        }
    },
    eraseSourceFeedback: function(d) {
        var b = this.getLayer(COM.gef.LayerConstants.FEEDBACK_LAYER);
        if (COM.widget.Grid.RequestConstants.CHANGE_COL_SIZE == d.getType() || COM.widget.Grid.RequestConstants.CHANGE_ROW_SIZE == d.getType()) {
            var a = this.getBeginLine();
            var c = this.getEndLine();
            if (b != null  && a != null ) {
                b.remove(a)
            }
            if (b != null  && c != null ) {
                b.remove(c)
            }
        }
    },
    updateLines: function(l, h, g, d) {
        var b = this.getBeginLine();
        var c = this.getEndLine();
        b.setEndpoints(l, h);
        c.setEndpoints(g, d);
        var a = this.getLayer(COM.gef.LayerConstants.FEEDBACK_LAYER);
        a.add(b);
        a.add(c)
    }
});
COM.widget.Grid.SelectionPolicy = function SelectionPolicy(a) {
    COM.widget.Grid.SelectionPolicy.superclass.constructor.call(this);
    this.handles = [];
    this.setHost(a);
    this.selectionHandleShowing = false
}
;
COM.widget.Grid.SelectionPolicy.extend(COM.gef.GraphicalEditPolicy, {
    showSelection: function() {
        this.addSelectionHandles()
    },
    hideSelection: function() {
        this.removeSelectionHandles()
    },
    addSelectionHandles: function() {
        if (this.getHost().getModel().isShowSelectionBorder()) {
            this.removeSelectionHandles();
            var b = this.getLayer(COM.gef.LayerConstants.HANDLE_LAYER);
            this.handles = this.createSelectionHandles();
            for (var a = 0; a < this.handles.length; a++) {
                b.add(this.handles[a])
            }
            this.selectionHandleShowing = true
        }
    },
    removeSelectionHandles: function() {
        if (this.handles == null  || this.handles.length == 0 || !this.selectionHandleShowing) {
            return
        }
        var b = this.getLayer(COM.gef.LayerConstants.HANDLE_LAYER);
        for (var a = 0; a < this.handles.length; a++) {
            b.remove(this.handles[a])
        }
        this.handles = null 
    },
    createSelectionHandles: function() {
        var g = [];
        var a = new COM.widget.Grid.GridSelectionHandleLocator(this.getHost());
        var h = this.getHost().getColorProvider();
        var d = new COM.widget.Grid.SelectionHandle(this.getHost(),a);
        var b = h.getSelectionBorderColor();
        var c = h.getSelectionBorderWidth();
        d.getBorder().setColor(b);
        d.getBorder().setWidth(c);
        d.setInnerPad(c);
        g.push(d);
        if (!h.isHideSelectionChangeable()) {
            var a = new COM.widget.Grid.GridSelectionHandleLocator(this.getHost());
            d = new COM.widget.Grid.SelectionChangeHandle(this.getHost(),new COM.widget.Grid.SelectionChangeHandleLocator(d),null );
            d.setBackgroundColor(b);
            g.push(d)
        }
        return g
    },
    refreshHandlesLocation: function() {
        if (this.handles == null  || this.handles.length == 0) {
            return
        }
        for (var a = 0; a < this.handles.length; a++) {
            this.handles[a].revalidate()
        }
    }
});
COM.widget.Grid.SelectionChangePolicy = function SelectionChangePolicy(a) {
    COM.widget.Grid.SelectionChangePolicy.superclass.constructor.call(this);
    this.handles = [];
    this.setHost(a);
    this.selectionHandleShowing = false
}
;
COM.widget.Grid.SelectionChangePolicy.extend(COM.gef.GraphicalEditPolicy, {
    getCommand: function(a) {
        var b = null ;
        if (COM.widget.Grid.RequestConstants.SELECTION_MOVE == a.getType()) {
            b = new COM.widget.Grid.SelectionChangeCommand();
            b.setGridModel(this.getHost().getModel());
            b.setOldSelection(this.getHost().getSelection().getCopy());
            b.setNewSelection(a.rect);
            b.setButton(a.button)
        }
        return b
    },
    showSourceFeedback: function(d) {
        if (COM.widget.Grid.RequestConstants.SELECTION_MOVE == d.getType()) {
            var b = this.getLayer(COM.gef.LayerConstants.FEEDBACK_LAYER);
            var g = this.getSelectionChangeFeedBack();
            var a = new Rectangle();
            var c = this.getHost().getCellAreaBounds(d.rect, a);
            g.setBounds(c);
            g.setInnerBounds(a);
            b.add(g);
            this.selectionHandleShowing = true
        }
    },
    getSelectionChangeFeedBack: function() {
        if (!this.selectionFeedBack) {
            this.selectionFeedBack = this.createSelectionChangeFeedBack()
        }
        return this.selectionFeedBack
    },
    createSelectionChangeFeedBack: function() {
        var a = new Figure();
        a.setBorder(new COM.widget.Grid.SelectionBorder(this.getHost().getColorProvider().getSelectionBorderWidth(),Color.parse(this.getHost().getColorProvider().getSelectionBorderColor()),true));
        a.getInnerBounds = COM.widget.Grid.SelectionHandle.prototype.getInnerBounds;
        a.setInnerBounds = COM.widget.Grid.SelectionHandle.prototype.setInnerBounds;
        return a
    },
    eraseSourceFeedback: function(b) {
        var a = this.getLayer(COM.gef.LayerConstants.FEEDBACK_LAYER);
        if (COM.widget.Grid.RequestConstants.SELECTION_MOVE == b.getType()) {
            var c = this.selectionFeedBack;
            if (a != null  && c != null ) {
                a.remove(c);
                this.selectionFeedBack = null 
            }
        }
    }
});
COM.widget.Grid.ColExchangePolicy = function ColExchangePolicy(a) {
    COM.widget.Grid.ColExchangePolicy.superclass.constructor.call(this);
    this.setHost(a);
    this.changeColFeedBack = null ;
    this.sourceFeedBack = null ;
    this.targetFeedBack = null 
}
;
COM.widget.Grid.ColExchangePolicy.extend(COM.gef.GraphicalEditPolicy, {
    getCommand: function(a) {
        var b = null ;
        if (COM.widget.Grid.RequestConstants.COL_EXCHANGE == a.getType()) {
            b = new COM.widget.Grid.ColExchangeCommand();
            b.setGridModel(this.getHost().getModel());
            b.setSource(a.source);
            b.setTarget(a.target)
        }
        return b
    },
    showSourceFeedback: function(a) {
        if (COM.widget.Grid.RequestConstants.COL_EXCHANGE == a.getType()) {
            this.showColExchangeFeedBack(a)
        }
    },
    eraseSourceFeedback: function(b) {
        var a = this.getLayer(COM.gef.LayerConstants.FEEDBACK_LAYER);
        if (COM.widget.Grid.RequestConstants.COL_EXCHANGE == b.getType()) {
            var c = this.changeColFeedBack;
            if (a != null  && c != null ) {
                a.remove(c);
                this.changeColFeedBack = null 
            }
            if (this.sourceFeedBack) {
                a.remove(this.sourceFeedBack);
                this.sourceFeedBack = null 
            }
            if (this.targetFeedBack) {
                a.remove(this.targetFeedBack);
                this.targetFeedBack = null 
            }
        }
    },
    showColExchangeFeedBack: function(g) {
        var a = g.source;
        var o = g.target;
        var h = g.deltaX;
        var d = g.deltaY;
        var p = this.getColExchangeFeedBack(a);
        p.setLocation(new Point(this.startX + h,this.startY + d));
        var m = this.getLayer(COM.gef.LayerConstants.FEEDBACK_LAYER);
        m.add(p);
        var q = this.getHost().getColorProvider();
        var n = new COM.widget.Grid.SelectionHandle(this.getHost(),l);
        var c = q.getSelectionBorderColor();
        var b = q.getSelectionBorderWidth();
        if (this.sourceFeedBack == null ) {
            this.sourceFeedBack = new COM.widget.Grid.FloatBorderFigure(this.getHost());
            this.sourceFeedBack.getBorder().setColor(c);
            this.sourceFeedBack.getBorder().setWidth(b);
            var l = new COM.widget.Grid.CellFieldLocator();
            l.setEditPart(this.getHost());
            this.sourceFeedBack.setLocator(l);
            this.sourceFeedBack.setField(a, 0, 1, 1);
            m.add(this.sourceFeedBack)
        } else {
            this.sourceFeedBack.setField(a, 0, 1, 1);
            this.targetFeedBack.revalidate()
        }
        if (this.targetFeedBack == null ) {
            this.targetFeedBack = new COM.widget.Grid.FloatBorderFigure(this.getHost());
            var l = new COM.widget.Grid.CellFieldLocator();
            this.targetFeedBack.getBorder().setColor(c);
            this.targetFeedBack.getBorder().setWidth(b);
            l.setEditPart(this.getHost());
            this.targetFeedBack.setLocator(l);
            this.targetFeedBack.setField(o, 0, 1, 1);
            m.add(this.targetFeedBack)
        } else {
            this.targetFeedBack.setField(o, 0, 1, 1);
            this.targetFeedBack.revalidate()
        }
    },
    getColExchangeFeedBack: function(a) {
        if (!this.changeColFeedBack) {
            this.changeColFeedBack = this.createColFeedBack(a)
        }
        return this.changeColFeedBack
    },
    createColFeedBack: function(b) {
        var a = new Figure();
        var d = this.getHost().getFigure();
        var g = this.getHost().getModel().getCell(b, 0).figure;
        g.erase();
        var c = g.getBounds().getCopy();
        g.translateToAbsolute(c);
        this.colFigure = g;
        this.startX = c.x;
        this.startY = c.y;
        a.cacheData = d.getUpdateManager().graphicsSource.control.context.getImageData(c.x, c.y, c.width, c.height);
        a.paintFigure = function(h) {
            var l = this.getBounds();
            h.putImageData(this.cacheData, l.x + 5, l.y + 5)
        }
        ;
        a.setBounds(new Rectangle(0,0,c.width + 10,c.height + 10));
        return a
    }
});
COM.widget.Grid.ChangeColSizeCommand = function ChangeColSizeCommand(a) {
    COM.widget.Grid.ChangeColSizeCommand.superclass.constructor.call(this, a);
    this.gridModel = null ;
    this.col = 0;
    this.delta = 0;
    this.orginSize = 0
}
;
COM.widget.Grid.ChangeColSizeCommand.extend(COM.gef.Command, {
    execute: function() {
        var b = this.gridModel.getCol(this.col);
        var a = b.clientSize + this.delta;
        if (a < 0) {
            a = 0
        }
        this.orginSize = b.size;
        this.gridModel.setColSize(this.col, a)
    },
    redo: function() {
        this.execute()
    },
    undo: function() {
        this.gridModel.setColSize(this.col, this.orginSize)
    },
    setGridModel: function(a) {
        this.gridModel = a
    },
    getGirdModel: function() {
        return this.gridModel
    },
    setCol: function(a) {
        this.col = a
    },
    getCol: function() {
        return this.col
    },
    setDelta: function(a) {
        return this.delta = a
    },
    getDelta: function() {
        return this.delta
    }
});
COM.widget.Grid.ChangeRowSizeCommand = function ChangeRowSizeCommand(a) {
    COM.widget.Grid.ChangeRowSizeCommand.superclass.constructor.call(this, a);
    this.gridModel = null ;
    this.row = 0;
    this.delta = 0;
    this.orginSize = 0
}
;
COM.widget.Grid.ChangeRowSizeCommand.extend(COM.gef.Command, {
    execute: function() {
        var b = this.gridModel.getRow(this.row);
        var a = b.clientSize + this.delta;
        if (a < 0) {
            a = 0
        }
        this.orginSize = b.size;
        this.gridModel.setRowSize(this.row, a)
    },
    redo: function() {
        this.execute()
    },
    undo: function() {
        this.gridModel.setRowSize(this.row, this.orginSize)
    },
    setGridModel: function(a) {
        this.gridModel = a
    },
    getGirdModel: function() {
        return this.gridModel
    },
    setRow: function(a) {
        this.row = a
    },
    getRow: function() {
        return this.row
    },
    setDelta: function(a) {
        return this.delta = a
    },
    getDelta: function() {
        return this.delta
    }
});
COM.widget.Grid.InsertColsCommand = function InsertColsCommand(a) {
    COM.widget.Grid.InsertColsCommand.superclass.constructor.call(this, a);
    this.gridModel = null ;
    this.index = 0;
    this.count = 0;
    this.copyIndex = 0;
    this.copyWay = null 
}
;
COM.widget.Grid.InsertColsCommand.extend(COM.gef.Command, {
    execute: function() {
        this.gridModel.insertCols(this.index, this.count, this.copyIndex, this.copyWay)
    },
    redo: function() {
        this.execute()
    },
    undo: function() {
        this.grid.deleteCols(this.index, this.count)
    },
    setGridModel: function(a) {
        this.gridModel = a;
        return this
    },
    getGirdModel: function() {
        return this.gridModel
    },
    setIndex: function(a) {
        this.index = a;
        return this
    },
    getIndex: function() {
        return this.index
    },
    setCount: function(a) {
        this.count = a;
        return this
    },
    getCount: function() {
        return this.count
    },
    setCopyIndex: function(a) {
        this.copyIndex = a;
        return this
    },
    getCopyIndex: function() {
        return this.copyIndex
    },
    setCopyWay: function(a) {
        this.copyWay = a;
        return this
    },
    getCopyWay: function() {
        return this.copyWay
    }
});
COM.widget.Grid.InsertRowsCommand = function InsertRowsCommand(a) {
    COM.widget.Grid.InsertRowsCommand.superclass.constructor.call(this, a)
}
;
COM.widget.Grid.InsertRowsCommand.extend(COM.widget.Grid.InsertColsCommand, {
    execute: function() {
        this.gridModel.insertRows(this.index, this.count, this.copyIndex, this.copyWay)
    },
    undo: function() {
        this.grid.deleteRows(this.index, this.count)
    }
});
COM.widget.Grid.DeleteColsCommand = function DeleteColsCommand(a) {
    COM.widget.Grid.DeleteColsCommand.superclass.constructor.call(this, a)
}
;
COM.widget.Grid.DeleteColsCommand.extend(COM.widget.Grid.InsertColsCommand, {
    execute: function() {
        this.gridModel.deleteCols(this.index, this.count)
    },
    undo: function() {}
});
COM.widget.Grid.DeleteRowsCommand = function DeleteRowsCommand(a) {
    COM.widget.Grid.DeleteRowsCommand.superclass.constructor.call(this, a)
}
;
COM.widget.Grid.DeleteRowsCommand.extend(COM.widget.Grid.InsertColsCommand, {
    execute: function() {
        this.gridModel.deleteRows(this.index, this.count)
    },
    undo: function() {}
});
COM.widget.Grid.ColExchangeCommand = function ColExchangeCommand(a) {
    COM.widget.Grid.ColExchangeCommand.superclass.constructor.call(this, a);
    this.gridModel = null ;
    this.source = 0;
    this.target = 0
}
;
COM.widget.Grid.ColExchangeCommand.extend(COM.gef.Command, {
    execute: function() {
        this.success = this.gridModel.exchangeCols(this.source, this.target)
    },
    redo: function() {
        this.execute()
    },
    undo: function() {
        if (this.success) {
            this.grid.exchangeCols(this.target, this.source)
        }
    },
    setGridModel: function(a) {
        this.gridModel = a;
        return this
    },
    getGirdModel: function() {
        return this.gridModel
    },
    setSource: function(a) {
        this.source = a;
        return this
    },
    getSource: function() {
        return this.source
    },
    setTarget: function(a) {
        this.target = a;
        return this
    },
    getTarget: function() {
        return this.target
    }
});
COM.widget.Grid.SelectionChangeCommand = function SelectionChangeCommand(a) {
    COM.widget.Grid.SelectionChangeCommand.superclass.constructor.call(this, a)
}
;
COM.widget.Grid.SelectionChangeCommand.extend(COM.gef.Command, {
    execute: function() {
        this.gridModel.changeSelection(this.oldRect, this.newRect)
    },
    undo: function() {
        this.grid.deleteRows(this.index, this.count)
    },
    redo: function() {
        this.execute()
    },
    setGridModel: function(a) {
        this.gridModel = a;
        return this
    },
    getGirdModel: function() {
        return this.gridModel
    },
    setOldSelection: function(a) {
        this.oldRect = a;
        return this
    },
    getOldSelection: function() {
        return this.oldRect
    },
    setNewSelection: function(a) {
        this.newRect = a;
        return this
    },
    getNewSelection: function() {
        return this.newRect
    },
    setButton: function(a) {
        this.button = a
    },
    getButton: function() {
        return this.button
    }
});
COM.widget.Grid.CellFigure = function CellFigure() {
    COM.widget.Grid.CellFigure.superclass.constructor.call(this);
    this.setOpaque(true);
    this.cellMode = COM.widget.Grid.Cell.Cell_MODE_NORMAL;
    this.textLeft = 0
}
;
COM.widget.Grid.CellFigure.extend(Figure, {
    containsPoint: function(c, b) {
        if (c == null ) {
            return
        }
        var a;
        var g;
        if (Util.isInstanceOf(c, Point)) {
            a = c.x;
            g = c.y
        } else {
            if (b != null ) {
                a = c;
                g = b
            }
        }
        var d = this.getBounds().getCopy();
        if (this.gridOffset) {
            d.translate(this.gridOffset.x, this.gridOffset.y);
            d.width -= this.gridOffset.x;
            d.height -= this.gridOffset.y
        }
        return d.contains(a, g)
    },
    setBorderHidden: function(a) {
        this.borderHidden = a
    },
    getBorderHidden: function() {
        return this.borderHidden
    },
    isMergeHead: function() {
        return this.rowSpan != 1 || this.colSpan != 1
    },
    setRowSpan: function(a) {
        this.rowSpan = a
    },
    setColSpan: function(a) {
        this.colSpan = a
    },
    getRowSpan: function() {
        return this.rowSpan
    },
    getColSpan: function() {
        return this.colSpan
    },
    setGradientBackground: function(a) {
        this.gradientBackground = a
    },
    setBackColor: function(a) {
        this.backColor = a
    },
    setBackStyle: function(a) {
        this.backStyle = a
    },
    getBackStyle: function() {
        return this.backStyle
    },
    setBackImage: function(a) {
        if (this.backImage == a) {
            return
        }
        if (this.backImage && this.backImage.removeLoadListener) {
            this.backImage.removeLoadListener(this)
        }
        this.backImage = a;
        a.addLoadListener(this)
    },
    setBackImageStyle: function(a) {
        this.backImageStyle = a
    },
    setBackImageHorizion: function(a) {
        this.backImageHorizion = a
    },
    setBackImageVertical: function(a) {
        this.backImageVertical = a
    },
    setBackImageBounds: function(a) {
        this.backImageBounds = a
    },
    setBorderStyle: function(a) {
        this.borderStyle = a
    },
    setBorderColor: function(a) {
        this.borderColor = a
    },
    setControl: function(c) {
        var a = this.controlParent;
        if (a && this.control && this.control.parentNode == a) {
            a.removeChild(this.control)
        }
        this.control = c;
        var b = this.getBounds();
        var d = b.getCopy();
        this.translateToAbsolute(d);
        this.locateControl(d.x, d.y)
    },
    setHtml: function(c) {
        var a = this.controlParent;
        if (a && this.html) {
            a.innerHtml = ""
        }
        this.html = c;
        var d = this.getBounds();
        var g = d.getCopy();
        this.translateToAbsolute(g);
        this.locateControlWithOutPadding(g.x, g.y);
        var b = this.getControlSize(g.width, g.height);
        this.resizeControlParent(b.width, b.height)
    },
    getControlSize: function(b, a) {
        b = b - this.getRightBorderWidth();
        a = a - this.getBottomBorderWidth();
        var c = this.getPadding();
        if (c) {
            b -= c.left;
            b -= c.right;
            a -= c.top;
            a -= c.bottom
        }
        return new Dimension(b,a)
    },
    getBackImage: function() {
        return this.backImage
    },
    getGradientBackgound: function() {
        return this.gradientBackground
    },
    getBackImageStyle: function() {
        return this.backImageStyle
    },
    getBackImageHorizion: function() {
        return this.backImageHorizion
    },
    getBackImageVertical: function() {
        return this.backImageVertical
    },
    getBackImageBounds: function() {
        return this.backImageBounds
    },
    getBorderStyle: function() {
        return this.borderStyle
    },
    getBorderColor: function() {
        return this.borderColor
    },
    getControl: function() {
        return this.control
    },
    getHtml: function() {
        return this.html
    },
    getBackMode: function() {
        return this.backMode
    },
    getBackColor: function() {
        return this.backColor
    },
    appendControl: function(b, c) {
        if (this.getCellMode() === COM.widget.Grid.Cell.Cell_MODE_CONTROL) {
            if (this.getControl() != null ) {
                var a = this.getControlParent(b);
                if (this.td) {
                    this.td.appendChild(this.getControl())
                } else {
                    a.appendChild(this.getControl())
                }
                c.appendChild(a);
                this.fireControlArrived()
            }
        } else {
            if (this.getCellMode() === COM.widget.Grid.Cell.Cell_MODE_HTML) {
                if (this.getHtml() != null ) {
                    var a = this.getControlParent(b);
                    if (this.td) {
                        this.td.innerHTML = this.getHtml()
                    } else {
                        a.innerHTML = this.getHtml()
                    }
                    c.appendChild(a)
                }
            }
        }
    },
    setCellMode: function(b) {
        this.cellMode = b;
        switch (b) {
        case COM.widget.Grid.Cell.Cell_MODE_TREE:
            this.addTreeFigure(false, false, null , 0);
            break;
        case COM.widget.Grid.Cell.Cell_MODE_NORMAL:
            if (this.tree) {
                this.remove(this.tree)
            }
            var a = this.controlParent;
            if (a && a.parentNode) {
                a.parentNode.removeChild(a)
            }
            break
        }
    },
    dropControl: function() {
        if (this.getCellMode() === COM.widget.Grid.Cell.Cell_MODE_CONTROL || this.getCellMode() === COM.widget.Grid.Cell.Cell_MODE_HTML) {
            var a = this.getControlParent();
            if (a && a.parentNode) {
                a.parentNode.removeChild(a)
            }
        }
    },
    dispose: function() {
        COM.widget.Grid.CellFigure.superclass.dispose.call(this);
        if (this.backImage && this.backImage.removeLoadListener) {
            this.backImage.removeLoadListener(this)
        }
        this.backImage = null ;
        delete this.controlParent;
        delete this.table;
        delete this.td
    },
    hideControl: function() {
        if (this.isCustomize()) {
            if (this.getControlParent()) {
                this.getControlParent().style.visibility = "hidden"
            }
        }
    },
    setVisible: function(a) {
        COM.widget.Grid.CellFigure.superclass.setVisible.call(this, a);
        if (!a) {
            this.hideControl()
        }
    },
    locateControl: function(a, c) {
        var b = this.getPadding();
        if (b) {
            a += b.left || 0;
            c += b.top || 0
        }
        this.controlLocation = {
            x: a,
            y: c
        }
    },
    locateControlWithOutPadding: function(a, b) {
        this.controlLocation = {
            x: a,
            y: b
        }
    },
    getControlLocation: function() {
        return this.controlLocation
    },
    realLocateControl: function(a, b) {
        this.getControlParent().style.left = a + "px";
        this.getControlParent().style.top = b + "px"
    },
    resizeControlParent: function(b, a) {
        this.getControlParent().style.width = b + "px";
        this.getControlParent().style.height = a + "px"
    },
    getControlParent: function(a) {
        if (this.controlParent == null ) {
            var d = this.getColorProvider();
            if (d && d.isTableCell()) {
                var b = document.createElement("table");
                b.style.zIndex = a;
                b.style.width = "0px";
                b.style.height = "0px";
                b.style.position = "absolute";
                b.style.visibility = "hidden";
                b.style.overflow = "hidden";
                b.style.whiteSpace = "nowrap";
                b.style.tableLayout = "fixed";
                b.style.borderCollapse = "collapse";
                var c = document.createElement("tr");
                var h = document.createElement("td");
                h.style.overflow = "hidden";
                c.appendChild(h);
                b.appendChild(c);
                this.table = b;
                this.td = h;
                this.controlParent = b;
                if (this.font) {
                    this.td.style.verticalAlign = COM.widget.Grid.Cell.ALIGN.getCssStr(this.font.vertAlign, true);
                    this.td.style.textAlign = COM.widget.Grid.Cell.ALIGN.getCssStr(this.font.horzAlign)
                }
            } else {
                this.controlParent = document.createElement("div");
                this.controlParent.style.zIndex = a;
                this.controlParent.style.width = "0px";
                this.controlParent.style.height = "0px";
                this.controlParent.style.position = "absolute";
                this.controlParent.style.visibility = "hidden";
                this.controlParent.style.overflow = "hidden";
                this.controlParent.style.whiteSpace = "nowrap";
                var g = this.getPadding();
                if (g && this.isHtml()) {
                    this.controlParent.style.paddingLeft = g.left + "px";
                    this.controlParent.style.paddingRight = g.right + "px";
                    this.controlParent.style.paddingTop = g.top + "px";
                    this.controlParent.style.paddingBottom = g.bottom + "px"
                }
            }
            if (this.font) {
                if (this.font.decoration) {
                    this.syncCss("decoration", this.font.decoration)
                }
                if (this.font.fontColor) {
                    this.syncCss("color", this.font.fontColor)
                }
            }
        }
        if (a != null ) {
            this.controlParent.style.zIndex = a
        }
        return this.controlParent
    },
    setBounds: function(h) {
        var l = this.getBounds().x;
        var g = this.getBounds().y;
        var c = (h.width != this.getBounds().width) || (h.height != this.getBounds().height);
        var d = (h.x != l) || (h.y != g);
        if ((c || d) && this.isVisible()) {
            if (d) {
                var n = h.x - l;
                var m = h.y - g;
                this.primTranslate(n, m)
            }
        }
        this.getBounds().width = h.width;
        this.getBounds().height = h.height;
        if (d || c) {
            if (c) {
                this.invalidate();
                if (this.isCustomize()) {
                    var b = this.getControlSize(h.width, h.height);
                    this.resizeControlParent(b.width, b.height);
                    if (this.isControl()) {
                        this.fireControlResize(b.width, b.height)
                    }
                }
            }
            this.fireFigureMoved();
            if (d && this.isCustomize()) {
                var a = h.getCopy();
                this.translateToAbsolute(a);
                if (this.isControl()) {
                    this.locateControl(a.x, a.y)
                } else {
                    this.locateControlWithOutPadding(a.x, a.y)
                }
            }
        }
    },
    setPadding: function(h) {
        if (h == this.getPadding() || (h != null  && h.equals(this.getPadding()))) {
            return
        }
        this.padding = h;
        if (this.isCustomize()) {
            if (this.isControl()) {
                var b = this.getBounds().getCopy();
                this.translateToAbsolute(b);
                this.locateControl(b.x, b.y);
                var n = this.getControlSize(b.width, b.height);
                this.resizeControlParent(n.width, n.height);
                this.fireControlResize(n.width, n.height)
            } else {
                var g = 0
                  , c = 0
                  , a = 0
                  , l = 0;
                if (h) {
                    g = h.top;
                    c = h.left;
                    a = h.bottom;
                    l = h.right
                }
                var m = this.getControlParent();
                var d;
                if (this.td) {
                    d = this.td
                } else {
                    d = m
                }
                d.style.paddingLeft = c + "px";
                d.style.paddingRight = l + "px";
                d.style.paddingTop = g + "px";
                d.style.paddingBottom = a + "px";
                var b = this.getBounds().getCopy();
                var n = this.getControlSize(b.width, b.height);
                this.resizeControlParent(n.width, n.height)
            }
        } else {
            this.invalidate()
        }
    },
    getPadding: function() {
        return this.padding
    },
    fireControlResize: function(c, a) {
        if (!this.getControl()) {
            return
        }
        var b = this.eventListeners.getListeners("ControlResizeListener");
        if (!b) {
            return
        }
        while (b.hasNext()) {
            b.next().controlResized(this, c, a)
        }
    },
    fireControlArrived: function() {
        var a = this.eventListeners.getListeners("ControlArrivedListener");
        if (!a) {
            return
        }
        while (a.hasNext()) {
            a.next().controlArrived(this)
        }
    },
    setControlSize: function(b, a) {
        var c = this.getControl();
        if (c != null ) {
            c.style.width = b + "px";
            c.style.height = a + "px"
        }
    },
    isCustomize: function() {
        return this.isControl() || this.isHtml()
    },
    isControl: function() {
        return this.getCellMode() === COM.widget.Grid.Cell.Cell_MODE_CONTROL
    },
    isHtml: function() {
        return this.getCellMode() === COM.widget.Grid.Cell.Cell_MODE_HTML
    },
    getCellMode: function() {
        return this.cellMode
    },
    getSpan: function() {
        return this.span
    },
    setSpan: function(b, a) {
        this.span = {
            h: b,
            v: a
        }
    },
    addTreeFigure: function(d, b, c, g) {
        var a = this.createTreeFigure(d, b, c, g);
        this.setTree(a)
    },
    createTreeFigure: function(d, b, c, g) {
        var a = new COM.widget.Grid.TreeFigure(this,d,b,c,g);
        return a
    },
    setTree: function(a) {
        if (this.tree != null ) {
            this.remove(a)
        }
        this.tree = a;
        this.add(a, null , 0)
    },
    getTree: function() {
        return this.tree
    },
    layout: function() {
        if (this.getCellMode() === COM.widget.Grid.Cell.Cell_MODE_CONTROL || this.getCellMode() === COM.widget.Grid.Cell.Cell_MODE_HTML) {
            return
        }
        var c = 0;
        var d = this.getBounds();
        if (this.getCellMode() === COM.widget.Grid.Cell.Cell_MODE_TREE) {
            var a = this.getTree();
            if (a != null ) {
                var b = this.tree.getPreferredSize(-1, -1);
                a.setBounds(new Rectangle(0,0,b.width,d.height));
                c = b.width
            }
        }
        this.textLeft = c
    },
    useLocalCoordinates: function() {
        return this
    },
    paint: function(a) {
        if (this.getCellMode() === COM.widget.Grid.Cell.Cell_MODE_CONTROL || this.getCellMode() === COM.widget.Grid.Cell.Cell_MODE_HTML) {
            var g = this.getControlLocation();
            if (g) {
                this.realLocateControl(g.x, g.y)
            }
            var d = this.getBounds();
            var b = this.getControlSize(d.width, d.height);
            this.resizeControlParent(b.width, b.height);
            if (this.isControl()) {
                this.fireControlResize(b.width, b.height)
            }
            this.getControlParent().style.visibility = "visible";
            var c = this.getBounds();
            a.pushState();
            a.translate(c.x, c.y);
            this.paintBack(a);
            a.restoreState()
        } else {
            a.pushState();
            this.paintFigure(a);
            a.restoreState();
            if (this.getTree()) {
                a.pushState();
                a.translate(this.getBounds().x + this.getInsets().left, this.getBounds().y + this.getInsets().top);
                this.getTree().paint(a);
                a.restoreState()
            }
        }
        if (!this.getBorderHidden()) {
            a.pushState();
            this.paintBorder(a);
            a.restoreState()
        }
    },
    paintText: function(b) {
        var a = this.getFont();
        var h = this.getText();
        var d = this.getBounds();
        var c = new Rectangle(this.textLeft,0,d.width - this.textLeft,d.height);
        c.width -= this.getRightBorderWidth();
        c.height -= this.getBottomBorderWidth();
        var g = this.getPadding();
        c.crop(g);
        b.clipRect(c);
        TextHelper.drawText(b, h, a, c)
    },
    paintFigure: function(a) {
        if (!this.isOpaque()) {
            return
        }
        var b = this.getBounds();
        a.pushState();
        a.translate(b.x, b.y);
        a.pushState();
        this.paintBack(a);
        a.restoreState();
        a.pushState();
        this.paintImage(a);
        a.restoreState();
        if (this.getText() && this.getText() != "") {
            a.pushState();
            this.paintText(a);
            a.restoreState()
        }
        if (this.selected > 0 && !this.isCurrent) {
            a.pushState();
            this.paintSelected(a);
            a.restoreState()
        }
        if (this.isCurrent) {
            a.pushState();
            this.paintCurrent(a);
            a.restoreState()
        }
        a.restoreState()
    },
    setSelected: function(a) {
        if (this.selected == null ) {
            this.selected = 0
        }
        if (a) {
            this.selected++
        } else {
            this.selected--;
            this.selected = Math.max(0, this.selected)
        }
        return this
    },
    clearSelected: function() {
        this.selected = 0
    },
    setCurrent: function(a) {
        this.isCurrent = a;
        return this
    },
    setColorProvider: function(a) {
        this.colorProvider = a
    },
    getColorProvider: function() {
        return this.colorProvider
    },
    paintSelected: function(a) {
        var b = this.getBounds();
        a.setFillStyle(this.getColorProvider().getSelectionColor());
        a.fillRect(0, 0, b.width, b.height)
    },
    paintCurrent: function(a) {
        var b = this.getBounds();
        a.setFillStyle(this.getColorProvider().getCurrentCellColor());
        a.fillRect(0, 0, b.width, b.height)
    },
    calculateBackColor: function() {
        var b = this.getColorProvider();
        var a = this.getBackColor();
        if (a == null  || a == "") {
            a = b.getDefaultBackColor()
        }
        return a
    },
    paintBack: function(c) {
        var g = this.getBounds();
        var d = this.getBackStyle() || COM.widget.Grid.Cell.BACK_STYLE.FILL;
        var b = this.calculateBackColor();
        var h = this.getGradientBackgound();
        var l;
        var a;
        if (h) {
            if (h.direction === COM.widget.Grid.Cell.DIRECTION_VERTI) {
                l = c.createLinearGradient(0, 0, 0, g.height)
            } else {
                l = c.createLinearGradient(0, 0, g.width, 0)
            }
            l.addColorStop(0, h.begin);
            l.addColorStop(1, h.end);
            a = l
        } else {
            if (b) {
                a = b
            } else {
                a = "#fff"
            }
        }
        if (d == COM.widget.Grid.Cell.BACK_STYLE.FILL) {
            c.setFillStyle(a);
            c.fillRect(0, 0, g.width, g.height)
        } else {
            COM.BackStyleHelper.drawBackStyle(c, 0, 0, g.width, g.height, d - 2, a)
        }
    },
    setBackImage: function(a) {
        if (a == this.backImage) {
            return
        }
        this.backImage = a;
        if (this.backImage && this.backImage.addLoadListener) {
            this.backImage.addLoadListener(this)
        }
    },
    paintImage: function(p) {
        var a = this.getBounds();
        var d = this.getBackImage();
        var l = COM.widget.Grid.Cell.ALIGN;
        if (d != null ) {
            var b = this.getBackImageStyle();
            if (b === COM.widget.Grid.Cell.BACK_IMAGE_STYLE_REPEAT) {
                var n = p.createPattern(d, "repeat");
                p.setFillStyle(n);
                p.fillRect(0, 0, a.width, a.height)
            } else {
                if (b === COM.widget.Grid.Cell.BACK_IMAGE_STYLE_REPEAT_X) {
                    var n = p.createPattern(d, "repeat-x");
                    p.setFillStyle(n);
                    p.fillRect(0, 0, a.width, a.height)
                } else {
                    if (b === COM.widget.Grid.Cell.BACK_IMAGE_STYLE_REPEAT_Y) {
                        var n = p.createPattern(d, "repeat-y");
                        p.setFillStyle(n);
                        p.fillRect(0, 0, a.width, a.height)
                    } else {
                        if (b === COM.widget.Grid.Cell.BACK_IMAGE_STYLE_STRETCH) {
                            p.drawImage(d, 0, 0, a.width, a.height)
                        } else {
                            if (b === COM.widget.Grid.Cell.BACK_IMAGE_STYLE_POSITION) {
                                var g = this.getBackImageHorizion();
                                var r = this.getBackImageVertical();
                                var c = d.width;
                                var s = d.height;
                                var q = 0;
                                var o = 0;
                                switch (g) {
                                case l.FORE:
                                    q = 0;
                                    break;
                                case l.CENTER:
                                    q = (a.width - c - this.getRightBorderWidth()) / 2;
                                    break;
                                case l.BACK:
                                    q = a.width - c - this.getRightBorderWidth();
                                    break;
                                default:
                                    q = 0
                                }
                                switch (r) {
                                case l.FORE:
                                    o = 0;
                                    break;
                                case l.CENTER:
                                    o = (a.height - s - this.getBottomBorderWidth()) / 2;
                                    break;
                                case l.BACK:
                                    o = a.height - s - this.getBottomBorderWidth();
                                    break;
                                default:
                                    o = 0
                                }
                                p.drawImage(d, (q >> 0), (o >> 0))
                            } else {
                                if (b === COM.widget.Grid.Cell.BACK_IMAGE_STYLE_BOUNDS) {
                                    var m = this.getBackImageBounds();
                                    if (m.width < 0 || m.height < 0) {
                                        p.drawImage(d, m.x, m.y)
                                    } else {
                                        p.drawImage(d, m.x, m.y, m.width, m.height)
                                    }
                                } else {
                                    p.drawImage(d, 0, 0)
                                }
                            }
                        }
                    }
                }
            }
        }
    },
    getRightBorderWidth: function() {
        var a = this.getBorderStyle();
        if (a) {
            return this.getBorderWidth(a[0])
        } else {
            return 0
        }
    },
    getBottomBorderWidth: function() {
        var a = this.getBorderStyle();
        if (a) {
            return this.getBorderWidth(a[1])
        } else {
            return 0
        }
    },
    getBorderWidth: function(a) {
        if (a & COM.widget.Grid.Cell.BORDER_BOLD) {
            return 3
        } else {
            if (a == 0) {
                return 0
            } else {
                return 1
            }
        }
        return 0
    },
    paintBorder: function(n) {
        if (!(this.getBorderStyle() && this.getBorderColor())) {
            return
        }
        var a = this.getBounds();
        n.translate(a.x, a.y);
        var l = this.getBorderStyle();
        var b = this.getBorderColor();
        var c;
        var h = this.getColorProvider();
        var o = 0;
        var m = 0;
        var g = l[0];
        var d = b[0];
        if (d == null  || d == "") {
            d = h.getDefaultBorderColor()
        }
        if (g == COM.widget.Grid.Cell.BORDER_AUTO) {
            g = h.getDefaultBorderStyle()
        }
        if (h.isShowMergeChildBorder() && this.isMergeHead()) {
            this.paintRightMergedBorder(n)
        } else {
            this.paintRightBorder(n, g, d, o, m, a.width, a.height)
        }
        g = l[1];
        d = b[1];
        if (d == null  || d == "") {
            d = h.getDefaultBorderColor()
        }
        if (g == COM.widget.Grid.Cell.BORDER_AUTO) {
            g = h.getDefaultBorderStyle()
        }
        if (h.isShowMergeChildBorder() && this.isMergeHead()) {
            this.paintBottomMergedBorder(n)
        } else {
            this.paintBottomBorder(n, g, d, o, m, a.width, a.height)
        }
        g = l[2];
        d = b[2];
        if (d == null  || d == "") {
            d = h.getDefaultBorderColor()
        }
        if (g == COM.widget.Grid.Cell.BORDER_AUTO) {
            g = h.getDefaultBorderStyle()
        }
        if (g != null  && g !== COM.widget.Grid.Cell.BORDER_NONE) {
            if (g === COM.widget.Grid.Cell.BORDER_SOLID) {
                n.pushState();
                n.beginPath();
                n.moveTo(o + a.width, m);
                n.lineTo(o, m + a.height);
                n.setStrokeStyle(d);
                n.stroke();
                n.restoreState()
            } else {
                if (g === COM.widget.Grid.Cell.BORDER_DASH) {
                    n.pushState();
                    n.beginPath();
                    n.dashedLine(o + a.width, m, o, m + a.height, COM.widget.Grid.CellFigure.DASH_LEN, COM.widget.Grid.CellFigure.DASH_GAP_LEN, COM.widget.Grid.CellFigure.DASH_Array);
                    n.setStrokeStyle(d);
                    n.stroke();
                    n.restoreState()
                } else {
                    if (g === COM.widget.Grid.Cell.BORDER_BOLD) {
                        n.pushState();
                        n.beginPath();
                        n.setLineWidth(2);
                        n.moveTo(o + a.width, m);
                        n.lineTo(o, m + a.height);
                        n.setStrokeStyle(d);
                        n.stroke();
                        n.restoreState()
                    } else {
                        if (g === COM.widget.Grid.Cell.BORDER_DOUBLE) {
                            n.pushState();
                            n.beginPath();
                            n.moveTo(o + a.width - 2, m);
                            n.lineTo(o, m + a.height - 2);
                            n.moveTo(o + a.width, m + 2);
                            n.lineTo(o + 2, m + a.height);
                            n.setStrokeStyle(d);
                            n.stroke();
                            n.restoreState()
                        }
                    }
                }
            }
        }
        g = l[3];
        d = b[3];
        if (d == null  || d == "") {
            d = h.getDefaultBorderColor()
        }
        if (g == COM.widget.Grid.Cell.BORDER_AUTO) {
            g = h.getDefaultBorderStyle()
        }
        if (g != null  && g !== COM.widget.Grid.Cell.BORDER_NONE) {
            if (g === COM.widget.Grid.Cell.BORDER_SOLID) {
                n.pushState();
                n.beginPath();
                n.moveTo(o, m);
                n.lineTo(o + a.width, m + a.height);
                n.setStrokeStyle(d);
                n.stroke();
                n.restoreState()
            } else {
                if (g === COM.widget.Grid.Cell.BORDER_DASH) {
                    n.pushState();
                    n.beginPath();
                    n.dashedLine(o, m, o + a.width, m + a.height, COM.widget.Grid.CellFigure.DASH_LEN, COM.widget.Grid.CellFigure.DASH_GAP_LEN, COM.widget.Grid.CellFigure.DASH_Array);
                    n.setStrokeStyle(d);
                    n.stroke();
                    n.restoreState()
                } else {
                    if (g === COM.widget.Grid.Cell.BORDER_BOLD) {
                        n.pushState();
                        n.beginPath();
                        n.setLineWidth(2);
                        n.moveTo(o, m);
                        n.lineTo(o + a.width, m + a.height);
                        n.setStrokeStyle(d);
                        n.stroke();
                        n.restoreState()
                    } else {
                        if (g === COM.widget.Grid.Cell.BORDER_DOUBLE) {
                            n.pushState();
                            n.beginPath();
                            n.moveTo(o, m + 2);
                            n.lineTo(o + a.width - 2, m + a.height);
                            n.moveTo(o + 2, m);
                            n.lineTo(o + a.width, m + a.height - 2);
                            n.setStrokeStyle(d);
                            n.stroke();
                            n.restoreState()
                        }
                    }
                }
            }
        }
    },
    paintRightMergedBorder: function(o) {
        var b = this.getCol();
        var s = this.getRow();
        var p = this.mergeChildProvider;
        var a = this.getBounds();
        var m = this.getRowSpan();
        var q = 0;
        var n = 0;
        var l;
        var r;
        var h, g;
        var d = this.getColorProvider();
        var c;
        for (l = 0; l < m; l++) {
            r = p.getCell(b, s + l);
            c = p.getRow(s + l);
            if (null  != c && !c.hidden) {
                if (r && r.border && r.border[0]) {
                    h = r.border[0];
                    if (h == COM.widget.Grid.Cell.BORDER_AUTO) {
                        h = d.getDefaultBorderStyle()
                    }
                    g = null ;
                    if (r.borderColor) {
                        g = r.borderColor[0]
                    }
                    if (g == null  || g == "") {
                        g = d.getDefaultBorderColor()
                    }
                    this.paintRightBorder(o, h, g, q, n, a.width, c.clientSize || c.size)
                }
                n += c.clientSize || c.size
            }
        }
    },
    paintBottomMergedBorder: function(o) {
        var c = this.getCol();
        var s = this.getRow();
        var p = this.mergeChildProvider;
        var a = this.getBounds();
        var m = this.getColSpan();
        var q = 0;
        var n = 0;
        var l;
        var r;
        var h, g;
        var d = this.getColorProvider();
        var b;
        for (l = 0; l < m; l++) {
            r = p.getCell(c + l, s);
            b = p.getCol(c + l);
            if (null  != b && !b.hidden) {
                if (r && r.border && r.border[1]) {
                    h = r.border[1];
                    if (h == COM.widget.Grid.Cell.BORDER_AUTO) {
                        h = d.getDefaultBorderStyle()
                    }
                    g = null ;
                    if (r.borderColor) {
                        g = r.borderColor[1]
                    }
                    if (g == null  || g == "") {
                        g = d.getDefaultBorderColor()
                    }
                    this.paintBottomBorder(o, h, g, q, n, b.clientSize || b.size, a.height)
                }
                q += b.clientSize || b.size
            }
        }
    },
    paintRightBorder: function(d, g, c, b, l, h, a) {
        if (g != null  && g !== COM.widget.Grid.Cell.BORDER_NONE) {
            if (g === COM.widget.Grid.Cell.BORDER_SOLID) {
                d.pushState();
                d.beginPath();
                d.moveTo(b + h - 0.5, l);
                d.lineTo(b + h - 0.5, l + a);
                d.setStrokeStyle(c);
                d.stroke();
                d.restoreState()
            } else {
                if (g === COM.widget.Grid.Cell.BORDER_DASH) {
                    d.pushState();
                    d.beginPath();
                    d.dashedLine(b + h - 0.5, l, b + h - 0.5, l + a, COM.widget.Grid.CellFigure.DASH_LEN, COM.widget.Grid.CellFigure.DASH_GAP_LEN, COM.widget.Grid.CellFigure.DASH_Array);
                    d.setStrokeStyle(c);
                    d.stroke();
                    d.restoreState()
                } else {
                    if (g === COM.widget.Grid.Cell.BORDER_BOLD) {
                        d.pushState();
                        d.beginPath();
                        d.setLineWidth(2);
                        d.moveTo(b + h - 1, l);
                        d.lineTo(b + h - 1, l + a);
                        d.setStrokeStyle(c);
                        d.stroke();
                        d.restoreState()
                    } else {
                        if (g === COM.widget.Grid.Cell.BORDER_DOUBLE) {
                            d.pushState();
                            d.beginPath();
                            d.moveTo(b + h - 2.5, l);
                            d.lineTo(b + h - 2.5, l + a);
                            d.moveTo(b + h - 0.5, l);
                            d.lineTo(b + h - 0.5, l + a);
                            d.setStrokeStyle(c);
                            d.stroke();
                            d.restoreState()
                        }
                    }
                }
            }
        }
    },
    paintBottomBorder: function(d, g, c, b, l, h, a) {
        if (g != null  && g !== COM.widget.Grid.Cell.BORDER_NONE) {
            if (g === COM.widget.Grid.Cell.BORDER_SOLID) {
                d.pushState();
                d.beginPath();
                d.moveTo(b, l + a - 0.5);
                d.lineTo(b + h, l + a - 0.5);
                d.setStrokeStyle(c);
                d.stroke();
                d.restoreState()
            } else {
                if (g === COM.widget.Grid.Cell.BORDER_DASH) {
                    d.pushState();
                    d.beginPath();
                    d.dashedLine(b, l + a - 0.5, b + h, l + a - 0.5, COM.widget.Grid.CellFigure.DASH_LEN, COM.widget.Grid.CellFigure.DASH_GAP_LEN, COM.widget.Grid.CellFigure.DASH_Array);
                    d.setStrokeStyle(c);
                    d.stroke();
                    d.restoreState()
                } else {
                    if (g === COM.widget.Grid.Cell.BORDER_BOLD) {
                        d.pushState();
                        d.beginPath();
                        d.setLineWidth(2);
                        d.moveTo(b, l + a - 1);
                        d.lineTo(b + h, l + a - 1);
                        d.setStrokeStyle(c);
                        d.stroke();
                        d.restoreState()
                    } else {
                        if (g === COM.widget.Grid.Cell.BORDER_DOUBLE) {
                            d.pushState();
                            d.beginPath();
                            d.moveTo(b, l + a - 2.5);
                            d.lineTo(b + h, l + a - 2.5);
                            d.moveTo(b, l + a - 0.5);
                            d.lineTo(b + h, l + a - 0.5);
                            d.setStrokeStyle(c);
                            d.stroke();
                            d.restoreState()
                        }
                    }
                }
            }
        }
    },
    paintLeftBorder: function(c) {
        var d = this.leftBorderStyle;
        d = 1;
        var b = this.leftBorderColor || "#000";
        b = "#aaa";
        var a = 0;
        var h = 0;
        var g = this.getBounds();
        if (d) {
            if (d === COM.widget.Grid.Cell.BORDER_SOLID) {
                c.pushState();
                c.beginPath();
                c.moveTo(a + 1, h);
                c.lineTo(a + 1, h + g.height);
                c.setStrokeStyle(b);
                c.stroke();
                c.restoreState()
            } else {
                if (d === COM.widget.Grid.Cell.BORDER_DASH) {
                    c.pushState();
                    c.beginPath();
                    c.dashedLine(a, h, a, h + g.height, COM.widget.Grid.CellFigure.DASH_LEN, COM.widget.Grid.CellFigure.DASH_GAP_LEN, COM.widget.Grid.CellFigure.DASH_Array);
                    c.setStrokeStyle(b);
                    c.stroke();
                    c.restoreState()
                } else {
                    if (d === COM.widget.Grid.Cell.BORDER_BOLD) {
                        c.pushState();
                        c.beginPath();
                        c.setLineWidth(2);
                        c.moveTo(a, h);
                        c.lineTo(a, h + g.height);
                        c.setStrokeStyle(b);
                        c.stroke();
                        c.restoreState()
                    } else {
                        if (d === COM.widget.Grid.Cell.BORDER_DOUBLE) {
                            c.pushState();
                            c.beginPath();
                            c.moveTo(a, h);
                            c.lineTo(a, h + g.height);
                            c.moveTo(a, h);
                            c.lineTo(a, h + g.height);
                            c.setStrokeStyle(b);
                            c.stroke();
                            c.restoreState()
                        }
                    }
                }
            }
        }
    },
    paintUpBorder: function(c) {
        var d = this.upBorderStyle;
        var b = this.upBorderColor || "#000";
        d = 1;
        b = "#aaa";
        var a = 0;
        var h = 0;
        var g = this.getBounds();
        if (d) {
            if (d === COM.widget.Grid.Cell.BORDER_SOLID) {
                c.pushState();
                c.beginPath();
                c.moveTo(a, h + 1);
                c.lineTo(a + g.width, h + 1);
                c.setStrokeStyle(b);
                c.stroke();
                c.restoreState()
            } else {
                if (d === COM.widget.Grid.Cell.BORDER_DASH) {
                    c.pushState();
                    c.beginPath();
                    c.dashedLine(a, h + 0.5, a + g.width, h + 0.5, COM.widget.Grid.CellFigure.DASH_LEN, COM.widget.Grid.CellFigure.DASH_GAP_LEN, COM.widget.Grid.CellFigure.DASH_Array);
                    c.setStrokeStyle(b);
                    c.stroke();
                    c.restoreState()
                } else {
                    if (d === COM.widget.Grid.Cell.BORDER_BOLD) {
                        c.pushState();
                        c.beginPath();
                        c.setLineWidth(2);
                        c.moveTo(a, h + 1);
                        c.lineTo(a + g.width, h + 1);
                        c.setStrokeStyle(b);
                        c.stroke();
                        c.restoreState()
                    } else {
                        if (d === COM.widget.Grid.Cell.BORDER_DOUBLE) {
                            c.pushState();
                            c.beginPath();
                            c.moveTo(a, h + 2.5);
                            c.lineTo(a + g.width, h + 2.5);
                            c.moveTo(a, h + 0.5);
                            c.lineTo(a + g.width, h + 0.5);
                            c.setStrokeStyle(b);
                            c.stroke();
                            c.restoreState()
                        }
                    }
                }
            }
        }
    },
    pictureLoaded: function() {
        this.repaint()
    },
    getRow: function(a) {
        if (this.model) {
            return this.model.rowIndex
        }
    },
    getCol: function(a) {
        if (this.model) {
            return this.model.colIndex
        }
    },
    getColRow: function() {
        return {
            row: this.getRow(),
            col: this.getCol()
        }
    },
    onExpandClicked: function(a) {
        if (this.treeListener) {
            this.treeListener.onExpandClicked(this.getCol(), this.getRow(), a)
        }
    },
    isExpanded: function() {
        return this.expanded
    },
    setExpanded: function(a) {
        this.expanded = a;
        this.tree.setExpanded(a)
    },
    setDepth: function(a) {
        this.tree.setDepth(a);
        return this
    },
    setExpandable: function(a) {
        this.tree.setExpandable(a);
        return this
    },
    setCheckable: function(a) {
        this.tree.setCheckable(a);
        return this
    },
    setChecked: function(a) {
        this.checked = a;
        this.tree.setChecked(a)
    },
    onCheckStateChanged: function(a, b) {
        this.checked = a;
        if (this.treeListener) {
            this.treeListener.onCheckStateChanged(this.getCol(), this.getRow(), a, b)
        }
    },
    isChecked: function() {
        return this.checked
    },
    setTreeImage: function(a) {
        this.tree.setTreeImage(a);
        return this
    },
    setText: function(a) {
        this.text = a
    },
    getText: function() {
        return this.text
    },
    setFontName: function(a) {
        if (!this.font) {
            this.font = {}
        }
        this.font.fontName = a;
        return this
    },
    setFontSize: function(a) {
        if (!this.font) {
            this.font = {}
        }
        this.font.fontSize = a;
        return this
    },
    setFontSizeUnit: function(a) {
        if (!this.font) {
            this.font = {}
        }
        this.font.fontSizeUnit = a;
        return this
    },
    setFontBold: function(a) {
        if (!this.font) {
            this.font = {}
        }
        this.font.fontBold = a;
        return this
    },
    setFontItalic: function(a) {
        if (!this.font) {
            this.font = {}
        }
        this.font.fontItalic = a;
        return this
    },
    setFontColor: function(a) {
        if (a) {
            a = a.length > 7 ? "#000000" : a
        }
        if (!this.font) {
            this.font = {}
        }
        this.font.fontColor = a;
        this.syncCss("color", a);
        return this
    },
    setMultiLine: function(a) {
        if (!this.font) {
            this.font = {}
        }
        this.font.multiLine = a;
        return this
    },
    setWrapLine: function(a) {
        if (!this.font) {
            this.font = {}
        }
        this.font.wrapLine = a;
        return this
    },
    setIndent: function(a) {
        if (!this.font) {
            this.font = {}
        }
        this.font.indent = a;
        return this
    },
    setIndentPx: function(a) {
        if (!this.font) {
            this.font = {}
        }
        this.font.indentPx = a;
        return this
    },
    setVertAlign: function(a) {
        if (!a) {
            a = COM.widget.Grid.Cell.ALIGN.CENTER
        }
        if (!this.font) {
            this.font = {}
        }
        if (this.td) {
            this.td.style.verticalAlign = COM.widget.Grid.Cell.ALIGN.getCssStr(a, true)
        }
        this.font.vertAlign = a;
        return this
    },
    setHorzAlign: function(a) {
        if (!a) {
            a = COM.widget.Grid.Cell.ALIGN.FORE
        }
        if (!this.font) {
            this.font = {}
        }
        if (this.td) {
            this.td.style.textAlign = COM.widget.Grid.Cell.ALIGN.getCssStr(a)
        }
        this.font.horzAlign = a;
        return this
    },
    setVertText: function(a) {
        if (!this.font) {
            this.font = {}
        }
        this.font.vertText = a;
        return this
    },
    setFitFontSize: function(a) {
        if (!this.font) {
            this.font = {}
        }
        this.font.fitFontSize = a;
        return this
    },
    setFontUnderLine: function(a) {
        if (!this.font) {
            this.font = {}
        }
        this.font.fontUnderLine = a;
        return this
    },
    setTextShadow: function(a) {
        if (!this.font) {
            this.font = {}
        }
        this.font.textShadow = a;
        return this
    },
    setTextStroke: function(a) {
        if (!this.font) {
            this.font = {}
        }
        this.font.textStroke = a;
        return this
    },
    setDecoration: function(a) {
        if (!this.font) {
            this.font = {}
        }
        this.font.decoration = a;
        this.syncCss("decoration", a);
        return this
    },
    syncCss: function(a, b) {
        if (this.controlParent) {
            switch (a) {
            case "decoration":
                this.controlParent.style.textDecoration = COM.widget.Grid.Cell.DECORATION.getCssStr(b);
                break;
            case "color":
                this.controlParent.style.color = b;
                break;
            default:
            }
        }
    },
    setFont: function(a) {
        this.font = a;
        return this
    },
    getFont: function() {
        if (!this.font) {
            this.font = {}
        }
        return this.font
    }
});
COM.widget.Grid.CellFigure.DASH_LEN = 4;
COM.widget.Grid.CellFigure.DASH_GAP_LEN = 2;
COM.widget.Grid.CellFigure.DASH_Array = null ;
COM.widget.Grid.CellFigure.CANVAS_INSTANCE = document.createElement("canvas");
COM.widget.Grid.TreeFigure = function TreeFigure(d, c, a, b, g) {
    COM.widget.Grid.TreeFigure.superclass.constructor.call(this);
    this.host = d;
    if (c) {
        this.addExpandFigure()
    }
    if (a) {
        this.addCheckFigure()
    }
    if (b) {
        this.setTreeImage(b)
    }
    this.depth = g || 0
}
;
COM.widget.Grid.TreeFigure.extend(Figure, {
    dispose: function() {
        COM.widget.Grid.TreeFigure.superclass.dispose.call(this);
        this.host = null ;
        this.expand = null ;
        this.check = null ;
        this.treeImage = null 
    },
    addExpandFigure: function() {
        if (this.expand) {
            return
        }
        var a = this.createExpandFigure();
        this.setExpandFigure(a)
    },
    setExpandFigure: function(a) {
        if (this.expand) {
            this.remove(this.expand)
        }
        this.expand = a;
        this.add(this.expand, null , 0)
    },
    createExpandFigure: function() {
        var a = new COM.widget.Grid.ExpandFigure(this.host);
        return a
    },
    addCheckFigure: function() {
        if (this.check) {
            return
        }
        var a = this.createCheckFigure();
        this.setCheckFigure(a)
    },
    createCheckFigure: function() {
        var a = new COM.widget.Grid.CheckBox(this.host);
        a.setSelected(this.host.isChecked());
        return a
    },
    setCheckFigure: function(a) {
        if (this.check) {
            this.remove(this.check)
        }
        this.check = a;
        this.add(this.check)
    },
    setTreeImage: function(a) {
        if (!a && this.treeImage) {
            this.remove(this.treeImage);
            this.treeImage = null ;
            return
        }
        if (!this.treeImage) {
            this.treeImage = this.createTreeImage();
            this.treeImage.setIcon(a);
            this.add(this.treeImage)
        } else {
            this.treeImage.setIcon(a)
        }
    },
    repaint: function(h, g, m, l) {
        COM.widget.Grid.TreeFigure.superclass.repaint.call(this, h, g, m, l)
    },
    paint: function(a) {
        COM.widget.Grid.TreeFigure.superclass.paint.call(this, a)
    },
    createTreeImage: function() {
        var a = new Label("treeImage");
        return a
    },
    handleStateChanged: function(a) {
        if (a.getPropertyName() == ButtonModel.SELECTED_PROPERTY) {
            this.host.onCheckStateChanged(this.check.isSelected())
        }
    },
    getPreferredSize: function(l, c) {
        if (this.prefSize == null ) {
            var a = COM.widget.Grid.TreeFigure.INDENTPERDEPTH * this.depth;
            var b = COM.widget.Grid.TreeFigure.GAP + a;
            var g = 0;
            var d;
            if (this.expand) {
                d = this.expand.getPreferredSize(-1, -1);
                g = Math.max(d.height, g)
            }
            d = this.getDefaultExpandFigureSize();
            b += d.width;
            b += COM.widget.Grid.TreeFigure.GAP;
            if (this.check) {
                d = this.check.getPreferredSize(-1, -1);
                b += d.width;
                g = Math.max(d.height, g);
                b += COM.widget.Grid.TreeFigure.GAP
            }
            if (this.treeImage) {
                d = this.treeImage.getPreferredSize(-1, -1);
                b += d.width;
                g = Math.max(d.height, g);
                b += COM.widget.Grid.TreeFigure.GAP
            }
            this.prefSize = new Dimension(b,g)
        }
        return this.prefSize
    },
    invalidate: function() {
        this.prefSize = null ;
        COM.widget.Grid.TreeFigure.superclass.invalidate.call(this)
    },
    layout: function() {
        var b = COM.widget.Grid.TreeFigure.INDENTPERDEPTH * this.depth;
        var a = COM.widget.Grid.TreeFigure.GAP + b;
        var g = 0;
        var d = this.getBounds();
        var c;
        if (this.expand) {
            c = this.expand.getPreferredSize(-1, -1);
            g = (d.height - c.height) / 2;
            this.expand.setBounds(new Rectangle(a,g,c.width,c.height))
        }
        c = this.getDefaultExpandFigureSize();
        a += c.width;
        a += COM.widget.Grid.TreeFigure.GAP;
        if (this.check) {
            c = this.check.getPreferredSize(-1, -1);
            g = (d.height - c.height) / 2;
            this.check.setBounds(new Rectangle(a,g,c.width,c.height));
            a += c.width;
            a += COM.widget.Grid.TreeFigure.GAP
        }
        if (this.treeImage) {
            c = this.treeImage.getPreferredSize(-1, -1);
            g = (d.height - c.height) / 2;
            this.treeImage.setBounds(new Rectangle(a,g,c.width,c.height))
        }
    },
    getDefaultExpandFigureSize: function() {
        if (!this.defs) {
            this.defs = {};
            this.defs.width = COM.widget.Grid.ExpandFigure.EXPANDED.width;
            this.defs.height = COM.widget.Grid.ExpandFigure.EXPANDED.height
        }
        return this.defs
    },
    setExpanded: function(a) {
        this.expand.setExpanded(a)
    },
    setDepth: function(a) {
        this.depth = a;
        this.invalidate();
        this.repaint()
    },
    setExpandable: function(a) {
        if (a) {
            this.addExpandFigure()
        } else {
            if (this.expand) {
                this.remove(this.expand);
                this.expand = null 
            }
        }
    },
    setCheckable: function(a) {
        if (a) {
            this.addCheckFigure()
        } else {
            if (this.check) {
                this.remove(this.check);
                this.check = null 
            }
        }
    },
    setChecked: function(a) {
        if (this.check) {
            this.check.setSelected(a)
        }
    }
});
COM.widget.Grid.TreeFigure.INDENTPERDEPTH = 20;
COM.widget.Grid.TreeFigure.GAP = 5;
COM.widget.Grid.ExpandFigure = function ExpandFigure(b) {
    COM.widget.Grid.ExpandFigure.superclass.constructor.call(this);
    this.host = b;
    this.setLayoutManager(new XYLayout());
    this.label = new Label("expand");
    this.add(this.label, new Rectangle(0,0,-1,-1));
    if (this.host.isExpanded()) {
        this.label.setIcon(COM.widget.Grid.ExpandFigure.EXPANDED)
    } else {
        this.label.setIcon(COM.widget.Grid.ExpandFigure.UNEXPANDED)
    }
    var a = this;
    this.addMouseListener({
        mousePressed: function(c) {
            a.host.onExpandClicked(c)
        }
    })
}
;
COM.widget.Grid.ExpandFigure.extend(Figure, {
    dispose: function() {
        COM.widget.Grid.ExpandFigure.superclass.dispose.call(this);
        this.host = null ;
        this.label = null 
    },
    setExpanded: function(a) {
        if (!this.label) {
            this.label = new Label("","");
            this.add(this.label, new Rectangle(0,0,-1,-1))
        }
        if (a) {
            this.label.setIcon(COM.widget.Grid.ExpandFigure.EXPANDED)
        } else {
            this.label.setIcon(COM.widget.Grid.ExpandFigure.UNEXPANDED)
        }
    }
});
COM.widget.Grid.CheckBox = function CheckBox(b) {
    COM.widget.Grid.CheckBox.superclass.constructor.call(this);
    this.host = b;
    this.setLayoutManager(new XYLayout());
    this.label = new Label("chekbox");
    this.add(this.label, new Rectangle(0,0,-1,-1));
    this.initImage();
    if (this.host.isChecked()) {
        this.label.setIcon(this.checkedImage)
    } else {
        this.label.setIcon(this.unCheckedImage)
    }
    var a = this;
    this.addMouseListener({
        mousePressed: function(c) {
            a.onClicked();
            a.host.onCheckStateChanged(a.isSelected(), c.e);
            c.consume()
        }
    })
}
;
COM.widget.Grid.CheckBox.extend(Figure, {
    dispose: function() {
        COM.widget.Grid.CheckBox.superclass.dispose.call(this);
        this.host = null ;
        this.label = null 
    },
    initImage: function() {
        var a = COM.widget.Grid.CheckBox.CHECKED_IMAGE;
        if (COM.widget.Grid.ThemeProvider && COM.widget.Grid.ThemeProvider.getCheckedImage) {
            a = COM.widget.Grid.ThemeProvider.getCheckedImage() || COM.widget.Grid.CheckBox.CHECKED_IMAGE
        }
        this.checkedImage = a;
        a = COM.widget.Grid.CheckBox.UNCHECKED_IMAGE;
        if (COM.widget.Grid.ThemeProvider && COM.widget.Grid.ThemeProvider.getUnCheckedImage) {
            a = COM.widget.Grid.ThemeProvider.getUnCheckedImage() || COM.widget.Grid.CheckBox.UNCHECKED_IMAGE
        }
        this.unCheckedImage = a
    },
    isSelected: function() {
        return this.selected
    },
    onClicked: function() {
        this.setSelected(!(this.isSelected()))
    },
    setSelected: function(a) {
        this.selected = a;
        if (!this.label) {
            this.label = new Label("","");
            this.add(this.label, new Rectangle(0,0,-1,-1))
        }
        var b;
        if (a) {
            this.label.setIcon(this.checkedImage)
        } else {
            this.label.setIcon(this.unCheckedImage)
        }
    }
});
COM.widget.Grid.CheckBox.UNCHECKED_IMAGE = ImageResourceManager.getImage("data:image/gif;base64,R0lGODlhDQANAPcAAEJCQrW1tc7OztbWzv///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////ywAAAAADQANAAAIPQAFBBhIsGAAAgEAKFzIUABCAAQiSpToMOHEixUhXqT4cCNHix4JZAwpsmPIkSdNeqwooOUAlwJeDiB5MSAAOw==");
COM.widget.Grid.CheckBox.CHECKED_IMAGE = ImageResourceManager.getImage("data:image/gif;base64,R0lGODlhDQANAPcAAAAAAEJCQrW1tc7OztbWzv///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////ywAAAAADQANAAAITwAHCBhIsKCAAgICKFzIcADCAAUiSpToMOFEiQAKVIR4EUBGAg8LZIzoMeNGkRlLRgRpsaRHiiFRjlwZU+TFkxdhChjAk8AAnz9/5hxaICAAOw==");
COM.widget.Grid.ExpandFigure.EXPANDED = ImageResourceManager.getImage("data:image/gif;base64,R0lGODlhEAASAPcAADFKY0L/QpSlvZylvZytxqW11qm92r3GxrnK5MbGxsbW69jh8efv9+vz/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAAEALAAAAAAQABIAAAhfAAMIHEiwoMGDCBMqXMjQ4AICEAcMECDgwEECDjJmbMAAwEWNDjgi8GgQ40YGCwyQLDjAAYCXL1UeFBAS5QIFBVYSFMBxwU0EOWcyUIDAQIGjOgcegMnUYsOnUKMiDAgAOw==");
COM.widget.Grid.ExpandFigure.UNEXPANDED = ImageResourceManager.getImage("data:image/gif;base64,R0lGODlhEAASAPcAADFKY0L/QpSlvZylvZytxqW11qm92r3GxrXI48bGxsbS59Te8efv9+vz/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAAEALAAAAAAQABIAAAhhAAMIHEiwoMGDCBMqXMjQ4AICEAcMECDgwEECDjJmbMAAwEWNADgq8GgQY0YADBYYIFlwgAMAMGGuPCjAAUcACxQUYElQAMcFABQg2EmTgVADBZLyHHggplOLDaNKnYowIAA7");
COM.widget.Grid.GridFigure = function GridFigure(a) {
    COM.widget.Grid.GridFigure.superclass.constructor.call(this);
    this.setOpaque(true);
    this.figures;
    this.layoutListener;
    this.headNormalColor = "#f0f";
    this.headNormalGradientColor = {
        begin: "#F8FBFC",
        end: "#D2DBE8",
        direction: COM.widget.Grid.Cell.DIRECTION_VERTI
    };
    this.borderStyles = [1, 1];
    this.borderColors = ["#D0D7E5", "#D0D7E5"];
    this.data = a
}
;
COM.widget.Grid.GridFigure.extend(Figure, {
    add: function(d, c, b) {
        d.show = true;
        var a;
        for (a = this; a; a = a.getParent()) {
            if (a == d) {
                Debugger.log(this.id + " => Figure-add-Figure being added introduces cycle")
            }
        }
        if (d.getParent()) {
            d.getParent().remove(d)
        }
        b = (b == null ) ? -1 : b;
        if (b == -1) {
            this.children.push(d)
        } else {
            this.children.splice(b, 0, d)
        }
        d.setParent(this);
        if (this.layoutManager && c) {
            this.layoutManager.setConstraint(d, c)
        }
        if (this.getFlag(FigureConstants.FLAG_REALIZED)) {
            d.addNotify()
        }
        if (d instanceof COM.widget.Grid.CellFigure && (d.getCellMode() === COM.widget.Grid.Cell.Cell_MODE_CONTROL || d.getCellMode() === COM.widget.Grid.Cell.Cell_MODE_HTML) && this.controlParent != null ) {
            d.appendControl(this.getZindex(d), this.controlParent)
        }
    },
    unshowAll: function() {
        var b = this.getChildren();
        for (var a = 0; a < b.length; a++) {
            b[a].show = false
        }
    },
    removeUnShow: function() {
        var b = this.getChildren();
        for (var a = 0; a < b.length; a++) {
            if (!b[a].show) {
                this.remove(b[a]);
                a--
            }
        }
    },
    setControlParent: function(a) {
        this.controlParent = a
    },
    getZindex: function(a) {
        if (a) {
            var b = a.getCol();
            var d = a.getRow();
            var c = this.getZIndexCalculator();
            var g;
            if (c) {
                g = c.getZIndex(b, d);
                return g
            }
            return 9
        }
    },
    getZIndexCalculator: function() {
        return this.zIndexCalculator
    },
    setZIndexCalculator: function(a) {
        this.zIndexCalculator = a
    },
    validate: function() {
        COM.widget.Grid.GridFigure.superclass.validate.call(this)
    },
    remove: function(a) {
        a.dropControl();
        COM.widget.Grid.GridFigure.superclass.remove.call(this, a)
    },
    setAreaSizeProvider: function(a) {
        this.areaSizeProvider = a
    },
    getlayoutData: function() {
        var c = this.getContent().getSizeManager();
        var b = [];
        var a = [];
        b.push({
            size: c[0][0].width + COM.widget.Grid.GridFigure.HEAD_WIDTH
        });
        b.push({
            size: c[0][1].width
        });
        b.push({
            size: c[0][2].width
        });
        a.push({
            size: c[0][0].height + COM.widget.Grid.GridFigure.HEAD_HEIGHT
        });
        a.push({
            size: c[1][0].height
        });
        a.push({
            size: c[2][0].height
        });
        if (this.layoutData == null ) {
            this.layoutData = {}
        }
        this.layoutData.cols = b;
        this.layoutData.rows = a;
        return this.layoutData
    },
    layout: function() {},
    addLayoutListener: function(a) {
        this.layoutListener = a
    },
    fireLayout: function() {
        if (this.layoutListener) {
            this.layoutListener.onLayouted(this.getlayoutData())
        }
    },
    to26Str: function(g) {
        var l = new String(g.toString(26));
        var p;
        var b = "";
        var d = "A";
        var m = d.charCodeAt(0);
        for (var h = 0; h < l.length; h++) {
            p = l[h];
            var o = parseInt(p, 26);
            b += String.fromCharCode(o + m)
        }
        return b
    },
    createHeaderCell: function(h, g, b) {
        var d = -1;
        var m = -1;
        var c;
        if (b) {
            d = g;
            if (g > -1) {
                c = h.cols[g]
            }
        } else {
            m = g;
            if (g > -1) {
                c = h.rows[g]
            }
        }
        if (d == -1 && m == -1) {
            var a = new COM.widget.Grid.CellFigure(d,m);
            a.paintFigure = function(n) {
                var p = this.getBounds();
                n.pushState();
                n.translate(p.x, p.y);
                n.setFillStyle("#A9C4E9");
                n.fillRect(p.x + 1, p.y + 1, p.width, p.height);
                n.beginPath();
                var o = n.createLinearGradient(0, 0, 0, p.height - 10);
                o.addColorStop(0, "#F8FBFC");
                o.addColorStop(1, "#D2DBE8");
                n.setFillStyle(o);
                n.moveTo(p.right() - 5, p.bottom() - 5);
                n.lineTo(p.right() - 5, p.y + 5);
                n.lineTo(p.right() - p.bottom() + p.y + 5, p.bottom() - 5);
                n.fill();
                n.restoreState()
            }
        } else {
            var l = b ? this.to26Str(g) : g + "";
            var a = new COM.widget.Grid.CellFigure(d,m);
            a.setText(l);
            a.setFontSize(12);
            a.setFontName("����");
            if (this.headNormalGradientColor) {
                a.setGradientBackground(this.headNormalGradientColor)
            } else {
                a.setBackColor(this.headNormalColor)
            }
            c.figure = a
        }
        a.setBorderStyle(this.borderStyles);
        a.setBorderColor(this.borderColors);
        a.setOpaque(true);
        return a
    },
    createColFigure: function(b) {
        var c = this.to26Str(b);
        var a = new COM.widget.Grid.CellFigure(b,-1);
        a.setText(c);
        a.setFontSize(12);
        a.setFontName("����");
        if (this.headNormalGradientColor) {
            a.setGradientBackground(this.headNormalGradientColor)
        } else {
            a.setBackColor(this.headNormalColor)
        }
        return a
    },
    createRowFigure: function(b) {
        var c = b + "";
        var a = new COM.widget.Grid.CellFigure(-1,b);
        a.setText(c);
        a.setFontSize(12);
        a.setFontName("����");
        if (this.headNormalGradientColor) {
            a.setGradientBackground(this.headNormalGradientColor)
        } else {
            a.setBackColor(this.headNormalColor)
        }
        return a
    },
    paintChildren: function(b) {
        var l;
        var g = Rectangle.SINGLETON;
        var a = this.children.length;
        var d;
        var h;
        for (var c = 0; c < a; c++) {
            l = this.children[c];
            if (l.isVisible() && l.intersects(b.getClip(g))) {
                d = l.getBounds();
                b.pushState();
                h = l.gridOffset;
                if (h) {
                    b.clipRect(new Rectangle(d.x + h.x,d.y + h.y,d.width - h.x,d.height - h.y))
                } else {
                    b.clipRect(l.getBounds())
                }
                l.paint(b);
                b.restoreState()
            }
        }
    },
    createHeadHeadFigure: function() {
        var a = new COM.widget.Grid.CellFigure(-1,-1);
        a.paintFigure = function(b) {
            var d = this.getBounds();
            b.pushState();
            b.translate(d.x, d.y);
            b.setFillStyle("#A9C4E9");
            b.fillRect(d.x + 1, d.y + 1, d.width, d.height);
            b.beginPath();
            var c = b.createLinearGradient(0, 0, 0, d.height - 10);
            c.addColorStop(0, "#F8FBFC");
            c.addColorStop(1, "#D2DBE8");
            b.setFillStyle(c);
            b.moveTo(d.right() - 5, d.bottom() - 5);
            b.lineTo(d.right() - 5, d.y + 5);
            b.lineTo(d.right() - d.bottom() + d.y + 5, d.bottom() - 5);
            b.fill();
            b.restoreState()
        }
        ;
        return a
    },
    getColRow: function(b, c) {
        var a = this.getCellFigureByLocation(b, c);
        if (a == null ) {
            return null 
        }
        return a.getColRow()
    },
    getCellFigureByLocation: function(b, c) {
        var a = this.findFigureAt(b, c, COM.widget.Grid.GridFigure.FIND_CELL_SEARCH);
        return a
    },
    setHeadNormalColor: function(a) {
        this.headNormalColor = a
    },
    setHeadNormalGradientColor: function(a) {
        this.headNormalGradientColor = a
    }
});
COM.gef.TypeTreeSearch = function TypeTreeSearch(a) {
    COM.gef.TypeTreeSearch.superclass.constructor.call(this);
    this.type = a
}
;
COM.gef.TypeTreeSearch.extend(TreeSearch, {
    accept: function(a) {
        return a instanceof this.type
    }
});
COM.widget.Grid.GridFigure.HEAD_WIDTH = 30;
COM.widget.Grid.GridFigure.HEAD_HEIGHT = 20;
COM.widget.Grid.GridFigure.FIND_CELL_SEARCH = new COM.gef.TypeTreeSearch(COM.widget.Grid.CellFigure);
COM.widget.Grid.GridFigure.HEAD_NORMAL_COLOR = {
    begin: "#F8FBFC",
    end: "#D2DBE8",
    direction: COM.widget.Grid.Cell.DIRECTION_VERTI
};
COM.widget.Grid.GridFigure.HEAD_SELECTED_COLOR = {
    begin: "#F8FBFC",
    end: "#D2DBE8",
    direction: COM.widget.Grid.Cell.DIRECTION_VERTI
};
COM.widget.Grid.SelectionFigure = function SelectionFigure() {
    COM.widget.Grid.SelectionFigure.superclass.constructor.call(this);
    this.selections = []
}
;
COM.widget.Grid.SelectionFigure.extend(Figure, {
    paint: function(n) {
        var b = this.selections;
        var m;
        var a;
        var g;
        if (this.currentFigure) {
            var h = this.colorProvider.getCurrentCellShowType();
            var c;
            a = this.currentFigure.getBounds();
            if (this.currentFigure.focus) {
                c = this.colorProvider.getCurrentCellColor()
            } else {
                c = this.colorProvider.getBlurCurrentCellColor()
            }
            if (h) {
                if (!this.colorProvider.isCurrenCellBorderHidden()) {
                    n.beginPath();
                    n.rect(a.x, a.y, a.width, a.height);
                    n.setStrokeStyle(c);
                    n.stroke()
                }
            } else {
                n.beginPath();
                n.moveTo(a.x, a.y);
                n.lineTo(a.right(), a.y);
                n.lineTo(a.right(), a.bottom());
                n.lineTo(a.x, a.bottom());
                n.lineTo(a.x, a.y);
                n.setFillStyle(c);
                n.fill()
            }
        }
        if (this.colorProvider.isHideSingleSelect() && b.length == 1 && b[0].single) {} else {
            n.beginPath();
            for (var d = 0, l = b.length; d < l; d++) {
                a = b[d].getBounds();
                n.rect(a.x, a.y, a.width, a.height)
            }
            n.setFillStyle(this.colorProvider.getSelectionColor());
            n.fill()
        }
    },
    setSelectionCellColor: function() {},
    setCurrentCellColor: function() {},
    addSelection: function(a) {
        this.add(a);
        this.selections.push(a)
    },
    removeSelection: function(a) {
        this.remove(a);
        COM.Util.Array.remove(this.selections, a)
    },
    setCurrent: function() {}
});
COM.widget.Grid.HeadCellFigure = function HeadCellFigure() {
    COM.widget.Grid.HeadCellFigure.superclass.constructor.call(this);
    this.leftBorderStyle = 0;
    this.leftBorderColor = null ;
    this.upBorderStyle = 0;
    this.upBorderColor = null ;
    this.defaultBackColor = null 
}
;
COM.widget.Grid.HeadCellFigure.extend(COM.widget.Grid.CellFigure, {
    calculateBackColor: function() {
        var a = this.getBackColor();
        if (a == null  || a == "") {
            if (this.defaultBackColor) {
                a = this.defaultBackColor
            } else {
                a = "#fff"
            }
        }
        return a
    },
    setDefaultBackColor: function(a) {
        this.defaultBackColor = a
    },
    setUpBorderStyle: function(a) {
        this.upBorderStyle = a
    },
    getUpBorderStyle: function() {
        return this.leftBorderStyle
    },
    setUpBorderColor: function(a) {
        this.upBorderColor = a
    },
    getUpBorderColor: function() {
        return this.upBorderColor
    },
    setLeftBorderStyle: function(a) {
        this.leftBorderStyle = a
    },
    getLeftBorderStyle: function() {
        return this.leftBorderStyle
    },
    setLeftBorderColor: function(a) {
        this.leftBorderColor = a
    },
    getLeftBorderColor: function() {
        return this.leftBorderColor
    },
    paintSelected: function(a) {
        var b = this.getBounds();
        a.setFillStyle(this.getColorProvider().getSelectionHeadColor());
        a.fillRect(0, 0, b.width, b.height)
    },
    paint: function(a) {
        if (this.getCellMode() === COM.widget.Grid.Cell.Cell_MODE_CONTROL || this.getCellMode() === COM.widget.Grid.Cell.Cell_MODE_HTML) {
            var c = this.getControlLocation();
            if (c) {
                this.realLocateControl(c.x, c.y)
            }
            this.getControlParent().style.visibility = "visible";
            var b = this.getBounds();
            a.pushState();
            a.translate(b.x, b.y);
            this.paintBack(a);
            a.restoreState()
        } else {
            a.pushState();
            this.paintFigure(a);
            a.restoreState()
        }
        a.pushState();
        this.paintBorder(a);
        a.restoreState()
    },
    paintFigure: function(a) {
        var b = this.getBounds();
        a.pushState();
        a.translate(b.x, b.y);
        a.pushState();
        if (this.selected) {
            this.paintSelected(a)
        } else {
            this.paintBack(a)
        }
        a.restoreState();
        a.pushState();
        this.paintImage(a);
        a.restoreState();
        if (this.getText() && this.getText() != "") {
            this.paintText(a)
        }
        a.restoreState()
    },
    paintBorder: function(a) {
        COM.widget.Grid.HeadCellFigure.superclass.paintBorder.call(this, a);
        if (this.getCol() == 0) {
            this.paintLeftBorder(a)
        }
        if (this.getRow() == 0) {
            this.paintUpBorder(a)
        }
    },
    paintLeftBorder: function(c) {
        var d = this.leftBorderStyle;
        var b = this.leftBorderColor || "#000";
        var a = 0;
        var h = 0;
        var g = this.getBounds();
        if (d) {
            if (d === COM.widget.Grid.Cell.BORDER_SOLID) {
                c.pushState();
                c.beginPath();
                c.moveTo(a + 0.5, h);
                c.lineTo(a + 0.5, h + g.height);
                c.setStrokeStyle(b);
                c.stroke();
                c.restoreState()
            } else {
                if (d === COM.widget.Grid.Cell.BORDER_DASH) {
                    c.pushState();
                    c.beginPath();
                    c.dashedLine(a + 0.5, h, a + 0.5, h + g.height, COM.widget.Grid.CellFigure.DASH_LEN, COM.widget.Grid.CellFigure.DASH_GAP_LEN, COM.widget.Grid.CellFigure.DASH_Array);
                    c.setStrokeStyle(b);
                    c.stroke();
                    c.restoreState()
                } else {
                    if (d === COM.widget.Grid.Cell.BORDER_BOLD) {
                        c.pushState();
                        c.beginPath();
                        c.setLineWidth(2);
                        c.moveTo(a + 1, h);
                        c.lineTo(a + 1, h + g.height);
                        c.setStrokeStyle(b);
                        c.stroke();
                        c.restoreState()
                    } else {
                        if (d === COM.widget.Grid.Cell.BORDER_DOUBLE) {
                            c.pushState();
                            c.beginPath();
                            c.moveTo(a + 2.5, h);
                            c.lineTo(a + 2.5, h + g.height);
                            c.moveTo(a + 0.5, h);
                            c.lineTo(a + 0.5, h + g.height);
                            c.setStrokeStyle(b);
                            c.stroke();
                            c.restoreState()
                        }
                    }
                }
            }
        }
    },
    paintUpBorder: function(c) {
        var d = this.upBorderStyle;
        var b = this.upBorderColor || "#000";
        var a = 0;
        var h = 0;
        var g = this.getBounds();
        if (d) {
            if (d === COM.widget.Grid.Cell.BORDER_SOLID) {
                c.pushState();
                c.beginPath();
                c.moveTo(a, h + 0.5);
                c.lineTo(a + g.width, h + 0.5);
                c.setStrokeStyle(b);
                c.stroke();
                c.restoreState()
            } else {
                if (d === COM.widget.Grid.Cell.BORDER_DASH) {
                    c.pushState();
                    c.beginPath();
                    c.dashedLine(a, h + 0.5, a + g.width, h + 0.5, COM.widget.Grid.CellFigure.DASH_LEN, COM.widget.Grid.CellFigure.DASH_GAP_LEN, COM.widget.Grid.CellFigure.DASH_Array);
                    c.setStrokeStyle(b);
                    c.stroke();
                    c.restoreState()
                } else {
                    if (d === COM.widget.Grid.Cell.BORDER_BOLD) {
                        c.pushState();
                        c.beginPath();
                        c.setLineWidth(2);
                        c.moveTo(a, h + 1);
                        c.lineTo(a + g.width, h + 1);
                        c.setStrokeStyle(b);
                        c.stroke();
                        c.restoreState()
                    } else {
                        if (d === COM.widget.Grid.Cell.BORDER_DOUBLE) {
                            c.pushState();
                            c.beginPath();
                            c.moveTo(a, h + 2.5);
                            c.lineTo(a + g.width, h + 2.5);
                            c.moveTo(a, h + 0.5);
                            c.lineTo(a + g.width, h + 0.5);
                            c.setStrokeStyle(b);
                            c.stroke();
                            c.restoreState()
                        }
                    }
                }
            }
        }
    },
    setVertAlign: function(a) {
        if (!this.font) {
            this.font = {}
        }
        if (a == COM.widget.Grid.Cell.ALIGN.AUTO) {
            a = COM.widget.Grid.Cell.ALIGN.CENTER
        }
        this.font.vertAlign = a;
        return this
    },
    setHorzAlign: function(a) {
        if (!this.font) {
            this.font = {}
        }
        if (a == COM.widget.Grid.Cell.ALIGN.AUTO) {
            a = COM.widget.Grid.Cell.ALIGN.CENTER
        }
        this.font.horzAlign = a;
        return this
    }
});
COM.widget.Grid.AbstractCellFigureCreator = function AbstractCellFigureCreator(b, a) {
    COM.widget.Grid.AbstractCellFigureCreator.superclass.constructor.call(this);
    this.colorProvider = b;
    this.imageProvider = a
}
;
COM.widget.Grid.AbstractCellFigureCreator.extend(Object, {
    create: function(b) {
        var a = this.createFigure(b);
        var c = this.getStyle(b);
        this.putStyleIntoFigure(c, a);
        return a
    },
    putStyleIntoFigure: function(b, a) {
        a.setColorProvider(this.colorProvider);
        if (null  == b) {
            return
        }
        a.setRowSpan(b.rowSpan);
        a.setColSpan(b.colSpan);
        a.setCellMode(b.cellMode);
        switch (b.cellMode) {
        case COM.widget.Grid.Cell.Cell_MODE_CONTROL:
            this.putControl(b, a);
            break;
        case COM.widget.Grid.Cell.Cell_MODE_HTML:
            this.putHtml(b, a);
            break;
        case COM.widget.Grid.Cell.Cell_MODE_TREE:
            this.putTree(b, a);
        default:
            this.putNormal(b, a)
        }
        this.putAlways(b, a)
    },
    putControl: function(b, a) {
        if (b.control) {
            a.setControl(b.control)
        }
    },
    putHtml: function(b, a) {
        if (b.html) {
            a.setHtml(b.html)
        }
    },
    putTree: function(c, a) {
        a.setExpandable(c.expandable).setCheckable(c.checkable).setDepth(c.depth || 0);
        if (c.expandable) {
            a.setExpanded(c.expanded)
        }
        if (c.checkable) {
            a.setChecked(c.checked)
        }
        if (c.treeImage) {
            var b = ImageResourceManager.getImage(this.imageProvider.getImageUrlById(c.treeImage));
            a.setTreeImage(b)
        }
    },
    putNormal: function(c, a) {
        a.setBackImageStyle(c.backImageStyle);
        a.setBackImageHorizion(c.backImageHorizion);
        a.setBackImageVertical(c.backImageVertical);
        if (c.backImage) {
            var b = ImageResourceManager.getImage(this.imageProvider.getImageUrlById(c.backImage));
            a.setBackImage(b);
            var d = c.backImageBounds;
            if (d) {
                a.setBackImageBounds({
                    x: d.x,
                    y: d.y,
                    width: d.width,
                    height: d.height
                })
            }
        }
        a.setText(c.showText)
    },
    putAlways: function(b, a) {
        a.setHorzAlign(b.horzAlign).setVertAlign(b.vertAlign);
        a.setFontName(b.fontName).setFontSize(b.fontSize).setFontColor(b.fontColor).setFontBold(b.fontBold).setFontItalic(b.fontItalic).setWrapLine(b.wrapLine).setIndent(b.indent).setIndentPx(b.indentPx).setVertText(b.vertText).setFitFontSize(b.fitFontSize).setMultiLine(b.multiLine).setTextShadow(b.textShadow).setTextStroke(b.textStroke).setFontSizeUnit(b.fontSizeUnit).setDecoration(b.decoration);
        this.putBack(b, a);
        a.setBorderStyle(b.border);
        a.setBorderColor(b.borderColor);
        if (b.padding) {
            a.setPadding(new Insets(b.padding[0],b.padding[1],b.padding[2],b.padding[3]))
        }
        if (b.title) {
            a.setToolTip(b.title)
        }
    },
    putBack: function(b, a) {
        if (b.backStyle) {
            a.setBackStyle(b.backStyle)
        }
        if (b.backColor && b.backColor.length > 0) {
            a.setBackColor(b.backColor)
        }
        if (b.gradientBackground) {
            a.setGradientBackground(b.gradientBackground)
        }
    },
    createFigure: function(a) {
        throw "method need implements."
    },
    getStyle: function(a) {
        return a
    }
});
COM.widget.Grid.NormalFigureCreator = function NormalFigureCreator(c, b, a) {
    COM.widget.Grid.NormalFigureCreator.superclass.constructor.call(this, c, b);
    this.rowProvider = a
}
;
COM.widget.Grid.NormalFigureCreator.extend(COM.widget.Grid.AbstractCellFigureCreator, {
    createFigure: function(a) {
        return new COM.widget.Grid.CellFigure()
    },
    putBack: function(b, a) {
        var c = this.rowProvider.getRow(b.rowIndex);
        if (c.color) {
            a.setBackColor(c.color);
            a.setBackStyle(COM.widget.Grid.Cell.BACK_STYLE.FILL)
        }
        if (b.backStyle) {
            a.setBackStyle(b.backStyle)
        }
        if (b.backColor && b.backColor.length > 0) {
            a.setBackColor(b.backColor)
        }
        if (b.gradientBackground) {
            a.setGradientBackground(b.gradientBackground)
        }
    }
});
COM.widget.Grid.HeadFigureCreator = function HeadFigureCreator(c, b, a) {
    COM.widget.Grid.HeadFigureCreator.superclass.constructor.call(this, c, b);
    this.headStyle = a
}
;
COM.widget.Grid.HeadFigureCreator.extend(COM.widget.Grid.AbstractCellFigureCreator, {
    getStyle: function(a) {
        var c = {};
        if (this.headStyle) {
            for (var b in this.headStyle) {
                c[b] = this.headStyle[b]
            }
        }
        if (a) {
            for (var b in a) {
                if (a[b] != null ) {
                    c[b] = a[b]
                }
            }
        }
        if (null  == c.showText) {
            if (a.colIndex == 0 && a.rowIndex != 0) {
                c.showText = (a.rowIndex + "")
            } else {
                if (a.rowIndex == 0 && a.colIndex != 0) {
                    c.showText = (COM.Util.Common.to26Str(a.colIndex))
                }
            }
        }
        return c
    },
    createFigure: function(b) {
        var a = new COM.widget.Grid.HeadCellFigure();
        if (b.rowIndex == 0) {
            a.setUpBorderStyle(b.upBorderStyle);
            a.setUpBorderColor(b.upBorderColor)
        }
        if (b.colIndex == 0) {
            a.setLeftBorderStyle(b.leftBorderStyle);
            a.setLeftBorderColor(b.leftBorderColor)
        }
        if (this.headStyle) {
            a.setDefaultBackColor(this.headStyle.backColor)
        }
        return a
    }
});
COM.widget.Grid.ResizeHandle = function ResizeHandle(a, b) {
    COM.widget.Grid.ResizeHandle.superclass.constructor.call(this, a, new COM.gef.MoveHandleLocator(), null )
}
;
COM.widget.Grid.ResizeHandle.extend(COM.gef.AbstractHandle, {
    containsPoint: function(n, m) {
        var b = this.getOwner();
        var l = b.getModel();
        if (!(l.isRowResizeable() || l.isColResizeable())) {
            return false
        }
        if (n == null ) {
            return
        }
        var q;
        var p;
        if (Util.isInstanceOf(n, Point)) {
            q = n.x;
            p = n.y
        } else {
            if (m != null ) {
                q = n;
                p = m
            }
        }
        var r = b.getFigure();
        var h = Figure.PRIVATE_POINT.x;
        var g = Figure.PRIVATE_POINT.y;
        var o = r.getCellFigureByLocation(q, p);
        Figure.PRIVATE_POINT.x = h;
        Figure.PRIVATE_POINT.y = g;
        if (!o) {
            return false
        }
        var d = o.getCol();
        var t = o.getRow();
        var s = b.getCell(d, t);
        var a = o.getBounds().getCopy();
        o.translateToAbsolute(a);
        var c = false;
        if (q - a.x < 5) {
            if (l.isColResizeable() && (t < 1 || t < l.getRowResizeIndex() || l.isColFreeResizeable()) && (d > 1 || l.isColHeaderResizeable())) {
                c = true;
                this.setCursor(Cursor.E_RESIZE)
            }
        } else {
            if (p - a.y < 5) {
                if (l.isRowResizeable() && (d < 1 || d < l.getColResizeIndex() || l.isRowFreeResizeable()) && (t > 1 || l.isRowHeaderResizeable())) {
                    c = true;
                    this.setCursor(Cursor.N_RESIZE)
                }
            } else {
                if (a.right() - q < 5) {
                    if (l.isColResizeable() && (t < 1 || t < l.getRowResizeIndex() || l.isColFreeResizeable()) && (d > 0 || l.isColHeaderResizeable())) {
                        c = true;
                        this.setCursor(Cursor.E_RESIZE)
                    }
                } else {
                    if (a.bottom() - p < 5) {
                        if (l.isRowResizeable() && (d < 1 || d < l.getColResizeIndex() || l.isRowFreeResizeable()) && (t > 0 || l.isRowHeaderResizeable())) {
                            c = true;
                            this.setCursor(Cursor.N_RESIZE)
                        }
                    }
                }
            }
        }
        return c
    },
    createDragTracker: function() {
        return new COM.widget.Grid.ResizeDragTracker(this.getOwner())
    }
});
COM.widget.Grid.AdvancedResizeHandle = function AdvancedResizeHandle(a, b) {
    COM.widget.Grid.AdvancedResizeHandle.superclass.constructor.call(this, a, new COM.gef.MoveHandleLocator(), null )
}
;
COM.widget.Grid.AdvancedResizeHandle.extend(COM.gef.AbstractHandle, {
    containsPoint: function(r, q) {
        var v = this.getOwner();
        var d = v.getModel();
        if (!(d.isRowResizeable() || d.isColResizeable())) {
            return false
        }
        if (r == null ) {
            return
        }
        var p;
        var o;
        if (Util.isInstanceOf(r, Point)) {
            p = r.x;
            o = r.y
        } else {
            if (q != null ) {
                p = r;
                o = q
            }
        }
        var n = v.getFigure();
        var t = Figure.PRIVATE_POINT.x;
        var s = Figure.PRIVATE_POINT.y;
        var w = n.getCellFigureByLocation(p, o);
        Figure.PRIVATE_POINT.x = t;
        Figure.PRIVATE_POINT.y = s;
        if (!w) {
            return false
        }
        var g = w.getCol();
        var h = w.getRow();
        var c = v.getCell(g, h);
        var l = w.getBounds().getCopy();
        w.translateToAbsolute(l);
        var a = COM.widget.Grid.GridModel.ModelReader;
        var m = d.getRow(h);
        var u = d.getCol(g);
        var b = false;
        if (p - l.x < 5) {
            if (d.isColResizeable() && a.isColResizeable(m) && g > 1) {
                b = true;
                this.setCursor(Cursor.E_RESIZE)
            }
        } else {
            if (o - l.y < 5) {
                if (d.isRowResizeable() && a.isRowResizeable(u) && h > 1) {
                    b = true;
                    this.setCursor(Cursor.N_RESIZE)
                }
            } else {
                if (l.right() - p < 5) {
                    if (d.isColResizeable() && a.isColResizeable(m) && g > 0) {
                        b = true;
                        this.setCursor(Cursor.E_RESIZE)
                    }
                } else {
                    if (l.bottom() - o < 5) {
                        if (d.isRowResizeable() && a.isRowResizeable(u) && h > 0) {
                            b = true;
                            this.setCursor(Cursor.N_RESIZE)
                        }
                    }
                }
            }
        }
        return b
    },
    createDragTracker: function() {
        return new COM.widget.Grid.ResizeDragTracker(this.getOwner())
    }
});
COM.widget.Grid.SelectionHandle = function SelectionHandle(b, a, c) {
    COM.widget.Grid.SelectionHandle.superclass.constructor.call(this, b, a, c);
    this.innerPad = 2;
    this.initialize()
}
;
COM.widget.Grid.SelectionHandle.extend(COM.gef.AbstractHandle, {
    invalidate: function() {
        COM.widget.Grid.SelectionHandle.superclass.invalidate.call(this)
    },
    createDragTracker: function() {
        return new COM.widget.Grid.SelectionBorderDragTracker(this.getOwner(),this)
    },
    containsPoint: function(a, b) {
        if (!COM.widget.Grid.SelectionHandle.superclass.containsPoint.call(this, a, b)) {
            return false
        }
        return !Rectangle.SINGLETON.setBounds(this.getInnerBounds()).shrink(this.innerPad * 2, this.innerPad * 2).contains(a, b)
    },
    getInnerPad: function() {
        return this.innerPad
    },
    setInnerPad: function(a) {
        this.innerPad = a
    },
    getInnerBounds: function() {
        return this.innerBounds
    },
    setInnerBounds: function(a) {
        this.innerBounds = a
    },
    getAccessibleLocation: function() {
        var a = this.getBounds().getTopRight().translate(-1, this.getBounds().height / 4);
        this.translateToAbsolute(a);
        return a
    },
    initialize: function() {
        this.setOpaque(false);
        this.setBorder(new COM.widget.Grid.SelectionBorder(this.innerPad));
        this.setCursor(Cursor.MOVE)
    }
});
COM.widget.Grid.SelectionBorder = function SelectionBorder(b, a, c) {
    COM.widget.Grid.SelectionBorder.superclass.constructor.call(this, b, a);
    this.dash = c
}
;
COM.widget.Grid.SelectionBorder.extend(LineBorder, {
    paint: function(a, d, b) {
        AbstractBorder.tempRect.setBounds(this.getPaintRectangle(a, b));
        if (this.getWidth() % 2 == 1) {
            AbstractBorder.tempRect.width--;
            AbstractBorder.tempRect.height--
        }
        AbstractBorder.tempRect.shrink(this.getWidth() / 2, this.getWidth() / 2);
        d.setLineWidth(this.getWidth());
        if (this.getColor() != null ) {
            d.setStrokeStyle(this.getColor())
        }
        var c = AbstractBorder.tempRect;
        d.beginPath();
        if (this.dash) {
            d.dashedPolyline(new PointList([c.x, c.y, c.right(), c.y, c.right(), c.bottom(), c.x, c.bottom(), c.x, c.y]), 8, 4);
            d.stroke()
        } else {
            d.strokeRect(c.x, c.y, c.width, c.height)
        }
    },
    getPaintRectangle: function(a, b) {
        var c = a.getInnerBounds();
        AbstractBorder.tempRect.setBounds(c);
        return AbstractBorder.tempRect.crop(b)
    }
});
COM.widget.Grid.GridSelectionHandleLocator = function GridSelectionHandleLocator(a) {
    COM.widget.Grid.GridSelectionHandleLocator.superclass.constructor.call(this);
    this.editPart = a
}
;
COM.widget.Grid.GridSelectionHandleLocator.extend(Object, {
    getEditPart: function() {
        return this.editPart
    },
    relocate: function(d) {
        var a = new Rectangle();
        var b = this.getEditPart().getSelection();
        var c = this.getEditPart().getCellAreaBounds(b, a);
        a.expand(1, 1);
        c.expand(1, 1);
        d.setBounds(c);
        d.setInnerBounds(a)
    },
    setEditPart: function(a) {
        this.editPart = a
    }
});
COM.widget.Grid.SelectionChangeHandle = function SelectionChangeHandle(b, a, c) {
    if (a == null  && b != null ) {
        a = new MoveHandleLocator(b.getFigure())
    }
    COM.widget.Grid.SelectionChangeHandle.superclass.constructor.call(this, b, a, c);
    this.initialize()
}
;
COM.widget.Grid.SelectionChangeHandle.extend(COM.gef.AbstractHandle, {
    createDragTracker: function() {
        return new COM.widget.Grid.SelectionChangeDragTracker(this.getOwner(),this)
    },
    paint: function(a) {
        var b = this.getBounds();
        a.translate(b.x, b.y);
        var c = this.getBackgroundColor();
        a.setFillStyle(c);
        a.fillRect(1, 1, b.width - 2, b.height - 2);
        a.setStrokeStyle("#fff");
        a.setLineWidth(2);
        a.stroke(0, 0, b.width, b.height)
    },
    initialize: function() {
        this.setOpaque(true);
        this.setCursor(Cursor.CROSS_HAIR)
    }
});
COM.widget.Grid.SelectionChangeHandleLocator = function SelectionChangeHandleLocator(a) {
    COM.widget.Grid.SelectionChangeHandleLocator.superclass.constructor.call(this, a)
}
;
COM.widget.Grid.SelectionChangeHandleLocator.extend(COM.gef.MoveHandleLocator, {
    relocate: function(d) {
        var a = this.getReference();
        var b = a.getInnerPad();
        var c = a.getBounds().getCopy();
        c.x = c.right() - b * 2;
        c.y = c.bottom() - b * 2;
        c.width = b * 3;
        c.height = b * 3;
        d.setBounds(c)
    },
    getSize: function() {}
});
COM.widget.Grid.ResizeDragTracker = function ResizeDragTracker(a) {
    COM.widget.Grid.ResizeDragTracker.superclass.constructor.call(this);
    this.editPart = a
}
;
COM.widget.Grid.ResizeDragTracker.extend(COM.gef.SimpleDragTracker, {
    setEditPart: function(a) {
        this.editPart = a
    },
    createSourceRequest: function() {
        var a = new COM.gef.Request();
        return a
    },
    handleButtonDown: function(m) {
        var b = this.getEditPart();
        if (b.isEditing()) {
            b.commitEdit(COM.widget.Grid.CAUSE_MOUSE)
        }
        var o = b.getCellFigureByLocation(this.startX, this.startY);
        if (o == null ) {
            return
        }
        var d = o.getCol();
        var q = o.getRow();
        if (d == null  || q == null ) {
            return
        }
        var p = b.getCell(d, q);
        this.startCol = d;
        this.startRow = q;
        var a = o.getBounds().getCopy();
        var n = d;
        var h = q;
        var g = false;
        var l = b.getModel();
        if (d > 0 && q > 0) {
            n = d + p.colSpan - 1;
            h = q + p.rowSpan - 1
        }
        o.translateToAbsolute(a);
        var c = false;
        if (this.startX - a.x < 5) {
            this.changeColSize = true;
            this.index = d - 1;
            while (!b.isColVisible(this.index)) {
                this.index--
            }
            c = true;
            g = true
        } else {
            if (this.startY - a.y < 5) {
                this.changeColSize = false;
                this.index = q - 1;
                while (!b.isRowVisible(this.index)) {
                    this.index--
                }
                c = true;
                g = true
            } else {
                if (a.right() - this.startX < 5) {
                    this.changeColSize = true;
                    this.index = n;
                    c = true
                } else {
                    if (a.bottom() - this.startY < 5) {
                        this.changeColSize = false;
                        this.index = h;
                        c = true
                    }
                }
            }
        }
        if (c && this.index > -1) {
            this.setFlag(COM.widget.Grid.GridDragTracker.FLAG_CHANGE_SIZE, true);
            if (this.changeColSize) {
                if (g) {
                    this.end = a.x
                } else {
                    this.end = a.right()
                }
                this.begin = this.end - b.getModel().data.cols[this.index].clientSize
            } else {
                if (g) {
                    this.end = a.y
                } else {
                    this.end = a.bottom()
                }
                this.begin = this.end - b.getModel().data.rows[this.index].clientSize
            }
        }
        return COM.widget.Grid.GridDragTracker.superclass.handleButtonDown.call(this, m)
    },
    handleDragInProgress: function() {
        return COM.widget.Grid.GridDragTracker.superclass.handleDragInProgress.call(this)
    },
    handleButtonUp: function(a) {
        return COM.widget.Grid.GridDragTracker.superclass.handleButtonUp.call(this, a)
    },
    getCommand: function() {
        var c = new COM.gef.UnexecutableCommand();
        var b = this.getSourceRequest();
        var a = this.getEditPart();
        var c = a.getCommand(b);
        return c
    },
    getOperationSet: function() {
        return [this.getEditPart()]
    },
    updateSourceRequest: function() {
        var g = this.getSourceRequest();
        var b = this.getCurrentInput();
        var c = b.getMouseLocation();
        var h;
        var d;
        var a;
        if (this.changeColSize) {
            g.setType(COM.widget.Grid.RequestConstants.CHANGE_COL_SIZE);
            h = c.x - this.startX
        } else {
            g.setType(COM.widget.Grid.RequestConstants.CHANGE_ROW_SIZE);
            h = c.y - this.startY
        }
        g.delta = h;
        g.begin = this.begin;
        g.end = this.end;
        g.colRow = this.index
    },
    getEditPart: function() {
        return this.editPart
    },
    calculateCursor: function() {
        if (this.getFlag(COM.widget.Grid.GridDragTracker.FLAG_CHANGE_SIZE)) {
            if (this.changeColSize) {
                return Cursor.E_RESIZE
            } else {
                return Cursor.N_RESIZE
            }
        }
        return null 
    }
});
COM.widget.Grid.SelectionBorderDragTracker = function SelectionBorderDragTracker(a, b) {
    COM.widget.Grid.SelectionBorderDragTracker.superclass.constructor.call(this);
    this.editPart = a;
    this.handle = b
}
;
COM.widget.Grid.SelectionBorderDragTracker.extend(COM.gef.SimpleDragTracker, {
    setEditPart: function(a) {
        this.editPart = a
    },
    createSourceRequest: function() {
        var a = new COM.gef.Request();
        return a
    },
    handleButtonDown: function(b) {
        var a = this.getEditPart();
        if (a.isEditing()) {
            a.commitEdit(COM.widget.Grid.CAUSE_MOUSE)
        }
        var d = a.getRealColRow(this.startX, this.startY);
        this.sourceCol = d.col;
        this.sourceRow = d.row;
        var c = a.getSelection();
        if (c.x > d.col) {
            this.sourceCol++
        } else {
            if (c.right() <= d.col) {
                this.sourceCol--
            }
        }
        if (c.y > d.row) {
            this.sourceRow++
        } else {
            if (c.bottom() <= d.row) {
                this.sourceRow--
            }
        }
        this.button = b;
        return COM.widget.Grid.GridDragTracker.superclass.handleButtonDown.call(this, b)
    },
    handleButtonUp: function(a) {
        this.button = null ;
        return COM.widget.Grid.SelectionBorderDragTracker.superclass.handleButtonUp.call(this, a)
    },
    getCommand: function() {
        var c = new COM.gef.UnexecutableCommand();
        var b = this.getSourceRequest();
        var a = this.getEditPart();
        var c = a.getCommand(b);
        return c
    },
    getOperationSet: function() {
        return [this.getEditPart()]
    },
    handleDragInProgress: function() {
        var c = this.getEditPart();
        var a = this.getCurrentInput();
        var b = a.getMouseLocation();
        var d = c.getRealColRow(b.x, b.y);
        this.targetCol = d.col;
        this.targetRow = d.row;
        return COM.widget.Grid.SelectionBorderDragTracker.superclass.handleDragInProgress.call(this)
    },
    updateSourceRequest: function() {
        var c = this.getSourceRequest();
        var a = this.getEditPart();
        c.setType(COM.widget.Grid.RequestConstants.SELECTION_MOVE);
        var b = a.getSelection().getCopy();
        Debugger.log("move:" + (this.targetCol - this.sourceCol) + "," + (this.targetRow - this.sourceRow));
        Debugger.log("before:" + b.x + "," + b.y + "," + b.width + "," + b.height);
        b.translate(this.targetCol - this.sourceCol, this.targetRow - this.sourceRow);
        Debugger.log("after:" + b.x + "," + b.y + "," + b.width + "," + b.height);
        c.rect = b;
        c.button = this.button
    },
    getEditPart: function() {
        return this.editPart
    }
});
COM.widget.Grid.GridDragTracker = function GridDragTracker(a) {
    COM.widget.Grid.GridDragTracker.superclass.constructor.call(this);
    this.editPart = a
}
;
COM.widget.Grid.GridDragTracker.extend(COM.gef.SimpleDragTracker, {
    setEditPart: function(a) {
        this.editPart = a
    },
    handleDoubleClick: function(d) {
        var c = this.getEditPart();
        if (c.revalTimeout) {
            clearTimeout(c.revalTimeout);
            c.revalTimeout = null 
        }
        var a = this.getCurrentInput();
        var b = a.getMouseLocation();
        var g = c.getColRow(b.x, b.y);
        if (g && g.col != null  && g.row != null ) {}
        if (g && g.col && g.row) {
            if (g.col == c.currentCellCol && g.row == c.currentCellRow) {
                c.editCurrentCell({
                    type: COM.widget.Grid.CAUSE_MOUSE,
                    value: d
                })
            }
        }
    },
    handleButtonDown: function(a) {
        var q = this.getEditPart();
        this.button = a;
        var g = q.getColRow(this.startX, this.startY);
        q.locateFocusReciver(this.startX, this.startY);
        if (g == null ) {
            return
        }
        var v;
        if (a == 2) {
            var d = q.getSelections();
            for (var s = 0; s < d.length; s++) {
                var u = d[s];
                if (g.col >= u.x && g.col < u.right() && g.row >= u.y && g.row < u.bottom()) {
                    v = true;
                    break
                }
            }
        }
        var b = q.getCell(g.col, g.row);
        Debugger.log("cell:");
        Debugger.log(b);
        var p = q.getModel().getCol(g.col);
        var h = q.getModel().getRow(g.row);
        Debugger.log("col:");
        Debugger.log(p);
        Debugger.log("row:");
        Debugger.log(h);
        var m = this.getCurrentInput();
        q.fireEvent(COM.widget.Grid.Event.CELL_MOUSE_DOWN, {
            cell: q.getCellController(g.col, g.row),
            x: this.startX,
            y: this.startY,
            origin: m.getBrowserEvent()
        });
        this.startCol = g.col;
        this.startRow = g.row;
        var c = q.getModel();
        var n = false;
        if (v) {
            return COM.widget.Grid.GridDragTracker.superclass.handleButtonDown.call(this, a)
        }
        var r;
        var w;
        if (g.col >= 1 && g.row >= 1) {
            if (b.selectable) {
                if (m.isShiftKeyDown() && q.getSelectionMode() != COM.widget.Grid.SELECTION_MODE_SINGLE) {
                    var o = q.getCurrentCellColRow();
                    w = new Rectangle(Math.min(o.col, g.col),Math.min(o.row, g.row),Math.abs(o.col - g.col) + 1,Math.abs(o.row - g.row) + 1)
                } else {
                    r = {
                        col: g.col,
                        row: g.row
                    };
                    this.sourceCol = g.col;
                    this.sourceRow = g.row;
                    this.targetRow = g.row;
                    this.targetCol = g.col;
                    w = this.createSelections(this.sourceCol, this.sourceRow, this.targetCol, this.targetRow)
                }
            }
        } else {
            if (g.col == 0 && g.row == 0) {
                n = true;
                if (q.getSelectionMode() != COM.widget.Grid.SELECTION_MODE_SINGLE) {
                    if (m.isShiftKeyDown()) {
                        var o = q.getCurrentCellColRow();
                        var w = new Rectangle(1,1,q.getModel().data.colCount - 1,q.getModel().data.rowCount - 1)
                    } else {
                        r = {
                            col: q.getFirstCurrentCol(),
                            row: q.getFirstCurrentRow()
                        };
                        this.sourceCol = 1;
                        this.sourceRow = 1;
                        var w = new Rectangle(1,1,q.getModel().data.colCount - 1,q.getModel().data.rowCount - 1)
                    }
                }
            } else {
                if (g.col == 0) {
                    n = true;
                    if ((q.getSelectionMode() == COM.widget.Grid.SELECTION_MODE_MULTI || q.getSelectionMode() == COM.widget.Grid.SELECTION_MODE_ROW) && q.getModel().isRowSelectable()) {
                        if (m.isShiftKeyDown()) {
                            var o = q.getCurrentCellColRow();
                            var w = new Rectangle(1,Math.min(g.row, o.row),q.getModel().data.colCount - 1,Math.abs(g.row - o.row) + 1)
                        } else {
                            r = {
                                col: q.getFirstCurrentCol(),
                                row: g.row
                            };
                            this.sourceCol = 1;
                            this.sourceRow = g.row;
                            w = new Rectangle(1,g.row,q.getModel().data.colCount - 1,1)
                        }
                    }
                } else {
                    if (g.row == 0) {
                        n = true;
                        if (c.isColExchangeable()) {
                            this.changeColSource = g.col;
                            this.setFlag(COM.widget.Grid.GridDragTracker.FLAG_EXCHANGE_COL, true)
                        } else {
                            if ((q.getSelectionMode() == COM.widget.Grid.SELECTION_MODE_MULTI || q.getSelectionMode() == COM.widget.Grid.SELECTION_MODE_COL) && q.getModel().isColSelectable()) {
                                if (m.isShiftKeyDown()) {
                                    var o = q.getCurrentCellColRow();
                                    var w = new Rectangle(Math.min(g.col, o.col),1,Math.abs(g.col - o.col) + 1,q.getModel().data.rowCount - 1)
                                } else {
                                    r = {
                                        col: g.col,
                                        row: q.getFirstCurrentRow()
                                    };
                                    this.sourceCol = g.col;
                                    this.sourceRow = 1;
                                    w = new Rectangle(g.col,1,1,q.getModel().data.rowCount - 1)
                                }
                            }
                        }
                    }
                }
            }
        }
        if (r) {
            var l = q.setCurrentCell(r.col, r.row, {
                type: COM.widget.Grid.CAUSE_MOUSE,
                value: a
            }, null , true);
            if (l != null ) {
                var t = m.getBrowserEvent();
                if (t.preventDefault) {
                    t.preventDefault()
                } else {
                    t.returnValue = false
                }
            }
        }
        if (w && w.height > 0 && w.bottom() <= q.getModel().data.rowCount && w.width > 0 && w.right() <= q.getModel().data.colCount) {
            this.setFlag(COM.widget.Grid.GridDragTracker.FLAG_SELECT, true);
            if (m.isControlKeyDown() && q.getSelectionMode() != COM.widget.Grid.SELECTION_MODE_SINGLE) {
                q.addSelection(w, n)
            } else {
                if (m.isShiftKeyDown() && q.getSelectionMode() != COM.widget.Grid.SELECTION_MODE_SINGLE) {
                    q.setSelection(w, n)
                } else {
                    q.select(w, n)
                }
            }
        }
        return COM.widget.Grid.GridDragTracker.superclass.handleButtonDown.call(this, a)
    },
    createSelections: function(d, l, c, g) {
        var b, m, h, a;
        b = Math.min(d, c);
        m = Math.min(l, g);
        h = Math.abs(d - c) + 1;
        a = Math.abs(l - g) + 1;
        return new Rectangle(b,m,h,a)
    },
    handleButtonUp: function(d) {
        var c = this.getEditPart();
        var a = this.getCurrentInput();
        var b = a.getMouseLocation();
        var g = c.getColRow(b.x, b.y);
        if (g) {
            c.fireEvent(COM.widget.Grid.Event.CELL_MOUSE_UP, {
                cell: c.getCellController(g.col, g.row),
                x: b.x,
                y: b.y,
                origin: a.getBrowserEvent()
            })
        }
        if (this.getFlag(COM.widget.Grid.GridDragTracker.FLAG_SELECT)) {
            c.fireEvent(COM.widget.Grid.Event.SELECTION);
            this.clearScrollTimer()
        }
        this.setFlag(COM.widget.Grid.GridDragTracker.FLAG_SELECT, false);
        this.setFlag(COM.widget.Grid.GridDragTracker.FLAG_EXCHANGE_COL, false);
        return COM.widget.Grid.GridDragTracker.superclass.handleButtonUp.call(this, d)
    },
    clearScrollTimer: function() {
        if (this.scrollTimer) {
            clearTimeout(this.scrollTimer);
            this.scrollTimer = null 
        }
    },
    beginToScrollDown: function() {
        if (this.scrollTimer == null ) {
            var a = this;
            var b = this.getEditPart();
            this.scrollTimer = setInterval(function() {
                b.scrollVerti(true, 1);
                a._doDragSelect({
                    col: a.targetCol,
                    row: b.drawEndRow
                }, b);
                if (b.drawEndRow >= b.footerStartRow - 1) {
                    a.clearScrollTimer()
                }
            }, 30)
        }
    },
    beginToScrollUp: function() {
        if (this.scrollTimer == null ) {
            var a = this;
            var b = this.getEditPart();
            this.scrollTimer = setInterval(function() {
                b.scrollVerti(false, 1);
                a._doDragSelect({
                    col: a.targetCol,
                    row: b.drawStartRow
                }, b);
                if (b.drawStartRow <= b.getModel().getRowHeaderCount()) {
                    a.clearScrollTimer()
                }
            }, 30)
        }
    },
    beginToScrollRight: function() {
        if (this.scrollTimer == null ) {
            var a = this;
            var b = this.getEditPart();
            this.scrollTimer = setInterval(function() {
                b.scrollHoriz(true, 1);
                a._doDragSelect({
                    col: b.drawEndCol,
                    row: a.targetRow
                }, b);
                if (b.drawEndCol >= b.footerStartCol - 1) {
                    a.clearScrollTimer()
                }
            }, 30)
        }
    },
    beginToScrollLeft: function() {
        if (this.scrollTimer == null ) {
            var a = this;
            var b = this.getEditPart();
            this.scrollTimer = setInterval(function() {
                b.scrollHoriz(false, 1);
                a._doDragSelect({
                    col: b.drawStartCol,
                    row: a.targetRow
                }, b);
                if (b.drawStartCol <= b.getModel().getColHeaderCount()) {
                    a.clearScrollTimer()
                }
            }, 30)
        }
    },
    scrollToRight: function() {
        var a = this.getEditPart();
        a.setScrollLeft(a.getScrollWidth())
    },
    scrollToLeft: function() {
        var a = this.getEditPart();
        a.setScrollLeft(0)
    },
    scrollToBottom: function() {
        var a = this.getEditPart();
        a.setScrollTop(a.getScrollHeight())
    },
    scrollToTop: function() {
        var a = this.getEditPart();
        a.setScrollTop(0)
    },
    handleDragInProgress: function() {
        var c = this.getEditPart();
        var a = this.getCurrentInput();
        var b = a.getMouseLocation();
        var h = c.getColRow(b.x, b.y);
        if (h == null ) {
            return
        }
        var d = c.getCellController(this.startCol, this.startRow);
        var g = c.getCellController(h.col, h.row);
        c.fireEvent(COM.widget.Grid.Event.CELL_DRAG, {
            source: d,
            target: g,
            x: b.x,
            y: b.y,
            origin: a.getBrowserEvent()
        });
        if (this.getFlag(COM.widget.Grid.GridDragTracker.FLAG_EXCHANGE_COL)) {
            this.changeColTarget = h.col;
            this.updateSourceRequest();
            this.showSourceFeedback()
        } else {
            if (this.getFlag(COM.widget.Grid.GridDragTracker.FLAG_SELECT)) {
                if (this.targetRow != h.row || this.targetCol != h.col) {
                    if (this._selectBringScroll(h, c)) {
                        h = c.getColRow(b.x, b.y);
                        if (h == null ) {
                            return
                        }
                        d = c.getCellController(this.startCol, this.startRow);
                        g = c.getCellController(h.col, h.row);
                        c.fireEvent(COM.widget.Grid.Event.CELL_DRAG, {
                            source: d,
                            target: g,
                            x: b.x,
                            y: b.y,
                            origin: a.getBrowserEvent()
                        });
                        Debugger.log("again")
                    }
                    this._doDragSelect(h, c)
                }
            }
        }
        return COM.widget.Grid.GridDragTracker.superclass.handleDragInProgress.call(this)
    },
    _selectBringScroll: function(b, a) {
        var c = false;
        if (b.row >= a.drawEndRow && this.sourceRow <= a.drawEndRow && b.row > this.sourceRow && a.drawEndRow < a.footerStartRow - 1) {
            this.beginToScrollDown()
        } else {
            if (b.row <= a.drawStartRow && this.sourceRow >= a.drawStartRow && b.row < this.sourceRow && a.drawStartRow > a.getModel().getRowHeaderCount()) {
                this.beginToScrollUp()
            } else {
                if (b.col >= a.drawEndCol && this.sourceCol <= a.drawEndCol && b.col > this.sourceCol && a.drawEndCol < a.footerStartCol - 1) {
                    this.beginToScrollRight()
                } else {
                    if (b.col <= a.drawStartCol && this.sourceCol >= a.drawStartCol && b.col < this.sourceCol && a.drawStartCol > a.getModel().getColHeaderCount()) {
                        this.beginToScrollLeft()
                    } else {
                        if (b.col <= a.drawEndCol && this.sourceCol >= a.footerStartCol && !this._colInSelection(a.footerStartCol - 1, a)) {
                            this.scrollToRight();
                            c = true
                        } else {
                            if (b.col >= a.drawStartCol && this.sourceCol < a.getModel().getColHeaderCount() && !this._colInSelection(a.getModel().getColHeaderCount() + 1, a)) {
                                this.scrollToLeft();
                                c = true
                            } else {
                                if (b.row <= a.drawEndRow && this.sourceRow >= a.footerStartRow && !this._rowInSelection(a.footerStartRow - 1, a)) {
                                    this.scrollToBottom();
                                    c = true
                                } else {
                                    if (b.row >= a.drawStartRow && this.sourceRow < a.getModel().getRowHeaderCount() && !this._rowInSelection(a.getModel().getRowHeaderCount() + 1, a)) {
                                        this.scrollToTop();
                                        c = true
                                    } else {
                                        this.clearScrollTimer()
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
        return c
    },
    _rowInSelection: function(c, a) {
        var b = a.getSelection();
        return b.y <= c && b.y + b.height >= c
    },
    _colInSelection: function(b, a) {
        var c = a.getSelection();
        return c.x <= b && c.x + c.width >= b
    },
    _doDragSelect: function(d, a) {
        var c = false;
        if (this.targetRow != d.row || this.targetCol != d.col) {
            this.targetRow = d.row;
            this.targetCol = d.col;
            var b;
            if (d.col >= 1 && d.row >= 1) {
                if (a.getSelectionMode() == COM.widget.Grid.SELECTION_MODE_SINGLE) {
                    a.setCurrentCell(Math.max(d.col, 1), Math.max(d.row, 1), {
                        type: COM.widget.Grid.CAUSE_MOUSE,
                        value: this.button
                    });
                    b = new Rectangle(d.col,d.row,1,1)
                } else {
                    b = this.createSelections(this.sourceCol, this.sourceRow, this.targetCol, this.targetRow)
                }
            } else {
                if (d.col == 0 && d.row == 0) {} else {
                    if (d.col == 0) {
                        c = true;
                        if (this.startCol == 0 && (a.getSelectionMode() == COM.widget.Grid.SELECTION_MODE_MULTI || a.getSelectionMode() == COM.widget.Grid.SELECTION_MODE_ROW) && a.getModel().isRowSelectable()) {
                            b = this.createSelections(this.sourceCol, this.sourceRow, a.getModel().data.colCount - 1, d.row)
                        }
                    } else {
                        if (d.row == 0) {
                            c = true;
                            if (this.startRow == 0 && (a.getSelectionMode() == COM.widget.Grid.SELECTION_MODE_MULTI || a.getSelectionMode() == COM.widget.Grid.SELECTION_MODE_COL) && a.getModel().isColSelectable()) {
                                b = this.createSelections(this.sourceCol, this.sourceRow, d.col, a.getModel().data.rowCount - 1)
                            }
                        }
                    }
                }
            }
            if (b) {
                a.setSelection(b, c)
            }
        }
    },
    getCommand: function() {
        var c = new COM.gef.UnexecutableCommand();
        if (this.getFlag(COM.widget.Grid.GridDragTracker.FLAG_EXCHANGE_COL)) {
            var b = this.getSourceRequest();
            var a = this.getEditPart();
            var c = a.getCommand(b)
        }
        return c
    },
    handleDragStarted: function() {
        var b = this.getEditPart();
        var a = this.getCurrentInput();
        b.fireEvent(COM.widget.Grid.Event.CELL_DRAG_START, {
            cell: b.getCellController(this.startCol, this.startRow),
            x: this.startX,
            y: this.startY,
            origin: a.getBrowserEvent()
        });
        return COM.widget.Grid.GridDragTracker.superclass.handleDragStarted.call(this)
    },
    getOperationSet: function() {
        return [this.getEditPart()]
    },
    updateSourceRequest: function() {
        var b = this.getSourceRequest();
        var a = this.getCurrentInput().getMouseLocation();
        if (this.getFlag(COM.widget.Grid.GridDragTracker.FLAG_EXCHANGE_COL)) {
            b.setType(COM.widget.Grid.RequestConstants.COL_EXCHANGE);
            b.source = this.changeColSource;
            b.target = this.changeColTarget;
            b.deltaX = a.x - this.startX;
            b.deltaY = a.y - this.startY
        }
    },
    getCommandName: function() {
        return "Grid Tracker"
    },
    getEditPart: function() {
        return this.editPart
    },
    touchStart: function(b, c) {
        this.touchStartEvent = b;
        var a = this.getEditPart();
        this.touchStartScrollLocation = {
            x: a.getScrollLeft(),
            y: a.getScrollTop()
        };
        this.touchMoveDirection = 0
    },
    touchMove: function(a, b) {
        switch (this.touchMoveDirection) {
        case COM.widget.Grid.GridDragTracker.TOUCH_MOVE_VERTI:
            this.touchMoveVerti(a);
            break;
        case COM.widget.Grid.GridDragTracker.TOUCH_MOVE_HORIZ:
            this.touchMoveHoriz(a);
            break;
        default:
            if (this.touchMoveVerti(a)) {
                this.touchMoveDirection = COM.widget.Grid.GridDragTracker.TOUCH_MOVE_VERTI
            } else {
                if (this.touchMoveHoriz(a)) {
                    this.touchMoveDirection = COM.widget.Grid.GridDragTracker.TOUCH_MOVE_HORIZ
                }
            }
        }
        a.e.preventDefault()
    },
    touchMoveHoriz: function(h) {
        var c = this.touchStartEvent;
        var g = c.x;
        var b = h.x;
        var a = b - g;
        var m = COM.widget.Grid.GridDragTracker.TOUCH_MOVE_MIN;
        var l = 0;
        if (a > m || a < m * -1) {
            l = a
        }
        if (l != 0) {
            var d = this.getEditPart();
            d.setScrollLeft(this.touchStartScrollLocation.x - l);
            return true
        } else {
            return false
        }
    },
    touchMoveVerti: function(h) {
        var d = this.touchStartEvent;
        var c = d.y;
        var b = h.y;
        var a = b - c;
        var m = COM.widget.Grid.GridDragTracker.TOUCH_MOVE_MIN;
        var l = 0;
        if (a > m || a < m * -1) {
            l = a
        }
        if (l != 0) {
            var g = this.getEditPart();
            g.setScrollTop(this.touchStartScrollLocation.y - l);
            return true
        } else {
            return false
        }
    },
    touchEnd: function(a, b) {
        this.touchStartEvent = null ;
        this.touchStartScrollLocation = null ;
        this.touchMoveDirection = 0
    }
});
COM.widget.Grid.GridDragTracker.FLAG_SELECT = COM.gef.SimpleDragTracker.FLAG_SOURCE_FEEDBACK << 1;
COM.widget.Grid.GridDragTracker.FLAG_EXCHANGE_COL = COM.widget.Grid.GridDragTracker.FLAG_SELECT << 1;
COM.widget.Grid.GridDragTracker.MAX_FLAG = COM.widget.Grid.GridDragTracker.FLAG_EXCHANGE_COL;
COM.widget.Grid.GridDragTracker.TOUCH_MOVE_MIN = 20;
COM.widget.Grid.GridDragTracker.TOUCH_MOVE_VERTI = 1;
COM.widget.Grid.GridDragTracker.TOUCH_MOVE_HORIZ = 2;
COM.widget.Grid.SelectionChangeDragTracker = function SelectionChangeDragTracker(a, b) {
    COM.widget.Grid.SelectionChangeDragTracker.superclass.constructor.call(this);
    this.editPart = a;
    this.handle = b
}
;
COM.widget.Grid.SelectionChangeDragTracker.extend(COM.gef.SimpleDragTracker, {
    setEditPart: function(a) {
        this.editPart = a
    },
    createSourceRequest: function() {
        var a = new COM.gef.Request();
        return a
    },
    handleButtonDown: function(b) {
        var a = this.getEditPart();
        if (a.isEditing()) {
            a.commitEdit(COM.widget.Grid.CAUSE_MOUSE)
        }
        var c = a.getRealColRow(this.startX, this.startY);
        this.sourceCol = c.col;
        this.sourceRow = c.row;
        this.button = b;
        return COM.widget.Grid.SelectionChangeDragTracker.superclass.handleButtonDown.call(this, b)
    },
    handleButtonUp: function(a) {
        this.button = null ;
        return COM.widget.Grid.SelectionChangeDragTracker.superclass.handleButtonUp.call(this, a)
    },
    getCommand: function() {
        var c = new COM.gef.UnexecutableCommand();
        var b = this.getSourceRequest();
        var a = this.getEditPart();
        var c = a.getCommand(b);
        return c
    },
    getOperationSet: function() {
        return [this.getEditPart()]
    },
    handleDragInProgress: function() {
        var c = this.getEditPart();
        var a = this.getCurrentInput();
        var b = a.getMouseLocation();
        var d = c.getRealColRow(b.x, b.y);
        this.targetCol = d.col;
        this.targetRow = d.row;
        return COM.widget.Grid.SelectionChangeDragTracker.superclass.handleDragInProgress.call(this)
    },
    updateSourceRequest: function() {
        var h = this.getSourceRequest();
        var c = this.getEditPart();
        h.setType(COM.widget.Grid.RequestConstants.SELECTION_MOVE);
        var g = c.getSelection().getCopy();
        var b = g.x;
        var m = g.y;
        var d = g.right() - 1;
        var a = g.bottom() - 1;
        var l = this.getCurrentInput().getMouseLocation();
        if (Math.abs(l.x - this.startX) > Math.abs(l.y - this.startY)) {
            if (this.targetCol > g.x) {
                d = this.targetCol
            } else {
                b = this.targetCol
            }
        } else {
            if (this.targetRow > g.y) {
                a = this.targetRow
            } else {
                m = this.targetRow
            }
        }
        h.rect = new Rectangle(b,m,d - b + 1,a - m + 1);
        h.button = this.button
    },
    getEditPart: function() {
        return this.editPart
    }
});
(function() {
    function b(l, h, g) {
        (l.attachEvent) ? (l.attachEvent("on" + h, g)) : (l.addEventListener(h, g, false))
    }
    function d(n, g) {
        var l = g.getBounds().getCopy();
        g.translateToAbsolute(l);
        n.style.position = "absolute";
        var h = g.getRightBorderWidth ? g.getRightBorderWidth() : 0;
        var m = g.getBottomBorderWidth ? g.getBottomBorderWidth() : 0;
        n.style.left = l.right() - COM.widget.Grid.Grid2Adapter.FACE_WIDTH - h + "px";
        n.style.top = l.y + "px";
        n.style.width = COM.widget.Grid.Grid2Adapter.FACE_WIDTH + "px";
        n.style.height = l.height - m + "px"
    }
    function a() {
        this.faces = {};
        this.activeFace;
        this.activeCell = null ;
        this.isShowing = false
    }
    a.extend(Object, {
        onCurrentCellChanged: function(g) {
            this.hideFace(this.activeCell, g.grid);
            this.activeCell = null ;
            if (!g.grid.canCellEdit(g.col, g.row)) {
                return
            }
            if (this.showFace(g.col, g.row, g.grid)) {
                this.activeCell = g.grid.getCell(g.col, g.row)
            }
        },
        onEditorOpen: function(g) {
            this.hideFace(this.activeCell, g.grid);
            this.activeCell = null 
        },
        onEditModeChanged: function(g) {
            if (this.isShowing) {
                if (!g.grid.canCellEdit(g.col, g.row)) {
                    this.hideFace(this.activeCell, g.grid)
                }
            } else {
                if (g.grid.canCellEdit(g.col, g.row)) {
                    this.onCurrentCellChanged(g)
                }
            }
        },
        showFace: function(m, q, n) {
            if (m == -1 || q == -1) {
                return
            }
            var h = n.getCell(m, q);
            var o;
            if (h) {
                o = this.faceGetter(h);
                var p = this.getFace(o);
                if (p) {
                    b(p, "click", function() {
                        n.editCurrentCell({
                            type: COM.widget.Grid.CAUSE_CLICKFACE
                        })
                    });
                    var g = h.getFigure();
                    if (g) {
                        g.addFigureListener(this)
                    }
                    p.style.display = "";
                    var l = this.getZindex(g);
                    if (null  == l) {
                        l = 9
                    }
                    p.style.zIndex = l;
                    d(p, g);
                    this.activeFace = p;
                    this.activeFigure = g;
                    this.isShowing = true;
                    this.visible = true;
                    return true
                }
            }
        },
        getZindex: function(g) {
            var h = g.getParent();
            if (h && h.getZindex) {
                return h.getZindex(g)
            }
        },
        figureMoved: function(g) {
            if (!this.activeFace) {
                return
            }
            d(this.activeFace, g)
        },
        hideFace: function(h, l) {
            if (this.activeFace) {
                this.activeFace.style.display = "none";
                this.activeFace = null 
            }
            if (h) {
                var g = h.getFigure();
                if (g) {
                    g.removeFigureListener(this)
                }
            }
            this.visible = false;
            this.isShowing = false;
            this.activeFigure = null 
        },
        checkVisible: function(g) {
            if (this.isShowing && this.activeFigure && this.activeFace) {
                if (this.activeFigure.getParent() != null  && !this.visible) {
                    this.activeFace.style.display = "";
                    this.visible = true
                } else {
                    if (this.activeFigure.getParent() == null  && this.visible) {
                        this.activeFace.style.display = "none";
                        this.visible = false
                    }
                }
            }
        },
        setFace: function(g, h) {
            this.faces[g] = h
        },
        getFace: function(g) {
            return this.faces[g]
        },
        getFaces: function() {
            return this.faces
        }
    });
    COM.widget.Grid.Grid2Adapter = function c() {
        this.faceController = new a();
        this.configs = {}
    }
    ;
    COM.widget.Grid.Grid2Adapter.extend(Object, {
        init: function(l) {
            l.addListener("currentCellChanged", this.faceController.onCurrentCellChanged, this.faceController);
            l.addListener("editorOpen", this.faceController.onEditorOpen, this.faceController);
            l.addListener("editModeChanged", this.faceController.onEditModeChanged, this.faceController);
            l.addListener("layout", this.faceController.checkVisible, this.faceController);
            l.addListener("reload", this.reAppend, this);
            var g = this.faceController.getFaces();
            var m = null ;
            for (var h in g) {
                m = g[h];
                m.style.display = "none";
                l.appendChild(m)
            }
        },
        reAppend: function(n) {
            var l = n.grid;
            var g = this.faceController.getFaces();
            var m = null ;
            for (var h in g) {
                m = g[h];
                l.appendChild(m)
            }
        },
        getFaceController: function() {
            return this.faceController
        },
        setFace: function(g, h) {
            this.faceController.setFace(g, h)
        },
        getFace: function(g) {
            return this.faceController.getFace(g)
        },
        setGetFaceFun: function(g) {
            this.faceController.faceGetter = g
        }
    });
    COM.widget.Grid.Grid2Adapter.FACE_TYPE_LIST = 1;
    COM.widget.Grid.Grid2Adapter.FACE_TYPE_POP = 2;
    COM.widget.Grid.Grid2Adapter.FACE_WIDTH = 20
})();
DNA.widget.OleFrame = function(a) {
    DNA.widget.OleFrame.superclass.constructor.call(this, a)
}
;
DNA.widget.OleFrame.extend(DNA.widget.Control, {
    computeSize: function(d, b, g) {
        var c = new DNA.widget.Point();
        if (!d || d == DNA.JWT.DEFAULT) {
            c.x = 200
        } else {
            c.x = d
        }
        if (!b || b == DNA.JWT.DEFAULT) {
            c.y = 200
        } else {
            c.y = b
        }
        var a = this.getBorderSize();
        c.x += a;
        c.y += a;
        return c
    },
    _setBorder: null ,
    _doBuildElements: function() {},
    getObjectEl: function() {
        try {
            return this.getEl().firstChild.contentWindow.objectEl
        } catch (a) {
            return null 
        }
    },
    _registerEvents: function() {},
    _resize: function() {},
    _disposeDOM: function() {
        if (this.checkRendered(true)) {
            var a = this.getObjectEl();
            if (!a) {
                return
            }
            if (DNA.engine.Client.isIE()) {
                a.style.display = "none";
                this.removeObjectInIE(a)
            } else {
                a.parentNode.removeChild(a)
            }
        }
    },
    removeObjectInIE: function(b) {
        if (b) {
            for (var a in b) {
                if (typeof b[a] == "function") {
                    b[a] = null 
                }
            }
            b.parentNode.removeChild(b)
        }
    },
    _disposeFields: function() {}
});
Object.override(DNA.widget.OleFrame.prototype, {
    jtype: "OleFrame",
    focusable: true
});
DNA.widget.OleNativeFrame = function(a) {
    DNA.widget.OleNativeFrame.superclass.constructor.call(this, a)
}
;
DNA.widget.OleNativeFrame.extend(DNA.widget.Control, {
    computeSize: function(d, b, g) {
        var c = new DNA.widget.Point();
        if (!d || d == DNA.JWT.DEFAULT) {
            c.x = 200
        } else {
            c.x = d
        }
        if (!b || b == DNA.JWT.DEFAULT) {
            c.y = 200
        } else {
            c.y = b
        }
        var a = this.getBorderSize();
        c.x += a;
        c.y += a;
        return c
    },
    _setBorder: null ,
    _doBuildElements: function() {},
    getObjectEl: function() {
        try {
            return this.getEl().firstChild.contentWindow.objectEl
        } catch (a) {
            return null 
        }
    },
    _registerEvents: function() {},
    _resize: function() {},
    _disposeDOM: function() {
        if (this.checkRendered(true)) {
            var a = this.getObjectEl();
            if (!a) {
                return
            }
            if (DNA.engine.Client.isIE()) {
                a.style.display = "none";
                this.removeObjectInIE(a)
            } else {
                a.parentNode.removeChild(a)
            }
        }
    },
    removeObjectInIE: function(b) {
        if (b) {
            for (var a in b) {
                if (typeof b[a] == "function") {
                    b[a] = null 
                }
            }
            b.parentNode.removeChild(b)
        }
    },
    _disposeFields: function() {}
});
Object.override(DNA.widget.OleNativeFrame.prototype, {
    jtype: "OleNativeFrame",
    focusable: true
});
DNA.widget.FileUploader = function(a) {
    DNA.widget.FileUploader.superclass.constructor.call(this, a)
}
;
DNA.widget.FileUploader.extend(DNA.widget.OleFrame, {
    getHostControl: function() {
        return DNA.widget.WidgetRegistry.get(this.getInitData()[DNA.JWTProperty.PROPERTY_MENU_HOST])
    },
    setFileFilter: function(g, d) {
        var a = null ;
        for (var c = 0; c < d.length; c++) {
            a = a + d[c];
            if (c != d.length - 1) {
                a = a + ";"
            }
        }
        try {
            this.checkRendered(true);
            this.getObjectEl().setFileFilter(g, a)
        } catch (b) {
            if (DNA.JWTProperty.DEVOLOPE_MODE) {
                alert(b.description)
            }
        }
    },
    upload: function(d) {
        var a = "";
        for (var c = 0; c < d.length; c++) {
            a = a + d[c];
            if (c != d.length - 1) {
                a = a + "|"
            }
        }
        try {
            this.checkRendered(true);
            this.getObjectEl().uploadFiles(a)
        } catch (b) {
            if (DNA.JWTProperty.DEVOLOPE_MODE) {
                alert(b.description)
            }
        }
    },
    uploadAll: function() {
        try {
            this.checkRendered(true);
            this.getObjectEl().uploadAllFiles()
        } catch (a) {
            if (DNA.JWTProperty.DEVOLOPE_MODE) {
                alert(a.description)
            }
        }
    },
    getSelectedFiles: function() {
        try {
            this.checkRendered(true);
            var a = (new Function("","return " + this.getObjectEl().getSelectedFiles()))();
            return a
        } catch (b) {
            if (DNA.JWTProperty.DEVOLOPE_MODE) {
                alert(b.description)
            }
        }
    },
    removeSelectedFiles: function(d) {
        var a = "";
        for (var c = 0; c < d.length; c++) {
            a = a + d[c];
            if (c != d.length - 1) {
                a = a + "|"
            }
        }
        try {
            this.checkRendered(true);
            this.getObjectEl().removeSelectedFiles(a)
        } catch (b) {
            if (DNA.JWTProperty.DEVOLOPE_MODE) {
                alert(b.description)
            }
        }
    },
    clear: function() {
        try {
            this.checkRendered(true);
            this.getObjectEl().clear()
        } catch (a) {
            if (DNA.JWTProperty.DEVOLOPE_MODE) {
                alert(a.description)
            }
        }
    },
    showFileUploader: function() {
        var g = this.getHostControl();
        if (null  == g) {
            return
        }
        var b = DNA.engine.application.getTopWindowZIndexAnd1();
        DNA.engine.DomUtil.setStyle(this.el, "z-index", b);
        var c = this.getEl();
        var d = null ;
        if (g.jtype == "Text") {
            d = g.getButtonBounds()
        } else {
            d = g._getPageBounds()
        }
        if (!d) {
            return
        }
        var a = DNA.engine.DomUtil.getPageXY(c);
        if (a.x == d.x && a.y == d.y) {
            return
        }
        DNA.engine.DomUtil.setPageXY(c, d.x, d.y);
        this.setSize(d.width, d.height)
    },
    hideFileUploader: function() {
        var d = this.getHostControl();
        if (null  == d) {
            return
        }
        var b = this.getEl();
        var c = null ;
        if (d.jtype == "Text") {
            c = d.getButtonBounds()
        } else {
            c = d._getPageBounds()
        }
        if (!c) {
            return
        }
        var a = DNA.engine.DomUtil.getPageXY(b);
        if (a.x == c.x && a.y == c.y) {
            return
        }
        this.getEl().style.left = DNA.JWTProperty.SYS_HIDDEN_X + "px"
    }
});
Object.override(DNA.widget.FileUploader.prototype, {
    jtype: "FileUploader",
    focusable: true
});
DNA.widget.StackLayoutComposite = function(a) {
    DNA.widget.StackLayoutComposite.superclass.constructor.call(this, a)
}
;
DNA.widget.StackLayoutComposite.extend(DNA.widget.Composite, {
    autoRender: true,
    setBounds: function(b, h, g, a) {
        var d = this.getChildren();
        for (var c = 0; c < d.length; c++) {
            d[c].setBounds(0, 0, g, a)
        }
        DNA.widget.StackLayoutComposite.superclass.setBounds.call(this, b, h, g, a)
    },
    _registEvents: function() {}
});
Object.override(DNA.widget.StackLayoutComposite.prototype, {
    jtype: "StackLayoutComposite",
    focusable: true
});
DNA.widget.ShowNotNullFlagLabel = function(a) {
    DNA.widget.ShowNotNullFlagLabel.superclass.constructor.call(this, a)
}
;
DNA.widget.ShowNotNullFlagLabel.extend(DNA.widget.TextLabel, {
    setIsShowNotNullFlag: function(g) {
        var c = this.el;
        var b = c.getElementsByTagName("span");
        if (g == "false" || g == false) {
            if (b.length >= 2) {
                var d = b[0];
                c.removeChild(d)
            }
        } else {
            if (b.length == 1) {
                var d = b[0];
                var a = d.cloneNode(true);
                a.style.color = "red";
                a.innerText = "*";
                c.insertBefore(a, d)
            }
        }
    },
    setText: function(a) {
        this._text = a;
        DNA.engine.DomUtil.setInnerText(this.getEl().lastChild, this._text || "");
        this._handleResizeText()
    },
    _resize: function() {
        if (this.getStyle() & DNA.JWT.WRAP) {
            var a = this.getBorderSize();
            var c = this.getBounds();
            var d = DNA.engine.DomUtil.getFoldedTextInf(this.getText(), this.getFont(), c.width - a, DNA.engine.DomUtil.WRAP_CHAR.HTML).text;
            if (d) {
                this.getEl().lastChild.innerHTML = d
            }
        }
        this._handleResizeText()
    },
    _resizeText: function(b) {
        var c = this.getBounds();
        var a = DNA.engine.DomUtil.computeTextSize(this.getText(), this.getFont()).height;
        if (!(DNA.engine.Client.isIE() && !DNA.engine.Client.isStrict())) {
            a = a + 1
        }
        var d = 0;
        if (this.getStyle() & DNA.JWT.MIDDLE) {
            d = (c.height - a * b) / 2
        } else {
            if (this.getStyle() & DNA.JWT.BOTTOM) {
                d = c.height - a * b
            }
        }
        if (this.getText() && this.getText().indexOf(" ") != -1 && !(this.getStyle() & DNA.JWT.WRAP)) {
            if (DNA.engine.Client.isChrome() && DNA.engine.Client.getBrowserVersion() < 49) {
                d -= c.height == 12 ? 2 : 3
            }
            if (DNA.engine.Client.isFF()) {
                d -= c.height == 12 ? 0 : 2
            }
        }
        this.getEl().lastChild.style.position = "relative";
        this.getEl().lastChild.style.top = d + "px";
        this.getEl().firstChild.style.position = "relative";
        this.getEl().firstChild.style.top = d + "px"
    },
    _setFont: function(a) {
        var c = this.getEl();
        if (c) {
            DNA.engine.DomUtil.setFont(c, a);
            var b = c.lastChild;
            if (b) {
                DNA.engine.DomUtil.setFont(b, a)
            }
        }
    }
});
Object.override(DNA.widget.ShowNotNullFlagLabel.prototype, {
    jtype: "ShowNotNullFlagLabel",
    focusable: true
});
DNA.JWTProperty = {
    CACHE_STRATEGY: "nocache",
    DEVOLOPE_MODE: false,
    SECURE_LEVEL: 0,
    DESIGN_MODE: false,
    THEME: "default",
    NONE: 0,
    EMPTY: -1,
    COOKIE_CREATE: 2,
    COOKIE_REMOVE: 4,
    DISABLE_CLIPBOARD: false,
    IS_DNA_CLIENT: false,
    PROPERTY_CLIENT_EVENT: "client_event_",
    PROPERTY_BROWSER_INVOKELIST: "browserinvokelist",
    PROPERTY_CLIENT_MESSAGE: "client_message_",
    PROPERTY_WINDOW_OWNER: "window_owner",
    PROPERTY_SASH_DIRECTION: "sash_direction",
    PROPERTY_SASH_BARSIZE: "sash_barsize",
    PROPERTY_MAX_DATE: "max_date",
    PROPERTY_MIN_DATE: "min_date",
    PROPERTY_HANDLER_NAME: "hanler_name",
    INPUT_ACTION_EVENT: "input_action_event",
    INPUT_WIDGET_EVENT: "input_widget_event",
    INPUT_FOCUS_EVENT: "input_focus_event",
    INPUT_FOCUS_EVENT2: "input_focus_event2",
    INPUT_SMARTKEY_EVENT: "input_smartkey_event",
    INPUT_SELECTED_EVENT: "input_selected_event",
    INPUT_TEXT_EVENT: "input_text_event",
    INPUT_WINDOW_EVENT: "input_window_event",
    INPUT_SORTED_EVENT: "input_sorted_event",
    INPUT_TREE_EVENT: "input_tree_event",
    INPUT_CHECK_EVENT: "input_check_event",
    INPUT_PANEL_EVENT: "input_panel_event",
    INPUT_DRAGDROP_EVENT: "input_dragdrop_event",
    INPUT_CLICK_EVENT: "input_click_event",
    INPUT_DBLCLICK_EVENT: "input_dblclick_event",
    INPUT_CLIENTNOTIFY_EVENT: "input_clientnotify_event",
    INPUT_SELECTIONCHANGING_EVENT: "input_selectionchanging_event",
    INPUT_CURRENTCELLCHANGING_EVENT: "input_currentcellchanging_event",
    INPUT_GRIDCELLEXPEND_EVENT: "input_gridcellexpend_event",
    INPUT_GRIDCELLEXPAND_EVENT: "input_gridcellexpand_event",
    INPUT_GRIDCELLCOLLAPSE_EVENT: "input_gridcellcollapse_event",
    INPUT_GRIDCELLCHECK_EVENT: "input_gridcellcheck_event",
    INPUT_GRIDLOAD_EVENT: "input_gridload_event",
    INPUT_GRIDDATALOAD_EVENT: "input_griddataload_event",
    INPUT_RELOAD_EVENT: "input_reload_event",
    PROCESS_WIDGET_INITED: "widgetInited",
    PROCESS_WIDGET_DISPOSED: "widgetDisposed",
    PROCESS_FOCUS_GAINED: "focusGained",
    PROCESS_FOCUS_LOST: "focusLost",
    PROCESS_TREE_EXPANDED: "treeExpanded",
    PROCESS_TREE_COLLAPSED: "treeCollapsed",
    PROCESS_PANEL_POPUP: "panelPopup",
    PROCESS_PANEL_CLOSE: "panelClose",
    PROPERTY_LAST_MOUSESELECTION: "last_mouse_selection",
    PROPERTY_HEADER_HEIGHT: "header_height",
    PROPERTY_HEADER_VISIBLE: "header_visible",
    PROPERTY_LINE_VISIBLE: "line_visible",
    PROPERTY_ITEM_HEIGHT: "header_item_height",
    PROPERTY_LAYOUT_DATA: "layoutData",
    PROPERTY_ALIGNMENT: "alignment",
    PROPERTY_VERTICAL_ALIGNMENT: "valignment",
    PROPERTY_IMAGE: "image",
    PROPERTY_ICON: "icon",
    PROPERTY_MAXIMUM_LENGTH: "maximumLength",
    PROPERTY_TOOL_TIP_TEXT: "toolTipText",
    PROPERTY_TITLE: "title",
    PROPERTY_TEXT: "text",
    PROPERTY_LAYOUT: "layout",
    PROPERTY_RECTANGLE_BOUNDS: "rectangle_bounds",
    PROPERTY_POLYGON_POINTS: "polygon_points",
    PROPERTY_CIRCLE_BOUNDS: "circle_bounds",
    PROPERTY_LAYOUT_CHANGED: "layout_changed",
    PROPERTY_SIZE_CHANGED: "size_changed",
    PROPERTY_HEIGHT: "height",
    PROPERTY_WIDTH: "width",
    PROPERTY_RECTANGLE: "rectangle",
    PROPERTY_EXPANDED: "expanded",
    PROPERTY_MINIMUM_WIDTH: "minimum_width",
    PROPERTY_MINIMUM_HEIGHT: "minimum_height",
    PROPERTY_WEIGHTS: "weights",
    PROPERTY_DRAGABLE: "dragable",
    PROPERTY_COMPOSITE_SIZE: "composite_size",
    PROPERTY_SEPARATORBAR_BACKGROUND: "separatorbar_background",
    PROPERTY_SEPARATORBAR_BACKIMAGE: "separatorbar_backimage",
    PROPERTY_FOLDING_IMAGES: "folding_images",
    PROPERTY_VISIBLE: "visible",
    PROPERTY_SELECTION_INDEX: "selection_index",
    PROPERTY_POSITION_X: "x",
    PROPERTY_POSITION_Y: "y",
    PROPERTY_BROWSERACTIONLISTENER: "browser_action_listener",
    PROPERTY_RELOADLISTENER: "reload",
    PROPERTY_ACTIONLISTENER: "action_listener",
    PROPERTY_FOCUSLISTENER: "focus_listener",
    PROPERTY_FOCUSLISTENER2: "focus_listener2",
    PROPERTY_WINDOWLISTENER: "window_listener",
    PROPERTY_WIDGETLISTENER: "widget_listener",
    PROPERTY_KEYLISTENER: "key_listener",
    PROPERTY_SELECTIONLISTENER: "selection_listener",
    PROPERTY_DOCUMENTLISTENER: "document_listener",
    PROPERTY_SORTLISTENER: "sort_listener",
    PROPERTY_TREELISTENER: "tree_listener",
    PROPERTY_PROPERTYCHANGELISTENER: "propertyChange_listener",
    PROPERTY_CHECKLISTENER: "check_listener",
    PROPERTY_POPUPLISTENER: "popup_listener",
    PROPERTY_DRAGDROPLISTENER: "dragdrop_listener",
    PROPERTY_MOUSECLICKLISTENER: "mouse_click_listener",
    PROPERTY_MOUSEDBLCLICKLISTENER: "mouse_dblclick_listener",
    PROPERTY_DESIGNLISTENER: "design_listener",
    PROPERTY_STATEMONITORLISTENER: "statemonitor_listener",
    PROPERTY_STYLESHEETLISTENER: "stylesheet_listener",
    PROPERTY_USERREQUESTLISTENER: "userrequest_listener",
    PROPERTY_CLIENTNOTIFYLISTENER: "clientnotify_listener",
    PROPERTY_SELECTIONCHANGINGLISTENER: "selectionchanging_listener",
    PROPERTY_CURRENTCELLCHANGINGLISTENER: "currentcellchanging_listener",
    PROPERTY_GRIDCELLEXPENDLISTENER: "gridcellexpend_listener",
    PROPERTY_GRIDCELLEXPANDLISTENER: "gridcellexpand_listener",
    PROPERTY_GRIDCELLCOLLAPSELISTENER: "gridcellcollapse_listener",
    PROPERTY_GRIDCELLCHECKLISTENER: "gridcellcheck_listener",
    PROPERTY_CHECK: "checked",
    PROPERTY_SELECTION: "selection",
    PROPERTY_INNER_BORDER: "i_border",
    T_PROPERTY_OVERLAP: "overlap",
    PROPERTY_MAXIMUM: "maximum",
    PROPERTY_MINIMUM: "minimum",
    PROPERTY_STATUS: "status",
    PROPERTY_ID: "id",
    PROPERTY_FILE_MAXSIZE: "file_max_size",
    PROPERTY_FILE_MAXCOUNT: "file_max_count",
    PROPERTY_CSS_CLASS_NAME: "css_class_name",
    PROPERTY_FOCUS_TRAVERSAL_INDEX: "focusTraversalIndex",
    PROPERTY_HORIZONTAL_POSITION: "horizontalPosition",
    PROPERTY_VERTICAL_POSITION: "verticalPosition",
    PROPERTY_SELECTION_START: "selectionStartedPosition",
    PROPERTY_SELECTION_END: "selectionEndedPosition",
    PROPERTY_UNIT_TEXT: "textUnitText",
    PROPERTY_UNIT_IMAGE: "textUnitImage",
    PROPERTY_UNIT_POSITION: "textUnitPosition",
    PROPERTY_OWN_SITUATION: "own_situation",
    PROPERTY_URL: "url",
    PROPERTY_PUSHEDDATA: "pusheddata",
    PROPERTY_HTML: "html",
    PROPERTY_TEMP_HTML: "tempHtml",
    PROPERTY_MODE: "mode",
    PROPERTY_CSSSTYLES: "css_styles",
    PROPERTY_SELECTION_MODEL: "selection_model",
    PROPERTY_TABLE_COLUMNS: "table_columns",
    PROPERTY_DIALOG_COLOR: "dialog_color",
    PROPERTY_DIALOG_FONT: "dialog_font",
    PROPERTY_DATETIME: "datetime",
    PROPERTY_STYLE: "style",
    PROPERTY_CLIENTDATA: "client_data",
    PROPERTY_CLIENTOBJECT: "client_object",
    PROPERTY_SERVER_NOTIFY: "server_notify",
    PROPERTY_CELLS: "tableitem_cells",
    PROPERTY_CHECK_GRAYED: "check_grayed",
    PROPERTY_SORT_INFO: "table_sort_info",
    SYS_HIDDEN_X: 10000,
    PROPERTY_DISPLAY: "display",
    PROPERTY_LOCALE: "locale",
    PROPERTY_LANGUAGE: "language",
    PROPERTY_FILECHOOSER_WIDGET: "filechooser_widget",
    PROPERTY_FILECHOOSER_EVENT: "filechooser_event",
    PROPERTY_FILECHOOSER_FILENAMES: "filechooser_filenames",
    PROPERTY_FILECHOOSER_OPEN: "filechooser_open",
    PROPERTY_WINDOW_HANDLE: "window_handle",
    PROPERTY_PARENT_WINDOW_HANDLE: "parent_window_handle",
    PROPERTY_WINDOW_OPENED: "window_opened",
    PROPERTY_REMOVEALL: "remove_all",
    PROPERTY_PACK: "pack",
    PROPERTY_WINDOW_MAXIMUM: "window_maximum",
    PROPERTY_DEFAULTBUTTON: "default_button",
    PROPERTY_CLIENTSCRIPT_MANAGER: "client_script_manager",
    PROPERTY_HANDLE: "handle",
    PROPERTY_MENU_HANDLE: "menu_handle",
    PROPERTY_MENU_HOST: "menu_host",
    PROPERTY_TEXT_DESCRIPTION: "text_description",
    PROPERTY_TEXT_HINT: "text_hint",
    PROPERTY_TEXT_REGEXP: "text_regexp",
    PROPERTY_POPUPPANEL_SIZE: "popuppanel_size",
    PROPERTY_DOWNBUTTON_VISIBLE: "downbutton_visible",
    PROPERTY_POPUPPANEL_VISIBLE: "popup_visible",
    PROPERTY_DIGITS: "spinner_digits",
    PROPERTY_INCREMENT: "spinner_increment",
    PROPERTY_PAGE_INCREMENT: "spinner_page_increment",
    PROPERTY_RETURN_VALUE: "return_value",
    PROPERTY_DIALOG_MESSAGE: "dialog_message",
    PROPERTY_DRAGSOURCE_ID: "dragsource_id",
    PROPERTY_DROPTARGET_ID: "droptarget_id",
    PROPERTY_FORMATTER: "gridFormatter",
    POPUP_CLOSE_OK: "popup_close_ok",
    POPUP_CLOSE_CANCEL: "popup_close_cancel",
    DV_BUTTON_WIDTH: "BUTTON_WIDTH",
    DV_BUTTON_HEIGHT: "BUTTON_HEIGHT",
    DV_BUTTON_CHECK_WIDTH: "BUTTON_CHECK_WIDTH",
    DV_BUTTON_CHECK_HEIGHT: "BUTTON_CHECK_HEIGHT",
    DV_BUTTON_RADIO_WIDTH: "BUTTON_RADIO_WIDTH",
    DV_BUTTON_RADIO_HEIGHT: "BUTTON_RADIO_HEIGHT",
    DV_TEXT_WIDTH: "TEXT_WIDTH",
    DV_TEXT_HEIGHT: "TEXT_HEIGHT",
    DV_COMBO_WIDTH: "COMBO_WIDTH",
    DV_COMBO_HEIGHT: "COMBO_HEIGHT",
    DV_SPINNER_WIDTH: "SPINNER_WIDTH",
    DV_SPINNER_HEIGHT: "SPINNER_HEIGHT",
    DV_TEXT_PASSWORD_WIDTH: "TEXT_PASSWORD_WIDTH",
    DV_TEXT_PASSWORD_HEIGHT: "TEXT_PASSWORD_HEIGHT",
    DV_TEXT_MULTI_WIDTH: "TEXT_MULTI_WIDTH",
    DV_TEXT_MULTI_HEIGHT: "TEXT_MULTI_HEIGHT",
    DV_TEXT_RICH_WIDTH: "TEXT_RICH_WIDTH",
    DV_TEXT_RICH_HEIGHT: "TEXT_RICH_HEIGHT",
    DV_COMPOSITE_HEIGHT: "COMPOSITE_HEIGHT",
    DV_COMPOSITE_WIDTH: "COMPOSITE_WIDTH",
    DV_WINDOW_HEIGHT: "WINDOW_HEIGHT",
    DV_WINDOW_WIDTH: "WINDOW_WIDTH",
    DV_ACCORDION_HEIGHT: "ACCORDION_HEIGHT",
    DV_ACCORDION_WIDTH: "ACCORDION_WIDTH",
    DV_SASHFORM_HEIGHT: "SASHFORM_HEIGHT",
    DV_SASHFORM_WIDTH: "SASHFORM_WIDTH",
    DV_TABFOLDER_WIDTH: "TABFOLDER_WIDTH",
    DV_TABFOLDER_HEIGHT: "TABFOLDER_HEIGHT",
    DV_LIST_WIDTH: "LIST_WIDTH",
    DV_LIST_HEIGHT: "LIST_HEIGHT",
    DV_GROUP_WIDTH: "GROUP_WIDTH",
    DV_GROUP_HEIGHT: "GROUP_HEIGHT",
    DV_IMAGEBORDERCOMPOSITE_WIDTH: "IMAGEBORDERCOMPOSITE_WIDTH",
    DV_IMAGEBORDERCOMPOSITE_HEIGHT: "IMAGEBORDERCOMPOSITE_HEIGHT",
    STATUS_SERVER_ERROR: 500,
    STATUS_APPLICATION_INVALID: 551,
    STATUS_SERVICEID_INVALID: 552,
    STATUS_ENTRY_INVALID: 553,
    STATUS_SERVER_NA: 554,
    STATUS_SESSION_EXPIRED_BY_DISPOSE: 560,
    STATUS_SESSION_EXPIRED_BY_TIME: 556,
    STATUS_SESSION_EXPIRED_BY_RESTART: 557,
    STATUS_SESSION_CONCURRENT: 558,
    STATUS_SESSION_REENTANT: 559,
    STATUS_REMOTESERVICE_NOTFOUND: 570,
    STATUS_REMOTESERVICE_ERROR: 571,
    DATA_DROP_INFO: "DROP_INFO",
    DATA_DROP_POSITION: "DROP_POSITION",
    DESIGNER_XY_ADSORPTION: "DESIGNER_XY_ADSORPTION",
    DESIGNER_XY_SELECTIONCONTROL: "XY_SELECTIONCONTROL",
    DESIGNER_TABLE_ROWHEIGHT: "DESIGNER_TABLE_ROWHEIGHT",
    DESIGNER_TABLE_COLUMNWIDTH: "DESIGNER_TABLE_COLUMNWIDTH",
    DESIGNER_TABLE_HEIGHT: "DESIGNER_TABLE_HEIGHT",
    DESIGNER_TABLE_WIDTH: "DESIGNER_TABLE_WIDTH",
    DESIGNER_TABLE_SELECTION: "DESIGNER_TABLE_SELECTION",
    DESIGNER_TABLE_SELECTIONCONTROL: "TABLE_SELECTIONCONTROL",
    DESIGN_RESIZING: "DESIGN_RESIZING",
    DESIGN_RESIZING_SIZE: "DESIGN_RESIZING_SIZE",
    DESIGNER_TABLE_EDITABLE: "DESIGNER_TABLE_EDITABLE",
    DESIGNER_TABLE_RESIZABLE: "DESIGNER_TABLE_RESIZABLE",
    DESIGNER_TABLE_SELECTIONENABLE: "DESIGNER_TABLE_SELECTIONENABLE",
    DESIGNER_TABLE_DRAGOVEREFFECT_ARRAY: "DESIGNER_TABLE_DRAGOVEREFFECT_ARRAY",
    DESIGNER_TABLE_DRAGOVEREFFECT_DIRECTIONS: "DESIGNER_TABLE_DRAGOVEREFFECT_DIRECTIONS",
    DESIGNER_DROP_TARGET_ENABLED: "DESIGNER_DROP_TARGET_ENABLED",
    EFFICIENT_ITEMS: "EFFICIENT_ITEMS",
    EFFICIENT_UPDATEITEMS: "EFFICIENT_UPDATEITEMS",
    EFFICIENT_CHANGESTATE: "EFFICIENT_CHANGESTATE",
    EFFICIENT_INITITEMS: "EFFICIENT_INITITEMS",
    EFFICIENTTREE_COLLAPSED: "EFFICIENTTREE_COLLAPSED",
    EFFICIENTTREE_EXPANED: "EFFICIENTTREE_EXPANED",
    EFFICIENTTREE_EVENT: "EFFICIENTTREE_EVENT",
    PROPERTY_EFFICIENT_TREELISTENER: "PROPERTY_EFFICIENT_TREELISTENER",
    PROPERTY_LWCONTROL_SELECTIONLISTENER: "PROPERTY_LWCONTROL_SELECTIONLISTENER",
    PROPERTY_LWCONTROL_TABLECOLUMNS: "PROPERTY_LWCONTROL_TABLECOLUMNS",
    PROPERTY_LWCONTROL_CHECKSTATELISTENER: "PROPERTY_LWCONTROL_CHECKSTATELISTENER",
    PROPERTY_LWCONTROL_SELECTION: "PROPERTY_LWCONTROL_SELECTION",
    PROPERTY_LWCONTROL_DISPOSE: "PROPERTY_LWCONTROL_DISPOSE",
    PROPERTY_LWCONTROL_INSERT: "PROPERTY_LWCONTROL_INSERT",
    PROPERTY_SELECTIONCHANGELISTENER: "PROPERTY_SELECTIONCHANGELISTENER",
    SYN_INIT: "init",
    SYN_UPDATE: "update",
    SYN_DISPOSE: "dispose",
    SYN_ID: "i",
    SYN_TEXT: "t",
    SYN_NAME: "n",
    SYN_TYPE: "p",
    SYN_VALUE: "v",
    SYN_X: "x",
    SYN_Y: "y",
    SYN_WIDTH: "w",
    SYN_HEIGHT: "h",
    SYN_ALIGNMENT: "a",
    SYN_SIZE: "sz",
    SYN_STYLE: "st",
    SYN_COLOR: "color",
    SYN_IMAGE: "im",
    SYN_IMAGES: "ims",
    SYN_BORDER_THICK: "tk",
    SYN_CSS_EXTENDS: "et",
    SYN_TOOL_ENTRY_DESCRIPTION: "des",
    SYN_TOOL_ENTRY_CATALOG: "cat",
    SYN_TOOL_ENTRY_GROUP: "gro",
    SYN_TOOL_ENTRY_SMALL_ICON: "si",
    SYN_TOOL_ENTRY_LARGE_ICON: "li",
    SYN_TOOL_ENTRY_FIGURE_IMAGE: "fi",
    SYN_LAYOUT_TYPE: "lt",
    SYN_LAYOUT_SPACING: "s",
    SYN_LAYOUT_MARGIN_LEFT: "ml",
    SYN_LAYOUT_MARGIN_RIGHT: "mr",
    SYN_LAYOUT_MARGIN_TOP: "mt",
    SYN_LAYOUT_MARGIN_BOTTOM: "mb",
    SYN_LAYOUT_MARGIN_WIDTH: "mw",
    SYN_LAYOUT_MARGIN_HEIGHT: "mh",
    SYN_LAYOUT_EXCLUDE: "ex",
    SYN_LAYOUT_ROW_WRAP: "r",
    SYN_LAYOUT_ROW_PACK: "pa",
    SYN_LAYOUT_ROW_JUSTIFY: "j",
    SYN_LAYOUT_ROW_FILL: "f",
    SYN_LAYOUT_GRID_NUM_COLUMNS: "n",
    SYN_LAYOUT_GRID_MAKE_COLUMNS_EQUAL_WIDTH: "e",
    SYN_LAYOUT_GRID_HORIZONTAL_SPACING: "hs",
    SYN_LAYOUT_GRID_VERTICAL_SPACING: "vs",
    SYN_LAYOUT_GRID_DATA_HORIZONTAL_ALIGNMENT: "ha",
    SYN_LAYOUT_GRID_DATA_HORIZONTAL_INDENT: "hi",
    SYN_LAYOUT_GRID_DATA_HORIZONTAL_SPAN: "hs",
    SYN_LAYOUT_GRID_DATA_VERTICAL_ALIGNMENT: "va",
    SYN_LAYOUT_GRID_DATA_VERTICAL_INDENT: "vi",
    SYN_LAYOUT_GRID_DATA_VERTICAL_SPAN: "vs",
    SYN_LAYOUT_GRID_DATA_MINIMUM_WIDTH: "mw",
    SYN_LAYOUT_GRID_DATA_MINIMUM_HEIGHT: "mh",
    SYN_LAYOUT_GRID_DATA_GRAD_EXCESS_HORIZONTAL_SPACE: "gv",
    SYN_LAYOUT_GRID_DATA_GRAD_EXCESS_VERTICAL_SPACE: "gh",
    SYN_LAYOUT_BORDER_HGAP: "hg",
    SYN_LAYOUT_BORDER_VGAP: "vg",
    SYN_LAYOUT_BORDER_DATA_POSITION: "p",
    SYN_LAYOUT_TABLE_COLUMN_COUNT: "cc",
    SYN_LAYOUT_TABLE_ROW_COUNT: "rc",
    SYN_LAYOUT_TABLE_PIXEL_FIRST: "p",
    SYN_LAYOUT_TABLE_COLUMN_WIDTHS: "cw",
    SYN_LAYOUT_TABLE_ROW_HEIGHTS: "rh",
    SYN_LAYOUT_TABLE_DATA_HORIZONTAL_ALIGNMENT: "ha",
    SYN_LAYOUT_TABLE_DATA_HORIZONTAL_INDENT: "hi",
    SYN_LAYOUT_TABLE_DATA_VERTICAL_ALIGNMENT: "va",
    SYN_LAYOUT_TABLE_DATA_VERTICAL_INDENT: "vi",
    SYN_LAYOUT_TABLE_CELL_INFOS: "ci",
    SYN_LAYOUT_TABLE_CELL_COLUMN_SPAN: "c",
    SYN_LAYOUT_TABLE_CELL_ROW_SPAN: "r",
    SYN_LAYOUT_TABLE_CELL_IGNORE: "i",
    SYN_LAYOUT_TABLE_CELL_IS_SPAN: "s",
    MODE_NAMES: ["", "readonly", "error", "unselectable", "", "", "", "", "", "", "", "", "", "", "", "", "disable"],
    HEART_BEAT_INTERVAL: 30000,
    RICHLIST_DEFAULT_LINE_HEIGHT: 25,
    URL_DNA_PAGE_NUM: "url_dna_page_num",
    URL_DNA_PAGE_COUNT: "url_dna_page_count",
    PRIVILEGE_READ: 0,
    PRIVILEGE_WRITE: 1,
    PRIVILEGE_EMPTY: 2,
    PROPERTY_FILE_EXPORER: "file_exporer",
    PROPERTY_FOCUS_TRAVERSAL_KEY: "focusTraversalKey"
};
DNA.PropertyDefaultValue = {
    TEXT_WIDTH: 200,
    LIST_HEIGHT: 100,
    TEXT_RICH_HEIGHT: 100,
    file_max_count: 10,
    BUTTON_CHECK_HEIGHT: 20,
    TEXT_PASSWORD_WIDTH: 200,
    SASHFORM_WIDTH: 100,
    IMAGEBORDERCOMPOSITE_HEIGHT: 100,
    TABFOLDER_HEIGHT: 100,
    TEXT_PASSWORD_HEIGHT: 21,
    SPINNER_WIDTH: 50,
    ACCORDION_HEIGHT: 400,
    COMPOSITE_WIDTH: 0,
    BUTTON_WIDTH: 75,
    WINDOW_WIDTH: 100,
    file_max_size: 10,
    BUTTON_CHECK_WIDTH: 100,
    GROUP_WIDTH: 100,
    ACCORDION_WIDTH: 100,
    LIST_WIDTH: 100,
    TEXT_MULTI_WIDTH: 200,
    COMBO_HEIGHT: 21,
    TABFOLDER_WIDTH: 100,
    IMAGEBORDERCOMPOSITE_WIDTH: 100,
    BUTTON_RADIO_WIDTH: 100,
    TEXT_RICH_WIDTH: 200,
    GROUP_HEIGHT: 100,
    BUTTON_HEIGHT: 20,
    WINDOW_HEIGHT: 100,
    BUTTON_RADIO_HEIGHT: 20,
    SPINNER_HEIGHT: 21,
    TEXT_HEIGHT: 21,
    SASHFORM_HEIGHT: 100,
    TEXT_MULTI_HEIGHT: 100,
    COMPOSITE_HEIGHT: 0,
    COMBO_WIDTH: 120
};
